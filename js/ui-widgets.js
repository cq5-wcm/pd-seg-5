try{var p=CQ_swfobject.p
}catch(e){
/* SWFObject v2.1 <http://code.google.com/p/swfobject/>
     Copyright (c) 2007-2008 Geoff Stearns, Michael Williams, and Bobby van der Sluis
     This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
     */
var CQ_swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",win=window,doc=document,nav=navigator,domLoadFnArr=[],regObjArr=[],objIdArr=[],listenersArr=[],script,timer=null,storedAltContent=null,storedAltContentId=null,isDomLoaded=false,isExpressInstallActive=false;
var ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,playerVersion=[0,0,0],d=null;
if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;
if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);
playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);
playerVersion[2]=/r/.test(d)?parseInt(d.replace(/^.*r(.*)$/,"$1"),10):0
}}else{if(typeof win.ActiveXObject!=UNDEF){var a=null,fp6Crash=false;
try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX+".7")
}catch(e){try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX+".6");
playerVersion=[6,0,21];
a.AllowScriptAccess="sameDomain"
}catch(e){if(playerVersion[0]==6){fp6Crash=true
}}if(!fp6Crash){try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX)
}catch(e){}}}if(!fp6Crash&&a){try{d=a.GetVariable("$version");
if(d){d=d.split(" ")[1].split(",");
playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]
}}catch(e){}}}}var u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=false,windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u);
/*@cc_on
             ie = true;
             @if (@_win32)
             windows = true;
             @elif (@_mac)
             mac = true;
             @end
             @*/
return{w3cdom:w3cdom,pv:playerVersion,webkit:webkit,ie:ie,win:windows,mac:mac}
}();
var onDomLoad=function(){if(!ua.w3cdom){return 
}addDomLoadEvent(main);
if(ua.webkit&&typeof doc.readyState!=UNDEF){timer=setInterval(function(){if(/loaded|complete/.test(doc.readyState)){callDomLoadFunctions()
}},10)
}if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,null)
}addLoadEvent(callDomLoadFunctions)
}();
function checkReadyState(){if(script.readyState=="complete"){script.parentNode.removeChild(script);
callDomLoadFunctions()
}}function callDomLoadFunctions(){if(isDomLoaded){return 
}isDomLoaded=true;
if(timer){clearInterval(timer);
timer=null
}var dl=domLoadFnArr.length;
for(var i=0;
i<dl;
i++){domLoadFnArr[i]()
}}function addDomLoadEvent(fn){if(isDomLoaded){fn()
}else{domLoadFnArr[domLoadFnArr.length]=fn
}}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false)
}else{if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false)
}else{if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn)
}else{if(typeof win.onload=="function"){var fnOld=win.onload;
win.onload=function(){fnOld();
fn()
}
}else{win.onload=fn
}}}}}function main(){var rl=regObjArr.length;
for(var i=0;
i<rl;
i++){var id=regObjArr[i].id;
if(ua.pv[0]>0){var obj=getElementById(id);
if(obj){regObjArr[i].width=obj.getAttribute("width")?obj.getAttribute("width"):"0";
regObjArr[i].height=obj.getAttribute("height")?obj.getAttribute("height"):"0";
if(hasPlayerVersion(regObjArr[i].swfVersion)){if(ua.webkit&&ua.webkit<312){fixParams(obj)
}setVisibility(id,true)
}else{if(regObjArr[i].expressInstall&&!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)){showExpressInstall(regObjArr[i])
}else{displayAltContent(obj)
}}}}else{setVisibility(id,true)
}}}function fixParams(obj){var nestedObj=obj.getElementsByTagName(OBJECT)[0];
if(nestedObj){var e=createElement("embed"),a=nestedObj.attributes;
if(a){var al=a.length;
for(var i=0;
i<al;
i++){if(a[i].nodeName=="DATA"){e.setAttribute("src",a[i].nodeValue)
}else{e.setAttribute(a[i].nodeName,a[i].nodeValue)
}}}var c=nestedObj.childNodes;
if(c){var cl=c.length;
for(var j=0;
j<cl;
j++){if(c[j].nodeType==1&&c[j].nodeName=="PARAM"){e.setAttribute(c[j].getAttribute("name"),c[j].getAttribute("value"))
}}}obj.parentNode.replaceChild(e,obj)
}}function showExpressInstall(regObj){isExpressInstallActive=true;
var obj=getElementById(regObj.id);
if(obj){if(regObj.altContentId){var ac=getElementById(regObj.altContentId);
if(ac){storedAltContent=ac;
storedAltContentId=regObj.altContentId
}}else{storedAltContent=abstractAltContent(obj)
}if(!(/%$/.test(regObj.width))&&parseInt(regObj.width,10)<310){regObj.width="310"
}if(!(/%$/.test(regObj.height))&&parseInt(regObj.height,10)<137){regObj.height="137"
}doc.title=doc.title.slice(0,47)+" - Flash Player Installation";
var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",dt=doc.title,fv="MMredirectURL="+win.location+"&MMplayerType="+pt+"&MMdoctitle="+dt,replaceId=regObj.id;
if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");
replaceId+="SWFObjectNew";
newObj.setAttribute("id",replaceId);
obj.parentNode.insertBefore(newObj,obj);
obj.style.display="none";
var fn=function(){obj.parentNode.removeChild(obj)
};
addListener(win,"onload",fn)
}createSWF({data:regObj.expressInstall,id:EXPRESS_INSTALL_ID,width:regObj.width,height:regObj.height},{flashvars:fv},replaceId)
}}function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");
obj.parentNode.insertBefore(el,obj);
el.parentNode.replaceChild(abstractAltContent(obj),el);
obj.style.display="none";
var fn=function(){obj.parentNode.removeChild(obj)
};
addListener(win,"onload",fn)
}else{obj.parentNode.replaceChild(abstractAltContent(obj),obj)
}}function abstractAltContent(obj){var ac=createElement("div");
if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML
}else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];
if(nestedObj){var c=nestedObj.childNodes;
if(c){var cl=c.length;
for(var i=0;
i<cl;
i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true))
}}}}}return ac
}function createSWF(attObj,parObj,id){var r,el=getElementById(id);
if(el){if(typeof attObj.id==UNDEF){attObj.id=id
}if(ua.ie&&ua.win){var att="";
for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i]
}else{if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"'
}else{if(i.toLowerCase()!="classid"){att+=" "+i+'="'+attObj[i]+'"'
}}}}}var par="";
for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />'
}}el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>";
objIdArr[objIdArr.length]=attObj.id;
r=getElementById(attObj.id)
}else{if(ua.webkit&&ua.webkit<312){var e=createElement("embed");
e.setAttribute("type",FLASH_MIME_TYPE);
for(var k in attObj){if(attObj[k]!=Object.prototype[k]){if(k.toLowerCase()=="data"){e.setAttribute("src",attObj[k])
}else{if(k.toLowerCase()=="styleclass"){e.setAttribute("class",attObj[k])
}else{if(k.toLowerCase()!="classid"){e.setAttribute(k,attObj[k])
}}}}}for(var l in parObj){if(parObj[l]!=Object.prototype[l]){if(l.toLowerCase()!="movie"){e.setAttribute(l,parObj[l])
}}}el.parentNode.replaceChild(e,el);
r=e
}else{var o=createElement(OBJECT);
o.setAttribute("type",FLASH_MIME_TYPE);
for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m])
}else{if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m])
}}}}for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n])
}}el.parentNode.replaceChild(o,el);
r=o
}}}return r
}function createObjParam(el,pName,pValue){var p=createElement("param");
p.setAttribute("name",pName);
p.setAttribute("value",pValue);
el.appendChild(p)
}function removeSWF(id){var obj=getElementById(id);
if(obj&&(obj.nodeName=="OBJECT"||obj.nodeName=="EMBED")){if(ua.ie&&ua.win){if(obj.readyState==4){removeObjectInIE(id)
}else{win.attachEvent("onload",function(){removeObjectInIE(id)
})
}}else{obj.parentNode.removeChild(obj)
}}}function removeObjectInIE(id){var obj=getElementById(id);
if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null
}}obj.parentNode.removeChild(obj)
}}function getElementById(id){var el=null;
try{el=doc.getElementById(id)
}catch(e){}return el
}function createElement(el){return doc.createElement(el)
}function addListener(target,eventType,fn){target.attachEvent(eventType,fn);
listenersArr[listenersArr.length]=[target,eventType,fn]
}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");
v[0]=parseInt(v[0],10);
v[1]=parseInt(v[1],10)||0;
v[2]=parseInt(v[2],10)||0;
return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false
}function createCSS(sel,decl){if(ua.ie&&ua.mac){return 
}var h=doc.getElementsByTagName("head")[0],s=createElement("style");
s.setAttribute("type","text/css");
s.setAttribute("media","screen");
if(!(ua.ie&&ua.win)&&typeof doc.createTextNode!=UNDEF){s.appendChild(doc.createTextNode(sel+" {"+decl+"}"))
}h.appendChild(s);
if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){var ls=doc.styleSheets[doc.styleSheets.length-1];
if(typeof ls.addRule==OBJECT){ls.addRule(sel,decl)
}}}function setVisibility(id,isVisible){var v=isVisible?"visible":"hidden";
if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v
}else{createCSS("#"+id,"visibility:"+v)
}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;
var hasBadChars=regex.exec(s)!=null;
return hasBadChars?encodeURIComponent(s):s
}var cleanup=function(){if(ua.ie&&ua.win){var fn=function(){var ll=listenersArr.length;
for(var i=0;
i<ll;
i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2])
}var il=objIdArr.length;
for(var j=0;
j<il;
j++){removeSWF(objIdArr[j])
}for(var k in ua){ua[k]=null
}ua=null;
for(var l in CQ_swfobject){CQ_swfobject[l]=null
}CQ_swfobject=null;
window.detachEvent("onunload",fn)
};
window.attachEvent("onunload",fn)
}}();
return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr){if(!ua.w3cdom||!objectIdStr||!swfVersionStr){return 
}var regObj={};
regObj.id=objectIdStr;
regObj.swfVersion=swfVersionStr;
regObj.expressInstall=xiSwfUrlStr?xiSwfUrlStr:false;
regObjArr[regObjArr.length]=regObj;
setVisibility(objectIdStr,false)
},getObjectById:function(objectIdStr){var r=null;
if(ua.w3cdom){var o=getElementById(objectIdStr);
if(o){var n=o.getElementsByTagName(OBJECT)[0];
if(!n||(n&&typeof o.SetVariable!=UNDEF)){r=o
}else{if(typeof n.SetVariable!=UNDEF){r=n
}}}}return r
},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj){if(document.readyState===undefined||document.readyState=="complete"){callDomLoadFunctions()
}if(!ua.w3cdom||!swfUrlStr||!replaceElemIdStr||!widthStr||!heightStr||!swfVersionStr){return 
}widthStr+="";
heightStr+="";
if(hasPlayerVersion(swfVersionStr)){setVisibility(replaceElemIdStr,false);
var att={};
if(attObj&&typeof attObj===OBJECT){for(var i in attObj){if(attObj[i]!=Object.prototype[i]){att[i]=attObj[i]
}}}att.data=swfUrlStr;
att.width=widthStr;
att.height=heightStr;
var par={};
if(parObj&&typeof parObj===OBJECT){for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par[j]=parObj[j]
}}}if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(flashvarsObj[k]!=Object.prototype[k]){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k]
}else{par.flashvars=k+"="+flashvarsObj[k]
}}}}addDomLoadEvent(function(){createSWF(att,par,replaceElemIdStr);
if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true)
}})
}else{if(xiSwfUrlStr&&!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)){isExpressInstallActive=true;
setVisibility(replaceElemIdStr,false);
addDomLoadEvent(function(){var regObj={};
regObj.id=regObj.altContentId=replaceElemIdStr;
regObj.width=widthStr;
regObj.height=heightStr;
regObj.expressInstall=xiSwfUrlStr;
showExpressInstall(regObj)
})
}}},getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}
},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3cdom){return createSWF(attObj,parObj,replaceElemIdStr)
}else{return undefined
}},removeSWF:function(objElemIdStr){if(ua.w3cdom){removeSWF(objElemIdStr)
}},createCSS:function(sel,decl){if(ua.w3cdom){createCSS(sel,decl)
}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;
if(param==null){return urlEncodeIfNecessary(q)
}if(q){var pairs=q.substring(1).split("&");
for(var i=0;
i<pairs.length;
i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)))
}}}return""
},expressInstallCallback:function(){if(isExpressInstallActive&&storedAltContent){var obj=getElementById(EXPRESS_INSTALL_ID);
if(obj){obj.parentNode.replaceChild(storedAltContent,obj);
if(storedAltContentId){setVisibility(storedAltContentId,true);
if(ua.ie&&ua.win){storedAltContent.style.display="block"
}}storedAltContent=null;
storedAltContentId=null;
isExpressInstallActive=false
}}}}
}()
}window.CQ=window.CQ||{};
CQ.state={};
CQ.data={};
CQ.ipe={};
CQ.form={};
CQ.form.rte={};
CQ.form.rte.commands={};
CQ.form.rte.plugins={};
CQ.form.rte.ui={};
CQ.menu={};
CQ.tree={};
CQ.utils={};
CQ.security={};
CQ.wcm={};
CQ.wcm.msm={};
CQ.endorsed={};
CQ.themes={};
CQ.themes.wcm={};
CQ.Class=function(){};
if(window.console===undefined){window.console={log:function(A){}}
}CQ.REQUEST_TIMEOUT=600000;
CQ.VERY_SHORT_INTERVAL="VERY_SHORT_INTERVAL";
CQ.VERY_SHORT_INTERVAL_VALUE=200;
CQ.SHORT_INTERVAL="SHORT_INTERVAL";
CQ.SHORT_INTERVAL_VALUE=1000;
CQ.LONG_INTERVAL="LONG_INTERVAL";
CQ.LONG_INTERVAL_VALUE=20000;
CQ.VERY_LONG_INTERVAL="VERY_LONG_INTERVAL";
CQ.VERY_LONG_INTERVAL_VALUE=240000;
CQ.CF_REFRESH_INTERVAL=0;
CQ.EDITBASE_DD_MIMEMAPPING=[{mimeType:/image\/(gif|jpeg|png)/,resourceType:"foundation/components/image",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./jcr:title"},{mimeType:/application\/x-shockwave-flash/,resourceType:"foundation/components/flash",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./fileName"},{mimeType:/.*/,resourceType:"foundation/components/download",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./fileName"}];
CQ.TREE_AUTOEXPAND_MAX=30;
CQ.Timing=function(){return{stamps:null,cqPageRenderStart:null,lastTimes:{},init:function(){this.cqPageRenderStart=new Date();
this.lastTimes["default"]=new Date();
this.stamps="";
var B=window.onload;
if(typeof window.onload!="function"){window.onload=CQ.Timing.stampOnLoad
}else{window.onload=function(){if(B){B()
}CQ.Timing.stampOnLoad()
}
}var A=window.document.onkeydown;
if(typeof window.document.onkeydown!="function"){window.document.onkeydown=CQ.Timing.showDiv
}else{window.document.onkeydown=function(C){if(A){A(C)
}CQ.Timing.showDiv(C)
}
}},stamp:function(F,G,D){if(!G){G="default"
}var E=this.lastTimes[G];
var A=new Date();
var B;
if(D||E==undefined){B="&nbsp;---"
}else{B=A-E;
B=(B<1000?(B<100?(B<10?"&nbsp;&nbsp;&nbsp;":"&nbsp;&nbsp;"):"&nbsp;"):"")+B
}var C=B+" / "+(A-this.cqPageRenderStart)+" ms &ndash; "+F;
this.lastTimes[G]=A;
this.stamps+=(this.stamps)?","+C:C
},stampOnLoad:function(){CQ.Timing.stamp("Complete document loaded")
},writeDiv:function(){var A=window.document.createElement("div");
var B=A.style;
A.id="cqTiming";
B.margin="0 auto 0 auto";
B.borderBottom="1px solid #000000";
B.marginBottom="5px";
B.fontSize="small";
B.fontFamily="monospace";
B.backgroundColor="#000000";
B.color="#ffffff";
B.position="absolute";
B.top="0px";
B.left="0px";
A.innerHTML='<p style="margin: 2px 0 1px 0"> Page load staticstics:<br>'+this.stamps.replace(/,/g,"<br>")+'</p><p style="margin: 2px 0 1px 0; text-align: right"><a href="javascript:{CQ.Timing.hideDiv();}">Close</a></p>';
window.document.body.appendChild(A)
},hideDiv:function(){window.document.getElementById("cqTiming").style.display="none"
},showDiv:function(C){var B;
var A;
if(document.all){B=window.event.keyCode;
A=window.event
}else{B=(typeof (C.which)!="undefined")?C.which:0;
A=C
}if(A&&A.ctrlKey&&A.shiftKey&&B==85){CQ.Timing.writeDiv()
}}}
}();
CQ.Timing.init();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
window.undefined=window.undefined;
CQ.Ext={version:"3.1.1"};
CQ.Ext.apply=function(C,D,B){if(B){CQ.Ext.apply(C,B)
}if(C&&D&&typeof D=="object"){for(var A in D){C[A]=D[A]
}}return C
};
(function(){var F=0,R=Object.prototype.toString,S=navigator.userAgent.toLowerCase(),X=function(b){return b.test(S)
},H=document,K=H.compatMode=="CSS1Compat",Z=X(/opera/),G=X(/\bchrome\b/),T=X(/webkit/),W=!G&&X(/safari/),E=W&&X(/applewebkit\/4/),B=W&&X(/version\/3/),a=W&&X(/version\/4/),Q=!Z&&X(/msie/),O=Q&&X(/msie 7/),N=Q&&X(/msie 8/),P=Q&&!O&&!N,M=!T&&X(/gecko/),D=M&&X(/rv:1\.8/),A=M&&X(/rv:1\.9/),U=Q&&!K,Y=X(/windows|win32/),J=X(/macintosh|mac os x/),I=X(/adobeair/),L=X(/linux/),C=/^https/i.test(window.location.protocol);
if(P){try{H.execCommand("BackgroundImageCache",false,true)
}catch(V){}}CQ.Ext.apply(CQ.Ext,{SSL_SECURE_URL:C&&Q?'javascript:""':"about:blank",isStrict:K,isSecure:C,isReady:false,enableGarbageCollector:true,enableListenerCollection:false,enableNestedListenerRemoval:false,USE_NATIVE_JSON:false,applyIf:function(d,g){if(d){for(var b in g){if(!CQ.Ext.isDefined(d[b])){d[b]=g[b]
}}}return d
},id:function(b,c){b=CQ.Ext.getDom(b,true)||{};
if(!b.id){b.id=(c||"cq-gen")+(++F)
}return b.id
},extend:function(){var c=function(g){for(var d in g){this[d]=g[d]
}};
var b=Object.prototype.constructor;
return function(n,j,m){if(CQ.Ext.isObject(j)){m=j;
j=n;
n=m.constructor!=b?m.constructor:function(){j.apply(this,arguments)
}
}var g=function(){},k,d=j.prototype;
g.prototype=d;
k=n.prototype=new g();
k.constructor=n;
n.superclass=d;
if(d.constructor==b){d.constructor=j
}n.override=function(q){CQ.Ext.override(n,q)
};
k.superclass=k.supr=(function(){return d
});
k.override=c;
CQ.Ext.override(n,m);
n.extend=function(q){return CQ.Ext.extend(n,q)
};
return n
}
}(),override:function(b,d){if(d){var c=b.prototype;
CQ.Ext.apply(c,d);
if(CQ.Ext.isIE&&d.hasOwnProperty("toString")){c.toString=d.toString
}}},namespace:function(){var c,b;
CQ.Ext.each(arguments,function(d){b=d.split(".");
c=window[b[0]]=window[b[0]]||{};
CQ.Ext.each(b.slice(1),function(g){c=c[g]=c[g]||{}
})
});
return c
},urlEncode:function(j,g){var c,b=[],d=encodeURIComponent;
CQ.Ext.iterate(j,function(k,m){c=CQ.Ext.isEmpty(m);
CQ.Ext.each(c?k:m,function(n){b.push("&",d(k),"=",(!CQ.Ext.isEmpty(n)&&(n!=k||!c))?(CQ.Ext.isDate(n)?CQ.Ext.encode(n).replace(/"/g,""):d(n)):"")
})
});
if(!g){b.shift();
g=""
}return g+b.join("")
},urlDecode:function(g,c){if(CQ.Ext.isEmpty(g)){return{}
}var m={},k=g.split("&"),n=decodeURIComponent,b,j;
CQ.Ext.each(k,function(d){d=d.split("=");
b=n(d[0]);
j=n(d[1]);
m[b]=c||!m[b]?j:[].concat(m[b]).concat(j)
});
return m
},urlAppend:function(b,c){if(!CQ.Ext.isEmpty(c)){return b+(b.indexOf("?")===-1?"?":"&")+c
}return b
},toArray:function(){return Q?function(d,m,g,k){k=[];
for(var c=0,b=d.length;
c<b;
c++){k.push(d[c])
}return k.slice(m||0,g||k.length)
}:function(b,d,c){return Array.prototype.slice.call(b,d||0,c||b.length)
}
}(),isIterable:function(b){if(CQ.Ext.isArray(b)||b.callee){return true
}if(/NodeList|HTMLCollection/.test(R.call(b))){return true
}return((typeof b.nextNode!="undefined"||b.item)&&CQ.Ext.isNumber(b.length))
},each:function(j,g,d){if(CQ.Ext.isEmpty(j,true)){return 
}if(!CQ.Ext.isIterable(j)||CQ.Ext.isPrimitive(j)){j=[j]
}for(var c=0,b=j.length;
c<b;
c++){if(g.call(d||j[c],j[c],c,j)===false){return c
}}},iterate:function(d,c,b){if(CQ.Ext.isEmpty(d)){return 
}if(CQ.Ext.isIterable(d)){CQ.Ext.each(d,c,b);
return 
}else{if(CQ.Ext.isObject(d)){for(var g in d){if(d.hasOwnProperty(g)){if(c.call(b||d,g,d[g],d)===false){return 
}}}}}},getDom:function(c,b){if(!c||!H){return null
}if(c.dom){return c.dom
}else{if(CQ.Ext.isString(c)){var d=H.getElementById(c);
if(d&&Q&&b){if(c==d.getAttribute("id")){return d
}else{return null
}}return d
}else{return c
}}},getBody:function(){return CQ.Ext.get(H.body||H.documentElement)
},removeNode:Q&&!N?function(){var b;
return function(c){if(c&&c.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(c,true):CQ.Ext.EventManager.removeAll(c);
b=b||H.createElement("div");
b.appendChild(c);
b.innerHTML="";
delete CQ.Ext.elCache[c.id]
}}
}():function(b){if(b&&b.parentNode&&b.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(b,true):CQ.Ext.EventManager.removeAll(b);
b.parentNode.removeChild(b);
delete CQ.Ext.elCache[b.id]
}},isEmpty:function(c,b){return c===null||c===undefined||((CQ.Ext.isArray(c)&&!c.length))||(!b?c==="":false)
},isArray:function(b){return R.apply(b)==="[object Array]"
},isDate:function(b){return R.apply(b)==="[object Date]"
},isObject:function(b){return !!b&&Object.prototype.toString.call(b)==="[object Object]"
},isPrimitive:function(b){return CQ.Ext.isString(b)||CQ.Ext.isNumber(b)||CQ.Ext.isBoolean(b)
},isFunction:function(b){return R.apply(b)==="[object Function]"
},isNumber:function(b){return typeof b==="number"&&isFinite(b)
},isString:function(b){return typeof b==="string"
},isBoolean:function(b){return typeof b==="boolean"
},isElement:function(b){return !!b&&b.tagName
},isDefined:function(b){return typeof b!=="undefined"
},isOpera:Z,isWebKit:T,isChrome:G,isSafari:W,isSafari3:B,isSafari4:a,isSafari2:E,isIE:Q,isIE6:P,isIE7:O,isIE8:N,isGecko:M,isGecko2:D,isGecko3:A,isBorderBox:U,isLinux:L,isWindows:Y,isMac:J,isAir:I});
CQ.Ext.ns=CQ.Ext.namespace
})();
CQ.Ext.ns("CQ.Ext.util","CQ.Ext.lib","CQ.Ext.data");
CQ.Ext.elCache={};
CQ.Ext.apply(Function.prototype,{createInterceptor:function(B,A){var C=this;
return !CQ.Ext.isFunction(B)?this:function(){var E=this,D=arguments;
B.target=E;
B.method=C;
return(B.apply(A||E||window,D)!==false)?C.apply(E||window,D):null
}
},createCallback:function(){var A=arguments,B=this;
return function(){return B.apply(window,A)
}
},createDelegate:function(C,B,A){var D=this;
return function(){var F=B||arguments;
if(A===true){F=Array.prototype.slice.call(arguments,0);
F=F.concat(B)
}else{if(CQ.Ext.isNumber(A)){F=Array.prototype.slice.call(arguments,0);
var E=[A,0].concat(B);
Array.prototype.splice.apply(F,E)
}}return D.apply(C||window,F)
}
},defer:function(C,E,B,A){var D=this.createDelegate(E,B,A);
if(C>0){return setTimeout(D,C)
}D();
return 0
}});
CQ.Ext.applyIf(String,{format:function(B){var A=CQ.Ext.toArray(arguments,1);
return B.replace(/\{(\d+)\}/g,function(C,D){return A[D]
})
}});
CQ.Ext.applyIf(Array.prototype,{indexOf:function(B,C){var A=this.length;
C=C||0;
C+=(C<0)?A:0;
for(;
C<A;
++C){if(this[C]===B){return C
}}return -1
},remove:function(B){var A=this.indexOf(B);
if(A!=-1){this.splice(A,1)
}return this
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ns("CQ.Ext.grid","CQ.Ext.list","CQ.Ext.dd","CQ.Ext.tree","CQ.Ext.form","CQ.Ext.menu","CQ.Ext.state","CQ.Ext.layout","CQ.Ext.app","CQ.Ext.ux","CQ.Ext.chart","CQ.Ext.direct");
CQ.Ext.apply(CQ.Ext,function(){var C=CQ.Ext,A=0,B=null;
return{emptyFn:function(){},BLANK_IMAGE_URL:CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isAir?"http://extjs.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",extendX:function(D,E){return CQ.Ext.extend(D,E(D.prototype))
},getDoc:function(){return CQ.Ext.get(document)
},num:function(E,D){E=Number(CQ.Ext.isEmpty(E)||CQ.Ext.isArray(E)||CQ.Ext.isBoolean(E)||(CQ.Ext.isString(E)&&E.trim().length==0)?NaN:E);
return isNaN(E)?D:E
},value:function(F,D,E){return CQ.Ext.isEmpty(F,E)?D:F
},escapeRe:function(D){return D.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")
},sequence:function(G,D,F,E){G[D]=G[D].createSequence(F,E)
},addBehaviors:function(H){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.addBehaviors(H)
})
}else{var E={},G,D,F;
for(D in H){if((G=D.split("@"))[1]){F=G[0];
if(!E[F]){E[F]=CQ.Ext.select(F)
}E[F].on(G[1],H[D])
}}E=null
}},getScrollBarWidth:function(F){if(!CQ.Ext.isReady){return 0
}if(F===true||B===null){var H=CQ.Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),G=H.child("div",true);
var E=G.offsetWidth;
H.setStyle("overflow",(CQ.Ext.isWebKit||CQ.Ext.isGecko)?"auto":"scroll");
var D=G.offsetWidth;
H.remove();
B=E-D+2
}return B
},combine:function(){var F=arguments,E=F.length,H=[];
for(var G=0;
G<E;
G++){var D=F[G];
if(CQ.Ext.isArray(D)){H=H.concat(D)
}else{if(D.length!==undefined&&!D.substr){H=H.concat(Array.prototype.slice.call(D,0))
}else{H.push(D)
}}}return H
},copyTo:function(D,E,F){if(CQ.Ext.isString(F)){F=F.split(/[,;\s]/)
}CQ.Ext.each(F,function(G){if(E.hasOwnProperty(G)){D[G]=E[G]
}},this);
return D
},destroy:function(){CQ.Ext.each(arguments,function(D){if(D){if(CQ.Ext.isArray(D)){this.destroy.apply(this,D)
}else{if(CQ.Ext.isFunction(D.destroy)){D.destroy()
}else{if(D.dom){D.remove()
}}}}},this)
},destroyMembers:function(J,H,F,G){for(var I=1,E=arguments,D=E.length;
I<D;
I++){CQ.Ext.destroy(J[E[I]]);
delete J[E[I]]
}},clean:function(D){var E=[];
CQ.Ext.each(D,function(F){if(!!F){E.push(F)
}});
return E
},unique:function(D){var E=[],F={};
CQ.Ext.each(D,function(G){if(!F[G]){E.push(G)
}F[G]=true
});
return E
},flatten:function(D){var F=[];
function E(G){CQ.Ext.each(G,function(H){if(CQ.Ext.isArray(H)){E(H)
}else{F.push(H)
}});
return F
}return E(D)
},min:function(D,E){var F=D[0];
E=E||function(H,G){return H<G?-1:1
};
CQ.Ext.each(D,function(G){F=E(F,G)==-1?F:G
});
return F
},max:function(D,E){var F=D[0];
E=E||function(H,G){return H>G?1:-1
};
CQ.Ext.each(D,function(G){F=E(F,G)==1?F:G
});
return F
},mean:function(D){return D.length>0?CQ.Ext.sum(D)/D.length:undefined
},sum:function(D){var E=0;
CQ.Ext.each(D,function(F){E+=F
});
return E
},partition:function(D,E){var F=[[],[]];
CQ.Ext.each(D,function(H,I,G){F[(E&&E(H,I,G))||(!E&&H)?0:1].push(H)
});
return F
},invoke:function(D,E){var G=[],F=Array.prototype.slice.call(arguments,2);
CQ.Ext.each(D,function(H,I){if(H&&CQ.Ext.isFunction(H[E])){G.push(H[E].apply(H,F))
}else{G.push(undefined)
}});
return G
},pluck:function(D,F){var E=[];
CQ.Ext.each(D,function(G){E.push(G[F])
});
return E
},zip:function(){var K=CQ.Ext.partition(arguments,function(L){return !CQ.Ext.isFunction(L)
}),H=K[0],J=K[1][0],D=CQ.Ext.max(CQ.Ext.pluck(H,"length")),G=[];
for(var I=0;
I<D;
I++){G[I]=[];
if(J){G[I]=J.apply(J,CQ.Ext.pluck(H,I))
}else{for(var F=0,E=H.length;
F<E;
F++){G[I].push(H[F][I])
}}}return G
},getCmp:function(D){return CQ.Ext.ComponentMgr.get(D)
},useShims:C.isIE6||(C.isMac&&C.isGecko2),type:function(E){if(E===undefined||E===null){return false
}if(E.htmlElement){return"element"
}var D=typeof E;
if(D=="object"&&E.nodeName){switch(E.nodeType){case 1:return"element";
case 3:return(/\S/).test(E.nodeValue)?"textnode":"whitespace"
}}if(D=="object"||D=="function"){switch(E.constructor){case Array:return"array";
case RegExp:return"regexp";
case Date:return"date"
}if(CQ.Ext.isNumber(E.length)&&CQ.Ext.isFunction(E.item)){return"nodelist"
}}return D
},intercept:function(G,D,F,E){G[D]=G[D].createInterceptor(F,E)
},callback:function(D,G,F,E){if(CQ.Ext.isFunction(D)){if(E){D.defer(E,G,F||[])
}else{D.apply(G,F||[])
}}}}
}());
CQ.Ext.apply(Function.prototype,{createSequence:function(B,A){var C=this;
return !CQ.Ext.isFunction(B)?this:function(){var D=C.apply(this||window,arguments);
B.apply(A||this||window,arguments);
return D
}
}});
CQ.Ext.applyIf(String,{escape:function(A){return A.replace(/('|\\)/g,"\\$1")
},leftPad:function(D,B,C){var A=String(D);
if(!C){C=" "
}while(A.length<B){A=C+A
}return A
}});
String.prototype.toggle=function(B,A){return this==B?A:B
};
String.prototype.trim=function(){var A=/^\s+|\s+$/g;
return function(){return this.replace(A,"")
}
}();
Date.prototype.getElapsed=function(A){return Math.abs((A||new Date()).getTime()-this.getTime())
};
CQ.Ext.applyIf(Number.prototype,{constrain:function(B,A){return Math.min(Math.max(this,B),A)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.TaskRunner=function(E){E=E||10;
var F=[],A=[],B=0,G=false,D=function(){G=false;
clearInterval(B);
B=0
},H=function(){if(!G){G=true;
B=setInterval(I,E)
}},C=function(J){A.push(J);
if(J.onStop){J.onStop.apply(J.scope||J)
}},I=function(){var L=A.length,N=new Date().getTime();
if(L>0){for(var P=0;
P<L;
P++){F.remove(A[P])
}A=[];
if(F.length<1){D();
return 
}}for(var P=0,O,K,M,J=F.length;
P<J;
++P){O=F[P];
K=N-O.taskRunTime;
if(O.interval<=K){M=O.run.apply(O.scope||O,O.args||[++O.taskRunCount]);
O.taskRunTime=N;
if(M===false||O.taskRunCount===O.repeat){C(O);
return 
}}if(O.duration&&O.duration<=(N-O.taskStartTime)){C(O)
}}};
this.start=function(J){F.push(J);
J.taskStartTime=new Date().getTime();
J.taskRunTime=0;
J.taskRunCount=0;
H();
return J
};
this.stop=function(J){C(J);
return J
};
this.stopAll=function(){D();
for(var K=0,J=F.length;
K<J;
K++){if(F[K].onStop){F[K].onStop()
}}F=[];
A=[]
}
};
CQ.Ext.TaskMgr=new CQ.Ext.util.TaskRunner();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
window.undefined=window.undefined;
CQ.Ext={version:"3.1.1"};
CQ.Ext.apply=function(C,D,B){if(B){CQ.Ext.apply(C,B)
}if(C&&D&&typeof D=="object"){for(var A in D){C[A]=D[A]
}}return C
};
(function(){var F=0,R=Object.prototype.toString,S=navigator.userAgent.toLowerCase(),X=function(b){return b.test(S)
},H=document,K=H.compatMode=="CSS1Compat",Z=X(/opera/),G=X(/\bchrome\b/),T=X(/webkit/),W=!G&&X(/safari/),E=W&&X(/applewebkit\/4/),B=W&&X(/version\/3/),a=W&&X(/version\/4/),Q=!Z&&X(/msie/),O=Q&&X(/msie 7/),N=Q&&X(/msie 8/),P=Q&&!O&&!N,M=!T&&X(/gecko/),D=M&&X(/rv:1\.8/),A=M&&X(/rv:1\.9/),U=Q&&!K,Y=X(/windows|win32/),J=X(/macintosh|mac os x/),I=X(/adobeair/),L=X(/linux/),C=/^https/i.test(window.location.protocol);
if(P){try{H.execCommand("BackgroundImageCache",false,true)
}catch(V){}}CQ.Ext.apply(CQ.Ext,{SSL_SECURE_URL:C&&Q?'javascript:""':"about:blank",isStrict:K,isSecure:C,isReady:false,enableGarbageCollector:true,enableListenerCollection:false,enableNestedListenerRemoval:false,USE_NATIVE_JSON:false,applyIf:function(d,g){if(d){for(var b in g){if(!CQ.Ext.isDefined(d[b])){d[b]=g[b]
}}}return d
},id:function(b,c){b=CQ.Ext.getDom(b,true)||{};
if(!b.id){b.id=(c||"cq-gen")+(++F)
}return b.id
},extend:function(){var c=function(g){for(var d in g){this[d]=g[d]
}};
var b=Object.prototype.constructor;
return function(n,j,m){if(CQ.Ext.isObject(j)){m=j;
j=n;
n=m.constructor!=b?m.constructor:function(){j.apply(this,arguments)
}
}var g=function(){},k,d=j.prototype;
g.prototype=d;
k=n.prototype=new g();
k.constructor=n;
n.superclass=d;
if(d.constructor==b){d.constructor=j
}n.override=function(q){CQ.Ext.override(n,q)
};
k.superclass=k.supr=(function(){return d
});
k.override=c;
CQ.Ext.override(n,m);
n.extend=function(q){return CQ.Ext.extend(n,q)
};
return n
}
}(),override:function(b,d){if(d){var c=b.prototype;
CQ.Ext.apply(c,d);
if(CQ.Ext.isIE&&d.hasOwnProperty("toString")){c.toString=d.toString
}}},namespace:function(){var c,b;
CQ.Ext.each(arguments,function(d){b=d.split(".");
c=window[b[0]]=window[b[0]]||{};
CQ.Ext.each(b.slice(1),function(g){c=c[g]=c[g]||{}
})
});
return c
},urlEncode:function(j,g){var c,b=[],d=encodeURIComponent;
CQ.Ext.iterate(j,function(k,m){c=CQ.Ext.isEmpty(m);
CQ.Ext.each(c?k:m,function(n){b.push("&",d(k),"=",(!CQ.Ext.isEmpty(n)&&(n!=k||!c))?(CQ.Ext.isDate(n)?CQ.Ext.encode(n).replace(/"/g,""):d(n)):"")
})
});
if(!g){b.shift();
g=""
}return g+b.join("")
},urlDecode:function(g,c){if(CQ.Ext.isEmpty(g)){return{}
}var m={},k=g.split("&"),n=decodeURIComponent,b,j;
CQ.Ext.each(k,function(d){d=d.split("=");
b=n(d[0]);
j=n(d[1]);
m[b]=c||!m[b]?j:[].concat(m[b]).concat(j)
});
return m
},urlAppend:function(b,c){if(!CQ.Ext.isEmpty(c)){return b+(b.indexOf("?")===-1?"?":"&")+c
}return b
},toArray:function(){return Q?function(d,m,g,k){k=[];
for(var c=0,b=d.length;
c<b;
c++){k.push(d[c])
}return k.slice(m||0,g||k.length)
}:function(b,d,c){return Array.prototype.slice.call(b,d||0,c||b.length)
}
}(),isIterable:function(b){if(CQ.Ext.isArray(b)||b.callee){return true
}if(/NodeList|HTMLCollection/.test(R.call(b))){return true
}return((typeof b.nextNode!="undefined"||b.item)&&CQ.Ext.isNumber(b.length))
},each:function(j,g,d){if(CQ.Ext.isEmpty(j,true)){return 
}if(!CQ.Ext.isIterable(j)||CQ.Ext.isPrimitive(j)){j=[j]
}for(var c=0,b=j.length;
c<b;
c++){if(g.call(d||j[c],j[c],c,j)===false){return c
}}},iterate:function(d,c,b){if(CQ.Ext.isEmpty(d)){return 
}if(CQ.Ext.isIterable(d)){CQ.Ext.each(d,c,b);
return 
}else{if(CQ.Ext.isObject(d)){for(var g in d){if(d.hasOwnProperty(g)){if(c.call(b||d,g,d[g],d)===false){return 
}}}}}},getDom:function(c,b){if(!c||!H){return null
}if(c.dom){return c.dom
}else{if(CQ.Ext.isString(c)){var d=H.getElementById(c);
if(d&&Q&&b){if(c==d.getAttribute("id")){return d
}else{return null
}}return d
}else{return c
}}},getBody:function(){return CQ.Ext.get(H.body||H.documentElement)
},removeNode:Q&&!N?function(){var b;
return function(c){if(c&&c.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(c,true):CQ.Ext.EventManager.removeAll(c);
b=b||H.createElement("div");
b.appendChild(c);
b.innerHTML="";
delete CQ.Ext.elCache[c.id]
}}
}():function(b){if(b&&b.parentNode&&b.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(b,true):CQ.Ext.EventManager.removeAll(b);
b.parentNode.removeChild(b);
delete CQ.Ext.elCache[b.id]
}},isEmpty:function(c,b){return c===null||c===undefined||((CQ.Ext.isArray(c)&&!c.length))||(!b?c==="":false)
},isArray:function(b){return R.apply(b)==="[object Array]"
},isDate:function(b){return R.apply(b)==="[object Date]"
},isObject:function(b){return !!b&&Object.prototype.toString.call(b)==="[object Object]"
},isPrimitive:function(b){return CQ.Ext.isString(b)||CQ.Ext.isNumber(b)||CQ.Ext.isBoolean(b)
},isFunction:function(b){return R.apply(b)==="[object Function]"
},isNumber:function(b){return typeof b==="number"&&isFinite(b)
},isString:function(b){return typeof b==="string"
},isBoolean:function(b){return typeof b==="boolean"
},isElement:function(b){return !!b&&b.tagName
},isDefined:function(b){return typeof b!=="undefined"
},isOpera:Z,isWebKit:T,isChrome:G,isSafari:W,isSafari3:B,isSafari4:a,isSafari2:E,isIE:Q,isIE6:P,isIE7:O,isIE8:N,isGecko:M,isGecko2:D,isGecko3:A,isBorderBox:U,isLinux:L,isWindows:Y,isMac:J,isAir:I});
CQ.Ext.ns=CQ.Ext.namespace
})();
CQ.Ext.ns("CQ.Ext.util","CQ.Ext.lib","CQ.Ext.data");
CQ.Ext.elCache={};
CQ.Ext.apply(Function.prototype,{createInterceptor:function(B,A){var C=this;
return !CQ.Ext.isFunction(B)?this:function(){var E=this,D=arguments;
B.target=E;
B.method=C;
return(B.apply(A||E||window,D)!==false)?C.apply(E||window,D):null
}
},createCallback:function(){var A=arguments,B=this;
return function(){return B.apply(window,A)
}
},createDelegate:function(C,B,A){var D=this;
return function(){var F=B||arguments;
if(A===true){F=Array.prototype.slice.call(arguments,0);
F=F.concat(B)
}else{if(CQ.Ext.isNumber(A)){F=Array.prototype.slice.call(arguments,0);
var E=[A,0].concat(B);
Array.prototype.splice.apply(F,E)
}}return D.apply(C||window,F)
}
},defer:function(C,E,B,A){var D=this.createDelegate(E,B,A);
if(C>0){return setTimeout(D,C)
}D();
return 0
}});
CQ.Ext.applyIf(String,{format:function(B){var A=CQ.Ext.toArray(arguments,1);
return B.replace(/\{(\d+)\}/g,function(C,D){return A[D]
})
}});
CQ.Ext.applyIf(Array.prototype,{indexOf:function(B,C){var A=this.length;
C=C||0;
C+=(C<0)?A:0;
for(;
C<A;
++C){if(this[C]===B){return C
}}return -1
},remove:function(B){var A=this.indexOf(B);
if(A!=-1){this.splice(A,1)
}return this
}});
CQ.Ext.ns("CQ.Ext.grid","CQ.Ext.list","CQ.Ext.dd","CQ.Ext.tree","CQ.Ext.form","CQ.Ext.menu","CQ.Ext.state","CQ.Ext.layout","CQ.Ext.app","CQ.Ext.ux","CQ.Ext.chart","CQ.Ext.direct");
CQ.Ext.apply(CQ.Ext,function(){var C=CQ.Ext,A=0,B=null;
return{emptyFn:function(){},BLANK_IMAGE_URL:CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isAir?"http://extjs.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",extendX:function(D,E){return CQ.Ext.extend(D,E(D.prototype))
},getDoc:function(){return CQ.Ext.get(document)
},num:function(E,D){E=Number(CQ.Ext.isEmpty(E)||CQ.Ext.isArray(E)||CQ.Ext.isBoolean(E)||(CQ.Ext.isString(E)&&E.trim().length==0)?NaN:E);
return isNaN(E)?D:E
},value:function(F,D,E){return CQ.Ext.isEmpty(F,E)?D:F
},escapeRe:function(D){return D.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")
},sequence:function(G,D,F,E){G[D]=G[D].createSequence(F,E)
},addBehaviors:function(H){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.addBehaviors(H)
})
}else{var E={},G,D,F;
for(D in H){if((G=D.split("@"))[1]){F=G[0];
if(!E[F]){E[F]=CQ.Ext.select(F)
}E[F].on(G[1],H[D])
}}E=null
}},getScrollBarWidth:function(F){if(!CQ.Ext.isReady){return 0
}if(F===true||B===null){var H=CQ.Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),G=H.child("div",true);
var E=G.offsetWidth;
H.setStyle("overflow",(CQ.Ext.isWebKit||CQ.Ext.isGecko)?"auto":"scroll");
var D=G.offsetWidth;
H.remove();
B=E-D+2
}return B
},combine:function(){var F=arguments,E=F.length,H=[];
for(var G=0;
G<E;
G++){var D=F[G];
if(CQ.Ext.isArray(D)){H=H.concat(D)
}else{if(D.length!==undefined&&!D.substr){H=H.concat(Array.prototype.slice.call(D,0))
}else{H.push(D)
}}}return H
},copyTo:function(D,E,F){if(CQ.Ext.isString(F)){F=F.split(/[,;\s]/)
}CQ.Ext.each(F,function(G){if(E.hasOwnProperty(G)){D[G]=E[G]
}},this);
return D
},destroy:function(){CQ.Ext.each(arguments,function(D){if(D){if(CQ.Ext.isArray(D)){this.destroy.apply(this,D)
}else{if(CQ.Ext.isFunction(D.destroy)){D.destroy()
}else{if(D.dom){D.remove()
}}}}},this)
},destroyMembers:function(J,H,F,G){for(var I=1,E=arguments,D=E.length;
I<D;
I++){CQ.Ext.destroy(J[E[I]]);
delete J[E[I]]
}},clean:function(D){var E=[];
CQ.Ext.each(D,function(F){if(!!F){E.push(F)
}});
return E
},unique:function(D){var E=[],F={};
CQ.Ext.each(D,function(G){if(!F[G]){E.push(G)
}F[G]=true
});
return E
},flatten:function(D){var F=[];
function E(G){CQ.Ext.each(G,function(H){if(CQ.Ext.isArray(H)){E(H)
}else{F.push(H)
}});
return F
}return E(D)
},min:function(D,E){var F=D[0];
E=E||function(H,G){return H<G?-1:1
};
CQ.Ext.each(D,function(G){F=E(F,G)==-1?F:G
});
return F
},max:function(D,E){var F=D[0];
E=E||function(H,G){return H>G?1:-1
};
CQ.Ext.each(D,function(G){F=E(F,G)==1?F:G
});
return F
},mean:function(D){return D.length>0?CQ.Ext.sum(D)/D.length:undefined
},sum:function(D){var E=0;
CQ.Ext.each(D,function(F){E+=F
});
return E
},partition:function(D,E){var F=[[],[]];
CQ.Ext.each(D,function(H,I,G){F[(E&&E(H,I,G))||(!E&&H)?0:1].push(H)
});
return F
},invoke:function(D,E){var G=[],F=Array.prototype.slice.call(arguments,2);
CQ.Ext.each(D,function(H,I){if(H&&CQ.Ext.isFunction(H[E])){G.push(H[E].apply(H,F))
}else{G.push(undefined)
}});
return G
},pluck:function(D,F){var E=[];
CQ.Ext.each(D,function(G){E.push(G[F])
});
return E
},zip:function(){var K=CQ.Ext.partition(arguments,function(L){return !CQ.Ext.isFunction(L)
}),H=K[0],J=K[1][0],D=CQ.Ext.max(CQ.Ext.pluck(H,"length")),G=[];
for(var I=0;
I<D;
I++){G[I]=[];
if(J){G[I]=J.apply(J,CQ.Ext.pluck(H,I))
}else{for(var F=0,E=H.length;
F<E;
F++){G[I].push(H[F][I])
}}}return G
},getCmp:function(D){return CQ.Ext.ComponentMgr.get(D)
},useShims:C.isIE6||(C.isMac&&C.isGecko2),type:function(E){if(E===undefined||E===null){return false
}if(E.htmlElement){return"element"
}var D=typeof E;
if(D=="object"&&E.nodeName){switch(E.nodeType){case 1:return"element";
case 3:return(/\S/).test(E.nodeValue)?"textnode":"whitespace"
}}if(D=="object"||D=="function"){switch(E.constructor){case Array:return"array";
case RegExp:return"regexp";
case Date:return"date"
}if(CQ.Ext.isNumber(E.length)&&CQ.Ext.isFunction(E.item)){return"nodelist"
}}return D
},intercept:function(G,D,F,E){G[D]=G[D].createInterceptor(F,E)
},callback:function(D,G,F,E){if(CQ.Ext.isFunction(D)){if(E){D.defer(E,G,F||[])
}else{D.apply(G,F||[])
}}}}
}());
CQ.Ext.apply(Function.prototype,{createSequence:function(B,A){var C=this;
return !CQ.Ext.isFunction(B)?this:function(){var D=C.apply(this||window,arguments);
B.apply(A||this||window,arguments);
return D
}
}});
CQ.Ext.applyIf(String,{escape:function(A){return A.replace(/('|\\)/g,"\\$1")
},leftPad:function(D,B,C){var A=String(D);
if(!C){C=" "
}while(A.length<B){A=C+A
}return A
}});
String.prototype.toggle=function(B,A){return this==B?A:B
};
String.prototype.trim=function(){var A=/^\s+|\s+$/g;
return function(){return this.replace(A,"")
}
}();
Date.prototype.getElapsed=function(A){return Math.abs((A||new Date()).getTime()-this.getTime())
};
CQ.Ext.applyIf(Number.prototype,{constrain:function(B,A){return Math.min(Math.max(this,B),A)
}});
CQ.Ext.util.TaskRunner=function(E){E=E||10;
var F=[],A=[],B=0,G=false,D=function(){G=false;
clearInterval(B);
B=0
},H=function(){if(!G){G=true;
B=setInterval(I,E)
}},C=function(J){A.push(J);
if(J.onStop){J.onStop.apply(J.scope||J)
}},I=function(){var L=A.length,N=new Date().getTime();
if(L>0){for(var P=0;
P<L;
P++){F.remove(A[P])
}A=[];
if(F.length<1){D();
return 
}}for(var P=0,O,K,M,J=F.length;
P<J;
++P){O=F[P];
K=N-O.taskRunTime;
if(O.interval<=K){M=O.run.apply(O.scope||O,O.args||[++O.taskRunCount]);
O.taskRunTime=N;
if(M===false||O.taskRunCount===O.repeat){C(O);
return 
}}if(O.duration&&O.duration<=(N-O.taskStartTime)){C(O)
}}};
this.start=function(J){F.push(J);
J.taskStartTime=new Date().getTime();
J.taskRunTime=0;
J.taskRunCount=0;
H();
return J
};
this.stop=function(J){C(J);
return J
};
this.stopAll=function(){D();
for(var K=0,J=F.length;
K<J;
K++){if(F[K].onStop){F[K].onStop()
}}F=[];
A=[]
}
};
CQ.Ext.TaskMgr=new CQ.Ext.util.TaskRunner();
(function(){var B;
function C(D){if(!B){B=new CQ.Ext.Element.Flyweight()
}B.dom=D;
return B
}(function(){var G=document,E=G.compatMode=="CSS1Compat",F=Math.max,D=Math.round,H=parseInt;
CQ.Ext.lib.Dom={isAncestor:function(J,K){var I=false;
J=CQ.Ext.getDom(J);
K=CQ.Ext.getDom(K);
if(J&&K){if(J.contains){return J.contains(K)
}else{if(J.compareDocumentPosition){return !!(J.compareDocumentPosition(K)&16)
}else{while(K=K.parentNode){I=K==J||I
}}}}return I
},getViewWidth:function(I){return I?this.getDocumentWidth():this.getViewportWidth()
},getViewHeight:function(I){return I?this.getDocumentHeight():this.getViewportHeight()
},getDocumentHeight:function(){return F(!E?G.body.scrollHeight:G.documentElement.scrollHeight,this.getViewportHeight())
},getDocumentWidth:function(){return F(!E?G.body.scrollWidth:G.documentElement.scrollWidth,this.getViewportWidth())
},getViewportHeight:function(){return CQ.Ext.isIE?(CQ.Ext.isStrict?G.documentElement.clientHeight:G.body.clientHeight):self.innerHeight
},getViewportWidth:function(){return !CQ.Ext.isStrict&&!CQ.Ext.isOpera?G.body.clientWidth:CQ.Ext.isIE?G.documentElement.clientWidth:self.innerWidth
},getY:function(I){return this.getXY(I)[1]
},getX:function(I){return this.getXY(I)[0]
},getXY:function(K){var J,P,R,U,L,M,T=0,Q=0,S,I,N=(G.body||G.documentElement),O=[0,0];
K=CQ.Ext.getDom(K);
if(K!=N){if(K.getBoundingClientRect){R=K.getBoundingClientRect();
S=C(document).getScroll();
O=[D(R.left+S.left),D(R.top+S.top)]
}else{J=K;
I=C(K).isStyle("position","absolute");
while(J){P=C(J);
T+=J.offsetLeft;
Q+=J.offsetTop;
I=I||P.isStyle("position","absolute");
if(CQ.Ext.isGecko){Q+=U=H(P.getStyle("borderTopWidth"),10)||0;
T+=L=H(P.getStyle("borderLeftWidth"),10)||0;
if(J!=K&&!P.isStyle("overflow","visible")){T+=L;
Q+=U
}}J=J.offsetParent
}if(CQ.Ext.isSafari&&I){T-=N.offsetLeft;
Q-=N.offsetTop
}if(CQ.Ext.isGecko&&!I){M=C(N);
T+=H(M.getStyle("borderLeftWidth"),10)||0;
Q+=H(M.getStyle("borderTopWidth"),10)||0
}J=K.parentNode;
while(J&&J!=N){if(!CQ.Ext.isOpera||(J.tagName!="TR"&&!C(J).isStyle("display","inline"))){T-=J.scrollLeft;
Q-=J.scrollTop
}J=J.parentNode
}O=[T,Q]
}}return O
},setXY:function(J,K){(J=CQ.Ext.fly(J,"_setXY")).position();
var L=J.translatePoints(K),I=J.dom.style,M;
for(M in L){if(!isNaN(L[M])){I[M]=L[M]+"px"
}}},setX:function(J,I){this.setXY(J,[I,false])
},setY:function(I,J){this.setXY(I,[false,J])
}}
})();
CQ.Ext.lib.Dom.getRegion=function(D){return CQ.Ext.lib.Region.getRegion(D)
};
CQ.Ext.lib.Event=function(){var W=false,G={},a=0,P=[],D,c=false,K=window,k=document,L=200,S=20,b=0,R=0,I=1,M=2,T=2,X=3,U="scrollLeft",Q="scrollTop",F="unload",Z="mouseover",j="mouseout",E=function(){var m;
if(K.addEventListener){m=function(r,o,q,n){if(o=="mouseenter"){q=q.createInterceptor(O);
r.addEventListener(Z,q,(n))
}else{if(o=="mouseleave"){q=q.createInterceptor(O);
r.addEventListener(j,q,(n))
}else{r.addEventListener(o,q,(n))
}}return q
}
}else{if(K.attachEvent){m=function(r,o,q,n){r.attachEvent("on"+o,q);
return q
}
}else{m=function(){}
}}return m
}(),H=function(){var m;
if(K.removeEventListener){m=function(r,o,q,n){if(o=="mouseenter"){o=Z
}else{if(o=="mouseleave"){o=j
}}r.removeEventListener(o,q,(n))
}
}else{if(K.detachEvent){m=function(q,n,o){q.detachEvent("on"+n,o)
}
}else{m=function(){}
}}return m
}();
function O(m){return !V(m.currentTarget,Y.getRelatedTarget(m))
}function V(m,n){if(m&&m.firstChild){while(n){if(n===m){return true
}n=n.parentNode;
if(n&&(n.nodeType!=1)){n=null
}}}return false
}function d(){var o=false,u=[],r,q,m,n,t=!W||(a>0);
if(!c){c=true;
for(q=0,m=P.length;
q<m;
q++){n=P[q];
if(n&&(r=k.getElementById(n.id))){if(!n.checkReady||W||r.nextSibling||(k&&k.body)){r=n.override?(n.override===true?n.obj:n.override):r;
n.fn.call(r,n.obj);
P.remove(n)
}else{u.push(n)
}}}a=(u.length===0)?0:a-1;
if(t){N()
}else{clearInterval(D);
D=null
}o=!(c=false)
}return o
}function N(){if(!D){var m=function(){d()
};
D=setInterval(m,S)
}}function g(){var m=k.documentElement,n=k.body;
if(m&&(m[Q]||m[U])){return[m[U],m[Q]]
}else{if(n){return[n[U],n[Q]]
}else{return[0,0]
}}}function J(m,n){m=m.browserEvent||m;
var o=m["page"+n];
if(!o&&o!==0){o=m["client"+n]||0;
if(CQ.Ext.isIE){o+=g()[n=="X"?0:1]
}}return o
}var Y={extAdapter:true,onAvailable:function(o,m,q,n){P.push({id:o,fn:m,obj:q,override:n,checkReady:false});
a=L;
N()
},addListener:function(o,m,n){o=CQ.Ext.getDom(o);
if(o&&n){if(m==F){if(G[o.id]===undefined){G[o.id]=[]
}G[o.id].push([m,n]);
return n
}return E(o,m,n,false)
}return false
},removeListener:function(u,o,t){u=CQ.Ext.getDom(u);
var r,n,m,q;
if(u&&t){if(o==F){if((q=G[u.id])!==undefined){for(r=0,n=q.length;
r<n;
r++){if((m=q[r])&&m[R]==o&&m[I]==t){G[u.id].splice(r,1)
}}}return 
}H(u,o,t,false)
}},getTarget:function(m){m=m.browserEvent||m;
return this.resolveTextNode(m.target||m.srcElement)
},resolveTextNode:CQ.Ext.isGecko?function(n){if(!n){return 
}var m=HTMLElement.prototype.toString.call(n);
if(m=="[xpconnect wrapped native prototype]"||m=="[object XULElement]"){return 
}return n.nodeType==3?n.parentNode:n
}:function(m){return m&&m.nodeType==3?m.parentNode:m
},getRelatedTarget:function(m){m=m.browserEvent||m;
return this.resolveTextNode(m.relatedTarget||(m.type==j?m.toElement:m.type==Z?m.fromElement:null))
},getPageX:function(m){return J(m,"X")
},getPageY:function(m){return J(m,"Y")
},getXY:function(m){return[this.getPageX(m),this.getPageY(m)]
},stopEvent:function(m){this.stopPropagation(m);
this.preventDefault(m)
},stopPropagation:function(m){m=m.browserEvent||m;
if(m.stopPropagation){m.stopPropagation()
}else{m.cancelBubble=true
}},preventDefault:function(m){m=m.browserEvent||m;
if(m.preventDefault){m.preventDefault()
}else{m.returnValue=false
}},getEvent:function(m){m=m||K.event;
if(!m){var n=this.getEvent.caller;
while(n){m=n.arguments[0];
if(m&&Event==m.constructor){break
}n=n.caller
}}return m
},getCharCode:function(m){m=m.browserEvent||m;
return m.charCode||m.keyCode||0
},getListeners:function(n,m){CQ.Ext.EventManager.getListeners(n,m)
},purgeElement:function(n,o,m){CQ.Ext.EventManager.purgeElement(n,o,m)
},_load:function(n){W=true;
var m=CQ.Ext.lib.Event;
if(CQ.Ext.isIE&&n!==true){H(K,"load",arguments.callee)
}},_unload:function(w){var n=CQ.Ext.lib.Event,r,q,o,z,x,m,u,t,AA;
for(m in G){x=G[m];
for(r=0,u=x.length;
r<u;
r++){z=x[r];
if(z){try{AA=z[X]?(z[X]===true?z[T]:z[X]):K;
z[I].call(AA,n.getEvent(w),z[T])
}catch(y){}}}}G=null;
CQ.Ext.EventManager._unload();
H(K,F,n._unload)
}};
Y.on=Y.addListener;
Y.un=Y.removeListener;
if(k&&k.body){Y._load(true)
}else{E(K,"load",Y._load)
}E(K,F,Y._unload);
d();
return Y
}();
CQ.Ext.lib.Ajax=function(){var G=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],D="Content-Type";
function H(S){var R=S.conn,T;
function Q(U,V){for(T in V){if(V.hasOwnProperty(T)){U.setRequestHeader(T,V[T])
}}}if(K.defaultHeaders){Q(R,K.defaultHeaders)
}if(K.headers){Q(R,K.headers);
delete K.headers
}}function E(T,S,R,Q){return{tId:T,status:R?-1:0,statusText:R?"transaction aborted":"communication failure",isAbort:R,isTimeout:Q,argument:S}
}function J(Q,R){(K.headers=K.headers||{})[Q]=R
}function O(X,V){var R={},T,U=X.conn,Q,S;
try{T=X.conn.getAllResponseHeaders();
CQ.Ext.each(T.replace(/\r\n/g,"\n").split("\n"),function(Y){Q=Y.indexOf(":");
if(Q>=0){S=Y.substr(0,Q).toLowerCase();
if(Y.charAt(Q+1)==" "){++Q
}R[S]=Y.substr(Q+1)
}})
}catch(W){}return{tId:X.tId,status:U.status,statusText:U.statusText,getResponseHeader:function(Y){return R[Y.toLowerCase()]
},getAllResponseHeaders:function(){return T
},responseText:U.responseText,responseXML:U.responseXML,argument:V}
}function N(Q){Q.conn=null;
Q=null
}function F(V,W,R,Q){if(!W){N(V);
return 
}var T,S;
try{if(V.conn.status!==undefined&&V.conn.status!=0){T=V.conn.status
}else{T=13030
}}catch(U){T=13030
}if((T>=200&&T<300)||(CQ.Ext.isIE&&T==1223)){S=O(V,W.argument);
if(W.success){if(!W.scope){W.success(S)
}else{W.success.apply(W.scope,[S])
}}}else{switch(T){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:S=E(V.tId,W.argument,(R?R:false),Q);
if(W.failure){if(!W.scope){W.failure(S)
}else{W.failure.apply(W.scope,[S])
}}break;
default:S=O(V,W.argument);
if(W.failure){if(!W.scope){W.failure(S)
}else{W.failure.apply(W.scope,[S])
}}}}N(V);
S=null
}function M(S,V){V=V||{};
var Q=S.conn,U=S.tId,R=K.poll,T=V.timeout||null;
if(T){K.timeout[U]=setTimeout(function(){K.abort(S,V,true)
},T)
}R[U]=setInterval(function(){if(Q&&Q.readyState==4){clearInterval(R[U]);
R[U]=null;
if(T){clearTimeout(K.timeout[U]);
K.timeout[U]=null
}F(S,V)
}},K.pollInterval)
}function I(U,R,T,Q){var S=L()||null;
if(S){S.conn.open(U,R,true);
if(K.useDefaultXhrHeader){J("X-Requested-With",K.defaultXhrHeader)
}if(Q&&K.useDefaultHeader&&(!K.headers||!K.headers[D])){J(D,K.defaultPostHeader)
}if(K.defaultHeaders||K.headers){H(S)
}M(S,T);
S.conn.send(Q||null)
}return S
}function L(){var R;
try{if(R=P(K.transactionId)){K.transactionId++
}}catch(Q){}finally{return R
}}function P(T){var Q;
try{Q=new XMLHttpRequest()
}catch(S){for(var R=0;
R<G.length;
++R){try{Q=new ActiveXObject(G[R]);
break
}catch(S){}}}finally{return{conn:Q,tId:T}
}}var K={request:function(Q,S,T,U,Y){if(Y){var V=this,R=Y.xmlData,W=Y.jsonData,X;
CQ.Ext.applyIf(V,Y);
if(R||W){X=V.headers;
if(!X||!X[D]){J(D,R?"text/xml":"application/json")
}U=R||(!CQ.Ext.isPrimitive(W)?CQ.Ext.encode(W):W)
}}return I(Q||Y.method||"POST",S,T,U)
},serializeForm:function(R){var S=R.elements||(document.forms[R]||CQ.Ext.getDom(R)).elements,Y=false,X=encodeURIComponent,V,Z,Q,T,U="",W;
CQ.Ext.each(S,function(a){Q=a.name;
W=a.type;
if(!a.disabled&&Q){if(/select-(one|multiple)/i.test(W)){CQ.Ext.each(a.options,function(b){if(b.selected){U+=String.format("{0}={1}&",X(Q),X((b.hasAttribute?b.hasAttribute("value"):b.getAttribute("value")!==null)?b.value:b.text))
}})
}else{if(!/file|undefined|reset|button/i.test(W)){if(!(/radio|checkbox/i.test(W)&&!a.checked)&&!(W=="submit"&&Y)){U+=X(Q)+"="+X(a.value)+"&";
Y=/submit/i.test(W)
}}}}});
return U.substr(0,U.length-1)
},useDefaultHeader:true,defaultPostHeader:"application/x-www-form-urlencoded; charset=UTF-8",useDefaultXhrHeader:true,defaultXhrHeader:"XMLHttpRequest",poll:{},timeout:{},pollInterval:50,transactionId:0,abort:function(T,V,Q){var S=this,U=T.tId,R=false;
if(S.isCallInProgress(T)){T.conn.abort();
clearInterval(S.poll[U]);
S.poll[U]=null;
clearTimeout(K.timeout[U]);
S.timeout[U]=null;
F(T,V,(R=true),Q)
}return R
},isCallInProgress:function(Q){return Q.conn&&!{0:true,4:true}[Q.conn.readyState]
}};
return K
}();
CQ.Ext.lib.Region=function(F,H,D,E){var G=this;
G.top=F;
G[1]=F;
G.right=H;
G.bottom=D;
G.left=E;
G[0]=E
};
CQ.Ext.lib.Region.prototype={contains:function(E){var D=this;
return(E.left>=D.left&&E.right<=D.right&&E.top>=D.top&&E.bottom<=D.bottom)
},getArea:function(){var D=this;
return((D.bottom-D.top)*(D.right-D.left))
},intersect:function(I){var H=this,F=Math.max(H.top,I.top),G=Math.min(H.right,I.right),D=Math.min(H.bottom,I.bottom),E=Math.max(H.left,I.left);
if(D>=F&&G>=E){return new CQ.Ext.lib.Region(F,G,D,E)
}},union:function(I){var H=this,F=Math.min(H.top,I.top),G=Math.max(H.right,I.right),D=Math.max(H.bottom,I.bottom),E=Math.min(H.left,I.left);
return new CQ.Ext.lib.Region(F,G,D,E)
},constrainTo:function(E){var D=this;
D.top=D.top.constrain(E.top,E.bottom);
D.bottom=D.bottom.constrain(E.top,E.bottom);
D.left=D.left.constrain(E.left,E.right);
D.right=D.right.constrain(E.left,E.right);
return D
},adjust:function(F,E,D,H){var G=this;
G.top+=F;
G.left+=E;
G.right+=H;
G.bottom+=D;
return G
}};
CQ.Ext.lib.Region.getRegion=function(G){var I=CQ.Ext.lib.Dom.getXY(G),F=I[1],H=I[0]+G.offsetWidth,D=I[1]+G.offsetHeight,E=I[0];
return new CQ.Ext.lib.Region(F,H,D,E)
};
CQ.Ext.lib.Point=function(D,F){if(CQ.Ext.isArray(D)){F=D[1];
D=D[0]
}var E=this;
E.x=E.right=E.left=E[0]=D;
E.y=E.top=E.bottom=E[1]=F
};
CQ.Ext.lib.Point.prototype=new CQ.Ext.lib.Region();
(function(){var G=CQ.Ext.lib,I=/width|height|opacity|padding/i,F=/^((width|height)|(top|left))$/,D=/width|height|top$|bottom$|left$|right$/i,H=/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i,J=function(K){return typeof K!=="undefined"
},E=function(){return new Date()
};
G.Anim={motion:function(N,L,O,P,K,M){return this.run(N,L,O,P,K,M,CQ.Ext.lib.Motion)
},run:function(O,L,Q,R,K,N,M){M=M||CQ.Ext.lib.AnimBase;
if(typeof R=="string"){R=CQ.Ext.lib.Easing[R]
}var P=new M(O,L,Q,R);
P.animateX(function(){if(CQ.Ext.isFunction(K)){K.call(N)
}});
return P
}};
G.AnimBase=function(L,K,M,N){if(L){this.init(L,K,M,N)
}};
G.AnimBase.prototype={doMethod:function(K,N,L){var M=this;
return M.method(M.curFrame,N,L-N,M.totalFrames)
},setAttr:function(K,M,L){if(I.test(K)&&M<0){M=0
}CQ.Ext.fly(this.el,"_anim").setStyle(K,M+L)
},getAttr:function(K){var M=CQ.Ext.fly(this.el),N=M.getStyle(K),L=F.exec(K)||[];
if(N!=="auto"&&!H.test(N)){return parseFloat(N)
}return(!!(L[2])||(M.getStyle("position")=="absolute"&&!!(L[3])))?M.dom["offset"+L[0].charAt(0).toUpperCase()+L[0].substr(1)]:0
},getDefaultUnit:function(K){return D.test(K)?"px":""
},animateX:function(N,K){var L=this,M=function(){L.onComplete.removeListener(M);
if(CQ.Ext.isFunction(N)){N.call(K||L,L)
}};
L.onComplete.addListener(M,L);
L.animate()
},setRunAttr:function(P){var R=this,S=this.attributes[P],T=S.to,Q=S.by,U=S.from,V=S.unit,L=(this.runAttrs[P]={}),M;
if(!J(T)&&!J(Q)){return false
}var K=J(U)?U:R.getAttr(P);
if(J(T)){M=T
}else{if(J(Q)){if(CQ.Ext.isArray(K)){M=[];
for(var N=0,O=K.length;
N<O;
N++){M[N]=K[N]+Q[N]
}}else{M=K+Q
}}}CQ.Ext.apply(L,{start:K,end:M,unit:J(V)?V:R.getDefaultUnit(P)})
},init:function(L,P,O,K){var R=this,N=0,S=G.AnimMgr;
CQ.Ext.apply(R,{isAnimated:false,startTime:null,el:CQ.Ext.getDom(L),attributes:P||{},duration:O||1,method:K||G.Easing.easeNone,useSec:true,curFrame:0,totalFrames:S.fps,runAttrs:{},animate:function(){var U=this,V=U.duration;
if(U.isAnimated){return false
}U.curFrame=0;
U.totalFrames=U.useSec?Math.ceil(S.fps*V):V;
S.registerElement(U)
},stop:function(U){var V=this;
if(U){V.curFrame=V.totalFrames;
V._onTween.fire()
}S.stop(V)
}});
var T=function(){var V=this,U;
V.onStart.fire();
V.runAttrs={};
for(U in this.attributes){this.setRunAttr(U)
}V.isAnimated=true;
V.startTime=E();
N=0
};
var Q=function(){var V=this;
V.onTween.fire({duration:E()-V.startTime,curFrame:V.curFrame});
var W=V.runAttrs;
for(var U in W){this.setAttr(U,V.doMethod(U,W[U].start,W[U].end),W[U].unit)
}++N
};
var M=function(){var U=this,W=(E()-U.startTime)/1000,V={duration:W,frames:N,fps:N/W};
U.isAnimated=false;
N=0;
U.onComplete.fire(V)
};
R.onStart=new CQ.Ext.util.Event(R);
R.onTween=new CQ.Ext.util.Event(R);
R.onComplete=new CQ.Ext.util.Event(R);
(R._onStart=new CQ.Ext.util.Event(R)).addListener(T);
(R._onTween=new CQ.Ext.util.Event(R)).addListener(Q);
(R._onComplete=new CQ.Ext.util.Event(R)).addListener(M)
}};
CQ.Ext.lib.AnimMgr=new function(){var O=this,M=null,L=[],K=0;
CQ.Ext.apply(O,{fps:1000,delay:1,registerElement:function(Q){L.push(Q);
++K;
Q._onStart.fire();
O.start()
},unRegister:function(R,Q){R._onComplete.fire();
Q=Q||P(R);
if(Q!=-1){L.splice(Q,1)
}if(--K<=0){O.stop()
}},start:function(){if(M===null){M=setInterval(O.run,O.delay)
}},stop:function(S){if(!S){clearInterval(M);
for(var R=0,Q=L.length;
R<Q;
++R){if(L[0].isAnimated){O.unRegister(L[0],0)
}}L=[];
M=null;
K=0
}else{O.unRegister(S)
}},run:function(){var T,S,Q,R;
for(S=0,Q=L.length;
S<Q;
S++){R=L[S];
if(R&&R.isAnimated){T=R.totalFrames;
if(R.curFrame<T||T===null){++R.curFrame;
if(R.useSec){N(R)
}R._onTween.fire()
}else{O.stop(R)
}}}}});
var P=function(S){var R,Q;
for(R=0,Q=L.length;
R<Q;
R++){if(L[R]===S){return R
}}return -1
};
var N=function(R){var V=R.totalFrames,U=R.curFrame,T=R.duration,S=(U*T*1000/V),Q=(E()-R.startTime),W=0;
if(Q<T*1000){W=Math.round((Q/S-1)*U)
}else{W=V-(U+1)
}if(W>0&&isFinite(W)){if(R.curFrame+W>=V){W=V-(U+1)
}R.curFrame+=W
}}
};
G.Bezier=new function(){this.getPosition=function(O,N){var Q=O.length,M=[],P=1-N,L,K;
for(L=0;
L<Q;
++L){M[L]=[O[L][0],O[L][1]]
}for(K=1;
K<Q;
++K){for(L=0;
L<Q-K;
++L){M[L][0]=P*M[L][0]+N*M[parseInt(L+1,10)][0];
M[L][1]=P*M[L][1]+N*M[parseInt(L+1,10)][1]
}}return[M[0][0],M[0][1]]
}
};
G.Easing={easeNone:function(L,K,N,M){return N*L/M+K
},easeIn:function(L,K,N,M){return N*(L/=M)*L+K
},easeOut:function(L,K,N,M){return -N*(L/=M)*(L-2)+K
}};
(function(){G.Motion=function(P,O,Q,R){if(P){G.Motion.superclass.constructor.call(this,P,O,Q,R)
}};
CQ.Ext.extend(G.Motion,CQ.Ext.lib.AnimBase);
var N=G.Motion.superclass,M=G.Motion.prototype,L=/^points$/i;
CQ.Ext.apply(G.Motion.prototype,{setAttr:function(O,S,R){var Q=this,P=N.setAttr;
if(L.test(O)){R=R||"px";
P.call(Q,"left",S[0],R);
P.call(Q,"top",S[1],R)
}else{P.call(Q,O,S,R)
}},getAttr:function(O){var Q=this,P=N.getAttr;
return L.test(O)?[P.call(Q,"left"),P.call(Q,"top")]:P.call(Q,O)
},doMethod:function(O,R,P){var Q=this;
return L.test(O)?G.Bezier.getPosition(Q.runAttrs[O],Q.method(Q.curFrame,0,100,Q.totalFrames)/100):N.doMethod.call(Q,O,R,P)
},setRunAttr:function(V){if(L.test(V)){var X=this,Q=this.el,a=this.attributes.points,T=a.control||[],Y=a.from,Z=a.to,W=a.by,b=G.Dom,P,S,R,U,O;
if(T.length>0&&!CQ.Ext.isArray(T[0])){T=[T]
}else{}CQ.Ext.fly(Q,"_anim").position();
b.setXY(Q,J(Y)?Y:b.getXY(Q));
P=X.getAttr("points");
if(J(Z)){R=K.call(X,Z,P);
for(S=0,U=T.length;
S<U;
++S){T[S]=K.call(X,T[S],P)
}}else{if(J(W)){R=[P[0]+W[0],P[1]+W[1]];
for(S=0,U=T.length;
S<U;
++S){T[S]=[P[0]+T[S][0],P[1]+T[S][1]]
}}}O=this.runAttrs[V]=[P];
if(T.length>0){O=O.concat(T)
}O[O.length]=R
}else{N.setRunAttr.call(this,V)
}}});
var K=function(O,Q){var P=G.Dom.getXY(this.el);
return[O[0]-P[0]+Q[0],O[1]-P[1]+Q[1]]
}
})()
})();
(function(){var D=Math.abs,I=Math.PI,H=Math.asin,G=Math.pow,E=Math.sin,F=CQ.Ext.lib;
CQ.Ext.apply(F.Easing,{easeBoth:function(K,J,M,L){return((K/=L/2)<1)?M/2*K*K+J:-M/2*((--K)*(K-2)-1)+J
},easeInStrong:function(K,J,M,L){return M*(K/=L)*K*K*K+J
},easeOutStrong:function(K,J,M,L){return -M*((K=K/L-1)*K*K*K-1)+J
},easeBothStrong:function(K,J,M,L){return((K/=L/2)<1)?M/2*K*K*K*K+J:-M/2*((K-=2)*K*K*K-2)+J
},elasticIn:function(L,J,P,O,K,N){if(L==0||(L/=O)==1){return L==0?J:J+P
}N=N||(O*0.3);
var M;
if(K>=D(P)){M=N/(2*I)*H(P/K)
}else{K=P;
M=N/4
}return -(K*G(2,10*(L-=1))*E((L*O-M)*(2*I)/N))+J
},elasticOut:function(L,J,P,O,K,N){if(L==0||(L/=O)==1){return L==0?J:J+P
}N=N||(O*0.3);
var M;
if(K>=D(P)){M=N/(2*I)*H(P/K)
}else{K=P;
M=N/4
}return K*G(2,-10*L)*E((L*O-M)*(2*I)/N)+P+J
},elasticBoth:function(L,J,P,O,K,N){if(L==0||(L/=O/2)==2){return L==0?J:J+P
}N=N||(O*(0.3*1.5));
var M;
if(K>=D(P)){M=N/(2*I)*H(P/K)
}else{K=P;
M=N/4
}return L<1?-0.5*(K*G(2,10*(L-=1))*E((L*O-M)*(2*I)/N))+J:K*G(2,-10*(L-=1))*E((L*O-M)*(2*I)/N)*0.5+P+J
},backIn:function(K,J,N,M,L){L=L||1.70158;
return N*(K/=M)*K*((L+1)*K-L)+J
},backOut:function(K,J,N,M,L){if(!L){L=1.70158
}return N*((K=K/M-1)*K*((L+1)*K+L)+1)+J
},backBoth:function(K,J,N,M,L){L=L||1.70158;
return((K/=M/2)<1)?N/2*(K*K*(((L*=(1.525))+1)*K-L))+J:N/2*((K-=2)*K*(((L*=(1.525))+1)*K+L)+2)+J
},bounceIn:function(K,J,M,L){return M-F.Easing.bounceOut(L-K,0,M,L)+J
},bounceOut:function(K,J,M,L){if((K/=L)<(1/2.75)){return M*(7.5625*K*K)+J
}else{if(K<(2/2.75)){return M*(7.5625*(K-=(1.5/2.75))*K+0.75)+J
}else{if(K<(2.5/2.75)){return M*(7.5625*(K-=(2.25/2.75))*K+0.9375)+J
}}}return M*(7.5625*(K-=(2.625/2.75))*K+0.984375)+J
},bounceBoth:function(K,J,M,L){return(K<L/2)?F.Easing.bounceIn(K*2,0,M,L)*0.5+J:F.Easing.bounceOut(K*2-L,0,M,L)*0.5+M*0.5+J
}})
})();
(function(){var H=CQ.Ext.lib;
H.Anim.color=function(P,N,Q,R,M,O){return H.Anim.run(P,N,Q,R,M,O,H.ColorAnim)
};
H.ColorAnim=function(N,M,O,P){H.ColorAnim.superclass.constructor.call(this,N,M,O,P)
};
CQ.Ext.extend(H.ColorAnim,H.AnimBase);
var J=H.ColorAnim.superclass,I=/color$/i,F=/^transparent|rgba\(0, 0, 0, 0\)$/,L=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,D=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,E=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,G=function(M){return typeof M!=="undefined"
};
function K(N){var P=parseInt,O,M=null,Q;
if(N.length==3){return N
}CQ.Ext.each([D,L,E],function(S,R){O=(R%2==0)?16:10;
Q=S.exec(N);
if(Q&&Q.length==4){M=[P(Q[1],O),P(Q[2],O),P(Q[3],O)];
return false
}});
return M
}CQ.Ext.apply(H.ColorAnim.prototype,{getAttr:function(M){var O=this,N=O.el,P;
if(I.test(M)){while(N&&F.test(P=CQ.Ext.fly(N).getStyle(M))){N=N.parentNode;
P="fff"
}}else{P=J.getAttr.call(O,M)
}return P
},doMethod:function(S,M,O){var T=this,N,Q=Math.floor,P,R,U;
if(I.test(S)){N=[];
for(P=0,R=M.length;
P<R;
P++){U=M[P];
N[P]=J.doMethod.call(T,S,U,O[P])
}N="rgb("+Q(N[0])+","+Q(N[1])+","+Q(N[2])+")"
}else{N=J.doMethod.call(T,S,M,O)
}return N
},setRunAttr:function(R){var T=this,U=T.attributes[R],V=U.to,S=U.by,N;
J.setRunAttr.call(T,R);
N=T.runAttrs[R];
if(I.test(R)){var M=K(N.start),O=K(N.end);
if(!G(V)&&G(S)){O=K(S);
for(var P=0,Q=M.length;
P<Q;
P++){O[P]=M[P]+O[P]
}}N.start=M;
N.end=O
}}})
})();
(function(){var D=CQ.Ext.lib;
D.Anim.scroll=function(J,H,K,L,G,I){return D.Anim.run(J,H,K,L,G,I,D.Scroll)
};
D.Scroll=function(H,G,I,J){if(H){D.Scroll.superclass.constructor.call(this,H,G,I,J)
}};
CQ.Ext.extend(D.Scroll,D.ColorAnim);
var F=D.Scroll.superclass,E="scroll";
CQ.Ext.apply(D.Scroll.prototype,{doMethod:function(G,M,H){var K,J=this,L=J.curFrame,I=J.totalFrames;
if(G==E){K=[J.method(L,M[0],H[0]-M[0],I),J.method(L,M[1],H[1]-M[1],I)]
}else{K=F.doMethod.call(J,G,M,H)
}return K
},getAttr:function(G){var H=this;
if(G==E){return[H.el.scrollLeft,H.el.scrollTop]
}else{return F.getAttr.call(H,G)
}},setAttr:function(G,J,I){var H=this;
if(G==E){H.el.scrollLeft=J[0];
H.el.scrollTop=J[1]
}else{F.setAttr.call(H,G,J,I)
}}})
})();
if(CQ.Ext.isIE){function A(){var D=Function.prototype;
delete D.createSequence;
delete D.defer;
delete D.createDelegate;
delete D.createCallback;
delete D.createInterceptor;
window.detachEvent("onunload",A)
}window.attachEvent("onunload",A)
}})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.DomHelper=function(){var R=null,I=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,K=/^table|tbody|tr|td$/i,O,L="afterbegin",M="afterend",C="beforebegin",N="beforeend",A="<table>",G="</table>",B=A+"<tbody>",H="</tbody>"+G,J=B+"<tr>",Q="</tr>"+H;
function F(V,X,W,Y,U,S){var T=O.insertHtml(Y,CQ.Ext.getDom(V),P(X));
return W?CQ.Ext.get(T,true):T
}function P(Y){var U="",T,X,W,S,Z;
if(CQ.Ext.isString(Y)){U=Y
}else{if(CQ.Ext.isArray(Y)){for(var V=0;
V<Y.length;
V++){if(Y[V]){U+=P(Y[V])
}}}else{U+="<"+(Y.tag=Y.tag||"div");
CQ.Ext.iterate(Y,function(a,b){if(!/tag|children|cn|html$/i.test(a)){if(CQ.Ext.isObject(b)){U+=" "+a+'="';
CQ.Ext.iterate(b,function(d,c){U+=d+":"+c+";"
});
U+='"'
}else{U+=" "+({cls:"class",htmlFor:"for"}[a]||a)+'="'+b+'"'
}}});
if(I.test(Y.tag)){U+="/>"
}else{U+=">";
if((Z=Y.children||Y.cn)){U+=P(Z)
}else{if(Y.html){U+=Y.html
}}U+="</"+Y.tag+">"
}}}return U
}function E(Z,W,V,X){R.innerHTML=[W,V,X].join("");
var S=-1,U=R,T;
while(++S<Z){U=U.firstChild
}if(T=U.nextSibling){var Y=document.createDocumentFragment();
while(U){T=U.nextSibling;
Y.appendChild(U);
U=T
}U=Y
}return U
}function D(S,T,V,U){var W,X;
R=R||document.createElement("div");
if(S=="td"&&(T==L||T==N)||!/td|tr|tbody/i.test(S)&&(T==C||T==M)){return 
}X=T==C?V:T==M?V.nextSibling:T==L?V.firstChild:null;
if(T==C||T==M){V=V.parentNode
}if(S=="td"||(S=="tr"&&(T==N||T==L))){W=E(4,J,U,Q)
}else{if((S=="tbody"&&(T==N||T==L))||(S=="tr"&&(T==C||T==M))){W=E(3,B,U,H)
}else{W=E(2,A,U,G)
}}V.insertBefore(W,X);
return W
}O={markup:function(S){return P(S)
},applyStyles:function(V,W){if(W){var T=0,S,U;
V=CQ.Ext.fly(V);
if(CQ.Ext.isFunction(W)){W=W.call()
}if(CQ.Ext.isString(W)){W=W.trim().split(/\s*(?::|;)\s*/);
for(S=W.length;
T<S;
){V.setStyle(W[T++],W[T++])
}}else{if(CQ.Ext.isObject(W)){V.setStyle(W)
}}}},insertHtml:function(X,S,Y){var W={},U,a,Z,b,V,T;
X=X.toLowerCase();
W[C]=["BeforeBegin","previousSibling"];
W[M]=["AfterEnd","nextSibling"];
if(S.insertAdjacentHTML){if(K.test(S.tagName)&&(T=D(S.tagName.toLowerCase(),X,S,Y))){return T
}W[L]=["AfterBegin","firstChild"];
W[N]=["BeforeEnd","lastChild"];
if((U=W[X])){S.insertAdjacentHTML(U[0],Y);
return S[U[1]]
}}else{Z=S.ownerDocument.createRange();
a="setStart"+(/end/i.test(X)?"After":"Before");
if(W[X]){Z[a](S);
b=Z.createContextualFragment(Y);
S.parentNode.insertBefore(b,X==C?S:S.nextSibling);
return S[(X==C?"previous":"next")+"Sibling"]
}else{V=(X==L?"first":"last")+"Child";
if(S.firstChild){Z[a](S[V]);
b=Z.createContextualFragment(Y);
if(X==L){S.insertBefore(b,S.firstChild)
}else{S.appendChild(b)
}}else{S.innerHTML=Y
}return S[V]
}}throw'Illegal insertion point -> "'+X+'"'
},insertBefore:function(S,U,T){return F(S,U,T,C)
},insertAfter:function(S,U,T){return F(S,U,T,M,"nextSibling")
},insertFirst:function(S,U,T){return F(S,U,T,L,"firstChild")
},append:function(S,U,T){if(CQ.Util.isRoot(S)){S=CQ.Util.getRoot()
}return F(S,U,T,N,"",true)
},overwrite:function(S,U,T){S=CQ.Ext.getDom(S);
S.innerHTML=P(U);
return T?CQ.Ext.get(S.firstChild):S.firstChild
},createHtml:P};
return O
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.DomHelper,function(){var D,A="afterbegin",F="afterend",G="beforebegin",C="beforeend";
function E(K,M,L,N,J,H){K=CQ.Ext.getDom(K);
var I;
if(D.useDom){I=B(M,null);
if(H){K.appendChild(I)
}else{(J=="firstChild"?K:K.parentNode).insertBefore(I,K[J]||K)
}}else{I=CQ.Ext.DomHelper.insertHtml(N,K,CQ.Ext.DomHelper.createHtml(M))
}return L?CQ.Ext.get(I,true):I
}function B(N,I){var K,L=document,J,H,M,O;
if(CQ.Ext.isArray(N)){K=L.createDocumentFragment();
CQ.Ext.each(N,function(P){B(P,K)
})
}else{if(CQ.Ext.isString(N)){K=L.createTextNode(N)
}else{K=L.createElement(N.tag||"div");
J=!!K.setAttribute;
CQ.Ext.iterate(N,function(P,Q){if(!/tag|children|cn|html|style/.test(P)){if(P=="cls"){K.className=Q
}else{if(J){K.setAttribute(P,Q)
}else{K[P]=Q
}}}});
CQ.Ext.DomHelper.applyStyles(K,N.style);
if((O=N.children||N.cn)){B(O,K)
}else{if(N.html){K.innerHTML=N.html
}}}}if(I){I.appendChild(K)
}return K
}D={createTemplate:function(I){var H=CQ.Ext.DomHelper.createHtml(I);
return new CQ.Ext.Template(H)
},useDom:false,insertBefore:function(H,J,I){return E(H,J,I,G)
},insertAfter:function(H,J,I){return E(H,J,I,F,"nextSibling")
},insertFirst:function(H,J,I){return E(H,J,I,A,"firstChild")
},append:function(H,J,I){if(CQ.Util.isRoot(H)){H=CQ.Util.getRoot()
}return E(H,J,I,C,"",true)
},createDom:B};
return D
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Template=function(C){var D=this,A=arguments,B=[];
if(CQ.Ext.isArray(C)){C=C.join("")
}else{if(A.length>1){CQ.Ext.each(A,function(E){if(CQ.Ext.isObject(E)){CQ.Ext.apply(D,E)
}else{B.push(E)
}});
C=B.join("")
}}D.html=C;
if(D.compiled){D.compile()
}};
CQ.Ext.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(A){var B=this;
return B.compiled?B.compiled(A):B.html.replace(B.re,function(C,D){return A[D]!==undefined?A[D]:""
})
},set:function(A,C){var B=this;
B.html=A;
B.compiled=null;
return C?B.compile():B
},compile:function(){var me=this,sep=CQ.Ext.isGecko?"+":",";
function fn(m,name){name="values['"+name+"']";
return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"
}eval("this.compiled = function(values){ return "+(CQ.Ext.isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(CQ.Ext.isGecko?"';};":"'].join('');};"));
return me
},insertFirst:function(B,A,C){return this.doInsert("afterBegin",B,A,C)
},insertBefore:function(B,A,C){return this.doInsert("beforeBegin",B,A,C)
},insertAfter:function(B,A,C){return this.doInsert("afterEnd",B,A,C)
},append:function(B,A,C){return this.doInsert("beforeEnd",B,A,C)
},doInsert:function(C,E,B,A){E=CQ.Ext.getDom(E);
var D=CQ.Ext.DomHelper.insertHtml(C,E,this.applyTemplate(B));
return A?CQ.Ext.get(D,true):D
},overwrite:function(B,A,C){B=CQ.Ext.getDom(B);
B.innerHTML=this.applyTemplate(A);
return C?CQ.Ext.get(B.firstChild,true):B.firstChild
}};
CQ.Ext.Template.prototype.apply=CQ.Ext.Template.prototype.applyTemplate;
CQ.Ext.Template.from=function(B,A){B=CQ.Ext.getDom(B);
return new CQ.Ext.Template(B.value||B.innerHTML,A||"")
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.Template.prototype,{disableFormats:false,re:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,applyTemplate:function(B){var F=this,A=F.disableFormats!==true,E=CQ.Ext.util.Format,C=F;
if(F.compiled){return F.compiled(B)
}function D(H,J,M,I){if(M&&A){if(M.substr(0,5)=="this."){return C.call(M.substr(5),B[J],B)
}else{if(I){var L=/^\s*['"](.*)["']\s*$/;
I=I.split(",");
for(var K=0,G=I.length;
K<G;
K++){I[K]=I[K].replace(L,"$1")
}I=[B[J]].concat(I)
}else{I=[B[J]]
}return E[M].apply(E,I)
}}else{return B[J]!==undefined?B[J]:""
}}return F.html.replace(F.re,D)
},compile:function(){var me=this,fm=CQ.Ext.util.Format,useF=me.disableFormats!==true,sep=CQ.Ext.isGecko?"+":",",body;
function fn(m,name,format,args){if(format&&useF){args=args?","+args:"";
if(format.substr(0,5)!="this."){format="fm."+format+"("
}else{format='this.call("'+format.substr(5)+'", ';
args=", values"
}}else{args="";
format="(values['"+name+"'] == undefined ? '' : "
}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"
}if(CQ.Ext.isGecko){body="this.compiled = function(values){ return '"+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+"';};"
}else{body=["this.compiled = function(values){ return ['"];
body.push(me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn));
body.push("'].join('');};");
body=body.join("")
}eval(body);
return me
},call:function(C,B,A){return this[C](B,A)
}});
CQ.Ext.Template.prototype.apply=CQ.Ext.Template.prototype.applyTemplate;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/>+~]\s?|\s|$)/,tagTokenRe=/^(#)?([\w-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;
eval("var batch = 30803;");
function child(parent,index){var i=0,n=parent.firstChild;
while(n){if(n.nodeType==1){if(++i==index){return n
}}n=n.nextSibling
}return null
}function next(n){while((n=n.nextSibling)&&n.nodeType!=1){}return n
}function prev(n){while((n=n.previousSibling)&&n.nodeType!=1){}return n
}function children(parent){var n=parent.firstChild,nodeIndex=-1,nextNode;
while(n){nextNode=n.nextSibling;
if(n.nodeType==3&&!nonSpace.test(n.nodeValue)){parent.removeChild(n)
}else{n.nodeIndex=++nodeIndex
}n=nextNode
}return this
}function byClassName(nodeSet,cls){if(!cls){return nodeSet
}var result=[],ri=-1;
for(var i=0,ci;
ci=nodeSet[i];
i++){if((" "+ci.className+" ").indexOf(cls)!=-1){result[++ri]=ci
}}return result
}function attrValue(n,attr){if(!n.tagName&&typeof n.length!="undefined"){n=n[0]
}if(!n){return null
}if(attr=="for"){return n.htmlFor
}if(attr=="class"||attr=="className"){return n.className
}return n.getAttribute(attr)||n[attr]
}function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;
if(!ns){return result
}tagName=tagName||"*";
if(typeof ns.getElementsByTagName!="undefined"){ns=[ns]
}if(!mode){for(var i=0,ni;
ni=ns[i];
i++){cs=ni.getElementsByTagName(tagName);
for(var j=0,ci;
ci=cs[j];
j++){result[++ri]=ci
}}}else{if(mode=="/"||mode==">"){var utag=tagName.toUpperCase();
for(var i=0,ni,cn;
ni=ns[i];
i++){cn=ni.childNodes;
for(var j=0,cj;
cj=cn[j];
j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName=="*"){result[++ri]=cj
}}}}else{if(mode=="+"){var utag=tagName.toUpperCase();
for(var i=0,n;
n=ns[i];
i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(n&&(n.nodeName==utag||n.nodeName==tagName||tagName=="*")){result[++ri]=n
}}}else{if(mode=="~"){var utag=tagName.toUpperCase();
for(var i=0,n;
n=ns[i];
i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName=="*"){result[++ri]=n
}}}}}}}return result
}function concat(a,b){if(b.slice){return a.concat(b)
}for(var i=0,l=b.length;
i<l;
i++){a[a.length]=b[i]
}return a
}function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs]
}if(!tagName){return cs
}var result=[],ri=-1;
tagName=tagName.toLowerCase();
for(var i=0,ci;
ci=cs[i];
i++){if(ci.nodeType==1&&ci.tagName.toLowerCase()==tagName){result[++ri]=ci
}}return result
}function byId(cs,id){if(cs.tagName||cs==document){cs=[cs]
}if(!id){return cs
}var result=[],ri=-1;
for(var i=0,ci;
ci=cs[i];
i++){if(ci&&ci.id==id){result[++ri]=ci;
return result
}}return result
}function byAttribute(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom=="{",fn=CQ.Ext.DomQuery.operators[op],a,innerHTML;
for(var i=0,ci;
ci=cs[i];
i++){if(ci.nodeType!=1){continue
}innerHTML=ci.innerHTML;
if(innerHTML!==null&&innerHTML!==undefined){if(useGetStyle){a=CQ.Ext.DomQuery.getStyle(ci,attr)
}else{if(attr=="class"||attr=="className"){a=ci.className
}else{if(attr=="for"){a=ci.htmlFor
}else{if(attr=="href"){a=ci.getAttribute("href",2)
}else{a=ci.getAttribute(attr)
}}}}}else{a=ci.getAttribute(attr)
}if((fn&&fn(a,value))||(!fn&&a)){result[++ri]=ci
}}return result
}function byPseudo(cs,name,value){return CQ.Ext.DomQuery.pseudos[name](cs,value)
}function nodupIEXml(cs){var d=++key,r;
cs[0].setAttribute("_nodup",d);
r=[cs[0]];
for(var i=1,len=cs.length;
i<len;
i++){var c=cs[i];
if(!c.getAttribute("_nodup")!=d){c.setAttribute("_nodup",d);
r[r.length]=c
}}for(var i=0,len=cs.length;
i<len;
i++){cs[i].removeAttribute("_nodup")
}return r
}function nodup(cs){if(!cs){return[]
}var len=cs.length,c,i,r=cs,cj,ri=-1;
if(!len||typeof cs.nodeType!="undefined"||len==1){return cs
}if(isIE&&typeof cs[0].selectSingleNode!="undefined"){return nodupIEXml(cs)
}var d=++key;
cs[0]._nodup=d;
for(i=1;
c=cs[i];
i++){if(c._nodup!=d){c._nodup=d
}else{r=[];
for(var j=0;
j<i;
j++){r[++ri]=cs[j]
}for(j=i+1;
cj=cs[j];
j++){if(cj._nodup!=d){cj._nodup=d;
r[++ri]=cj
}}return r
}}return r
}function quickDiffIEXml(c1,c2){var d=++key,r=[];
for(var i=0,len=c1.length;
i<len;
i++){c1[i].setAttribute("_qdiff",d)
}for(var i=0,len=c2.length;
i<len;
i++){if(c2[i].getAttribute("_qdiff")!=d){r[r.length]=c2[i]
}}for(var i=0,len=c1.length;
i<len;
i++){c1[i].removeAttribute("_qdiff")
}return r
}function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];
if(!len1){return c2
}if(isIE&&typeof c1[0].selectSingleNode!="undefined"){return quickDiffIEXml(c1,c2)
}for(var i=0;
i<len1;
i++){c1[i]._qdiff=d
}for(var i=0,len=c2.length;
i<len;
i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i]
}}return r
}function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;
return d.getElementById(id)
}ns=getNodes(ns,mode,"*");
return byId(ns,id)
}return{getStyle:function(el,name){return CQ.Ext.fly(el).getStyle(name)
},compile:function(path,type){type=type||"select";
var fn=["var f = function(root){\n var mode; ++batch; var n = root || document;\n"],mode,lastPath,matchers=CQ.Ext.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);
if(lmode&&lmode[1]){fn[fn.length]='mode="'+lmode[1].replace(trimRe,"")+'";';
path=path.replace(lmode[1],"")
}while(path.substr(0,1)=="/"){path=path.substr(1)
}while(path&&lastPath!=path){lastPath=path;
var tokenMatch=path.match(tagTokenRe);
if(type=="select"){if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = quickId(n, mode, root, "'+tokenMatch[2]+'");'
}else{fn[fn.length]='n = getNodes(n, mode, "'+tokenMatch[2]+'");'
}path=path.replace(tokenMatch[0],"")
}else{if(path.substr(0,1)!="@"){fn[fn.length]='n = getNodes(n, mode, "*");'
}}}else{if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = byId(n, "'+tokenMatch[2]+'");'
}else{fn[fn.length]='n = byTag(n, "'+tokenMatch[2]+'");'
}path=path.replace(tokenMatch[0],"")
}}while(!(modeMatch=path.match(modeRe))){var matched=false;
for(var j=0;
j<matchersLn;
j++){var t=matchers[j];
var m=path.match(t.re);
if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i]
});
path=path.replace(m[0],"");
matched=true;
break
}}if(!matched){throw'Error parsing selector, parsing failed at "'+path+'"'
}}if(modeMatch[1]){fn[fn.length]='mode="'+modeMatch[1].replace(trimRe,"")+'";';
path=path.replace(modeMatch[1],"")
}}fn[fn.length]="return nodup(n);\n}";
eval(fn.join(""));
return f
},jsSelect:function(path,root,type){root=root||document;
if(typeof root=="string"){root=document.getElementById(root)
}var paths=path.split(","),results=[];
for(var i=0,len=paths.length;
i<len;
i++){var subPath=paths[i].replace(trimRe,"");
if(!cache[subPath]){cache[subPath]=CQ.Ext.DomQuery.compile(subPath);
if(!cache[subPath]){throw subPath+" is not a valid selector"
}}var result=cache[subPath](root);
if(result&&result!=document){results=results.concat(result)
}}if(paths.length>1){return nodup(results)
}return results
},isXml:function(el){var docEl=(el?el.ownerDocument||el:0).documentElement;
return docEl?docEl.nodeName!=="HTML":false
},select:document.querySelectorAll?function(path,root,type){root=root||document;
if(!CQ.Ext.DomQuery.isXml(root)){try{var cs=root.querySelectorAll(path);
return CQ.Ext.toArray(cs)
}catch(ex){}}return CQ.Ext.DomQuery.jsSelect.call(this,path,root,type)
}:function(path,root,type){return CQ.Ext.DomQuery.jsSelect.call(this,path,root,type)
},selectNode:function(path,root){return CQ.Ext.DomQuery.select(path,root)[0]
},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,"");
if(!valueCache[path]){valueCache[path]=CQ.Ext.DomQuery.compile(path,"select")
}var n=valueCache[path](root),v;
n=n[0]?n[0]:n;
if(typeof n.normalize=="function"){n.normalize()
}v=(n&&n.firstChild?n.firstChild.nodeValue:null);
return((v===null||v===undefined||v==="")?defaultValue:v)
},selectNumber:function(path,root,defaultValue){var v=CQ.Ext.DomQuery.selectValue(path,root,defaultValue||0);
return parseFloat(v)
},is:function(el,ss){if(typeof el=="string"){el=document.getElementById(el)
}var isArray=CQ.Ext.isArray(el),result=CQ.Ext.DomQuery.filter(isArray?el:[el],ss);
return isArray?(result.length==el.length):(result.length>0)
},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,"");
if(!simpleCache[ss]){simpleCache[ss]=CQ.Ext.DomQuery.compile(ss,"simple")
}var result=simpleCache[ss](els);
return nonMatches?quickDiff(result,els):result
},matchers:[{re:/^\.([\w-]+)/,select:'n = byClassName(n, " {1} ");'},{re:/^\:([\w-]+)(?:\(((?:[^\s>\/]*|.*?))\))?/,select:'n = byPseudo(n, "{1}", "{2}");'},{re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]\}])/,select:'n = byAttribute(n, "{2}", "{4}", "{3}", "{1}");'},{re:/^#([\w-]+)/,select:'n = byId(n, "{1}");'},{re:/^@([\w-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, "{1}")}};'}],operators:{"=":function(a,v){return a==v
},"!=":function(a,v){return a!=v
},"^=":function(a,v){return a&&a.substr(0,v.length)==v
},"$=":function(a,v){return a&&a.substr(a.length-v.length)==v
},"*=":function(a,v){return a&&a.indexOf(v)!==-1
},"%=":function(a,v){return(a%v)==0
},"|=":function(a,v){return a&&(a==v||a.substr(0,v.length+1)==v+"-")
},"~=":function(a,v){return a&&(" "+a+" ").indexOf(" "+v+" ")!=-1
}},pseudos:{"first-child":function(c){var r=[],ri=-1,n;
for(var i=0,ci;
ci=n=c[i];
i++){while((n=n.previousSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci
}}return r
},"last-child":function(c){var r=[],ri=-1,n;
for(var i=0,ci;
ci=n=c[i];
i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci
}}return r
},"nth-child":function(c,a){var r=[],ri=-1,m=nthRe.exec(a=="even"&&"2n"||a=="odd"&&"2n+1"||!nthRe2.test(a)&&"n+"+a||a),f=(m[1]||1)-0,l=m[2]-0;
for(var i=0,n;
n=c[i];
i++){var pn=n.parentNode;
if(batch!=pn._batch){var j=0;
for(var cn=pn.firstChild;
cn;
cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j
}}pn._batch=batch
}if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n
}}else{if((n.nodeIndex+l)%f==0){r[++ri]=n
}}}return r
},"only-child":function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(!prev(ci)&&!next(ci)){r[++ri]=ci
}}return r
},empty:function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var cns=ci.childNodes,j=0,cn,empty=true;
while(cn=cns[j]){++j;
if(cn.nodeType==1||cn.nodeType==3){empty=false;
break
}}if(empty){r[++ri]=ci
}}return r
},contains:function(c,v){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if((ci.textContent||ci.innerText||"").indexOf(v)!=-1){r[++ri]=ci
}}return r
},nodeValue:function(c,v){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(ci.firstChild&&ci.firstChild.nodeValue==v){r[++ri]=ci
}}return r
},checked:function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(ci.checked==true){r[++ri]=ci
}}return r
},not:function(c,ss){return CQ.Ext.DomQuery.filter(c,ss,true)
},any:function(c,selectors){var ss=selectors.split("|"),r=[],ri=-1,s;
for(var i=0,ci;
ci=c[i];
i++){for(var j=0;
s=ss[j];
j++){if(CQ.Ext.DomQuery.is(ci,s)){r[++ri]=ci;
break
}}}return r
},odd:function(c){return this["nth-child"](c,"odd")
},even:function(c){return this["nth-child"](c,"even")
},nth:function(c,a){return c[a-1]||[]
},first:function(c){return c[0]||[]
},last:function(c){return c[c.length-1]||[]
},has:function(c,ss){var s=CQ.Ext.DomQuery.select,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(s(ss,ci).length>0){r[++ri]=ci
}}return r
},next:function(c,ss){var is=CQ.Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var n=next(ci);
if(n&&is(n,ss)){r[++ri]=ci
}}return r
},prev:function(c,ss){var is=CQ.Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var n=prev(ci);
if(n&&is(n,ss)){r[++ri]=ci
}}return r
}}}
}();
CQ.Ext.query=CQ.Ext.DomQuery.select;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.DelayedTask=function(D,C,A){var E=this,F,B=function(){clearInterval(F);
F=null;
D.apply(C,A||[])
};
E.delay=function(H,J,I,G){E.cancel();
D=J||D;
C=I||C;
A=G||A;
F=setInterval(B,H)
};
E.cancel=function(){if(F){clearInterval(F);
F=null
}}
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var H=CQ.Ext.util,K=CQ.Ext.toArray,J=CQ.Ext.each,A=CQ.Ext.isObject,G=true,I=false;
H.Observable=function(){var L=this,M=L.events;
if(L.listeners){L.on(L.listeners);
delete L.listeners
}L.events=M||{}
};
H.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var L=K(arguments),N=L[0].toLowerCase(),O=this,M=G,Q=O.events[N],P,R;
if(O.eventsSuspended===G){if(P=O.eventQueue){P.push(L)
}}else{if(A(Q)&&Q.bubble){if(Q.fire.apply(Q,L.slice(1))===I){return I
}R=O.getBubbleTarget&&O.getBubbleTarget();
if(R&&R.enableBubble){if(!R.events[N]||!CQ.Ext.isObject(R.events[N])||!R.events[N].bubble){R.enableBubble(N)
}return R.fireEvent.apply(R,L)
}}else{if(A(Q)){L.shift();
M=Q.fire.apply(Q,L)
}}}return M
},addListener:function(N,Q,S,M){var P=this,O,T,R,L;
if(A(N)){M=N;
for(O in M){T=M[O];
if(!P.filterOptRe.test(O)){P.addListener(O,T.fn||T,T.scope||M.scope,T.fn?T:M)
}}}else{N=N.toLowerCase();
L=P.events[N]||G;
if(CQ.Ext.isBoolean(L)){P.events[N]=L=new H.Event(P,N)
}L.addListener(Q,S,A(M)?M:{})
}},removeListener:function(L,N,M){var O=this.events[L.toLowerCase()];
if(A(O)){O.removeListener(N,M)
}},purgeListeners:function(){var N=this.events,L,M;
for(M in N){L=N[M];
if(A(L)){L.clearListeners()
}}},addEvents:function(O){var N=this;
N.events=N.events||{};
if(CQ.Ext.isString(O)){var L=arguments,M=L.length;
while(M--){N.events[L[M]]=N.events[L[M]]||G
}}else{CQ.Ext.applyIf(N.events,O)
}},hasListener:function(L){var M=this.events[L];
return A(M)&&M.listeners.length>0
},suspendEvents:function(L){this.eventsSuspended=G;
if(L&&!this.eventQueue){this.eventQueue=[]
}},resumeEvents:function(){var L=this,M=L.eventQueue||[];
L.eventsSuspended=I;
delete L.eventQueue;
J(M,function(N){L.fireEvent.apply(L,N)
})
}};
var E=H.Observable.prototype;
E.on=E.addListener;
E.un=E.removeListener;
H.Observable.releaseCapture=function(L){L.fireEvent=E.fireEvent
};
function F(M,N,L){return function(){if(N.target==arguments[0]){M.apply(L,K(arguments))
}}
}function C(N,O,L,M){L.task=new H.DelayedTask();
return function(){L.task.delay(O.buffer,N,M,K(arguments))
}
}function D(N,O,M,L){return function(){O.removeListener(M,L);
return N.apply(L,arguments)
}
}function B(N,O,L,M){return function(){var P=new H.DelayedTask();
if(!L.tasks){L.tasks=[]
}L.tasks.push(P);
P.delay(O.delay||10,N,M,K(arguments))
}
}H.Event=function(M,L){this.name=L;
this.obj=M;
this.listeners=[]
};
H.Event.prototype={addListener:function(O,N,M){var P=this,L;
N=N||P.obj;
if(!P.isListening(O,N)){L=P.createListener(O,N,M);
if(P.firing){P.listeners=P.listeners.slice(0)
}P.listeners.push(L)
}},createListener:function(O,N,P){P=P||{},N=N||this.obj;
var L={fn:O,scope:N,options:P},M=O;
if(P.target){M=F(M,P,N)
}if(P.delay){M=B(M,P,L,N)
}if(P.single){M=D(M,this,O,N)
}if(P.buffer){M=C(M,P,L,N)
}L.fireFn=M;
return L
},findListener:function(P,O){var Q=this.listeners,M=Q.length,L,N;
while(M--){L=Q[M];
if(L){N=L.scope;
if(L.fn==P&&(N==O||N==this.obj)){return M
}}}return -1
},isListening:function(M,L){return this.findListener(M,L)!=-1
},removeListener:function(Q,P){var O,L,M,R=this,N=I;
if((O=R.findListener(Q,P))!=-1){if(R.firing){R.listeners=R.listeners.slice(0)
}L=R.listeners[O];
if(L.task){L.task.cancel();
delete L.task
}M=L.tasks&&L.tasks.length;
if(M){while(M--){L.tasks[M].cancel()
}delete L.tasks
}R.listeners.splice(O,1);
N=G
}return N
},clearListeners:function(){var N=this,L=N.listeners,M=L.length;
while(M--){N.removeListener(L[M].fn,L[M].scope)
}},fire:function(){var Q=this,N=K(arguments),P=Q.listeners,L=P.length,O=0,M;
if(L>0){Q.firing=G;
for(;
O<L;
O++){M=P[O];
if(M&&M.fireFn.apply(M.scope||Q.obj||window,N)===I){return(Q.firing=I)
}}}Q.firing=I;
return G
}}
})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.util.Observable.prototype,function(){function A(H){var G=(this.methodEvents=this.methodEvents||{})[H],D,C,E,F=this;
if(!G){this.methodEvents[H]=G={};
G.originalFn=this[H];
G.methodName=H;
G.before=[];
G.after=[];
var B=function(K,J,I){if(!CQ.Ext.isEmpty(C=K.apply(J||F,I))){if(CQ.Ext.isObject(C)){D=!CQ.Ext.isEmpty(C.returnValue)?C.returnValue:C;
E=!!C.cancel
}else{if(C===false){E=true
}else{D=C
}}}};
this[H]=function(){var I=CQ.Ext.toArray(arguments);
D=C=undefined;
E=false;
CQ.Ext.each(G.before,function(J){B(J.fn,J.scope,I);
if(E){return D
}});
if(!CQ.Ext.isEmpty(C=G.originalFn.apply(F,I))){D=C
}CQ.Ext.each(G.after,function(J){B(J.fn,J.scope,I);
if(E){return D
}});
return D
}
}return G
}return{beforeMethod:function(D,C,B){A.call(this,D).before.push({fn:C,scope:B})
},afterMethod:function(D,C,B){A.call(this,D).after.push({fn:C,scope:B})
},removeMethodListener:function(F,C,B){var E=A.call(this,F),D=false;
CQ.Ext.each(E.before,function(H,I,G){if(H.fn==C&&H.scope==B){G.splice(I,1);
D=true;
return false
}});
if(!D){CQ.Ext.each(E.after,function(H,I,G){if(H.fn==C&&H.scope==B){G.splice(I,1);
return false
}})
}},relayEvents:function(E,B){var D=this;
function C(F){return function(){return D.fireEvent.apply(D,[F].concat(CQ.Ext.toArray(arguments)))
}
}CQ.Ext.each(B,function(F){D.events[F]=D.events[F]||true;
E.on(F,C(F),D)
})
},enableBubble:function(B){var C=this;
if(!CQ.Ext.isEmpty(B)){B=CQ.Ext.isArray(B)?B:CQ.Ext.toArray(arguments);
CQ.Ext.each(B,function(D){D=D.toLowerCase();
var E=C.events[D]||true;
if(CQ.Ext.isBoolean(E)){E=new CQ.Ext.util.Event(C,D);
C.events[D]=E
}E.bubble=true
})
}}}
}());
CQ.Ext.util.Observable.capture=function(C,B,A){C.fireEvent=C.fireEvent.createInterceptor(B,A)
};
CQ.Ext.util.Observable.observeClass=function(B,A){if(B){if(!B.fireEvent){CQ.Ext.apply(B,new CQ.Ext.util.Observable());
CQ.Ext.util.Observable.capture(B.prototype,B.fireEvent,B)
}if(CQ.Ext.isObject(A)){B.on(A)
}return B
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.EventManager=function(){var a,R,M=false,Q=CQ.Ext.lib.Event,S=CQ.Ext.lib.Dom,C=document,b=window,J="ie-deferred-loader",T="DOMContentLoaded",K=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,V=[];
var A="CQ";
function O(d){var k=false,E=0,D=V.length,k=false,g=false,j;
if(d){if(d.getElementById||d.navigator){for(;
E<D;
++E){j=V[E];
if(j.el===d){k=j.id;
break
}}if(!k){k=CQ.Ext.id(d);
V.push({id:k,el:d});
g=true
}}else{k=CQ.Ext.id(d)
}if(!CQ.Ext.elCache[k]){CQ.Ext.Element.addToCache(new CQ.Ext.Element(d),k);
if(g){CQ.Ext.elCache[k].skipGC=true
}}}return k
}function N(d,j,n,g,E,q){d=CQ.Ext.getDom(d);
var D=O(d),o=CQ.Ext.elCache[D].events,k;
k=Q.on(d,j,E);
o[j]=o[j]||[];
o[j].push([n,E,q,k,g]);
if(d.addEventListener&&j=="mousewheel"){var m=["DOMMouseScroll",E,false];
d.addEventListener.apply(d,m);
CQ.Ext.EventManager.addListener(b,"unload",function(){d.removeEventListener.apply(d,m)
})
}if(d==C&&j=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.addListener(E)
}}function F(){if(!M){CQ.Ext.isReady=M=true;
if(R){clearInterval(R)
}if(CQ.Ext.isGecko||CQ.Ext.isOpera){C.removeEventListener(T,F,false)
}if(CQ.Ext.isIE){var D=C.getElementById(J);
if(D){D.onreadystatechange=null;
D.parentNode.removeChild(D)
}}if(a){a.fire();
a.listeners=[]
}}}function B(){var D="complete";
a=new CQ.Ext.util.Event();
if(CQ.Ext.isGecko||CQ.Ext.isOpera){C.addEventListener(T,F,false)
}else{if(CQ.Ext.isIE){C.write("<script id="+J+' defer="defer" src="//:"><\/script>');
C.getElementById(J).onreadystatechange=function(){if(this.readyState==D){F()
}}
}else{if(CQ.Ext.isWebKit){R=setInterval(function(){if(C.readyState==D){F()
}},10)
}}}Q.on(b,"load",F)
}function Y(D,E){return function(){var d=CQ.Ext.toArray(arguments);
if(E.target==CQ.Ext.EventObject.setEvent(d[0]).target){D.apply(this,d)
}}
}function X(E,d,D){return function(g){D.delay(d.buffer,E,null,[new CQ.Ext.EventObjectImpl(g)])
}
}function U(j,g,D,d,E){return function(k){CQ.Ext.EventManager.removeListener(g,D,d,E);
j(k)
}
}function H(E,d,D){return function(j){var g=new CQ.Ext.util.DelayedTask(E);
if(!D.tasks){D.tasks=[]
}D.tasks.push(g);
g.delay(d.delay||10,E,null,[new CQ.Ext.EventObjectImpl(j)])
}
}function L(k,j,D,n,q){var E=!CQ.Ext.isObject(D)?{}:D,d=CQ.Ext.getDom(k),g;
n=n||E.fn;
q=q||E.scope;
if(!d){throw'Error listening for "'+j+'". Element "'+k+"\" doesn't exist."
}function m(r){if(!CQ.Ext){return 
}r=CQ.Ext.EventObject.setEvent(r);
var o;
if(E.delegate){if(!(o=r.getTarget(E.delegate,d))){return 
}}else{o=r.target
}if(E.stopEvent){r.stopEvent()
}if(E.preventDefault){r.preventDefault()
}if(E.stopPropagation){r.stopPropagation()
}if(E.normalized){r=r.browserEvent
}n.call(q||d,r,o,E)
}if(E.target){m=Y(m,E)
}if(E.delay){m=H(m,E,n)
}if(E.single){m=U(m,d,j,n,q)
}if(E.buffer){g=new CQ.Ext.util.DelayedTask(m);
m=X(m,E,g)
}N(d,j,n,g,m,q);
return m
}var Z,c,I=false;
function G(){if(!I){I=true;
CQ.Ext.isLoaded=true;
if(c){clearInterval(c)
}if(Z){Z.fire();
Z.clearListeners()
}}}function P(){Z=new CQ.Ext.util.Event();
Q.on(window,"load",G)
}var W={addListener:function(d,D,j,g,E){if(CQ.Ext.isObject(D)){var n=D,k,m;
for(k in n){m=n[k];
if(!K.test(k)){if(CQ.Ext.isFunction(m)){L(d,k,n,m,n.scope)
}else{L(d,k,m)
}}}}else{L(d,D,E,j,g)
}},removeListener:function(d,n,t,u){d=CQ.Ext.getDom(d);
var D=O(d),q=d&&(CQ.Ext.elCache[D].events)[n]||[],E,m,g,j,o,r;
for(m=0,o=q.length;
m<o;
m++){if(CQ.Ext.isArray(r=q[m])&&r[0]==t&&(!u||r[2]==u)){if(r[4]){r[4].cancel()
}j=t.tasks&&t.tasks.length;
if(j){while(j--){t.tasks[j].cancel()
}delete t.tasks
}E=r[1];
Q.un(d,n,Q.extAdapter?r[3]:E);
if(E&&d.addEventListener&&n=="mousewheel"){d.removeEventListener("DOMMouseScroll",E,false)
}if(E&&d==C&&n=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.removeListener(E)
}q.splice(m,1);
if(q.length===0){delete CQ.Ext.elCache[D].events[n]
}for(j in CQ.Ext.elCache[D].events){return false
}CQ.Ext.elCache[D].events={};
return false
}}},removeAll:function(d){d=CQ.Ext.getDom(d);
var E=O(d),o=CQ.Ext.elCache[E]||{},t=o.events||{},n,m,q,g,r,j,D;
for(g in t){if(t.hasOwnProperty(g)){n=t[g];
for(m=0,q=n.length;
m<q;
m++){r=n[m];
if(r[4]){r[4].cancel()
}if(r[0].tasks&&(j=r[0].tasks.length)){while(j--){r[0].tasks[j].cancel()
}delete r.tasks
}D=r[1];
Q.un(d,g,Q.extAdapter?r[3]:D);
if(d.addEventListener&&D&&g=="mousewheel"){d.removeEventListener("DOMMouseScroll",D,false)
}if(D&&d==C&&g=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.removeListener(D)
}}}}if(CQ.Ext.elCache[E]){CQ.Ext.elCache[E].events={}
}},getListeners:function(g,D){g=CQ.Ext.getDom(g);
var k=O(g),E=CQ.Ext.elCache[k]||{},j=E.events||{},d=[];
if(j&&j[D]){return j[D]
}else{return null
}},purgeElement:function(d,D,j){d=CQ.Ext.getDom(d);
var E=O(d),n=CQ.Ext.elCache[E]||{},o=n.events||{},g,m,k;
if(j){if(o&&o.hasOwnProperty(j)){m=o[j];
for(g=0,k=m.length;
g<k;
g++){CQ.Ext.EventManager.removeListener(d,j,m[g][0])
}}}else{CQ.Ext.EventManager.removeAll(d)
}if(D&&d&&d.childNodes){for(g=0,k=d.childNodes.length;
g<k;
g++){CQ.Ext.EventManager.purgeElement(d.childNodes[g],D,j)
}}},_unload:function(){var D;
for(D in CQ.Ext.elCache){CQ.Ext.EventManager.removeAll(D)
}delete CQ.Ext.elCache;
delete CQ.Ext.Element._flyweights
},onWindowLoaded:function(d,E,D){if(I){Z.addListener(d,E,D);
Z.fire();
Z.clearListeners();
return 
}if(!Z){P()
}Z.addListener(d,E,D)
},onDocumentReady:function(d,E,D){if(M){a.addListener(d,E,D);
a.fire();
a.listeners=[]
}else{if(!a){B()
}D=D||{};
D.delay=D.delay||1;
a.addListener(d,E,D)
}}};
W.on=W.addListener;
W.un=W.removeListener;
W.stoppedMouseDownEvent=new CQ.Ext.util.Event();
return W
}();
CQ.Ext.onReady=CQ.Ext.EventManager.onDocumentReady;
CQ.Ext.onLoad=CQ.Ext.EventManager.onWindowLoaded;
(function(){var A=function(){var C=document.body||document.getElementsByTagName("body")[0];
if(!C){return false
}var B=[" ",CQ.Ext.isIE?"ext-ie "+(CQ.Ext.isIE6?"ext-ie6":(CQ.Ext.isIE7?"ext-ie7":"ext-ie8")):CQ.Ext.isGecko?"ext-gecko "+(CQ.Ext.isGecko2?"ext-gecko2":"ext-gecko3"):CQ.Ext.isOpera?"ext-opera":CQ.Ext.isWebKit?"ext-webkit":""];
if(CQ.Ext.isSafari){B.push("ext-safari "+(CQ.Ext.isSafari2?"ext-safari2":(CQ.Ext.isSafari3?"ext-safari3":"ext-safari4")))
}else{if(CQ.Ext.isChrome){B.push("ext-chrome")
}}if(CQ.Ext.isMac){B.push("ext-mac")
}if(CQ.Ext.isLinux){B.push("ext-linux")
}if(CQ.Ext.isStrict||CQ.Ext.isBorderBox){var D=C.parentNode;
if(D){D.className+=CQ.Ext.isStrict?" ext-strict":" ext-border-box"
}}C.className+=B.join(" ");
return true
};
if(!A()){CQ.Ext.onReady(A)
}})();
CQ.Ext.EventObject=function(){var B=CQ.Ext.lib.Event,A={3:13,63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},C=CQ.Ext.isIE?{1:0,4:1,2:2}:(CQ.Ext.isWebKit?{1:0,2:1,3:2}:{0:0,1:1,2:2});
CQ.Ext.EventObjectImpl=function(D){if(D){this.setEvent(D.browserEvent||D)
}};
CQ.Ext.EventObjectImpl.prototype={setEvent:function(E){var D=this;
if(E==D||(E&&E.browserEvent)){return E
}D.browserEvent=E;
if(E){D.button=E.button?C[E.button]:(E.which?E.which-1:-1);
if(E.type=="click"&&D.button==-1){D.button=0
}D.type=E.type;
D.shiftKey=E.shiftKey;
D.ctrlKey=E.ctrlKey||E.metaKey||false;
D.altKey=E.altKey;
D.keyCode=E.keyCode;
D.charCode=E.charCode;
D.target=B.getTarget(E);
D.xy=B.getXY(E)
}else{D.button=-1;
D.shiftKey=false;
D.ctrlKey=false;
D.altKey=false;
D.keyCode=0;
D.charCode=0;
D.target=null;
D.xy=[0,0]
}return D
},stopEvent:function(){var D=this;
if(D.browserEvent){if(D.browserEvent.type=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.fire(D)
}B.stopEvent(D.browserEvent)
}},preventDefault:function(){if(this.browserEvent){B.preventDefault(this.browserEvent)
}},stopPropagation:function(){var D=this;
if(D.browserEvent){if(D.browserEvent.type=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.fire(D)
}B.stopPropagation(D.browserEvent)
}},getCharCode:function(){return this.charCode||this.keyCode
},getKey:function(){return this.normalizeKey(this.keyCode||this.charCode)
},normalizeKey:function(D){return CQ.Ext.isSafari?(A[D]||D):D
},getPageX:function(){return this.xy[0]
},getPageY:function(){return this.xy[1]
},getXY:function(){return this.xy
},getTarget:function(E,F,D){return E?CQ.Ext.fly(this.target).findParent(E,F,D):(D?CQ.Ext.get(this.target):this.target)
},getRelatedTarget:function(){return this.browserEvent?B.getRelatedTarget(this.browserEvent):null
},getWheelDelta:function(){var D=this.browserEvent;
var E=0;
if(D.wheelDelta){E=D.wheelDelta/120
}else{if(D.detail){E=-D.detail/3
}}return E
},within:function(F,G,D){if(F){var E=this[G?"getRelatedTarget":"getTarget"]();
return E&&((D?(E==CQ.Ext.getDom(F)):false)||CQ.Ext.fly(F).contains(E))
}return false
}};
return new CQ.Ext.EventObjectImpl()
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.EventManager,function(){var C,J,F,B,A=CQ.Ext.lib.Dom,I=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,H=0,G=0,E=CQ.Ext.isWebKit?CQ.Ext.num(navigator.userAgent.match(/AppleWebKit\/(\d+)/)[1])>=525:!((CQ.Ext.isGecko&&!CQ.Ext.isWindows)||CQ.Ext.isOpera);
return{doResizeEvent:function(){var K=A.getViewHeight(),D=A.getViewWidth();
if(G!=K||H!=D){C.fire(H=D,G=K)
}},onWindowResize:function(L,K,D){if(!C){C=new CQ.Ext.util.Event();
J=new CQ.Ext.util.DelayedTask(this.doResizeEvent);
CQ.Ext.EventManager.on(window,"resize",this.fireWindowResize,this)
}C.addListener(L,K,D)
},fireWindowResize:function(){if(C){J.delay(100)
}},onTextResize:function(M,L,D){if(!F){F=new CQ.Ext.util.Event();
var K=new CQ.Ext.Element(document.createElement("div"));
K.dom.className="x-text-resize";
K.dom.innerHTML="X";
K.appendTo(document.body);
B=K.dom.offsetHeight;
setInterval(function(){if(K.dom.offsetHeight!=B){F.fire(B,B=K.dom.offsetHeight)
}},this.textResizeInterval)
}F.addListener(M,L,D)
},removeResizeListener:function(K,D){if(C){C.removeListener(K,D)
}},fireResize:function(){if(C){C.fire(A.getViewWidth(),A.getViewHeight())
}},textResizeInterval:50,ieDeferSrc:false,useKeydown:E}
}());
CQ.Ext.EventManager.on=CQ.Ext.EventManager.addListener;
CQ.Ext.apply(CQ.Ext.EventObjectImpl.prototype,{BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGEUP:33,PAGE_DOWN:34,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,isNavKeyPress:function(){var B=this,A=this.normalizeKey(B.keyCode);
return(A>=33&&A<=40)||A==B.RETURN||A==B.TAB||A==B.ESC
},isSpecialKey:function(){var A=this.normalizeKey(this.keyCode);
return(this.type=="keypress"&&this.ctrlKey)||this.isNavKeyPress()||(A==this.BACKSPACE)||(A>=16&&A<=20)||(A>=44&&A<=45)
},getPoint:function(){return new CQ.Ext.lib.Point(this.xy[0],this.xy[1])
},hasModifier:function(){return((this.ctrlKey||this.altKey)||this.shiftKey)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var L=document;
CQ.Ext.Element=function(A,D){var E=typeof A=="string"?L.getElementById(A):A,Q;
if(!E){return null
}Q=E.id;
if(!D&&Q&&CQ.Ext.elCache[Q]){return CQ.Ext.elCache[Q].el
}this.dom=E;
this.id=Q||CQ.Ext.id(E)
};
var B=CQ.Ext.lib.Dom,I=CQ.Ext.DomHelper,O=CQ.Ext.lib.Event,H=CQ.Ext.lib.Anim,J=CQ.Ext.Element,C=CQ.Ext.elCache;
J.prototype={set:function(R,D){var E=this.dom,A,Q,D=(D!==false)&&!!E.setAttribute;
for(A in R){if(R.hasOwnProperty(A)){Q=R[A];
if(A=="style"){I.applyStyles(E,Q)
}else{if(A=="cls"){E.className=Q
}else{if(D){E.setAttribute(A,Q)
}else{E[A]=Q
}}}}}return this
},defaultUnit:"px",is:function(A){return CQ.Ext.DomQuery.is(this.dom,A)
},focus:function(Q,E){var A=this,E=E||A.dom;
try{if(Number(Q)){A.focus.defer(Q,null,[null,E])
}else{E.focus()
}}catch(D){}return A
},blur:function(){try{this.dom.blur()
}catch(A){}return this
},getValue:function(A){var D=this.dom.value;
return A?parseInt(D,10):D
},addListener:function(A,Q,E,D){CQ.Ext.EventManager.on(this.dom,A,Q,E||this,D);
return this
},removeListener:function(A,E,D){CQ.Ext.EventManager.removeListener(this.dom,A,E,D||this);
return this
},removeAllListeners:function(){CQ.Ext.EventManager.removeAll(this.dom);
return this
},purgeAllListeners:function(){CQ.Ext.EventManager.purgeElement(this,true);
return this
},addUnits:function(A){if(A===""||A=="auto"||A===undefined){A=A||""
}else{if(!isNaN(A)||!M.test(A)){A=A+(this.defaultUnit||"px")
}}return A
},load:function(D,E,A){CQ.Ext.Ajax.request(CQ.Ext.apply({params:E,url:D.url||D,callback:A,el:this.dom,indicatorText:D.indicatorText||""},CQ.Ext.isObject(D)?D:{}));
return this
},isBorderBox:function(){return K[(this.dom.tagName||"").toLowerCase()]||CQ.Ext.isBorderBox
},remove:function(){var A=this,D=A.dom;
if(D){delete A.dom;
CQ.Ext.removeNode(D)
}},hover:function(D,A,Q,E){var R=this;
R.on("mouseenter",D,Q||R.dom,E);
R.on("mouseleave",A,Q||R.dom,E);
return R
},contains:function(A){return !A?false:CQ.Ext.lib.Dom.isAncestor(this.dom,A.dom?A.dom:A)
},getAttributeNS:function(D,A){return this.getAttribute(A,D)
},getAttribute:CQ.Ext.isIE?function(A,E){var Q=this.dom,D=typeof Q[E+":"+A];
if(["undefined","unknown"].indexOf(D)==-1){return Q[E+":"+A]
}return Q[A]
}:function(A,D){var E=this.dom;
return E.getAttributeNS(D,A)||E.getAttribute(D+":"+A)||E.getAttribute(A)||E[A]
},update:function(A){if(this.dom){this.dom.innerHTML=A
}return this
}};
var P=J.prototype;
J.addMethods=function(A){CQ.Ext.apply(P,A)
};
P.on=P.addListener;
P.un=P.removeListener;
P.autoBoxAdjust=true;
var M=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,G;
J.get=function(D){var A,R,Q;
if(!D){return null
}if(typeof D=="string"){if(!(R=L.getElementById(D))){if(CQ.Util.isRoot(D)){return CQ.Util.createRoot()
}return null
}if(C[D]&&C[D].el){A=C[D].el;
A.dom=R
}else{A=J.addToCache(new J(R))
}return A
}else{if(D.tagName){if(!(Q=D.id)){Q=CQ.Ext.id(D)
}if(C[Q]&&C[Q].el){A=C[Q].el;
A.dom=D
}else{A=J.addToCache(new J(D))
}return A
}else{if(D instanceof J){if(D!=G){D.dom=L.getElementById(D.id)||D.dom
}return D
}else{if(D.isComposite){return D
}else{if(CQ.Ext.isArray(D)){return J.select(D)
}else{if(D==L){if(!G){var E=function(){};
E.prototype=J.prototype;
G=new E();
G.dom=L
}return G
}}}}}}return null
};
J.addToCache=function(A,D){D=D||A.id;
C[D]={el:A,data:{},events:{}};
return A
};
J.data=function(D,A,E){D=J.get(D);
if(!D){return null
}var Q=C[D.id].data;
if(arguments.length==2){return Q[A]
}else{return(Q[A]=E)
}};
function N(){if(!CQ.Ext.enableGarbageCollector){clearInterval(J.collectorThreadId)
}else{var A,E,R,Q;
for(A in C){Q=C[A];
if(Q.skipGC){continue
}E=Q.el;
R=E.dom;
if(!R||!R.parentNode||(!R.offsetParent&&!L.getElementById(A))){if(CQ.Ext.enableListenerCollection){CQ.Ext.EventManager.removeAll(R)
}delete C[A]
}}if(CQ.Ext.isIE){var D={};
for(A in C){D[A]=C[A]
}C=CQ.Ext.elCache=D
}}}J.collectorThreadId=setInterval(N,30000);
var F=function(){};
F.prototype=J.prototype;
J.Flyweight=function(A){this.dom=A
};
J.Flyweight.prototype=new F();
J.Flyweight.prototype.isFlyweight=true;
J._flyweights={};
J.fly=function(E,A){var D=null;
A=A||"_global";
if(E=CQ.Ext.getDom(E)){(J._flyweights[A]=J._flyweights[A]||new J.Flyweight()).dom=E;
D=J._flyweights[A]
}return D
};
CQ.Ext.get=J.get;
CQ.Ext.fly=J.fly;
var K=CQ.Ext.isStrict?{select:1}:{input:1,select:1,textarea:1};
if(CQ.Ext.isIE||CQ.Ext.isGecko){K.button=1
}})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({swallowEvent:function(A,B){var D=this;
function C(E){E.stopPropagation();
if(B){E.preventDefault()
}}if(CQ.Ext.isArray(A)){CQ.Ext.each(A,function(E){D.on(E,C)
});
return D
}D.on(A,C);
return D
},relayEvent:function(A,B){this.on(A,function(C){B.fireEvent(A,C)
})
},clean:function(B){var D=this,E=D.dom,F=E.firstChild,C=-1;
if(CQ.Ext.Element.data(E,"isCleaned")&&B!==true){return D
}while(F){var A=F.nextSibling;
if(F.nodeType==3&&!/\S/.test(F.nodeValue)){E.removeChild(F)
}else{F.nodeIndex=++C
}F=A
}CQ.Ext.Element.data(E,"isCleaned",true);
return D
},load:function(){var A=this.getUpdater();
A.update.apply(A,arguments);
return this
},getUpdater:function(){return this.updateManager||(this.updateManager=new CQ.Ext.Updater(this))
},update:function(html,loadScripts,callback){if(!this.dom){return this
}html=html||"";
if(loadScripts!==true){this.dom.innerHTML=html;
if(CQ.Ext.isFunction(callback)){callback()
}return this
}var id=CQ.Ext.id(),dom=this.dom;
html+='<span id="'+id+'"></span>';
CQ.Ext.lib.Event.onAvailable(id,function(){var DOC=document,hd=DOC.getElementsByTagName("head")[0],re=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig,srcRe=/\ssrc=([\'\"])(.*?)\1/i,typeRe=/\stype=([\'\"])(.*?)\1/i,match,attrs,srcMatch,typeMatch,el,s;
while((match=re.exec(html))){attrs=match[1];
srcMatch=attrs?attrs.match(srcRe):false;
if(srcMatch&&srcMatch[2]){s=DOC.createElement("script");
s.src=srcMatch[2];
typeMatch=attrs.match(typeRe);
if(typeMatch&&typeMatch[2]){s.type=typeMatch[2]
}hd.appendChild(s)
}else{if(match[2]&&match[2].length>0){if(window.execScript){window.execScript(match[2])
}else{window.eval(match[2])
}}}}el=DOC.getElementById(id);
if(el){CQ.Ext.removeNode(el)
}if(CQ.Ext.isFunction(callback)){callback()
}});
dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"");
return this
},removeAllListeners:function(){this.removeAnchor();
CQ.Ext.EventManager.removeAll(this.dom);
return this
},createProxy:function(A,E,D){A=CQ.Ext.isObject(A)?A:{tag:"div",cls:A};
var C=this,B=E?CQ.Ext.DomHelper.append(E,A,true):CQ.Ext.DomHelper.insertBefore(C.dom,A,true);
if(D&&C.setBox&&C.getBox){B.setBox(C.getBox())
}return B
}});
CQ.Ext.Element.prototype.getUpdateManager=CQ.Ext.Element.prototype.getUpdater;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({getAnchorXY:function(E,J,N){E=(E||"tl").toLowerCase();
N=N||{};
var I=this,B=I.dom==document.body||I.dom==document,L=N.width||B?CQ.Ext.lib.Dom.getViewWidth():I.getWidth(),G=N.height||B?CQ.Ext.lib.Dom.getViewHeight():I.getHeight(),M,A=Math.round,C=I.getXY(),K=I.getScroll(),H=B?K.left:!J?C[0]:0,F=B?K.top:!J?C[1]:0,D={c:[A(L*0.5),A(G*0.5)],t:[A(L*0.5),0],l:[0,A(G*0.5)],r:[L,A(G*0.5)],b:[A(L*0.5),G],tl:[0,0],bl:[0,G],br:[L,G],tr:[L,0]};
M=D[E];
return[M[0]+H,M[1]+F]
},anchorTo:function(B,G,C,A,J,K){var H=this,E=H.dom,I=!CQ.Ext.isEmpty(J),D=function(){CQ.Ext.fly(E).alignTo(B,G,C,A);
CQ.Ext.callback(K,CQ.Ext.fly(E))
},F=this.getAnchor();
this.removeAnchor();
CQ.Ext.apply(F,{fn:D,scroll:I});
CQ.Ext.EventManager.onWindowResize(D,null);
if(I){CQ.Ext.EventManager.on(window,"scroll",D,null,{buffer:!isNaN(J)?J:50})
}D.call(H);
return H
},removeAnchor:function(){var B=this,A=this.getAnchor();
if(A&&A.fn){CQ.Ext.EventManager.removeResizeListener(A.fn);
if(A.scroll){CQ.Ext.EventManager.un(window,"scroll",A.fn)
}delete A.fn
}return B
},getAnchor:function(){var B=CQ.Ext.Element.data,C=this.dom;
if(!C){return 
}var A=B(C,"_anchor");
if(!A){A=B(C,"_anchor",{})
}return A
},getAlignToXY:function(D,P,Q){D=CQ.Ext.get(D);
if(!D||!D.dom){throw"Element.alignToXY with an element that doesn't exist"
}Q=Q||[0,0];
P=(!P||P=="?"?"tl-bl?":(!/-/.test(P)&&P!==""?"tl-"+P:P||"tl-bl")).toLowerCase();
var Z=this,W=Z.dom,b,a,I,H,K,U,N,L=CQ.Ext.lib.Dom.getViewWidth()-10,V=CQ.Ext.lib.Dom.getViewHeight()-10,B,E,F,G,M,O,g=document,Y=g.documentElement,J=g.body,T=(Y.scrollLeft||J.scrollLeft||0)+5,S=(Y.scrollTop||J.scrollTop||0)+5,X=false,C="",A="",R=P.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!R){throw"Element.alignTo with an invalid alignment "+P
}C=R[1];
A=R[2];
X=!!R[3];
b=Z.getAnchorXY(C,true);
a=D.getAnchorXY(A,false);
I=a[0]-b[0]+Q[0];
H=a[1]-b[1]+Q[1];
if(X){K=Z.getWidth();
U=Z.getHeight();
N=D.getRegion();
B=C.charAt(0);
E=C.charAt(C.length-1);
F=A.charAt(0);
G=A.charAt(A.length-1);
M=((B=="t"&&F=="b")||(B=="b"&&F=="t"));
O=((E=="r"&&G=="l")||(E=="l"&&G=="r"));
if(I+K>L+T){I=O?N.left-K:L+T-K
}if(I<T){I=O?N.right:T
}if(H+U>V+S){H=M?N.top-U:V+S-U
}if(H<S){H=M?N.bottom:S
}}return[I,H]
},alignTo:function(C,A,E,B){var D=this;
return D.setXY(D.getAlignToXY(C,A,E),D.preanim&&!!B?D.preanim(arguments,3):false)
},adjustForConstraints:function(C,A,B){return this.getConstrainToXY(A||document,false,B,C)||C
},getConstrainToXY:function(B,A,C,E){var D={top:0,left:0,bottom:0,right:0};
return function(G,T,I,K){G=CQ.Ext.get(G);
I=I?CQ.Ext.applyIf(I,D):D;
var S,W,R=0,Q=0;
if(G.dom==document.body||G.dom==document){S=CQ.Ext.lib.Dom.getViewWidth();
W=CQ.Ext.lib.Dom.getViewHeight()
}else{S=G.dom.clientWidth;
W=G.dom.clientHeight;
if(!T){var P=G.getXY();
R=P[0];
Q=P[1]
}}var O=G.getScroll();
R+=I.left+O.left;
Q+=I.top+O.top;
S-=I.right;
W-=I.bottom;
var U=R+S;
var F=Q+W;
var H=K||(!T?this.getXY():[this.getLeft(true),this.getTop(true)]);
var M=H[0],L=H[1];
var N=this.dom.offsetWidth,V=this.dom.offsetHeight;
var J=false;
if((M+N)>U){M=U-N;
J=true
}if((L+V)>F){L=F-V;
J=true
}if(M<R){M=R;
J=true
}if(L<Q){L=Q;
J=true
}return J?[M,L]:false
}
}(),getCenterXY:function(){return this.getAlignToXY(document,"c-c")
},center:function(A){return this.alignTo(A||document,"c-c")
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods(function(){var D="parentNode",B="nextSibling",C="previousSibling",E=CQ.Ext.DomQuery,A=CQ.Ext.get;
return{findParent:function(L,K,G){var I=this.dom,F=document.body,J=0,H;
if(CQ.Ext.isGecko&&Object.prototype.toString.call(I)=="[object XULElement]"){return null
}K=K||50;
if(isNaN(K)){H=CQ.Ext.getDom(K);
K=Number.MAX_VALUE
}while(I&&I.nodeType==1&&J<K&&I!=F&&I!=H){if(E.is(I,L)){return G?A(I):I
}J++;
I=I.parentNode
}return null
},findParentNode:function(I,H,F){var G=CQ.Ext.fly(this.dom.parentNode,"_internal");
return G?G.findParent(I,H,F):null
},up:function(G,F){return this.findParentNode(G,F,true)
},select:function(F){return CQ.Ext.Element.select(F,this.dom)
},query:function(F){return E.select(F,this.dom)
},child:function(F,G){var H=E.selectNode(F,this.dom);
return G?H:A(H)
},down:function(F,G){var H=E.selectNode(" > "+F,this.dom);
return G?H:A(H)
},parent:function(F,G){return this.matchNode(D,D,F,G)
},next:function(F,G){return this.matchNode(B,B,F,G)
},prev:function(F,G){return this.matchNode(C,C,F,G)
},first:function(F,G){return this.matchNode(B,"firstChild",F,G)
},last:function(F,G){return this.matchNode(C,"lastChild",F,G)
},matchNode:function(G,J,F,H){var I=this.dom[J];
while(I){if(I.nodeType==1&&(!F||E.is(I,F))){return !H?A(I):I
}I=I[G]
}return null
}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({select:function(A,B){return CQ.Ext.Element.select(A,B,this.dom)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods(function(){var C=CQ.Ext.getDom,A=CQ.Ext.get,B=CQ.Ext.DomHelper;
return{appendChild:function(D){return A(D).appendTo(this)
},appendTo:function(D){if(CQ.Util.isRoot(D)){D=CQ.Util.getRoot()
}C(D).appendChild(this.dom);
return this
},insertBefore:function(D){(D=C(D)).parentNode.insertBefore(this.dom,D);
return this
},insertAfter:function(D){(D=C(D)).parentNode.insertBefore(this.dom,D.nextSibling);
return this
},insertFirst:function(E,D){E=E||{};
if(E.nodeType||E.dom||typeof E=="string"){E=C(E);
this.dom.insertBefore(E,this.dom.firstChild);
return !D?A(E):E
}else{return this.createChild(E,this.dom.firstChild,D)
}},replace:function(D){D=A(D);
this.insertBefore(D);
D.remove();
return this
},replaceWith:function(D){var E=this;
if(D.nodeType||D.dom||typeof D=="string"){D=C(D);
E.dom.parentNode.insertBefore(D,E.dom)
}else{D=B.insertBefore(E.dom,D)
}delete CQ.Ext.elCache[E.id];
CQ.Ext.removeNode(E.dom);
E.id=CQ.Ext.id(E.dom=D);
CQ.Ext.Element.addToCache(E.isFlyweight?new CQ.Ext.Element(E.dom):E);
return E
},createChild:function(E,D,F){E=E||{tag:"div"};
return D?B.insertBefore(D,E,F!==true):B[!this.dom.firstChild?"overwrite":"append"](this.dom,E,F!==true)
},wrap:function(D,E){var F=B.insertBefore(this.dom,D||{tag:"div"},!E);
F.dom?F.dom.appendChild(this.dom):F.appendChild(this.dom);
return F
},insertHtml:function(E,F,D){var G=B.insertHtml(E,this.dom,F);
return D?CQ.Ext.get(G):G
}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.Element.prototype,function(){var C=CQ.Ext.getDom,A=CQ.Ext.get,B=CQ.Ext.DomHelper;
return{insertSibling:function(H,F,G){var I=this,E,D=(F||"before").toLowerCase()=="after",J;
if(CQ.Ext.isArray(H)){J=I;
CQ.Ext.each(H,function(K){E=CQ.Ext.fly(J,"_internal").insertSibling(K,F,G);
if(D){J=E
}});
return E
}H=H||{};
if(H.nodeType||H.dom){E=I.dom.parentNode.insertBefore(C(H),D?I.dom.nextSibling:I.dom);
if(!G){E=A(E)
}}else{if(D&&!I.dom.nextSibling){E=B.append(I.dom.parentNode,H,!G)
}else{E=B[D?"insertAfter":"insertBefore"](I.dom,H,!G)
}}return E
}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods(function(){var G={},W=/(-[a-z])/gi,B={},R=document.defaultView,T=CQ.Ext.isIE?"styleFloat":"cssFloat",b=/alpha\(opacity=(.*)\)/i,K=/^\s+|\s+$/g,Z=CQ.Ext.Element,D="padding",C="margin",X="border",S="-left",P="-right",V="-top",N="-bottom",I="-width",Q=Math,Y="hidden",E="isClipped",J="overflow",M="overflow-x",L="overflow-y",a="originalClip",H={l:X+S+I,r:X+P+I,t:X+V+I,b:X+N+I},F={l:D+S,r:D+P,t:D+V,b:D+N},A={l:C+S,r:C+P,t:C+V,b:C+N},c=CQ.Ext.Element.data;
function O(d,g){return g.charAt(1).toUpperCase()
}function U(d){return G[d]||(G[d]=d=="float"?T:d.replace(W,O))
}return{adjustWidth:function(d){var g=this;
var j=CQ.Ext.isNumber(d);
if(j&&g.autoBoxAdjust&&!g.isBorderBox()){d-=(g.getBorderWidth("lr")+g.getPadding("lr"))
}return(j&&d<0)?0:d
},adjustHeight:function(d){var g=this;
var j=CQ.Ext.isNumber(d);
if(j&&g.autoBoxAdjust&&!g.isBorderBox()){d-=(g.getBorderWidth("tb")+g.getPadding("tb"))
}return(j&&d<0)?0:d
},addClass:function(k){var m=this,j,d,g;
k=CQ.Ext.isArray(k)?k:[k];
for(j=0,d=k.length;
j<d;
j++){g=k[j];
if(g){m.dom.className+=(!m.hasClass(g)&&g?" "+g:"")
}}return m
},radioClass:function(k){var m=this.dom.parentNode.childNodes,g;
k=CQ.Ext.isArray(k)?k:[k];
for(var j=0,d=m.length;
j<d;
j++){g=m[j];
if(g&&g.nodeType==1){CQ.Ext.fly(g,"_internal").removeClass(k)
}}return this.addClass(k)
},removeClass:function(k){var m=this,g;
k=CQ.Ext.isArray(k)?k:[k];
if(m.dom&&m.dom.className){for(var j=0,d=k.length;
j<d;
j++){g=k[j];
if(g){m.dom.className=m.dom.className.replace(B[g]=B[g]||new RegExp("(?:^|\\s+)"+g+"(?:\\s+|$)","g")," ")
}}}return m
},toggleClass:function(d){return this.hasClass(d)?this.removeClass(d):this.addClass(d)
},hasClass:function(d){return d&&(" "+this.dom.className+" ").indexOf(" "+d+" ")!=-1
},replaceClass:function(g,d){return this.removeClass(g).addClass(d)
},isStyle:function(d,g){return this.getStyle(d)==g
},getStyle:function(){return R&&R.getComputedStyle?function(o){var k=this.dom,d,j,g,m,n=CQ.Ext.isWebKit,m;
if(k==document){return null
}o=U(o);
if(n&&/marginRight/.test(o)){m=this.getStyle("display");
k.style.display="inline-block"
}g=(d=k.style[o])?d:(j=R.getComputedStyle(k,""))?j[o]:null;
if(n){if(g=="rgba(0, 0, 0, 0)"){g="transparent"
}else{if(m){k.style.display=m
}}}return g
}:function(n){var j=this.dom,d,g;
if(j==document){return null
}if(n=="opacity"){if(j.style.filter.match){if(d=j.style.filter.match(b)){var k=parseFloat(d[1]);
if(!isNaN(k)){return k?k/100:0
}}}return 1
}n=U(n);
return j.style[n]||((g=j.currentStyle)?g[n]:null)
}
}(),getColor:function(d,g,n){var k=this.getStyle(d),j=CQ.Ext.isDefined(n)?n:"#",m;
if(!k||/transparent|inherit/.test(k)){return g
}if(/^r/.test(k)){CQ.Ext.each(k.slice(4,k.length-1).split(","),function(o){m=parseInt(o,10);
j+=(m<16?"0":"")+m.toString(16)
})
}else{k=k.replace("#","");
j+=k.length==3?k.replace(/^(\w)(\w)(\w)$/,"$1$1$2$2$3$3"):k
}return(j.length>5?j.toLowerCase():g)
},setStyle:function(m,k){var g,j,d;
if(!CQ.Ext.isObject(m)){g={};
g[m]=k;
m=g
}for(j in m){k=m[j];
j=="opacity"?this.setOpacity(k):this.dom.style[U(j)]=k
}return this
},setOpacity:function(g,d){var m=this,j=m.dom.style;
if(!d||!m.anim){if(CQ.Ext.isIE){var k=g<1?"alpha(opacity="+g*100+")":"",n=j.filter.replace(b,"").replace(K,"");
j.zoom=1;
j.filter=n+(n.length>0?" ":"")+k
}else{j.opacity=g
}}else{m.anim({opacity:{to:g}},m.preanim(arguments,1),null,0.35,"easeIn")
}return m
},clearOpacity:function(){var d=this.dom.style;
if(CQ.Ext.isIE){if(!CQ.Ext.isEmpty(d.filter)){d.filter=d.filter.replace(b,"").replace(K,"")
}}else{d.opacity=d["-moz-opacity"]=d["-khtml-opacity"]=""
}return this
},getHeight:function(j){var g=this,m=g.dom,k=CQ.Ext.isIE&&g.isStyle("display","none"),d=Q.max(m.offsetHeight,k?0:m.clientHeight)||0;
d=!j?d:d-g.getBorderWidth("tb")-g.getPadding("tb");
return d<0?0:d
},getWidth:function(g){var j=this,m=j.dom,k=CQ.Ext.isIE&&j.isStyle("display","none"),d=Q.max(m.offsetWidth,k?0:m.clientWidth)||0;
d=!g?d:d-j.getBorderWidth("lr")-j.getPadding("lr");
return d<0?0:d
},setWidth:function(g,d){var j=this;
g=j.adjustWidth(g);
!d||!j.anim?j.dom.style.width=j.addUnits(g):j.anim({width:{to:g}},j.preanim(arguments,1));
return j
},setHeight:function(d,g){var j=this;
d=j.adjustHeight(d);
!g||!j.anim?j.dom.style.height=j.addUnits(d):j.anim({height:{to:d}},j.preanim(arguments,1));
return j
},getBorderWidth:function(d){return this.addStyles(d,H)
},getPadding:function(d){return this.addStyles(d,F)
},clip:function(){var d=this,g=d.dom;
if(!c(g,E)){c(g,E,true);
c(g,a,{o:d.getStyle(J),x:d.getStyle(M),y:d.getStyle(L)});
d.setStyle(J,Y);
d.setStyle(M,Y);
d.setStyle(L,Y)
}return d
},unclip:function(){var d=this,j=d.dom;
if(c(j,E)){c(j,E,false);
var g=c(j,a);
if(g.o){d.setStyle(J,g.o)
}if(g.x){d.setStyle(M,g.x)
}if(g.y){d.setStyle(L,g.y)
}}return d
},addStyles:function(o,n){var q=0,g=o.match(/\w/g),k;
for(var j=0,d=g.length;
j<d;
j++){k=g[j]&&parseInt(this.getStyle(n[g[j]]),10);
if(k){q+=Q.abs(k)
}}return q
},margins:A}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.boxMarkup='<div class="{0}-tl"><div class="{0}-tr"><div class="{0}-tc"></div></div></div><div class="{0}-ml"><div class="{0}-mr"><div class="{0}-mc"></div></div></div><div class="{0}-bl"><div class="{0}-br"><div class="{0}-bc"></div></div></div>';
CQ.Ext.Element.addMethods(function(){var A="_internal",B=/(\d+\.?\d+)px/;
return{applyStyles:function(C){CQ.Ext.DomHelper.applyStyles(this.dom,C);
return this
},getStyles:function(){var C={};
CQ.Ext.each(arguments,function(D){C[D]=this.getStyle(D)
},this);
return C
},setOverflow:function(C){var D=this.dom;
if(C=="auto"&&CQ.Ext.isMac&&CQ.Ext.isGecko2){D.style.overflow="hidden";
(function(){D.style.overflow="auto"
}).defer(1)
}else{D.style.overflow=C
}},boxWrap:function(C){C=C||"x-box";
var D=CQ.Ext.get(this.insertHtml("beforeBegin","<div class='"+C+"'>"+String.format(CQ.Ext.Element.boxMarkup,C)+"</div>"));
CQ.Ext.DomQuery.selectNode("."+C+"-mc",D.dom).appendChild(this.dom);
return D
},setSize:function(E,C,D){var F=this;
if(CQ.Ext.isObject(E)){C=E.height;
E=E.width
}E=F.adjustWidth(E);
C=F.adjustHeight(C);
if(!D||!F.anim){F.dom.style.width=F.addUnits(E);
F.dom.style.height=F.addUnits(C)
}else{F.anim({width:{to:E},height:{to:C}},F.preanim(arguments,2))
}return F
},getComputedHeight:function(){var D=this,C=Math.max(D.dom.offsetHeight,D.dom.clientHeight);
if(!C){C=parseFloat(D.getStyle("height"))||0;
if(!D.isBorderBox()){C+=D.getFrameWidth("tb")
}}return C
},getComputedWidth:function(){var C=Math.max(this.dom.offsetWidth,this.dom.clientWidth);
if(!C){C=parseFloat(this.getStyle("width"))||0;
if(!this.isBorderBox()){C+=this.getFrameWidth("lr")
}}return C
},getFrameWidth:function(D,C){return C&&this.isBorderBox()?0:(this.getPadding(D)+this.getBorderWidth(D))
},addClassOnOver:function(C){this.hover(function(){CQ.Ext.fly(this,A).addClass(C)
},function(){CQ.Ext.fly(this,A).removeClass(C)
});
return this
},addClassOnFocus:function(C){this.on("focus",function(){CQ.Ext.fly(this,A).addClass(C)
},this.dom);
this.on("blur",function(){CQ.Ext.fly(this,A).removeClass(C)
},this.dom);
return this
},addClassOnClick:function(C){var D=this.dom;
this.on("mousedown",function(){CQ.Ext.fly(D,A).addClass(C);
var F=CQ.Ext.getDoc(),E=function(){CQ.Ext.fly(D,A).removeClass(C);
F.removeListener("mouseup",E)
};
F.on("mouseup",E)
});
return this
},getViewSize:function(){var E=document,F=this.dom,C=(F==E||F==E.body);
if(C){var D=CQ.Ext.lib.Dom;
return{width:D.getViewWidth(),height:D.getViewHeight()}
}else{return{width:F.clientWidth,height:F.clientHeight}
}},getStyleSize:function(){var G=this,C,F,I=document,J=this.dom,D=(J==I||J==I.body),E=J.style;
if(D){var H=CQ.Ext.lib.Dom;
return{width:H.getViewWidth(),height:H.getViewHeight()}
}if(E.width&&E.width!="auto"){C=parseFloat(E.width);
if(G.isBorderBox()){C-=G.getFrameWidth("lr")
}}if(E.height&&E.height!="auto"){F=parseFloat(E.height);
if(G.isBorderBox()){F-=G.getFrameWidth("tb")
}}return{width:C||G.getWidth(true),height:F||G.getHeight(true)}
},getSize:function(C){return{width:this.getWidth(C),height:this.getHeight(C)}
},repaint:function(){var C=this.dom;
this.addClass("x-repaint");
setTimeout(function(){CQ.Ext.fly(C).removeClass("x-repaint")
},1);
return this
},unselectable:function(){this.dom.unselectable="on";
return this.swallowEvent("selectstart",true).applyStyles("-moz-user-select:none;-khtml-user-select:none;").addClass("x-unselectable")
},getMargins:function(D){var E=this,C,F={t:"top",l:"left",r:"right",b:"bottom"},G={};
if(!D){for(C in E.margins){G[F[C]]=parseFloat(E.getStyle(E.margins[C]))||0
}return G
}else{return E.addStyles.call(E,D,E.margins)
}}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var A=CQ.Ext.lib.Dom,B="left",G="right",E="top",I="bottom",H="position",C="static",F="relative",J="auto",K="z-index";
CQ.Ext.Element.addMethods({getX:function(){return A.getX(this.dom)
},getY:function(){return A.getY(this.dom)
},getXY:function(){return A.getXY(this.dom)
},getOffsetsTo:function(D){var M=this.getXY(),L=CQ.Ext.fly(D,"_internal").getXY();
return[M[0]-L[0],M[1]-L[1]]
},setX:function(D,L){return this.setXY([D,this.getY()],this.animTest(arguments,L,1))
},setY:function(L,D){return this.setXY([this.getX(),L],this.animTest(arguments,D,1))
},setLeft:function(D){this.setStyle(B,this.addUnits(D));
return this
},setTop:function(D){this.setStyle(E,this.addUnits(D));
return this
},setRight:function(D){this.setStyle(G,this.addUnits(D));
return this
},setBottom:function(D){this.setStyle(I,this.addUnits(D));
return this
},setXY:function(M,D){var L=this;
if(!D||!L.anim){A.setXY(L.dom,M)
}else{L.anim({points:{to:M}},L.preanim(arguments,1),"motion")
}return L
},setLocation:function(D,M,L){return this.setXY([D,M],this.animTest(arguments,L,2))
},moveTo:function(D,M,L){return this.setXY([D,M],this.animTest(arguments,L,2))
},getLeft:function(D){return !D?this.getX():parseInt(this.getStyle(B),10)||0
},getRight:function(D){var L=this;
return !D?L.getX()+L.getWidth():(L.getLeft(true)+L.getWidth())||0
},getTop:function(D){return !D?this.getY():parseInt(this.getStyle(E),10)||0
},getBottom:function(D){var L=this;
return !D?L.getY()+L.getHeight():(L.getTop(true)+L.getHeight())||0
},position:function(O,N,D,M){var L=this;
if(!O&&L.isStyle(H,C)){L.setStyle(H,F)
}else{if(O){L.setStyle(H,O)
}}if(N){L.setStyle(K,N)
}if(D||M){L.setXY([D||false,M||false])
}},clearPositioning:function(D){D=D||"";
this.setStyle({left:D,right:D,top:D,bottom:D,"z-index":"",position:C});
return this
},getPositioning:function(){var D=this.getStyle(B);
var L=this.getStyle(E);
return{position:this.getStyle(H),left:D,right:D?"":this.getStyle(G),top:L,bottom:L?"":this.getStyle(I),"z-index":this.getStyle(K)}
},setPositioning:function(D){var M=this,L=M.dom.style;
M.setStyle(D);
if(D.right==J){L.right=""
}if(D.bottom==J){L.bottom=""
}return M
},translatePoints:function(D,Q){Q=isNaN(D[1])?Q:D[1];
D=isNaN(D[0])?D:D[0];
var N=this,O=N.isStyle(H,F),P=N.getXY(),L=parseInt(N.getStyle(B),10),M=parseInt(N.getStyle(E),10);
L=!isNaN(L)?L:(O?0:N.dom.offsetLeft);
M=!isNaN(M)?M:(O?0:N.dom.offsetTop);
return{left:(D-P[0]+L),top:(Q-P[1]+M)}
},animTest:function(L,D,M){return !!D&&this.preanim?this.preanim(L,M):false
}})
})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({setBox:function(E,F,B){var D=this,A=E.width,C=E.height;
if((F&&!D.autoBoxAdjust)&&!D.isBorderBox()){A-=(D.getBorderWidth("lr")+D.getPadding("lr"));
C-=(D.getBorderWidth("tb")+D.getPadding("tb"))
}D.setBounds(E.x,E.y,A,C,D.animTest.call(D,arguments,B,2));
return D
},getBox:function(G,L){var I=this,P,D,K,C=I.getBorderWidth,M=I.getPadding,E,A,O,J;
if(!L){P=I.getXY()
}else{D=parseInt(I.getStyle("left"),10)||0;
K=parseInt(I.getStyle("top"),10)||0;
P=[D,K]
}var B=I.dom,N=B.offsetWidth,F=B.offsetHeight,H;
if(!G){H={x:P[0],y:P[1],0:P[0],1:P[1],width:N,height:F}
}else{E=C.call(I,"l")+M.call(I,"l");
A=C.call(I,"r")+M.call(I,"r");
O=C.call(I,"t")+M.call(I,"t");
J=C.call(I,"b")+M.call(I,"b");
H={x:P[0]+E,y:P[1]+O,0:P[0]+E,1:P[1]+O,width:N-(E+A),height:F-(O+J)}
}H.right=H.x+H.width;
H.bottom=H.y+H.height;
return H
},move:function(I,B,C){var F=this,L=F.getXY(),J=L[0],H=L[1],D=[J-B,H],K=[J+B,H],G=[J,H-B],A=[J,H+B],E={l:D,left:D,r:K,right:K,t:G,top:G,up:G,b:A,bottom:A,down:A};
I=I.toLowerCase();
F.moveTo(E[I][0],E[I][1],F.animTest.call(F,arguments,C,2))
},setLeftTop:function(D,C){var B=this,A=B.dom.style;
A.left=B.addUnits(D);
A.top=B.addUnits(C);
return B
},getRegion:function(){return CQ.Ext.lib.Dom.getRegion(this.dom)
},setBounds:function(B,F,D,A,C){var E=this;
if(!C||!E.anim){E.setSize(D,A);
E.setLocation(B,F)
}else{E.anim({points:{to:[B,F]},width:{to:E.adjustWidth(D)},height:{to:E.adjustHeight(A)}},E.preanim(arguments,4),"motion")
}return E
},setRegion:function(B,A){return this.setBounds(B.left,B.top,B.right-B.left,B.bottom-B.top,this.animTest.call(this,arguments,A,1))
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({isScrollable:function(){var A=this.dom;
return A.scrollHeight>A.clientHeight||A.scrollWidth>A.clientWidth
},scrollTo:function(A,B){this.dom["scroll"+(/top/i.test(A)?"Top":"Left")]=B;
return this
},getScroll:function(){var G=this.dom,F=document,A=F.body,C=F.documentElement,B,E,D;
if(G==F||G==A){if(CQ.Ext.isIE&&CQ.Ext.isStrict){B=C.scrollLeft;
E=C.scrollTop
}else{B=window.pageXOffset;
E=window.pageYOffset
}D={left:B||(A?A.scrollLeft:0),top:E||(A?A.scrollTop:0)}
}else{D={left:G.scrollLeft,top:G.scrollTop}
}return D
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({scrollTo:function(B,D,A){var E=/top/i.test(B),C=this,F=C.dom,G;
if(!A||!C.anim){G="scroll"+(E?"Top":"Left"),F[G]=D
}else{G="scroll"+(E?"Left":"Top"),C.anim({scroll:{to:E?[F[G],D]:[D,F[G]]}},C.preanim(arguments,2),"scroll")
}return C
},scrollIntoView:function(C,F){var K=CQ.Ext.getDom(C)||CQ.Ext.getBody().dom,E=this.dom,D=this.getOffsetsTo(K),H=D[0]+K.scrollLeft,N=D[1]+K.scrollTop,L=N+E.offsetHeight,B=H+E.offsetWidth,A=K.clientHeight,I=parseInt(K.scrollTop,10),M=parseInt(K.scrollLeft,10),G=I+A,J=M+K.clientWidth;
if(E.offsetHeight>A||N<I){K.scrollTop=N
}else{if(L>G){K.scrollTop=L-A
}}K.scrollTop=K.scrollTop;
if(F!==false){if(E.offsetWidth>K.clientWidth||H<M){K.scrollLeft=H
}else{if(B>J){K.scrollLeft=B-K.clientWidth
}}K.scrollLeft=K.scrollLeft
}return this
},scrollChildIntoView:function(B,A){CQ.Ext.fly(B,"_scrollChildIntoView").scrollIntoView(this,A)
},scroll:function(J,B,D){if(!this.isScrollable()){return 
}var E=this.dom,F=E.scrollLeft,M=E.scrollTop,K=E.scrollWidth,I=E.scrollHeight,G=E.clientWidth,A=E.clientHeight,C=false,L,H={l:Math.min(F+B,K-G),r:L=Math.max(F-B,0),t:Math.max(M-B,0),b:Math.min(M+B,I-A)};
H.d=H.b;
H.u=H.t;
J=J.substr(0,1);
if((L=H[J])>-1){C=true;
this.scrollTo(J=="l"||J=="r"?"left":"top",L,this.preanim(arguments,2))
}return C
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.VISIBILITY=1;
CQ.Ext.Element.DISPLAY=2;
CQ.Ext.Element.addMethods(function(){var G="visibility",D="display",B="hidden",I="none",A="originalDisplay",C="visibilityMode",E=CQ.Ext.Element.DISPLAY,F=CQ.Ext.Element.data,H=function(L){var K=F(L,A);
if(K===undefined){F(L,A,K="")
}return K
},J=function(L){var K=F(L,C);
if(K===undefined){F(L,C,K=1)
}return K
};
return{originalDisplay:"",visibilityMode:1,setVisibilityMode:function(K){F(this.dom,C,K);
return this
},animate:function(L,N,M,O,K){this.anim(L,{duration:N,callback:M,easing:O},K);
return this
},anim:function(N,O,L,Q,M,K){L=L||"run";
O=O||{};
var P=this,R=CQ.Ext.lib.Anim[L](P.dom,N,(O.duration||Q)||0.35,(O.easing||M)||"easeOut",function(){if(K){K.call(P)
}if(O.callback){O.callback.call(O.scope||P,P,O)
}},P);
O.anim=R;
return R
},preanim:function(K,L){return !K[L]?false:(CQ.Ext.isObject(K[L])?K[L]:{duration:K[L+1],callback:K[L+2],easing:K[L+3]})
},isVisible:function(){return !this.isStyle(G,B)&&!this.isStyle(D,I)
},setVisible:function(O,L){var M=this,N=M.dom,K=J(this.dom)==E;
if(!L||!M.anim){if(K){M.setDisplayed(O)
}else{M.fixDisplay();
N.style.visibility=O?"visible":B
}}else{if(O){M.setOpacity(0.01);
M.setVisible(true)
}M.anim({opacity:{to:(O?1:0)}},M.preanim(arguments,1),null,0.35,"easeIn",function(){if(!O){N.style[K?D:G]=(K)?I:B;
CQ.Ext.fly(N).setOpacity(1)
}})
}return M
},toggle:function(K){var L=this;
L.setVisible(!L.isVisible(),L.preanim(arguments,0));
return L
},setDisplayed:function(K){if(typeof K=="boolean"){K=K?H(this.dom):I
}this.setStyle(D,K);
return this
},fixDisplay:function(){var K=this;
if(K.isStyle(D,I)){K.setStyle(G,B);
K.setStyle(D,H(this.dom));
if(K.isStyle(D,I)){K.setStyle(D,"block")
}}},hide:function(K){this.setVisible(false,this.preanim(arguments,0));
return this
},show:function(K){this.setVisible(true,this.preanim(arguments,0));
return this
}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods(function(){var D="visibility",B="display",A="hidden",G="none",C="x-masked",F="x-masked-relative",E=CQ.Ext.Element.data;
return{isVisible:function(H){var I=!this.isStyle(D,A)&&!this.isStyle(B,G),J=this.dom.parentNode;
if(H!==true||!I){return I
}while(J&&!/^body/i.test(J.tagName)){if(!CQ.Ext.fly(J,"_isVisible").isVisible()){return false
}J=J.parentNode
}return true
},isDisplayed:function(){return !this.isStyle(B,G)
},enableDisplayMode:function(H){this.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(!CQ.Ext.isEmpty(H)){E(this.dom,"originalDisplay",H)
}return this
},mask:function(I,M){var O=this,K=O.dom,N=CQ.Ext.DomHelper,L="ext-el-mask-msg",H,P;
if(O.getStyle("position")=="static"){O.addClass(F)
}if((H=E(K,"maskMsg"))){H.remove()
}if((H=E(K,"mask"))){H.remove()
}P=N.append(K,{cls:"ext-el-mask"},true);
E(K,"mask",P);
O.addClass(C);
P.setDisplayed(true);
if(typeof I=="string"){var J=N.append(K,{cls:L,cn:{tag:"div"}},true);
E(K,"maskMsg",J);
J.dom.className=M?L+" "+M:L;
J.dom.firstChild.innerHTML=I;
J.setDisplayed(true);
J.center(O)
}if(CQ.Ext.isIE&&!(CQ.Ext.isIE7&&CQ.Ext.isStrict)&&O.getStyle("height")=="auto"){P.setSize(undefined,O.getHeight())
}return P
},unmask:function(){var J=this,K=J.dom,H=E(K,"mask"),I=E(K,"maskMsg");
if(H){if(I){I.remove();
E(K,"maskMsg",undefined)
}H.remove();
E(K,"mask",undefined)
}J.removeClass([C,F])
},isMasked:function(){var H=E(this.dom,"mask");
return H&&H.isVisible()
},createShim:function(){var H=document.createElement("iframe"),I;
H.frameBorder="0";
H.className="ext-shim";
H.src=CQ.Ext.SSL_SECURE_URL;
I=CQ.Ext.get(this.dom.parentNode.insertBefore(H,this.dom));
I.autoBoxAdjust=false;
return I
}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({addKeyListener:function(B,D,C){var A;
if(!CQ.Ext.isObject(B)||CQ.Ext.isArray(B)){A={key:B,fn:D,scope:C}
}else{A={key:B.key,shift:B.shift,ctrl:B.ctrl,alt:B.alt,fn:D,scope:C}
}return new CQ.Ext.KeyMap(this,A)
},addKeyMap:function(A){return new CQ.Ext.KeyMap(this,A)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var X=null,Z=undefined,J=true,S=false,I="setX",G="setY",A="setXY",M="left",K="bottom",R="top",L="right",P="height",F="width",H="points",V="hidden",Y="absolute",T="visible",E="motion",N="position",Q="easeOut",D=new CQ.Ext.Element.Flyweight(),U={},W=function(a){return a||{}
},O=function(a){D.dom=a;
D.id=CQ.Ext.id(a);
return D
},C=function(a){if(!U[a]){U[a]=[]
}return U[a]
},B=function(b,a){U[b]=a
};
CQ.Ext.enableFx=J;
CQ.Ext.Fx={switchStatements:function(b,c,a){return c.apply(this,a[b])
},slideIn:function(m,g){g=W(g);
var q=this,k=q.dom,v=k.style,x,a,u,d,c,v,n,w,t,j;
m=m||"t";
q.queueFx(g,function(){x=O(k).getXY();
O(k).fixDisplay();
a=O(k).getFxRestore();
u={x:x[0],y:x[1],0:x[0],1:x[1],width:k.offsetWidth,height:k.offsetHeight};
u.right=u.x+u.width;
u.bottom=u.y+u.height;
O(k).setWidth(u.width).setHeight(u.height);
d=O(k).fxWrap(a.pos,g,V);
v.visibility=T;
v.position=Y;
function b(){O(k).fxUnwrap(d,a.pos,g);
v.width=a.width;
v.height=a.height;
O(k).afterFx(g)
}w={to:[u.x,u.y]};
t={to:u.width};
j={to:u.height};
function o(AA,r,AB,y,AD,AF,AI,AH,AG,AC,z){var AE={};
O(AA).setWidth(AB).setHeight(y);
if(O(AA)[AD]){O(AA)[AD](AF)
}r[AI]=r[AH]="0";
if(AG){AE.width=AG
}if(AC){AE.height=AC
}if(z){AE.points=z
}return AE
}n=O(k).switchStatements(m.toLowerCase(),o,{t:[d,v,u.width,0,X,X,M,K,X,j,X],l:[d,v,0,u.height,X,X,L,R,t,X,X],r:[d,v,u.width,u.height,I,u.right,M,R,X,X,w],b:[d,v,u.width,u.height,G,u.bottom,M,R,X,j,w],tl:[d,v,0,0,X,X,L,K,t,j,w],bl:[d,v,0,0,G,u.y+u.height,L,R,t,j,w],br:[d,v,0,0,A,[u.right,u.bottom],M,R,t,j,w],tr:[d,v,0,0,I,u.x+u.width,M,K,t,j,w]});
v.visibility=T;
O(d).show();
arguments.callee.anim=O(d).fxanim(n,g,E,0.5,Q,b)
});
return q
},slideOut:function(k,g){g=W(g);
var n=this,j=n.dom,u=j.style,v=n.getXY(),d,c,q,t,m={to:0};
k=k||"t";
n.queueFx(g,function(){c=O(j).getFxRestore();
q={x:v[0],y:v[1],0:v[0],1:v[1],width:j.offsetWidth,height:j.offsetHeight};
q.right=q.x+q.width;
q.bottom=q.y+q.height;
O(j).setWidth(q.width).setHeight(q.height);
d=O(j).fxWrap(c.pos,g,T);
u.visibility=T;
u.position=Y;
O(d).setWidth(q.width).setHeight(q.height);
function a(){g.useDisplay?O(j).setDisplayed(S):O(j).hide();
O(j).fxUnwrap(d,c.pos,g);
u.width=c.width;
u.height=c.height;
O(j).afterFx(g)
}function b(o,AC,AA,AD,y,AB,x,z,w){var r={};
o[AC]=o[AA]="0";
r[AD]=y;
if(AB){r[AB]=x
}if(z){r[z]=w
}return r
}t=O(j).switchStatements(k.toLowerCase(),b,{t:[u,M,K,P,m],l:[u,L,R,F,m],r:[u,M,R,F,m,H,{to:[q.right,q.y]}],b:[u,M,R,P,m,H,{to:[q.x,q.bottom]}],tl:[u,L,K,F,m,P,m],bl:[u,L,R,F,m,P,m,H,{to:[q.x,q.bottom]}],br:[u,M,R,F,m,P,m,H,{to:[q.x+q.width,q.bottom]}],tr:[u,M,K,F,m,P,m,H,{to:[q.right,q.y]}]});
arguments.callee.anim=O(d).fxanim(t,g,E,0.5,Q,a)
});
return n
},puff:function(k){k=W(k);
var g=this,j=g.dom,b=j.style,c,a,d;
g.queueFx(k,function(){c=O(j).getWidth();
a=O(j).getHeight();
O(j).clearOpacity();
O(j).show();
d=O(j).getFxRestore();
function m(){k.useDisplay?O(j).setDisplayed(S):O(j).hide();
O(j).clearOpacity();
O(j).setPositioning(d.pos);
b.width=d.width;
b.height=d.height;
b.fontSize="";
O(j).afterFx(k)
}arguments.callee.anim=O(j).fxanim({width:{to:O(j).adjustWidth(c*2)},height:{to:O(j).adjustHeight(a*2)},points:{by:[-c*0.5,-a*0.5]},opacity:{to:0},fontSize:{to:200,unit:"%"}},k,E,0.5,Q,m)
});
return g
},switchOff:function(g){g=W(g);
var c=this,d=c.dom,a=d.style,b;
c.queueFx(g,function(){O(d).clearOpacity();
O(d).clip();
b=O(d).getFxRestore();
function j(){g.useDisplay?O(d).setDisplayed(S):O(d).hide();
O(d).clearOpacity();
O(d).setPositioning(b.pos);
a.width=b.width;
a.height=b.height;
O(d).afterFx(g)
}O(d).fxanim({opacity:{to:0.3}},X,X,0.1,X,function(){O(d).clearOpacity();
(function(){O(d).fxanim({height:{to:1},points:{by:[0,O(d).getHeight()*0.5]}},g,E,0.3,"easeIn",j)
}).defer(100)
})
});
return c
},highlight:function(d,m){m=W(m);
var j=this,k=j.dom,b=m.attr||"backgroundColor",c={},g;
j.queueFx(m,function(){O(k).clearOpacity();
O(k).show();
function a(){k.style[b]=g;
O(k).afterFx(m)
}g=k.style[b];
c[b]={from:d||"ffff9c",to:m.endColor||O(k).getColor(b)||"ffffff"};
arguments.callee.anim=O(k).fxanim(c,m,"color",1,"easeIn",a)
});
return j
},frame:function(a,d,k){k=W(k);
var c=this,j=c.dom,b,g;
c.queueFx(k,function(){a=a||"#C3DAF9";
if(a.length==6){a="#"+a
}d=d||1;
O(j).show();
var q=O(j).getXY(),n={x:q[0],y:q[1],0:q[0],1:q[1],width:j.offsetWidth,height:j.offsetHeight},m=function(){b=O(document.body||document.documentElement).createChild({style:{position:Y,"z-index":35000,border:"0px solid "+a}});
return b.queueFx({},o)
};
arguments.callee.anim={isAnimated:true,stop:function(){d=0;
b.stopFx()
}};
function o(){var r=CQ.Ext.isBorderBox?2:1;
g=b.anim({top:{from:n.y,to:n.y-20},left:{from:n.x,to:n.x-20},borderWidth:{from:0,to:10},opacity:{from:1,to:0},height:{from:n.height,to:n.height+20*r},width:{from:n.width,to:n.width+20*r}},{duration:k.duration||1,callback:function(){b.remove();
--d>0?m():O(j).afterFx(k)
}});
arguments.callee.anim={isAnimated:true,stop:function(){g.stop()
}}
}m()
});
return c
},pause:function(c){var b=this.dom,a;
this.queueFx({},function(){a=setTimeout(function(){O(b).afterFx({})
},c*1000);
arguments.callee.anim={isAnimated:true,stop:function(){clearTimeout(a);
O(b).afterFx({})
}}
});
return this
},fadeIn:function(c){c=W(c);
var a=this,b=a.dom,d=c.endOpacity||1;
a.queueFx(c,function(){O(b).setOpacity(0);
O(b).fixDisplay();
b.style.visibility=T;
arguments.callee.anim=O(b).fxanim({opacity:{to:d}},c,X,0.5,Q,function(){if(d==1){O(b).clearOpacity()
}O(b).afterFx(c)
})
});
return a
},fadeOut:function(d){d=W(d);
var b=this,c=b.dom,a=c.style,g=d.endOpacity||0;
b.queueFx(d,function(){arguments.callee.anim=O(c).fxanim({opacity:{to:g}},d,X,0.5,Q,function(){if(g==0){CQ.Ext.Element.data(c,"visibilityMode")==CQ.Ext.Element.DISPLAY||d.useDisplay?a.display="none":a.visibility=V;
O(c).clearOpacity()
}O(c).afterFx(d)
})
});
return b
},scale:function(a,b,c){this.shift(CQ.Ext.apply({},c,{width:a,height:b}));
return this
},shift:function(d){d=W(d);
var c=this.dom,b={};
this.queueFx(d,function(){for(var a in d){if(d[a]!=Z){b[a]={to:d[a]}
}}b.width?b.width.to=O(c).adjustWidth(d.width):b;
b.height?b.height.to=O(c).adjustWidth(d.height):b;
if(b.x||b.y||b.xy){b.points=b.xy||{to:[b.x?b.x.to:O(c).getX(),b.y?b.y.to:O(c).getY()]}
}arguments.callee.anim=O(c).fxanim(b,d,E,0.35,Q,function(){O(c).afterFx(d)
})
});
return this
},ghost:function(g,c){c=W(c);
var k=this,d=k.dom,q=d.style,m={opacity:{to:0},points:{}},t=m.points,b,n,j;
g=g||"b";
k.queueFx(c,function(){b=O(d).getFxRestore();
n=O(d).getWidth();
j=O(d).getHeight();
function a(){c.useDisplay?O(d).setDisplayed(S):O(d).hide();
O(d).clearOpacity();
O(d).setPositioning(b.pos);
q.width=b.width;
q.height=b.height;
O(d).afterFx(c)
}t.by=O(d).switchStatements(g.toLowerCase(),function(r,o){return[r,o]
},{t:[0,-j],l:[-n,0],r:[n,0],b:[0,j],tl:[-n,-j],bl:[-n,j],br:[n,j],tr:[n,-j]});
arguments.callee.anim=O(d).fxanim(m,c,E,0.5,Q,a)
});
return k
},syncFx:function(){var a=this;
a.fxDefaults=CQ.Ext.apply(a.fxDefaults||{},{block:S,concurrent:J,stopFx:S});
return a
},sequenceFx:function(){var a=this;
a.fxDefaults=CQ.Ext.apply(a.fxDefaults||{},{block:S,concurrent:S,stopFx:S});
return a
},nextFx:function(){var a=C(this.dom.id)[0];
if(a){a.call(this)
}},hasActiveFx:function(){return C(this.dom.id)[0]
},stopFx:function(a){var b=this,d=b.dom.id;
if(b.hasActiveFx()){var c=C(d)[0];
if(c&&c.anim){if(c.anim.isAnimated){B(d,[c]);
c.anim.stop(a!==undefined?a:J)
}else{B(d,[])
}}}return b
},beforeFx:function(a){if(this.hasActiveFx()&&!a.concurrent){if(a.stopFx){this.stopFx();
return J
}return S
}return J
},hasFxBlock:function(){var a=C(this.dom.id);
return a&&a[0]&&a[0].block
},queueFx:function(d,a){var b=O(this.dom);
if(!b.hasFxBlock()){CQ.Ext.applyIf(d,b.fxDefaults);
if(!d.concurrent){var c=b.beforeFx(d);
a.block=d.block;
C(b.dom.id).push(a);
if(c){b.nextFx()
}}else{a.call(b)
}}return b
},fxWrap:function(k,g,c){var d=this.dom,b,a;
if(!g.wrap||!(b=CQ.Ext.getDom(g.wrap))){if(g.fixPosition){a=O(d).getXY()
}var j=document.createElement("div");
j.style.visibility=c;
b=d.parentNode.insertBefore(j,d);
O(b).setPositioning(k);
if(O(b).isStyle(N,"static")){O(b).position("relative")
}O(d).clearPositioning("auto");
O(b).clip();
b.appendChild(d);
if(a){O(b).setXY(a)
}}return b
},fxUnwrap:function(b,g,d){var c=this.dom;
O(c).clearPositioning();
O(c).setPositioning(g);
if(!d.wrap){var a=O(b).dom.parentNode;
a.insertBefore(c,b);
O(b).remove()
}},getFxRestore:function(){var a=this.dom.style;
return{pos:this.getPositioning(),width:a.width,height:a.height}
},afterFx:function(b){var a=this.dom,c=a.id;
if(b.afterStyle){O(a).setStyle(b.afterStyle)
}if(b.afterCls){O(a).addClass(b.afterCls)
}if(b.remove==J){O(a).remove()
}if(b.callback){b.callback.call(b.scope,O(a))
}if(!b.concurrent){C(c).shift();
O(a).nextFx()
}},fxanim:function(d,g,b,j,c,a){b=b||"run";
g=g||{};
var k=CQ.Ext.lib.Anim[b](this.dom,d,(g.duration||j)||0.35,(g.easing||c)||Q,a,this);
g.anim=k;
return k
}};
CQ.Ext.Fx.resize=CQ.Ext.Fx.scale;
CQ.Ext.Element.addMethods(CQ.Ext.Fx)
})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.CompositeElementLite=function(B,A){this.elements=[];
this.add(B,A);
this.el=new CQ.Ext.Element.Flyweight()
};
CQ.Ext.CompositeElementLite.prototype={isComposite:true,getElement:function(A){var B=this.el;
B.dom=A;
B.id=A.id;
return B
},transformElement:function(A){return CQ.Ext.getDom(A)
},getCount:function(){return this.elements.length
},add:function(D,B){var E=this,F=E.elements;
if(!D){return this
}if(CQ.Ext.isString(D)){D=CQ.Ext.Element.selectorFunction(D,B)
}else{if(D.isComposite){D=D.elements
}else{if(!CQ.Ext.isIterable(D)){D=[D]
}}}for(var C=0,A=D.length;
C<A;
++C){F.push(E.transformElement(D[C]))
}return E
},invoke:function(E,B){var F=this,D=F.elements,A=D.length,G,C;
for(C=0;
C<A;
C++){G=D[C];
if(G){CQ.Ext.Element.prototype[E].apply(F.getElement(G),B)
}}return F
},item:function(B){var D=this,C=D.elements[B],A=null;
if(C){A=D.getElement(C)
}return A
},addListener:function(B,G,F,E){var D=this.elements,A=D.length,C,H;
for(C=0;
C<A;
C++){H=D[C];
if(H){CQ.Ext.EventManager.on(H,B,G,F||H,E)
}}return this
},each:function(E,D){var F=this,C=F.elements,A=C.length,B,G;
for(B=0;
B<A;
B++){G=C[B];
if(G){G=this.getElement(G);
if(E.call(D||G,G,F,B)===false){break
}}}return F
},fill:function(A){var B=this;
B.elements=[];
B.add(A);
return B
},filter:function(A){var B=[],D=this,E=D.elements,C=CQ.Ext.isFunction(A)?A:function(F){return F.is(A)
};
D.each(function(H,F,G){if(C(H,G)!==false){B[B.length]=D.transformElement(H)
}});
D.elements=B;
return D
},indexOf:function(A){return this.elements.indexOf(this.transformElement(A))
},replaceElement:function(D,C,A){var B=!isNaN(D)?D:this.indexOf(D),E;
if(B>-1){C=CQ.Ext.getDom(C);
if(A){E=this.elements[B];
E.parentNode.insertBefore(C,E);
CQ.Ext.removeNode(E)
}this.elements.splice(B,1,C)
}return this
},clear:function(){this.elements=[]
}};
CQ.Ext.CompositeElementLite.prototype.on=CQ.Ext.CompositeElementLite.prototype.addListener;
(function(){var C,B=CQ.Ext.Element.prototype,A=CQ.Ext.CompositeElementLite.prototype;
for(C in B){if(CQ.Ext.isFunction(B[C])){(function(D){A[D]=A[D]||function(){return this.invoke(D,arguments)
}
}).call(A,C)
}}})();
if(CQ.Ext.DomQuery){CQ.Ext.Element.selectorFunction=CQ.Ext.DomQuery.select
}CQ.Ext.Element.select=function(A,B){var C;
if(typeof A=="string"){C=CQ.Ext.Element.selectorFunction(A,B)
}else{if(A.length!==undefined){C=A
}else{throw"Invalid selector"
}}return new CQ.Ext.CompositeElementLite(C)
};
CQ.Ext.select=CQ.Ext.Element.select;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.apply(CQ.Ext.CompositeElementLite.prototype,{addElements:function(C,A){if(!C){return this
}if(typeof C=="string"){C=CQ.Ext.Element.selectorFunction(C,A)
}var B=this.elements;
CQ.Ext.each(C,function(D){B.push(CQ.Ext.get(D))
});
return this
},first:function(){return this.item(0)
},last:function(){return this.item(this.getCount()-1)
},contains:function(A){return this.indexOf(A)!=-1
},removeElement:function(D,E){var C=this,A=this.elements,B;
CQ.Ext.each(D,function(F){if((B=(A[F]||A[F=C.indexOf(F)]))){if(E){if(B.dom){B.remove()
}else{CQ.Ext.removeNode(B)
}}A.splice(F,1)
}});
return this
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.CompositeElement=function(B,A){this.elements=[];
this.add(B,A)
};
CQ.Ext.extend(CQ.Ext.CompositeElement,CQ.Ext.CompositeElementLite,{getElement:function(A){return A
},transformElement:function(A){return CQ.Ext.get(A)
}});
CQ.Ext.Element.select=function(A,D,B){var C;
if(typeof A=="string"){C=CQ.Ext.Element.selectorFunction(A,B)
}else{if(A.length!==undefined){C=A
}else{throw"Invalid selector"
}}return(D===true)?new CQ.Ext.CompositeElement(C):new CQ.Ext.CompositeElementLite(C)
};
CQ.Ext.select=CQ.Ext.Element.select;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var B="beforerequest",E="requestcomplete",D="requestexception",G=undefined,C="load",H="POST",A="GET",F=window;
CQ.Ext.data.Connection=function(I){CQ.Ext.apply(this,I);
this.addEvents(B,E,D);
CQ.Ext.data.Connection.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.data.Connection,CQ.Ext.util.Observable,{timeout:30000,autoAbort:false,disableCaching:true,disableCachingParam:"_dc",request:function(M){var P=this;
if(P.fireEvent(B,P,M)){if(M.el){if(!CQ.Ext.isEmpty(M.indicatorText)){P.indicatorText='<div class="loading-indicator">'+M.indicatorText+"</div>"
}if(P.indicatorText){CQ.Ext.getDom(M.el).innerHTML=P.indicatorText
}M.success=(CQ.Ext.isFunction(M.success)?M.success:function(){}).createInterceptor(function(R){CQ.Ext.getDom(M.el).innerHTML=R.responseText
})
}var K=M.params,J=M.url||P.url,I,N={success:P.handleResponse,failure:P.handleFailure,scope:P,argument:{options:M},timeout:M.timeout||P.timeout},L,Q;
if(CQ.Ext.isFunction(K)){K=K.call(M.scope||F,M)
}K=CQ.Ext.urlEncode(P.extraParams,CQ.Ext.isObject(K)?CQ.Ext.urlEncode(K):K);
if(CQ.Ext.isFunction(J)){J=J.call(M.scope||F,M)
}J=CQ.HTTP.externalize(J,true);
if((L=CQ.Ext.getDom(M.form))){J=J||L.action;
if(M.isUpload||/multipart\/form-data/i.test(L.getAttribute("enctype"))){return P.doFormUpload.call(P,M,K,J)
}Q=CQ.Ext.lib.Ajax.serializeForm(L);
K=K?(K+"&"+Q):Q
}I=M.method||P.method||((K||M.xmlData||M.jsonData)?H:A);
if(I===A&&(P.disableCaching&&M.disableCaching!==false)||M.disableCaching===true){var O=M.disableCachingParam||P.disableCachingParam;
J=CQ.Ext.urlAppend(J,O+"="+(new Date().getTime()))
}M.headers=CQ.Ext.apply(M.headers||{},P.defaultHeaders||{});
if(M.autoAbort===true||P.autoAbort){P.abort()
}if((I==A||M.xmlData||M.jsonData)&&K){J=CQ.Ext.urlAppend(J,K);
K=""
}return(P.transId=CQ.Ext.lib.Ajax.request(I,J,N,K,M))
}else{return M.callback?M.callback.apply(M.scope,[M,G,G]):null
}},isLoading:function(I){return I?CQ.Ext.lib.Ajax.isCallInProgress(I):!!this.transId
},abort:function(I){if(I||this.isLoading()){CQ.Ext.lib.Ajax.abort(I||this.transId)
}},handleResponse:function(I){this.transId=false;
var J=I.argument.options;
I.argument=J?J.argument:null;
this.fireEvent(E,this,I,J);
if(J.success){J.success.call(J.scope,I,J)
}if(J.callback){J.callback.call(J.scope,J,true,I)
}},handleFailure:function(I,K){this.transId=false;
var J=I.argument.options;
I.argument=J?J.argument:null;
this.fireEvent(D,this,I,J,K);
if(J.failure){J.failure.call(J.scope,I,J)
}if(J.callback){J.callback.call(J.scope,J,false,I)
}},doFormUpload:function(O,I,J){var K=CQ.Ext.id(),T=document,P=T.createElement("iframe"),L=CQ.Ext.getDom(O.form),S=[],R,N="multipart/form-data",M={target:L.target,method:L.method,encoding:L.encoding,enctype:L.enctype,action:L.action};
CQ.Ext.fly(P).set({id:K,name:K,cls:"x-hidden"});
CQ.Util.getRoot().dom.appendChild(P);
CQ.Ext.fly(P).set({src:CQ.Ext.SSL_SECURE_URL});
if(CQ.Ext.isIE){document.frames[K].name=K
}CQ.Ext.fly(L).set({target:K,method:H,enctype:N,encoding:N,action:J||M.action});
CQ.Ext.iterate(CQ.Ext.urlDecode(I,false),function(V,U){R=T.createElement("input");
CQ.Ext.fly(R).set({type:"hidden",value:U,name:V});
L.appendChild(R);
S.push(R)
});
function Q(){var W=this,V={responseText:"",responseXML:null,argument:O.argument},Z,Y;
try{Z=P.contentWindow.document||P.contentDocument||F.frames[K].document;
if(Z){if(Z.body){if(/textarea/i.test((Y=Z.body.firstChild||{}).tagName)){V.responseText=Y.value
}else{V.responseText=Z.body.innerHTML
}}V.responseXML=Z.XMLDocument||Z
}}catch(X){}CQ.Ext.EventManager.removeListener(P,C,Q,W);
W.fireEvent(E,W,V,O);
function U(c,b,a){if(CQ.Ext.isFunction(c)){c.apply(b,a)
}}U(O.success,O.scope,[V,O]);
U(O.callback,O.scope,[O,true,V]);
if(!W.debugUploads){setTimeout(function(){CQ.Ext.removeNode(P)
},100)
}}CQ.Ext.EventManager.on(P,C,Q,this);
L.submit();
CQ.Ext.fly(L).set(M);
CQ.Ext.each(S,function(U){CQ.Ext.removeNode(U)
})
}})
})();
CQ.Ext.Ajax=new CQ.Ext.data.Connection({autoAbort:false,serializeForm:function(A){return CQ.Ext.lib.Ajax.serializeForm(A)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.UpdateManager=CQ.Ext.Updater=CQ.Ext.extend(CQ.Ext.util.Observable,function(){var B="beforeupdate",D="update",C="failure";
function A(G){var H=this;
H.transaction=null;
if(G.argument.form&&G.argument.reset){try{G.argument.form.reset()
}catch(I){}}if(H.loadScripts){H.renderer.render(H.el,G,H,F.createDelegate(H,[G]))
}else{H.renderer.render(H.el,G,H);
F.call(H,G)
}}function F(G,H,I){this.fireEvent(H||D,this.el,G);
if(CQ.Ext.isFunction(G.argument.callback)){G.argument.callback.call(G.argument.scope,this.el,CQ.Ext.isEmpty(I)?true:false,G,G.argument.options)
}}function E(G){F.call(this,G,C,!!(this.transaction=null))
}return{constructor:function(H,G){var I=this;
H=CQ.Ext.get(H);
if(!G&&H.updateManager){return H.updateManager
}I.el=H;
I.defaultUrl=null;
I.addEvents(B,D,C);
CQ.Ext.apply(I,CQ.Ext.Updater.defaults);
I.transaction=null;
I.refreshDelegate=I.refresh.createDelegate(I);
I.updateDelegate=I.update.createDelegate(I);
I.formUpdateDelegate=(I.formUpdate||function(){}).createDelegate(I);
I.renderer=I.renderer||I.getDefaultRenderer();
CQ.Ext.Updater.superclass.constructor.call(I)
},setRenderer:function(G){this.renderer=G
},getRenderer:function(){return this.renderer
},getDefaultRenderer:function(){return new CQ.Ext.Updater.BasicRenderer()
},setDefaultUrl:function(G){this.defaultUrl=G
},getEl:function(){return this.el
},update:function(H,M,N,K){var J=this,G,I;
if(J.fireEvent(B,J.el,H,M)!==false){if(CQ.Ext.isObject(H)){G=H;
H=G.url;
M=M||G.params;
N=N||G.callback;
K=K||G.discardUrl;
I=G.scope;
if(!CQ.Ext.isEmpty(G.nocache)){J.disableCaching=G.nocache
}if(!CQ.Ext.isEmpty(G.text)){J.indicatorText='<div class="loading-indicator">'+G.text+"</div>"
}if(!CQ.Ext.isEmpty(G.scripts)){J.loadScripts=G.scripts
}if(!CQ.Ext.isEmpty(G.timeout)){J.timeout=G.timeout
}}J.showLoading();
if(!K){J.defaultUrl=H
}if(CQ.Ext.isFunction(H)){H=H.call(J)
}var L=CQ.Ext.apply({},{url:H,params:(CQ.Ext.isFunction(M)&&I)?M.createDelegate(I):M,success:A,failure:E,scope:J,callback:undefined,timeout:(J.timeout*1000),disableCaching:J.disableCaching,argument:{options:G,url:H,form:null,callback:N,scope:I||window,params:M}},G);
J.transaction=CQ.Ext.Ajax.request(L)
}},formUpdate:function(J,G,I,K){var H=this;
if(H.fireEvent(B,H.el,J,G)!==false){if(CQ.Ext.isFunction(G)){G=G.call(H)
}J=CQ.Ext.getDom(J);
H.transaction=CQ.Ext.Ajax.request({form:J,url:G,success:A,failure:E,scope:H,timeout:(H.timeout*1000),argument:{url:G,form:J,callback:K,reset:I}});
H.showLoading.defer(1,H)
}},startAutoRefresh:function(H,I,K,L,G){var J=this;
if(G){J.update(I||J.defaultUrl,K,L,true)
}if(J.autoRefreshProcId){clearInterval(J.autoRefreshProcId)
}J.autoRefreshProcId=setInterval(J.update.createDelegate(J,[I||J.defaultUrl,K,L,true]),H*1000)
},stopAutoRefresh:function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId);
delete this.autoRefreshProcId
}},isAutoRefreshing:function(){return !!this.autoRefreshProcId
},showLoading:function(){if(this.showLoadIndicator){this.el.dom.innerHTML=this.indicatorText
}},abort:function(){if(this.transaction){CQ.Ext.Ajax.abort(this.transaction)
}},isUpdating:function(){return this.transaction?CQ.Ext.Ajax.isLoading(this.transaction):false
},refresh:function(G){if(this.defaultUrl){this.update(this.defaultUrl,null,G,true)
}}}
}());
CQ.Ext.Updater.defaults={timeout:30,disableCaching:false,showLoadIndicator:true,indicatorText:'<div class="loading-indicator">Loading...</div>',loadScripts:false,sslBlankUrl:CQ.Ext.SSL_SECURE_URL};
CQ.Ext.Updater.updateElement=function(D,C,E,B){var A=CQ.Ext.get(D).getUpdater();
CQ.Ext.apply(A,B);
A.update(C,E,B?B.callback:null)
};
CQ.Ext.Updater.BasicRenderer=function(){};
CQ.Ext.Updater.BasicRenderer.prototype={render:function(C,A,B,D){C.update(A.responseText,B.loadScripts,D)
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){Date.useStrict=false;
function B(D){var C=Array.prototype.slice.call(arguments,1);
return D.replace(/\{(\d+)\}/g,function(E,F){return C[F]
})
}Date.formatCodeToRegex=function(D,C){var E=Date.parseCodes[D];
if(E){E=typeof E=="function"?E():E;
Date.parseCodes[D]=E
}return E?CQ.Ext.applyIf({c:E.c?B(E.c,C||"{0}"):E.c},E):{g:0,c:null,s:CQ.Ext.escapeRe(D)}
};
var A=Date.formatCodeToRegex;
CQ.Ext.apply(Date,{parseFunctions:{"M$":function(D,C){var E=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/");
var F=(D||"").match(E);
return F?new Date(((F[1]||"")+F[2])*1):null
}},parseRegexes:[],formatFunctions:{"M$":function(){return"\\/Date("+this.getTime()+")\\/"
}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},getShortMonthName:function(C){return Date.monthNames[C].substring(0,3)
},getShortDayName:function(C){return Date.dayNames[C].substring(0,3)
},getMonthNumber:function(C){return Date.monthNumbers[C.substring(0,1).toUpperCase()+C.substring(1,3).toLowerCase()]
},formatCodes:{d:"String.leftPad(this.getDate(), 2, '0')",D:"Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"this.getSuffix()",w:"this.getDay()",z:"this.getDayOfYear()",W:"String.leftPad(this.getWeekOfYear(), 2, '0')",F:"Date.monthNames[this.getMonth()]",m:"String.leftPad(this.getMonth() + 1, 2, '0')",M:"Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"this.getFullYear()",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"String.leftPad(this.getHours(), 2, '0')",i:"String.leftPad(this.getMinutes(), 2, '0')",s:"String.leftPad(this.getSeconds(), 2, '0')",u:"String.leftPad(this.getMilliseconds(), 3, '0')",O:"this.getGMTOffset()",P:"this.getGMTOffset(true)",T:"this.getTimezone()",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var G="Y-m-dTH:i:sP",E=[],D=0,C=G.length;
D<C;
++D){var F=G.charAt(D);
E.push(F=="T"?"'T'":Date.getFormatCode(F))
}return E.join(" + ")
},U:"Math.round(this.getTime() / 1000)"},isValid:function(J,C,I,G,E,F,D){G=G||0;
E=E||0;
F=F||0;
D=D||0;
var H=new Date(J,C-1,I,G,E,F,D);
return J==H.getFullYear()&&C==H.getMonth()+1&&I==H.getDate()&&G==H.getHours()&&E==H.getMinutes()&&F==H.getSeconds()&&D==H.getMilliseconds()
},parseDate:function(D,F,C){var E=Date.parseFunctions;
if(E[F]==null){Date.createParser(F)
}return E[F](D,CQ.Ext.isDefined(C)?C:Date.useStrict)
},getFormatCode:function(D){var C=Date.formatCodes[D];
if(C){C=typeof C=="function"?C():C;
Date.formatCodes[D]=C
}return C||("'"+String.escape(D)+"'")
},createFormat:function(G){var F=[],C=false,E="";
for(var D=0;
D<G.length;
++D){E=G.charAt(D);
if(!C&&E=="\\"){C=true
}else{if(C){C=false;
F.push("'"+String.escape(E)+"'")
}else{F.push(Date.getFormatCode(E))
}}}Date.formatFunctions[G]=new Function("return "+F.join("+"))
},createParser:function(){var C=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Date.defaults,","results = String(input).match(Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = (new Date()).clearTime();","y = CQ.Ext.num(y, CQ.Ext.num(def.y, dt.getFullYear()));","m = CQ.Ext.num(m, CQ.Ext.num(def.m - 1, dt.getMonth()));","d = CQ.Ext.num(d, CQ.Ext.num(def.d, dt.getDate()));","h  = CQ.Ext.num(h, CQ.Ext.num(def.h, dt.getHours()));","i  = CQ.Ext.num(i, CQ.Ext.num(def.i, dt.getMinutes()));","s  = CQ.Ext.num(s, CQ.Ext.num(def.s, dt.getSeconds()));","ms = CQ.Ext.num(ms, CQ.Ext.num(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = new Date(y, 0, 1, h, i, s, ms);","v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);","}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = new Date(y, m, d, h, i, s, ms);","}","}","}","if(v){","if(zz != null){","v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");
return function(K){var E=Date.parseRegexes.length,L=1,F=[],J=[],I=false,D="";
for(var H=0;
H<K.length;
++H){D=K.charAt(H);
if(!I&&D=="\\"){I=true
}else{if(I){I=false;
J.push(String.escape(D))
}else{var G=A(D,L);
L+=G.g;
J.push(G.s);
if(G.g&&G.c){F.push(G.c)
}}}}Date.parseRegexes[E]=new RegExp("^"+J.join("")+"$","i");
Date.parseFunctions[K]=new Function("input","strict",B(C,E,F.join("")))
}
}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var C=[],D=0;
D<7;
C.push(Date.getShortDayName(D)),++D){}return{g:0,c:null,s:"(?:"+C.join("|")+")"}
},l:function(){return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"}
},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n",s:"("+Date.monthNames.join("|")+")"}
},M:function(){for(var C=[],D=0;
D<12;
C.push(Date.getShortMonthName(D)),++D){}return CQ.Ext.applyIf({s:"("+C.join("|")+")"},A("F"))
},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return A("Y")
},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (results[{0}] == 'am') {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm)"},A:{g:1,c:"if (results[{0}] == 'AM') {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM)"},g:function(){return A("G")
},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return A("H")
},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var E=[],C=[A("Y",1),A("m",2),A("d",3),A("h",4),A("i",5),A("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",A("P",8).c,"}else{",A("O",8).c,"}","}"].join("\n")}];
for(var F=0,D=C.length;
F<D;
++F){E.push(C[F].c)
}return{g:1,c:E.join(""),s:[C[0].s,"(?:","-",C[1].s,"(?:","-",C[2].s,"(?:","(?:T| )?",C[3].s,":",C[4].s,"(?::",C[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}
},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}}})
}());
CQ.Ext.apply(Date.prototype,{dateFormat:function(A){if(Date.formatFunctions[A]==null){Date.createFormat(A)
}return Date.formatFunctions[A].call(this)
},getTimezone:function(){return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")
},getGMTOffset:function(A){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+(A?":":"")+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0")
},getDayOfYear:function(){var B=0,D=this.clone(),A=this.getMonth(),C;
for(C=0,D.setDate(1),D.setMonth(0);
C<A;
D.setMonth(++C)){B+=D.getDaysInMonth()
}return B+this.getDate()-1
},getWeekOfYear:function(){var A=86400000,B=7*A;
return function(){var D=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/A,C=Math.floor(D/7),E=new Date(C*B).getUTCFullYear();
return C-Math.floor(Date.UTC(E,0,7)/B)+1
}
}(),isLeapYear:function(){var A=this.getFullYear();
return !!((A&3)==0&&(A%100||(A%400==0&&A)))
},getFirstDayOfMonth:function(){var A=(this.getDay()-(this.getDate()-1))%7;
return(A<0)?(A+7):A
},getLastDayOfMonth:function(){return this.getLastDateOfMonth().getDay()
},getFirstDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1)
},getLastDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())
},getDaysInMonth:function(){var A=[31,28,31,30,31,30,31,31,30,31,30,31];
return function(){var B=this.getMonth();
return B==1&&this.isLeapYear()?29:A[B]
}
}(),getSuffix:function(){switch(this.getDate()){case 1:case 21:case 31:return"st";
case 2:case 22:return"nd";
case 3:case 23:return"rd";
default:return"th"
}},clone:function(){return new Date(this.getTime())
},isDST:function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()
},clearTime:function(D){if(D){return this.clone().clearTime()
}var B=this.getDate();
this.setHours(0);
this.setMinutes(0);
this.setSeconds(0);
this.setMilliseconds(0);
if(this.getDate()!=B){for(var A=1,C=this.add(Date.HOUR,A);
C.getDate()!=B;
A++,C=this.add(Date.HOUR,A)){}this.setDate(B);
this.setHours(C.getHours())
}return this
},add:function(B,C){var D=this.clone();
if(!B||C===0){return D
}switch(B.toLowerCase()){case Date.MILLI:D.setMilliseconds(this.getMilliseconds()+C);
break;
case Date.SECOND:D.setSeconds(this.getSeconds()+C);
break;
case Date.MINUTE:D.setMinutes(this.getMinutes()+C);
break;
case Date.HOUR:D.setHours(this.getHours()+C);
break;
case Date.DAY:D.setDate(this.getDate()+C);
break;
case Date.MONTH:var A=this.getDate();
if(A>28){A=Math.min(A,this.getFirstDateOfMonth().add("mo",C).getLastDateOfMonth().getDate())
}D.setDate(A);
D.setMonth(this.getMonth()+C);
break;
case Date.YEAR:D.setFullYear(this.getFullYear()+C);
break
}return D
},between:function(C,A){var B=this.getTime();
return C.getTime()<=B&&B<=A.getTime()
}});
Date.prototype.format=Date.prototype.dateFormat;
if(CQ.Ext.isSafari&&(navigator.userAgent.match(/WebKit\/(\d+)/)[1]||NaN)<420){CQ.Ext.apply(Date.prototype,{_xMonth:Date.prototype.setMonth,_xDate:Date.prototype.setDate,setMonth:function(A){if(A<=-1){var D=Math.ceil(-A),C=Math.ceil(D/12),B=(D%12)?12-D%12:0;
this.setFullYear(this.getFullYear()-C);
return this._xMonth(B)
}else{return this._xMonth(A)
}},setDate:function(A){return this.setTime(this.getTime()-(this.getDate()-A)*86400000)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
}CQ.Ext.util.MixedCollection=function(B,A){this.items=[];
this.map={};
this.keys=[];
this.length=0;
this.addEvents("clear","add","replace","remove","sort");
this.allowFunctions=B===true;
if(A){this.getKey=A
}CQ.Ext.util.MixedCollection.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.util.MixedCollection,CQ.Ext.util.Observable,{allowFunctions:false,add:function(B,C){if(arguments.length==1){C=arguments[0];
B=this.getKey(C)
}if(typeof B!="undefined"&&B!==null){var A=this.map[B];
if(typeof A!="undefined"){return this.replace(B,C)
}this.map[B]=C
}this.length++;
this.items.push(C);
this.keys.push(B);
this.fireEvent("add",this.length-1,C,B);
return C
},getKey:function(A){return A.id
},replace:function(C,D){if(arguments.length==1){D=arguments[0];
C=this.getKey(D)
}var A=this.map[C];
if(typeof C=="undefined"||C===null||typeof A=="undefined"){return this.add(C,D)
}var B=this.indexOfKey(C);
this.items[B]=D;
this.map[C]=D;
this.fireEvent("replace",C,A,D);
return D
},addAll:function(E){if(arguments.length>1||CQ.Ext.isArray(E)){var B=arguments.length>1?arguments:E;
for(var D=0,A=B.length;
D<A;
D++){this.add(B[D])
}}else{for(var C in E){if(this.allowFunctions||typeof E[C]!="function"){this.add(C,E[C])
}}}},each:function(E,D){var B=[].concat(this.items);
for(var C=0,A=B.length;
C<A;
C++){if(E.call(D||B[C],B[C],C,A)===false){break
}}},eachKey:function(D,C){for(var B=0,A=this.keys.length;
B<A;
B++){D.call(C||window,this.keys[B],this.items[B],B,A)
}},find:function(D,C){for(var B=0,A=this.items.length;
B<A;
B++){if(D.call(C||window,this.items[B],this.keys[B])){return this.items[B]
}}return null
},insert:function(A,B,C){if(arguments.length==2){C=arguments[1];
B=this.getKey(C)
}if(this.containsKey(B)){this.suspendEvents();
this.removeKey(B);
this.resumeEvents()
}if(A>=this.length){return this.add(B,C)
}this.length++;
this.items.splice(A,0,C);
if(typeof B!="undefined"&&B!==null){this.map[B]=C
}this.keys.splice(A,0,B);
this.fireEvent("add",A,C,B);
return C
},remove:function(A){return this.removeAt(this.indexOf(A))
},removeAt:function(A){if(A<this.length&&A>=0){this.length--;
var C=this.items[A];
this.items.splice(A,1);
var B=this.keys[A];
if(typeof B!="undefined"){delete this.map[B]
}this.keys.splice(A,1);
this.fireEvent("remove",C,B);
return C
}return false
},removeKey:function(A){return this.removeAt(this.indexOfKey(A))
},getCount:function(){return this.length
},indexOf:function(A){return this.items.indexOf(A)
},indexOfKey:function(A){return this.keys.indexOf(A)
},item:function(B){var A=this.map[B],C=A!==undefined?A:(typeof B=="number")?this.items[B]:undefined;
return !CQ.Ext.isFunction(C)||this.allowFunctions?C:null
},itemAt:function(A){return this.items[A]
},key:function(A){return this.map[A]
},contains:function(A){return this.indexOf(A)!=-1
},containsKey:function(A){return typeof this.map[A]!="undefined"
},clear:function(){this.length=0;
this.items=[];
this.keys=[];
this.map={};
this.fireEvent("clear")
},first:function(){return this.items[0]
},last:function(){return this.items[this.length-1]
},_sort:function(I,A,H){var D,E,C=String(A).toUpperCase()=="DESC"?-1:1,G=[],B=this.keys,F=this.items;
H=H||function(K,J){return K-J
};
for(D=0,E=F.length;
D<E;
D++){G[G.length]={key:B[D],value:F[D],index:D}
}G.sort(function(K,J){var L=H(K[I],J[I])*C;
if(L===0){L=(K.index<J.index?-1:1)
}return L
});
for(D=0,E=G.length;
D<E;
D++){F[D]=G[D].value;
B[D]=G[D].key
}this.fireEvent("sort",this)
},sort:function(A,B){this._sort("value",A,B)
},keySort:function(A,B){this._sort("key",A,B||function(D,C){var F=String(D).toUpperCase(),E=String(C).toUpperCase();
return F>E?1:(F<E?-1:0)
})
},getRange:function(E,A){var B=this.items;
if(B.length<1){return[]
}E=E||0;
A=Math.min(typeof A=="undefined"?this.length-1:A,this.length-1);
var C,D=[];
if(E<=A){for(C=E;
C<=A;
C++){D[D.length]=B[C]
}}else{for(C=E;
C>=A;
C--){D[D.length]=B[C]
}}return D
},filter:function(C,B,D,A){if(CQ.Ext.isEmpty(B,false)){return this.clone()
}B=this.createValueMatcher(B,D,A);
return this.filterBy(function(E){return E&&B.test(E[C])
})
},filterBy:function(F,E){var G=new CQ.Ext.util.MixedCollection();
G.getKey=this.getKey;
var B=this.keys,D=this.items;
for(var C=0,A=D.length;
C<A;
C++){if(F.call(E||this,D[C],B[C])){G.add(B[C],D[C])
}}return G
},findIndex:function(C,B,E,D,A){if(CQ.Ext.isEmpty(B,false)){return -1
}B=this.createValueMatcher(B,D,A);
return this.findIndexBy(function(F){return F&&B.test(F[C])
},null,E)
},findIndexBy:function(F,E,G){var B=this.keys,D=this.items;
for(var C=(G||0),A=D.length;
C<A;
C++){if(F.call(E||this,D[C],B[C])){return C
}}return -1
},createValueMatcher:function(C,E,A,B){if(!C.exec){var D=CQ.Ext.escapeRe;
C=String(C);
if(E===true){C=D(C)
}else{C="^"+D(C);
if(B===true){C+="$"
}}C=new RegExp(C,A?"":"i")
}return C
},clone:function(){var E=new CQ.Ext.util.MixedCollection();
var B=this.keys,D=this.items;
for(var C=0,A=D.length;
C<A;
C++){E.add(B[C],D[C])
}E.getKey=this.getKey;
return E
}});
CQ.Ext.util.MixedCollection.prototype.get=CQ.Ext.util.MixedCollection.prototype.item;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.JSON=new (function(){var useHasOwn=!!{}.hasOwnProperty,isNative=function(){var useNative=null;
return function(){if(useNative===null){useNative=CQ.Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"
}return useNative
}
}(),pad=function(n){return n<10?"0"+n:n
},doDecode=function(json){return eval("("+json+")")
},doEncode=function(o){if(!CQ.Ext.isDefined(o)||o===null){return"null"
}else{if(CQ.Ext.isArray(o)){return encodeArray(o)
}else{if(CQ.Ext.isDate(o)){return CQ.Ext.util.JSON.encodeDate(o)
}else{if(CQ.Ext.isString(o)){return encodeString(o)
}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"
}else{if(CQ.Ext.isBoolean(o)){return String(o)
}else{var a=["{"],b,i,v;
for(i in o){if(!o.getElementsByTagName){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];
switch(typeof v){case"undefined":case"function":case"unknown":break;
default:if(b){a.push(",")
}a.push(doEncode(i),":",v===null?"null":doEncode(v));
b=true
}}}}a.push("}");
return a.join("")
}}}}}}},m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];
if(c){return c
}c=b.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}return'"'+s+'"'
},encodeArray=function(o){var a=["["],b,i,l=o.length,v;
for(i=0;
i<l;
i+=1){v=o[i];
switch(typeof v){case"undefined":case"function":case"unknown":break;
default:if(b){a.push(",")
}a.push(v===null?"null":CQ.Ext.util.JSON.encode(v));
b=true
}}a.push("]");
return a.join("")
};
this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'
};
this.encode=function(){var ec;
return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode
}return ec(o)
}
}();
this.decode=function(){var dc;
return function(json){if(!dc){dc=isNative()?JSON.parse:doDecode
}return dc(json)
}
}()
})();
CQ.Ext.encode=CQ.Ext.util.JSON.encode;
CQ.Ext.decode=CQ.Ext.util.JSON.decode;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.Format=function(){var trimRe=/^\s+|\s+$/g,stripTagsRE=/<\/?[^>]+>/gi,stripScriptsRe=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,nl2brRe=/\r?\n/g;
return{ellipsis:function(value,len,word){if(value&&value.length>len){if(word){var vs=value.substr(0,len-2),index=Math.max(vs.lastIndexOf(" "),vs.lastIndexOf("."),vs.lastIndexOf("!"),vs.lastIndexOf("?"));
if(index==-1||index<(len-15)){return value.substr(0,len-3)+"..."
}else{return vs.substr(0,index)+"..."
}}else{return value.substr(0,len-3)+"..."
}}return value
},undef:function(value){return value!==undefined?value:""
},defaultValue:function(value,defaultValue){return value!==undefined&&value!==""?value:defaultValue
},htmlEncode:function(value){return !value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")
},htmlDecode:function(value){return !value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")
},trim:function(value){return String(value).replace(trimRe,"")
},substr:function(value,start,length){return String(value).substr(start,length)
},lowercase:function(value){return String(value).toLowerCase()
},uppercase:function(value){return String(value).toUpperCase()
},capitalize:function(value){return !value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase()
},call:function(value,fn){if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);
args.unshift(value);
return eval(fn).apply(window,args)
}else{return eval(fn).call(window,value)
}},usMoney:function(v){v=(Math.round((v-0)*100))/100;
v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);
v=String(v);
var ps=v.split("."),whole=ps[0],sub=ps[1]?"."+ps[1]:".00",r=/(\d+)(\d{3})/;
while(r.test(whole)){whole=whole.replace(r,"$1,$2")
}v=whole+sub;
if(v.charAt(0)=="-"){return"-$"+v.substr(1)
}return"$"+v
},date:function(v,format){if(!v){return""
}if(!CQ.Ext.isDate(v)){v=new Date(Date.parse(v))
}return v.dateFormat(format||"m/d/Y")
},dateRenderer:function(format){return function(v){return CQ.Ext.util.Format.date(v,format)
}
},stripTags:function(v){return !v?v:String(v).replace(stripTagsRE,"")
},stripScripts:function(v){return !v?v:String(v).replace(stripScriptsRe,"")
},fileSize:function(size){if(size<1024){return size+" bytes"
}else{if(size<1048576){return(Math.round(((size*10)/1024))/10)+" KB"
}else{return(Math.round(((size*10)/1048576))/10)+" MB"
}}},math:function(){var fns={};
return function(v,a){if(!fns[a]){fns[a]=new Function("v","return v "+a+";")
}return fns[a](v)
}
}(),round:function(value,precision){var result=Number(value);
if(typeof precision=="number"){precision=Math.pow(10,precision);
result=Math.round(value*precision)/precision
}return result
},number:function(v,format){if(!format){return v
}v=CQ.Ext.num(v,NaN);
if(isNaN(v)){return""
}var comma=",",dec=".",i18n=false,neg=v<0;
v=Math.abs(v);
if(format.substr(format.length-2)=="/i"){format=format.substr(0,format.length-2);
i18n=true;
comma=".";
dec=","
}var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,""):format.replace(/[^\d\.]/g,"")).split(dec);
if(1<psplit.length){v=v.toFixed(psplit[1].length)
}else{if(2<psplit.length){throw ("NumberFormatException: invalid format, formats should have no more than 1 period: "+format)
}else{v=v.toFixed(0)
}}var fnum=v.toString();
if(hasComma){psplit=fnum.split(".");
var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3;
for(var i=0;
i<j;
i+=n){if(i!=0){n=3
}parr[parr.length]=cnum.substr(i,n);
m-=1
}fnum=parr.join(comma);
if(psplit[1]){fnum+=dec+psplit[1]
}}return(neg?"-":"")+format.replace(/[\d,?\.?]+/,fnum)
},numberRenderer:function(format){return function(v){return CQ.Ext.util.Format.number(v,format)
}
},plural:function(v,s,p){return v+" "+(v==1?s:(p?p:s+"s"))
},nl2br:function(v){return CQ.Ext.isEmpty(v)?"":v.replace(nl2brRe,"<br/>")
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.XTemplate=function(){CQ.Ext.XTemplate.superclass.constructor.apply(this,arguments);
var T=this,H=T.html,N=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,D=/^<tpl\b[^>]*?for="(.*?)"/,Q=/^<tpl\b[^>]*?if="(.*?)"/,S=/^<tpl\b[^>]*?exec="(.*?)"/,O,M=0,I=[],L="values",R="parent",J="xindex",K="xcount",E="return ",C="with(values){ ";
H=["<tpl>",H,"</tpl>"].join("");
while((O=H.match(N))){var B=O[0].match(D),A=O[0].match(Q),V=O[0].match(S),F=null,G=null,P=null,U=B&&B[1]?B[1]:"";
if(A){F=A&&A[1]?A[1]:null;
if(F){G=new Function(L,R,J,K,C+E+(CQ.Ext.util.Format.htmlDecode(F))+"; }")
}}if(V){F=V&&V[1]?V[1]:null;
if(F){P=new Function(L,R,J,K,C+(CQ.Ext.util.Format.htmlDecode(F))+"; }")
}}if(U){switch(U){case".":U=new Function(L,R,C+E+L+"; }");
break;
case"..":U=new Function(L,R,C+E+R+"; }");
break;
default:U=new Function(L,R,C+E+U+"; }")
}}I.push({id:M,target:U,exec:P,test:G,body:O[1]||""});
H=H.replace(O[0],"{xtpl"+M+"}");
++M
}CQ.Ext.each(I,function(W){T.compileTpl(W)
});
T.master=I[I.length-1];
T.tpls=I
};
CQ.Ext.extend(CQ.Ext.XTemplate,CQ.Ext.Template,{re:/\{([\w-\.\#]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,applySubTemplate:function(A,H,G,D,C){var F=this,E,J=F.tpls[A],I,B=[];
if((J.test&&!J.test.call(F,H,G,D,C))||(J.exec&&J.exec.call(F,H,G,D,C))){return""
}I=J.target?J.target.call(F,H,G):H;
E=I.length;
G=J.target?H:G;
if(J.target&&CQ.Ext.isArray(I)){CQ.Ext.each(I,function(K,L){B[B.length]=J.compiled.call(F,K,G,L+1,E)
});
return B.join("")
}return J.compiled.call(F,I,G,D,C)
},compileTpl:function(tpl){var fm=CQ.Ext.util.Format,useF=this.disableFormats!==true,sep=CQ.Ext.isGecko?"+":",",body;
function fn(m,name,format,args,math){if(name.substr(0,4)=="xtpl"){return"'"+sep+"this.applySubTemplate("+name.substr(4)+", values, parent, xindex, xcount)"+sep+"'"
}var v;
if(name==="."){v="values"
}else{if(name==="#"){v="xindex"
}else{if(name.indexOf(".")!=-1){v=name
}else{v="values['"+name+"']"
}}}if(math){v="("+v+math+")"
}if(format&&useF){args=args?","+args:"";
if(format.substr(0,5)!="this."){format="fm."+format+"("
}else{format='this.call("'+format.substr(5)+'", ';
args=", values"
}}else{args="";
format="("+v+" === undefined ? '' : "
}return"'"+sep+format+v+args+")"+sep+"'"
}function codeFn(m,code){return"'"+sep+"("+code.replace(/\\'/g,"'")+")"+sep+"'"
}if(CQ.Ext.isGecko){body="tpl.compiled = function(values, parent, xindex, xcount){ return '"+tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn)+"';};"
}else{body=["tpl.compiled = function(values, parent, xindex, xcount){ return ['"];
body.push(tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn));
body.push("'].join('');};");
body=body.join("")
}eval(body);
return this
},applyTemplate:function(A){return this.master.compiled.call(this,A,{},1,1)
},compile:function(){return this
}});
CQ.Ext.XTemplate.prototype.apply=CQ.Ext.XTemplate.prototype.applyTemplate;
CQ.Ext.XTemplate.from=function(A){A=CQ.Ext.getDom(A);
return new CQ.Ext.XTemplate(A.value||A.innerHTML)
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.CSS=function(){var D=null;
var C=document;
var B=/(-[a-z])/gi;
var A=function(E,F){return F.charAt(1).toUpperCase()
};
return{createStyleSheet:function(G,J){var F;
var E=C.getElementsByTagName("head")[0];
var I=C.createElement("style");
I.setAttribute("type","text/css");
if(J){I.setAttribute("id",J)
}if(I.styleSheet){I.styleSheet.cssText=G;
E.appendChild(I)
}else{try{I.appendChild(C.createTextNode(G))
}catch(H){I.cssText=G
}E.appendChild(I);
F=I.styleSheet?I.styleSheet:(I.sheet||C.styleSheets[C.styleSheets.length-1])
}this.cacheStyleSheet(F);
return F
},removeStyleSheet:function(F){var E=C.getElementById(F);
if(E){E.parentNode.removeChild(E)
}},swapStyleSheet:function(G,E){this.removeStyleSheet(G);
var F=C.createElement("link");
F.setAttribute("rel","stylesheet");
F.setAttribute("type","text/css");
F.setAttribute("id",G);
F.setAttribute("href",E);
C.getElementsByTagName("head")[0].appendChild(F)
},refreshCache:function(){return this.getRules(true)
},cacheStyleSheet:function(F){if(!D){D={}
}try{var H=F.cssRules||F.rules;
for(var E=H.length-1;
E>=0;
--E){D[H[E].selectorText.toLowerCase()]=H[E]
}}catch(G){}},getRules:function(F){if(D===null||F){D={};
var H=C.styleSheets;
for(var G=0,E=H.length;
G<E;
G++){try{this.cacheStyleSheet(H[G])
}catch(I){}}}return D
},getRule:function(E,G){var F=this.getRules(G);
if(!CQ.Ext.isArray(E)){return F[E.toLowerCase()]
}for(var H=0;
H<E.length;
H++){if(F[E[H]]){return F[E[H].toLowerCase()]
}}return null
},updateRule:function(E,H,G){if(!CQ.Ext.isArray(E)){var I=this.getRule(E);
if(I){I.style[H.replace(B,A)]=G;
return true
}}else{for(var F=0;
F<E.length;
F++){if(this.updateRule(E[F],H,G)){return true
}}}return false
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.ClickRepeater=function(B,A){this.el=CQ.Ext.get(B);
this.el.unselectable();
CQ.Ext.apply(this,A);
this.addEvents("mousedown","click","mouseup");
if(!this.disabled){this.disabled=true;
this.enable()
}if(this.handler){this.on("click",this.handler,this.scope||this)
}CQ.Ext.util.ClickRepeater.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.util.ClickRepeater,CQ.Ext.util.Observable,{interval:20,delay:250,preventDefault:true,stopDefault:false,timer:0,enable:function(){if(this.disabled){this.el.on("mousedown",this.handleMouseDown,this);
if(this.preventDefault||this.stopDefault){this.el.on("click",this.eventOptions,this)
}}this.disabled=false
},disable:function(A){if(A||!this.disabled){clearTimeout(this.timer);
if(this.pressClass){this.el.removeClass(this.pressClass)
}CQ.Ext.getDoc().un("mouseup",this.handleMouseUp,this);
this.el.removeAllListeners()
}this.disabled=true
},setDisabled:function(A){this[A?"disable":"enable"]()
},eventOptions:function(A){if(this.preventDefault){A.preventDefault()
}if(this.stopDefault){A.stopEvent()
}},destroy:function(){this.disable(true);
CQ.Ext.destroy(this.el);
this.purgeListeners()
},handleMouseDown:function(){clearTimeout(this.timer);
this.el.blur();
if(this.pressClass){this.el.addClass(this.pressClass)
}this.mousedownTime=new Date();
CQ.Ext.getDoc().on("mouseup",this.handleMouseUp,this);
this.el.on("mouseout",this.handleMouseOut,this);
this.fireEvent("mousedown",this);
this.fireEvent("click",this);
if(this.accelerate){this.delay=400
}this.timer=this.click.defer(this.delay||this.interval,this)
},click:function(){this.fireEvent("click",this);
this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12000):this.interval,this)
},easeOutExpo:function(B,A,D,C){return(B==C)?A+D:D*(-Math.pow(2,-10*B/C)+1)+A
},handleMouseOut:function(){clearTimeout(this.timer);
if(this.pressClass){this.el.removeClass(this.pressClass)
}this.el.on("mouseover",this.handleMouseReturn,this)
},handleMouseReturn:function(){this.el.un("mouseover",this.handleMouseReturn,this);
if(this.pressClass){this.el.addClass(this.pressClass)
}this.click()
},handleMouseUp:function(){clearTimeout(this.timer);
this.el.un("mouseover",this.handleMouseReturn,this);
this.el.un("mouseout",this.handleMouseOut,this);
CQ.Ext.getDoc().un("mouseup",this.handleMouseUp,this);
this.el.removeClass(this.pressClass);
this.fireEvent("mouseup",this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.KeyNav=function(B,A){this.el=CQ.Ext.get(B);
CQ.Ext.apply(this,A);
if(!this.disabled){this.disabled=true;
this.enable()
}};
CQ.Ext.KeyNav.prototype={disabled:false,defaultEventAction:"stopEvent",forceKeyDown:false,relay:function(C){var A=C.getKey();
var B=this.keyToHandler[A];
if(B&&this[B]){if(this.doRelay(C,this[B],B)!==true){C[this.defaultEventAction]()
}}},doRelay:function(C,B,A){return B.call(this.scope||this,C)
},enter:false,left:false,right:false,up:false,down:false,tab:false,esc:false,pageUp:false,pageDown:false,del:false,home:false,end:false,keyToHandler:{37:"left",39:"right",38:"up",40:"down",33:"pageUp",34:"pageDown",46:"del",36:"home",35:"end",13:"enter",27:"esc",9:"tab"},stopKeyUp:function(B){var A=B.getKey();
if(A>=37&&A<=40){B.stopEvent()
}},destroy:function(){this.disable()
},enable:function(){if(this.disabled){if(CQ.Ext.isSafari2){this.el.on("keyup",this.stopKeyUp,this)
}this.el.on(this.isKeydown()?"keydown":"keypress",this.relay,this);
this.disabled=false
}},disable:function(){if(!this.disabled){if(CQ.Ext.isSafari2){this.el.un("keyup",this.stopKeyUp,this)
}this.el.un(this.isKeydown()?"keydown":"keypress",this.relay,this);
this.disabled=true
}},setDisabled:function(A){this[A?"disable":"enable"]()
},isKeydown:function(){return this.forceKeyDown||CQ.Ext.EventManager.useKeydown
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.KeyMap=function(C,B,A){this.el=CQ.Ext.get(C);
this.eventName=A||"keydown";
this.bindings=[];
if(B){this.addBinding(B)
}this.enable()
};
CQ.Ext.KeyMap.prototype={stopEvent:false,addBinding:function(B){if(CQ.Ext.isArray(B)){CQ.Ext.each(B,function(K){this.addBinding(K)
},this);
return 
}var I=B.key,F=B.fn||B.handler,J=B.scope;
if(B.stopEvent){this.stopEvent=B.stopEvent
}if(typeof I=="string"){var G=[];
var E=I.toUpperCase();
for(var C=0,D=E.length;
C<D;
C++){G.push(E.charCodeAt(C))
}I=G
}var A=CQ.Ext.isArray(I);
var H=function(N){if(this.checkModifiers(B,N)){var L=N.getKey();
if(A){for(var M=0,K=I.length;
M<K;
M++){if(I[M]==L){if(this.stopEvent){N.stopEvent()
}F.call(J||window,L,N);
return 
}}}else{if(L==I){if(this.stopEvent){N.stopEvent()
}F.call(J||window,L,N)
}}}};
this.bindings.push(H)
},checkModifiers:function(B,F){var G,D,E=["shift","ctrl","alt"];
for(var C=0,A=E.length;
C<A;
++C){D=E[C];
G=B[D];
if(!(G===undefined||(G===F[D+"Key"]))){return false
}}return true
},on:function(B,D,C){var G,A,E,F;
if(typeof B=="object"&&!CQ.Ext.isArray(B)){G=B.key;
A=B.shift;
E=B.ctrl;
F=B.alt
}else{G=B
}this.addBinding({key:G,shift:A,ctrl:E,alt:F,fn:D,scope:C})
},handleKeyDown:function(D){if(this.enabled){var B=this.bindings;
for(var C=0,A=B.length;
C<A;
C++){B[C].call(this,D)
}}},isEnabled:function(){return this.enabled
},enable:function(){if(!this.enabled){this.el.on(this.eventName,this.handleKeyDown,this);
this.enabled=true
}},disable:function(){if(this.enabled){this.el.removeListener(this.eventName,this.handleKeyDown,this);
this.enabled=false
}},setDisabled:function(A){this[A?"disable":"enable"]()
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.TextMetrics=function(){var A;
return{measure:function(B,C,D){if(!A){A=CQ.Ext.util.TextMetrics.Instance(B,D)
}A.bind(B);
A.setFixedWidth(D||"auto");
return A.getSize(C)
},createInstance:function(B,C){return CQ.Ext.util.TextMetrics.Instance(B,C)
}}
}();
CQ.Ext.util.TextMetrics.Instance=function(B,D){var C=new CQ.Ext.Element(document.createElement("div"));
CQ.Util.getRoot().appendChild(C.dom);
C.position("absolute");
C.setLeftTop(-1000,-1000);
C.hide();
if(D){C.setWidth(D)
}var A={getSize:function(F){C.update(F);
var E=C.getSize();
C.update("");
return E
},bind:function(E){C.setStyle(CQ.Ext.fly(E).getStyles("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"))
},setFixedWidth:function(E){C.setWidth(E)
},getWidth:function(E){C.dom.style.width="auto";
return this.getSize(E).width
},getHeight:function(E){return this.getSize(E).height
}};
A.bind(B);
return A
};
CQ.Ext.Element.addMethods({getTextWidth:function(C,B,A){return(CQ.Ext.util.TextMetrics.measure(this.dom,CQ.Ext.value(C,this.dom.innerHTML,true)).width).constrain(B||0,A||1000000)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.util.Cookies={set:function(C,E){var A=arguments;
var H=arguments.length;
var B=(H>2)?A[2]:null;
var G=(H>3)?A[3]:"/";
var D=(H>4)?A[4]:null;
var F=(H>5)?A[5]:false;
document.cookie=C+"="+escape(E)+((B===null)?"":("; expires="+B.toGMTString()))+((G===null)?"":("; path="+G))+((D===null)?"":("; domain="+D))+((F===true)?"; secure":"")
},get:function(D){var B=D+"=";
var F=B.length;
var A=document.cookie.length;
var E=0;
var C=0;
while(E<A){C=E+F;
if(document.cookie.substring(E,C)==B){return CQ.Ext.util.Cookies.getCookieVal(C)
}E=document.cookie.indexOf(" ",E)+1;
if(E===0){break
}}return null
},clear:function(A){if(CQ.Ext.util.Cookies.get(A)){document.cookie=A+"=; expires=Thu, 01-Jan-70 00:00:01 GMT"
}},getCookieVal:function(B){var A=document.cookie.indexOf(";",B);
if(A==-1){A=document.cookie.length
}return unescape(document.cookie.substring(B,A))
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.handleError=function(A){throw A
};
CQ.Ext.Error=function(A){this.message=(this.lang[A])?this.lang[A]:A
};
CQ.Ext.Error.prototype=new Error();
CQ.Ext.apply(CQ.Ext.Error.prototype,{lang:{},name:"CQ.Ext.Error",getName:function(){return this.name
},getMessage:function(){return this.message
},toJson:function(){return CQ.Ext.encode(this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ComponentMgr=function(){var C=new CQ.Ext.util.MixedCollection();
var B={};
var A={};
return{register:function(D){C.add(D)
},unregister:function(D){C.remove(D)
},get:function(D){return C.get(D)
},onAvailable:function(F,E,D){C.on("add",function(G,H){if(H.id==F){E.call(D||H,H);
C.un("add",E,D)
}})
},all:C,types:B,ptypes:A,isRegistered:function(D){return B[D]!==undefined
},isPluginRegistered:function(D){return A[D]!==undefined
},registerType:function(E,D){B[E]=D;
D.xtype=E
},create:function(D,F){if(D.render){return D
}else{var E=B[D.xtype||F];
if(!E){throw ("cannot create Component: xtype '"+D.xtype+"' not found and no default supplied")
}return new E(D)
}},registerPlugin:function(E,D){A[E]=D;
D.ptype=E
},createPlugin:function(E,F){var D=A[E.ptype||F];
if(D.init){return D
}else{return new D(E)
}}}
}();
CQ.Ext.reg=CQ.Ext.ComponentMgr.registerType;
CQ.Ext.preg=CQ.Ext.ComponentMgr.registerPlugin;
CQ.Ext.create=CQ.Ext.ComponentMgr.create;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Component=function(B){B=B||{};
if(B.initialConfig){if(B.isAction){this.baseAction=B
}B=B.initialConfig
}else{if(B.tagName||B.dom||CQ.Ext.isString(B)){B={applyTo:B,id:B.id||B}
}}this.initialConfig=B;
CQ.Ext.apply(this,B);
this.addEvents("added","disable","enable","beforeshow","show","beforehide","hide","removed","beforerender","render","afterrender","beforedestroy","destroy","beforestaterestore","staterestore","beforestatesave","statesave");
this.getId();
CQ.Ext.ComponentMgr.register(this);
CQ.Ext.Component.superclass.constructor.call(this);
if(this.baseAction){this.baseAction.addComponent(this)
}this.initComponent();
if(this.plugins){if(CQ.Ext.isArray(this.plugins)){for(var C=0,A=this.plugins.length;
C<A;
C++){this.plugins[C]=this.initPlugin(this.plugins[C])
}}else{this.plugins=this.initPlugin(this.plugins)
}}if(this.stateful!==false){this.initState()
}if(this.applyTo){this.applyToMarkup(this.applyTo);
delete this.applyTo
}else{if(this.renderTo){this.render(this.renderTo);
delete this.renderTo
}}};
CQ.Ext.Component.AUTO_ID=1000;
CQ.Ext.extend(CQ.Ext.Component,CQ.Ext.util.Observable,{disabled:false,hidden:false,autoEl:"div",disabledClass:"x-item-disabled",allowDomMove:true,autoShow:false,hideMode:"display",hideParent:false,rendered:false,tplWriteMode:"overwrite",ctype:"CQ.Ext.Component",actionMode:"el",getActionEl:function(){return this[this.actionMode]
},initPlugin:function(A){if(A.ptype&&!CQ.Ext.isFunction(A.init)){A=CQ.Ext.ComponentMgr.createPlugin(A)
}else{if(CQ.Ext.isString(A)){A=CQ.Ext.ComponentMgr.createPlugin({ptype:A})
}}A.init(this);
return A
},initComponent:CQ.Ext.emptyFn,render:function(B,A){if(!this.rendered&&this.fireEvent("beforerender",this)!==false){if(!B&&this.el){this.el=CQ.Ext.get(this.el);
B=this.el.dom.parentNode;
this.allowDomMove=false
}if(CQ.Util.isRoot(B)){B=CQ.Util.getRoot()
}this.container=CQ.Ext.get(B);
if(this.ctCls){this.container.addClass(this.ctCls)
}this.rendered=true;
if(A!==undefined){if(CQ.Ext.isNumber(A)){A=this.container.dom.childNodes[A]
}else{A=CQ.Ext.getDom(A)
}}this.onRender(this.container,A||null);
if(this.autoShow){this.el.removeClass(["x-hidden","x-hide-"+this.hideMode])
}if(this.cls){this.el.addClass(this.cls);
delete this.cls
}if(this.style){this.el.applyStyles(this.style);
delete this.style
}if(this.overCls){this.el.addClassOnOver(this.overCls)
}this.fireEvent("render",this);
var C=this.getContentTarget();
if(this.html){C.update(CQ.Ext.DomHelper.markup(this.html));
delete this.html
}if(this.contentEl){var D=CQ.Ext.getDom(this.contentEl);
CQ.Ext.fly(D).removeClass(["x-hidden","x-hide-display"]);
C.appendChild(D)
}if(this.tpl){if(!this.tpl.compile){this.tpl=new CQ.Ext.XTemplate(this.tpl)
}if(this.data){this.tpl[this.tplWriteMode](C,this.data);
delete this.data
}}this.afterRender(this.container);
if(this.hidden){this.doHide()
}if(this.disabled){this.disable(true)
}if(this.stateful!==false){this.initStateEvents()
}this.fireEvent("afterrender",this)
}return this
},update:function(B,D,A){var C=this.getContentTarget();
if(this.tpl&&typeof B!=="string"){this.tpl[this.tplWriteMode](C,B||{})
}else{var E=CQ.Ext.isObject(B)?CQ.Ext.DomHelper.markup(B):B;
C.update(E,D,A)
}},onAdded:function(A,B){this.ownerCt=A;
this.initRef();
this.fireEvent("added",this,A,B)
},onRemoved:function(){this.removeRef();
this.fireEvent("removed",this,this.ownerCt);
delete this.ownerCt
},initRef:function(){if(this.ref&&!this.refOwner){var D=this.ref.split("/"),C=D.length,B=0,A=this;
while(A&&B<C){A=A.ownerCt;
++B
}if(A){A[this.refName=D[--B]]=this;
this.refOwner=A
}}},removeRef:function(){if(this.refOwner&&this.refName){delete this.refOwner[this.refName];
delete this.refOwner
}},initState:function(){if(CQ.Ext.state.Manager){var B=this.getStateId();
if(B){var A=CQ.Ext.state.Manager.get(B);
if(A){if(this.fireEvent("beforestaterestore",this,A)!==false){this.applyState(CQ.Ext.apply({},A));
this.fireEvent("staterestore",this,A)
}}}}},getStateId:function(){return this.stateId||((/^(cq-comp-|cq-gen)/).test(String(this.id))?null:this.id)
},initStateEvents:function(){if(this.stateEvents){for(var A=0,B;
B=this.stateEvents[A];
A++){this.on(B,this.saveState,this,{delay:100})
}}},applyState:function(A){if(A){CQ.Ext.apply(this,A)
}},getState:function(){return null
},saveState:function(){if(CQ.Ext.state.Manager&&this.stateful!==false){var B=this.getStateId();
if(B){var A=this.getState();
if(this.fireEvent("beforestatesave",this,A)!==false){CQ.Ext.state.Manager.set(B,A);
this.fireEvent("statesave",this,A)
}}}},applyToMarkup:function(A){this.allowDomMove=false;
this.el=CQ.Ext.get(A);
this.render(this.el.dom.parentNode)
},addClass:function(A){if(this.el){this.el.addClass(A)
}else{this.cls=this.cls?this.cls+" "+A:A
}return this
},removeClass:function(A){if(this.el){this.el.removeClass(A)
}else{if(this.cls){this.cls=this.cls.split(" ").remove(A).join(" ")
}}return this
},onRender:function(B,A){if(!this.el&&this.autoEl){if(CQ.Ext.isString(this.autoEl)){this.el=document.createElement(this.autoEl)
}else{var C=document.createElement("div");
CQ.Ext.DomHelper.overwrite(C,this.autoEl);
this.el=C.firstChild
}if(!this.el.id){this.el.id=this.getId()
}}if(this.el){this.el=CQ.Ext.get(this.el);
if(this.allowDomMove!==false){B.dom.insertBefore(this.el.dom,A);
if(C){CQ.Ext.removeNode(C);
C=null
}}}},getAutoCreate:function(){var A=CQ.Ext.isObject(this.autoCreate)?this.autoCreate:CQ.Ext.apply({},this.defaultAutoCreate);
if(this.id&&!A.id){A.id=this.id
}return A
},afterRender:CQ.Ext.emptyFn,destroy:function(){if(!this.isDestroyed){if(this.fireEvent("beforedestroy",this)!==false){this.destroying=true;
this.beforeDestroy();
if(this.ownerCt&&this.ownerCt.remove){this.ownerCt.remove(this,false)
}if(this.rendered){this.el.remove();
if(this.actionMode=="container"||this.removeMode=="container"){this.container.remove()
}}this.onDestroy();
CQ.Ext.ComponentMgr.unregister(this);
this.fireEvent("destroy",this);
this.purgeListeners();
this.destroying=false;
this.isDestroyed=true
}}},deleteMembers:function(){var B=arguments;
for(var C=0,A=B.length;
C<A;
++C){delete this[B[C]]
}},beforeDestroy:CQ.Ext.emptyFn,onDestroy:CQ.Ext.emptyFn,getEl:function(){return this.el
},getContentTarget:function(){return this.el
},getId:function(){return this.id||(this.id="cq-comp-"+(++CQ.Ext.Component.AUTO_ID))
},getItemId:function(){return this.itemId||this.getId()
},focus:function(B,A){if(A){this.focus.defer(CQ.Ext.isNumber(A)?A:10,this,[B,false]);
return 
}if(this.rendered){this.el.focus();
if(B===true){this.el.dom.select()
}}return this
},blur:function(){if(this.rendered){this.el.blur()
}return this
},disable:function(A){if(this.rendered){this.onDisable()
}this.disabled=true;
if(A!==true){this.fireEvent("disable",this)
}return this
},onDisable:function(){this.getActionEl().addClass(this.disabledClass);
this.el.dom.disabled=true
},enable:function(){if(this.rendered){this.onEnable()
}this.disabled=false;
this.fireEvent("enable",this);
return this
},onEnable:function(){this.getActionEl().removeClass(this.disabledClass);
this.el.dom.disabled=false
},setDisabled:function(A){return this[A?"disable":"enable"]()
},show:function(){if(this.fireEvent("beforeshow",this)!==false){this.hidden=false;
if(this.autoRender){this.render(CQ.Ext.isBoolean(this.autoRender)?CQ.Util.getRoot():this.autoRender)
}if(this.rendered){this.onShow()
}this.fireEvent("show",this)
}return this
},onShow:function(){this.getVisibilityEl().removeClass("x-hide-"+this.hideMode)
},hide:function(){if(this.fireEvent("beforehide",this)!==false){this.doHide();
this.fireEvent("hide",this)
}return this
},doHide:function(){this.hidden=true;
if(this.rendered){this.onHide()
}},onHide:function(){this.getVisibilityEl().addClass("x-hide-"+this.hideMode)
},getVisibilityEl:function(){return this.hideParent?this.container:this.getActionEl()
},setVisible:function(A){return this[A?"show":"hide"]()
},isVisible:function(){return this.rendered&&this.getVisibilityEl().isVisible()
},cloneConfig:function(B){B=B||{};
var C=B.id||CQ.Ext.id();
var A=CQ.Ext.applyIf(B,this.initialConfig);
A.id=C;
return new this.constructor(A)
},getXType:function(){return this.constructor.xtype
},isXType:function(B,A){if(CQ.Ext.isFunction(B)){B=B.xtype
}else{if(CQ.Ext.isObject(B)){B=B.constructor.xtype
}}return !A?("/"+this.getXTypes()+"/").indexOf("/"+B+"/")!=-1:this.constructor.xtype==B
},getXTypes:function(){var A=this.constructor;
if(!A.xtypes){var C=[],B=this;
while(B&&B.constructor.xtype){C.unshift(B.constructor.xtype);
B=B.constructor.superclass
}A.xtypeChain=C;
A.xtypes=C.join("/")
}return A.xtypes
},findParentBy:function(A){for(var B=this.ownerCt;
(B!=null)&&!A(B,this);
B=B.ownerCt){}return B||null
},findParentByType:function(A){return CQ.Ext.isFunction(A)?this.findParentBy(function(B){return B.constructor===A
}):this.findParentBy(function(B){return B.constructor.xtype===A
})
},getPositionEl:function(){return this.positionEl||this.el
},purgeListeners:function(){CQ.Ext.Component.superclass.purgeListeners.call(this);
if(this.mons){this.on("beforedestroy",this.clearMons,this,{single:true})
}},clearMons:function(){CQ.Ext.each(this.mons,function(A){A.item.un(A.ename,A.fn,A.scope)
},this);
this.mons=[]
},createMons:function(){if(!this.mons){this.mons=[];
this.on("beforedestroy",this.clearMons,this,{single:true})
}},mon:function(E,B,D,C,A){this.createMons();
if(CQ.Ext.isObject(B)){var H=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;
var G=B;
for(var F in G){if(H.test(F)){continue
}if(CQ.Ext.isFunction(G[F])){this.mons.push({item:E,ename:F,fn:G[F],scope:G.scope});
E.on(F,G[F],G.scope,G)
}else{this.mons.push({item:E,ename:F,fn:G[F],scope:G.scope});
E.on(F,G[F])
}}return 
}this.mons.push({item:E,ename:B,fn:D,scope:C});
E.on(B,D,C,A)
},mun:function(G,C,F,E){var H,D;
this.createMons();
for(var B=0,A=this.mons.length;
B<A;
++B){D=this.mons[B];
if(G===D.item&&C==D.ename&&F===D.fn&&E===D.scope){this.mons.splice(B,1);
G.un(C,F,E);
H=true;
break
}}return H
},nextSibling:function(){if(this.ownerCt){var A=this.ownerCt.items.indexOf(this);
if(A!=-1&&A+1<this.ownerCt.items.getCount()){return this.ownerCt.items.itemAt(A+1)
}}return null
},previousSibling:function(){if(this.ownerCt){var A=this.ownerCt.items.indexOf(this);
if(A>0){return this.ownerCt.items.itemAt(A-1)
}}return null
},getBubbleTarget:function(){return this.ownerCt
}});
CQ.Ext.reg("component",CQ.Ext.Component);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Action=CQ.Ext.extend(Object,{constructor:function(A){this.initialConfig=A;
this.itemId=A.itemId=(A.itemId||A.id||CQ.Ext.id());
this.items=[]
},isAction:true,setText:function(A){this.initialConfig.text=A;
this.callEach("setText",[A])
},getText:function(){return this.initialConfig.text
},setIconClass:function(A){this.initialConfig.iconCls=A;
this.callEach("setIconClass",[A])
},getIconClass:function(){return this.initialConfig.iconCls
},setDisabled:function(A){this.initialConfig.disabled=A;
this.callEach("setDisabled",[A])
},enable:function(){this.setDisabled(false)
},disable:function(){this.setDisabled(true)
},isDisabled:function(){return this.initialConfig.disabled
},setHidden:function(A){this.initialConfig.hidden=A;
this.callEach("setVisible",[!A])
},show:function(){this.setHidden(false)
},hide:function(){this.setHidden(true)
},isHidden:function(){return this.initialConfig.hidden
},setHandler:function(B,A){this.initialConfig.handler=B;
this.initialConfig.scope=A;
this.callEach("setHandler",[B,A])
},each:function(B,A){CQ.Ext.each(this.items,B,A)
},callEach:function(E,B){var D=this.items;
for(var C=0,A=D.length;
C<A;
C++){D[C][E].apply(D[C],B)
}},addComponent:function(A){this.items.push(A);
A.on("destroy",this.removeComponent,this)
},removeComponent:function(A){this.items.remove(A)
},execute:function(){this.initialConfig.handler.apply(this.initialConfig.scope||window,arguments)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){CQ.Ext.Layer=function(D,C){D=D||{};
var E=CQ.Ext.DomHelper;
var G=D.parentEl,F=G?CQ.Ext.getDom(G):CQ.Util.getRoot();
if(C){this.dom=CQ.Ext.getDom(C)
}if(!this.dom){var H=D.dh||{tag:"div",cls:"x-layer"};
this.dom=E.append(F,H)
}if(D.cls){this.addClass(D.cls)
}this.constrain=D.constrain!==false;
this.setVisibilityMode(CQ.Ext.Element.VISIBILITY);
if(D.id){this.id=this.dom.id=D.id
}else{this.id=CQ.Ext.id(this.dom)
}this.zindex=D.zindex||this.getZIndex();
this.position("absolute",this.zindex);
if(D.shadow){this.shadowOffset=D.shadowOffset||4;
this.shadow=new CQ.Ext.Shadow({offset:this.shadowOffset,mode:D.shadow})
}else{this.shadowOffset=0
}this.useShim=D.shim!==false&&CQ.Ext.useShims;
this.useDisplay=D.useDisplay;
this.hide()
};
var A=CQ.Ext.Element.prototype;
var B=[];
CQ.Ext.extend(CQ.Ext.Layer,CQ.Ext.Element,{getZIndex:function(){return this.zindex||parseInt((this.getShim()||this).getStyle("z-index"),10)||11000
},getShim:function(){if(!this.useShim){return null
}if(this.shim){return this.shim
}var D=B.shift();
if(!D){D=this.createShim();
D.enableDisplayMode("block");
D.dom.style.display="none";
D.dom.style.visibility="visible"
}var C=this.dom.parentNode;
if(D.dom.parentNode!=C){C.insertBefore(D.dom,this.dom)
}D.setStyle("z-index",this.getZIndex()-2);
this.shim=D;
return D
},hideShim:function(){if(this.shim){this.shim.setDisplayed(false);
B.push(this.shim);
delete this.shim
}},disableShadow:function(){if(this.shadow){this.shadowDisabled=true;
this.shadow.hide();
this.lastShadowOffset=this.shadowOffset;
this.shadowOffset=0
}},enableShadow:function(C){if(this.shadow){this.shadowDisabled=false;
this.shadowOffset=this.lastShadowOffset;
delete this.lastShadowOffset;
if(C){this.sync(true)
}}},sync:function(C){var I=this.shadow;
if(!this.updating&&this.isVisible()&&(I||this.useShim)){var F=this.getShim();
var H=this.getWidth(),E=this.getHeight();
var D=this.getLeft(true),J=this.getTop(true);
if(I&&!this.shadowDisabled){if(C&&!I.isVisible()){I.show(this)
}else{I.realign(D,J,H,E)
}if(F){if(C){F.show()
}var G=I.adjusts,K=F.dom.style;
K.left=(Math.min(D,D+G.l))+"px";
K.top=(Math.min(J,J+G.t))+"px";
K.width=(H+G.w)+"px";
K.height=(E+G.h)+"px"
}}else{if(F){if(C){F.show()
}F.setSize(H,E);
F.setLeftTop(D,J)
}}}},destroy:function(){this.hideShim();
if(this.shadow){this.shadow.hide()
}this.removeAllListeners();
CQ.Ext.removeNode(this.dom);
delete this.dom
},remove:function(){this.destroy()
},beginUpdate:function(){this.updating=true
},endUpdate:function(){this.updating=false;
this.sync(true)
},hideUnders:function(C){if(this.shadow){this.shadow.hide()
}this.hideShim()
},constrainXY:function(){if(this.constrain){var H=CQ.Ext.lib.Dom.getViewWidth(),D=CQ.Ext.lib.Dom.getViewHeight();
var M=CQ.Ext.getDoc().getScroll();
var L=this.getXY();
var I=L[0],G=L[1];
var C=this.shadowOffset;
var J=this.dom.offsetWidth+C,E=this.dom.offsetHeight+C;
var F=false;
if((I+J)>H+M.left){I=H-J-C;
F=true
}if((G+E)>D+M.top){G=D-E-C;
F=true
}if(I<M.left){I=M.left;
F=true
}if(G<M.top){G=M.top;
F=true
}if(F){if(this.avoidY){var K=this.avoidY;
if(G<=K&&(G+E)>=K){G=K-E-5
}}L=[I,G];
this.storeXY(L);
A.setXY.call(this,L);
this.sync()
}}return this
},isVisible:function(){return this.visible
},showAction:function(){this.visible=true;
if(this.useDisplay===true){this.setDisplayed("")
}else{if(this.lastXY){A.setXY.call(this,this.lastXY)
}else{if(this.lastLT){A.setLeftTop.call(this,this.lastLT[0],this.lastLT[1])
}}}},hideAction:function(){this.visible=false;
if(this.useDisplay===true){this.setDisplayed(false)
}else{this.setLeftTop(-10000,-10000)
}},setVisible:function(E,D,G,H,F){if(E){this.showAction()
}if(D&&E){var C=function(){this.sync(true);
if(H){H()
}}.createDelegate(this);
A.setVisible.call(this,true,true,G,C,F)
}else{if(!E){this.hideUnders(true)
}var C=H;
if(D){C=function(){this.hideAction();
if(H){H()
}}.createDelegate(this)
}A.setVisible.call(this,E,D,G,C,F);
if(E){this.sync(true)
}else{if(!D){this.hideAction()
}}}return this
},storeXY:function(C){delete this.lastLT;
this.lastXY=C
},storeLeftTop:function(D,C){delete this.lastXY;
this.lastLT=[D,C]
},beforeFx:function(){this.beforeAction();
return CQ.Ext.Layer.superclass.beforeFx.apply(this,arguments)
},afterFx:function(){CQ.Ext.Layer.superclass.afterFx.apply(this,arguments);
this.sync(this.isVisible())
},beforeAction:function(){if(!this.updating&&this.shadow){this.shadow.hide()
}},setLeft:function(C){this.storeLeftTop(C,this.getTop(true));
A.setLeft.apply(this,arguments);
this.sync();
return this
},setTop:function(C){this.storeLeftTop(this.getLeft(true),C);
A.setTop.apply(this,arguments);
this.sync();
return this
},setLeftTop:function(D,C){this.storeLeftTop(D,C);
A.setLeftTop.apply(this,arguments);
this.sync();
return this
},setXY:function(F,D,G,H,E){this.fixDisplay();
this.beforeAction();
this.storeXY(F);
var C=this.createCB(H);
A.setXY.call(this,F,D,G,C,E);
if(!D){C()
}return this
},createCB:function(D){var C=this;
return function(){C.constrainXY();
C.sync(true);
if(D){D()
}}
},setX:function(C,D,F,G,E){this.setXY([C,this.getY()],D,F,G,E);
return this
},setY:function(G,C,E,F,D){this.setXY([this.getX(),G],C,E,F,D);
return this
},setSize:function(E,F,D,H,I,G){this.beforeAction();
var C=this.createCB(I);
A.setSize.call(this,E,F,D,H,C,G);
if(!D){C()
}return this
},setWidth:function(E,D,G,H,F){this.beforeAction();
var C=this.createCB(H);
A.setWidth.call(this,E,D,G,C,F);
if(!D){C()
}return this
},setHeight:function(E,D,G,H,F){this.beforeAction();
var C=this.createCB(H);
A.setHeight.call(this,E,D,G,C,F);
if(!D){C()
}return this
},setBounds:function(J,H,K,D,I,F,G,E){this.beforeAction();
var C=this.createCB(G);
if(!I){this.storeXY([J,H]);
A.setXY.call(this,[J,H]);
A.setSize.call(this,K,D,I,F,C,E);
C()
}else{A.setBounds.call(this,J,H,K,D,I,F,C,E)
}return this
},setZIndex:function(C){this.zindex=C;
this.setStyle("z-index",C+2);
if(this.shadow){this.shadow.setZIndex(C+1)
}if(this.shim){this.shim.setStyle("z-index",C)
}return this
}})
})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Shadow=function(C){CQ.Ext.apply(this,C);
if(typeof this.mode!="string"){this.mode=this.defaultMode
}var D=this.offset,B={h:0};
var A=Math.floor(this.offset/2);
switch(this.mode.toLowerCase()){case"drop":B.w=0;
B.l=B.t=D;
B.t-=1;
if(CQ.Ext.isIE){B.l-=this.offset+A;
B.t-=this.offset+A;
B.w-=A;
B.h-=A;
B.t+=1
}break;
case"sides":B.w=(D*2);
B.l=-D;
B.t=D-1;
if(CQ.Ext.isIE){B.l-=(this.offset-A);
B.t-=this.offset+A;
B.l+=1;
B.w-=(this.offset-A)*2;
B.w-=A+1;
B.h-=1
}break;
case"frame":B.w=B.h=(D*2);
B.l=B.t=-D;
B.t+=1;
B.h-=2;
if(CQ.Ext.isIE){B.l-=(this.offset-A);
B.t-=(this.offset-A);
B.l+=1;
B.w-=(this.offset+A+1);
B.h-=(this.offset+A);
B.h+=1
}break
}this.adjusts=B
};
CQ.Ext.Shadow.prototype={offset:4,defaultMode:"drop",show:function(A){A=CQ.Ext.get(A);
if(!this.el){this.el=CQ.Ext.Shadow.Pool.pull();
if(this.el.dom.nextSibling!=A.dom){this.el.insertBefore(A)
}}this.el.setStyle("z-index",this.zIndex||parseInt(A.getStyle("z-index"),10)-1);
if(CQ.Ext.isIE){this.el.dom.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius="+(this.offset)+")"
}this.realign(A.getLeft(true),A.getTop(true),A.getWidth(),A.getHeight());
this.el.dom.style.display="block"
},isVisible:function(){return this.el?true:false
},realign:function(A,M,L,D){if(!this.el){return 
}var I=this.adjusts,G=this.el.dom,N=G.style;
var E=0;
N.left=(A+I.l)+"px";
N.top=(M+I.t)+"px";
var K=(L+I.w),C=(D+I.h),F=K+"px",J=C+"px";
if(N.width!=F||N.height!=J){N.width=F;
N.height=J;
if(!CQ.Ext.isIE){var H=G.childNodes;
var B=Math.max(0,(K-12))+"px";
H[0].childNodes[1].style.width=B;
H[1].childNodes[1].style.width=B;
H[2].childNodes[1].style.width=B;
H[1].style.height=Math.max(0,(C-12))+"px"
}}},hide:function(){if(this.el){this.el.dom.style.display="none";
CQ.Ext.Shadow.Pool.push(this.el);
delete this.el
}},setZIndex:function(A){this.zIndex=A;
if(this.el){this.el.setStyle("z-index",A)
}}};
CQ.Ext.Shadow.Pool=function(){var B=[];
var A=CQ.Ext.isIE?'<div class="x-ie-shadow"></div>':'<div class="x-shadow"><div class="xst"><div class="xstl"></div><div class="xstc"></div><div class="xstr"></div></div><div class="xsc"><div class="xsml"></div><div class="xsmc"></div><div class="xsmr"></div></div><div class="xsb"><div class="xsbl"></div><div class="xsbc"></div><div class="xsbr"></div></div></div>';
return{pull:function(){var E=B.shift();
if(!E){var C=CQ.Ext.getDom(CQ.Util.getRoot());
var F;
for(var D=0;
D<C.childNodes.length;
D++){if(C.childNodes[D].tagName){F=C.childNodes[D];
break
}}E=CQ.Ext.get(CQ.Ext.DomHelper.insertHtml("beforeBegin",F,A));
E.autoBoxAdjust=false
}return E
},push:function(C){B.push(C)
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.BoxComponent=CQ.Ext.extend(CQ.Ext.Component,{initComponent:function(){CQ.Ext.BoxComponent.superclass.initComponent.call(this);
this.addEvents("resize","move")
},boxReady:false,deferHeight:false,setSize:function(B,D){if(typeof B=="object"){D=B.height,B=B.width
}if(CQ.Ext.isDefined(B)&&CQ.Ext.isDefined(this.boxMinWidth)&&(B<this.boxMinWidth)){B=this.boxMinWidth
}if(CQ.Ext.isDefined(D)&&CQ.Ext.isDefined(this.boxMinHeight)&&(D<this.boxMinHeight)){D=this.boxMinHeight
}if(CQ.Ext.isDefined(B)&&CQ.Ext.isDefined(this.boxMaxWidth)&&(B>this.boxMaxWidth)){B=this.boxMaxWidth
}if(CQ.Ext.isDefined(D)&&CQ.Ext.isDefined(this.boxMaxHeight)&&(D>this.boxMaxHeight)){D=this.boxMaxHeight
}if(!this.boxReady){this.width=B,this.height=D;
return this
}if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==B&&this.lastSize.height==D){return this
}this.lastSize={width:B,height:D};
var C=this.adjustSize(B,D),F=C.width,A=C.height,E;
if(F!==undefined||A!==undefined){E=this.getResizeEl();
if(!this.deferHeight&&F!==undefined&&A!==undefined){E.setSize(F,A)
}else{if(!this.deferHeight&&A!==undefined){E.setHeight(A)
}else{if(F!==undefined){E.setWidth(F)
}}}this.onResize(F,A,B,D);
this.fireEvent("resize",this,F,A,B,D)
}return this
},setWidth:function(A){return this.setSize(A)
},setHeight:function(A){return this.setSize(undefined,A)
},getSize:function(){return this.getResizeEl().getSize()
},getWidth:function(){return this.getResizeEl().getWidth()
},getHeight:function(){return this.getResizeEl().getHeight()
},getOuterSize:function(){var A=this.getResizeEl();
return{width:A.getWidth()+A.getMargins("lr"),height:A.getHeight()+A.getMargins("tb")}
},getPosition:function(A){var B=this.getPositionEl();
if(A===true){return[B.getLeft(true),B.getTop(true)]
}return this.xy||B.getXY()
},getBox:function(A){var C=this.getPosition(A);
var B=this.getSize();
B.x=C[0];
B.y=C[1];
return B
},updateBox:function(A){this.setSize(A.width,A.height);
this.setPagePosition(A.x,A.y);
return this
},getResizeEl:function(){return this.resizeEl||this.el
},setAutoScroll:function(A){if(this.rendered){this.getContentTarget().setOverflow(A?"auto":"")
}this.autoScroll=A;
return this
},setPosition:function(A,F){if(A&&typeof A[1]=="number"){F=A[1];
A=A[0]
}this.x=A;
this.y=F;
if(!this.boxReady){return this
}var B=this.adjustPosition(A,F);
var E=B.x,D=B.y;
var C=this.getPositionEl();
if(E!==undefined||D!==undefined){if(E!==undefined&&D!==undefined){C.setLeftTop(E,D)
}else{if(E!==undefined){C.setLeft(E)
}else{if(D!==undefined){C.setTop(D)
}}}this.onPosition(E,D);
this.fireEvent("move",this,E,D)
}return this
},setPagePosition:function(A,C){if(A&&typeof A[1]=="number"){C=A[1];
A=A[0]
}this.pageX=A;
this.pageY=C;
if(!this.boxReady){return 
}if(A===undefined||C===undefined){return 
}var B=this.getPositionEl().translatePoints(A,C);
this.setPosition(B.left,B.top);
return this
},afterRender:function(){CQ.Ext.BoxComponent.superclass.afterRender.call(this);
if(this.resizeEl){this.resizeEl=CQ.Ext.get(this.resizeEl)
}if(this.positionEl){this.positionEl=CQ.Ext.get(this.positionEl)
}this.boxReady=true;
CQ.Ext.isDefined(this.autoScroll)&&this.setAutoScroll(this.autoScroll);
this.setSize(this.width,this.height);
if(this.x||this.y){this.setPosition(this.x,this.y)
}else{if(this.pageX||this.pageY){this.setPagePosition(this.pageX,this.pageY)
}}},syncSize:function(){delete this.lastSize;
this.setSize(this.autoWidth?undefined:this.getResizeEl().getWidth(),this.autoHeight?undefined:this.getResizeEl().getHeight());
return this
},onResize:function(D,B,A,C){},onPosition:function(A,B){},adjustSize:function(A,B){if(this.autoWidth){A="auto"
}if(this.autoHeight){B="auto"
}return{width:A,height:B}
},adjustPosition:function(A,B){return{x:A,y:B}
}});
CQ.Ext.reg("box",CQ.Ext.BoxComponent);
CQ.Ext.Spacer=CQ.Ext.extend(CQ.Ext.BoxComponent,{autoEl:"div"});
CQ.Ext.reg("spacer",CQ.Ext.Spacer);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.SplitBar=function(C,E,B,D,A){this.el=CQ.Ext.get(C,true);
this.el.dom.unselectable="on";
this.resizingEl=CQ.Ext.get(E,true);
this.orientation=B||CQ.Ext.SplitBar.HORIZONTAL;
this.minSize=0;
this.maxSize=2000;
this.animate=false;
this.useShim=false;
this.shim=null;
if(!A){this.proxy=CQ.Ext.SplitBar.createProxy(this.orientation)
}else{this.proxy=CQ.Ext.get(A).dom
}this.dd=new CQ.Ext.dd.DDProxy(this.el.dom.id,"XSplitBars",{dragElId:this.proxy.id});
this.dd.b4StartDrag=this.onStartProxyDrag.createDelegate(this);
this.dd.endDrag=this.onEndProxyDrag.createDelegate(this);
this.dragSpecs={};
this.adapter=new CQ.Ext.SplitBar.BasicLayoutAdapter();
this.adapter.init(this);
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){this.placement=D||(this.el.getX()>this.resizingEl.getX()?CQ.Ext.SplitBar.LEFT:CQ.Ext.SplitBar.RIGHT);
this.el.addClass("x-splitbar-h")
}else{this.placement=D||(this.el.getY()>this.resizingEl.getY()?CQ.Ext.SplitBar.TOP:CQ.Ext.SplitBar.BOTTOM);
this.el.addClass("x-splitbar-v")
}this.addEvents("resize","moved","beforeresize","beforeapply");
CQ.Ext.SplitBar.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.SplitBar,CQ.Ext.util.Observable,{onStartProxyDrag:function(A,E){this.fireEvent("beforeresize",this);
this.overlay=CQ.Ext.DomHelper.append(document.body,{cls:"x-drag-overlay",html:"&#160;"},true);
this.overlay.unselectable();
this.overlay.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
CQ.Ext.get(this.proxy).setDisplayed("block");
var C=this.adapter.getElementSize(this);
this.activeMinSize=this.getMinimumSize();
this.activeMaxSize=this.getMaximumSize();
var D=C-this.activeMinSize;
var B=Math.max(this.activeMaxSize-C,0);
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){this.dd.resetConstraints();
this.dd.setXConstraint(this.placement==CQ.Ext.SplitBar.LEFT?D:B,this.placement==CQ.Ext.SplitBar.LEFT?B:D,this.tickSize);
this.dd.setYConstraint(0,0)
}else{this.dd.resetConstraints();
this.dd.setXConstraint(0,0);
this.dd.setYConstraint(this.placement==CQ.Ext.SplitBar.TOP?D:B,this.placement==CQ.Ext.SplitBar.TOP?B:D,this.tickSize)
}this.dragSpecs.startSize=C;
this.dragSpecs.startPoint=[A,E];
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this.dd,A,E)
},onEndProxyDrag:function(C){CQ.Ext.get(this.proxy).setDisplayed(false);
var B=CQ.Ext.lib.Event.getXY(C);
if(this.overlay){CQ.Ext.destroy(this.overlay);
delete this.overlay
}var A;
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){A=this.dragSpecs.startSize+(this.placement==CQ.Ext.SplitBar.LEFT?B[0]-this.dragSpecs.startPoint[0]:this.dragSpecs.startPoint[0]-B[0])
}else{A=this.dragSpecs.startSize+(this.placement==CQ.Ext.SplitBar.TOP?B[1]-this.dragSpecs.startPoint[1]:this.dragSpecs.startPoint[1]-B[1])
}A=Math.min(Math.max(A,this.activeMinSize),this.activeMaxSize);
if(A!=this.dragSpecs.startSize){if(this.fireEvent("beforeapply",this,A)!==false){this.adapter.setElementSize(this,A);
this.fireEvent("moved",this,A);
this.fireEvent("resize",this,A)
}}},getAdapter:function(){return this.adapter
},setAdapter:function(A){this.adapter=A;
this.adapter.init(this)
},getMinimumSize:function(){return this.minSize
},setMinimumSize:function(A){this.minSize=A
},getMaximumSize:function(){return this.maxSize
},setMaximumSize:function(A){this.maxSize=A
},setCurrentSize:function(B){var A=this.animate;
this.animate=false;
this.adapter.setElementSize(this,B);
this.animate=A
},destroy:function(A){CQ.Ext.destroy(this.shim,CQ.Ext.get(this.proxy));
this.dd.unreg();
if(A){this.el.remove()
}this.purgeListeners()
}});
CQ.Ext.SplitBar.createProxy=function(B){var C=new CQ.Ext.Element(document.createElement("div"));
CQ.Util.getRoot().appendChild(C.dom);
C.unselectable();
var A="x-splitbar-proxy";
C.addClass(A+" "+(B==CQ.Ext.SplitBar.HORIZONTAL?A+"-h":A+"-v"));
return C.dom
};
CQ.Ext.SplitBar.BasicLayoutAdapter=function(){};
CQ.Ext.SplitBar.BasicLayoutAdapter.prototype={init:function(A){},getElementSize:function(A){if(A.orientation==CQ.Ext.SplitBar.HORIZONTAL){return A.resizingEl.getWidth()
}else{return A.resizingEl.getHeight()
}},setElementSize:function(B,A,C){if(B.orientation==CQ.Ext.SplitBar.HORIZONTAL){if(!B.animate){B.resizingEl.setWidth(A);
if(C){C(B,A)
}}else{B.resizingEl.setWidth(A,true,0.1,C,"easeOut")
}}else{if(!B.animate){B.resizingEl.setHeight(A);
if(C){C(B,A)
}}else{B.resizingEl.setHeight(A,true,0.1,C,"easeOut")
}}}};
CQ.Ext.SplitBar.AbsoluteLayoutAdapter=function(A){this.basic=new CQ.Ext.SplitBar.BasicLayoutAdapter();
this.container=CQ.Ext.get(A)
};
CQ.Ext.SplitBar.AbsoluteLayoutAdapter.prototype={init:function(A){this.basic.init(A)
},getElementSize:function(A){return this.basic.getElementSize(A)
},setElementSize:function(B,A,C){this.basic.setElementSize(B,A,this.moveSplitter.createDelegate(this,[B]))
},moveSplitter:function(A){var B=CQ.Ext.SplitBar;
switch(A.placement){case B.LEFT:A.el.setX(A.resizingEl.getRight());
break;
case B.RIGHT:A.el.setStyle("right",(this.container.getWidth()-A.resizingEl.getLeft())+"px");
break;
case B.TOP:A.el.setY(A.resizingEl.getBottom());
break;
case B.BOTTOM:A.el.setY(A.resizingEl.getTop()-A.el.getHeight());
break
}}};
CQ.Ext.SplitBar.VERTICAL=1;
CQ.Ext.SplitBar.HORIZONTAL=2;
CQ.Ext.SplitBar.LEFT=1;
CQ.Ext.SplitBar.RIGHT=2;
CQ.Ext.SplitBar.TOP=3;
CQ.Ext.SplitBar.BOTTOM=4;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Container=CQ.Ext.extend(CQ.Ext.BoxComponent,{bufferResize:50,autoDestroy:true,forceLayout:false,defaultType:"panel",resizeEvent:"resize",bubbleEvents:["add","remove"],initComponent:function(){CQ.Ext.Container.superclass.initComponent.call(this);
this.addEvents("afterlayout","beforeadd","beforeremove","add","remove");
this.enableBubble(this.bubbleEvents);
var A=this.items;
if(A){delete this.items;
this.add(A)
}},initItems:function(){if(!this.items){this.items=new CQ.Ext.util.MixedCollection(false,this.getComponentId);
this.getLayout()
}},setLayout:function(A){if(this.layout&&this.layout!=A){this.layout.setContainer(null)
}this.initItems();
this.layout=A;
A.setContainer(this)
},afterRender:function(){CQ.Ext.Container.superclass.afterRender.call(this);
if(!this.layout){this.layout="auto"
}if(CQ.Ext.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;
this.layout=this.layoutConfig.type
}if(CQ.Ext.isString(this.layout)){this.layout=new CQ.Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)
}this.setLayout(this.layout);
if(this.activeItem!==undefined){var A=this.activeItem;
delete this.activeItem;
this.layout.setActiveItem(A)
}if(!this.ownerCt){this.doLayout(false,true)
}if(this.monitorResize===true){CQ.Ext.EventManager.onWindowResize(this.doLayout,this,[false])
}},getLayoutTarget:function(){return this.el
},getComponentId:function(A){return A.getItemId()
},add:function(B){this.initItems();
var D=arguments.length>1;
if(D||CQ.Ext.isArray(B)){var A=[];
CQ.Ext.each(D?arguments:B,function(F){A.push(this.add(F))
},this);
return A
}var E=this.lookupComponent(this.applyDefaults(B));
var C=this.items.length;
if(this.fireEvent("beforeadd",this,E,C)!==false&&this.onBeforeAdd(E)!==false){this.items.add(E);
E.onAdded(this,C);
this.onAdd(E);
this.fireEvent("add",this,E,C)
}return E
},onAdd:function(A){},onAdded:function(A,B){this.ownerCt=A;
this.initRef();
this.cascade(function(C){C.initRef()
});
this.fireEvent("added",this,A,B)
},insert:function(E,D){this.initItems();
var C=arguments,B=C.length;
if(B>2){var A=[];
for(var F=B-1;
F>=1;
--F){A.push(this.insert(E,C[F]))
}return A
}var G=this.lookupComponent(this.applyDefaults(D));
E=Math.min(E,this.items.length);
if(this.fireEvent("beforeadd",this,G,E)!==false&&this.onBeforeAdd(G)!==false){if(G.ownerCt==this){this.items.remove(G)
}this.items.insert(E,G);
G.onAdded(this,E);
this.onAdd(G);
this.fireEvent("add",this,G,E)
}return G
},applyDefaults:function(B){var A=this.defaults;
if(A){if(CQ.Ext.isFunction(A)){A=A.call(this,B)
}if(CQ.Ext.isString(B)){B=CQ.Ext.ComponentMgr.get(B);
CQ.Ext.apply(B,A)
}else{if(!B.events){CQ.Ext.applyIf(B,A)
}else{CQ.Ext.apply(B,A)
}}}return B
},onBeforeAdd:function(A){if(A.ownerCt){A.ownerCt.remove(A,false)
}if(this.hideBorders===true){A.border=(A.border===true)
}},remove:function(A,B){this.initItems();
var C=this.getComponent(A);
if(C&&this.fireEvent("beforeremove",this,C)!==false){this.doRemove(C,B);
this.fireEvent("remove",this,C)
}return C
},onRemove:function(A){},doRemove:function(D,C){var B=this.layout,A=B&&this.rendered;
if(A){B.onRemove(D)
}this.items.remove(D);
D.onRemoved();
this.onRemove(D);
if(C===true||(C!==false&&this.autoDestroy)){D.destroy()
}if(A){B.afterRemove(D)
}},removeAll:function(C){this.initItems();
var E,F=[],B=[];
this.items.each(function(G){F.push(G)
});
for(var D=0,A=F.length;
D<A;
++D){E=F[D];
this.remove(E,C);
if(E.ownerCt!==this){B.push(E)
}}return B
},getComponent:function(A){if(CQ.Ext.isObject(A)){A=A.getItemId()
}return this.items.get(A)
},lookupComponent:function(A){if(CQ.Ext.isString(A)){return CQ.Ext.ComponentMgr.get(A)
}else{if(!A.events){return this.createComponent(A)
}}return A
},createComponent:function(A,C){var B=A.render?A:CQ.Ext.create(CQ.Ext.apply({ownerCt:this},A),C||this.defaultType);
delete B.ownerCt;
return B
},canLayout:function(){var A=this.getVisibilityEl();
return A&&A.dom&&!A.isStyle("display","none")
},doLayout:function(E,D){var H=this.rendered,G=D||this.forceLayout;
if(this.collapsed||!this.canLayout()){this.deferLayout=this.deferLayout||!E;
if(!G){return 
}E=E&&!this.deferLayout
}else{delete this.deferLayout
}if(H&&this.layout){this.layout.layout()
}if(E!==true&&this.items){var C=this.items.items;
for(var B=0,A=C.length;
B<A;
B++){var F=C[B];
if(F.doLayout){F.doLayout(false,G)
}}}if(H){this.onLayout(E,G)
}this.hasLayout=true;
delete this.forceLayout
},onLayout:CQ.Ext.emptyFn,shouldBufferLayout:function(){var A=this.hasLayout;
if(this.ownerCt){return A?!this.hasLayoutPending():false
}return A
},hasLayoutPending:function(){var A=false;
this.ownerCt.bubble(function(B){if(B.layoutPending){A=true;
return false
}});
return A
},onShow:function(){CQ.Ext.Container.superclass.onShow.call(this);
if(CQ.Ext.isDefined(this.deferLayout)){delete this.deferLayout;
this.doLayout(true)
}},getLayout:function(){if(!this.layout){var A=new CQ.Ext.layout.ContainerLayout(this.layoutConfig);
this.setLayout(A)
}return this.layout
},beforeDestroy:function(){var A;
if(this.items){while(A=this.items.first()){this.doRemove(A,true)
}}if(this.monitorResize){CQ.Ext.EventManager.removeResizeListener(this.doLayout,this)
}CQ.Ext.destroy(this.layout);
CQ.Ext.Container.superclass.beforeDestroy.call(this)
},bubble:function(C,B,A){var D=this;
while(D){if(C.apply(B||D,A||[D])===false){break
}D=D.ownerCt
}return this
},cascade:function(F,E,B){if(F.apply(E||this,B||[this])!==false){if(this.items){var D=this.items.items;
for(var C=0,A=D.length;
C<A;
C++){if(D[C].cascade){D[C].cascade(F,E,B)
}else{F.apply(E||D[C],B||[D[C]])
}}}}return this
},findById:function(C){var A,B=this;
this.cascade(function(D){if(B!=D&&D.id===C){A=D;
return false
}});
return A||null
},findByType:function(B,A){return this.findBy(function(C){return C.isXType(B,A)
})
},find:function(B,A){return this.findBy(function(C){return C[B]===A
})
},findBy:function(D,C){var A=[],B=this;
this.cascade(function(E){if(B!=E&&D.call(C||E,E,B)===true){A.push(E)
}});
return A
},get:function(A){return this.items.get(A)
}});
CQ.Ext.Container.LAYOUTS={};
CQ.Ext.reg("container",CQ.Ext.Container);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.ContainerLayout=CQ.Ext.extend(Object,{monitorResize:false,activeItem:null,constructor:function(A){this.id=CQ.Ext.id(null,"ext-layout-");
CQ.Ext.apply(this,A)
},type:"container",IEMeasureHack:function(F,C){var A=F.dom.childNodes,B=A.length,I,H=[],G,D,E;
for(D=0;
D<B;
D++){I=A[D];
G=CQ.Ext.get(I);
if(G){H[D]=G.getStyle("display");
G.setStyle({display:"none"})
}}E=F?F.getViewSize(C):{};
for(D=0;
D<B;
D++){I=A[D];
G=CQ.Ext.get(I);
if(G){G.setStyle({display:H[D]})
}}return E
},getLayoutTargetSize:CQ.Ext.EmptyFn,layout:function(){var A=this.container,B=A.getLayoutTarget();
if(!(this.hasLayout||CQ.Ext.isEmpty(this.targetCls))){B.addClass(this.targetCls)
}this.onLayout(A,B);
A.fireEvent("afterlayout",A,this)
},onLayout:function(A,B){this.renderAll(A,B)
},isValidParent:function(B,A){return A&&B.getPositionEl().dom.parentNode==(A.dom||A)
},renderAll:function(D,E){var B=D.items.items,C,F,A=B.length;
for(C=0;
C<A;
C++){F=B[C];
if(F&&(!F.rendered||!this.isValidParent(F,E))){this.renderItem(F,C,E)
}}},renderItem:function(C,A,B){if(C){if(!C.rendered){C.render(B,A);
this.configureItem(C,A)
}else{if(!this.isValidParent(C,B)){if(CQ.Ext.isNumber(A)){A=B.dom.childNodes[A]
}B.dom.insertBefore(C.getPositionEl().dom,A||null);
C.container=B;
this.configureItem(C,A)
}}}},getRenderedItems:function(E){var D=E.getLayoutTarget(),F=E.items.items,A=F.length,C,G,B=[];
for(C=0;
C<A;
C++){if((G=F[C]).rendered&&this.isValidParent(G,D)){B.push(G)
}}return B
},configureItem:function(C,A){if(this.extraCls){var B=C.getPositionEl?C.getPositionEl():C;
B.addClass(this.extraCls)
}if(C.doLayout&&this.forceLayout){C.doLayout()
}if(this.renderHidden&&C!=this.activeItem){C.hide()
}},onRemove:function(B){if(this.activeItem==B){delete this.activeItem
}if(B.rendered&&this.extraCls){var A=B.getPositionEl?B.getPositionEl():B;
A.removeClass(this.extraCls)
}},afterRemove:function(A){if(A.removeRestore){A.removeMode="container";
delete A.removeRestore
}},onResize:function(){var B=this.container,A;
if(B.collapsed){return 
}if(A=B.bufferResize){if(B.shouldBufferLayout()){if(!this.resizeTask){this.resizeTask=new CQ.Ext.util.DelayedTask(this.runLayout,this);
this.resizeBuffer=CQ.Ext.isNumber(A)?A:50
}B.layoutPending=true;
this.resizeTask.delay(this.resizeBuffer)
}}else{this.runLayout()
}},runLayout:function(){var A=this.container;
A.doLayout();
delete A.layoutPending
},setContainer:function(B){if(!CQ.Ext.LayoutManager){CQ.Ext.LayoutManager={}
}if(this.monitorResize&&B!=this.container){var A=this.container;
if(A){A.un(A.resizeEvent,this.onResize,this)
}if(B){B.on(B.resizeEvent,this.onResize,this)
}}this.container=B
},parseMargins:function(B){if(CQ.Ext.isNumber(B)){B=B.toString()
}var C=B.split(" ");
var A=C.length;
if(A==1){C[1]=C[2]=C[3]=C[0]
}else{if(A==2){C[2]=C[0];
C[3]=C[1]
}else{if(A==3){C[3]=C[1]
}}}return{top:parseInt(C[0],10)||0,right:parseInt(C[1],10)||0,bottom:parseInt(C[2],10)||0,left:parseInt(C[3],10)||0}
},fieldTpl:(function(){var A=new CQ.Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>',"</div>");
A.disableFormats=true;
return A.compile()
})(),destroy:function(){if(!CQ.Ext.isEmpty(this.targetCls)){var A=this.container.getLayoutTarget();
if(A){A.removeClass(this.targetCls)
}}}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.AutoLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{runLayout:function(){var A=this.container;
A.doLayout();
delete A.layoutPending
}});
CQ.Ext.Container.LAYOUTS.auto=CQ.Ext.layout.AutoLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.FitLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"fit",getLayoutTargetSize:function(){var A=this.container.getLayoutTarget();
if(!A){return{}
}return A.getStyleSize()
},onLayout:function(A,B){CQ.Ext.layout.FitLayout.superclass.onLayout.call(this,A,B);
if(!A.collapsed){this.setItemSize(this.activeItem||A.items.itemAt(0),this.getLayoutTargetSize())
}},setItemSize:function(B,A){if(B&&A.height>0){B.setSize(A)
}}});
CQ.Ext.Container.LAYOUTS.fit=CQ.Ext.layout.FitLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.CardLayout=CQ.Ext.extend(CQ.Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,type:"card",constructor:function(A){CQ.Ext.layout.CardLayout.superclass.constructor.call(this,A)
},setActiveItem:function(C){var A=this.activeItem,B=this.container;
C=B.getComponent(C);
if(C&&A!=C){if(A){A.hide();
if(A.hidden!==true){return false
}A.fireEvent("deactivate",A)
}this.activeItem=C;
delete C.deferLayout;
C.show();
this.layout();
if(C.doLayout){C.doLayout()
}C.fireEvent("activate",C)
}},renderAll:function(A,B){if(this.deferredRender){this.renderItem(this.activeItem,undefined,B)
}else{CQ.Ext.layout.CardLayout.superclass.renderAll.call(this,A,B)
}}});
CQ.Ext.Container.LAYOUTS.card=CQ.Ext.layout.CardLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.AnchorLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"anchor",getLayoutTargetSize:function(){var A=this.container.getLayoutTarget();
if(!A){return{}
}return A.getStyleSize()
},onLayout:function(G,J){CQ.Ext.layout.AnchorLayout.superclass.onLayout.call(this,G,J);
var P=this.getLayoutTargetSize();
var N=P.width,F=P.height;
if(N<20&&F<20){return 
}var B,L;
if(G.anchorSize){if(typeof G.anchorSize=="number"){B=G.anchorSize
}else{B=G.anchorSize.width;
L=G.anchorSize.height
}}else{B=G.initialConfig.width;
L=G.initialConfig.height
}var I=this.getRenderedItems(G),H=I.length,E,K,M,D,A,C,O;
for(E=0;
E<H;
E++){K=I[E];
C=K.getPositionEl();
if(K.anchor){M=K.anchorSpec;
if(!M){O=K.anchor.split(" ");
K.anchorSpec=M={right:this.parseAnchor(O[0],K.initialConfig.width,B),bottom:this.parseAnchor(O[1],K.initialConfig.height,L)}
}D=M.right?this.adjustWidthAnchor(M.right(N)-C.getMargins("lr"),K):undefined;
A=M.bottom?this.adjustHeightAnchor(M.bottom(F)-C.getMargins("tb"),K):undefined;
if(D||A){K.setSize(D||undefined,A||undefined)
}}}},parseAnchor:function(B,F,A){if(B&&B!="none"){var D;
if(/^(r|right|b|bottom)$/i.test(B)){var E=A-F;
return function(G){if(G!==D){D=G;
return G-E
}}
}else{if(B.indexOf("%")!=-1){var C=parseFloat(B.replace("%",""))*0.01;
return function(G){if(G!==D){D=G;
return Math.floor(G*C)
}}
}else{B=parseInt(B,10);
if(!isNaN(B)){return function(G){if(G!==D){D=G;
return G+B
}}
}}}}return false
},adjustWidthAnchor:function(B,A){return B
},adjustHeightAnchor:function(B,A){return B
}});
CQ.Ext.Container.LAYOUTS.anchor=CQ.Ext.layout.AnchorLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.ColumnLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"column",extraCls:"x-column",scrollOffset:0,targetCls:"x-column-layout-ct",isValidParent:function(B,A){return this.innerCt&&B.getPositionEl().dom.parentNode==this.innerCt.dom
},getLayoutTargetSize:function(){var B=this.container.getLayoutTarget(),A;
if(B){A=B.getViewSize();
A.width-=B.getPadding("lr");
A.height-=B.getPadding("tb")
}return A
},renderAll:function(A,B){if(!this.innerCt){this.innerCt=B.createChild({cls:"x-column-inner"});
this.innerCt.createChild({cls:"x-clear"})
}CQ.Ext.layout.ColumnLayout.superclass.renderAll.call(this,A,this.innerCt)
},onLayout:function(C,F){var D=C.items.items,E=D.length,H,A;
this.renderAll(C,F);
var K=this.getLayoutTargetSize();
if(K.width<1&&K.height<1){return 
}var I=K.width-this.scrollOffset,B=K.height,J=I;
this.innerCt.setWidth(I);
for(A=0;
A<E;
A++){H=D[A];
if(!H.columnWidth){J-=(H.getWidth()+H.getPositionEl().getMargins("lr"))
}}J=J<0?0:J;
for(A=0;
A<E;
A++){H=D[A];
if(H.columnWidth){H.setSize(Math.floor(H.columnWidth*J)-H.getPositionEl().getMargins("lr"))
}}if(CQ.Ext.isIE){if(A=F.getStyle("overflow")&&A!="hidden"&&!this.adjustmentPass){var G=this.getLayoutTargetSize();
if(G.width!=K.width){this.adjustmentPass=true;
this.onLayout(C,F)
}}}delete this.adjustmentPass
}});
CQ.Ext.Container.LAYOUTS.column=CQ.Ext.layout.ColumnLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.BorderLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,rendered:false,type:"border",targetCls:"x-border-layout-ct",getLayoutTargetSize:function(){var A=this.container.getLayoutTarget();
return A?A.getViewSize():{}
},onLayout:function(C,Y){var D,R,V,G,N=C.items.items,S=N.length;
if(!this.rendered){D=[];
for(R=0;
R<S;
R++){V=N[R];
G=V.region;
if(V.collapsed){D.push(V)
}V.collapsed=false;
if(!V.rendered){V.render(Y,R);
V.getPositionEl().addClass("x-border-panel")
}this[G]=G!="center"&&V.split?new CQ.Ext.layout.BorderLayout.SplitRegion(this,V.initialConfig,G):new CQ.Ext.layout.BorderLayout.Region(this,V.initialConfig,G);
this[G].render(Y,V)
}this.rendered=true
}var M=this.getLayoutTargetSize();
if(M.width<20||M.height<20){if(D){this.restoreCollapsed=D
}return 
}else{if(this.restoreCollapsed){D=this.restoreCollapsed;
delete this.restoreCollapsed
}}var K=M.width,T=M.height,J=K,Q=T,H=0,I=0,O=this.north,L=this.south,F=this.west,U=this.east,V=this.center,X,P,B,W;
if(!V&&CQ.Ext.layout.BorderLayout.WARN!==false){throw"No center region defined in BorderLayout "+C.id
}if(O&&O.isVisible()){X=O.getSize();
P=O.getMargins();
X.width=K-(P.left+P.right);
X.x=P.left;
X.y=P.top;
H=X.height+X.y+P.bottom;
Q-=H;
O.applyLayout(X)
}if(L&&L.isVisible()){X=L.getSize();
P=L.getMargins();
X.width=K-(P.left+P.right);
X.x=P.left;
W=(X.height+P.top+P.bottom);
X.y=T-W+P.top;
Q-=W;
L.applyLayout(X)
}if(F&&F.isVisible()){X=F.getSize();
P=F.getMargins();
X.height=Q-(P.top+P.bottom);
X.x=P.left;
X.y=H+P.top;
B=(X.width+P.left+P.right);
I+=B;
J-=B;
F.applyLayout(X)
}if(U&&U.isVisible()){X=U.getSize();
P=U.getMargins();
X.height=Q-(P.top+P.bottom);
B=(X.width+P.left+P.right);
X.x=K-B+P.left;
X.y=H+P.top;
J-=B;
U.applyLayout(X)
}if(V){P=V.getMargins();
var E={x:I+P.left,y:H+P.top,width:J-(P.left+P.right),height:Q-(P.top+P.bottom)};
V.applyLayout(E)
}if(D){for(R=0,S=D.length;
R<S;
R++){D[R].collapse(false)
}}if(CQ.Ext.isIE&&CQ.Ext.isStrict){Y.repaint()
}if(R=Y.getStyle("overflow")&&R!="hidden"&&!this.adjustmentPass){var A=this.getLayoutTargetSize();
if(A.width!=M.width||A.height!=M.height){this.adjustmentPass=true;
this.onLayout(C,Y)
}}delete this.adjustmentPass
},destroy:function(){var B=["north","south","east","west"],A,C;
for(A=0;
A<B.length;
A++){C=this[B[A]];
if(C){if(C.destroy){C.destroy()
}else{if(C.split){C.split.destroy(true)
}}}}CQ.Ext.layout.BorderLayout.superclass.destroy.call(this)
}});
CQ.Ext.layout.BorderLayout.Region=function(B,A,C){CQ.Ext.apply(this,A);
this.layout=B;
this.position=C;
this.state={};
if(typeof this.margins=="string"){this.margins=this.layout.parseMargins(this.margins)
}this.margins=CQ.Ext.applyIf(this.margins||{},this.defaultMargins);
if(this.collapsible){if(typeof this.cmargins=="string"){this.cmargins=this.layout.parseMargins(this.cmargins)
}if(this.collapseMode=="mini"&&!this.cmargins){this.cmargins={left:0,top:0,right:0,bottom:0}
}else{this.cmargins=CQ.Ext.applyIf(this.cmargins||{},C=="north"||C=="south"?this.defaultNSCMargins:this.defaultEWCMargins)
}}};
CQ.Ext.layout.BorderLayout.Region.prototype={collapsible:false,split:false,floatable:true,minWidth:50,minHeight:50,defaultMargins:{left:0,top:0,right:0,bottom:0},defaultNSCMargins:{left:5,top:5,right:5,bottom:5},defaultEWCMargins:{left:5,top:0,right:5,bottom:0},floatingZIndex:100,isCollapsed:false,render:function(B,C){this.panel=C;
C.el.enableDisplayMode();
this.targetEl=B;
this.el=C.el;
var A=C.getState,D=this.position;
C.getState=function(){return CQ.Ext.apply(A.call(C)||{},this.state)
}.createDelegate(this);
if(D!="center"){C.allowQueuedExpand=false;
C.on({beforecollapse:this.beforeCollapse,collapse:this.onCollapse,beforeexpand:this.beforeExpand,expand:this.onExpand,hide:this.onHide,show:this.onShow,scope:this});
if(this.collapsible||this.floatable){C.collapseEl="el";
C.slideAnchor=this.getSlideAnchor()
}if(C.tools&&C.tools.toggle){C.tools.toggle.addClass("x-tool-collapse-"+D);
C.tools.toggle.addClassOnOver("x-tool-collapse-"+D+"-over")
}}},getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var B=new CQ.Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
B.disableFormats=true;
B.compile();
CQ.Ext.layout.BorderLayout.Region.prototype.toolTemplate=B
}this.collapsedEl=this.targetEl.createChild({cls:"x-layout-collapsed x-layout-collapsed-"+this.position,id:this.panel.id+"-xcollapsed"});
this.collapsedEl.enableDisplayMode("block");
if(this.collapseMode=="mini"){this.collapsedEl.addClass("x-layout-cmini-"+this.position);
this.miniCollapsedEl=this.collapsedEl.createChild({cls:"x-layout-mini x-layout-mini-"+this.position,html:"&#160;"});
this.miniCollapsedEl.addClassOnOver("x-layout-mini-over");
this.collapsedEl.addClassOnOver("x-layout-collapsed-over");
this.collapsedEl.on("click",this.onExpandClick,this,{stopEvent:true})
}else{if(this.collapsible!==false&&!this.hideCollapseTool){var A=this.toolTemplate.append(this.collapsedEl.dom,{id:"expand-"+this.position},true);
A.addClassOnOver("x-tool-expand-"+this.position+"-over");
A.on("click",this.onExpandClick,this,{stopEvent:true})
}if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver("x-layout-collapsed-over");
this.collapsedEl.on("click",this[this.floatable?"collapseClick":"onExpandClick"],this)
}}}return this.collapsedEl
},onExpandClick:function(A){if(this.isSlid){this.panel.expand(false)
}else{this.panel.expand()
}},onCollapseClick:function(A){this.panel.collapse()
},beforeCollapse:function(C,A){this.lastAnim=A;
if(this.splitEl){this.splitEl.hide()
}this.getCollapsedEl().show();
var B=this.panel.getEl();
this.originalZIndex=B.getStyle("z-index");
B.setStyle("z-index",100);
this.isCollapsed=true;
this.layout.layout()
},onCollapse:function(A){this.panel.el.setStyle("z-index",1);
if(this.lastAnim===false||this.panel.animCollapse===false){this.getCollapsedEl().dom.style.visibility="visible"
}else{this.getCollapsedEl().slideIn(this.panel.slideAnchor,{duration:0.2})
}this.state.collapsed=true;
this.panel.saveState()
},beforeExpand:function(A){if(this.isSlid){this.afterSlideIn()
}var B=this.getCollapsedEl();
this.el.show();
if(this.position=="east"||this.position=="west"){this.panel.setSize(undefined,B.getHeight())
}else{this.panel.setSize(B.getWidth(),undefined)
}B.hide();
B.dom.style.visibility="hidden";
this.panel.el.setStyle("z-index",this.floatingZIndex)
},onExpand:function(){this.isCollapsed=false;
if(this.splitEl){this.splitEl.show()
}this.layout.layout();
this.panel.el.setStyle("z-index",this.originalZIndex);
this.state.collapsed=false;
this.panel.saveState()
},collapseClick:function(A){if(this.isSlid){A.stopPropagation();
this.slideIn()
}else{A.stopPropagation();
this.slideOut()
}},onHide:function(){if(this.isCollapsed){this.getCollapsedEl().hide()
}else{if(this.splitEl){this.splitEl.hide()
}}},onShow:function(){if(this.isCollapsed){this.getCollapsedEl().show()
}else{if(this.splitEl){this.splitEl.show()
}}},isVisible:function(){return !this.panel.hidden
},getMargins:function(){return this.isCollapsed&&this.cmargins?this.cmargins:this.margins
},getSize:function(){return this.isCollapsed?this.getCollapsedEl().getSize():this.panel.getSize()
},setPanel:function(A){this.panel=A
},getMinWidth:function(){return this.minWidth
},getMinHeight:function(){return this.minHeight
},applyLayoutCollapsed:function(A){var B=this.getCollapsedEl();
B.setLeftTop(A.x,A.y);
B.setSize(A.width,A.height)
},applyLayout:function(A){if(this.isCollapsed){this.applyLayoutCollapsed(A)
}else{this.panel.setPosition(A.x,A.y);
this.panel.setSize(A.width,A.height)
}},beforeSlide:function(){this.panel.beforeEffect()
},afterSlide:function(){this.panel.afterEffect()
},initAutoHide:function(){if(this.autoHide!==false){if(!this.autoHideHd){var A=new CQ.Ext.util.DelayedTask(this.slideIn,this);
this.autoHideHd={mouseout:function(B){if(!B.within(this.el,true)){A.delay(500)
}},mouseover:function(B){A.cancel()
},scope:this}
}this.el.on(this.autoHideHd);
this.collapsedEl.on(this.autoHideHd)
}},clearAutoHide:function(){if(this.autoHide!==false){this.el.un("mouseout",this.autoHideHd.mouseout);
this.el.un("mouseover",this.autoHideHd.mouseover);
this.collapsedEl.un("mouseout",this.autoHideHd.mouseout);
this.collapsedEl.un("mouseover",this.autoHideHd.mouseover)
}},clearMonitor:function(){CQ.Ext.getDoc().un("click",this.slideInIf,this)
},slideOut:function(){if(this.isSlid||this.el.hasActiveFx()){return 
}this.isSlid=true;
var B=this.panel.tools,C,A;
if(B&&B.toggle){B.toggle.hide()
}this.el.show();
A=this.panel.collapsed;
this.panel.collapsed=false;
if(this.position=="east"||this.position=="west"){C=this.panel.deferHeight;
this.panel.deferHeight=false;
this.panel.setSize(undefined,this.collapsedEl.getHeight());
this.panel.deferHeight=C
}else{this.panel.setSize(this.collapsedEl.getWidth(),undefined)
}this.panel.collapsed=A;
this.restoreLT=[this.el.dom.style.left,this.el.dom.style.top];
this.el.alignTo(this.collapsedEl,this.getCollapseAnchor());
this.el.setStyle("z-index",this.floatingZIndex+2);
this.panel.el.replaceClass("x-panel-collapsed","x-panel-floating");
if(this.animFloat!==false){this.beforeSlide();
this.el.slideIn(this.getSlideAnchor(),{callback:function(){this.afterSlide();
this.initAutoHide();
CQ.Ext.getDoc().on("click",this.slideInIf,this)
},scope:this,block:true})
}else{this.initAutoHide();
CQ.Ext.getDoc().on("click",this.slideInIf,this)
}},afterSlideIn:function(){this.clearAutoHide();
this.isSlid=false;
this.clearMonitor();
this.el.setStyle("z-index","");
this.panel.el.replaceClass("x-panel-floating","x-panel-collapsed");
this.el.dom.style.left=this.restoreLT[0];
this.el.dom.style.top=this.restoreLT[1];
var A=this.panel.tools;
if(A&&A.toggle){A.toggle.show()
}},slideIn:function(A){if(!this.isSlid||this.el.hasActiveFx()){CQ.Ext.callback(A);
return 
}this.isSlid=false;
if(this.animFloat!==false){this.beforeSlide();
this.el.slideOut(this.getSlideAnchor(),{callback:function(){this.el.hide();
this.afterSlide();
this.afterSlideIn();
CQ.Ext.callback(A)
},scope:this,block:true})
}else{this.el.hide();
this.afterSlideIn()
}},slideInIf:function(A){if(!A.within(this.el)){this.slideIn()
}},anchors:{west:"left",east:"right",north:"top",south:"bottom"},sanchors:{west:"l",east:"r",north:"t",south:"b"},canchors:{west:"tl-tr",east:"tr-tl",north:"tl-bl",south:"bl-tl"},getAnchor:function(){return this.anchors[this.position]
},getCollapseAnchor:function(){return this.canchors[this.position]
},getSlideAnchor:function(){return this.sanchors[this.position]
},getAlignAdj:function(){var A=this.cmargins;
switch(this.position){case"west":return[0,0];
break;
case"east":return[0,0];
break;
case"north":return[0,0];
break;
case"south":return[0,0];
break
}},getExpandAdj:function(){var B=this.collapsedEl,A=this.cmargins;
switch(this.position){case"west":return[-(A.right+B.getWidth()+A.left),0];
break;
case"east":return[A.right+B.getWidth()+A.left,0];
break;
case"north":return[0,-(A.top+A.bottom+B.getHeight())];
break;
case"south":return[0,A.top+A.bottom+B.getHeight()];
break
}},destroy:function(){CQ.Ext.destroy(this.miniCollapsedEl,this.collapsedEl)
}};
CQ.Ext.layout.BorderLayout.SplitRegion=function(B,A,C){CQ.Ext.layout.BorderLayout.SplitRegion.superclass.constructor.call(this,B,A,C);
this.applyLayout=this.applyFns[C]
};
CQ.Ext.extend(CQ.Ext.layout.BorderLayout.SplitRegion,CQ.Ext.layout.BorderLayout.Region,{splitTip:"Drag to resize.",collapsibleSplitTip:"Drag to resize. Double click to hide.",useSplitTips:false,splitSettings:{north:{orientation:CQ.Ext.SplitBar.VERTICAL,placement:CQ.Ext.SplitBar.TOP,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},south:{orientation:CQ.Ext.SplitBar.VERTICAL,placement:CQ.Ext.SplitBar.BOTTOM,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},east:{orientation:CQ.Ext.SplitBar.HORIZONTAL,placement:CQ.Ext.SplitBar.RIGHT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"},west:{orientation:CQ.Ext.SplitBar.HORIZONTAL,placement:CQ.Ext.SplitBar.LEFT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"}},applyFns:{west:function(C){if(this.isCollapsed){return this.applyLayoutCollapsed(C)
}var D=this.splitEl.dom,B=D.style;
this.panel.setPosition(C.x,C.y);
var A=D.offsetWidth;
B.left=(C.x+C.width-A)+"px";
B.top=(C.y)+"px";
B.height=Math.max(0,C.height)+"px";
this.panel.setSize(C.width-A,C.height)
},east:function(C){if(this.isCollapsed){return this.applyLayoutCollapsed(C)
}var D=this.splitEl.dom,B=D.style;
var A=D.offsetWidth;
this.panel.setPosition(C.x+A,C.y);
B.left=(C.x)+"px";
B.top=(C.y)+"px";
B.height=Math.max(0,C.height)+"px";
this.panel.setSize(C.width-A,C.height)
},north:function(C){if(this.isCollapsed){return this.applyLayoutCollapsed(C)
}var D=this.splitEl.dom,B=D.style;
var A=D.offsetHeight;
this.panel.setPosition(C.x,C.y);
B.left=(C.x)+"px";
B.top=(C.y+C.height-A)+"px";
B.width=Math.max(0,C.width)+"px";
this.panel.setSize(C.width,C.height-A)
},south:function(C){if(this.isCollapsed){return this.applyLayoutCollapsed(C)
}var D=this.splitEl.dom,B=D.style;
var A=D.offsetHeight;
this.panel.setPosition(C.x,C.y+A);
B.left=(C.x)+"px";
B.top=(C.y)+"px";
B.width=Math.max(0,C.width)+"px";
this.panel.setSize(C.width,C.height-A)
}},render:function(A,C){CQ.Ext.layout.BorderLayout.SplitRegion.superclass.render.call(this,A,C);
var D=this.position;
this.splitEl=A.createChild({cls:"x-layout-split x-layout-split-"+D,html:"&#160;",id:this.panel.id+"-xsplit"});
if(this.collapseMode=="mini"){this.miniSplitEl=this.splitEl.createChild({cls:"x-layout-mini x-layout-mini-"+D,html:"&#160;"});
this.miniSplitEl.addClassOnOver("x-layout-mini-over");
this.miniSplitEl.on("click",this.onCollapseClick,this,{stopEvent:true})
}var B=this.splitSettings[D];
this.split=new CQ.Ext.SplitBar(this.splitEl.dom,C.el,B.orientation);
this.split.tickSize=this.tickSize;
this.split.placement=B.placement;
this.split.getMaximumSize=this[B.maxFn].createDelegate(this);
this.split.minSize=this.minSize||this[B.minProp];
this.split.on("beforeapply",this.onSplitMove,this);
this.split.useShim=this.useShim===true;
this.maxSize=this.maxSize||this[B.maxProp];
if(C.hidden){this.splitEl.hide()
}if(this.useSplitTips){this.splitEl.dom.title=this.collapsible?this.collapsibleSplitTip:this.splitTip
}if(this.collapsible){this.splitEl.on("dblclick",this.onCollapseClick,this)
}},getSize:function(){if(this.isCollapsed){return this.collapsedEl.getSize()
}var A=this.panel.getSize();
if(this.position=="north"||this.position=="south"){A.height+=this.splitEl.dom.offsetHeight
}else{A.width+=this.splitEl.dom.offsetWidth
}return A
},getHMaxSize:function(){var B=this.maxSize||10000;
var A=this.layout.center;
return Math.min(B,(this.el.getWidth()+A.el.getWidth())-A.getMinWidth())
},getVMaxSize:function(){var B=this.maxSize||10000;
var A=this.layout.center;
return Math.min(B,(this.el.getHeight()+A.el.getHeight())-A.getMinHeight())
},onSplitMove:function(B,A){var C=this.panel.getSize();
this.lastSplitSize=A;
if(this.position=="north"||this.position=="south"){this.panel.setSize(C.width,A);
this.state.height=A
}else{this.panel.setSize(A,C.height);
this.state.width=A
}this.layout.layout();
this.panel.saveState();
return false
},getSplitBar:function(){return this.split
},destroy:function(){CQ.Ext.destroy(this.miniSplitEl,this.split,this.splitEl);
CQ.Ext.layout.BorderLayout.SplitRegion.superclass.destroy.call(this)
}});
CQ.Ext.Container.LAYOUTS.border=CQ.Ext.layout.BorderLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.FormLayout=CQ.Ext.extend(CQ.Ext.layout.AnchorLayout,{labelSeparator:":",trackLabels:false,type:"form",onRemove:function(C){CQ.Ext.layout.FormLayout.superclass.onRemove.call(this,C);
if(this.trackLabels){C.un("show",this.onFieldShow,this);
C.un("hide",this.onFieldHide,this)
}var B=C.getPositionEl(),A=C.getItemCt&&C.getItemCt();
if(C.rendered&&A){if(B&&B.dom){B.insertAfter(A)
}CQ.Ext.destroy(A);
CQ.Ext.destroyMembers(C,"label","itemCt");
if(C.customItemCt){CQ.Ext.destroyMembers(C,"getItemCt","customItemCt")
}}},setContainer:function(A){CQ.Ext.layout.FormLayout.superclass.setContainer.call(this,A);
if(A.labelAlign){A.addClass("x-form-label-"+A.labelAlign)
}if(A.hideLabels){CQ.Ext.apply(this,{labelStyle:"display:none",elementStyle:"padding-left:0;",labelAdjust:0})
}else{this.labelSeparator=A.labelSeparator||this.labelSeparator;
A.labelWidth=A.labelWidth||100;
if(CQ.Ext.isNumber(A.labelWidth)){var B=CQ.Ext.isNumber(A.labelPad)?A.labelPad:5;
CQ.Ext.apply(this,{labelAdjust:A.labelWidth+B,labelStyle:"width:"+A.labelWidth+"px;",elementStyle:"padding-left:"+(A.labelWidth+B)+"px"})
}if(A.labelAlign=="top"){CQ.Ext.apply(this,{labelStyle:"width:auto;",labelAdjust:0,elementStyle:"padding-left:0;"})
}}},isHide:function(A){return A.hideLabel||this.container.hideLabels
},onFieldShow:function(A){A.getItemCt().removeClass("x-hide-"+A.hideMode)
},onFieldHide:function(A){A.getItemCt().addClass("x-hide-"+A.hideMode)
},getLabelStyle:function(E){var B="",C=[this.labelStyle,E];
for(var D=0,A=C.length;
D<A;
++D){if(C[D]){B+=C[D];
if(B.substr(-1,1)!=";"){B+=";"
}}}return B
},renderItem:function(D,A,C){if(D&&(D.isFormField||D.fieldLabel)&&D.inputType!="hidden"){var B=this.getTemplateArgs(D);
if(CQ.Ext.isNumber(A)){A=C.dom.childNodes[A]||null
}if(A){D.itemCt=this.fieldTpl.insertBefore(A,B,true)
}else{D.itemCt=this.fieldTpl.append(C,B,true)
}if(!D.getItemCt){CQ.Ext.apply(D,{getItemCt:function(){return D.itemCt
},customItemCt:true})
}D.label=D.getItemCt().child("label.x-form-item-label");
if(!D.rendered){D.render("x-form-el-"+D.id)
}else{if(!this.isValidParent(D,C)){CQ.Ext.fly("x-form-el-"+D.id).appendChild(D.getPositionEl())
}}if(this.trackLabels){if(D.hidden){this.onFieldHide(D)
}D.on({scope:this,show:this.onFieldShow,hide:this.onFieldHide})
}this.configureItem(D)
}else{CQ.Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)
}},getTemplateArgs:function(B){var A=!B.fieldLabel||B.hideLabel;
return{id:B.id,label:B.fieldLabel,labelStyle:this.getLabelStyle(B.labelStyle),elementStyle:this.elementStyle||"",labelSeparator:A?"":(CQ.Ext.isDefined(B.labelSeparator)?B.labelSeparator:this.labelSeparator),itemCls:(B.itemCls||this.container.itemCls||"")+(B.hideLabel?" x-hide-label":""),clearCls:B.clearCls||"x-form-clear-left"}
},adjustWidthAnchor:function(A,C){if(C.label&&!this.isHide(C)&&(this.container.labelAlign!="top")){var B=CQ.Ext.isIE6||(CQ.Ext.isIE&&!CQ.Ext.isStrict);
return A-this.labelAdjust+(B?-3:0)
}return A
},adjustHeightAnchor:function(A,B){if(B.label&&!this.isHide(B)&&(this.container.labelAlign=="top")){return A-B.label.getHeight()
}return A
},isValidParent:function(B,A){return A&&this.container.getEl().contains(B.getPositionEl())
}});
CQ.Ext.Container.LAYOUTS.form=CQ.Ext.layout.FormLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.AccordionLayout=CQ.Ext.extend(CQ.Ext.layout.FitLayout,{fill:true,autoWidth:true,titleCollapse:true,hideCollapseTool:false,collapseFirst:false,animate:false,sequence:false,activeOnTop:false,type:"accordion",renderItem:function(A){if(this.animate===false){A.animCollapse=false
}A.collapsible=true;
if(this.autoWidth){A.autoWidth=true
}if(this.titleCollapse){A.titleCollapse=true
}if(this.hideCollapseTool){A.hideCollapseTool=true
}if(this.collapseFirst!==undefined){A.collapseFirst=this.collapseFirst
}if(!this.activeItem&&!A.collapsed){this.setActiveItem(A,true)
}else{if(this.activeItem&&this.activeItem!=A){A.collapsed=true
}}CQ.Ext.layout.AccordionLayout.superclass.renderItem.apply(this,arguments);
A.header.addClass("x-accordion-hd");
A.on("beforeexpand",this.beforeExpand,this)
},onRemove:function(A){CQ.Ext.layout.AccordionLayout.superclass.onRemove.call(this,A);
if(A.rendered){A.header.removeClass("x-accordion-hd")
}A.un("beforeexpand",this.beforeExpand,this)
},beforeExpand:function(C,B){var A=this.activeItem;
if(A){if(this.sequence){delete this.activeItem;
if(!A.collapsed){A.collapse({callback:function(){C.expand(B||true)
},scope:this});
return false
}}else{A.collapse(this.animate)
}}this.setActive(C);
if(this.activeOnTop){C.el.dom.parentNode.insertBefore(C.el.dom,C.el.dom.parentNode.firstChild)
}this.layout()
},setItemSize:function(F,E){if(this.fill&&F){var D=0,C,B=this.getRenderedItems(this.container),A=B.length,G;
for(C=0;
C<A;
C++){if((G=B[C])!=F){D+=G.header.getHeight()
}}E.height-=D;
F.setSize(E)
}},setActiveItem:function(A){this.setActive(A,true)
},setActive:function(C,B){var A=this.activeItem;
C=this.container.getComponent(C);
if(A!=C){if(C.rendered&&C.collapsed&&B){C.expand()
}else{if(A){A.fireEvent("deactivate",A)
}this.activeItem=C;
C.fireEvent("activate",C)
}}}});
CQ.Ext.Container.LAYOUTS.accordion=CQ.Ext.layout.AccordionLayout;
CQ.Ext.layout.Accordion=CQ.Ext.layout.AccordionLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.TableLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:false,type:"table",targetCls:"x-table-layout-ct",tableAttrs:null,setContainer:function(A){CQ.Ext.layout.TableLayout.superclass.setContainer.call(this,A);
this.currentRow=0;
this.currentColumn=0;
this.cells=[]
},onLayout:function(C,E){var D=C.items.items,A=D.length,F,B;
if(!this.table){E.addClass("x-table-layout-ct");
this.table=E.createChild(CQ.Ext.apply({tag:"table",cls:"x-table-layout",cellspacing:0,cn:{tag:"tbody"}},this.tableAttrs),null,true)
}this.renderAll(C,E)
},getRow:function(A){var B=this.table.tBodies[0].childNodes[A];
if(!B){B=document.createElement("tr");
this.table.tBodies[0].appendChild(B)
}return B
},getNextCell:function(H){var A=this.getNextNonSpan(this.currentColumn,this.currentRow);
var E=this.currentColumn=A[0],D=this.currentRow=A[1];
for(var G=D;
G<D+(H.rowspan||1);
G++){if(!this.cells[G]){this.cells[G]=[]
}for(var C=E;
C<E+(H.colspan||1);
C++){this.cells[G][C]=true
}}var F=document.createElement("td");
if(H.cellId){F.id=H.cellId
}var B="x-table-layout-cell";
if(H.cellCls){B+=" "+H.cellCls
}F.className=B;
if(H.colspan){F.colSpan=H.colspan
}if(H.rowspan){F.rowSpan=H.rowspan
}this.getRow(D).appendChild(F);
return F
},getNextNonSpan:function(A,C){var B=this.columns;
while((B&&A>=B)||(this.cells[C]&&this.cells[C][A])){if(B&&A>=B){C++;
A=0
}else{A++
}}return[A,C]
},renderItem:function(D,A,C){if(!this.table){this.table=C.createChild(CQ.Ext.apply({tag:"table",cls:"x-table-layout",cellspacing:0,cn:{tag:"tbody"}},this.tableAttrs),null,true)
}if(D&&!D.rendered){D.render(this.getNextCell(D));
this.configureItem(D,A)
}else{if(D&&!this.isValidParent(D,C)){var B=this.getNextCell(D);
B.insertBefore(D.getPositionEl().dom,null);
D.container=CQ.Ext.get(B);
this.configureItem(D,A)
}}},isValidParent:function(B,A){return B.getPositionEl().up("table",5).dom.parentNode===(A.dom||A)
}});
CQ.Ext.Container.LAYOUTS.table=CQ.Ext.layout.TableLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.AbsoluteLayout=CQ.Ext.extend(CQ.Ext.layout.AnchorLayout,{extraCls:"x-abs-layout-item",type:"anchor",onLayout:function(A,B){B.position();
this.paddingLeft=B.getPadding("l");
this.paddingTop=B.getPadding("t");
CQ.Ext.layout.AbsoluteLayout.superclass.onLayout.call(this,A,B)
},adjustWidthAnchor:function(B,A){return B?B-A.getPosition(true)[0]+this.paddingLeft:B
},adjustHeightAnchor:function(B,A){return B?B-A.getPosition(true)[1]+this.paddingTop:B
}});
CQ.Ext.Container.LAYOUTS.absolute=CQ.Ext.layout.AbsoluteLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.BoxLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{defaultMargins:{left:0,top:0,right:0,bottom:0},padding:"0",pack:"start",monitorResize:true,type:"box",scrollOffset:0,extraCls:"x-box-item",targetCls:"x-box-layout-ct",innerCls:"x-box-inner",constructor:function(A){CQ.Ext.layout.BoxLayout.superclass.constructor.call(this,A);
if(CQ.Ext.isString(this.defaultMargins)){this.defaultMargins=this.parseMargins(this.defaultMargins)
}},isValidParent:function(B,A){return this.innerCt&&B.getPositionEl().dom.parentNode==this.innerCt.dom
},renderAll:function(A,B){if(!this.innerCt){this.innerCt=B.createChild({cls:this.innerCls});
this.padding=this.parseMargins(this.padding)
}CQ.Ext.layout.BoxLayout.superclass.renderAll.call(this,A,this.innerCt)
},onLayout:function(A,B){this.renderAll(A,B)
},getLayoutTargetSize:function(){var B=this.container.getLayoutTarget(),A;
if(B){A=B.getViewSize();
A.width-=B.getPadding("lr");
A.height-=B.getPadding("tb")
}return A
},renderItem:function(A){if(CQ.Ext.isString(A.margins)){A.margins=this.parseMargins(A.margins)
}else{if(!A.margins){A.margins=this.defaultMargins
}}CQ.Ext.layout.BoxLayout.superclass.renderItem.apply(this,arguments)
}});
CQ.Ext.layout.VBoxLayout=CQ.Ext.extend(CQ.Ext.layout.BoxLayout,{align:"left",type:"vbox",onLayout:function(F,g){CQ.Ext.layout.VBoxLayout.superclass.onLayout.call(this,F,g);
var G=this.getRenderedItems(F),H=G.length,b,W,J,N,S,K,P,M,D,T=this.getLayoutTargetSize(),L=T.width,Y=T.height-this.scrollOffset,U=this.padding.left,O=this.padding.top,I=this.pack=="start",Q=0,a=0,V=0,E=0,R=0,Z=[],X=[];
for(W=0;
W<H;
W++){b=G[W];
J=b.margins;
S=J.top+J.bottom;
a=Math.max(a,b.getWidth()+J.left+J.right)
}var A=a+this.padding.left+this.padding.right;
switch(this.align){case"stretch":this.innerCt.setSize(L,Y);
break;
case"stretchmax":case"left":this.innerCt.setSize(A,Y);
break;
case"center":this.innerCt.setSize(L=Math.max(L,A),Y);
break
}var C=Math.max(0,L-this.padding.left-this.padding.right);
for(W=0;
W<H;
W++){b=G[W];
J=b.margins;
if(this.align=="stretch"){b.setWidth(((L-(this.padding.left+this.padding.right))-(J.left+J.right)).constrain(b.minWidth||0,b.maxWidth||1000000))
}else{if(this.align=="stretchmax"){b.setWidth((a-(J.left+J.right)).constrain(b.minWidth||0,b.maxWidth||1000000))
}else{if(I&&b.flex){b.setWidth()
}}}}for(W=0;
W<H;
W++){b=G[W];
V+=b.flex||0;
if(!b.flex){if(!b.height&&!b.hasLayout&&b.doLayout){b.doLayout()
}N=b.getHeight()
}else{N=0
}J=b.margins;
Q+=N+J.top+J.bottom
}D=Math.max(0,(Y-Q-this.padding.top-this.padding.bottom));
var d=D;
for(W=0;
W<H;
W++){b=G[W];
if(I&&b.flex){N=Math.floor(D*(b.flex/V));
d-=N;
Z.push(N)
}}if(this.pack=="center"){O+=D?D/2:0
}else{if(this.pack=="end"){O+=D
}}R=0;
for(W=0;
W<H;
W++){b=G[W];
J=b.margins;
O+=J.top;
M=C;
K=U+J.left;
if(this.align=="center"){if((P=C-(b.getWidth()+J.left+J.right))>0){K+=(P/2);
M-=P
}}b.setPosition(K,O);
if(I&&b.flex){N=Math.max(0,Z[R++]+(d-->0?1:0));
b.setSize(M,N)
}else{N=b.getHeight()
}O+=N+J.bottom
}if(W=g.getStyle("overflow")&&W!="hidden"&&!this.adjustmentPass){var B=this.getLayoutTargetSize();
if(B.width!=T.width||B.height!=T.height){this.adjustmentPass=true;
this.onLayout(F,g)
}}delete this.adjustmentPass
}});
CQ.Ext.Container.LAYOUTS.vbox=CQ.Ext.layout.VBoxLayout;
CQ.Ext.layout.HBoxLayout=CQ.Ext.extend(CQ.Ext.layout.BoxLayout,{align:"top",type:"hbox",onLayout:function(D,d){CQ.Ext.layout.HBoxLayout.superclass.onLayout.call(this,D,d);
var E=this.getRenderedItems(D),F=E.length,a,W,I,C,L,N,T,P=this.getLayoutTargetSize(),K=P.width-this.scrollOffset,Y=P.height,R=this.padding.left,M=this.padding.top,H=this.pack=="start",V=["stretch","stretchmax"].indexOf(this.align)==-1,Z=0,Q=0,S=0,G=0;
for(W=0;
W<F;
W++){a=E[W];
S+=a.flex||0;
if(!a.flex){if(!a.width&&!a.hasLayout&&a.doLayout){a.doLayout()
}C=a.getWidth()
}else{C=0
}I=a.margins;
Z+=C+I.left+I.right;
Q=Math.max(Q,a.getHeight()+I.top+I.bottom)
}T=Math.max(0,(K-Z-this.padding.left-this.padding.right));
var U=Q+this.padding.top+this.padding.bottom;
switch(this.align){case"stretch":this.innerCt.setSize(K,Y);
break;
case"stretchmax":case"top":this.innerCt.setSize(K,U);
break;
case"middle":this.innerCt.setSize(K,Y=Math.max(Y,U));
break
}var b=T,J=[],X=[],O=0,B=Math.max(0,Y-this.padding.top-this.padding.bottom);
for(W=0;
W<F;
W++){a=E[W];
if(H&&a.flex){C=Math.floor(T*(a.flex/S));
b-=C;
J.push(C)
}}if(this.pack=="center"){R+=T?T/2:0
}else{if(this.pack=="end"){R+=T
}}for(W=0;
W<F;
W++){a=E[W];
I=a.margins;
R+=I.left;
a.setPosition(R,M+I.top);
if(H&&a.flex){C=Math.max(0,J[O++]+(b-->0?1:0));
if(V){X.push(a.getHeight())
}a.setSize(C,B)
}else{C=a.getWidth()
}R+=C+I.right
}O=0;
for(W=0;
W<F;
W++){a=E[W];
I=a.margins;
L=a.getHeight();
if(H&&a.flex){L=X[O++]
}if(this.align=="stretch"){a.setHeight(((Y-(this.padding.top+this.padding.bottom))-(I.top+I.bottom)).constrain(a.minHeight||0,a.maxHeight||1000000))
}else{if(this.align=="stretchmax"){a.setHeight((Q-(I.top+I.bottom)).constrain(a.minHeight||0,a.maxHeight||1000000))
}else{if(this.align=="middle"){N=B-(L+I.top+I.bottom);
L=M+I.top+(N/2);
if(N>0){a.setPosition(a.x,L)
}}if(H&&a.flex){a.setHeight(L)
}}}}if(W=d.getStyle("overflow")&&W!="hidden"&&!this.adjustmentPass){var A=this.getLayoutTargetSize();
if(A.width!=P.width||A.height!=P.height){this.adjustmentPass=true;
this.onLayout(D,d)
}}delete this.adjustmentPass
}});
CQ.Ext.Container.LAYOUTS.hbox=CQ.Ext.layout.HBoxLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.ToolbarLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,triggerWidth:18,lastOverflow:false,noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',onLayout:function(C,F){if(!this.leftTr){var E=C.buttonAlign=="center"?"center":"left";
F.addClass("x-toolbar-layout-ct");
F.insertHtml("beforeEnd",'<table cellspacing="0" class="x-toolbar-ct"><tbody><tr><td class="x-toolbar-left" align="'+E+'"><table cellspacing="0"><tbody><tr class="x-toolbar-left-row"></tr></tbody></table></td><td class="x-toolbar-right" align="right"><table cellspacing="0" class="x-toolbar-right-ct"><tbody><tr><td><table cellspacing="0"><tbody><tr class="x-toolbar-right-row"></tr></tbody></table></td><td><table cellspacing="0"><tbody><tr class="x-toolbar-extras-row"></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table>');
this.leftTr=F.child("tr.x-toolbar-left-row",true);
this.rightTr=F.child("tr.x-toolbar-right-row",true);
this.extrasTr=F.child("tr.x-toolbar-extras-row",true)
}var G=C.buttonAlign=="right"?this.rightTr:this.leftTr,J=0,H=C.items.items;
for(var B=0,D=H.length,I;
B<D;
B++,J++){I=H[B];
if(I.isFill){G=this.rightTr;
J=-1
}else{if(!I.rendered){I.render(this.insertCell(I,G,J))
}else{if(!I.xtbHidden&&!this.isValidParent(I,G.childNodes[J])){var A=this.insertCell(I,G,J);
A.appendChild(I.getPositionEl().dom);
I.container=CQ.Ext.get(A)
}}}}this.cleanup(this.leftTr);
this.cleanup(this.rightTr);
this.cleanup(this.extrasTr);
this.fitToSize(F)
},cleanup:function(B){var D=B.childNodes,A,C;
for(A=D.length-1;
A>=0&&(C=D[A]);
A--){if(!C.firstChild){B.removeChild(C)
}}},insertCell:function(D,A,C){var B=document.createElement("td");
B.className="x-toolbar-cell";
A.insertBefore(B,A.childNodes[C]||null);
return B
},hideItem:function(B){var A=(this.hiddens=this.hiddens||[]);
A.push(B);
B.xtbHidden=true;
B.xtbWidth=B.getPositionEl().dom.parentNode.offsetWidth;
B.hide()
},unhideItem:function(A){A.show();
A.xtbHidden=false;
this.hiddens.remove(A);
if(this.hiddens.length<1){delete this.hiddens
}},getItemWidth:function(A){return A.hidden?(A.xtbWidth||0):A.getPositionEl().dom.parentNode.offsetWidth
},fitToSize:function(K){if(this.container.enableOverflow===false){return 
}var J=K.dom.clientWidth,B=this.lastWidth||0,C=K.dom.firstChild.offsetWidth,I=J-this.triggerWidth,H=-1;
this.lastWidth=J;
if(C>J||(this.hiddens&&J>=B)){var D,F=this.container.items.items,E=F.length,G,A=0;
for(D=0;
D<E;
D++){G=F[D];
if(!G.isFill){A+=this.getItemWidth(G);
if(A>I){if(!(G.hidden||G.xtbHidden)){this.hideItem(G)
}}else{if(G.xtbHidden){this.unhideItem(G)
}}}}}if(this.hiddens){this.initMore();
if(!this.lastOverflow){this.container.fireEvent("overflowchange",this.container,true);
this.lastOverflow=true
}}else{if(this.more){this.clearMenu();
this.more.destroy();
delete this.more;
if(this.lastOverflow){this.container.fireEvent("overflowchange",this.container,false);
this.lastOverflow=false
}}}},createMenuConfig:function(D,B){var A=CQ.Ext.apply({},D.initialConfig),C=D.toggleGroup;
CQ.Ext.apply(A,{text:D.overflowText||D.text,iconCls:D.iconCls,icon:D.icon,itemId:D.itemId,disabled:D.disabled,handler:D.handler,scope:D.scope,menu:D.menu,hideOnClick:B});
if(C||D.enableToggle){CQ.Ext.apply(A,{group:C,checked:D.pressed,listeners:{checkchange:function(F,E){D.toggle(E)
}}})
}delete A.ownerCt;
delete A.xtype;
delete A.id;
return A
},addComponentToMenu:function(A,B){if(B instanceof CQ.Ext.Toolbar.Separator){A.add("-")
}else{if(CQ.Ext.isFunction(B.isXType)){if(B.isXType("splitbutton")){A.add(this.createMenuConfig(B,true))
}else{if(B.isXType("button")){A.add(this.createMenuConfig(B,!B.menu))
}else{if(B.isXType("buttongroup")){B.items.each(function(C){this.addComponentToMenu(A,C)
},this)
}}}}}},clearMenu:function(){var A=this.moreMenu;
if(A&&A.items){A.items.each(function(B){delete B.menu
})
}},beforeMoreShow:function(B){var E=this.container.items.items,A=E.length,G,F,C=function(I,H){return I.isXType("buttongroup")&&!(H instanceof CQ.Ext.Toolbar.Separator)
};
this.clearMenu();
B.removeAll();
for(var D=0;
D<A;
D++){G=E[D];
if(G.xtbHidden){if(F&&(C(G,F)||C(F,G))){B.add("-")
}this.addComponentToMenu(B,G);
F=G
}}if(B.items.length<1){B.add(this.noItemsMenuText)
}},initMore:function(){if(!this.more){this.moreMenu=new CQ.Ext.menu.Menu({ownerCt:this.container,listeners:{beforeshow:this.beforeMoreShow,scope:this}});
this.more=new CQ.Ext.Button({iconCls:"x-toolbar-more-icon",cls:"x-toolbar-more",menu:this.moreMenu,ownerCt:this.container});
var A=this.insertCell(this.more,this.extrasTr,100);
this.more.render(A)
}},destroy:function(){CQ.Ext.destroy(this.more,this.moreMenu);
delete this.leftTr;
delete this.rightTr;
delete this.extrasTr;
CQ.Ext.layout.ToolbarLayout.superclass.destroy.call(this)
}});
CQ.Ext.Container.LAYOUTS.toolbar=CQ.Ext.layout.ToolbarLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.layout.MenuLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,setContainer:function(A){this.monitorResize=!A.floating;
A.on("autosize",this.doAutoSize,this);
CQ.Ext.layout.MenuLayout.superclass.setContainer.call(this,A)
},renderItem:function(D,A,C){if(!this.itemTpl){this.itemTpl=CQ.Ext.layout.MenuLayout.prototype.itemTpl=new CQ.Ext.XTemplate('<li id="{itemId}" class="{itemCls}">','<tpl if="needsIcon">','<img src="{icon}" class="{iconCls}"/>',"</tpl>","</li>")
}if(D&&!D.rendered){if(CQ.Ext.isNumber(A)){A=C.dom.childNodes[A]
}var B=this.getItemArgs(D);
D.render(D.positionEl=A?this.itemTpl.insertBefore(A,B,true):this.itemTpl.append(C,B,true));
D.positionEl.menuItemId=D.getItemId();
if(!B.isMenuItem&&B.needsIcon){D.positionEl.addClass("x-menu-list-item-indent")
}this.configureItem(D,A)
}else{if(D&&!this.isValidParent(D,C)){if(CQ.Ext.isNumber(A)){A=C.dom.childNodes[A]
}C.dom.insertBefore(D.getActionEl().dom,A||null)
}}},getItemArgs:function(B){var A=B instanceof CQ.Ext.menu.Item;
return{isMenuItem:A,needsIcon:!A&&(B.icon||B.iconCls),icon:B.icon||CQ.Ext.BLANK_IMAGE_URL,iconCls:"x-menu-item-icon "+(B.iconCls||""),itemId:"x-menu-el-"+B.id,itemCls:"x-menu-list-item "}
},isValidParent:function(B,A){return B.el.up("li.x-menu-list-item",5).dom.parentNode===(A.dom||A)
},onLayout:function(A,B){CQ.Ext.layout.MenuLayout.superclass.onLayout.call(this,A,B);
this.doAutoSize()
},doAutoSize:function(){var C=this.container,A=C.width;
if(C.floating){if(A){C.setWidth(A)
}else{if(CQ.Ext.isIE){C.setWidth(CQ.Ext.isStrict&&(CQ.Ext.isIE7||CQ.Ext.isIE8)?"auto":C.minWidth);
var D=C.getEl(),B=D.dom.offsetWidth;
C.setWidth(C.getLayoutTarget().getWidth()+D.getFrameWidth("lr"))
}}}}});
CQ.Ext.Container.LAYOUTS.menu=CQ.Ext.layout.MenuLayout;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Viewport=CQ.Ext.extend(CQ.Ext.Container,{initComponent:function(){CQ.Ext.Viewport.superclass.initComponent.call(this);
document.getElementsByTagName("html")[0].className+=" x-viewport";
this.el=CQ.Ext.getBody();
this.el.setHeight=CQ.Ext.emptyFn;
this.el.setWidth=CQ.Ext.emptyFn;
this.el.setSize=CQ.Ext.emptyFn;
this.el.dom.scroll="no";
this.allowDomMove=false;
this.autoWidth=true;
this.autoHeight=true;
CQ.Ext.EventManager.onWindowResize(this.fireResize,this);
this.renderTo=this.el
},fireResize:function(A,B){this.fireEvent("resize",this,A,B,A,B)
}});
CQ.Ext.reg("viewport",CQ.Ext.Viewport);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Panel=CQ.Ext.extend(CQ.Ext.Container,{baseCls:"x-panel",collapsedCls:"x-panel-collapsed",maskDisabled:true,animCollapse:CQ.Ext.enableFx,headerAsText:true,buttonAlign:"right",collapsed:false,collapseFirst:true,minButtonWidth:75,elements:"body",preventBodyReset:false,padding:undefined,resizeEvent:"bodyresize",toolTarget:"header",collapseEl:"bwrap",slideAnchor:"t",disabledClass:"",deferHeight:true,expandDefaults:{duration:0.25},collapseDefaults:{duration:0.25},initComponent:function(){CQ.Ext.Panel.superclass.initComponent.call(this);
this.addEvents("bodyresize","titlechange","iconchange","collapse","expand","beforecollapse","beforeexpand","beforeclose","close","activate","deactivate");
if(this.unstyled){this.baseCls="x-plain"
}this.toolbars=[];
if(this.tbar){this.elements+=",tbar";
this.topToolbar=this.createToolbar(this.tbar);
delete this.tbar
}if(this.bbar){this.elements+=",bbar";
this.bottomToolbar=this.createToolbar(this.bbar);
delete this.bbar
}if(this.header===true){this.elements+=",header";
delete this.header
}else{if(this.headerCfg||(this.title&&this.header!==false)){this.elements+=",header"
}}if(this.footerCfg||this.footer===true){this.elements+=",footer";
delete this.footer
}if(this.buttons){this.fbar=this.buttons;
delete this.buttons
}if(this.fbar){this.createFbar(this.fbar)
}if(this.autoLoad){this.on("render",this.doAutoLoad,this,{delay:10})
}},createFbar:function(B){var A=this.minButtonWidth;
this.elements+=",footer";
this.fbar=this.createToolbar(B,{buttonAlign:this.buttonAlign,toolbarCls:"x-panel-fbar",enableOverflow:false,defaults:function(C){return{minWidth:C.minWidth||A}
}});
this.fbar.items.each(function(C){C.minWidth=C.minWidth||this.minButtonWidth
},this);
this.buttons=this.fbar.items.items
},createToolbar:function(B,C){var A;
if(CQ.Ext.isArray(B)){B={items:B}
}A=B.events?CQ.Ext.apply(B,C):this.createComponent(CQ.Ext.apply({},B,C),"toolbar");
this.toolbars.push(A);
return A
},createElement:function(A,C){if(this[A]){C.appendChild(this[A].dom);
return 
}if(A==="bwrap"||this.elements.indexOf(A)!=-1){if(this[A+"Cfg"]){this[A]=CQ.Ext.fly(C).createChild(this[A+"Cfg"])
}else{var B=document.createElement("div");
B.className=this[A+"Cls"];
this[A]=CQ.Ext.get(C.appendChild(B))
}if(this[A+"CssClass"]){this[A].addClass(this[A+"CssClass"])
}if(this[A+"Style"]){this[A].applyStyles(this[A+"Style"])
}}},onRender:function(E,D){CQ.Ext.Panel.superclass.onRender.call(this,E,D);
this.createClasses();
var A=this.el,F=A.dom,I,G;
if(this.collapsible&&!this.hideCollapseTool){this.tools=this.tools?this.tools.slice(0):[];
this.tools[this.collapseFirst?"unshift":"push"]({id:"toggle",handler:this.toggleCollapse,scope:this})
}if(this.tools){G=this.tools;
this.elements+=(this.header!==false)?",header":""
}this.tools={};
A.addClass(this.baseCls);
if(F.firstChild){this.header=A.down("."+this.headerCls);
this.bwrap=A.down("."+this.bwrapCls);
var H=this.bwrap?this.bwrap:A;
this.tbar=H.down("."+this.tbarCls);
this.body=H.down("."+this.bodyCls);
this.bbar=H.down("."+this.bbarCls);
this.footer=H.down("."+this.footerCls);
this.fromMarkup=true
}if(this.preventBodyReset===true){A.addClass("x-panel-reset")
}if(this.cls){A.addClass(this.cls)
}if(this.buttons){this.elements+=",footer"
}if(this.frame){A.insertHtml("afterBegin",String.format(CQ.Ext.Element.boxMarkup,this.baseCls));
this.createElement("header",F.firstChild.firstChild.firstChild);
this.createElement("bwrap",F);
I=this.bwrap.dom;
var C=F.childNodes[1],B=F.childNodes[2];
I.appendChild(C);
I.appendChild(B);
var J=I.firstChild.firstChild.firstChild;
this.createElement("tbar",J);
this.createElement("body",J);
this.createElement("bbar",J);
this.createElement("footer",I.lastChild.firstChild.firstChild);
if(!this.footer){this.bwrap.dom.lastChild.className+=" x-panel-nofooter"
}this.ft=CQ.Ext.get(this.bwrap.dom.lastChild);
this.mc=CQ.Ext.get(J)
}else{this.createElement("header",F);
this.createElement("bwrap",F);
I=this.bwrap.dom;
this.createElement("tbar",I);
this.createElement("body",I);
this.createElement("bbar",I);
this.createElement("footer",I);
if(!this.header){this.body.addClass(this.bodyCls+"-noheader");
if(this.tbar){this.tbar.addClass(this.tbarCls+"-noheader")
}}}if(CQ.Ext.isDefined(this.padding)){this.body.setStyle("padding",this.body.addUnits(this.padding))
}if(this.border===false){this.el.addClass(this.baseCls+"-noborder");
this.body.addClass(this.bodyCls+"-noborder");
if(this.header){this.header.addClass(this.headerCls+"-noborder")
}if(this.footer){this.footer.addClass(this.footerCls+"-noborder")
}if(this.tbar){this.tbar.addClass(this.tbarCls+"-noborder")
}if(this.bbar){this.bbar.addClass(this.bbarCls+"-noborder")
}}if(this.bodyBorder===false){this.body.addClass(this.bodyCls+"-noborder")
}this.bwrap.enableDisplayMode("block");
if(this.header){this.header.unselectable();
if(this.headerAsText){this.header.dom.innerHTML='<span class="'+this.headerTextCls+'">'+this.header.dom.innerHTML+"</span>";
if(this.iconCls){this.setIconClass(this.iconCls)
}}}if(this.floating){this.makeFloating(this.floating)
}if(this.collapsible&&this.titleCollapse&&this.header){this.mon(this.header,"click",this.toggleCollapse,this);
this.header.setStyle("cursor","pointer")
}if(G){this.addTool.apply(this,G)
}if(this.fbar){this.footer.addClass("x-panel-btns");
this.fbar.ownerCt=this;
this.fbar.render(this.footer);
this.footer.createChild({cls:"x-clear"})
}if(this.tbar&&this.topToolbar){this.topToolbar.ownerCt=this;
this.topToolbar.render(this.tbar)
}if(this.bbar&&this.bottomToolbar){this.bottomToolbar.ownerCt=this;
this.bottomToolbar.render(this.bbar)
}},setIconClass:function(B){var A=this.iconCls;
this.iconCls=B;
if(this.rendered&&this.header){if(this.frame){this.header.addClass("x-panel-icon");
this.header.replaceClass(A,this.iconCls)
}else{var D=this.header,C=D.child("img.x-panel-inline-icon");
if(C){CQ.Ext.fly(C).replaceClass(A,this.iconCls)
}else{CQ.Ext.DomHelper.insertBefore(D.dom.firstChild,{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.iconCls})
}}}this.fireEvent("iconchange",this,B,A)
},makeFloating:function(A){this.floating=true;
this.el=new CQ.Ext.Layer(CQ.Ext.apply({},A,{shadow:CQ.Ext.isDefined(this.shadow)?this.shadow:"sides",shadowOffset:this.shadowOffset,constrain:false,shim:this.shim===false?false:undefined}),this.el)
},getTopToolbar:function(){return this.topToolbar
},getBottomToolbar:function(){return this.bottomToolbar
},addButton:function(A,C,B){if(!this.fbar){this.createFbar([])
}if(C){if(CQ.Ext.isString(A)){A={text:A}
}A=CQ.Ext.apply({handler:C,scope:B},A)
}return this.fbar.add(A)
},addTool:function(){if(!this.rendered){if(!this.tools){this.tools=[]
}CQ.Ext.each(arguments,function(H){this.tools.push(H)
},this);
return 
}if(!this[this.toolTarget]){return 
}if(!this.toolTemplate){var F=new CQ.Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
F.disableFormats=true;
F.compile();
CQ.Ext.Panel.prototype.toolTemplate=F
}for(var E=0,C=arguments,B=C.length;
E<B;
E++){var A=C[E];
if(!this.tools[A.id]){var G="x-tool-"+A.id+"-over";
var D=this.toolTemplate.insertFirst(this[this.toolTarget],A,true);
this.tools[A.id]=D;
D.enableDisplayMode("block");
this.mon(D,"click",this.createToolHandler(D,A,G,this));
if(A.on){this.mon(D,A.on)
}if(A.hidden){D.hide()
}if(A.qtip){if(CQ.Ext.isObject(A.qtip)){CQ.Ext.QuickTips.register(CQ.Ext.apply({target:D.id},A.qtip))
}else{D.dom.qtip=A.qtip
}}D.addClassOnOver(G)
}}},onLayout:function(B,A){CQ.Ext.Panel.superclass.onLayout.apply(this,arguments);
if(this.hasLayout&&this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(C){C.doLayout(undefined,A)
});
this.syncHeight()
}},syncHeight:function(){var B=this.toolbarHeight,C=this.body,A=this.lastSize.height,D;
if(this.autoHeight||!CQ.Ext.isDefined(A)||A=="auto"){return 
}if(B!=this.getToolbarHeight()){B=Math.max(0,this.adjustBodyHeight(A-this.getFrameHeight()));
C.setHeight(B);
D=C.getSize();
this.toolbarHeight=this.getToolbarHeight();
this.onBodyResize(D.width,D.height)
}},onShow:function(){if(this.floating){return this.el.show()
}CQ.Ext.Panel.superclass.onShow.call(this)
},onHide:function(){if(this.floating){return this.el.hide()
}CQ.Ext.Panel.superclass.onHide.call(this)
},createToolHandler:function(C,A,D,B){return function(E){C.removeClass(D);
if(A.stopEvent!==false){E.stopEvent()
}if(A.handler){A.handler.call(A.scope||C,E,C,B,A)
}}
},afterRender:function(){if(this.floating&&!this.hidden){this.el.show()
}if(this.title){this.setTitle(this.title)
}CQ.Ext.Panel.superclass.afterRender.call(this);
if(this.collapsed){this.collapsed=false;
this.collapse(false)
}this.initEvents()
},getKeyMap:function(){if(!this.keyMap){this.keyMap=new CQ.Ext.KeyMap(this.el,this.keys)
}return this.keyMap
},initEvents:function(){if(this.keys){this.getKeyMap()
}if(this.draggable){this.initDraggable()
}if(this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(A){A.doLayout();
A.on({scope:this,afterlayout:this.syncHeight,remove:this.syncHeight})
},this);
this.syncHeight()
}},initDraggable:function(){this.dd=new CQ.Ext.Panel.DD(this,CQ.Ext.isBoolean(this.draggable)?null:this.draggable)
},beforeEffect:function(A){if(this.floating){this.el.beforeAction()
}if(A!==false){this.el.addClass("x-panel-animated")
}},afterEffect:function(A){this.syncShadow();
if(A!==false){this.el.removeClass("x-panel-animated")
}},createEffect:function(B,A,C){var D={scope:C,block:true};
if(B===true){D.callback=A;
return D
}else{if(!B.callback){D.callback=A
}else{D.callback=function(){A.call(C);
CQ.Ext.callback(B.callback,B.scope)
}
}}return CQ.Ext.applyIf(D,B)
},collapse:function(B){if(this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforecollapse",this,B)===false){return 
}var A=B===true||(B!==false&&this.animCollapse);
this.beforeEffect(A);
this.onCollapse(A,B);
return this
},onCollapse:function(A,B){if(A){this[this.collapseEl].slideOut(this.slideAnchor,CQ.Ext.apply(this.createEffect(B||true,this.afterCollapse,this),this.collapseDefaults))
}else{this[this.collapseEl].hide();
this.afterCollapse(false)
}},afterCollapse:function(A){this.collapsed=true;
this.el.addClass(this.collapsedCls);
this.afterEffect(A);
this.fireEvent("collapse",this)
},expand:function(B){if(!this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforeexpand",this,B)===false){return 
}var A=B===true||(B!==false&&this.animCollapse);
this.el.removeClass(this.collapsedCls);
this.beforeEffect(A);
this.onExpand(A,B);
return this
},onExpand:function(A,B){if(A){this[this.collapseEl].slideIn(this.slideAnchor,CQ.Ext.apply(this.createEffect(B||true,this.afterExpand,this),this.expandDefaults))
}else{this[this.collapseEl].show();
this.afterExpand(false)
}},afterExpand:function(A){this.collapsed=false;
this.afterEffect(A);
if(this.deferLayout){delete this.deferLayout;
this.doLayout(true)
}this.fireEvent("expand",this)
},toggleCollapse:function(A){this[this.collapsed?"expand":"collapse"](A);
return this
},onDisable:function(){if(this.rendered&&this.maskDisabled){this.el.mask()
}CQ.Ext.Panel.superclass.onDisable.call(this)
},onEnable:function(){if(this.rendered&&this.maskDisabled){this.el.unmask()
}CQ.Ext.Panel.superclass.onEnable.call(this)
},onResize:function(A,B){if(CQ.Ext.isDefined(A)||CQ.Ext.isDefined(B)){if(!this.collapsed){if(CQ.Ext.isNumber(A)){this.body.setWidth(A=this.adjustBodyWidth(A-this.getFrameWidth()))
}else{if(A=="auto"){A=this.body.setWidth("auto").dom.offsetWidth
}else{A=this.body.dom.offsetWidth
}}if(this.tbar){this.tbar.setWidth(A);
if(this.topToolbar){this.topToolbar.setSize(A)
}}if(this.bbar){this.bbar.setWidth(A);
if(this.bottomToolbar){this.bottomToolbar.setSize(A);
if(CQ.Ext.isIE){this.bbar.setStyle("position","static");
this.bbar.setStyle("position","")
}}}if(this.footer){this.footer.setWidth(A);
if(this.fbar){this.fbar.setSize(CQ.Ext.isIE?(A-this.footer.getFrameWidth("lr")):"auto")
}}if(CQ.Ext.isNumber(B)){B=Math.max(0,this.adjustBodyHeight(B-this.getFrameHeight()));
this.body.setHeight(B)
}else{if(B=="auto"){this.body.setHeight(B)
}}if(this.disabled&&this.el._mask){this.el._mask.setSize(this.el.dom.clientWidth,this.el.getHeight())
}}else{this.queuedBodySize={width:A,height:B};
if(!this.queuedExpand&&this.allowQueuedExpand!==false){this.queuedExpand=true;
this.on("expand",function(){delete this.queuedExpand;
this.onResize(this.queuedBodySize.width,this.queuedBodySize.height)
},this,{single:true})
}}this.onBodyResize(A,B)
}this.syncShadow();
CQ.Ext.Panel.superclass.onResize.call(this)
},onBodyResize:function(A,B){this.fireEvent("bodyresize",this,A,B)
},getToolbarHeight:function(){var A=0;
if(this.rendered){CQ.Ext.each(this.toolbars,function(B){A+=B.getHeight()
},this)
}return A
},adjustBodyHeight:function(A){return A
},adjustBodyWidth:function(A){return A
},onPosition:function(){this.syncShadow()
},getFrameWidth:function(){var B=this.el.getFrameWidth("lr")+this.bwrap.getFrameWidth("lr");
if(this.frame){var A=this.bwrap.dom.firstChild;
B+=(CQ.Ext.fly(A).getFrameWidth("l")+CQ.Ext.fly(A.firstChild).getFrameWidth("r"));
B+=this.mc.getFrameWidth("lr")
}return B
},getFrameHeight:function(){var A=this.el.getFrameWidth("tb")+this.bwrap.getFrameWidth("tb");
A+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);
if(this.frame){A+=this.el.dom.firstChild.offsetHeight+this.ft.dom.offsetHeight+this.mc.getFrameWidth("tb")
}else{A+=(this.header?this.header.getHeight():0)+(this.footer?this.footer.getHeight():0)
}return A
},getInnerWidth:function(){return this.getSize().width-this.getFrameWidth()
},getInnerHeight:function(){return this.getSize().height-this.getFrameHeight()
},syncShadow:function(){if(this.floating){this.el.sync(true)
}},getLayoutTarget:function(){return this.body
},getContentTarget:function(){return this.body
},setTitle:function(B,A){this.title=B;
if(this.header&&this.headerAsText){this.header.child("span").update(B)
}if(A){this.setIconClass(A)
}this.fireEvent("titlechange",this,B);
return this
},getUpdater:function(){return this.body.getUpdater()
},load:function(){var A=this.body.getUpdater();
A.update.apply(A,arguments);
return this
},beforeDestroy:function(){CQ.Ext.Panel.superclass.beforeDestroy.call(this);
if(this.header){this.header.removeAllListeners()
}if(this.tools){for(var A in this.tools){CQ.Ext.destroy(this.tools[A])
}}if(this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(B){B.un("afterlayout",this.syncHeight,this);
B.un("remove",this.syncHeight,this)
},this)
}if(CQ.Ext.isArray(this.buttons)){while(this.buttons.length){CQ.Ext.destroy(this.buttons[0])
}}if(this.rendered){CQ.Ext.destroy(this.ft,this.header,this.footer,this.toolbars,this.tbar,this.bbar,this.body,this.mc,this.bwrap);
if(this.fbar){CQ.Ext.destroy(this.fbar,this.fbar.el)
}}else{CQ.Ext.destroy(this.topToolbar,this.bottomToolbar)
}},createClasses:function(){this.headerCls=this.baseCls+"-header";
this.headerTextCls=this.baseCls+"-header-text";
this.bwrapCls=this.baseCls+"-bwrap";
this.tbarCls=this.baseCls+"-tbar";
this.bodyCls=this.baseCls+"-body";
this.bbarCls=this.baseCls+"-bbar";
this.footerCls=this.baseCls+"-footer"
},createGhost:function(A,E,B){var D=document.createElement("div");
D.className="x-panel-ghost "+(A?A:"");
if(this.header){D.appendChild(this.el.dom.firstChild.cloneNode(true))
}CQ.Ext.fly(D.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight());
D.style.width=this.el.dom.offsetWidth+"px";
if(!B){this.container.dom.appendChild(D)
}else{CQ.Ext.getDom(B).appendChild(D)
}if(E!==false&&this.el.useShim!==false){var C=new CQ.Ext.Layer({shadow:false,useDisplay:true,constrain:false},D);
C.show();
return C
}else{return new CQ.Ext.Element(D)
}},doAutoLoad:function(){var A=this.body.getUpdater();
if(this.renderer){A.setRenderer(this.renderer)
}A.update(CQ.Ext.isObject(this.autoLoad)?this.autoLoad:{url:this.autoLoad})
},getTool:function(A){return this.tools[A]
}});
CQ.Ext.reg("panel",CQ.Ext.Panel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Editor=function(B,A){if(B.field){this.field=CQ.Ext.create(B.field,"textfield");
A=CQ.Ext.apply({},B);
delete A.field
}else{this.field=B
}CQ.Ext.Editor.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.Ext.Editor,CQ.Ext.Component,{value:"",alignment:"c-c?",offsets:[0,0],shadow:"frame",constrain:false,swallowKeys:true,completeOnEnter:true,cancelOnEsc:true,updateEl:false,initComponent:function(){CQ.Ext.Editor.superclass.initComponent.call(this);
this.addEvents("beforestartedit","startedit","beforecomplete","complete","canceledit","specialkey")
},onRender:function(B,A){this.el=new CQ.Ext.Layer({shadow:this.shadow,cls:"x-editor",parentEl:B,shim:this.shim,shadowOffset:this.shadowOffset||4,id:this.id,constrain:this.constrain});
if(this.zIndex){this.el.setZIndex(this.zIndex)
}this.el.setStyle("overflow",CQ.Ext.isGecko?"auto":"hidden");
if(this.field.msgTarget!="title"){this.field.msgTarget="qtip"
}this.field.inEditor=true;
this.mon(this.field,{scope:this,blur:this.onBlur,specialkey:this.onSpecialKey});
if(this.field.grow){this.mon(this.field,"autosize",this.el.sync,this.el,{delay:1})
}this.field.render(this.el).show();
this.field.getEl().dom.name="";
if(this.swallowKeys){this.field.el.swallowEvent(["keypress","keydown"])
}},onSpecialKey:function(E,D){var B=D.getKey(),A=this.completeOnEnter&&B==D.ENTER,C=this.cancelOnEsc&&B==D.ESC;
if(A||C){D.stopEvent();
if(A){this.completeEdit()
}else{this.cancelEdit()
}if(E.triggerBlur){E.triggerBlur()
}}this.fireEvent("specialkey",E,D)
},startEdit:function(B,C){if(this.editing){this.completeEdit()
}this.boundEl=CQ.Ext.get(B);
var A=C!==undefined?C:this.boundEl.dom.innerHTML;
if(!this.rendered){this.render(this.parentEl||document.body)
}if(this.fireEvent("beforestartedit",this,this.boundEl,A)!==false){this.startValue=A;
this.field.reset();
this.field.setValue(A);
this.realign(true);
this.editing=true;
this.show()
}},doAutoSize:function(){if(this.autoSize){var B=this.boundEl.getSize(),A=this.field.getSize();
switch(this.autoSize){case"width":this.setSize(B.width,A.height);
break;
case"height":this.setSize(A.width,B.height);
break;
case"none":this.setSize(A.width,A.height);
break;
default:this.setSize(B.width,B.height)
}}},setSize:function(A,B){delete this.field.lastSize;
this.field.setSize(A,B);
if(this.el){if(CQ.Ext.isGecko2||CQ.Ext.isOpera){this.el.setSize(A,B)
}this.el.sync()
}},realign:function(A){if(A===true){this.doAutoSize()
}this.el.alignTo(this.boundEl,this.alignment,this.offsets)
},completeEdit:function(A){if(!this.editing){return 
}var B=this.getValue();
if(!this.field.isValid()){if(this.revertInvalid!==false){this.cancelEdit(A)
}return 
}if(String(B)===String(this.startValue)&&this.ignoreNoChange){this.hideEdit(A);
return 
}if(this.fireEvent("beforecomplete",this,B,this.startValue)!==false){B=this.getValue();
if(this.updateEl&&this.boundEl){this.boundEl.update(B)
}this.hideEdit(A);
this.fireEvent("complete",this,B,this.startValue)
}},onShow:function(){this.el.show();
if(this.hideEl!==false){this.boundEl.hide()
}this.field.show().focus(false,true);
this.fireEvent("startedit",this.boundEl,this.startValue)
},cancelEdit:function(A){if(this.editing){var B=this.getValue();
this.setValue(this.startValue);
this.hideEdit(A);
this.fireEvent("canceledit",this,B,this.startValue)
}},hideEdit:function(A){if(A!==true){this.editing=false;
this.hide()
}},onBlur:function(){if(this.allowBlur!==true&&this.editing&&this.selectSameEditor!==true){this.completeEdit()
}},onHide:function(){if(this.editing){this.completeEdit();
return 
}this.field.blur();
if(this.field.collapse){this.field.collapse()
}this.el.hide();
if(this.hideEl!==false){this.boundEl.show()
}},setValue:function(A){this.field.setValue(A)
},getValue:function(){return this.field.getValue()
},beforeDestroy:function(){CQ.Ext.destroyMembers(this,"field");
delete this.parentEl;
delete this.boundEl
}});
CQ.Ext.reg("editor",CQ.Ext.Editor);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ColorPalette=CQ.Ext.extend(CQ.Ext.Component,{itemCls:"x-color-palette",value:null,clickEvent:"click",ctype:"CQ.Ext.ColorPalette",allowReselect:false,colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","969696","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"],initComponent:function(){CQ.Ext.ColorPalette.superclass.initComponent.call(this);
this.addEvents("select");
if(this.handler){this.on("select",this.handler,this.scope,true)
}},onRender:function(B,A){this.autoEl={tag:"div",cls:this.itemCls};
CQ.Ext.ColorPalette.superclass.onRender.call(this,B,A);
var C=this.tpl||new CQ.Ext.XTemplate('<tpl for="."><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>');
C.overwrite(this.el,this.colors);
this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:"a"});
if(this.clickEvent!="click"){this.mon(this.el,"click",CQ.Ext.emptyFn,this,{delegate:"a",preventDefault:true})
}},afterRender:function(){CQ.Ext.ColorPalette.superclass.afterRender.call(this);
if(this.value){var A=this.value;
this.value=null;
this.select(A)
}},handleClick:function(B,A){B.preventDefault();
if(!this.disabled){var C=A.className.match(/(?:^|\s)color-(.{6})(?:\s|$)/)[1];
this.select(C.toUpperCase())
}},select:function(A){A=A.replace("#","");
if(A!=this.value||this.allowReselect){var B=this.el;
if(this.value){B.child("a.color-"+this.value).removeClass("x-color-palette-sel")
}B.child("a.color-"+A).addClass("x-color-palette-sel");
this.value=A;
this.fireEvent("select",this,A)
}}});
CQ.Ext.reg("colorpalette",CQ.Ext.ColorPalette);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.DatePicker=CQ.Ext.extend(CQ.Ext.BoxComponent,{todayText:"Today",okText:"&#160;OK&#160;",cancelText:"Cancel",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/d/y",disabledDaysText:"Disabled",disabledDatesText:"Disabled",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",startDay:0,showToday:true,focusOnSelect:true,initComponent:function(){CQ.Ext.DatePicker.superclass.initComponent.call(this);
this.value=this.value?this.value.clearTime(true):new Date().clearTime();
this.addEvents("select");
if(this.handler){this.on("select",this.handler,this.scope||this)
}this.initDisabledDays()
},initDisabledDays:function(){if(!this.disabledDatesRE&&this.disabledDates){var B=this.disabledDates,A=B.length-1,C="(?:";
CQ.Ext.each(B,function(E,D){C+=CQ.Ext.isDate(E)?"^"+CQ.Ext.escapeRe(E.dateFormat(this.format))+"$":B[D];
if(D!=A){C+="|"
}},this);
this.disabledDatesRE=new RegExp(C+")")
}},setDisabledDates:function(A){if(CQ.Ext.isArray(A)){this.disabledDates=A;
this.disabledDatesRE=null
}else{this.disabledDatesRE=A
}this.initDisabledDays();
this.update(this.value,true)
},setDisabledDays:function(A){this.disabledDays=A;
this.update(this.value,true)
},setMinDate:function(A){this.minDate=A;
this.update(this.value,true)
},setMaxDate:function(A){this.maxDate=A;
this.update(this.value,true)
},setValue:function(A){this.value=A.clearTime(true);
this.update(this.value)
},getValue:function(){return this.value
},focus:function(){this.update(this.activeDate)
},onEnable:function(A){CQ.Ext.DatePicker.superclass.onEnable.call(this);
this.doDisabled(false);
this.update(A?this.value:this.activeDate);
if(CQ.Ext.isIE){this.el.repaint()
}},onDisable:function(){CQ.Ext.DatePicker.superclass.onDisable.call(this);
this.doDisabled(true);
if(CQ.Ext.isIE&&!CQ.Ext.isIE8){CQ.Ext.each([].concat(this.textNodes,this.el.query("th span")),function(A){CQ.Ext.fly(A).repaint()
})
}},doDisabled:function(A){this.keyNav.setDisabled(A);
this.prevRepeater.setDisabled(A);
this.nextRepeater.setDisabled(A);
if(this.showToday){this.todayKeyListener.setDisabled(A);
this.todayBtn.setDisabled(A)
}},onRender:function(D,B){var A=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],C=this.dayNames,F;
for(F=0;
F<7;
F++){var H=this.startDay+F;
if(H>6){H=H-7
}A.push("<th><span>",C[H].substr(0,1),"</span></th>")
}A[A.length]="</tr></thead><tbody><tr>";
for(F=0;
F<42;
F++){if(F%7===0&&F!==0){A[A.length]="</tr><tr>"
}A[A.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'
}A.push("</tr></tbody></table></td></tr>",this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':"",'</table><div class="x-date-mp"></div>');
var G=document.createElement("div");
G.className="x-date-picker";
G.innerHTML=A.join("");
D.dom.insertBefore(G,B);
this.el=CQ.Ext.get(G);
this.eventEl=CQ.Ext.get(G.firstChild);
this.prevRepeater=new CQ.Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});
this.nextRepeater=new CQ.Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});
this.monthPicker=this.el.down("div.x-date-mp");
this.monthPicker.enableDisplayMode("block");
this.keyNav=new CQ.Ext.KeyNav(this.eventEl,{left:function(I){if(I.ctrlKey){this.showPrevMonth()
}else{this.update(this.activeDate.add("d",-1))
}},right:function(I){if(I.ctrlKey){this.showNextMonth()
}else{this.update(this.activeDate.add("d",1))
}},up:function(I){if(I.ctrlKey){this.showNextYear()
}else{this.update(this.activeDate.add("d",-7))
}},down:function(I){if(I.ctrlKey){this.showPrevYear()
}else{this.update(this.activeDate.add("d",7))
}},pageUp:function(I){this.showNextMonth()
},pageDown:function(I){this.showPrevMonth()
},enter:function(I){I.stopPropagation();
return true
},scope:this});
this.el.unselectable();
this.cells=this.el.select("table.x-date-inner tbody td");
this.textNodes=this.el.query("table.x-date-inner tbody span");
this.mbtn=new CQ.Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});
this.mbtn.el.child("em").addClass("x-btn-arrow");
if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(CQ.Ext.EventObject.SPACE,this.selectToday,this);
var E=(new Date()).dateFormat(this.format);
this.todayBtn=new CQ.Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,E),tooltip:String.format(this.todayTip,E),handler:this.selectToday,scope:this})
}this.mon(this.eventEl,"mousewheel",this.handleMouseWheel,this);
this.mon(this.eventEl,"click",this.handleDateClick,this,{delegate:"a.x-date-date"});
this.mon(this.mbtn,"click",this.showMonthPicker,this);
this.onEnable(true)
},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var A=['<table border="0" cellspacing="0">'];
for(var B=0;
B<6;
B++){A.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(B),"</a></td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(B+6),"</a></td>",B===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')
}A.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");
this.monthPicker.update(A.join(""));
this.mon(this.monthPicker,"click",this.onMonthClick,this);
this.mon(this.monthPicker,"dblclick",this.onMonthDblClick,this);
this.mpMonths=this.monthPicker.select("td.x-date-mp-month");
this.mpYears=this.monthPicker.select("td.x-date-mp-year");
this.mpMonths.each(function(C,D,E){E+=1;
if((E%2)===0){C.dom.xmonth=5+Math.round(E*0.5)
}else{C.dom.xmonth=Math.round((E-1)*0.5)
}})
}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();
var A=this.el.getSize();
this.monthPicker.setSize(A);
this.monthPicker.child("table").setSize(A);
this.mpSelMonth=(this.activeDate||this.value).getMonth();
this.updateMPMonth(this.mpSelMonth);
this.mpSelYear=(this.activeDate||this.value).getFullYear();
this.updateMPYear(this.mpSelYear);
this.monthPicker.slideIn("t",{duration:0.2})
}},updateMPYear:function(E){this.mpyear=E;
var C=this.mpYears.elements;
for(var B=1;
B<=10;
B++){var D=C[B-1],A;
if((B%2)===0){A=E+Math.round(B*0.5);
D.firstChild.innerHTML=A;
D.xyear=A
}else{A=E-(5-Math.round(B*0.5));
D.firstChild.innerHTML=A;
D.xyear=A
}this.mpYears.item(B-1)[A==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")
}},updateMPMonth:function(A){this.mpMonths.each(function(B,C,D){B[B.dom.xmonth==A?"addClass":"removeClass"]("x-date-mp-sel")
})
},selectMPMonth:function(A){},onMonthClick:function(D,B){D.stopEvent();
var C=new CQ.Ext.Element(B),A;
if(C.is("button.x-date-mp-cancel")){this.hideMonthPicker()
}else{if(C.is("button.x-date-mp-ok")){var E=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());
if(E.getMonth()!=this.mpSelMonth){E=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()
}this.update(E);
this.hideMonthPicker()
}else{if((A=C.up("td.x-date-mp-month",2))){this.mpMonths.removeClass("x-date-mp-sel");
A.addClass("x-date-mp-sel");
this.mpSelMonth=A.dom.xmonth
}else{if((A=C.up("td.x-date-mp-year",2))){this.mpYears.removeClass("x-date-mp-sel");
A.addClass("x-date-mp-sel");
this.mpSelYear=A.dom.xyear
}else{if(C.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)
}else{if(C.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)
}}}}}}},onMonthDblClick:function(D,B){D.stopEvent();
var C=new CQ.Ext.Element(B),A;
if((A=C.up("td.x-date-mp-month",2))){this.update(new Date(this.mpSelYear,A.dom.xmonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}else{if((A=C.up("td.x-date-mp-year",2))){this.update(new Date(A.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}}},hideMonthPicker:function(A){if(this.monthPicker){if(A===true){this.monthPicker.hide()
}else{this.monthPicker.slideOut("t",{duration:0.2})
}}},showPrevMonth:function(A){this.update(this.activeDate.add("mo",-1))
},showNextMonth:function(A){this.update(this.activeDate.add("mo",1))
},showPrevYear:function(){this.update(this.activeDate.add("y",-1))
},showNextYear:function(){this.update(this.activeDate.add("y",1))
},handleMouseWheel:function(A){A.stopEvent();
if(!this.disabled){var B=A.getWheelDelta();
if(B>0){this.showPrevMonth()
}else{if(B<0){this.showNextMonth()
}}}},handleDateClick:function(B,A){B.stopEvent();
if(!this.disabled&&A.dateValue&&!CQ.Ext.fly(A.parentNode).hasClass("x-date-disabled")){this.cancelFocus=this.focusOnSelect===false;
this.setValue(new Date(A.dateValue));
delete this.cancelFocus;
this.fireEvent("select",this,this.value)
}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date().clearTime());
this.fireEvent("select",this,this.value)
}},update:function(c,W){if(this.rendered){var A=this.activeDate,M=this.isVisible();
this.activeDate=c;
if(!W&&A&&this.el){var L=c.getTime();
if(A.getMonth()==c.getMonth()&&A.getFullYear()==c.getFullYear()){this.cells.removeClass("x-date-selected");
this.cells.each(function(d){if(d.dom.firstChild.dateValue==L){d.addClass("x-date-selected");
if(M&&!this.cancelFocus){CQ.Ext.fly(d.dom.firstChild).focus(50)
}return false
}},this);
return 
}}var H=c.getDaysInMonth(),N=c.getFirstDateOfMonth(),E=N.getDay()-this.startDay;
if(E<0){E+=7
}H+=E;
var X=c.add("mo",-1),F=X.getDaysInMonth()-E,D=this.cells.elements,O=this.textNodes,U=86400000,Z=(new Date(X.getFullYear(),X.getMonth(),F)).clearTime(),Y=new Date().clearTime().getTime(),R=c.clearTime(true).getTime(),Q=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,T=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,b=this.disabledDatesRE,P=this.disabledDatesText,j=this.disabledDays?this.disabledDays.join(""):false,a=this.disabledDaysText,V=this.format;
if(this.showToday){var J=new Date().clearTime(),C=(J<Q||J>T||(b&&V&&b.test(J.dateFormat(V)))||(j&&j.indexOf(J.getDay())!=-1));
if(!this.disabled){this.todayBtn.setDisabled(C);
this.todayKeyListener[C?"disable":"enable"]()
}}var I=function(n,d){d.title="";
var k=Z.getTime();
d.firstChild.dateValue=k;
if(k==Y){d.className+=" x-date-today";
d.title=n.todayText
}if(k==R){d.className+=" x-date-selected";
if(M){CQ.Ext.fly(d.firstChild).focus(50)
}}if(k<Q){d.className=" x-date-disabled";
d.title=n.minText;
return 
}if(k>T){d.className=" x-date-disabled";
d.title=n.maxText;
return 
}if(j){if(j.indexOf(Z.getDay())!=-1){d.title=a;
d.className=" x-date-disabled"
}}if(b&&V){var m=Z.dateFormat(V);
if(b.test(m)){d.title=P.replace("%0",m);
d.className=" x-date-disabled"
}}};
var S=0;
for(;
S<E;
S++){O[S].innerHTML=(++F);
Z.setDate(Z.getDate()+1);
D[S].className="x-date-prevday";
I(this,D[S])
}for(;
S<H;
S++){var B=S-E+1;
O[S].innerHTML=(B);
Z.setDate(Z.getDate()+1);
D[S].className="x-date-active";
I(this,D[S])
}var g=0;
for(;
S<42;
S++){O[S].innerHTML=(++g);
Z.setDate(Z.getDate()+1);
D[S].className="x-date-nextday";
I(this,D[S])
}this.mbtn.setText(this.monthNames[c.getMonth()]+" "+c.getFullYear());
if(!this.internalRender){var G=this.el.dom.firstChild,K=G.offsetWidth;
this.el.setWidth(K+this.el.getBorderWidth("lr"));
CQ.Ext.fly(G).setWidth(K);
this.internalRender=true;
if(CQ.Ext.isOpera&&!this.secondPass){G.rows[0].cells[1].style.width=(K-(G.rows[0].cells[0].offsetWidth+G.rows[0].cells[2].offsetWidth))+"px";
this.secondPass=true;
this.update.defer(10,this,[c])
}}}},beforeDestroy:function(){if(this.rendered){CQ.Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);
delete this.textNodes;
delete this.cells.elements
}}});
CQ.Ext.reg("datepicker",CQ.Ext.DatePicker);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.LoadMask=function(C,B){this.el=CQ.Ext.get(C);
CQ.Ext.apply(this,B);
if(this.store){this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.onLoad});
this.removeMask=CQ.Ext.value(this.removeMask,false)
}else{var A=this.el.getUpdater();
A.showLoadIndicator=false;
A.on({scope:this,beforeupdate:this.onBeforeLoad,update:this.onLoad,failure:this.onLoad});
this.removeMask=CQ.Ext.value(this.removeMask,true)
}};
CQ.Ext.LoadMask.prototype={msg:"Loading...",msgCls:"x-mask-loading",disabled:false,disable:function(){this.disabled=true
},enable:function(){this.disabled=false
},onLoad:function(){this.el.unmask(this.removeMask)
},onBeforeLoad:function(){if(!this.disabled){this.el.mask(this.msg,this.msgCls)
}},show:function(){this.onBeforeLoad()
},hide:function(){this.onLoad()
},destroy:function(){if(this.store){this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.onLoad,this)
}else{var A=this.el.getUpdater();
A.un("beforeupdate",this.onBeforeLoad,this);
A.un("update",this.onLoad,this);
A.un("failure",this.onLoad,this)
}}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Slider=CQ.Ext.extend(CQ.Ext.BoxComponent,{vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,initComponent:function(){if(!CQ.Ext.isDefined(this.value)){this.value=this.minValue
}CQ.Ext.Slider.superclass.initComponent.call(this);
this.keyIncrement=Math.max(this.increment,this.keyIncrement);
this.addEvents("beforechange","change","changecomplete","dragstart","drag","dragend");
if(this.vertical){CQ.Ext.apply(this,CQ.Ext.Slider.Vertical)
}},onRender:function(){this.autoEl={cls:"x-slider "+(this.vertical?"x-slider-vert":"x-slider-horz"),cn:{cls:"x-slider-end",cn:{cls:"x-slider-inner",cn:[{cls:"x-slider-thumb"},{tag:"a",cls:"x-slider-focus",href:"#",tabIndex:"-1",hidefocus:"on"}]}}};
CQ.Ext.Slider.superclass.onRender.apply(this,arguments);
this.endEl=this.el.first();
this.innerEl=this.endEl.first();
this.thumb=this.innerEl.first();
this.halfThumb=(this.vertical?this.thumb.getHeight():this.thumb.getWidth())/2;
this.focusEl=this.thumb.next();
this.initEvents()
},initEvents:function(){this.thumb.addClassOnOver("x-slider-thumb-over");
this.mon(this.el,{scope:this,mousedown:this.onMouseDown,keydown:this.onKeyDown});
this.focusEl.swallowEvent("click",true);
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeDragStart.createDelegate(this),onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(this.thumb)
},onMouseDown:function(B){if(this.disabled){return 
}if(this.clickToChange&&B.target!=this.thumb.dom){var A=this.innerEl.translatePoints(B.getXY());
this.onClickChange(A)
}this.focus()
},onClickChange:function(A){if(A.top>this.clickRange[0]&&A.top<this.clickRange[1]){this.setValue(CQ.Ext.util.Format.round(this.reverseValue(A.left),this.decimalPrecision),undefined,true)
}},onKeyDown:function(B){if(this.disabled){B.preventDefault();
return 
}var A=B.getKey();
switch(A){case B.UP:case B.RIGHT:B.stopEvent();
if(B.ctrlKey){this.setValue(this.maxValue,undefined,true)
}else{this.setValue(this.value+this.keyIncrement,undefined,true)
}break;
case B.DOWN:case B.LEFT:B.stopEvent();
if(B.ctrlKey){this.setValue(this.minValue,undefined,true)
}else{this.setValue(this.value-this.keyIncrement,undefined,true)
}break;
default:B.preventDefault()
}},doSnap:function(B){if(!(this.increment&&B)){return B
}var D=B,C=this.increment,A=B%C;
if(A!=0){D-=A;
if(A*2>C){D+=C
}else{if(A*2<-C){D-=C
}}}return D.constrain(this.minValue,this.maxValue)
},afterRender:function(){CQ.Ext.Slider.superclass.afterRender.apply(this,arguments);
if(this.value!==undefined){var A=this.normalizeValue(this.value);
if(A!==this.value){delete this.value;
this.setValue(A,false)
}else{this.moveThumb(this.translateValue(A),false)
}}},getRatio:function(){var A=this.innerEl.getWidth(),B=this.maxValue-this.minValue;
return B==0?A:(A/B)
},normalizeValue:function(A){A=this.doSnap(A);
A=CQ.Ext.util.Format.round(A,this.decimalPrecision);
A=A.constrain(this.minValue,this.maxValue);
return A
},setMinValue:function(A){this.minValue=A;
this.syncThumb();
if(this.value<A){this.setValue(A)
}},setMaxValue:function(A){this.maxValue=A;
this.syncThumb();
if(this.value>A){this.setValue(A)
}},setValue:function(B,A,C){B=this.normalizeValue(B);
if(B!==this.value&&this.fireEvent("beforechange",this,B,this.value)!==false){this.value=B;
this.moveThumb(this.translateValue(B),A!==false);
this.fireEvent("change",this,B);
if(C){this.fireEvent("changecomplete",this,B)
}}},translateValue:function(A){var B=this.getRatio();
return(A*B)-(this.minValue*B)-this.halfThumb
},reverseValue:function(B){var A=this.getRatio();
return(B+(this.minValue*A))/A
},moveThumb:function(B,A){if(!A||this.animate===false){this.thumb.setLeft(B)
}else{this.thumb.shift({left:B,stopFx:true,duration:0.35})
}},focus:function(){this.focusEl.focus(10)
},onBeforeDragStart:function(A){return !this.disabled
},onDragStart:function(A){this.thumb.addClass("x-slider-thumb-drag");
this.dragging=true;
this.dragStartValue=this.value;
this.fireEvent("dragstart",this,A)
},onDrag:function(A){var B=this.innerEl.translatePoints(this.tracker.getXY());
this.setValue(CQ.Ext.util.Format.round(this.reverseValue(B.left),this.decimalPrecision),false);
this.fireEvent("drag",this,A)
},onDragEnd:function(A){this.thumb.removeClass("x-slider-thumb-drag");
this.dragging=false;
this.fireEvent("dragend",this,A);
if(this.dragStartValue!=this.value){this.fireEvent("changecomplete",this,this.value)
}},onResize:function(A,B){this.innerEl.setWidth(A-(this.el.getPadding("l")+this.endEl.getPadding("r")));
this.syncThumb();
CQ.Ext.Slider.superclass.onResize.apply(this,arguments)
},onDisable:function(){CQ.Ext.Slider.superclass.onDisable.call(this);
this.thumb.addClass(this.disabledClass);
if(CQ.Ext.isIE){var A=this.thumb.getXY();
this.thumb.hide();
this.innerEl.addClass(this.disabledClass).dom.disabled=true;
if(!this.thumbHolder){this.thumbHolder=this.endEl.createChild({cls:"x-slider-thumb "+this.disabledClass})
}this.thumbHolder.show().setXY(A)
}},onEnable:function(){CQ.Ext.Slider.superclass.onEnable.call(this);
this.thumb.removeClass(this.disabledClass);
if(CQ.Ext.isIE){this.innerEl.removeClass(this.disabledClass).dom.disabled=false;
if(this.thumbHolder){this.thumbHolder.hide()
}this.thumb.show();
this.syncThumb()
}},syncThumb:function(){if(this.rendered){this.moveThumb(this.translateValue(this.value))
}},getValue:function(){return this.value
},beforeDestroy:function(){CQ.Ext.destroyMembers(this,"endEl","innerEl","thumb","halfThumb","focusEl","tracker","thumbHolder");
CQ.Ext.Slider.superclass.beforeDestroy.call(this)
}});
CQ.Ext.reg("slider",CQ.Ext.Slider);
CQ.Ext.Slider.Vertical={onResize:function(A,B){this.innerEl.setHeight(B-(this.el.getPadding("t")+this.endEl.getPadding("b")));
this.syncThumb()
},getRatio:function(){var B=this.innerEl.getHeight(),A=this.maxValue-this.minValue;
return B/A
},moveThumb:function(B,A){if(!A||this.animate===false){this.thumb.setBottom(B)
}else{this.thumb.shift({bottom:B,stopFx:true,duration:0.35})
}},onDrag:function(B){var C=this.innerEl.translatePoints(this.tracker.getXY()),A=this.innerEl.getHeight()-C.top;
this.setValue(this.minValue+CQ.Ext.util.Format.round(A/this.getRatio(),this.decimalPrecision),false);
this.fireEvent("drag",this,B)
},onClickChange:function(B){if(B.left>this.clickRange[0]&&B.left<this.clickRange[1]){var A=this.innerEl.getHeight()-B.top;
this.setValue(this.minValue+CQ.Ext.util.Format.round(A/this.getRatio(),this.decimalPrecision),undefined,true)
}}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ProgressBar=CQ.Ext.extend(CQ.Ext.BoxComponent,{baseCls:"x-progress",animate:false,waitTimer:null,initComponent:function(){CQ.Ext.ProgressBar.superclass.initComponent.call(this);
this.addEvents("update")
},onRender:function(D,A){var C=new CQ.Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">',"<div>&#160;</div>","</div>","</div>",'<div class="{cls}-text {cls}-text-back">',"<div>&#160;</div>","</div>","</div>","</div>");
this.el=A?C.insertBefore(A,{cls:this.baseCls},true):C.append(D,{cls:this.baseCls},true);
if(this.id){this.el.dom.id=this.id
}var B=this.el.dom.firstChild;
this.progressBar=CQ.Ext.get(B.firstChild);
if(this.textEl){this.textEl=CQ.Ext.get(this.textEl);
delete this.textTopEl
}else{this.textTopEl=CQ.Ext.get(this.progressBar.dom.firstChild);
var E=CQ.Ext.get(B.childNodes[1]);
this.textTopEl.setStyle("z-index",99).addClass("x-hidden");
this.textEl=new CQ.Ext.CompositeElement([this.textTopEl.dom.firstChild,E.dom.firstChild]);
this.textEl.setWidth(B.offsetWidth)
}this.progressBar.setHeight(B.offsetHeight)
},afterRender:function(){CQ.Ext.ProgressBar.superclass.afterRender.call(this);
if(this.value){this.updateProgress(this.value,this.text)
}else{this.updateText(this.text)
}},updateProgress:function(C,D,B){this.value=C||0;
if(D){this.updateText(D)
}if(this.rendered&&!this.isDestroyed){var A=Math.floor(C*this.el.dom.firstChild.offsetWidth);
this.progressBar.setWidth(A,B===true||(B!==false&&this.animate));
if(this.textTopEl){this.textTopEl.removeClass("x-hidden").setWidth(A)
}}this.fireEvent("update",this,C,D);
return this
},wait:function(B){if(!this.waitTimer){var A=this;
B=B||{};
this.updateText(B.text);
this.waitTimer=CQ.Ext.TaskMgr.start({run:function(C){var D=B.increment||10;
C-=1;
this.updateProgress(((((C+D)%D)+1)*(100/D))*0.01,null,B.animate)
},interval:B.interval||1000,duration:B.duration,onStop:function(){if(B.fn){B.fn.apply(B.scope||this)
}this.reset()
},scope:A})
}return this
},isWaiting:function(){return this.waitTimer!==null
},updateText:function(A){this.text=A||"&#160;";
if(this.rendered){this.textEl.update(this.text)
}return this
},syncProgressBar:function(){if(this.value){this.updateProgress(this.value,this.text)
}return this
},setSize:function(A,C){CQ.Ext.ProgressBar.superclass.setSize.call(this,A,C);
if(this.textTopEl){var B=this.el.dom.firstChild;
this.textEl.setSize(B.offsetWidth,B.offsetHeight)
}this.syncProgressBar();
return this
},reset:function(A){this.updateProgress(0);
if(this.textTopEl){this.textTopEl.addClass("x-hidden")
}this.clearTimer();
if(A===true){this.hide()
}return this
},clearTimer:function(){if(this.waitTimer){this.waitTimer.onStop=null;
CQ.Ext.TaskMgr.stop(this.waitTimer);
this.waitTimer=null
}},onDestroy:function(){this.clearTimer();
if(this.rendered){if(this.textEl.isComposite){this.textEl.clear()
}CQ.Ext.destroyMembers(this,"textEl","progressBar","textTopEl")
}CQ.Ext.ProgressBar.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("progress",CQ.Ext.ProgressBar);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var A=CQ.Ext.EventManager;
var B=CQ.Ext.lib.Dom;
CQ.Ext.dd.DragDrop=function(E,C,D){if(E){this.init(E,C,D)
}};
CQ.Ext.dd.DragDrop.prototype={id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true
},moveOnly:false,unlock:function(){this.locked=false
},isTarget:true,padding:null,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,b4StartDrag:function(C,D){},startDrag:function(C,D){},b4Drag:function(C){},onDrag:function(C){},onDragEnter:function(C,D){},b4DragOver:function(C){},onDragOver:function(C,D){},b4DragOut:function(C){},onDragOut:function(C,D){},b4DragDrop:function(C){},onDragDrop:function(C,D){},onInvalidDrop:function(C){},b4EndDrag:function(C){},endDrag:function(C){},b4MouseDown:function(C){},onMouseDown:function(C){},onMouseUp:function(C){},onAvailable:function(){},defaultPadding:{left:0,right:0,top:0,bottom:0},constrainTo:function(H,F,M){if(CQ.Ext.isNumber(F)){F={left:F,right:F,top:F,bottom:F}
}F=F||this.defaultPadding;
var J=CQ.Ext.get(this.getEl()).getBox(),C=CQ.Ext.get(H),L=C.getScroll(),I,D=C.dom;
if(D==document.body){I={x:L.left,y:L.top,width:CQ.Ext.lib.Dom.getViewWidth(),height:CQ.Ext.lib.Dom.getViewHeight()}
}else{var K=C.getXY();
I={x:K[0],y:K[1],width:D.clientWidth,height:D.clientHeight}
}var G=J.y-I.y,E=J.x-I.x;
this.resetConstraints();
this.setXConstraint(E-(F.left||0),I.width-E-J.width-(F.right||0),this.xTickSize);
this.setYConstraint(G-(F.top||0),I.height-G-J.height-(F.bottom||0),this.yTickSize)
},getEl:function(){if(!this._domRef){this._domRef=CQ.Ext.getDom(this.id)
}return this._domRef
},getDragEl:function(){return CQ.Ext.getDom(this.dragElId)
},init:function(E,C,D){this.initTarget(E,C,D);
A.on(this.id,"mousedown",this.handleMouseDown,this)
},initTarget:function(E,C,D){this.config=D||{};
this.DDM=CQ.Ext.dd.DDM;
this.groups={};
if(typeof E!=="string"){E=CQ.Ext.id(E)
}this.id=E;
this.addToGroup((C)?C:"default");
this.handleElId=E;
this.setDragElId(E);
this.invalidHandleTypes={A:"A"};
this.invalidHandleIds={};
this.invalidHandleClasses=[];
this.applyConfig();
this.handleOnAvailable()
},applyConfig:function(){this.padding=this.config.padding||[0,0,0,0];
this.isTarget=(this.config.isTarget!==false);
this.maintainOffset=(this.config.maintainOffset);
this.primaryButtonOnly=(this.config.primaryButtonOnly!==false)
},handleOnAvailable:function(){this.available=true;
this.resetConstraints();
this.onAvailable()
},setPadding:function(E,C,F,D){if(!C&&0!==C){this.padding=[E,E,E,E]
}else{if(!F&&0!==F){this.padding=[E,C,E,C]
}else{this.padding=[E,C,F,D]
}}},setInitPosition:function(F,E){var G=this.getEl();
if(!this.DDM.verifyEl(G)){return 
}var D=F||0;
var C=E||0;
var H=B.getXY(G);
this.initPageX=H[0]-D;
this.initPageY=H[1]-C;
this.lastPageX=H[0];
this.lastPageY=H[1];
this.setStartPosition(H)
},setStartPosition:function(D){var C=D||B.getXY(this.getEl());
this.deltaSetXY=null;
this.startPageX=C[0];
this.startPageY=C[1]
},addToGroup:function(C){this.groups[C]=true;
this.DDM.regDragDrop(this,C)
},removeFromGroup:function(C){if(this.groups[C]){delete this.groups[C]
}this.DDM.removeDDFromGroup(this,C)
},setDragElId:function(C){this.dragElId=C
},setHandleElId:function(C){if(typeof C!=="string"){C=CQ.Ext.id(C)
}this.handleElId=C;
this.DDM.regHandle(this.id,C)
},setOuterHandleElId:function(C){if(typeof C!=="string"){C=CQ.Ext.id(C)
}A.on(C,"mousedown",this.handleMouseDown,this);
this.setHandleElId(C);
this.hasOuterHandles=true
},unreg:function(){A.un(this.id,"mousedown",this.handleMouseDown);
this._domRef=null;
this.DDM._remove(this)
},destroy:function(){this.unreg()
},isLocked:function(){return(this.DDM.isLocked()||this.locked)
},handleMouseDown:function(E,D){if(this.primaryButtonOnly&&E.button!=0){return 
}if(this.isLocked()){return 
}this.DDM.refreshCache(this.groups);
var C=new CQ.Ext.lib.Point(CQ.Ext.lib.Event.getPageX(E),CQ.Ext.lib.Event.getPageY(E));
if(!this.hasOuterHandles&&!this.DDM.isOverTarget(C,this)){}else{if(this.clickValidator(E)){this.setStartPosition();
this.b4MouseDown(E);
this.onMouseDown(E);
this.DDM.handleMouseDown(E,this);
this.DDM.stopEvent(E)
}else{}}},clickValidator:function(D){var C=D.getTarget();
return(this.isValidHandleChild(C)&&(this.id==this.handleElId||this.DDM.handleWasClicked(C,this.id)))
},addInvalidHandleType:function(C){var D=C.toUpperCase();
this.invalidHandleTypes[D]=D
},addInvalidHandleId:function(C){if(typeof C!=="string"){C=CQ.Ext.id(C)
}this.invalidHandleIds[C]=C
},addInvalidHandleClass:function(C){this.invalidHandleClasses.push(C)
},removeInvalidHandleType:function(C){var D=C.toUpperCase();
delete this.invalidHandleTypes[D]
},removeInvalidHandleId:function(C){if(typeof C!=="string"){C=CQ.Ext.id(C)
}delete this.invalidHandleIds[C]
},removeInvalidHandleClass:function(D){for(var E=0,C=this.invalidHandleClasses.length;
E<C;
++E){if(this.invalidHandleClasses[E]==D){delete this.invalidHandleClasses[E]
}}},isValidHandleChild:function(F){var E=true;
var H;
try{H=F.nodeName.toUpperCase()
}catch(G){H=F.nodeName
}E=E&&!this.invalidHandleTypes[H];
E=E&&!this.invalidHandleIds[F.id];
for(var D=0,C=this.invalidHandleClasses.length;
E&&D<C;
++D){E=!CQ.Ext.fly(F).hasClass(this.invalidHandleClasses[D])
}return E
},setXTicks:function(F,C){this.xTicks=[];
this.xTickSize=C;
var E={};
for(var D=this.initPageX;
D>=this.minX;
D=D-C){if(!E[D]){this.xTicks[this.xTicks.length]=D;
E[D]=true
}}for(D=this.initPageX;
D<=this.maxX;
D=D+C){if(!E[D]){this.xTicks[this.xTicks.length]=D;
E[D]=true
}}this.xTicks.sort(this.DDM.numericSort)
},setYTicks:function(F,C){this.yTicks=[];
this.yTickSize=C;
var E={};
for(var D=this.initPageY;
D>=this.minY;
D=D-C){if(!E[D]){this.yTicks[this.yTicks.length]=D;
E[D]=true
}}for(D=this.initPageY;
D<=this.maxY;
D=D+C){if(!E[D]){this.yTicks[this.yTicks.length]=D;
E[D]=true
}}this.yTicks.sort(this.DDM.numericSort)
},setXConstraint:function(E,D,C){this.leftConstraint=E;
this.rightConstraint=D;
this.minX=this.initPageX-E;
this.maxX=this.initPageX+D;
if(C){this.setXTicks(this.initPageX,C)
}this.constrainX=true
},clearConstraints:function(){this.constrainX=false;
this.constrainY=false;
this.clearTicks()
},clearTicks:function(){this.xTicks=null;
this.yTicks=null;
this.xTickSize=0;
this.yTickSize=0
},setYConstraint:function(C,E,D){this.topConstraint=C;
this.bottomConstraint=E;
this.minY=this.initPageY-C;
this.maxY=this.initPageY+E;
if(D){this.setYTicks(this.initPageY,D)
}this.constrainY=true
},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var D=(this.maintainOffset)?this.lastPageX-this.initPageX:0;
var C=(this.maintainOffset)?this.lastPageY-this.initPageY:0;
this.setInitPosition(D,C)
}else{this.setInitPosition()
}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize)
}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)
}},getTick:function(I,F){if(!F){return I
}else{if(F[0]>=I){return F[0]
}else{for(var D=0,C=F.length;
D<C;
++D){var E=D+1;
if(F[E]&&F[E]>=I){var H=I-F[D];
var G=F[E]-I;
return(G>H)?F[D]:F[E]
}}return F[F.length-1]
}}},toString:function(){return("DragDrop "+this.id)
}}
})();
if(!CQ.Ext.dd.DragDropMgr){CQ.Ext.dd.DragDropMgr=function(){var A=CQ.Ext.EventManager;
return{ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,init:function(){this.initialized=true
},POINT:0,INTERSECT:1,mode:0,_execOnAll:function(D,C){for(var E in this.ids){for(var B in this.ids[E]){var F=this.ids[E][B];
if(!this.isTypeOfDD(F)){continue
}F[D].apply(F,C)
}}},_onLoad:function(){this.init();
A.on(document,"mouseup",this.handleMouseUp,this,true);
A.on(document,"mousemove",this.handleMouseMove,this,true);
A.on(window,"unload",this._onUnload,this,true);
A.on(window,"resize",this._onResize,this,true)
},_onResize:function(B){this._execOnAll("resetConstraints",[])
},lock:function(){this.locked=true
},unlock:function(){this.locked=false
},isLocked:function(){return this.locked
},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:350,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,regDragDrop:function(C,B){if(!this.initialized){this.init()
}if(!this.ids[B]){this.ids[B]={}
}this.ids[B][C.id]=C
},removeDDFromGroup:function(D,B){if(!this.ids[B]){this.ids[B]={}
}var C=this.ids[B];
if(C&&C[D.id]){delete C[D.id]
}},_remove:function(C){for(var B in C.groups){if(B&&this.ids[B]&&this.ids[B][C.id]){delete this.ids[B][C.id]
}}delete this.handleIds[C.id]
},regHandle:function(C,B){if(!this.handleIds[C]){this.handleIds[C]={}
}this.handleIds[C][B]=B
},isDragDrop:function(B){return(this.getDDById(B))?true:false
},getRelated:function(G,C){var F=[];
for(var E in G.groups){for(var D in this.ids[E]){var B=this.ids[E][D];
if(!this.isTypeOfDD(B)){continue
}if(!C||B.isTarget){F[F.length]=B
}}}return F
},isLegalTarget:function(F,E){var C=this.getRelated(F,true);
for(var D=0,B=C.length;
D<B;
++D){if(C[D].id==E.id){return true
}}return false
},isTypeOfDD:function(B){return(B&&B.__ygDragDrop)
},isHandle:function(C,B){return(this.handleIds[C]&&this.handleIds[C][B])
},getDDById:function(C){for(var B in this.ids){if(this.ids[B][C]){return this.ids[B][C]
}}return null
},handleMouseDown:function(D,C){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.disable()
}if(this.dragCurrent){this.handleMouseUp(D)
}this.currentTarget=D.getTarget();
this.dragCurrent=C;
var B=C.getEl();
this.startX=D.getPageX();
this.startY=D.getPageY();
this.deltaX=this.startX-B.offsetLeft;
this.deltaY=this.startY-B.offsetTop;
this.dragThreshMet=false;
this.clickTimeout=setTimeout(function(){var E=CQ.Ext.dd.DDM;
E.startDrag(E.startX,E.startY)
},this.clickTimeThresh)
},startDrag:function(B,C){clearTimeout(this.clickTimeout);
if(this.dragCurrent){this.dragCurrent.b4StartDrag(B,C);
this.dragCurrent.startDrag(B,C)
}this.dragThreshMet=true
},handleMouseUp:function(B){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}if(!this.dragCurrent){return 
}clearTimeout(this.clickTimeout);
if(this.dragThreshMet){this.fireEvents(B,true)
}else{}this.stopDrag(B);
this.stopEvent(B)
},stopEvent:function(B){if(this.stopPropagation){B.stopPropagation()
}if(this.preventDefault){B.preventDefault()
}},stopDrag:function(B){if(this.dragCurrent){if(this.dragThreshMet){this.dragCurrent.b4EndDrag(B);
this.dragCurrent.endDrag(B)
}this.dragCurrent.onMouseUp(B)
}this.dragCurrent=null;
this.dragOvers={}
},handleMouseMove:function(D){if(!this.dragCurrent){return true
}if(CQ.Ext.isIE&&(D.button!==0&&D.button!==1&&D.button!==2)){this.stopEvent(D);
return this.handleMouseUp(D)
}if(!this.dragThreshMet){var C=Math.abs(this.startX-D.getPageX());
var B=Math.abs(this.startY-D.getPageY());
if(C>this.clickPixelThresh||B>this.clickPixelThresh){this.startDrag(this.startX,this.startY)
}}if(this.dragThreshMet){this.dragCurrent.b4Drag(D);
this.dragCurrent.onDrag(D);
if(!this.dragCurrent.moveOnly){this.fireEvents(D,false)
}}this.stopEvent(D);
return true
},fireEvents:function(K,L){var N=this.dragCurrent;
if(!N||N.isLocked()){return 
}var O=K.getPoint();
var B=[];
var E=[];
var I=[];
var G=[];
var D=[];
for(var F in this.dragOvers){var C=this.dragOvers[F];
if(!this.isTypeOfDD(C)){continue
}if(!this.isOverTarget(O,C,this.mode)){E.push(C)
}B[F]=true;
delete this.dragOvers[F]
}for(var M in N.groups){if("string"!=typeof M){continue
}for(F in this.ids[M]){var H=this.ids[M][F];
if(!this.isTypeOfDD(H)){continue
}if(H.isTarget&&!H.isLocked()&&((H!=N)||(N.ignoreSelf===false))){if(this.isOverTarget(O,H,this.mode)){if(L){G.push(H)
}else{if(!B[H.id]){D.push(H)
}else{I.push(H)
}this.dragOvers[H.id]=H
}}}}}if(this.mode){if(E.length){N.b4DragOut(K,E);
N.onDragOut(K,E)
}if(D.length){N.onDragEnter(K,D)
}if(I.length){N.b4DragOver(K,I);
N.onDragOver(K,I)
}if(G.length){N.b4DragDrop(K,G);
N.onDragDrop(K,G)
}}else{var J=0;
for(F=0,J=E.length;
F<J;
++F){N.b4DragOut(K,E[F].id);
N.onDragOut(K,E[F].id)
}for(F=0,J=D.length;
F<J;
++F){N.onDragEnter(K,D[F].id)
}for(F=0,J=I.length;
F<J;
++F){N.b4DragOver(K,I[F].id);
N.onDragOver(K,I[F].id)
}for(F=0,J=G.length;
F<J;
++F){N.b4DragDrop(K,G[F].id);
N.onDragDrop(K,G[F].id)
}}if(L&&!G.length){N.onInvalidDrop(K)
}},getBestMatch:function(D){var F=null;
var C=D.length;
if(C==1){F=D[0]
}else{for(var E=0;
E<C;
++E){var B=D[E];
if(B.cursorIsOver){F=B;
break
}else{if(!F||F.overlap.getArea()<B.overlap.getArea()){F=B
}}}}return F
},refreshCache:function(C){for(var B in C){if("string"!=typeof B){continue
}for(var D in this.ids[B]){var E=this.ids[B][D];
if(this.isTypeOfDD(E)){var F=this.getLocation(E);
if(F){this.locationCache[E.id]=F
}else{delete this.locationCache[E.id]
}}}}},verifyEl:function(C){if(C){var B;
if(CQ.Ext.isIE){try{B=C.offsetParent
}catch(D){}}else{B=C.offsetParent
}if(B){return true
}}return false
},getLocation:function(G){if(!this.isTypeOfDD(G)){return null
}var E=G.getEl(),J,D,C,L,K,M,B,I,F;
try{J=CQ.Ext.lib.Dom.getXY(E)
}catch(H){}if(!J){return null
}D=J[0];
C=D+E.offsetWidth;
L=J[1];
K=L+E.offsetHeight;
M=L-G.padding[0];
B=C+G.padding[1];
I=K+G.padding[2];
F=D-G.padding[3];
return new CQ.Ext.lib.Region(M,B,I,F)
},isOverTarget:function(J,B,D){var F=this.locationCache[B.id];
if(!F||!this.useCache){F=this.getLocation(B);
this.locationCache[B.id]=F
}if(!F){return false
}B.cursorIsOver=F.contains(J);
var I=this.dragCurrent;
if(!I||!I.getTargetCoord||(!D&&!I.constrainX&&!I.constrainY)){return B.cursorIsOver
}B.overlap=null;
var G=I.getTargetCoord(J.x,J.y);
var C=I.getDragEl();
var E=new CQ.Ext.lib.Region(G.y,G.x+C.offsetWidth,G.y+C.offsetHeight,G.x);
var H=E.intersect(F);
if(H){B.overlap=H;
return(D)?true:B.cursorIsOver
}else{return false
}},_onUnload:function(C,B){CQ.Ext.dd.DragDropMgr.unregAll()
},unregAll:function(){if(this.dragCurrent){this.stopDrag();
this.dragCurrent=null
}this._execOnAll("unreg",[]);
for(var B in this.elementCache){delete this.elementCache[B]
}this.elementCache={};
this.ids={}
},elementCache:{},getElWrapper:function(C){var B=this.elementCache[C];
if(!B||!B.el){B=this.elementCache[C]=new this.ElementWrapper(CQ.Ext.getDom(C))
}return B
},getElement:function(B){return CQ.Ext.getDom(B)
},getCss:function(C){var B=CQ.Ext.getDom(C);
return(B)?B.style:null
},ElementWrapper:function(B){this.el=B||null;
this.id=this.el&&B.id;
this.css=this.el&&B.style
},getPosX:function(B){return CQ.Ext.lib.Dom.getX(B)
},getPosY:function(B){return CQ.Ext.lib.Dom.getY(B)
},swapNode:function(D,B){if(D.swapNode){D.swapNode(B)
}else{var E=B.parentNode;
var C=B.nextSibling;
if(C==D){E.insertBefore(D,B)
}else{if(B==D.nextSibling){E.insertBefore(B,D)
}else{D.parentNode.replaceChild(B,D);
E.insertBefore(D,C)
}}}},getScroll:function(){var D,B,E=document.documentElement,C=document.body;
if(E&&(E.scrollTop||E.scrollLeft)){D=E.scrollTop;
B=E.scrollLeft
}else{if(C){D=C.scrollTop;
B=C.scrollLeft
}else{}}return{top:D,left:B}
},getStyle:function(C,B){return CQ.Ext.fly(C).getStyle(B)
},getScrollTop:function(){return this.getScroll().top
},getScrollLeft:function(){return this.getScroll().left
},moveToEl:function(B,D){var C=CQ.Ext.lib.Dom.getXY(D);
CQ.Ext.lib.Dom.setXY(B,C)
},numericSort:function(C,B){return(C-B)
},_timeoutCount:0,_addListeners:function(){var B=CQ.Ext.dd.DDM;
if(CQ.Ext.lib.Event&&document){B._onLoad()
}else{if(B._timeoutCount>2000){}else{setTimeout(B._addListeners,10);
if(document&&document.body){B._timeoutCount+=1
}}}},handleWasClicked:function(B,D){if(this.isHandle(D,B.id)){return true
}else{var C=B.parentNode;
while(C){if(this.isHandle(D,C.id)){return true
}else{C=C.parentNode
}}}return false
}}
}();
CQ.Ext.dd.DDM=CQ.Ext.dd.DragDropMgr;
CQ.Ext.dd.DDM._addListeners()
}CQ.Ext.dd.DD=function(C,A,B){if(C){this.init(C,A,B)
}};
CQ.Ext.extend(CQ.Ext.dd.DD,CQ.Ext.dd.DragDrop,{scroll:true,autoOffset:function(C,B){var A=C-this.startPageX;
var D=B-this.startPageY;
this.setDelta(A,D)
},setDelta:function(B,A){this.deltaX=B;
this.deltaY=A
},setDragElPos:function(C,B){var A=this.getDragEl();
this.alignElWithMouse(A,C,B)
},alignElWithMouse:function(C,G,F){var E=this.getTargetCoord(G,F);
var B=C.dom?C:CQ.Ext.fly(C,"_dd");
if(!this.deltaSetXY){var H=[E.x,E.y];
B.setXY(H);
var D=B.getLeft(true);
var A=B.getTop(true);
this.deltaSetXY=[D-E.x,A-E.y]
}else{B.setLeftTop(E.x+this.deltaSetXY[0],E.y+this.deltaSetXY[1])
}this.cachePosition(E.x,E.y);
this.autoScroll(E.x,E.y,C.offsetHeight,C.offsetWidth);
return E
},cachePosition:function(B,A){if(B){this.lastPageX=B;
this.lastPageY=A
}else{var C=CQ.Ext.lib.Dom.getXY(this.getEl());
this.lastPageX=C[0];
this.lastPageY=C[1]
}},autoScroll:function(J,I,E,K){if(this.scroll){var L=CQ.Ext.lib.Dom.getViewHeight();
var B=CQ.Ext.lib.Dom.getViewWidth();
var N=this.DDM.getScrollTop();
var D=this.DDM.getScrollLeft();
var H=E+I;
var M=K+J;
var G=(L+N-I-this.deltaY);
var F=(B+D-J-this.deltaX);
var C=40;
var A=(document.all)?80:30;
if(H>L&&G<C){window.scrollTo(D,N+A)
}if(I<N&&N>0&&I-N<C){window.scrollTo(D,N-A)
}if(M>B&&F<C){window.scrollTo(D+A,N)
}if(J<D&&D>0&&J-D<C){window.scrollTo(D-A,N)
}}},getTargetCoord:function(C,B){var A=C-this.deltaX;
var D=B-this.deltaY;
if(this.constrainX){if(A<this.minX){A=this.minX
}if(A>this.maxX){A=this.maxX
}}if(this.constrainY){if(D<this.minY){D=this.minY
}if(D>this.maxY){D=this.maxY
}}A=this.getTick(A,this.xTicks);
D=this.getTick(D,this.yTicks);
return{x:A,y:D}
},applyConfig:function(){CQ.Ext.dd.DD.superclass.applyConfig.call(this);
this.scroll=(this.config.scroll!==false)
},b4MouseDown:function(A){this.autoOffset(A.getPageX(),A.getPageY())
},b4Drag:function(A){this.setDragElPos(A.getPageX(),A.getPageY())
},toString:function(){return("DD "+this.id)
}});
CQ.Ext.dd.DDProxy=function(C,A,B){if(C){this.init(C,A,B);
this.initFrame()
}};
CQ.Ext.dd.DDProxy.dragElId="ygddfdiv";
CQ.Ext.extend(CQ.Ext.dd.DDProxy,CQ.Ext.dd.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var B=this;
var A=document.body;
if(!A||!A.firstChild){setTimeout(function(){B.createFrame()
},50);
return 
}var D=this.getDragEl();
if(!D){D=document.createElement("div");
D.id=this.dragElId;
var C=D.style;
C.position="absolute";
C.visibility="hidden";
C.cursor="move";
C.border="2px solid #aaa";
C.zIndex=999;
CQ.Ext.DomHelper.insertFirst(CQ.Util.getRoot(),D)
}},initFrame:function(){this.createFrame()
},applyConfig:function(){CQ.Ext.dd.DDProxy.superclass.applyConfig.call(this);
this.resizeFrame=(this.config.resizeFrame!==false);
this.centerFrame=(this.config.centerFrame);
this.setDragElId(this.config.dragElId||CQ.Ext.dd.DDProxy.dragElId)
},showFrame:function(E,D){var C=this.getEl();
var A=this.getDragEl();
var B=A.style;
this._resizeProxy();
if(this.centerFrame){this.setDelta(Math.round(parseInt(B.width,10)/2),Math.round(parseInt(B.height,10)/2))
}this.setDragElPos(E,D);
CQ.Ext.fly(A).show()
},_resizeProxy:function(){if(this.resizeFrame){var A=this.getEl();
CQ.Ext.fly(this.getDragEl()).setSize(A.offsetWidth,A.offsetHeight)
}},b4MouseDown:function(B){var A=B.getPageX();
var C=B.getPageY();
this.autoOffset(A,C);
this.setDragElPos(A,C)
},b4StartDrag:function(A,B){this.showFrame(A,B)
},b4EndDrag:function(A){CQ.Ext.fly(this.getDragEl()).hide()
},endDrag:function(C){var B=this.getEl();
var A=this.getDragEl();
A.style.visibility="";
this.beforeMove();
B.style.visibility="hidden";
CQ.Ext.dd.DDM.moveToEl(B,A);
A.style.visibility="hidden";
B.style.visibility="";
this.afterDrag()
},beforeMove:function(){},afterDrag:function(){},toString:function(){return("DDProxy "+this.id)
}});
CQ.Ext.dd.DDTarget=function(C,A,B){if(C){this.initTarget(C,A,B)
}};
CQ.Ext.extend(CQ.Ext.dd.DDTarget,CQ.Ext.dd.DragDrop,{getDragEl:CQ.Ext.emptyFn,isValidHandleChild:CQ.Ext.emptyFn,startDrag:CQ.Ext.emptyFn,endDrag:CQ.Ext.emptyFn,onDrag:CQ.Ext.emptyFn,onDragDrop:CQ.Ext.emptyFn,onDragEnter:CQ.Ext.emptyFn,onDragOut:CQ.Ext.emptyFn,onDragOver:CQ.Ext.emptyFn,onInvalidDrop:CQ.Ext.emptyFn,onMouseDown:CQ.Ext.emptyFn,onMouseUp:CQ.Ext.emptyFn,setXConstraint:CQ.Ext.emptyFn,setYConstraint:CQ.Ext.emptyFn,resetConstraints:CQ.Ext.emptyFn,clearConstraints:CQ.Ext.emptyFn,clearTicks:CQ.Ext.emptyFn,setInitPosition:CQ.Ext.emptyFn,setDragElId:CQ.Ext.emptyFn,setHandleElId:CQ.Ext.emptyFn,setOuterHandleElId:CQ.Ext.emptyFn,addInvalidHandleClass:CQ.Ext.emptyFn,addInvalidHandleId:CQ.Ext.emptyFn,addInvalidHandleType:CQ.Ext.emptyFn,removeInvalidHandleClass:CQ.Ext.emptyFn,removeInvalidHandleId:CQ.Ext.emptyFn,removeInvalidHandleType:CQ.Ext.emptyFn,toString:function(){return("DDTarget "+this.id)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.DragTracker=CQ.Ext.extend(CQ.Ext.util.Observable,{active:false,tolerance:5,autoStart:false,constructor:function(A){CQ.Ext.apply(this,A);
this.addEvents("mousedown","mouseup","mousemove","dragstart","dragend","drag");
this.dragRegion=new CQ.Ext.lib.Region(0,0,0,0);
if(this.el){this.initEl(this.el)
}CQ.Ext.dd.DragTracker.superclass.constructor.call(this,A)
},initEl:function(A){this.el=CQ.Ext.get(A);
A.on("mousedown",this.onMouseDown,this,this.delegate?{delegate:this.delegate}:undefined)
},destroy:function(){this.el.un("mousedown",this.onMouseDown,this)
},onMouseDown:function(C,B){if(this.fireEvent("mousedown",this,C)!==false&&this.onBeforeStart(C)!==false){this.startXY=this.lastXY=C.getXY();
this.dragTarget=this.delegate?B:this.el.dom;
if(this.preventDefault!==false){C.preventDefault()
}var A=CQ.Ext.getDoc();
A.on("mouseup",this.onMouseUp,this);
A.on("mousemove",this.onMouseMove,this);
A.on("selectstart",this.stopSelect,this);
if(this.autoStart){this.timer=this.triggerStart.defer(this.autoStart===true?1000:this.autoStart,this)
}}},onMouseMove:function(D,C){if(this.active&&CQ.Ext.isIE&&!D.browserEvent.button){D.preventDefault();
this.onMouseUp(D);
return 
}D.preventDefault();
var B=D.getXY(),A=this.startXY;
this.lastXY=B;
if(!this.active){if(Math.abs(A[0]-B[0])>this.tolerance||Math.abs(A[1]-B[1])>this.tolerance){this.triggerStart()
}else{return 
}}this.fireEvent("mousemove",this,D);
this.onDrag(D);
this.fireEvent("drag",this,D)
},onMouseUp:function(C){var B=CQ.Ext.getDoc();
B.un("mousemove",this.onMouseMove,this);
B.un("mouseup",this.onMouseUp,this);
B.un("selectstart",this.stopSelect,this);
C.preventDefault();
this.clearStart();
var A=this.active;
this.active=false;
delete this.elRegion;
this.fireEvent("mouseup",this,C);
if(A){this.onEnd(C);
this.fireEvent("dragend",this,C)
}},triggerStart:function(A){this.clearStart();
this.active=true;
this.onStart(this.startXY);
this.fireEvent("dragstart",this,this.startXY)
},clearStart:function(){if(this.timer){clearTimeout(this.timer);
delete this.timer
}},stopSelect:function(A){A.stopEvent();
return false
},onBeforeStart:function(A){},onStart:function(A){},onDrag:function(A){},onEnd:function(A){},getDragTarget:function(){return this.dragTarget
},getDragCt:function(){return this.el
},getXY:function(A){return A?this.constrainModes[A].call(this,this.lastXY):this.lastXY
},getOffset:function(C){var B=this.getXY(C);
var A=this.startXY;
return[A[0]-B[0],A[1]-B[1]]
},constrainModes:{point:function(B){if(!this.elRegion){this.elRegion=this.getDragCt().getRegion()
}var A=this.dragRegion;
A.left=B[0];
A.top=B[1];
A.right=B[0];
A.bottom=B[1];
A.constrainTo(this.elRegion);
return[A.left,A.top]
}}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.ScrollManager=function(){var C=CQ.Ext.dd.DragDropMgr;
var E={};
var B=null;
var H={};
var G=function(K){B=null;
A()
};
var I=function(){if(C.dragCurrent){C.refreshCache(C.dragCurrent.groups)
}};
var D=function(){if(C.dragCurrent){var K=CQ.Ext.dd.ScrollManager;
var L=H.el.ddScrollConfig?H.el.ddScrollConfig.increment:K.increment;
if(!K.animate){if(H.el.scroll(H.dir,L)){I()
}}else{H.el.scroll(H.dir,L,true,K.animDuration,I)
}}};
var A=function(){if(H.id){clearInterval(H.id)
}H.id=0;
H.el=null;
H.dir=""
};
var F=function(L,K){A();
H.el=L;
H.dir=K;
var M=(L.ddScrollConfig&&L.ddScrollConfig.frequency)?L.ddScrollConfig.frequency:CQ.Ext.dd.ScrollManager.frequency;
H.id=setInterval(D,M)
};
var J=function(N,P){if(P||!C.dragCurrent){return 
}var Q=CQ.Ext.dd.ScrollManager;
if(!B||B!=C.dragCurrent){B=C.dragCurrent;
Q.refreshCache()
}var R=CQ.Ext.lib.Event.getXY(N);
var S=new CQ.Ext.lib.Point(R[0],R[1]);
for(var L in E){var M=E[L],K=M._region;
var O=M.ddScrollConfig?M.ddScrollConfig:Q;
if(K&&K.contains(S)&&M.isScrollable()){if(K.bottom-S.y<=O.vthresh){if(H.el!=M){F(M,"down")
}return 
}else{if(K.right-S.x<=O.hthresh){if(H.el!=M){F(M,"left")
}return 
}else{if(S.y-K.top<=O.vthresh){if(H.el!=M){F(M,"up")
}return 
}else{if(S.x-K.left<=O.hthresh){if(H.el!=M){F(M,"right")
}return 
}}}}}}A()
};
C.fireEvents=C.fireEvents.createSequence(J,C);
C.stopDrag=C.stopDrag.createSequence(G,C);
return{register:function(M){if(CQ.Ext.isArray(M)){for(var L=0,K=M.length;
L<K;
L++){this.register(M[L])
}}else{M=CQ.Ext.get(M);
E[M.id]=M
}},unregister:function(M){if(CQ.Ext.isArray(M)){for(var L=0,K=M.length;
L<K;
L++){this.unregister(M[L])
}}else{M=CQ.Ext.get(M);
delete E[M.id]
}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){for(var K in E){if(typeof E[K]=="object"){E[K]._region=E[K].getRegion()
}}}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.Registry=function(){var D={};
var B={};
var A=0;
var C=function(F,E){if(typeof F=="string"){return F
}var G=F.id;
if(!G&&E!==false){G="extdd-"+(++A);
F.id=G
}return G
};
return{register:function(H,I){I=I||{};
if(typeof H=="string"){H=document.getElementById(H)
}I.ddel=H;
D[C(H)]=I;
if(I.isHandle!==false){B[I.ddel.id]=I
}if(I.handles){var G=I.handles;
for(var F=0,E=G.length;
F<E;
F++){B[C(G[F])]=I
}}},unregister:function(H){var J=C(H,false);
var I=D[J];
if(I){delete D[J];
if(I.handles){var G=I.handles;
for(var F=0,E=G.length;
F<E;
F++){delete B[C(G[F],false)]
}}}},getHandle:function(E){if(typeof E!="string"){E=E.id
}return B[E]
},getHandleFromEvent:function(F){var E=CQ.Ext.lib.Event.getTarget(F);
return E?B[E.id]:null
},getTarget:function(E){if(typeof E!="string"){E=E.id
}return D[E]
},getTargetFromEvent:function(F){var E=CQ.Ext.lib.Event.getTarget(F);
return E?D[E.id]||B[E.id]:null
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.StatusProxy=function(A){CQ.Ext.apply(this,A);
this.id=this.id||CQ.Ext.id();
this.el=new CQ.Ext.Layer({dh:{id:this.id,tag:"div",cls:"x-dd-drag-proxy "+this.dropNotAllowed,children:[{tag:"div",cls:"x-dd-drop-icon"},{tag:"div",cls:"x-dd-drag-ghost"}]},shadow:!A||A.shadow!==false});
this.ghost=CQ.Ext.get(this.el.dom.childNodes[1]);
this.dropStatus=this.dropNotAllowed
};
CQ.Ext.dd.StatusProxy.prototype={dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",setStatus:function(A){A=A||this.dropNotAllowed;
if(this.dropStatus!=A){this.el.replaceClass(this.dropStatus,A);
this.dropStatus=A
}},reset:function(A){this.el.dom.className="x-dd-drag-proxy "+this.dropNotAllowed;
this.dropStatus=this.dropNotAllowed;
if(A){this.ghost.update("")
}},update:function(A){if(typeof A=="string"){this.ghost.update(A)
}else{this.ghost.update("");
A.style.margin="0";
this.ghost.dom.appendChild(A)
}var B=this.ghost.dom.firstChild;
if(B){CQ.Ext.fly(B).setStyle("float","none")
}},getEl:function(){return this.el
},getGhost:function(){return this.ghost
},hide:function(A){this.el.hide();
if(A){this.reset(true)
}},stop:function(){if(this.anim&&this.anim.isAnimated&&this.anim.isAnimated()){this.anim.stop()
}},show:function(){this.el.show()
},sync:function(){this.el.sync()
},repair:function(B,C,A){this.callback=C;
this.scope=A;
if(B&&this.animRepair!==false){this.el.addClass("x-dd-drag-repair");
this.el.hideUnders(true);
this.anim=this.el.shift({duration:this.repairDuration||0.5,easing:"easeOut",xy:B,stopFx:true,callback:this.afterRepair,scope:this})
}else{this.afterRepair()
}},afterRepair:function(){this.hide(true);
if(typeof this.callback=="function"){this.callback.call(this.scope||this)
}this.callback=null;
this.scope=null
},destroy:function(){CQ.Ext.destroy(this.ghost,this.el)
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.DragSource=function(B,A){this.el=CQ.Ext.get(B);
if(!this.dragData){this.dragData={}
}CQ.Ext.apply(this,A);
if(!this.proxy){this.proxy=new CQ.Ext.dd.StatusProxy()
}CQ.Ext.dd.DragSource.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{dragElId:this.proxy.id,resizeFrame:false,isTarget:false,scroll:this.scroll===true});
this.dragging=false
};
CQ.Ext.extend(CQ.Ext.dd.DragSource,CQ.Ext.dd.DDProxy,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",getDragData:function(A){return this.dragData
},onDragEnter:function(C,D){var B=CQ.Ext.dd.DragDropMgr.getDDById(D);
this.cachedTarget=B;
if(this.beforeDragEnter(B,C,D)!==false){if(B.isNotifyTarget){var A=B.notifyEnter(this,C,this.dragData);
this.proxy.setStatus(A)
}else{this.proxy.setStatus(this.dropAllowed)
}if(this.afterDragEnter){this.afterDragEnter(B,C,D)
}}},beforeDragEnter:function(B,A,C){return true
},alignElWithMouse:function(){CQ.Ext.dd.DragSource.superclass.alignElWithMouse.apply(this,arguments);
this.proxy.sync()
},onDragOver:function(C,D){var B=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(D);
if(this.beforeDragOver(B,C,D)!==false){if(B.isNotifyTarget){var A=B.notifyOver(this,C,this.dragData);
this.proxy.setStatus(A)
}if(this.afterDragOver){this.afterDragOver(B,C,D)
}}},beforeDragOver:function(B,A,C){return true
},onDragOut:function(B,C){var A=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(C);
if(this.beforeDragOut(A,B,C)!==false){if(A.isNotifyTarget){A.notifyOut(this,B,this.dragData)
}this.proxy.reset();
if(this.afterDragOut){this.afterDragOut(A,B,C)
}}this.cachedTarget=null
},beforeDragOut:function(B,A,C){return true
},onDragDrop:function(B,C){var A=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(C);
if(this.beforeDragDrop(A,B,C)!==false){if(A.isNotifyTarget){if(A.notifyDrop(this,B,this.dragData)){this.onValidDrop(A,B,C)
}else{this.onInvalidDrop(A,B,C)
}}else{this.onValidDrop(A,B,C)
}if(this.afterDragDrop){this.afterDragDrop(A,B,C)
}}delete this.cachedTarget
},beforeDragDrop:function(B,A,C){return true
},onValidDrop:function(B,A,C){this.hideProxy();
if(this.afterValidDrop){this.afterValidDrop(B,A,C)
}},getRepairXY:function(B,A){return this.el.getXY()
},onInvalidDrop:function(B,A,C){this.beforeInvalidDrop(B,A,C);
if(this.cachedTarget){if(this.cachedTarget.isNotifyTarget){this.cachedTarget.notifyOut(this,A,this.dragData)
}this.cacheTarget=null
}this.proxy.repair(this.getRepairXY(A,this.dragData),this.afterRepair,this);
if(this.afterInvalidDrop){this.afterInvalidDrop(A,C)
}},afterRepair:function(){if(CQ.Ext.enableFx){this.el.highlight(this.hlColor||"c3daf9")
}this.dragging=false
},beforeInvalidDrop:function(B,A,C){return true
},handleMouseDown:function(B){if(this.dragging){return 
}var A=this.getDragData(B);
if(A&&this.onBeforeDrag(A,B)!==false){this.dragData=A;
this.proxy.stop();
CQ.Ext.dd.DragSource.superclass.handleMouseDown.apply(this,arguments)
}},onBeforeDrag:function(A,B){return true
},onStartDrag:CQ.Ext.emptyFn,startDrag:function(A,B){this.proxy.reset();
this.dragging=true;
this.proxy.update("");
this.onInitDrag(A,B);
this.proxy.show()
},onInitDrag:function(A,C){var B=this.el.dom.cloneNode(true);
B.id=CQ.Ext.id();
this.proxy.update(B);
this.onStartDrag(A,C);
return true
},getProxy:function(){return this.proxy
},hideProxy:function(){this.proxy.hide();
this.proxy.reset(true);
this.dragging=false
},triggerCacheRefresh:function(){CQ.Ext.dd.DDM.refreshCache(this.groups)
},b4EndDrag:function(A){},endDrag:function(A){this.onEndDrag(this.dragData,A)
},onEndDrag:function(A,B){},autoOffset:function(A,B){this.setDelta(-12,-20)
},destroy:function(){CQ.Ext.dd.DragSource.superclass.destroy.call(this);
CQ.Ext.destroy(this.proxy)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.DropTarget=function(B,A){this.el=CQ.Ext.get(B);
CQ.Ext.apply(this,A);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.el)
}CQ.Ext.dd.DropTarget.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{isTarget:true})
};
CQ.Ext.extend(CQ.Ext.dd.DropTarget,CQ.Ext.dd.DDTarget,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",isTarget:true,isNotifyTarget:true,notifyEnter:function(A,C,B){if(this.overClass){this.el.addClass(this.overClass)
}return this.dropAllowed
},notifyOver:function(A,C,B){return this.dropAllowed
},notifyOut:function(A,C,B){if(this.overClass){this.el.removeClass(this.overClass)
}},notifyDrop:function(A,C,B){return false
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.DragZone=function(B,A){CQ.Ext.dd.DragZone.superclass.constructor.call(this,B,A);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.el)
}};
CQ.Ext.extend(CQ.Ext.dd.DragZone,CQ.Ext.dd.DragSource,{getDragData:function(A){return CQ.Ext.dd.Registry.getHandleFromEvent(A)
},onInitDrag:function(A,B){this.proxy.update(this.dragData.ddel.cloneNode(true));
this.onStartDrag(A,B);
return true
},afterRepair:function(){if(CQ.Ext.enableFx){CQ.Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")
}this.dragging=false
},getRepairXY:function(A){return CQ.Ext.Element.fly(this.dragData.ddel).getXY()
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.DropZone=function(B,A){CQ.Ext.dd.DropZone.superclass.constructor.call(this,B,A)
};
CQ.Ext.extend(CQ.Ext.dd.DropZone,CQ.Ext.dd.DropTarget,{getTargetFromEvent:function(A){return CQ.Ext.dd.Registry.getTargetFromEvent(A)
},onNodeEnter:function(D,A,C,B){},onNodeOver:function(D,A,C,B){return this.dropAllowed
},onNodeOut:function(D,A,C,B){},onNodeDrop:function(D,A,C,B){return false
},onContainerOver:function(A,C,B){return this.dropNotAllowed
},onContainerDrop:function(A,C,B){return false
},notifyEnter:function(A,C,B){return this.dropNotAllowed
},notifyOver:function(A,C,B){var D=this.getTargetFromEvent(C);
if(!D){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,A,C,B);
this.lastOverNode=null
}return this.onContainerOver(A,C,B)
}if(this.lastOverNode!=D){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,A,C,B)
}this.onNodeEnter(D,A,C,B);
this.lastOverNode=D
}return this.onNodeOver(D,A,C,B)
},notifyOut:function(A,C,B){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,A,C,B);
this.lastOverNode=null
}},notifyDrop:function(A,C,B){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,A,C,B);
this.lastOverNode=null
}var D=this.getTargetFromEvent(C);
return D?this.onNodeDrop(D,A,C,B):this.onContainerDrop(A,C,B)
},triggerCacheRefresh:function(){CQ.Ext.dd.DDM.refreshCache(this.groups)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Element.addMethods({initDD:function(C,B,D){var A=new CQ.Ext.dd.DD(CQ.Ext.id(this.dom),C,B);
return CQ.Ext.apply(A,D)
},initDDProxy:function(C,B,D){var A=new CQ.Ext.dd.DDProxy(CQ.Ext.id(this.dom),C,B);
return CQ.Ext.apply(A,D)
},initDDTarget:function(C,B,D){var A=new CQ.Ext.dd.DDTarget(CQ.Ext.id(this.dom),C,B);
return CQ.Ext.apply(A,D)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Api=(function(){var A={};
return{actions:{create:"create",read:"read",update:"update",destroy:"destroy"},restActions:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},isAction:function(B){return(CQ.Ext.data.Api.actions[B])?true:false
},getVerb:function(B){if(A[B]){return A[B]
}for(var C in this.actions){if(this.actions[C]===B){A[B]=C;
break
}}return(A[B]!==undefined)?A[B]:null
},isValid:function(B){var E=[];
var D=this.actions;
for(var C in B){if(!(C in D)){E.push(C)
}}return(!E.length)?true:E
},hasUniqueUrl:function(C,F){var B=(C.api[F])?C.api[F].url:null;
var E=true;
for(var D in C.api){if((E=(D===F)?true:(C.api[D].url!=B)?true:false)===false){break
}}return E
},prepare:function(B){if(!B.api){B.api={}
}for(var D in this.actions){var C=this.actions[D];
B.api[C]=B.api[C]||B.url||B.directFn;
if(typeof (B.api[C])=="string"){B.api[C]={url:B.api[C],method:(B.restful===true)?CQ.Ext.data.Api.restActions[C]:undefined}
}}},restify:function(B){B.restful=true;
for(var C in this.restActions){B.api[this.actions[C]].method||(B.api[this.actions[C]].method=this.restActions[C])
}B.onWrite=B.onWrite.createInterceptor(function(H,I,F,E){var D=I.reader;
var G=new CQ.Ext.data.Response({action:H,raw:F});
switch(F.status){case 200:return true;
break;
case 201:if(CQ.Ext.isEmpty(G.raw.responseText)){G.success=true
}else{return true
}break;
case 204:G.success=true;
G.data=null;
break;
default:return true;
break
}if(G.success===true){this.fireEvent("write",this,H,G.data,G,E,I.request.arg)
}else{this.fireEvent("exception",this,"remote",H,I,G,E)
}I.request.callback.call(I.request.scope,G.data,G,G.success);
return false
},B)
}}
})();
CQ.Ext.data.Response=function(B,A){CQ.Ext.apply(this,B,{raw:A})
};
CQ.Ext.data.Response.prototype={message:null,success:false,status:null,root:null,raw:null,getMessage:function(){return this.message
},getSuccess:function(){return this.success
},getStatus:function(){return this.status
},getRoot:function(){return this.root
},getRawResponse:function(){return this.raw
}};
CQ.Ext.data.Api.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(B,A){this.arg=A;
CQ.Ext.Error.call(this,B)
},name:"CQ.Ext.data.Api"});
CQ.Ext.apply(CQ.Ext.data.Api.Error.prototype,{lang:{"action-url-undefined":"No fallback url defined for this action.  When defining a DataProxy api, please be sure to define an url for each CRUD action in CQ.Ext.data.Api.actions or define a default url in addition to your api-configuration.",invalid:"received an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions defined in CQ.Ext.data.Api.actions","invalid-url":"Invalid url.  Please review your proxy configuration.",execute:'Attempted to execute an unknown action.  Valid API actions are defined in CQ.Ext.data.Api.actions"'}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.SortTypes={none:function(A){return A
},stripTagsRE:/<\/?[^>]+>/gi,asText:function(A){return String(A).replace(this.stripTagsRE,"")
},asUCText:function(A){return String(A).toUpperCase().replace(this.stripTagsRE,"")
},asUCString:function(A){return String(A).toUpperCase()
},asDate:function(A){if(!A){return 0
}if(CQ.Ext.isDate(A)){return A.getTime()
}return Date.parse(String(A))
},asFloat:function(A){var B=parseFloat(String(A).replace(/,/g,""));
return isNaN(B)?0:B
},asInt:function(A){var B=parseInt(String(A).replace(/,/g,""),10);
return isNaN(B)?0:B
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Record=function(A,B){this.id=(B||B===0)?B:CQ.Ext.data.Record.id(this);
this.data=A||{}
};
CQ.Ext.data.Record.create=function(E){var C=CQ.Ext.extend(CQ.Ext.data.Record,{});
var D=C.prototype;
D.fields=new CQ.Ext.util.MixedCollection(false,function(F){return F.name
});
for(var B=0,A=E.length;
B<A;
B++){D.fields.add(new CQ.Ext.data.Field(E[B]))
}C.getField=function(F){return D.fields.get(F)
};
return C
};
CQ.Ext.data.Record.PREFIX="ext-record";
CQ.Ext.data.Record.AUTO_ID=1;
CQ.Ext.data.Record.EDIT="edit";
CQ.Ext.data.Record.REJECT="reject";
CQ.Ext.data.Record.COMMIT="commit";
CQ.Ext.data.Record.id=function(A){A.phantom=true;
return[CQ.Ext.data.Record.PREFIX,"-",CQ.Ext.data.Record.AUTO_ID++].join("")
};
CQ.Ext.data.Record.prototype={dirty:false,editing:false,error:null,modified:null,phantom:false,join:function(A){this.store=A
},set:function(A,C){var B=CQ.Ext.isPrimitive(C)?String:CQ.Ext.encode;
if(B(this.data[A])==B(C)){return 
}this.dirty=true;
if(!this.modified){this.modified={}
}if(this.modified[A]===undefined){this.modified[A]=this.data[A]
}this.data[A]=C;
if(!this.editing){this.afterEdit()
}},afterEdit:function(){if(this.store){this.store.afterEdit(this)
}},afterReject:function(){if(this.store){this.store.afterReject(this)
}},afterCommit:function(){if(this.store){this.store.afterCommit(this)
}},get:function(A){return this.data[A]
},beginEdit:function(){this.editing=true;
this.modified=this.modified||{}
},cancelEdit:function(){this.editing=false;
delete this.modified
},endEdit:function(){this.editing=false;
if(this.dirty){this.afterEdit()
}},reject:function(B){var A=this.modified;
for(var C in A){if(typeof A[C]!="function"){this.data[C]=A[C]
}}this.dirty=false;
delete this.modified;
this.editing=false;
if(B!==true){this.afterReject()
}},commit:function(A){this.dirty=false;
delete this.modified;
this.editing=false;
if(A!==true){this.afterCommit()
}},getChanges:function(){var A=this.modified,B={};
for(var C in A){if(A.hasOwnProperty(C)){B[C]=this.data[C]
}}return B
},hasError:function(){return this.error!==null
},clearError:function(){this.error=null
},copy:function(A){return new this.constructor(CQ.Ext.apply({},this.data),A||this.id)
},isModified:function(A){return !!(this.modified&&this.modified.hasOwnProperty(A))
},isValid:function(){return this.fields.find(function(A){return(A.allowBlank===false&&CQ.Ext.isEmpty(this.data[A.name]))?true:false
},this)?false:true
},markDirty:function(){this.dirty=true;
if(!this.modified){this.modified={}
}this.fields.each(function(A){this.modified[A.name]=this.data[A.name]
},this)
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.StoreMgr=CQ.Ext.apply(new CQ.Ext.util.MixedCollection(),{register:function(){for(var A=0,B;
(B=arguments[A]);
A++){this.add(B)
}},unregister:function(){for(var A=0,B;
(B=arguments[A]);
A++){this.remove(this.lookup(B))
}},lookup:function(E){if(CQ.Ext.isArray(E)){var B=["field1"],D=!CQ.Ext.isArray(E[0]);
if(!D){for(var C=2,A=E[0].length;
C<=A;
++C){B.push("field"+C)
}}return new CQ.Ext.data.ArrayStore({fields:B,data:E,expandData:D,autoDestroy:true,autoCreated:true})
}return CQ.Ext.isObject(E)?(E.events?E:CQ.Ext.create(E,"store")):this.get(E)
},getKey:function(A){return A.storeId
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Store=CQ.Ext.extend(CQ.Ext.util.Observable,{writer:undefined,remoteSort:false,autoDestroy:false,pruneModifiedRecords:false,lastOptions:null,autoSave:true,batch:true,restful:false,paramNames:undefined,defaultParamNames:{start:"start",limit:"limit",sort:"sort",dir:"dir"},batchKey:"_ext_batch_",constructor:function(A){this.data=new CQ.Ext.util.MixedCollection(false);
this.data.getKey=function(B){return B.id
};
this.removed=[];
if(A&&A.data){this.inlineData=A.data;
delete A.data
}CQ.Ext.apply(this,A);
this.baseParams=CQ.Ext.isObject(this.baseParams)?this.baseParams:{};
this.paramNames=CQ.Ext.applyIf(this.paramNames||{},this.defaultParamNames);
if((this.url||this.api)&&!this.proxy){this.proxy=new CQ.Ext.data.HttpProxy({url:this.url,api:this.api})
}if(this.restful===true&&this.proxy){this.batch=false;
CQ.Ext.data.Api.restify(this.proxy)
}if(this.reader){if(!this.recordType){this.recordType=this.reader.recordType
}if(this.reader.onMetaChange){this.reader.onMetaChange=this.reader.onMetaChange.createSequence(this.onMetaChange,this)
}if(this.writer){if(this.writer instanceof (CQ.Ext.data.DataWriter)===false){this.writer=this.buildWriter(this.writer)
}this.writer.meta=this.reader.meta;
this.pruneModifiedRecords=true
}}if(this.recordType){this.fields=this.recordType.prototype.fields
}this.modified=[];
this.addEvents("datachanged","metachange","add","remove","update","clear","exception","beforeload","load","loadexception","beforewrite","write","beforesave","save");
if(this.proxy){this.relayEvents(this.proxy,["loadexception","exception"])
}if(this.writer){this.on({scope:this,add:this.createRecords,remove:this.destroyRecord,update:this.updateRecord,clear:this.onClear})
}this.sortToggle={};
if(this.sortField){this.setDefaultSort(this.sortField,this.sortDir)
}else{if(this.sortInfo){this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction)
}}CQ.Ext.data.Store.superclass.constructor.call(this);
if(this.id){this.storeId=this.id;
delete this.id
}if(this.storeId){CQ.Ext.StoreMgr.register(this)
}if(this.inlineData){this.loadData(this.inlineData);
delete this.inlineData
}else{if(this.autoLoad){this.load.defer(10,this,[typeof this.autoLoad=="object"?this.autoLoad:undefined])
}}this.batchCounter=0;
this.batches={}
},buildWriter:function(B){var A=undefined,C=(B.format||"json").toLowerCase();
switch(C){case"json":A=CQ.Ext.data.JsonWriter;
break;
case"xml":A=CQ.Ext.data.XmlWriter;
break;
default:A=CQ.Ext.data.JsonWriter
}return new A(B)
},destroy:function(){if(!this.isDestroyed){if(this.storeId){CQ.Ext.StoreMgr.unregister(this)
}this.clearData();
this.data=null;
CQ.Ext.destroy(this.proxy);
this.reader=this.writer=null;
this.purgeListeners();
this.isDestroyed=true
}},add:function(B){B=[].concat(B);
if(B.length<1){return 
}for(var D=0,A=B.length;
D<A;
D++){B[D].join(this)
}var C=this.data.length;
this.data.addAll(B);
if(this.snapshot){this.snapshot.addAll(B)
}this.fireEvent("add",this,B,C)
},addSorted:function(A){var B=this.findInsertIndex(A);
this.insert(B,A)
},remove:function(A){if(CQ.Ext.isArray(A)){CQ.Ext.each(A,function(C){this.remove(C)
},this)
}var B=this.data.indexOf(A);
if(B>-1){A.join(null);
this.data.removeAt(B)
}if(this.pruneModifiedRecords){this.modified.remove(A)
}if(this.snapshot){this.snapshot.remove(A)
}if(B>-1){this.fireEvent("remove",this,A,B)
}},removeAt:function(A){this.remove(this.getAt(A))
},removeAll:function(B){var A=[];
this.each(function(C){A.push(C)
});
this.clearData();
if(this.snapshot){this.snapshot.clear()
}if(this.pruneModifiedRecords){this.modified=[]
}if(B!==true){this.fireEvent("clear",this,A)
}},onClear:function(B,A){CQ.Ext.each(A,function(D,C){this.destroyRecord(this,D,C)
},this)
},insert:function(C,B){B=[].concat(B);
for(var D=0,A=B.length;
D<A;
D++){this.data.insert(C,B[D]);
B[D].join(this)
}if(this.snapshot){this.snapshot.addAll(B)
}this.fireEvent("add",this,B,C)
},indexOf:function(A){return this.data.indexOf(A)
},indexOfId:function(A){return this.data.indexOfKey(A)
},getById:function(A){return(this.snapshot||this.data).key(A)
},getAt:function(A){return this.data.itemAt(A)
},getRange:function(B,A){return this.data.getRange(B,A)
},storeOptions:function(A){A=CQ.Ext.apply({},A);
delete A.callback;
delete A.scope;
this.lastOptions=A
},clearData:function(){this.data.each(function(A){A.join(null)
});
this.data.clear()
},load:function(B){B=B||{};
this.storeOptions(B);
if(this.sortInfo&&this.remoteSort){var A=this.paramNames;
B.params=B.params||{};
B.params[A.sort]=this.sortInfo.field;
B.params[A.dir]=this.sortInfo.direction
}try{return this.execute("read",null,B)
}catch(C){this.handleException(C);
return false
}},updateRecord:function(B,A,C){if(C==CQ.Ext.data.Record.EDIT&&this.autoSave===true&&(!A.phantom||(A.phantom&&A.isValid()))){this.save()
}},createRecords:function(C,B,D){for(var E=0,A=B.length;
E<A;
E++){if(B[E].phantom&&B[E].isValid()){B[E].markDirty();
this.modified.push(B[E])
}}if(this.autoSave===true){this.save()
}},destroyRecord:function(B,A,C){if(this.modified.indexOf(A)!=-1){this.modified.remove(A)
}if(!A.phantom){this.removed.push(A);
A.lastIndex=C;
if(this.autoSave===true){this.save()
}}},execute:function(E,A,C,B){if(!CQ.Ext.data.Api.isAction(E)){throw new CQ.Ext.data.Api.Error("execute",E)
}C=CQ.Ext.applyIf(C||{},{params:{}});
if(B!==undefined){this.addToBatch(B)
}var D=true;
if(E==="read"){D=this.fireEvent("beforeload",this,C);
CQ.Ext.applyIf(C.params,this.baseParams)
}else{if(this.writer.listful===true&&this.restful!==true){A=(CQ.Ext.isArray(A))?A:[A]
}else{if(CQ.Ext.isArray(A)&&A.length==1){A=A.shift()
}}if((D=this.fireEvent("beforewrite",this,E,A,C))!==false){this.writer.apply(C.params,this.baseParams,E,A)
}}if(D!==false){if(this.writer&&this.proxy.url&&!this.proxy.restful&&!CQ.Ext.data.Api.hasUniqueUrl(this.proxy,E)){C.params.xaction=E
}this.proxy.request(CQ.Ext.data.Api.actions[E],A,C.params,this.reader,this.createCallback(E,A,B),this,C)
}return D
},save:function(){if(!this.writer){throw new CQ.Ext.data.Store.Error("writer-undefined")
}var G=[],H,I,E,C={};
if(this.removed.length){G.push(["destroy",this.removed])
}var B=[].concat(this.getModifiedRecords());
if(B.length){var F=[];
for(var D=B.length-1;
D>=0;
D--){if(B[D].phantom===true){var A=B.splice(D,1).shift();
if(A.isValid()){F.push(A)
}}else{if(!B[D].isValid()){B.splice(D,1)
}}}if(F.length){G.push(["create",F])
}if(B.length){G.push(["update",B])
}}H=G.length;
if(H){E=++this.batchCounter;
for(var D=0;
D<H;
++D){I=G[D];
C[I[0]]=I[1]
}if(this.fireEvent("beforesave",this,C)!==false){for(var D=0;
D<H;
++D){I=G[D];
this.doTransaction(I[0],I[1],E)
}return E
}}return -1
},doTransaction:function(E,B,C){function F(G){try{this.execute(E,G,undefined,C)
}catch(H){this.handleException(H)
}}if(this.batch===false){for(var D=0,A=B.length;
D<A;
D++){F.call(this,B[D])
}}else{F.call(this,B)
}},addToBatch:function(B){var A=this.batches,C=this.batchKey+B,D=A[C];
if(!D){A[C]=D={id:B,count:0,data:{}}
}++D.count
},removeFromBatch:function(C,F,E){var B=this.batches,D=this.batchKey+C,G=B[D],E,A;
if(G){A=G.data[F]||[];
G.data[F]=A.concat(E);
if(G.count===1){E=G.data;
delete B[D];
this.fireEvent("save",this,C,E)
}else{--G.count
}}},createCallback:function(C,A,B){var D=CQ.Ext.data.Api.actions;
return(C=="read")?this.loadRecords:function(F,E,G){this["on"+CQ.Ext.util.Format.capitalize(C)+"Records"](G,A,[].concat(F));
if(G===true){this.fireEvent("write",this,C,F,E,A)
}this.removeFromBatch(B,C,F)
}
},clearModified:function(A){if(CQ.Ext.isArray(A)){for(var B=A.length-1;
B>=0;
B--){this.modified.splice(this.modified.indexOf(A[B]),1)
}}else{this.modified.splice(this.modified.indexOf(A),1)
}},reMap:function(B){if(CQ.Ext.isArray(B)){for(var D=0,A=B.length;
D<A;
D++){this.reMap(B[D])
}}else{delete this.data.map[B._phid];
this.data.map[B.id]=B;
var C=this.data.keys.indexOf(B._phid);
this.data.keys.splice(C,1,B.id);
delete B._phid
}},onCreateRecords:function(D,A,B){if(D===true){try{this.reader.realize(A,B);
this.reMap(A)
}catch(C){this.handleException(C);
if(CQ.Ext.isArray(A)){this.onCreateRecords(D,A,B)
}}}},onUpdateRecords:function(D,A,B){if(D===true){try{this.reader.update(A,B)
}catch(C){this.handleException(C);
if(CQ.Ext.isArray(A)){this.onUpdateRecords(D,A,B)
}}}},onDestroyRecords:function(E,B,D){B=(B instanceof CQ.Ext.data.Record)?[B]:[].concat(B);
for(var C=0,A=B.length;
C<A;
C++){this.removed.splice(this.removed.indexOf(B[C]),1)
}if(E===false){for(C=B.length-1;
C>=0;
C--){this.insert(B[C].lastIndex,B[C])
}}},handleException:function(A){CQ.Ext.handleError(A)
},reload:function(A){this.load(CQ.Ext.applyIf(A||{},this.lastOptions))
},loadRecords:function(G,B,F){if(this.isDestroyed===true){return 
}if(!G||F===false){if(F!==false){this.fireEvent("load",this,[],B)
}if(B.callback){B.callback.call(B.scope||this,[],B,false,G)
}return 
}var E=G.records,D=G.totalRecords||E.length;
if(!B||B.add!==true){if(this.pruneModifiedRecords){this.modified=[]
}for(var C=0,A=E.length;
C<A;
C++){E[C].join(this)
}if(this.snapshot){this.data=this.snapshot;
delete this.snapshot
}this.clearData();
this.data.addAll(E);
this.totalLength=D;
this.applySort();
this.fireEvent("datachanged",this)
}else{this.totalLength=Math.max(D,this.data.length+E.length);
this.add(E)
}this.fireEvent("load",this,E,B);
if(B.callback){B.callback.call(B.scope||this,E,B,true)
}},loadData:function(C,A){var B=this.reader.readRecords(C);
this.loadRecords(B,{add:A},true)
},getCount:function(){return this.data.length||0
},getTotalCount:function(){return this.totalLength||0
},getSortState:function(){return this.sortInfo
},applySort:function(){if(this.sortInfo&&!this.remoteSort){var A=this.sortInfo,B=A.field;
this.sortData(B,A.direction)
}},sortData:function(C,D){D=D||"ASC";
var A=this.fields.get(C).sortType;
var B=function(F,E){var H=A(F.data[C]),G=A(E.data[C]);
return H>G?1:(H<G?-1:0)
};
this.data.sort(D,B);
if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(D,B)
}},setDefaultSort:function(B,A){A=A?A.toUpperCase():"ASC";
this.sortInfo={field:B,direction:A};
this.sortToggle[B]=A
},sort:function(E,C){var D=this.fields.get(E);
if(!D){return false
}if(!C){if(this.sortInfo&&this.sortInfo.field==D.name){C=(this.sortToggle[D.name]||"ASC").toggle("ASC","DESC")
}else{C=D.sortDir
}}var B=(this.sortToggle)?this.sortToggle[D.name]:null;
var A=(this.sortInfo)?this.sortInfo:null;
this.sortToggle[D.name]=C;
this.sortInfo={field:D.name,direction:C};
if(!this.remoteSort){this.applySort();
this.fireEvent("datachanged",this)
}else{if(!this.load(this.lastOptions)){if(B){this.sortToggle[D.name]=B
}if(A){this.sortInfo=A
}}}},each:function(B,A){this.data.each(B,A)
},getModifiedRecords:function(){return this.modified
},createFilterFn:function(C,B,D,A){if(CQ.Ext.isEmpty(B,false)){return false
}B=this.data.createValueMatcher(B,D,A);
return function(E){return B.test(E.data[C])
}
},sum:function(E,F,A){var C=this.data.items,B=0;
F=F||0;
A=(A||A===0)?A:C.length-1;
for(var D=F;
D<=A;
D++){B+=(C[D].data[E]||0)
}return B
},filter:function(D,C,E,A){var B=this.createFilterFn(D,C,E,A);
return B?this.filterBy(B):this.clearFilter()
},filterBy:function(B,A){this.snapshot=this.snapshot||this.data;
this.data=this.queryBy(B,A||this);
this.fireEvent("datachanged",this)
},query:function(D,C,E,A){var B=this.createFilterFn(D,C,E,A);
return B?this.queryBy(B):this.data.clone()
},queryBy:function(B,A){var C=this.snapshot||this.data;
return C.filterBy(B,A||this)
},find:function(D,C,F,E,A){var B=this.createFilterFn(D,C,E,A);
return B?this.data.findIndexBy(B,null,F):-1
},findExact:function(B,A,C){return this.data.findIndexBy(function(D){return D.get(B)===A
},this,C)
},findBy:function(B,A,C){return this.data.findIndexBy(B,A,C)
},collect:function(G,H,B){var F=(B===true&&this.snapshot)?this.snapshot.items:this.data.items;
var I,J,A=[],C={};
for(var D=0,E=F.length;
D<E;
D++){I=F[D].data[G];
J=String(I);
if((H||!CQ.Ext.isEmpty(I))&&!C[J]){C[J]=true;
A[A.length]=I
}}return A
},clearFilter:function(A){if(this.isFiltered()){this.data=this.snapshot;
delete this.snapshot;
if(A!==true){this.fireEvent("datachanged",this)
}}},isFiltered:function(){return this.snapshot&&this.snapshot!=this.data
},afterEdit:function(A){if(this.modified.indexOf(A)==-1){this.modified.push(A)
}this.fireEvent("update",this,A,CQ.Ext.data.Record.EDIT)
},afterReject:function(A){this.modified.remove(A);
this.fireEvent("update",this,A,CQ.Ext.data.Record.REJECT)
},afterCommit:function(A){this.modified.remove(A);
this.fireEvent("update",this,A,CQ.Ext.data.Record.COMMIT)
},commitChanges:function(){var B=this.modified.slice(0);
this.modified=[];
for(var C=0,A=B.length;
C<A;
C++){B[C].commit()
}},rejectChanges:function(){var B=this.modified.slice(0);
this.modified=[];
for(var C=0,A=B.length;
C<A;
C++){B[C].reject()
}var B=this.removed.slice(0).reverse();
this.removed=[];
for(var C=0,A=B.length;
C<A;
C++){this.insert(B[C].lastIndex||0,B[C]);
B[C].reject()
}},onMetaChange:function(A){this.recordType=this.reader.recordType;
this.fields=this.recordType.prototype.fields;
delete this.snapshot;
if(this.reader.meta.sortInfo){this.sortInfo=this.reader.meta.sortInfo
}else{if(this.sortInfo&&!this.fields.get(this.sortInfo.field)){delete this.sortInfo
}}if(this.writer){this.writer.meta=this.reader.meta
}this.modified=[];
this.fireEvent("metachange",this,this.reader.meta)
},findInsertIndex:function(A){this.suspendEvents();
var C=this.data.clone();
this.data.add(A);
this.applySort();
var B=this.data.indexOf(A);
this.data=C;
this.resumeEvents();
return B
},setBaseParam:function(A,B){this.baseParams=this.baseParams||{};
this.baseParams[A]=B
}});
CQ.Ext.reg("store",CQ.Ext.data.Store);
CQ.Ext.data.Store.Error=CQ.Ext.extend(CQ.Ext.Error,{name:"CQ.Ext.data.Store"});
CQ.Ext.apply(CQ.Ext.data.Store.Error.prototype,{lang:{"writer-undefined":"Attempted to execute a write-action without a DataWriter installed."}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Field=function(D){if(typeof D=="string"){D={name:D}
}CQ.Ext.apply(this,D);
if(!this.type){this.type="auto"
}var C=CQ.Ext.data.SortTypes;
if(typeof this.sortType=="string"){this.sortType=C[this.sortType]
}if(!this.sortType){switch(this.type){case"string":this.sortType=C.asUCString;
break;
case"date":this.sortType=C.asDate;
break;
default:this.sortType=C.none
}}var E=/[\$,%]/g;
if(!this.convert){var B,A=this.dateFormat;
switch(this.type){case"":case"auto":case undefined:B=function(F){return F
};
break;
case"string":B=function(F){return(F===undefined||F===null)?"":String(F)
};
break;
case"int":B=function(F){return F!==undefined&&F!==null&&F!==""?parseInt(String(F).replace(E,""),10):""
};
break;
case"float":B=function(F){return F!==undefined&&F!==null&&F!==""?parseFloat(String(F).replace(E,""),10):""
};
break;
case"bool":B=function(F){return F===true||F==="true"||F==1
};
break;
case"date":B=function(G){if(!G){return""
}if(CQ.Ext.isDate(G)){return G
}if(A){if(A=="timestamp"){return new Date(G*1000)
}if(A=="time"){return new Date(parseInt(G,10))
}return Date.parseDate(G,A)
}var F=Date.parse(G);
return F?new Date(F):null
};
break;
default:B=function(F){return F
};
break
}this.convert=B
}};
CQ.Ext.data.Field.prototype={dateFormat:null,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.DataReader=function(A,B){this.meta=A;
this.recordType=CQ.Ext.isArray(B)?CQ.Ext.data.Record.create(B):B;
if(this.recordType){this.buildExtractors()
}};
CQ.Ext.data.DataReader.prototype={getTotal:CQ.Ext.emptyFn,getRoot:CQ.Ext.emptyFn,getMessage:CQ.Ext.emptyFn,getSuccess:CQ.Ext.emptyFn,getId:CQ.Ext.emptyFn,buildExtractors:CQ.Ext.emptyFn,extractData:CQ.Ext.emptyFn,extractValues:CQ.Ext.emptyFn,realize:function(A,C){if(CQ.Ext.isArray(A)){for(var B=A.length-1;
B>=0;
B--){if(CQ.Ext.isArray(C)){this.realize(A.splice(B,1).shift(),C.splice(B,1).shift())
}else{this.realize(A.splice(B,1).shift(),C)
}}}else{if(CQ.Ext.isArray(C)&&C.length==1){C=C.shift()
}if(!this.isData(C)){throw new CQ.Ext.data.DataReader.Error("realize",A)
}A.phantom=false;
A._phid=A.id;
A.id=this.getId(C);
A.fields.each(function(D){if(C[D.name]!==D.defaultValue){A.data[D.name]=C[D.name]
}});
A.commit()
}},update:function(A,C){if(CQ.Ext.isArray(A)){for(var B=A.length-1;
B>=0;
B--){if(CQ.Ext.isArray(C)){this.update(A.splice(B,1).shift(),C.splice(B,1).shift())
}else{this.update(A.splice(B,1).shift(),C)
}}}else{if(CQ.Ext.isArray(C)&&C.length==1){C=C.shift()
}if(this.isData(C)){A.fields.each(function(D){if(C[D.name]!==D.defaultValue){A.data[D.name]=C[D.name]
}})
}A.commit()
}},extractData:function(I,A){var H=(this instanceof CQ.Ext.data.JsonReader)?"json":"node";
var C=[];
if(this.isData(I)&&!(this instanceof CQ.Ext.data.XmlReader)){I=[I]
}var G=this.recordType.prototype.fields,L=G.items,K=G.length,C=[];
if(A===true){var J=this.recordType;
for(var E=0;
E<I.length;
E++){var B=I[E];
var F=new J(this.extractValues(B,L,K),this.getId(B));
F[H]=B;
C.push(F)
}}else{for(var E=0;
E<I.length;
E++){var D=this.extractValues(I[E],L,K);
D[this.meta.idProperty]=this.getId(I[E]);
C.push(D)
}}return C
},isData:function(A){return(A&&CQ.Ext.isObject(A)&&!CQ.Ext.isEmpty(this.getId(A)))?true:false
},onMetaChange:function(A){delete this.ef;
this.meta=A;
this.recordType=CQ.Ext.data.Record.create(A.fields);
this.buildExtractors()
}};
CQ.Ext.data.DataReader.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(B,A){this.arg=A;
CQ.Ext.Error.call(this,B)
},name:"CQ.Ext.data.DataReader"});
CQ.Ext.apply(CQ.Ext.data.DataReader.Error.prototype,{lang:{update:"#update received invalid data from server.  Please see docs for DataReader#update and review your DataReader configuration.",realize:"#realize was called with invalid remote-data.  Please see the docs for DataReader#realize and review your DataReader configuration.","invalid-response":"#readResponse received an invalid response from the server."}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.DataWriter=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.data.DataWriter.prototype={writeAllFields:false,listful:false,apply:function(E,F,D,A){var C=[],B=D+"Record";
if(CQ.Ext.isArray(A)){CQ.Ext.each(A,function(G){C.push(this[B](G))
},this)
}else{if(A instanceof CQ.Ext.data.Record){C=this[B](A)
}}this.render(E,F,C)
},render:CQ.Ext.emptyFn,updateRecord:CQ.Ext.emptyFn,createRecord:CQ.Ext.emptyFn,destroyRecord:CQ.Ext.emptyFn,toHash:function(F,C){var E=F.fields.map,D={},B=(this.writeAllFields===false&&F.phantom===false)?F.getChanges():F.data,A;
CQ.Ext.iterate(B,function(H,G){if((A=E[H])){D[A.mapping?A.mapping:A.name]=G
}});
if(F.phantom){if(F.fields.containsKey(this.meta.idProperty)&&CQ.Ext.isEmpty(F.data[this.meta.idProperty])){delete D[this.meta.idProperty]
}}else{D[this.meta.idProperty]=F.id
}return D
},toArray:function(B){var A=[];
CQ.Ext.iterate(B,function(D,C){A.push({name:D,value:C})
},this);
return A
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.DataProxy=function(A){A=A||{};
this.api=A.api;
this.url=A.url;
this.restful=A.restful;
this.listeners=A.listeners;
this.prettyUrls=A.prettyUrls;
this.addEvents("exception","beforeload","load","loadexception","beforewrite","write");
CQ.Ext.data.DataProxy.superclass.constructor.call(this);
try{CQ.Ext.data.Api.prepare(this)
}catch(B){if(B instanceof CQ.Ext.data.Api.Error){B.toConsole()
}}CQ.Ext.data.DataProxy.relayEvents(this,["beforewrite","write","exception"])
};
CQ.Ext.extend(CQ.Ext.data.DataProxy,CQ.Ext.util.Observable,{restful:false,setApi:function(){if(arguments.length==1){var A=CQ.Ext.data.Api.isValid(arguments[0]);
if(A===true){this.api=arguments[0]
}else{throw new CQ.Ext.data.Api.Error("invalid",A)
}}else{if(arguments.length==2){if(!CQ.Ext.data.Api.isAction(arguments[0])){throw new CQ.Ext.data.Api.Error("invalid",arguments[0])
}this.api[arguments[0]]=arguments[1]
}}CQ.Ext.data.Api.prepare(this)
},isApiAction:function(A){return(this.api[A])?true:false
},request:function(E,B,F,A,G,D,C){if(!this.api[E]&&!this.load){throw new CQ.Ext.data.DataProxy.Error("action-undefined",E)
}F=F||{};
if((E===CQ.Ext.data.Api.actions.read)?this.fireEvent("beforeload",this,F):this.fireEvent("beforewrite",this,E,B,F)!==false){this.doRequest.apply(this,arguments)
}else{G.call(D||this,null,C,false)
}},load:null,doRequest:function(E,B,F,A,G,D,C){this.load(F,A,G,D,C)
},onRead:CQ.Ext.emptyFn,onWrite:CQ.Ext.emptyFn,buildUrl:function(D,B){B=B||null;
var C=(this.conn&&this.conn.url)?this.conn.url:(this.api[D])?this.api[D].url:this.url;
if(!C){throw new CQ.Ext.data.Api.Error("invalid-url",D)
}var E=null;
var A=C.match(/(.*)(\.json|\.xml|\.html)$/);
if(A){E=A[2];
C=A[1]
}if((this.restful===true||this.prettyUrls===true)&&B instanceof CQ.Ext.data.Record&&!B.phantom){C+="/"+B.id
}return(E===null)?C:C+E
},destroy:function(){this.purgeListeners()
}});
CQ.Ext.apply(CQ.Ext.data.DataProxy,CQ.Ext.util.Observable.prototype);
CQ.Ext.util.Observable.call(CQ.Ext.data.DataProxy);
CQ.Ext.data.DataProxy.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(B,A){this.arg=A;
CQ.Ext.Error.call(this,B)
},name:"CQ.Ext.data.DataProxy"});
CQ.Ext.apply(CQ.Ext.data.DataProxy.Error.prototype,{lang:{"action-undefined":"DataProxy attempted to execute an API-action but found an undefined url / function.  Please review your Proxy url/api-configuration.","api-invalid":"Recieved an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions from CQ.Ext.data.Api.actions."}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Request=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.data.Request.prototype={action:undefined,rs:undefined,params:undefined,callback:CQ.Ext.emptyFn,scope:undefined,reader:undefined};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Response=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.data.Response.prototype={action:undefined,success:undefined,message:undefined,data:undefined,raw:undefined,records:undefined};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.ScriptTagProxy=function(A){CQ.Ext.apply(this,A);
CQ.Ext.data.ScriptTagProxy.superclass.constructor.call(this,A);
this.head=document.getElementsByTagName("head")[0]
};
CQ.Ext.data.ScriptTagProxy.TRANS_ID=1000;
CQ.Ext.extend(CQ.Ext.data.ScriptTagProxy,CQ.Ext.data.DataProxy,{timeout:30000,callbackParam:"callback",nocache:true,doRequest:function(E,F,D,G,I,J,K){var C=CQ.Ext.urlEncode(CQ.Ext.apply(D,this.extraParams));
var B=this.buildUrl(E,F);
if(!B){throw new CQ.Ext.data.Api.Error("invalid-url",B)
}B=CQ.Ext.urlAppend(B,C);
if(this.nocache){B=CQ.Ext.urlAppend(B,"_dc="+(new Date().getTime()))
}var A=++CQ.Ext.data.ScriptTagProxy.TRANS_ID;
var L={id:A,action:E,cb:"stcCallback"+A,scriptId:"stcScript"+A,params:D,arg:K,url:B,callback:I,scope:J,reader:G};
window[L.cb]=this.createCallback(E,F,L);
B+=String.format("&{0}={1}",this.callbackParam,L.cb);
if(this.autoAbort!==false){this.abort()
}L.timeoutId=this.handleFailure.defer(this.timeout,this,[L]);
var H=document.createElement("script");
H.setAttribute("src",B);
H.setAttribute("type","text/javascript");
H.setAttribute("id",L.scriptId);
this.head.appendChild(H);
this.trans=L
},createCallback:function(D,B,C){var A=this;
return function(E){A.trans=false;
A.destroyTrans(C,true);
if(D===CQ.Ext.data.Api.actions.read){A.onRead.call(A,D,C,E)
}else{A.onWrite.call(A,D,C,E,B)
}}
},onRead:function(D,C,B){var A;
try{A=C.reader.readRecords(B)
}catch(E){this.fireEvent("loadexception",this,C,B,E);
this.fireEvent("exception",this,"response",D,C,B,E);
C.callback.call(C.scope||window,null,C.arg,false);
return 
}if(A.success===false){this.fireEvent("loadexception",this,C,B);
this.fireEvent("exception",this,"remote",D,C,B,null)
}else{this.fireEvent("load",this,B,C.arg)
}C.callback.call(C.scope||window,A,C.arg,A.success)
},onWrite:function(F,E,C,B){var A=E.reader;
try{var D=A.readResponse(F,C)
}catch(G){this.fireEvent("exception",this,"response",F,E,D,G);
E.callback.call(E.scope||window,null,D,false);
return 
}if(!D.success===true){this.fireEvent("exception",this,"remote",F,E,D,B);
E.callback.call(E.scope||window,null,D,false);
return 
}this.fireEvent("write",this,F,D.data,D,B,E.arg);
E.callback.call(E.scope||window,D.data,D,true)
},isLoading:function(){return this.trans?true:false
},abort:function(){if(this.isLoading()){this.destroyTrans(this.trans)
}},destroyTrans:function(B,A){this.head.removeChild(document.getElementById(B.scriptId));
clearTimeout(B.timeoutId);
if(A){window[B.cb]=undefined;
try{delete window[B.cb]
}catch(C){}}else{window[B.cb]=function(){window[B.cb]=undefined;
try{delete window[B.cb]
}catch(D){}}
}},handleFailure:function(A){this.trans=false;
this.destroyTrans(A,false);
if(A.action===CQ.Ext.data.Api.actions.read){this.fireEvent("loadexception",this,null,A.arg)
}this.fireEvent("exception",this,"response",A.action,{response:null,options:A.arg});
A.callback.call(A.scope||window,null,A.arg,false)
},destroy:function(){this.abort();
CQ.Ext.data.ScriptTagProxy.superclass.destroy.call(this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.HttpProxy=function(A){CQ.Ext.data.HttpProxy.superclass.constructor.call(this,A);
this.conn=A;
this.conn.url=null;
this.useAjax=!A||!A.events;
var C=CQ.Ext.data.Api.actions;
this.activeRequest={};
for(var B in C){this.activeRequest[C[B]]=undefined
}};
CQ.Ext.extend(CQ.Ext.data.HttpProxy,CQ.Ext.data.DataProxy,{getConnection:function(){return this.useAjax?CQ.Ext.Ajax:this.conn
},setUrl:function(A,B){this.conn.url=A;
if(B===true){this.url=A;
this.api=null;
CQ.Ext.data.Api.prepare(this)
}},doRequest:function(F,D,H,C,B,E,A){var G={method:(this.api[F])?this.api[F]["method"]:undefined,request:{callback:B,scope:E,arg:A},reader:C,callback:this.createCallback(F,D),scope:this};
if(H.jsonData){G.jsonData=H.jsonData
}else{if(H.xmlData){G.xmlData=H.xmlData
}else{G.params=H||{}
}}this.conn.url=this.buildUrl(F,D);
if(this.useAjax){CQ.Ext.applyIf(G,this.conn);
if(this.activeRequest[F]){}this.activeRequest[F]=CQ.Ext.Ajax.request(G)
}else{this.conn.request(G)
}this.conn.url=null
},createCallback:function(B,A){return function(E,D,C){this.activeRequest[B]=undefined;
if(!D){if(B===CQ.Ext.data.Api.actions.read){this.fireEvent("loadexception",this,E,C)
}this.fireEvent("exception",this,"response",B,E,C);
E.request.callback.call(E.request.scope,null,E.request.arg,false);
return 
}if(B===CQ.Ext.data.Api.actions.read){this.onRead(B,E,C)
}else{this.onWrite(B,E,C,A)
}}
},onRead:function(D,F,B){var A;
try{A=F.reader.read(B)
}catch(E){this.fireEvent("loadexception",this,F,B,E);
this.fireEvent("exception",this,"response",D,F,B,E);
F.request.callback.call(F.request.scope,null,F.request.arg,false);
return 
}if(A.success===false){this.fireEvent("loadexception",this,F,B);
var C=F.reader.readResponse(D,B);
this.fireEvent("exception",this,"remote",D,F,C,null)
}else{this.fireEvent("load",this,F,F.request.arg)
}F.request.callback.call(F.request.scope,A,F.request.arg,A.success)
},onWrite:function(E,G,C,B){var A=G.reader;
var D;
try{D=A.readResponse(E,C)
}catch(F){this.fireEvent("exception",this,"response",E,G,C,F);
G.request.callback.call(G.request.scope,null,G.request.arg,false);
return 
}if(D.success===true){this.fireEvent("write",this,E,D.data,D,B,G.request.arg)
}else{this.fireEvent("exception",this,"remote",E,G,D,B)
}G.request.callback.call(G.request.scope,D.data,D,D.success)
},destroy:function(){if(!this.useAjax){this.conn.abort()
}else{if(this.activeRequest){var B=CQ.Ext.data.Api.actions;
for(var A in B){if(this.activeRequest[B[A]]){CQ.Ext.Ajax.abort(this.activeRequest[B[A]])
}}}}CQ.Ext.data.HttpProxy.superclass.destroy.call(this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.MemoryProxy=function(B){var A={};
A[CQ.Ext.data.Api.actions.read]=true;
CQ.Ext.data.MemoryProxy.superclass.constructor.call(this,{api:A});
this.data=B
};
CQ.Ext.extend(CQ.Ext.data.MemoryProxy,CQ.Ext.data.DataProxy,{doRequest:function(B,C,A,D,F,G,H){A=A||{};
var I;
try{I=D.readRecords(this.data)
}catch(E){this.fireEvent("loadexception",this,null,H,E);
this.fireEvent("exception",this,"response",B,H,null,E);
F.call(G,null,H,false);
return 
}F.call(G,I,H,true)
}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Types=new function(){var A=CQ.Ext.data.SortTypes;
CQ.Ext.apply(this,{stripRe:/[\$,%]/g,AUTO:{convert:function(B){return B
},sortType:A.none,type:"auto"},STRING:{convert:function(B){return(B===undefined||B===null)?"":String(B)
},sortType:A.asUCString,type:"string"},INT:{convert:function(B){return B!==undefined&&B!==null&&B!==""?parseInt(String(B).replace(CQ.Ext.data.Types.stripRe,""),10):(this.useNull?null:0)
},sortType:A.none,type:"int"},FLOAT:{convert:function(B){return B!==undefined&&B!==null&&B!==""?parseFloat(String(B).replace(CQ.Ext.data.Types.stripRe,""),10):(this.useNull?null:0)
},sortType:A.none,type:"float"},BOOL:{convert:function(B){return B===true||B==="true"||B==1
},sortType:A.none,type:"bool"},DATE:{convert:function(C){var D=this.dateFormat;
if(!C){return null
}if(CQ.Ext.isDate(C)){return C
}if(D){if(D=="timestamp"){return new Date(C*1000)
}if(D=="time"){return new Date(parseInt(C,10))
}return Date.parseDate(C,D)
}var B=Date.parse(C);
return B?new Date(B):null
},sortType:A.asDate,type:"date"}});
CQ.Ext.apply(this,{BOOLEAN:this.BOOL,INTEGER:this.INT,NUMBER:this.FLOAT})
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.JsonWriter=CQ.Ext.extend(CQ.Ext.data.DataWriter,{encode:true,encodeDelete:false,constructor:function(A){CQ.Ext.data.JsonWriter.superclass.constructor.call(this,A)
},render:function(C,D,B){if(this.encode===true){CQ.Ext.apply(C,D);
C[this.meta.root]=CQ.Ext.encode(B)
}else{var A=CQ.Ext.apply({},D);
A[this.meta.root]=B;
C.jsonData=A
}},createRecord:function(A){return this.toHash(A)
},updateRecord:function(A){return this.toHash(A)
},destroyRecord:function(B){if(this.encodeDelete){var A={};
A[this.meta.idProperty]=B.id;
return A
}else{return B.id
}}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.JsonReader=function(A,B){A=A||{};
CQ.Ext.applyIf(A,{idProperty:"id",successProperty:"success",totalProperty:"total"});
CQ.Ext.data.JsonReader.superclass.constructor.call(this,A,B||A.fields)
};
CQ.Ext.extend(CQ.Ext.data.JsonReader,CQ.Ext.data.DataReader,{read:function(A){var B=A.responseText;
var C=CQ.Ext.decode(B);
if(!C){throw {message:"JsonReader.read: Json object not found"}
}return this.readRecords(C)
},readResponse:function(E,B){var F=(B.responseText!==undefined)?CQ.Ext.decode(B.responseText):B;
if(!F){throw new CQ.Ext.data.JsonReader.Error("response")
}var A=this.getRoot(F);
if(E===CQ.Ext.data.Api.actions.create){var D=CQ.Ext.isDefined(A);
if(D&&CQ.Ext.isEmpty(A)){throw new CQ.Ext.data.JsonReader.Error("root-empty",this.meta.root)
}else{if(!D){throw new CQ.Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)
}}}var C=new CQ.Ext.data.Response({action:E,success:this.getSuccess(F),data:(A)?this.extractData(A,false):[],message:this.getMessage(F),raw:F});
if(CQ.Ext.isEmpty(C.success)){throw new CQ.Ext.data.JsonReader.Error("successProperty-response",this.meta.successProperty)
}return C
},readRecords:function(A){this.jsonData=A;
if(A.metaData){this.onMetaChange(A.metaData)
}var K=this.meta,F=this.recordType,B=F.prototype.fields,J=B.items,G=B.length,H;
var E=this.getRoot(A),D=E.length,C=D,I=true;
if(K.totalProperty){H=parseInt(this.getTotal(A),10);
if(!isNaN(H)){C=H
}}if(K.successProperty){H=this.getSuccess(A);
if(H===false||H==="false"){I=false
}}return{success:I,records:this.extractData(E,true),totalRecords:C}
},buildExtractors:function(){if(this.ef){return 
}var I=this.meta,F=this.recordType,E=F.prototype.fields,H=E.items,G=E.length;
if(I.totalProperty){this.getTotal=this.createAccessor(I.totalProperty)
}if(I.successProperty){this.getSuccess=this.createAccessor(I.successProperty)
}if(I.messageProperty){this.getMessage=this.createAccessor(I.messageProperty)
}this.getRoot=I.root?this.createAccessor(I.root):function(J){return J
};
if(I.id||I.idProperty){var D=this.createAccessor(I.id||I.idProperty);
this.getId=function(K){var J=D(K);
return(J===undefined||J==="")?null:J
}
}else{this.getId=function(){return null
}
}var C=[];
for(var B=0;
B<G;
B++){E=H[B];
var A=(E.mapping!==undefined&&E.mapping!==null)?E.mapping:E.name;
C.push(this.createAccessor(A))
}this.ef=C
},simpleAccess:function(B,A){return B[A]
},createAccessor:function(){var A=/[\[\.]/;
return function(C){if(CQ.Ext.isEmpty(C)){return CQ.Ext.emptyFn
}if(CQ.Ext.isFunction(C)){return C
}var B=String(C).search(A);
if(B>=0){return new Function("obj","return obj"+(B>0?".":"")+C)
}return function(D){return D[C]
}
}
}(),extractValues:function(G,D,A){var F,C={};
for(var E=0;
E<A;
E++){F=D[E];
var B=this.ef[E](G);
C[F.name]=F.convert((B!==undefined)?B:F.defaultValue,G)
}return C
}});
CQ.Ext.data.JsonReader.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(B,A){this.arg=A;
CQ.Ext.Error.call(this,B)
},name:"CQ.Ext.data.JsonReader"});
CQ.Ext.apply(CQ.Ext.data.JsonReader.Error.prototype,{lang:{response:"An error occurred while json-decoding your server response","successProperty-response":'Could not locate your "successProperty" in your server response.  Please review your JsonReader config to ensure the config-property "successProperty" matches the property in your server-response.  See the JsonReader docs.',"root-undefined-config":'Your JsonReader was configured without a "root" property.  Please review your JsonReader config and make sure to define the root property.  See the JsonReader docs.',"idProperty-undefined":'Your JsonReader was configured without an "idProperty"  Please review your JsonReader configuration and ensure the "idProperty" is set (e.g.: "id").  See the JsonReader docs.',"root-empty":'Data was expected to be returned by the server in the "root" property of the response.  Please review your JsonReader configuration to ensure the "root" property matches that returned in the server-response.  See JsonReader docs.'}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.ArrayReader=CQ.Ext.extend(CQ.Ext.data.JsonReader,{readRecords:function(L){this.arrayData=L;
var H=this.meta,D=H?CQ.Ext.num(H.idIndex,H.id):null,B=this.recordType,K=B.prototype.fields,R=[],E=true,F;
var N=this.getRoot(L);
for(var Q=0,S=N.length;
Q<S;
Q++){var M=N[Q],A={},J=((D||D===0)&&M[D]!==undefined&&M[D]!==""?M[D]:null);
for(var P=0,I=K.length;
P<I;
P++){var T=K.items[P],O=T.mapping!==undefined&&T.mapping!==null?T.mapping:P;
F=M[O]!==undefined?M[O]:T.defaultValue;
F=T.convert(F,M);
A[T.name]=F
}var C=new B(A,J);
C.json=M;
R[R.length]=C
}var G=R.length;
if(H.totalProperty){F=parseInt(this.getTotal(L),10);
if(!isNaN(F)){G=F
}}if(H.successProperty){F=this.getSuccess(L);
if(F===false||F==="false"){E=false
}}return{success:E,records:R,totalRecords:G}
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.ArrayStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(A){CQ.Ext.data.ArrayStore.superclass.constructor.call(this,CQ.Ext.apply(A,{reader:new CQ.Ext.data.ArrayReader(A)}))
},loadData:function(E,B){if(this.expandData===true){var D=[];
for(var C=0,A=E.length;
C<A;
C++){D[D.length]=[E[C]]
}E=D
}CQ.Ext.data.ArrayStore.superclass.loadData.call(this,E,B)
}});
CQ.Ext.reg("arraystore",CQ.Ext.data.ArrayStore);
CQ.Ext.data.SimpleStore=CQ.Ext.data.ArrayStore;
CQ.Ext.reg("simplestore",CQ.Ext.data.SimpleStore);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.JsonStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(A){CQ.Ext.data.JsonStore.superclass.constructor.call(this,CQ.Ext.apply(A,{reader:new CQ.Ext.data.JsonReader(A)}))
}});
CQ.Ext.reg("jsonstore",CQ.Ext.data.JsonStore);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.XmlWriter=function(A){CQ.Ext.data.XmlWriter.superclass.constructor.apply(this,arguments);
this.tpl=(typeof (this.tpl)==="string")?new CQ.Ext.XTemplate(this.tpl).compile():this.tpl.compile()
};
CQ.Ext.extend(CQ.Ext.data.XmlWriter,CQ.Ext.data.DataWriter,{documentRoot:"xrequest",forceDocumentRoot:false,root:"records",xmlVersion:"1.0",xmlEncoding:"ISO-8859-15",tpl:'<tpl for="."><?xml version="{version}" encoding="{encoding}"?><tpl if="documentRoot"><{documentRoot}><tpl for="baseParams"><tpl for="."><{name}>{value}</{name}</tpl></tpl></tpl><tpl if="records.length&gt;1"><{root}></tpl><tpl for="records"><{parent.record}><tpl for="."><{name}>{value}</{name}></tpl></{parent.record}></tpl><tpl if="records.length&gt;1"></{root}></tpl><tpl if="documentRoot"></{documentRoot}></tpl></tpl>',render:function(B,C,A){C=this.toArray(C);
B.xmlData=this.tpl.applyTemplate({version:this.xmlVersion,encoding:this.xmlEncoding,documentRoot:(C.length>0||this.forceDocumentRoot===true)?this.documentRoot:false,record:this.meta.record,root:this.root,baseParams:C,records:(CQ.Ext.isArray(A[0]))?A:[A]})
},createRecord:function(A){return this.toArray(this.toHash(A))
},updateRecord:function(A){return this.toArray(this.toHash(A))
},destroyRecord:function(B){var A={};
A[this.meta.idProperty]=B.id;
return this.toArray(A)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.XmlReader=function(A,B){A=A||{};
CQ.Ext.applyIf(A,{idProperty:A.idProperty||A.idPath||A.id,successProperty:A.successProperty||A.success});
CQ.Ext.data.XmlReader.superclass.constructor.call(this,A,B||A.fields)
};
CQ.Ext.extend(CQ.Ext.data.XmlReader,CQ.Ext.data.DataReader,{read:function(A){var B=A.responseXML;
if(!B){throw {message:"XmlReader.read: XML Document not available"}
}return this.readRecords(B)
},readRecords:function(D){this.xmlData=D;
var A=D.documentElement||D,C=CQ.Ext.DomQuery,F=0,E=true;
if(this.meta.totalProperty){F=this.getTotal(A,0)
}if(this.meta.successProperty){E=this.getSuccess(A)
}var B=this.extractData(C.select(this.meta.record,A),true);
return{success:E,records:B,totalRecords:F||B.length}
},readResponse:function(E,A){var D=CQ.Ext.DomQuery,F=A.responseXML;
var B=new CQ.Ext.data.Response({action:E,success:this.getSuccess(F),message:this.getMessage(F),data:this.extractData(D.select(this.meta.record,F)||D.select(this.meta.root,F),false),raw:F});
if(CQ.Ext.isEmpty(B.success)){throw new CQ.Ext.data.DataReader.Error("successProperty-response",this.meta.successProperty)
}if(E===CQ.Ext.data.Api.actions.create){var C=CQ.Ext.isDefined(B.data);
if(C&&CQ.Ext.isEmpty(B.data)){throw new CQ.Ext.data.JsonReader.Error("root-empty",this.meta.root)
}else{if(!C){throw new CQ.Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)
}}}return B
},getSuccess:function(){return true
},buildExtractors:function(){if(this.ef){return 
}var I=this.meta,F=this.recordType,E=F.prototype.fields,H=E.items,G=E.length;
if(I.totalProperty){this.getTotal=this.createAccessor(I.totalProperty)
}if(I.successProperty){this.getSuccess=this.createAccessor(I.successProperty)
}if(I.messageProperty){this.getMessage=this.createAccessor(I.messageProperty)
}this.getRoot=function(J){return(!CQ.Ext.isEmpty(J[this.meta.record]))?J[this.meta.record]:J[this.meta.root]
};
if(I.idPath||I.idProperty){var D=this.createAccessor(I.idPath||I.idProperty);
this.getId=function(J){var K=D(J)||J.id;
return(K===undefined||K==="")?null:K
}
}else{this.getId=function(){return null
}
}var C=[];
for(var B=0;
B<G;
B++){E=H[B];
var A=(E.mapping!==undefined&&E.mapping!==null)?E.mapping:E.name;
C.push(this.createAccessor(A))
}this.ef=C
},createAccessor:function(){var A=CQ.Ext.DomQuery;
return function(B){switch(B){case this.meta.totalProperty:return function(C,D){return A.selectNumber(B,C,D)
};
break;
case this.meta.successProperty:return function(D,E){var C=A.selectValue(B,D,true);
var F=C!==false&&C!=="false";
return F
};
break;
default:return function(C,D){return A.selectValue(B,C,D)
};
break
}}
}(),extractValues:function(G,D,A){var F,C={};
for(var E=0;
E<A;
E++){F=D[E];
var B=this.ef[E](G);
C[F.name]=F.convert((B!==undefined)?B:F.defaultValue,G)
}return C
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.XmlStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(A){CQ.Ext.data.XmlStore.superclass.constructor.call(this,CQ.Ext.apply(A,{reader:new CQ.Ext.data.XmlReader(A)}))
}});
CQ.Ext.reg("xmlstore",CQ.Ext.data.XmlStore);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.GroupingStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(A){CQ.Ext.data.GroupingStore.superclass.constructor.call(this,A);
this.applyGroupField()
},remoteGroup:false,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;
if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;
delete this.baseParams.groupDir
}var A=this.lastOptions;
if(A&&A.params){delete A.params.groupBy;
delete A.params.groupDir
}this.reload()
}else{this.applySort();
this.fireEvent("datachanged",this)
}},groupBy:function(D,B,C){C=C?(String(C).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;
if(this.groupField==D&&this.groupDir==C&&!B){return 
}this.groupField=D;
this.groupDir=C;
this.applyGroupField();
if(this.groupOnSort){this.sort(D,C);
return 
}if(this.remoteGroup){this.reload()
}else{var A=this.sortInfo||{};
if(B||A.field!=D||A.direction!=C){this.applySort()
}else{this.sortData(D,C)
}this.fireEvent("datachanged",this)
}},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}
}CQ.Ext.apply(this.baseParams,{groupBy:this.groupField,groupDir:this.groupDir});
var A=this.lastOptions;
if(A&&A.params){CQ.Ext.apply(A.params,{groupBy:this.groupField,groupDir:this.groupDir})
}}},applySort:function(){CQ.Ext.data.GroupingStore.superclass.applySort.call(this);
if(!this.groupOnSort&&!this.remoteGroup){var A=this.getGroupState();
if(A&&(A!=this.sortInfo.field||this.groupDir!=this.sortInfo.direction)){this.sortData(this.groupField,this.groupDir)
}}},applyGrouping:function(A){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);
return true
}else{if(A===true){this.fireEvent("datachanged",this)
}return false
}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField
}});
CQ.Ext.reg("groupingstore",CQ.Ext.data.GroupingStore);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.DirectProxy=function(A){CQ.Ext.apply(this,A);
if(typeof this.paramOrder=="string"){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}CQ.Ext.data.DirectProxy.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.Ext.data.DirectProxy,CQ.Ext.data.DataProxy,{paramOrder:undefined,paramsAsHash:true,directFn:undefined,doRequest:function(B,C,A,E,I,J,L){var H=[],G=this.api[B]||this.directFn;
switch(B){case CQ.Ext.data.Api.actions.create:H.push(A.jsonData);
break;
case CQ.Ext.data.Api.actions.read:if(G.directCfg.method.len>0){if(this.paramOrder){for(var D=0,F=this.paramOrder.length;
D<F;
D++){H.push(A[this.paramOrder[D]])
}}else{if(this.paramsAsHash){H.push(A)
}}}break;
case CQ.Ext.data.Api.actions.update:H.push(A.jsonData);
break;
case CQ.Ext.data.Api.actions.destroy:H.push(A.jsonData);
break
}var K={params:A||{},request:{callback:I,scope:J,arg:L},reader:E};
H.push(this.createCallback(B,C,K),this);
G.apply(window,H)
},createCallback:function(C,A,B){return function(D,E){if(!E.status){if(C===CQ.Ext.data.Api.actions.read){this.fireEvent("loadexception",this,B,E,null)
}this.fireEvent("exception",this,"remote",C,B,E,null);
B.request.callback.call(B.request.scope,null,B.request.arg,false);
return 
}if(C===CQ.Ext.data.Api.actions.read){this.onRead(C,B,D,E)
}else{this.onWrite(C,B,D,E,A)
}}
},onRead:function(F,E,A,D){var B;
try{B=E.reader.readRecords(A)
}catch(C){this.fireEvent("loadexception",this,E,D,C);
this.fireEvent("exception",this,"response",F,E,D,C);
E.request.callback.call(E.request.scope,null,E.request.arg,false);
return 
}this.fireEvent("load",this,D,E.request.arg);
E.request.callback.call(E.request.scope,B,E.request.arg,true)
},onWrite:function(F,D,A,C,B){var E=D.reader.extractData(A,false);
this.fireEvent("write",this,F,E,C,B,D.request.arg);
D.request.callback.call(D.request.scope,E,C,true)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.DirectStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(A){var B=CQ.Ext.apply({},{batchTransactions:false},A);
CQ.Ext.data.DirectStore.superclass.constructor.call(this,CQ.Ext.apply(B,{proxy:CQ.Ext.isDefined(B.proxy)?B.proxy:new CQ.Ext.data.DirectProxy(CQ.Ext.copyTo({},B,"paramOrder,paramsAsHash,directFn,api")),reader:(!CQ.Ext.isDefined(B.reader)&&B.fields)?new CQ.Ext.data.JsonReader(CQ.Ext.copyTo({},B,"totalProperty,root,idProperty"),B.fields):B.reader}))
}});
CQ.Ext.reg("directstore",CQ.Ext.data.DirectStore);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Direct=CQ.Ext.extend(CQ.Ext.util.Observable,{exceptions:{TRANSPORT:"xhr",PARSE:"parse",LOGIN:"login",SERVER:"exception"},constructor:function(){this.addEvents("event","exception");
this.transactions={};
this.providers={}
},addProvider:function(D){var B=arguments;
if(B.length>1){for(var C=0,A=B.length;
C<A;
C++){this.addProvider(B[C])
}return 
}if(!D.events){D=new CQ.Ext.Direct.PROVIDERS[D.type](D)
}D.id=D.id||CQ.Ext.id();
this.providers[D.id]=D;
D.on("data",this.onProviderData,this);
D.on("exception",this.onProviderException,this);
if(!D.isConnected()){D.connect()
}return D
},getProvider:function(A){return this.providers[A]
},removeProvider:function(B){var A=B.id?B:this.providers[B.id];
A.un("data",this.onProviderData,this);
A.un("exception",this.onProviderException,this);
delete this.providers[A.id];
return A
},addTransaction:function(A){this.transactions[A.tid]=A;
return A
},removeTransaction:function(A){delete this.transactions[A.tid||A];
return A
},getTransaction:function(A){return this.transactions[A.tid||A]
},onProviderData:function(D,C){if(CQ.Ext.isArray(C)){for(var B=0,A=C.length;
B<A;
B++){this.onProviderData(D,C[B])
}return 
}if(C.name&&C.name!="event"&&C.name!="exception"){this.fireEvent(C.name,C)
}else{if(C.type=="exception"){this.fireEvent("exception",C)
}}this.fireEvent("event",C,D)
},createEvent:function(A,B){return new CQ.Ext.Direct.eventTypes[A.type](CQ.Ext.apply(A,B))
}});
CQ.Ext.Direct=new CQ.Ext.Direct();
CQ.Ext.Direct.TID=1;
CQ.Ext.Direct.PROVIDERS={};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Direct.Transaction=function(A){CQ.Ext.apply(this,A);
this.tid=++CQ.Ext.Direct.TID;
this.retryCount=0
};
CQ.Ext.Direct.Transaction.prototype={send:function(){this.provider.queueTransaction(this)
},retry:function(){this.retryCount++;
this.send()
},getProvider:function(){return this.provider
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Direct.Event=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.Direct.Event.prototype={status:true,getData:function(){return this.data
}};
CQ.Ext.Direct.RemotingEvent=CQ.Ext.extend(CQ.Ext.Direct.Event,{type:"rpc",getTransaction:function(){return this.transaction||CQ.Ext.Direct.getTransaction(this.tid)
}});
CQ.Ext.Direct.ExceptionEvent=CQ.Ext.extend(CQ.Ext.Direct.RemotingEvent,{status:false,type:"exception"});
CQ.Ext.Direct.eventTypes={rpc:CQ.Ext.Direct.RemotingEvent,event:CQ.Ext.Direct.Event,exception:CQ.Ext.Direct.ExceptionEvent};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.direct.Provider=CQ.Ext.extend(CQ.Ext.util.Observable,{priority:1,constructor:function(A){CQ.Ext.apply(this,A);
this.addEvents("connect","disconnect","data","exception");
CQ.Ext.direct.Provider.superclass.constructor.call(this,A)
},isConnected:function(){return false
},connect:CQ.Ext.emptyFn,disconnect:CQ.Ext.emptyFn});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.direct.JsonProvider=CQ.Ext.extend(CQ.Ext.direct.Provider,{parseResponse:function(A){if(!CQ.Ext.isEmpty(A.responseText)){if(typeof A.responseText=="object"){return A.responseText
}return CQ.Ext.decode(A.responseText)
}return null
},getEvents:function(G){var E=null;
try{E=this.parseResponse(G)
}catch(F){var D=new CQ.Ext.Direct.ExceptionEvent({data:F,xhr:G,code:CQ.Ext.Direct.exceptions.PARSE,message:"Error parsing json response: \n\n "+E});
return[D]
}var C=[];
if(CQ.Ext.isArray(E)){for(var B=0,A=E.length;
B<A;
B++){C.push(CQ.Ext.Direct.createEvent(E[B]))
}}else{C.push(CQ.Ext.Direct.createEvent(E))
}return C
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.direct.PollingProvider=CQ.Ext.extend(CQ.Ext.direct.JsonProvider,{priority:3,interval:3000,constructor:function(A){CQ.Ext.direct.PollingProvider.superclass.constructor.call(this,A);
this.addEvents("beforepoll","poll")
},isConnected:function(){return !!this.pollTask
},connect:function(){if(this.url&&!this.pollTask){this.pollTask=CQ.Ext.TaskMgr.start({run:function(){if(this.fireEvent("beforepoll",this)!==false){if(typeof this.url=="function"){this.url(this.baseParams)
}else{CQ.Ext.Ajax.request({url:this.url,callback:this.onData,scope:this,params:this.baseParams})
}}},interval:this.interval,scope:this});
this.fireEvent("connect",this)
}else{if(!this.url){throw"Error initializing PollingProvider, no url configured."
}}},disconnect:function(){if(this.pollTask){CQ.Ext.TaskMgr.stop(this.pollTask);
delete this.pollTask;
this.fireEvent("disconnect",this)
}},onData:function(D,G,F){if(G){var C=this.getEvents(F);
for(var B=0,A=C.length;
B<A;
B++){var E=C[B];
this.fireEvent("data",this,E)
}}else{var E=new CQ.Ext.Direct.ExceptionEvent({data:E,code:CQ.Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:F});
this.fireEvent("data",this,E)
}}});
CQ.Ext.Direct.PROVIDERS.polling=CQ.Ext.direct.PollingProvider;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.direct.RemotingProvider=CQ.Ext.extend(CQ.Ext.direct.JsonProvider,{enableBuffer:10,maxRetries:1,timeout:undefined,constructor:function(A){CQ.Ext.direct.RemotingProvider.superclass.constructor.call(this,A);
this.addEvents("beforecall","call");
this.namespace=(CQ.Ext.isString(this.namespace))?CQ.Ext.ns(this.namespace):this.namespace||window;
this.transactions={};
this.callBuffer=[]
},initAPI:function(){var F=this.actions;
for(var G in F){var C=this.namespace[G]||(this.namespace[G]={}),D=F[G];
for(var E=0,B=D.length;
E<B;
E++){var A=D[E];
C[A.name]=this.createMethod(G,A)
}}},isConnected:function(){return !!this.connected
},connect:function(){if(this.url){this.initAPI();
this.connected=true;
this.fireEvent("connect",this)
}else{if(!this.url){throw"Error initializing RemotingProvider, no url configured."
}}},disconnect:function(){if(this.connected){this.connected=false;
this.fireEvent("disconnect",this)
}},onData:function(A,F,G){if(F){var H=this.getEvents(G);
for(var B=0,C=H.length;
B<C;
B++){var D=H[B],I=this.getTransaction(D);
this.fireEvent("data",this,D);
if(I){this.doCallback(I,D,true);
CQ.Ext.Direct.removeTransaction(I)
}}}else{var E=[].concat(A.ts);
for(var B=0,C=E.length;
B<C;
B++){var I=this.getTransaction(E[B]);
if(I&&I.retryCount<this.maxRetries){I.retry()
}else{var D=new CQ.Ext.Direct.ExceptionEvent({data:D,transaction:I,code:CQ.Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:G});
this.fireEvent("data",this,D);
if(I){this.doCallback(I,D,false);
CQ.Ext.Direct.removeTransaction(I)
}}}}},getCallData:function(A){return{action:A.action,method:A.method,data:A.data,type:"rpc",tid:A.tid}
},doSend:function(D){var F={url:this.url,callback:this.onData,scope:this,ts:D,timeout:this.timeout},B;
if(CQ.Ext.isArray(D)){B=[];
for(var C=0,A=D.length;
C<A;
C++){B.push(this.getCallData(D[C]))
}}else{B=this.getCallData(D)
}if(this.enableUrlEncode){var E={};
E[CQ.Ext.isString(this.enableUrlEncode)?this.enableUrlEncode:"data"]=CQ.Ext.encode(B);
F.params=E
}else{F.jsonData=B
}CQ.Ext.Ajax.request(F)
},combineAndSend:function(){var A=this.callBuffer.length;
if(A>0){this.doSend(A==1?this.callBuffer[0]:this.callBuffer);
this.callBuffer=[]
}},queueTransaction:function(A){if(A.form){this.processForm(A);
return 
}this.callBuffer.push(A);
if(this.enableBuffer){if(!this.callTask){this.callTask=new CQ.Ext.util.DelayedTask(this.combineAndSend,this)
}this.callTask.delay(CQ.Ext.isNumber(this.enableBuffer)?this.enableBuffer:10)
}else{this.combineAndSend()
}},doCall:function(G,A,B){var F=null,D=B[A.len],E=B[A.len+1];
if(A.len!==0){F=B.slice(0,A.len)
}var C=new CQ.Ext.Direct.Transaction({provider:this,args:B,action:G,method:A.name,data:F,cb:E&&CQ.Ext.isFunction(D)?D.createDelegate(E):D});
if(this.fireEvent("beforecall",this,C)!==false){CQ.Ext.Direct.addTransaction(C);
this.queueTransaction(C);
this.fireEvent("call",this,C)
}},doForm:function(H,B,E,G,D){var C=new CQ.Ext.Direct.Transaction({provider:this,action:H,method:B.name,args:[E,G,D],cb:D&&CQ.Ext.isFunction(G)?G.createDelegate(D):G,isForm:true});
if(this.fireEvent("beforecall",this,C)!==false){CQ.Ext.Direct.addTransaction(C);
var A=String(E.getAttribute("enctype")).toLowerCase()=="multipart/form-data",F={extTID:C.tid,extAction:H,extMethod:B.name,extType:"rpc",extUpload:String(A)};
CQ.Ext.apply(C,{form:CQ.Ext.getDom(E),isUpload:A,params:G&&CQ.Ext.isObject(G.params)?CQ.Ext.apply(F,G.params):F});
this.fireEvent("call",this,C);
this.processForm(C)
}},processForm:function(A){CQ.Ext.Ajax.request({url:this.url,params:A.params,callback:this.onData,scope:this,form:A.form,isUpload:A.isUpload,ts:A})
},createMethod:function(C,A){var B;
if(!A.formHandler){B=function(){this.doCall(C,A,Array.prototype.slice.call(arguments,0))
}.createDelegate(this)
}else{B=function(E,F,D){this.doForm(C,A,E,F,D)
}.createDelegate(this)
}B.directCfg={action:C,method:A};
return B
},getTransaction:function(A){return A&&A.tid?CQ.Ext.Direct.getTransaction(A.tid):null
},doCallback:function(C,E){var D=E.status?"success":"failure";
if(C&&C.cb){var B=C.cb,A=CQ.Ext.isDefined(E.result)?E.result:E.data;
if(CQ.Ext.isFunction(B)){B(A,E)
}else{CQ.Ext.callback(B[D],B.scope,[A,E]);
CQ.Ext.callback(B.callback,B.scope,[A,E])
}}}});
CQ.Ext.Direct.PROVIDERS.remoting=CQ.Ext.direct.RemotingProvider;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Resizable=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(D,E){this.el=CQ.Ext.get(D);
if(E&&E.wrap){E.resizeChild=this.el;
this.el=this.el.wrap(typeof E.wrap=="object"?E.wrap:{cls:"xresizable-wrap"});
this.el.id=this.el.dom.id=E.resizeChild.id+"-rzwrap";
this.el.setStyle("overflow","hidden");
this.el.setPositioning(E.resizeChild.getPositioning());
E.resizeChild.clearPositioning();
if(!E.width||!E.height){var F=E.resizeChild.getSize();
this.el.setSize(F.width,F.height)
}if(E.pinned&&!E.adjustments){E.adjustments="auto"
}}this.proxy=this.el.createProxy({tag:"div",cls:"x-resizable-proxy",id:this.el.id+"-rzproxy"},CQ.Util.getRoot());
this.proxy.unselectable();
this.proxy.enableDisplayMode("block");
CQ.Ext.apply(this,E);
if(this.pinned){this.disableTrackOver=true;
this.el.addClass("x-resizable-pinned")
}var I=this.el.getStyle("position");
if(I!="absolute"&&I!="fixed"){this.el.setStyle("position","relative")
}if(!this.handles){this.handles="s,e,se";
if(this.multiDirectional){this.handles+=",n,w"
}}if(this.handles=="all"){this.handles="n s e w ne nw se sw"
}var M=this.handles.split(/\s*?[,;]\s*?| /);
var C=CQ.Ext.Resizable.positions;
for(var H=0,J=M.length;
H<J;
H++){if(M[H]&&C[M[H]]){var L=C[M[H]];
this[L]=new CQ.Ext.Resizable.Handle(this,L,this.disableTrackOver,this.transparent,this.handleCls)
}}this.corner=this.southeast;
if(this.handles.indexOf("n")!=-1||this.handles.indexOf("w")!=-1){this.updateBox=true
}this.activeHandle=null;
if(this.resizeChild){if(typeof this.resizeChild=="boolean"){this.resizeChild=CQ.Ext.get(this.el.dom.firstChild,true)
}else{this.resizeChild=CQ.Ext.get(this.resizeChild,true)
}}if(this.adjustments=="auto"){var B=this.resizeChild;
var K=this.west,G=this.east,A=this.north,M=this.south;
if(B&&(K||A)){B.position("relative");
B.setLeft(K?K.el.getWidth():0);
B.setTop(A?A.el.getHeight():0)
}this.adjustments=[(G?-G.el.getWidth():0)+(K?-K.el.getWidth():0),(A?-A.el.getHeight():0)+(M?-M.el.getHeight():0)-1]
}if(this.draggable){this.dd=this.dynamic?this.el.initDD(null):this.el.initDDProxy(null,{dragElId:this.proxy.id});
this.dd.setHandleElId(this.resizeChild?this.resizeChild.id:this.el.id);
if(this.constrainTo){this.dd.constrainTo(this.constrainTo)
}}this.addEvents("beforeresize","resize");
if(this.width!==null&&this.height!==null){this.resizeTo(this.width,this.height)
}else{this.updateChildSize()
}if(CQ.Ext.isIE){this.el.dom.style.zoom=1
}CQ.Ext.Resizable.superclass.constructor.call(this)
},adjustments:[0,0],animate:false,disableTrackOver:false,draggable:false,duration:0.35,dynamic:false,easing:"easeOutStrong",enabled:true,handles:false,multiDirectional:false,height:null,width:null,heightIncrement:0,widthIncrement:0,minHeight:5,minWidth:5,maxHeight:10000,maxWidth:10000,minX:0,minY:0,pinned:false,preserveRatio:false,resizeChild:false,transparent:false,resizeTo:function(B,A){this.el.setSize(B,A);
this.updateChildSize();
this.fireEvent("resize",this,B,A,null)
},startSizing:function(C,B){this.fireEvent("beforeresize",this,C);
if(this.enabled){if(!this.overlay){this.overlay=this.el.createProxy({tag:"div",cls:"x-resizable-overlay",html:"&#160;"},CQ.Util.getRoot());
this.overlay.unselectable();
this.overlay.enableDisplayMode("block");
this.overlay.on({scope:this,mousemove:this.onMouseMove,mouseup:this.onMouseUp})
}this.overlay.setStyle("cursor",B.el.getStyle("cursor"));
this.resizing=true;
this.startBox=this.el.getBox();
this.startPoint=C.getXY();
this.offsets=[(this.startBox.x+this.startBox.width)-this.startPoint[0],(this.startBox.y+this.startBox.height)-this.startPoint[1]];
this.overlay.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
if(this.constrainTo){var A=CQ.Ext.get(this.constrainTo);
this.resizeRegion=A.getRegion().adjust(A.getFrameWidth("t"),A.getFrameWidth("l"),-A.getFrameWidth("b"),-A.getFrameWidth("r"))
}this.proxy.setStyle("visibility","hidden");
this.proxy.show();
this.proxy.setBox(this.startBox);
if(!this.dynamic){this.proxy.setStyle("visibility","visible")
}}},onMouseDown:function(A,B){if(this.enabled){B.stopEvent();
this.activeHandle=A;
this.startSizing(B,A)
}},onMouseUp:function(B){this.activeHandle=null;
var A=this.resizeElement();
this.resizing=false;
this.handleOut();
this.overlay.hide();
this.proxy.hide();
this.fireEvent("resize",this,A.width,A.height,B)
},updateChildSize:function(){if(this.resizeChild){var C=this.el;
var D=this.resizeChild;
var B=this.adjustments;
if(C.dom.offsetWidth){var A=C.getSize(true);
D.setSize(A.width+B[0],A.height+B[1])
}if(CQ.Ext.isIE){setTimeout(function(){if(C.dom.offsetWidth){var E=C.getSize(true);
D.setSize(E.width+B[0],E.height+B[1])
}},10)
}}},snap:function(C,E,B){if(!E||!C){return C
}var D=C;
var A=C%E;
if(A>0){if(A>(E/2)){D=C+(E-A)
}else{D=C-A
}}return Math.max(B,D)
},resizeElement:function(){var A=this.proxy.getBox();
if(this.updateBox){this.el.setBox(A,false,this.animate,this.duration,null,this.easing)
}else{this.el.setSize(A.width,A.height,this.animate,this.duration,null,this.easing)
}this.updateChildSize();
if(!this.dynamic){this.proxy.hide()
}if(this.draggable&&this.constrainTo){this.dd.resetConstraints();
this.dd.constrainTo(this.constrainTo)
}return A
},constrain:function(B,C,A,D){if(B-C<A){C=B-A
}else{if(B-C>D){C=B-D
}}return C
},onMouseMove:function(T){if(this.enabled&&this.activeHandle){try{if(this.resizeRegion&&!this.resizeRegion.contains(T.getPoint())){return 
}var Q=this.curSize||this.startBox,I=this.startBox.x,H=this.startBox.y,C=I,B=H,J=Q.width,R=Q.height,D=J,L=R,K=this.minWidth,U=this.minHeight,P=this.maxWidth,X=this.maxHeight,F=this.widthIncrement,A=this.heightIncrement,V=T.getXY(),O=-(this.startPoint[0]-Math.max(this.minX,V[0])),M=-(this.startPoint[1]-Math.max(this.minY,V[1])),G=this.activeHandle.position,Y,E;
switch(G){case"east":J+=O;
J=Math.min(Math.max(K,J),P);
break;
case"south":R+=M;
R=Math.min(Math.max(U,R),X);
break;
case"southeast":J+=O;
R+=M;
J=Math.min(Math.max(K,J),P);
R=Math.min(Math.max(U,R),X);
break;
case"north":M=this.constrain(R,M,U,X);
H+=M;
R-=M;
break;
case"west":O=this.constrain(J,O,K,P);
I+=O;
J-=O;
break;
case"northeast":J+=O;
J=Math.min(Math.max(K,J),P);
M=this.constrain(R,M,U,X);
H+=M;
R-=M;
break;
case"northwest":O=this.constrain(J,O,K,P);
M=this.constrain(R,M,U,X);
H+=M;
R-=M;
I+=O;
J-=O;
break;
case"southwest":O=this.constrain(J,O,K,P);
R+=M;
R=Math.min(Math.max(U,R),X);
I+=O;
J-=O;
break
}var N=this.snap(J,F,K);
var W=this.snap(R,A,U);
if(N!=J||W!=R){switch(G){case"northeast":H-=W-R;
break;
case"north":H-=W-R;
break;
case"southwest":I-=N-J;
break;
case"west":I-=N-J;
break;
case"northwest":I-=N-J;
H-=W-R;
break
}J=N;
R=W
}if(this.preserveRatio){switch(G){case"southeast":case"east":R=L*(J/D);
R=Math.min(Math.max(U,R),X);
J=D*(R/L);
break;
case"south":J=D*(R/L);
J=Math.min(Math.max(K,J),P);
R=L*(J/D);
break;
case"northeast":J=D*(R/L);
J=Math.min(Math.max(K,J),P);
R=L*(J/D);
break;
case"north":Y=J;
J=D*(R/L);
J=Math.min(Math.max(K,J),P);
R=L*(J/D);
I+=(Y-J)/2;
break;
case"southwest":R=L*(J/D);
R=Math.min(Math.max(U,R),X);
Y=J;
J=D*(R/L);
I+=Y-J;
break;
case"west":E=R;
R=L*(J/D);
R=Math.min(Math.max(U,R),X);
H+=(E-R)/2;
Y=J;
J=D*(R/L);
I+=Y-J;
break;
case"northwest":Y=J;
E=R;
R=L*(J/D);
R=Math.min(Math.max(U,R),X);
J=D*(R/L);
H+=E-R;
I+=Y-J;
break
}}this.proxy.setBounds(I,H,J,R);
if(this.dynamic){this.resizeElement()
}}catch(S){}}},handleOver:function(){if(this.enabled){this.el.addClass("x-resizable-over")
}},handleOut:function(){if(!this.resizing){this.el.removeClass("x-resizable-over")
}},getEl:function(){return this.el
},getResizeChild:function(){return this.resizeChild
},destroy:function(B){CQ.Ext.destroy(this.dd,this.overlay,this.proxy);
this.overlay=null;
this.proxy=null;
var C=CQ.Ext.Resizable.positions;
for(var A in C){if(typeof C[A]!="function"&&this[C[A]]){this[C[A]].destroy()
}}if(B){this.el.update("");
CQ.Ext.destroy(this.el);
this.el=null
}this.purgeListeners()
},syncHandleHeight:function(){var A=this.el.getHeight(true);
if(this.west){this.west.el.setHeight(A)
}if(this.east){this.east.el.setHeight(A)
}}});
CQ.Ext.Resizable.positions={n:"north",s:"south",e:"east",w:"west",se:"southeast",sw:"southwest",nw:"northwest",ne:"northeast"};
CQ.Ext.Resizable.Handle=CQ.Ext.extend(Object,{constructor:function(D,F,C,E,A){if(!this.tpl){var B=CQ.Ext.DomHelper.createTemplate({tag:"div",cls:"x-resizable-handle x-resizable-handle-{0}"});
B.compile();
CQ.Ext.Resizable.Handle.prototype.tpl=B
}this.position=F;
this.rz=D;
this.el=this.tpl.append(D.el.dom,[this.position],true);
this.el.unselectable();
if(E){this.el.setOpacity(0)
}if(!CQ.Ext.isEmpty(A)){this.el.addClass(A)
}this.el.on("mousedown",this.onMouseDown,this);
if(!C){this.el.on({scope:this,mouseover:this.onMouseOver,mouseout:this.onMouseOut})
}},afterResize:function(A){},onMouseDown:function(A){this.rz.onMouseDown(this,A)
},onMouseOver:function(A){this.rz.handleOver(this,A)
},onMouseOut:function(A){this.rz.handleOut(this,A)
},destroy:function(){CQ.Ext.destroy(this.el);
this.el=null
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Window=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-window",resizable:true,draggable:true,closable:true,closeAction:"close",constrain:false,constrainHeader:false,plain:false,minimizable:false,maximizable:false,minHeight:100,minWidth:200,expandOnShow:true,collapsible:false,initHidden:undefined,hidden:true,elements:"header,body",frame:true,floating:true,initComponent:function(){this.initTools();
CQ.Ext.Window.superclass.initComponent.call(this);
this.addEvents("resize","maximize","minimize","restore");
if(CQ.Ext.isDefined(this.initHidden)){this.hidden=this.initHidden
}if(this.hidden===false){this.hidden=true;
this.show()
}},getState:function(){return CQ.Ext.apply(CQ.Ext.Window.superclass.getState.call(this)||{},this.getBox(true))
},onRender:function(B,A){CQ.Ext.Window.superclass.onRender.call(this,B,A);
if(this.plain){this.el.addClass("x-window-plain")
}this.focusEl=this.el.createChild({tag:"a",href:"#",cls:"x-dlg-focus",tabIndex:"-1",html:"&#160;"});
this.focusEl.swallowEvent("click",true);
this.proxy=this.el.createProxy("x-window-proxy");
this.proxy.enableDisplayMode("block");
if(this.modal){this.mask=this.container.createChild({cls:"ext-el-mask"},this.el.dom);
this.mask.enableDisplayMode("block");
this.mask.hide();
this.mon(this.mask,"click",this.focus,this)
}if(this.maximizable){this.mon(this.header,"dblclick",this.toggleMaximize,this)
}},initEvents:function(){CQ.Ext.Window.superclass.initEvents.call(this);
if(this.animateTarget){this.setAnimateTarget(this.animateTarget)
}if(this.resizable){this.resizer=new CQ.Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||"all",pinned:true,resizeElement:this.resizerAction,handleCls:"x-window-handle"});
this.resizer.window=this;
this.mon(this.resizer,"beforeresize",this.beforeResize,this)
}if(this.draggable){this.header.addClass("x-window-draggable")
}this.mon(this.el,"mousedown",this.toFront,this);
this.manager=this.manager||CQ.Ext.WindowMgr;
this.manager.register(this);
if(this.maximized){this.maximized=false;
this.maximize()
}if(this.closable){var A=this.getKeyMap();
A.on(27,this.onEsc,this);
A.disable()
}},initDraggable:function(){this.dd=new CQ.Ext.Window.DD(this)
},onEsc:function(A,B){B.stopEvent();
this[this.closeAction]()
},beforeDestroy:function(){if(this.rendered){this.hide();
if(this.doAnchor){CQ.Ext.EventManager.removeResizeListener(this.doAnchor,this);
CQ.Ext.EventManager.un(window,"scroll",this.doAnchor,this)
}CQ.Ext.destroy(this.focusEl,this.resizer,this.dd,this.proxy,this.mask)
}CQ.Ext.Window.superclass.beforeDestroy.call(this)
},onDestroy:function(){if(this.manager){this.manager.unregister(this)
}CQ.Ext.Window.superclass.onDestroy.call(this)
},initTools:function(){if(this.minimizable){this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])})
}if(this.maximizable){this.addTool({id:"maximize",handler:this.maximize.createDelegate(this,[])});
this.addTool({id:"restore",handler:this.restore.createDelegate(this,[]),hidden:true})
}if(this.closable){this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})
}},resizerAction:function(){var A=this.proxy.getBox();
this.proxy.hide();
this.window.handleResize(A);
return A
},beforeResize:function(){this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);
this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);
this.resizeBox=this.el.getBox()
},updateHandles:function(){if(CQ.Ext.isIE&&this.resizer){this.resizer.syncHandleHeight();
this.el.repaint()
}},handleResize:function(B){var A=this.resizeBox;
if(A.x!=B.x||A.y!=B.y){this.updateBox(B)
}else{this.setSize(B)
}this.focus();
this.updateHandles();
this.saveState();
this.doLayout()
},focus:function(){var C=this.focusEl,A=this.defaultButton,B=typeof A;
if(CQ.Ext.isDefined(A)){if(CQ.Ext.isNumber(A)&&this.fbar){C=this.fbar.items.get(A)
}else{if(CQ.Ext.isString(A)){C=CQ.Ext.getCmp(A)
}else{C=A
}}}C=C||this.focusEl;
C.focus.defer(10,C)
},setAnimateTarget:function(A){A=CQ.Ext.get(A);
this.animateTarget=A
},beforeShow:function(){delete this.el.lastXY;
delete this.el.lastLT;
if(this.x===undefined||this.y===undefined){var A=this.el.getAlignToXY(this.container,"c-c");
var B=this.el.translatePoints(A[0],A[1]);
this.x=this.x===undefined?B.left:this.x;
this.y=this.y===undefined?B.top:this.y
}this.el.setLeftTop(this.x,this.y);
if(this.expandOnShow){this.expand(false)
}if(this.modal){CQ.Ext.getBody().addClass("x-body-masked");
this.mask.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.mask.show()
}},show:function(C,A,B){if(!this.rendered){this.render(CQ.Util.getRoot())
}if(this.hidden===false){this.toFront();
return this
}if(this.fireEvent("beforeshow",this)===false){return this
}if(A){this.on("show",A,B,{single:true})
}this.hidden=false;
if(CQ.Ext.isDefined(C)){this.setAnimateTarget(C)
}this.beforeShow();
if(this.animateTarget){this.animShow()
}else{this.afterShow()
}return this
},afterShow:function(B){if(this.isDestroyed){return false
}this.proxy.hide();
this.el.setStyle("display","block");
this.el.show();
if(this.maximized){this.fitContainer()
}if(CQ.Ext.isMac&&CQ.Ext.isGecko2){this.cascade(this.setAutoScroll)
}if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){CQ.Ext.EventManager.onWindowResize(this.onWindowResize,this)
}this.doConstrain();
this.doLayout();
if(this.keyMap){this.keyMap.enable()
}this.toFront();
this.updateHandles();
if(B&&(CQ.Ext.isIE||CQ.Ext.isWebKit)){var A=this.getSize();
this.onResize(A.width,A.height)
}this.onShow();
this.fireEvent("show",this)
},animShow:function(){this.proxy.show();
this.proxy.setBox(this.animateTarget.getBox());
this.proxy.setOpacity(0);
var A=this.getBox();
this.el.setStyle("display","none");
this.proxy.shift(CQ.Ext.apply(A,{callback:this.afterShow.createDelegate(this,[true],false),scope:this,easing:"easeNone",duration:0.25,opacity:0.5}))
},hide:function(C,A,B){if(this.hidden||this.fireEvent("beforehide",this)===false){return this
}if(A){this.on("hide",A,B,{single:true})
}this.hidden=true;
if(C!==undefined){this.setAnimateTarget(C)
}if(this.modal){this.mask.hide();
CQ.Ext.getBody().removeClass("x-body-masked")
}if(this.animateTarget){this.animHide()
}else{this.el.hide();
this.afterHide()
}return this
},afterHide:function(){this.proxy.hide();
if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){CQ.Ext.EventManager.removeResizeListener(this.onWindowResize,this)
}if(this.keyMap){this.keyMap.disable()
}this.onHide();
this.fireEvent("hide",this)
},animHide:function(){this.proxy.setOpacity(0.5);
this.proxy.show();
var A=this.getBox(false);
this.proxy.setBox(A);
this.el.hide();
this.proxy.shift(CQ.Ext.apply(this.animateTarget.getBox(),{callback:this.afterHide,scope:this,duration:0.25,easing:"easeNone",opacity:0}))
},onShow:CQ.Ext.emptyFn,onHide:CQ.Ext.emptyFn,onWindowResize:function(){if(this.maximized){this.fitContainer()
}if(this.modal){this.mask.setSize("100%","100%");
var A=this.mask.dom.offsetHeight;
this.mask.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true))
}this.doConstrain()
},doConstrain:function(){if(this.constrain||this.constrainHeader){var B;
if(this.constrain){B={right:this.el.shadowOffset,left:this.el.shadowOffset,bottom:this.el.shadowOffset}
}else{var A=this.getSize();
B={right:-(A.width-100),bottom:-(A.height-25)}
}var C=this.el.getConstrainToXY(this.container,true,B);
if(C){this.setPosition(C[0],C[1])
}}},ghost:function(A){var C=this.createGhost(A);
var B=this.getBox(true);
C.setLeftTop(B.x,B.y);
C.setWidth(B.width);
this.el.hide();
this.activeGhost=C;
return C
},unghost:function(B,A){if(!this.activeGhost){return 
}if(B!==false){this.el.show();
this.focus();
if(CQ.Ext.isMac&&CQ.Ext.isGecko2){this.cascade(this.setAutoScroll)
}}if(A!==false){this.setPosition(this.activeGhost.getLeft(true),this.activeGhost.getTop(true))
}this.activeGhost.hide();
this.activeGhost.remove();
delete this.activeGhost
},minimize:function(){this.fireEvent("minimize",this);
return this
},close:function(){if(this.fireEvent("beforeclose",this)!==false){if(this.hidden){this.doClose()
}else{this.hide(null,this.doClose,this)
}}},doClose:function(){this.fireEvent("close",this);
this.destroy()
},maximize:function(){if(!this.maximized){this.expand(false);
this.restoreSize=this.getSize();
this.restorePos=this.getPosition(true);
if(this.maximizable){this.tools.maximize.hide();
this.tools.restore.show()
}this.maximized=true;
this.el.disableShadow();
if(this.dd){this.dd.lock()
}if(this.collapsible){this.tools.toggle.hide()
}this.el.addClass("x-window-maximized");
this.container.addClass("x-window-maximized-ct");
this.setPosition(0,0);
this.fitContainer();
this.fireEvent("maximize",this)
}return this
},restore:function(){if(this.maximized){var A=this.tools;
this.el.removeClass("x-window-maximized");
if(A.restore){A.restore.hide()
}if(A.maximize){A.maximize.show()
}this.setPosition(this.restorePos[0],this.restorePos[1]);
this.setSize(this.restoreSize.width,this.restoreSize.height);
delete this.restorePos;
delete this.restoreSize;
this.maximized=false;
this.el.enableShadow(true);
if(this.dd){this.dd.unlock()
}if(this.collapsible&&A.toggle){A.toggle.show()
}this.container.removeClass("x-window-maximized-ct");
this.doConstrain();
this.fireEvent("restore",this)
}return this
},toggleMaximize:function(){return this[this.maximized?"restore":"maximize"]()
},fitContainer:function(){var A=this.container.getViewSize(false);
this.setSize(A.width,A.height)
},setZIndex:function(A){if(this.modal){this.mask.setStyle("z-index",A)
}this.el.setZIndex(++A);
A+=5;
if(this.resizer){this.resizer.proxy.setStyle("z-index",++A)
}this.lastZIndex=A
},alignTo:function(B,A,C){var D=this.el.getAlignToXY(B,A,C);
this.setPagePosition(D[0],D[1]);
return this
},anchorTo:function(C,E,D,B){if(this.doAnchor){CQ.Ext.EventManager.removeResizeListener(this.doAnchor,this);
CQ.Ext.EventManager.un(window,"scroll",this.doAnchor,this)
}this.doAnchor=function(){this.alignTo(C,E,D)
};
CQ.Ext.EventManager.onWindowResize(this.doAnchor,this);
var A=typeof B;
if(A!="undefined"){CQ.Ext.EventManager.on(window,"scroll",this.doAnchor,this,{buffer:A=="number"?B:50})
}return this
},toFront:function(A){if(this.manager.bringToFront(this)){if(!A||!A.getTarget().focus){this.focus()
}}return this
},setActive:function(A){if(A){if(!this.maximized){this.el.enableShadow(true)
}this.fireEvent("activate",this)
}else{this.el.disableShadow();
this.fireEvent("deactivate",this)
}},toBack:function(){this.manager.sendToBack(this);
return this
},center:function(){var A=this.el.getAlignToXY(this.container,"c-c");
this.setPagePosition(A[0],A[1]);
return this
}});
CQ.Ext.reg("window",CQ.Ext.Window);
CQ.Ext.Window.DD=function(A){this.win=A;
CQ.Ext.Window.DD.superclass.constructor.call(this,A.el.id,"WindowDD-"+A.id);
this.setHandleElId(A.header.id);
this.scroll=false
};
CQ.Ext.extend(CQ.Ext.Window.DD,CQ.Ext.dd.DD,{moveOnly:true,headerOffsets:[100,25],startDrag:function(){var A=this.win;
this.proxy=A.ghost();
if(A.constrain!==false){var C=A.el.shadowOffset;
this.constrainTo(A.container,{right:C,left:C,bottom:C})
}else{if(A.constrainHeader!==false){var B=this.proxy.getSize();
this.constrainTo(A.container,{right:-(B.width-this.headerOffsets[0]),bottom:-(B.height-this.headerOffsets[1])})
}}},b4Drag:CQ.Ext.emptyFn,onDrag:function(A){this.alignElWithMouse(this.proxy,A.getPageX(),A.getPageY())
},endDrag:function(A){this.win.unghost();
this.win.saveState()
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.WindowGroup=function(){var F={};
var D=[];
var E=null;
var C=function(I,H){return(!I._lastAccess||I._lastAccess<H._lastAccess)?-1:1
};
var G=function(){var J=D,H=J.length;
if(H>0){J.sort(C);
var I=J[0].manager.zseed;
for(var K=0;
K<H;
K++){var L=J[K];
if(L&&!L.hidden){L.setZIndex(I+(K*10))
}}}A()
};
var B=function(H){if(H!=E){if(E){E.setActive(false)
}E=H;
if(H){H.setActive(true)
}}};
var A=function(){for(var H=D.length-1;
H>=0;
--H){if(!D[H].hidden){B(D[H]);
return 
}}B(null)
};
return{zseed:9000,register:function(H){if(H.manager){H.manager.unregister(H)
}H.manager=this;
F[H.id]=H;
D.push(H);
H.on("hide",A)
},unregister:function(H){delete H.manager;
delete F[H.id];
H.un("hide",A);
D.remove(H)
},get:function(H){return typeof H=="object"?H:F[H]
},bringToFront:function(H){H=this.get(H);
if(H!=E){H._lastAccess=new Date().getTime();
G();
return true
}return false
},sendToBack:function(H){H=this.get(H);
H._lastAccess=-(new Date().getTime());
G();
return H
},hideAll:function(){for(var H in F){if(F[H]&&typeof F[H]!="function"&&F[H].isVisible()){F[H].hide()
}}},getActive:function(){return E
},getBy:function(J,I){var K=[];
for(var H=D.length-1;
H>=0;
--H){var L=D[H];
if(J.call(I||L,L)!==false){K.push(L)
}}return K
},each:function(I,H){for(var J in F){if(F[J]&&typeof F[J]!="function"){if(I.call(H||F[J],F[J])===false){return 
}}}}}
};
CQ.Ext.WindowMgr=new CQ.Ext.WindowGroup();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.MessageBox=function(){var T,B,P,S,G,K,R,A,M,O,I,F,Q,U,N,H="",D="",L=["ok","yes","no","cancel"];
var C=function(W){Q[W].blur();
if(T.isVisible()){T.hide();
V();
CQ.Ext.callback(B.fn,B.scope||window,[W,U.dom.value,B],1)
}};
var V=function(){if(B&&B.cls){T.el.removeClass(B.cls)
}M.reset()
};
var E=function(Y,W,X){if(B&&B.closable!==false){T.hide();
V()
}if(X){X.stopEvent()
}};
var J=function(W){var Y=0,X;
if(!W){CQ.Ext.each(L,function(Z){Q[Z].hide()
});
return Y
}T.footer.dom.style.display="";
CQ.Ext.iterate(Q,function(Z,a){X=W[Z];
if(X){a.show();
a.setText(CQ.Ext.isString(X)?X:CQ.Ext.MessageBox.buttonText[Z]);
Y+=a.getEl().getWidth()+15
}else{a.hide()
}});
return Y
};
return{getDialog:function(W){if(!T){var Y=[];
Q={};
CQ.Ext.each(L,function(Z){Y.push(Q[Z]=new CQ.Ext.Button({text:this.buttonText[Z],handler:C.createCallback(Z),hideMode:"offsets"}))
},this);
T=new CQ.Ext.Window({autoCreate:true,title:W,resizable:false,id:CQ.Util.createId("cq-msgbox"),minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:400,height:100,minHeight:80,plain:true,footer:true,closable:true,close:function(){if(B&&B.buttons&&B.buttons.no&&!B.buttons.cancel){C("no")
}else{C("cancel")
}},fbar:new CQ.Ext.Toolbar({items:Y,enableOverflow:false})});
T.render(CQ.Util.getRoot());
T.getEl().addClass("x-window-dlg");
P=T.mask;
G=T.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});
I=CQ.Ext.get(G.dom.firstChild);
var X=G.dom.childNodes[1];
K=CQ.Ext.get(X.firstChild);
R=CQ.Ext.get(X.childNodes[2].firstChild);
R.enableDisplayMode();
R.addKeyListener([10,13],function(){if(T.isVisible()&&B&&B.buttons){if(B.buttons.ok){C("ok")
}else{if(B.buttons.yes){C("yes")
}}}});
A=CQ.Ext.get(X.childNodes[2].childNodes[1]);
A.enableDisplayMode();
M=new CQ.Ext.ProgressBar({renderTo:G});
G.createChild({cls:"x-clear"})
}return T
},updateText:function(Z){if(!T.isVisible()&&!B.width){T.setSize(this.maxWidth,100)
}K.update(Z||"&#160;");
var X=D!=""?(I.getWidth()+I.getMargins("lr")):0,b=K.getWidth()+K.getMargins("lr"),Y=T.getFrameWidth("lr"),a=T.body.getFrameWidth("lr"),W;
if(CQ.Ext.isIE&&X>0){X+=3
}W=Math.max(Math.min(B.width||X+b+Y+a,B.maxWidth||this.maxWidth),Math.max(B.minWidth||this.minWidth,N||0));
if(B.prompt===true){U.setWidth(W-X-Y-a)
}if(B.progress===true||B.wait===true){M.setSize(W-X-Y-a)
}if(CQ.Ext.isIE&&W==N){W+=4
}T.setSize(W,"auto").center();
return this
},updateProgress:function(X,W,Y){M.updateProgress(X,W);
if(Y){this.updateText(Y)
}return this
},isVisible:function(){return T&&T.isVisible()
},hide:function(){var W=T?T.activeGhost:null;
if(this.isVisible()||W){T.hide();
V();
if(W){T.unghost(false,false)
}}return this
},show:function(Z){if(this.isVisible()){this.hide()
}B=Z;
var a=this.getDialog(B.title||"&#160;");
a.setTitle(B.title||"&#160;");
var W=(B.closable!==false&&B.progress!==true&&B.wait!==true);
a.tools.close.setDisplayed(W);
U=R;
B.prompt=B.prompt||(B.multiline?true:false);
if(B.prompt){if(B.multiline){R.hide();
A.show();
A.setHeight(CQ.Ext.isNumber(B.multiline)?B.multiline:this.defaultTextHeight);
U=A
}else{R.show();
A.hide()
}}else{R.hide();
A.hide()
}U.dom.value=B.value||"";
if(B.prompt){a.focusEl=U
}else{var Y=B.buttons;
var X=null;
if(Y&&Y.ok){X=Q.ok
}else{if(Y&&Y.yes){X=Q.yes
}}if(X){a.focusEl=X
}}if(B.iconCls){a.setIconClass(B.iconCls)
}this.setIcon(CQ.Ext.isDefined(B.icon)?B.icon:H);
N=J(B.buttons);
M.setVisible(B.progress===true||B.wait===true);
this.updateProgress(0,B.progressText);
this.updateText(B.msg);
if(B.cls){a.el.addClass(B.cls)
}a.proxyDrag=B.proxyDrag===true;
a.modal=B.modal!==false;
a.mask=B.modal!==false?P:false;
if(!a.isVisible()){CQ.Util.getRoot().appendChild(T.el.dom);
this.getDialog().center=function(){var b=this.el.getAlignToXY(CQ.Ext.getBody(),"c-c");
this.setPagePosition(b[0],b[1]-40);
return this
};
a.center();
a.setAnimateTarget(B.animEl);
a.on("show",function(){if(W===true){a.keyMap.enable()
}else{a.keyMap.disable()
}},this,{single:true});
a.show(B.animEl)
}if(B.wait===true){M.wait(B.waitConfig)
}return this
},setIcon:function(W){if(!T){H=W;
return 
}H=undefined;
if(W&&W!=""){I.removeClass("x-hidden");
I.replaceClass(D,W);
G.addClass("x-dlg-icon");
D=W
}else{I.replaceClass(D,"x-hidden");
G.removeClass("x-dlg-icon");
D="";
B.cls="ext-mb-noicon"
}return this
},progress:function(Y,X,W){this.show({title:Y,msg:X,buttons:false,progress:true,closable:false,minWidth:this.minProgressWidth,progressText:W});
return this
},wait:function(Y,X,W){this.show({title:X,msg:Y,buttons:false,closable:false,wait:true,modal:true,minWidth:this.minProgressWidth,waitConfig:W});
return this
},alert:function(Z,Y,X,W){this.show({title:Z,msg:Y,icon:CQ.Ext.MessageBox.WARNING,buttons:this.OK,fn:X,scope:W,minWidth:this.minWidth});
return this
},confirm:function(Z,Y,X,W){this.show({title:Z,msg:Y,buttons:this.YESNO,fn:X,scope:W,icon:this.QUESTION,minWidth:this.minWidth});
return this
},prompt:function(b,a,Y,X,W,Z){this.show({title:b,msg:a,buttons:this.OKCANCEL,fn:Y,minWidth:this.minPromptWidth,scope:X,prompt:true,multiline:W,value:Z});
return this
},OK:{ok:true},CANCEL:{cancel:true},OKCANCEL:{ok:true,cancel:true},YESNO:{yes:true,no:true},YESNOCANCEL:{yes:true,no:true,cancel:true},INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",defaultTextHeight:75,maxWidth:600,minWidth:100,minProgressWidth:250,minPromptWidth:250,buttonText:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}}
}();
CQ.Ext.Msg=CQ.Ext.MessageBox;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.dd.PanelProxy=function(A,B){this.panel=A;
this.id=this.panel.id+"-ddproxy";
CQ.Ext.apply(this,B)
};
CQ.Ext.dd.PanelProxy.prototype={insertProxy:true,setStatus:CQ.Ext.emptyFn,reset:CQ.Ext.emptyFn,update:CQ.Ext.emptyFn,stop:CQ.Ext.emptyFn,sync:CQ.Ext.emptyFn,getEl:function(){return this.ghost
},getGhost:function(){return this.ghost
},getProxy:function(){return this.proxy
},hide:function(){if(this.ghost){if(this.proxy){this.proxy.remove();
delete this.proxy
}this.panel.el.dom.style.display="";
this.ghost.remove();
delete this.ghost
}},show:function(){if(!this.ghost){this.ghost=this.panel.createGhost(undefined,undefined,CQ.Util.getRoot());
this.ghost.setXY(this.panel.el.getXY());
if(this.insertProxy){this.proxy=this.panel.el.insertSibling({cls:"x-panel-dd-spacer"});
this.proxy.setSize(this.panel.getSize())
}this.panel.el.dom.style.display="none"
}},repair:function(B,C,A){this.hide();
if(typeof C=="function"){C.call(A||this)
}},moveProxy:function(A,B){if(this.proxy){A.insertBefore(this.proxy.dom,B)
}}};
CQ.Ext.Panel.DD=function(B,A){this.panel=B;
this.dragData={panel:B};
this.proxy=new CQ.Ext.dd.PanelProxy(B,A);
CQ.Ext.Panel.DD.superclass.constructor.call(this,B.el,A);
var C=B.header;
if(C){this.setHandleElId(C.id)
}(C?C:this.panel.body).setStyle("cursor","move");
this.scroll=false
};
CQ.Ext.extend(CQ.Ext.Panel.DD,CQ.Ext.dd.DragSource,{showFrame:CQ.Ext.emptyFn,startDrag:CQ.Ext.emptyFn,b4StartDrag:function(A,B){this.proxy.show()
},b4MouseDown:function(B){var A=B.getPageX();
var C=B.getPageY();
this.autoOffset(A,C)
},onInitDrag:function(A,B){this.onStartDrag(A,B);
return true
},createFrame:CQ.Ext.emptyFn,getDragEl:function(A){return this.proxy.ghost.dom
},endDrag:function(A){this.proxy.hide();
this.panel.saveState()
},autoOffset:function(A,B){A-=this.startPageX;
B-=this.startPageY;
this.setDelta(A,B)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.state.Provider=function(){this.addEvents("statechange");
this.state={};
CQ.Ext.state.Provider.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.state.Provider,CQ.Ext.util.Observable,{get:function(B,A){return typeof this.state[B]=="undefined"?A:this.state[B]
},clear:function(A){delete this.state[A];
this.fireEvent("statechange",this,A,null)
},set:function(A,B){this.state[A]=B;
this.fireEvent("statechange",this,A,B)
},decodeValue:function(B){var E=/^(a|n|d|b|s|o)\:(.*)$/;
var F=E.exec(unescape(B));
if(!F||!F[1]){return 
}var D=F[1];
var A=F[2];
switch(D){case"n":return parseFloat(A);
case"d":return new Date(Date.parse(A));
case"b":return(A=="1");
case"a":var C=[];
if(A!=""){CQ.Ext.each(A.split("^"),function(G){C.push(this.decodeValue(G))
},this)
}return C;
case"o":var C={};
if(A!=""){CQ.Ext.each(A.split("^"),function(H){var G=H.split("=");
C[G[0]]=this.decodeValue(G[1])
},this)
}return C;
default:return A
}},encodeValue:function(C){var B;
if(typeof C=="number"){B="n:"+C
}else{if(typeof C=="boolean"){B="b:"+(C?"1":"0")
}else{if(CQ.Ext.isDate(C)){B="d:"+C.toGMTString()
}else{if(CQ.Ext.isArray(C)){var F="";
for(var E=0,A=C.length;
E<A;
E++){F+=this.encodeValue(C[E]);
if(E!=A-1){F+="^"
}}B="a:"+F
}else{if(typeof C=="object"){var F="";
for(var D in C){if(typeof C[D]!="function"&&C[D]!==undefined){F+=D+"="+this.encodeValue(C[D])+"^"
}}B="o:"+F.substring(0,F.length-1)
}else{B="s:"+C
}}}}}return escape(B)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.state.Manager=function(){var A=new CQ.Ext.state.Provider();
return{setProvider:function(B){A=B
},get:function(C,B){return A.get(C,B)
},set:function(B,C){A.set(B,C)
},clear:function(B){A.clear(B)
},getProvider:function(){return A
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.state.CookieProvider=function(A){CQ.Ext.state.CookieProvider.superclass.constructor.call(this);
this.path="/";
this.expires=new Date(new Date().getTime()+(1000*60*60*24*7));
this.domain=null;
this.secure=false;
CQ.Ext.apply(this,A);
this.state=this.readCookies()
};
CQ.Ext.extend(CQ.Ext.state.CookieProvider,CQ.Ext.state.Provider,{set:function(A,B){if(typeof B=="undefined"||B===null){this.clear(A);
return 
}this.setCookie(A,B);
CQ.Ext.state.CookieProvider.superclass.set.call(this,A,B)
},clear:function(A){this.clearCookie(A);
CQ.Ext.state.CookieProvider.superclass.clear.call(this,A)
},readCookies:function(){var C={};
var F=document.cookie+";";
var B=/\s?(.*?)=(.*?);/g;
var E;
while((E=B.exec(F))!=null){var A=E[1];
var D=E[2];
if(A&&A.substring(0,3)=="ys-"){C[A.substr(3)]=this.decodeValue(D)
}}return C
},setCookie:function(A,B){document.cookie="ys-"+A+"="+this.encodeValue(B)+((this.expires==null)?"":("; expires="+this.expires.toGMTString()))+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")
},clearCookie:function(A){document.cookie="ys-"+A+"=null; expires=Thu, 01-Jan-70 00:00:01 GMT"+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.DataView=CQ.Ext.extend(CQ.Ext.BoxComponent,{selectedClass:"x-view-selected",emptyText:"",deferEmptyText:true,trackOver:false,last:false,initComponent:function(){CQ.Ext.DataView.superclass.initComponent.call(this);
if(CQ.Ext.isString(this.tpl)||CQ.Ext.isArray(this.tpl)){this.tpl=new CQ.Ext.XTemplate(this.tpl)
}this.addEvents("beforeclick","click","mouseenter","mouseleave","containerclick","dblclick","contextmenu","containercontextmenu","selectionchange","beforeselect");
this.store=CQ.Ext.StoreMgr.lookup(this.store);
this.all=new CQ.Ext.CompositeElementLite();
this.selected=new CQ.Ext.CompositeElementLite()
},afterRender:function(){CQ.Ext.DataView.superclass.afterRender.call(this);
this.mon(this.getTemplateTarget(),{click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu,scope:this});
if(this.overClass||this.trackOver){this.mon(this.getTemplateTarget(),{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this})
}if(this.store){this.bindStore(this.store,true)
}},refresh:function(){this.clearSelections(false,true);
var B=this.getTemplateTarget();
B.update("");
var A=this.store.getRange();
if(A.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){B.update(this.emptyText)
}this.all.clear()
}else{this.tpl.overwrite(B,this.collectData(A,0));
this.all.fill(CQ.Ext.query(this.itemSelector,B.dom));
this.updateIndexes(0)
}this.hasSkippedEmptyText=true
},getTemplateTarget:function(){return this.el
},prepareData:function(A){return A
},collectData:function(B,E){var D=[];
for(var C=0,A=B.length;
C<A;
C++){D[D.length]=this.prepareData(B[C].data,E+C,B[C])
}return D
},bufferRender:function(A){var B=document.createElement("div");
this.tpl.overwrite(B,this.collectData(A));
return CQ.Ext.query(this.itemSelector,B)
},onUpdate:function(F,A){var B=this.store.indexOf(A);
if(B>-1){var E=this.isSelected(B);
var C=this.all.elements[B];
var D=this.bufferRender([A],B)[0];
this.all.replaceElement(B,D,true);
if(E){this.selected.replaceElement(C,D);
this.all.item(B).addClass(this.selectedClass)
}this.updateIndexes(B,B)
}},onAdd:function(E,C,D){if(this.all.getCount()===0){this.refresh();
return 
}var B=this.bufferRender(C,D),F,A=this.all.elements;
if(D<this.all.getCount()){F=this.all.item(D).insertSibling(B,"before",true);
A.splice.apply(A,[D,0].concat(B))
}else{F=this.all.last().insertSibling(B,"after",true);
A.push.apply(A,B)
}this.updateIndexes(D)
},onRemove:function(C,A,B){this.deselect(B);
this.all.removeElement(B,true);
this.updateIndexes(B);
if(this.store.getCount()===0){this.refresh()
}},refreshNode:function(A){this.onUpdate(this.store,this.store.getAt(A))
},updateIndexes:function(D,C){var B=this.all.elements;
D=D||0;
C=C||((C===0)?0:(B.length-1));
for(var A=D;
A<=C;
A++){B[A].viewIndex=A
}},getStore:function(){return this.store
},bindStore:function(A,B){if(!B&&this.store){if(A!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("datachanged",this.refresh,this);
this.store.un("add",this.onAdd,this);
this.store.un("remove",this.onRemove,this);
this.store.un("update",this.onUpdate,this);
this.store.un("clear",this.refresh,this)
}if(!A){this.store=null
}}if(A){A=CQ.Ext.StoreMgr.lookup(A);
A.on({scope:this,beforeload:this.onBeforeLoad,datachanged:this.refresh,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh})
}this.store=A;
if(A){this.refresh()
}},findItemFromChild:function(A){return CQ.Ext.fly(A).findParent(this.itemSelector,this.getTemplateTarget())
},onClick:function(C){var B=C.getTarget(this.itemSelector,this.getTemplateTarget());
if(B){var A=this.indexOf(B);
if(this.onItemClick(B,A,C)!==false){this.fireEvent("click",this,A,B,C)
}}else{if(this.fireEvent("containerclick",this,C)!==false){this.onContainerClick(C)
}}},onContainerClick:function(A){this.clearSelections()
},onContextMenu:function(B){var A=B.getTarget(this.itemSelector,this.getTemplateTarget());
if(A){this.fireEvent("contextmenu",this,this.indexOf(A),A,B)
}else{this.fireEvent("containercontextmenu",this,B)
}},onDblClick:function(B){var A=B.getTarget(this.itemSelector,this.getTemplateTarget());
if(A){this.fireEvent("dblclick",this,this.indexOf(A),A,B)
}},onMouseOver:function(B){var A=B.getTarget(this.itemSelector,this.getTemplateTarget());
if(A&&A!==this.lastItem){this.lastItem=A;
CQ.Ext.fly(A).addClass(this.overClass);
this.fireEvent("mouseenter",this,this.indexOf(A),A,B)
}},onMouseOut:function(A){if(this.lastItem){if(!A.within(this.lastItem,true,true)){CQ.Ext.fly(this.lastItem).removeClass(this.overClass);
this.fireEvent("mouseleave",this,this.indexOf(this.lastItem),this.lastItem,A);
delete this.lastItem
}}},onItemClick:function(B,A,C){if(this.fireEvent("beforeclick",this,A,B,C)===false){return false
}if(this.multiSelect){this.doMultiSelection(B,A,C);
C.preventDefault()
}else{if(this.singleSelect){this.doSingleSelection(B,A,C);
C.preventDefault()
}}return true
},doSingleSelection:function(B,A,C){if(C.ctrlKey&&this.isSelected(A)){this.deselect(A)
}else{this.select(A,false)
}},doMultiSelection:function(C,A,D){if(D.shiftKey&&this.last!==false){var B=this.last;
this.selectRange(B,A,D.ctrlKey);
this.last=B
}else{if((D.ctrlKey||this.simpleSelect)&&this.isSelected(A)){this.deselect(A)
}else{this.select(A,D.ctrlKey||D.shiftKey||this.simpleSelect)
}}},getSelectionCount:function(){return this.selected.getCount()
},getSelectedNodes:function(){return this.selected.elements
},getSelectedIndexes:function(){var B=[],D=this.selected.elements;
for(var C=0,A=D.length;
C<A;
C++){B.push(D[C].viewIndex)
}return B
},getSelectedRecords:function(){var D=[],C=this.selected.elements;
for(var B=0,A=C.length;
B<A;
B++){D[D.length]=this.store.getAt(C[B].viewIndex)
}return D
},getRecords:function(B){var E=[],D=B;
for(var C=0,A=D.length;
C<A;
C++){E[E.length]=this.store.getAt(D[C].viewIndex)
}return E
},getRecord:function(A){return this.store.getAt(A.viewIndex)
},clearSelections:function(A,B){if((this.multiSelect||this.singleSelect)&&this.selected.getCount()>0){if(!B){this.selected.removeClass(this.selectedClass)
}this.selected.clear();
this.last=false;
if(!A){this.fireEvent("selectionchange",this,this.selected.elements)
}}},isSelected:function(A){return this.selected.contains(this.getNode(A))
},deselect:function(A){if(this.isSelected(A)){A=this.getNode(A);
this.selected.removeElement(A);
if(this.last==A.viewIndex){this.last=false
}CQ.Ext.fly(A).removeClass(this.selectedClass);
this.fireEvent("selectionchange",this,this.selected.elements)
}},select:function(D,F,B){if(CQ.Ext.isArray(D)){if(!F){this.clearSelections(true)
}for(var C=0,A=D.length;
C<A;
C++){this.select(D[C],true,true)
}if(!B){this.fireEvent("selectionchange",this,this.selected.elements)
}}else{var E=this.getNode(D);
if(!F){this.clearSelections(true)
}if(E&&!this.isSelected(E)){if(this.fireEvent("beforeselect",this,E,this.selected.elements)!==false){CQ.Ext.fly(E).addClass(this.selectedClass);
this.selected.add(E);
this.last=E.viewIndex;
if(!B){this.fireEvent("selectionchange",this,this.selected.elements)
}}}}},selectRange:function(C,A,B){if(!B){this.clearSelections(true)
}this.select(this.getNodes(C,A),true)
},getNode:function(A){if(CQ.Ext.isString(A)){return document.getElementById(A)
}else{if(CQ.Ext.isNumber(A)){return this.all.elements[A]
}}return A
},getNodes:function(E,A){var D=this.all.elements;
E=E||0;
A=!CQ.Ext.isDefined(A)?Math.max(D.length-1,0):A;
var B=[],C;
if(E<=A){for(C=E;
C<=A&&D[C];
C++){B.push(D[C])
}}else{for(C=E;
C>=A&&D[C];
C--){B.push(D[C])
}}return B
},indexOf:function(A){A=this.getNode(A);
if(CQ.Ext.isNumber(A.viewIndex)){return A.viewIndex
}return this.all.indexOf(A)
},onBeforeLoad:function(){if(this.loadingText){this.clearSelections(false,true);
this.getTemplateTarget().update('<div class="loading-indicator">'+this.loadingText+"</div>");
this.all.clear()
}},onDestroy:function(){this.all.clear();
this.selected.clear();
CQ.Ext.DataView.superclass.onDestroy.call(this);
this.bindStore(null)
}});
CQ.Ext.DataView.prototype.setStore=CQ.Ext.DataView.prototype.bindStore;
CQ.Ext.reg("dataview",CQ.Ext.DataView);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.list.ListView=CQ.Ext.extend(CQ.Ext.DataView,{itemSelector:"dl",selectedClass:"x-list-selected",overClass:"x-list-over",scrollOffset:undefined,columnResize:true,columnSort:true,maxWidth:CQ.Ext.isIE?99:100,initComponent:function(){if(this.columnResize){this.colResizer=new CQ.Ext.list.ColumnResizer(this.colResizer);
this.colResizer.init(this)
}if(this.columnSort){this.colSorter=new CQ.Ext.list.Sorter(this.columnSort);
this.colSorter.init(this)
}if(!this.internalTpl){this.internalTpl=new CQ.Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{[values.width*100]}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">',"{header}","</em></div>","</tpl>",'<div class="x-clear"></div>',"</div></div>",'<div class="x-list-body"><div class="x-list-body-inner">',"</div></div>")
}if(!this.tpl){this.tpl=new CQ.Ext.XTemplate('<tpl for="rows">',"<dl>",'<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">',"{[values.tpl.apply(parent)]}","</em></dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>")
}var H=this.columns,F=0,G=0,I=H.length,B=[];
for(var E=0;
E<I;
E++){var J=H[E];
if(!J.isColumn){J.xtype=J.xtype?(/^lv/.test(J.xtype)?J.xtype:"lv"+J.xtype):"lvcolumn";
J=CQ.Ext.create(J)
}if(J.width){F+=J.width*100;
G++
}B.push(J)
}H=this.columns=B;
if(G<I){var C=I-G;
if(F<this.maxWidth){var A=((this.maxWidth-F)/C)/100;
for(var D=0;
D<I;
D++){var J=H[D];
if(!J.width){J.width=A
}}}}CQ.Ext.list.ListView.superclass.initComponent.call(this)
},onRender:function(){this.autoEl={cls:"x-list-wrap"};
CQ.Ext.list.ListView.superclass.onRender.apply(this,arguments);
this.internalTpl.overwrite(this.el,{columns:this.columns});
this.innerBody=CQ.Ext.get(this.el.dom.childNodes[1].firstChild);
this.innerHd=CQ.Ext.get(this.el.dom.firstChild.firstChild);
if(this.hideHeaders){this.el.dom.firstChild.style.display="none"
}},getTemplateTarget:function(){return this.innerBody
},collectData:function(){var A=CQ.Ext.list.ListView.superclass.collectData.apply(this,arguments);
return{columns:this.columns,rows:A}
},verifyInternalSize:function(){if(this.lastSize){this.onResize(this.lastSize.width,this.lastSize.height)
}},onResize:function(B,D){var E=this.innerBody.dom;
var F=this.innerHd.dom;
if(!E){return 
}var C=E.parentNode;
if(CQ.Ext.isNumber(B)){var A=B-CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth());
if(this.reserveScrollOffset||((C.offsetWidth-C.clientWidth)>10)){E.style.width=A+"px";
F.style.width=A+"px"
}else{E.style.width=B+"px";
F.style.width=B+"px";
setTimeout(function(){if((C.offsetWidth-C.clientWidth)>10){E.style.width=A+"px";
F.style.width=A+"px"
}},10)
}}if(CQ.Ext.isNumber(D)){C.style.height=(D-F.parentNode.offsetHeight)+"px"
}},updateIndexes:function(){CQ.Ext.list.ListView.superclass.updateIndexes.apply(this,arguments);
this.verifyInternalSize()
},findHeaderIndex:function(D){D=D.dom||D;
var A=D.parentNode,C=A.parentNode.childNodes;
for(var B=0,E;
E=C[B];
B++){if(E==A){return B
}}return -1
},setHdWidths:function(){var C=this.innerHd.dom.getElementsByTagName("div");
for(var B=0,D=this.columns,A=D.length;
B<A;
B++){C[B].style.width=(D[B].width*100)+"%"
}}});
CQ.Ext.reg("listview",CQ.Ext.list.ListView);
CQ.Ext.ListView=CQ.Ext.list.ListView;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.list.Column=CQ.Ext.extend(Object,{isColumn:true,align:"left",header:"",width:null,cls:"",constructor:function(A){if(!A.tpl){A.tpl=new CQ.Ext.XTemplate("{"+A.dataIndex+"}")
}else{if(CQ.Ext.isString(A.tpl)){A.tpl=new CQ.Ext.XTemplate(A.tpl)
}}CQ.Ext.apply(this,A)
}});
CQ.Ext.reg("lvcolumn",CQ.Ext.list.Column);
CQ.Ext.list.NumberColumn=CQ.Ext.extend(CQ.Ext.list.Column,{format:"0,000.00",constructor:function(A){A.tpl=A.tpl||new CQ.Ext.XTemplate("{"+A.dataIndex+':number("'+(A.format||this.format)+'")}');
CQ.Ext.list.NumberColumn.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("lvnumbercolumn",CQ.Ext.list.NumberColumn);
CQ.Ext.list.DateColumn=CQ.Ext.extend(CQ.Ext.list.Column,{format:"m/d/Y",constructor:function(A){A.tpl=A.tpl||new CQ.Ext.XTemplate("{"+A.dataIndex+':date("'+(A.format||this.format)+'")}');
CQ.Ext.list.DateColumn.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("lvdatecolumn",CQ.Ext.list.DateColumn);
CQ.Ext.list.BooleanColumn=CQ.Ext.extend(CQ.Ext.list.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(D){D.tpl=D.tpl||new CQ.Ext.XTemplate("{"+D.dataIndex+":this.format}");
var B=this.trueText,C=this.falseText,A=this.undefinedText;
D.tpl.format=function(E){if(E===undefined){return A
}if(!E||E==="false"){return C
}return B
};
CQ.Ext.list.DateColumn.superclass.constructor.call(this,D)
}});
CQ.Ext.reg("lvbooleancolumn",CQ.Ext.list.BooleanColumn);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.list.ColumnResizer=CQ.Ext.extend(CQ.Ext.util.Observable,{minPct:0.05,constructor:function(A){CQ.Ext.apply(this,A);
CQ.Ext.list.ColumnResizer.superclass.constructor.call(this)
},init:function(A){this.view=A;
A.on("render",this.initEvents,this)
},initEvents:function(A){A.mon(A.innerHd,"mousemove",this.handleHdMove,this);
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(A.innerHd);
A.on("beforedestroy",this.tracker.destroy,this.tracker)
},handleHdMove:function(H,E){var B=5,A=H.getPageX(),G=H.getTarget("em",3,true);
if(G){var F=G.getRegion(),D=G.dom.style,C=G.dom.parentNode;
if(A-F.left<=B&&C!=C.parentNode.firstChild){this.activeHd=CQ.Ext.get(C.previousSibling.firstChild);
D.cursor=CQ.Ext.isWebKit?"e-resize":"col-resize"
}else{if(F.right-A<=B&&C!=C.parentNode.lastChild.previousSibling){this.activeHd=G;
D.cursor=CQ.Ext.isWebKit?"w-resize":"col-resize"
}else{delete this.activeHd;
D.cursor=""
}}}},onBeforeStart:function(A){this.dragHd=this.activeHd;
return !!this.dragHd
},onStart:function(C){this.view.disableHeaders=true;
this.proxy=this.view.el.createChild({cls:"x-list-resizer"});
this.proxy.setHeight(this.view.el.getHeight());
var A=this.tracker.getXY()[0],B=this.view.innerHd.getWidth();
this.hdX=this.dragHd.getX();
this.hdIndex=this.view.findHeaderIndex(this.dragHd);
this.proxy.setX(this.hdX);
this.proxy.setWidth(A-this.hdX);
this.minWidth=B*this.minPct;
this.maxWidth=B-(this.minWidth*(this.view.columns.length-1-this.hdIndex))
},onDrag:function(B){var A=this.tracker.getXY()[0];
this.proxy.setWidth((A-this.hdX).constrain(this.minWidth,this.maxWidth))
},onEnd:function(I){var G=this.proxy.getWidth();
this.proxy.remove();
var F=this.hdIndex,L=this.view,E=L.columns,H=E.length,N=this.view.innerHd.getWidth(),D=this.minPct*100,O=Math.ceil((G*L.maxWidth)/N),M=(E[F].width*100)-O,K=Math.floor(M/(H-1-F)),J=M-(K*(H-1-F));
for(var C=F+1;
C<H;
C++){var B=(E[C].width*100)+K,A=Math.max(D,B);
if(B!=A){J+=B-A
}E[C].width=A/100
}E[F].width=O/100;
E[F+1].width+=(J/100);
delete this.dragHd;
L.setHdWidths();
L.refresh();
setTimeout(function(){L.disableHeaders=false
},100)
}});
CQ.Ext.ListView.ColumnResizer=CQ.Ext.list.ColumnResizer;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.list.Sorter=CQ.Ext.extend(CQ.Ext.util.Observable,{sortClasses:["sort-asc","sort-desc"],constructor:function(A){CQ.Ext.apply(this,A);
CQ.Ext.list.Sorter.superclass.constructor.call(this)
},init:function(A){this.view=A;
A.on("render",this.initEvents,this)
},initEvents:function(A){A.mon(A.innerHd,"click",this.onHdClick,this);
A.innerHd.setStyle("cursor","pointer");
A.mon(A.store,"datachanged",this.updateSortState,this);
this.updateSortState.defer(10,this,[A.store])
},updateSortState:function(C){var F=C.getSortState();
if(!F){return 
}this.sortState=F;
var E=this.view.columns,G=-1;
for(var D=0,A=E.length;
D<A;
D++){if(E[D].dataIndex==F.field){G=D;
break
}}if(G!=-1){var B=F.direction;
this.updateSortIcon(G,B)
}},updateSortIcon:function(B,A){var D=this.sortClasses;
var C=this.view.innerHd.select("em").removeClass(D);
C.item(B).addClass(D[A=="DESC"?1:0])
},onHdClick:function(C){var B=C.getTarget("em",3);
if(B&&!this.view.disableHeaders){var A=this.view.findHeaderIndex(B);
this.view.store.sort(this.view.columns[A].dataIndex)
}}});
CQ.Ext.ListView.Sorter=CQ.Ext.list.Sorter;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.TabPanel=CQ.Ext.extend(CQ.Ext.Panel,{deferredRender:true,tabWidth:120,minTabWidth:30,resizeTabs:false,enableTabScroll:false,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,tabPosition:"top",baseCls:"x-tab-panel",autoTabs:false,autoTabSelector:"div.x-tab",activeTab:undefined,tabMargin:2,plain:false,wheelIncrement:20,idDelimiter:"__",itemCls:"x-tab-item",elements:"body",headerAsText:false,frame:false,hideBorders:true,initComponent:function(){this.frame=false;
CQ.Ext.TabPanel.superclass.initComponent.call(this);
this.addEvents("beforetabchange","tabchange","contextmenu");
this.setLayout(new CQ.Ext.layout.CardLayout(CQ.Ext.apply({layoutOnCardChange:this.layoutOnTabChange,deferredRender:this.deferredRender},this.layoutConfig)));
if(this.tabPosition=="top"){this.elements+=",header";
this.stripTarget="header"
}else{this.elements+=",footer";
this.stripTarget="footer"
}if(!this.stack){this.stack=CQ.Ext.TabPanel.AccessStack()
}this.initItems()
},onRender:function(C,A){CQ.Ext.TabPanel.superclass.onRender.call(this,C,A);
if(this.plain){var F=this.tabPosition=="top"?"header":"footer";
this[F].addClass("x-tab-panel-"+F+"-plain")
}var B=this[this.stripTarget];
this.stripWrap=B.createChild({cls:"x-tab-strip-wrap",cn:{tag:"ul",cls:"x-tab-strip x-tab-strip-"+this.tabPosition}});
var E=(this.tabPosition=="bottom"?this.stripWrap:null);
B.createChild({cls:"x-tab-strip-spacer"},E);
this.strip=new CQ.Ext.Element(this.stripWrap.dom.firstChild);
this.edge=this.strip.createChild({tag:"li",cls:"x-tab-edge",cn:[{tag:"span",cls:"x-tab-strip-text",cn:"&#160;"}]});
this.strip.createChild({cls:"x-clear"});
this.body.addClass("x-tab-panel-body-"+this.tabPosition);
if(!this.itemTpl){var D=new CQ.Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close"></a>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',"</em></a></li>");
D.disableFormats=true;
D.compile();
CQ.Ext.TabPanel.prototype.itemTpl=D
}this.items.each(this.initTab,this)
},afterRender:function(){CQ.Ext.TabPanel.superclass.afterRender.call(this);
if(this.autoTabs){this.readTabs(false)
}if(this.activeTab!==undefined){var A=CQ.Ext.isObject(this.activeTab)?this.activeTab:this.items.get(this.activeTab);
delete this.activeTab;
this.setActiveTab(A)
}},initEvents:function(){CQ.Ext.TabPanel.superclass.initEvents.call(this);
this.mon(this.strip,{scope:this,mousedown:this.onStripMouseDown,contextmenu:this.onStripContextMenu});
if(this.enableTabScroll){this.mon(this.strip,"mousewheel",this.onWheel,this)
}},findTargets:function(C){var B=null,A=C.getTarget("li:not(.x-tab-edge)",this.strip);
if(A){B=this.getComponent(A.id.split(this.idDelimiter)[1]);
if(B.disabled){return{close:null,item:null,el:null}
}}return{close:C.getTarget(".x-tab-strip-close",this.strip),item:B,el:A}
},onStripMouseDown:function(B){if(B.button!==0){return 
}B.preventDefault();
var A=this.findTargets(B);
if(A.close){if(A.item.fireEvent("beforeclose",A.item)!==false){A.item.fireEvent("close",A.item);
this.remove(A.item)
}return 
}if(A.item&&A.item!=this.activeTab){this.setActiveTab(A.item)
}},onStripContextMenu:function(B){B.preventDefault();
var A=this.findTargets(B);
if(A.item){this.fireEvent("contextmenu",this,A.item,B)
}},readTabs:function(D){if(D===true){this.items.each(function(G){this.remove(G)
},this)
}var C=this.el.query(this.autoTabSelector);
for(var B=0,A=C.length;
B<A;
B++){var E=C[B],F=E.getAttribute("title");
E.removeAttribute("title");
this.add({title:F,contentEl:E})
}},initTab:function(D,B){var E=this.strip.dom.childNodes[B],F=this.getTemplateArgs(D),C=E?this.itemTpl.insertBefore(E,F):this.itemTpl.append(this.strip,F),A="x-tab-strip-over",G=CQ.Ext.get(C);
G.hover(function(){if(!D.disabled){G.addClass(A)
}},function(){G.removeClass(A)
});
if(D.tabTip){G.child("span.x-tab-strip-text",true).qtip=D.tabTip
}D.tabEl=C;
G.select("a").on("click",function(H){if(!H.getPageX()){this.onStripMouseDown(H)
}},this,{preventDefault:true});
D.on({scope:this,disable:this.onItemDisabled,enable:this.onItemEnabled,titlechange:this.onItemTitleChanged,iconchange:this.onItemIconChanged,beforeshow:this.onBeforeShowItem})
},getTemplateArgs:function(B){var A=B.closable?"x-tab-strip-closable":"";
if(B.disabled){A+=" x-item-disabled"
}if(B.iconCls){A+=" x-tab-with-icon"
}if(B.tabCls){A+=" "+B.tabCls
}return{id:this.id+this.idDelimiter+B.getItemId(),text:B.title,cls:A,iconCls:B.iconCls||""}
},onAdd:function(B){CQ.Ext.TabPanel.superclass.onAdd.call(this,B);
if(this.rendered){var A=this.items;
this.initTab(B,A.indexOf(B));
if(A.getCount()==1){this.syncSize()
}this.delegateUpdates()
}},onBeforeAdd:function(B){var A=B.events?(this.items.containsKey(B.getItemId())?B:null):this.items.get(B);
if(A){this.setActiveTab(B);
return false
}CQ.Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);
var C=B.elements;
B.elements=C?C.replace(",header",""):C;
B.border=(B.border===true)
},onRemove:function(C){var B=CQ.Ext.get(C.tabEl);
if(B){B.select("a").removeAllListeners();
CQ.Ext.destroy(B)
}CQ.Ext.TabPanel.superclass.onRemove.call(this,C);
this.stack.remove(C);
delete C.tabEl;
C.un("disable",this.onItemDisabled,this);
C.un("enable",this.onItemEnabled,this);
C.un("titlechange",this.onItemTitleChanged,this);
C.un("iconchange",this.onItemIconChanged,this);
C.un("beforeshow",this.onBeforeShowItem,this);
if(C==this.activeTab){var A=this.stack.next();
if(A){this.setActiveTab(A)
}else{if(this.items.getCount()>0){this.setActiveTab(0)
}else{this.setActiveTab(null)
}}}if(!this.destroying){this.delegateUpdates()
}},onBeforeShowItem:function(A){if(A!=this.activeTab){this.setActiveTab(A);
return false
}},onItemDisabled:function(B){var A=this.getTabEl(B);
if(A){CQ.Ext.fly(A).addClass("x-item-disabled")
}this.stack.remove(B)
},onItemEnabled:function(B){var A=this.getTabEl(B);
if(A){CQ.Ext.fly(A).removeClass("x-item-disabled")
}},onItemTitleChanged:function(B){var A=this.getTabEl(B);
if(A){CQ.Ext.fly(A).child("span.x-tab-strip-text",true).innerHTML=B.title
}},onItemIconChanged:function(D,A,C){var B=this.getTabEl(D);
if(B){B=CQ.Ext.get(B);
B.child("span.x-tab-strip-text").replaceClass(C,A);
B[CQ.Ext.isEmpty(A)?"removeClass":"addClass"]("x-tab-with-icon")
}},getTabEl:function(A){var B=this.getComponent(A);
return B?B.tabEl:null
},onResize:function(){CQ.Ext.TabPanel.superclass.onResize.apply(this,arguments);
this.delegateUpdates()
},beginUpdate:function(){this.suspendUpdates=true
},endUpdate:function(){this.suspendUpdates=false;
this.delegateUpdates()
},hideTabStripItem:function(B){B=this.getComponent(B);
var A=this.getTabEl(B);
if(A){A.style.display="none";
this.delegateUpdates()
}this.stack.remove(B)
},unhideTabStripItem:function(B){B=this.getComponent(B);
var A=this.getTabEl(B);
if(A){A.style.display="";
this.delegateUpdates()
}},delegateUpdates:function(){if(this.suspendUpdates){return 
}if(this.resizeTabs&&this.rendered){this.autoSizeTabs()
}if(this.enableTabScroll&&this.rendered){this.autoScrollTabs()
}},autoSizeTabs:function(){var G=this.items.length,B=this.tabPosition!="bottom"?"header":"footer",C=this[B].dom.offsetWidth,A=this[B].dom.clientWidth;
if(!this.resizeTabs||G<1||!A){return 
}var I=Math.max(Math.min(Math.floor((A-4)/G)-this.tabMargin,this.tabWidth),this.minTabWidth);
this.lastTabWidth=I;
var K=this.strip.query("li:not(.x-tab-edge)");
for(var E=0,H=K.length;
E<H;
E++){var J=K[E],L=CQ.Ext.fly(J).child(".x-tab-strip-inner",true),F=J.offsetWidth,D=L.offsetWidth;
L.style.width=(I-(F-D))+"px"
}},adjustBodyWidth:function(A){if(this.header){this.header.setWidth(A)
}if(this.footer){this.footer.setWidth(A)
}return A
},setActiveTab:function(C){C=this.getComponent(C);
if(this.fireEvent("beforetabchange",this,C,this.activeTab)===false){return 
}if(!this.rendered){this.activeTab=C;
return 
}if(this.activeTab!=C){if(this.activeTab){var A=this.getTabEl(this.activeTab);
if(A){CQ.Ext.fly(A).removeClass("x-tab-strip-active")
}}if(C){var B=this.getTabEl(C);
CQ.Ext.fly(B).addClass("x-tab-strip-active");
this.activeTab=C;
this.stack.add(C);
this.layout.setActiveItem(C);
if(this.scrolling){this.scrollToTab(C,this.animScroll)
}}this.fireEvent("tabchange",this,C)
}},getActiveTab:function(){return this.activeTab||null
},getItem:function(A){return this.getComponent(A)
},autoScrollTabs:function(){this.pos=this.tabPosition=="bottom"?this.footer:this.header;
var G=this.items.length,D=this.pos.dom.offsetWidth,C=this.pos.dom.clientWidth,F=this.stripWrap,E=F.dom,B=E.offsetWidth,H=this.getScrollPos(),A=this.edge.getOffsetsTo(this.stripWrap)[0]+H;
if(!this.enableTabScroll||G<1||B<20){return 
}if(A<=C){E.scrollLeft=0;
F.setWidth(C);
if(this.scrolling){this.scrolling=false;
this.pos.removeClass("x-tab-scrolling");
this.scrollLeft.hide();
this.scrollRight.hide();
if(CQ.Ext.isAir||CQ.Ext.isWebKit){E.style.marginLeft="";
E.style.marginRight=""
}}}else{if(!this.scrolling){this.pos.addClass("x-tab-scrolling");
if(CQ.Ext.isAir||CQ.Ext.isWebKit){E.style.marginLeft="18px";
E.style.marginRight="18px"
}}C-=F.getMargins("lr");
F.setWidth(C>20?C:20);
if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()
}else{this.scrollLeft.show();
this.scrollRight.show()
}}this.scrolling=true;
if(H>(A-C)){E.scrollLeft=A-C
}else{this.scrollToTab(this.activeTab,false)
}this.updateScrollButtons()
}},createScrollers:function(){this.pos.addClass("x-tab-scrolling-"+this.tabPosition);
var C=this.stripWrap.dom.offsetHeight;
var A=this.pos.insertFirst({cls:"x-tab-scroller-left"});
A.setHeight(C);
A.addClassOnOver("x-tab-scroller-left-over");
this.leftRepeater=new CQ.Ext.util.ClickRepeater(A,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});
this.scrollLeft=A;
var B=this.pos.insertFirst({cls:"x-tab-scroller-right"});
B.setHeight(C);
B.addClassOnOver("x-tab-scroller-right-over");
this.rightRepeater=new CQ.Ext.util.ClickRepeater(B,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});
this.scrollRight=B
},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()
},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0
},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0
},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}
},getScrollIncrement:function(){return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100)
},scrollToTab:function(E,A){if(!E){return 
}var C=this.getTabEl(E),G=this.getScrollPos(),D=this.getScrollArea(),F=CQ.Ext.fly(C).getOffsetsTo(this.stripWrap)[0]+G,B=F+C.offsetWidth;
if(F<G){this.scrollTo(F,A)
}else{if(B>(G+D)){this.scrollTo(B-D,A)
}}},scrollTo:function(B,A){this.stripWrap.scrollTo("left",B,A?this.getScrollAnim():false);
if(!A){this.updateScrollButtons()
}},onWheel:function(D){var E=D.getWheelDelta()*this.wheelIncrement*-1;
D.stopEvent();
var F=this.getScrollPos(),C=F+E,A=this.getScrollWidth()-this.getScrollArea();
var B=Math.max(0,Math.min(A,C));
if(B!=F){this.scrollTo(B,false)
}},onScrollRight:function(){var A=this.getScrollWidth()-this.getScrollArea(),C=this.getScrollPos(),B=Math.min(A,C+this.getScrollIncrement());
if(B!=C){this.scrollTo(B,this.animScroll)
}},onScrollLeft:function(){var B=this.getScrollPos(),A=Math.max(0,B-this.getScrollIncrement());
if(A!=B){this.scrollTo(A,this.animScroll)
}},updateScrollButtons:function(){var A=this.getScrollPos();
this.scrollLeft[A===0?"addClass":"removeClass"]("x-tab-scroller-left-disabled");
this.scrollRight[A>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("x-tab-scroller-right-disabled")
},beforeDestroy:function(){CQ.Ext.destroy(this.leftRepeater,this.rightRepeater);
this.deleteMembers("strip","edge","scrollLeft","scrollRight","stripWrap");
this.activeTab=null;
CQ.Ext.TabPanel.superclass.beforeDestroy.apply(this)
}});
CQ.Ext.reg("tabpanel",CQ.Ext.TabPanel);
CQ.Ext.TabPanel.prototype.activate=CQ.Ext.TabPanel.prototype.setActiveTab;
CQ.Ext.TabPanel.AccessStack=function(){var A=[];
return{add:function(B){A.push(B);
if(A.length>10){A.shift()
}},remove:function(E){var D=[];
for(var C=0,B=A.length;
C<B;
C++){if(A[C]!=E){D.push(A[C])
}}A=D
},next:function(){return A.pop()
}}
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Button=CQ.Ext.extend(CQ.Ext.BoxComponent,{hidden:false,disabled:false,pressed:false,enableToggle:false,menuAlign:"tl-bl?",type:"button",menuClassTarget:"tr:nth(2)",clickEvent:"click",handleMouseEvents:true,tooltipType:"qtip",buttonSelector:"button:first-child",scale:"small",iconAlign:"left",arrowAlign:"right",initComponent:function(){CQ.Ext.Button.superclass.initComponent.call(this);
this.addEvents("click","toggle","mouseover","mouseout","menushow","menuhide","menutriggerover","menutriggerout");
if(this.menu){this.menu=CQ.Ext.menu.MenuMgr.get(this.menu)
}if(CQ.Ext.isString(this.toggleGroup)){this.enableToggle=true
}},getTemplateArgs:function(){return[this.type,"x-btn-"+this.scale+" x-btn-icon-"+this.scale+"-"+this.iconAlign,this.getMenuClass(),this.cls,this.id]
},setButtonClass:function(){if(this.useSetClass){if(!CQ.Ext.isEmpty(this.oldCls)){this.el.removeClass([this.oldCls,"x-btn-pressed"])
}this.oldCls=(this.iconCls||this.icon)?(this.text?" x-btn-text-icon":" x-btn-icon"):" x-btn-noicon";
this.el.addClass([this.oldCls,this.pressed?"x-btn-pressed":null])
}},getMenuClass:function(){return this.menu?(this.arrowAlign!="bottom"?"x-btn-arrow":"x-btn-arrow-bottom"):""
},onRender:function(C,A){if(!this.template){if(!CQ.Ext.Button.buttonTemplate){CQ.Ext.Button.buttonTemplate=new CQ.Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em class="{2}" unselectable="on"><button type="{0}"></button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>");
CQ.Ext.Button.buttonTemplate.compile()
}this.template=CQ.Ext.Button.buttonTemplate
}var B,D=this.getTemplateArgs();
if(A){B=this.template.insertBefore(A,D,true)
}else{B=this.template.append(C,D,true)
}this.btnEl=B.child(this.buttonSelector);
this.mon(this.btnEl,{scope:this,focus:this.onFocus,blur:this.onBlur});
this.initButtonEl(B,this.btnEl);
CQ.Ext.ButtonToggleMgr.register(this)
},initButtonEl:function(B,C){this.el=B;
this.setIcon(this.icon);
this.setText(this.text);
this.setIconClass(this.iconCls);
if(CQ.Ext.isDefined(this.tabIndex)){C.dom.tabIndex=this.tabIndex
}if(this.tooltip){this.setTooltip(this.tooltip,true)
}if(this.handleMouseEvents){this.mon(B,{scope:this,mouseover:this.onMouseOver,mousedown:this.onMouseDown})
}if(this.menu){this.mon(this.menu,{scope:this,show:this.onMenuShow,hide:this.onMenuHide})
}if(this.repeat){var A=new CQ.Ext.util.ClickRepeater(B,CQ.Ext.isObject(this.repeat)?this.repeat:{});
this.mon(A,"click",this.onClick,this)
}this.mon(B,this.clickEvent,this.onClick,this)
},afterRender:function(){CQ.Ext.Button.superclass.afterRender.call(this);
this.useSetClass=true;
this.setButtonClass();
this.doc=CQ.Ext.getDoc();
this.doAutoWidth()
},setIconClass:function(A){this.iconCls=A;
if(this.el){this.btnEl.dom.className="";
this.btnEl.addClass(["x-btn-text",A||""]);
this.setButtonClass()
}return this
},setTooltip:function(B,A){if(this.rendered){if(!A){this.clearTip()
}if(CQ.Ext.isObject(B)){CQ.Ext.QuickTips.register(CQ.Ext.apply({target:this.btnEl.id},B));
this.tooltip=B
}else{this.btnEl.dom[this.tooltipType]=B
}}else{this.tooltip=B
}return this
},clearTip:function(){if(CQ.Ext.isObject(this.tooltip)){CQ.Ext.QuickTips.unregister(this.btnEl)
}},beforeDestroy:function(){if(this.rendered){this.clearTip()
}if(this.menu&&this.destroyMenu!==false){CQ.Ext.destroy(this.menu)
}CQ.Ext.destroy(this.repeater)
},onDestroy:function(){if(this.rendered){this.doc.un("mouseover",this.monitorMouseOver,this);
this.doc.un("mouseup",this.onMouseUp,this);
delete this.doc;
delete this.btnEl;
CQ.Ext.ButtonToggleMgr.unregister(this)
}CQ.Ext.Button.superclass.onDestroy.call(this)
},doAutoWidth:function(){if(this.el&&this.text&&this.width===undefined){this.el.setWidth("auto");
if(CQ.Ext.isIE7&&CQ.Ext.isStrict){var A=this.btnEl;
if(A&&A.getWidth()>20){A.clip();
A.setWidth(CQ.Ext.util.TextMetrics.measure(A,this.text).width+A.getFrameWidth("lr"))
}}if(this.minWidth){if(this.el.getWidth()<this.minWidth){this.el.setWidth(this.minWidth)
}}}},setHandler:function(B,A){this.handler=B;
this.scope=A;
return this
},setText:function(A){this.text=A;
if(this.el){this.btnEl.update(A||"&#160;");
this.setButtonClass()
}this.doAutoWidth();
return this
},setIcon:function(A){this.icon=A;
if(this.el){this.btnEl.setStyle("background-image",A?"url("+A+")":"");
this.setButtonClass()
}return this
},getText:function(){return this.text
},toggle:function(B,A){B=B===undefined?!this.pressed:!!B;
if(B!=this.pressed){if(this.rendered){this.el[B?"addClass":"removeClass"]("x-btn-pressed")
}this.pressed=B;
if(!A){this.fireEvent("toggle",this,B);
if(this.toggleHandler){this.toggleHandler.call(this.scope||this,this,B)
}}}return this
},focus:function(){this.btnEl.focus()
},onDisable:function(){this.onDisableChange(true)
},onEnable:function(){this.onDisableChange(false)
},onDisableChange:function(A){if(this.el){if(!CQ.Ext.isIE6||!this.text){this.el[A?"addClass":"removeClass"](this.disabledClass)
}this.el.dom.disabled=A
}this.disabled=A
},showMenu:function(){if(this.rendered&&this.menu){if(this.tooltip){CQ.Ext.QuickTips.getQuickTip().cancelShow(this.btnEl)
}if(this.menu.isVisible()){this.menu.hide()
}this.menu.ownerCt=this;
this.menu.show(this.el,this.menuAlign)
}return this
},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide()
}return this
},hasVisibleMenu:function(){return this.menu&&this.menu.ownerCt==this&&this.menu.isVisible()
},onClick:function(A){if(A){A.preventDefault()
}if(A.button!==0){return 
}if(!this.disabled){if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){this.toggle()
}if(this.menu&&!this.hasVisibleMenu()&&!this.ignoreNextClick){this.showMenu()
}this.fireEvent("click",this,A);
if(this.handler){this.handler.call(this.scope||this,this,A)
}}},isMenuTriggerOver:function(B,A){return this.menu&&!A
},isMenuTriggerOut:function(B,A){return this.menu&&!A
},onMouseOver:function(B){if(!this.disabled){var A=B.within(this.el,true);
if(!A){this.el.addClass("x-btn-over");
if(!this.monitoringMouseOver){this.doc.on("mouseover",this.monitorMouseOver,this);
this.monitoringMouseOver=true
}this.fireEvent("mouseover",this,B)
}if(this.isMenuTriggerOver(B,A)){this.fireEvent("menutriggerover",this,this.menu,B)
}}},monitorMouseOver:function(A){if(A.target!=this.el.dom&&!A.within(this.el)){if(this.monitoringMouseOver){this.doc.un("mouseover",this.monitorMouseOver,this);
this.monitoringMouseOver=false
}this.onMouseOut(A)
}},onMouseOut:function(B){var A=B.within(this.el)&&B.target!=this.el.dom;
this.el.removeClass("x-btn-over");
this.fireEvent("mouseout",this,B);
if(this.isMenuTriggerOut(B,A)){this.fireEvent("menutriggerout",this,this.menu,B)
}},focus:function(){this.btnEl.focus()
},blur:function(){this.btnEl.blur()
},onFocus:function(A){if(!this.disabled){this.el.addClass("x-btn-focus")
}},onBlur:function(A){this.el.removeClass("x-btn-focus")
},getClickEl:function(B,A){return this.el
},onMouseDown:function(A){if(!this.disabled&&A.button===0){this.getClickEl(A).addClass("x-btn-click");
this.doc.on("mouseup",this.onMouseUp,this)
}},onMouseUp:function(A){if(A.button===0){this.getClickEl(A,true).removeClass("x-btn-click");
this.doc.un("mouseup",this.onMouseUp,this)
}},onMenuShow:function(A){if(this.menu.ownerCt==this){this.menu.ownerCt=this;
this.ignoreNextClick=0;
this.el.addClass("x-btn-menu-active");
this.fireEvent("menushow",this,this.menu)
}},onMenuHide:function(A){if(this.menu.ownerCt==this){this.el.removeClass("x-btn-menu-active");
this.ignoreNextClick=this.restoreClick.defer(250,this);
this.fireEvent("menuhide",this,this.menu);
delete this.menu.ownerCt
}},restoreClick:function(){this.ignoreNextClick=0
}});
CQ.Ext.reg("button",CQ.Ext.Button);
CQ.Ext.ButtonToggleMgr=function(){var A={};
function B(E,G){if(G){var F=A[E.toggleGroup];
for(var D=0,C=F.length;
D<C;
D++){if(F[D]!=E){F[D].toggle(false)
}}}}return{register:function(C){if(!C.toggleGroup){return 
}var D=A[C.toggleGroup];
if(!D){D=A[C.toggleGroup]=[]
}D.push(C);
C.on("toggle",B)
},unregister:function(C){if(!C.toggleGroup){return 
}var D=A[C.toggleGroup];
if(D){D.remove(C);
C.un("toggle",B)
}},getPressed:function(F){var E=A[F];
if(E){for(var D=0,C=E.length;
D<C;
D++){if(E[D].pressed===true){return E[D]
}}}return null
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.SplitButton=CQ.Ext.extend(CQ.Ext.Button,{arrowSelector:"em",split:true,initComponent:function(){CQ.Ext.SplitButton.superclass.initComponent.call(this);
this.addEvents("arrowclick")
},onRender:function(){CQ.Ext.SplitButton.superclass.onRender.apply(this,arguments);
if(this.arrowTooltip){this.el.child(this.arrowSelector).dom[this.tooltipType]=this.arrowTooltip
}},setArrowHandler:function(B,A){this.arrowHandler=B;
this.scope=A
},getMenuClass:function(){return"x-btn-split"+(this.arrowAlign=="bottom"?"-bottom":"")
},isClickOnArrow:function(C){if(this.arrowAlign!="bottom"){var B=this.el.child("em.x-btn-split");
var A=B.getRegion().right-B.getPadding("r");
return C.getPageX()>A
}else{return C.getPageY()>this.btnEl.getRegion().bottom
}},onClick:function(B,A){B.preventDefault();
if(!this.disabled){if(this.isClickOnArrow(B)){if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu()
}this.fireEvent("arrowclick",this,B);
if(this.arrowHandler){this.arrowHandler.call(this.scope||this,this,B)
}}else{if(this.enableToggle){this.toggle()
}this.fireEvent("click",this,B);
if(this.handler){this.handler.call(this.scope||this,this,B)
}}}},isMenuTriggerOver:function(A){return this.menu&&A.target.tagName==this.arrowSelector
},isMenuTriggerOut:function(B,A){return this.menu&&B.target.tagName!=this.arrowSelector
}});
CQ.Ext.reg("splitbutton",CQ.Ext.SplitButton);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.CycleButton=CQ.Ext.extend(CQ.Ext.SplitButton,{getItemText:function(A){if(A&&this.showText===true){var B="";
if(this.prependText){B+=this.prependText
}B+=A.text;
return B
}return undefined
},setActiveItem:function(C,A){if(!CQ.Ext.isObject(C)){C=this.menu.getComponent(C)
}if(C){if(!this.rendered){this.text=this.getItemText(C);
this.iconCls=C.iconCls
}else{var B=this.getItemText(C);
if(B){this.setText(B)
}this.setIconClass(C.iconCls)
}this.activeItem=C;
if(!C.checked){C.setChecked(true,false)
}if(this.forceIcon){this.setIconClass(this.forceIcon)
}if(!A){this.fireEvent("change",this,C)
}}},getActiveItem:function(){return this.activeItem
},initComponent:function(){this.addEvents("change");
if(this.changeHandler){this.on("change",this.changeHandler,this.scope||this);
delete this.changeHandler
}this.itemCount=this.items.length;
this.menu={cls:"x-cycle-menu",items:[]};
var A=0;
CQ.Ext.each(this.items,function(C,B){CQ.Ext.apply(C,{group:C.group||this.id,itemIndex:B,checkHandler:this.checkHandler,scope:this,checked:C.checked||false});
this.menu.items.push(C);
if(C.checked){A=B
}},this);
CQ.Ext.CycleButton.superclass.initComponent.call(this);
this.on("click",this.toggleSelected,this);
this.setActiveItem(A,true)
},checkHandler:function(A,B){if(B){this.setActiveItem(A)
}},toggleSelected:function(){var A=this.menu;
A.render();
if(!A.hasLayout){A.doLayout()
}var D,B;
for(var C=1;
C<this.itemCount;
C++){D=(this.activeItem.itemIndex+C)%this.itemCount;
B=A.items.itemAt(D);
if(!B.disabled){B.setChecked(true);
break
}}}});
CQ.Ext.reg("cycle",CQ.Ext.CycleButton);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Toolbar=function(A){if(CQ.Ext.isArray(A)){A={items:A,layout:"toolbar"}
}else{A=CQ.Ext.apply({layout:"toolbar"},A);
if(A.buttons){A.items=A.buttons
}}CQ.Ext.Toolbar.superclass.constructor.call(this,A)
};
(function(){var A=CQ.Ext.Toolbar;
CQ.Ext.extend(A,CQ.Ext.Container,{defaultType:"button",enableOverflow:false,trackMenus:true,internalDefaults:{removeMode:"container",hideParent:true},toolbarCls:"x-toolbar",initComponent:function(){A.superclass.initComponent.call(this);
this.addEvents("overflowchange")
},onRender:function(C,B){if(!this.el){if(!this.autoCreate){this.autoCreate={cls:this.toolbarCls+" x-small-editor"}
}this.el=C.createChild(CQ.Ext.apply({id:this.id},this.autoCreate),B);
CQ.Ext.Toolbar.superclass.onRender.apply(this,arguments)
}},lookupComponent:function(B){if(CQ.Ext.isString(B)){if(B=="-"){B=new A.Separator()
}else{if(B==" "){B=new A.Spacer()
}else{if(B=="->"){B=new A.Fill()
}else{B=new A.TextItem(B)
}}}this.applyDefaults(B)
}else{if(B.isFormField||B.render){B=this.createComponent(B)
}else{if(B.tag){B=new A.Item({autoEl:B})
}else{if(B.tagName){B=new A.Item({el:B})
}else{if(CQ.Ext.isObject(B)){B=B.xtype?this.createComponent(B):this.constructButton(B)
}}}}}return B
},applyDefaults:function(C){if(!CQ.Ext.isString(C)){C=CQ.Ext.Toolbar.superclass.applyDefaults.call(this,C);
var B=this.internalDefaults;
if(C.events){CQ.Ext.applyIf(C.initialConfig,B);
CQ.Ext.apply(C,B)
}else{CQ.Ext.applyIf(C,B)
}}return C
},addSeparator:function(){return this.add(new A.Separator())
},addSpacer:function(){return this.add(new A.Spacer())
},addFill:function(){this.add(new A.Fill())
},addElement:function(B){return this.addItem(new A.Item({el:B}))
},addItem:function(B){return this.add.apply(this,arguments)
},addButton:function(C){if(CQ.Ext.isArray(C)){var E=[];
for(var D=0,B=C.length;
D<B;
D++){E.push(this.addButton(C[D]))
}return E
}return this.add(this.constructButton(C))
},addText:function(B){return this.addItem(new A.TextItem(B))
},addDom:function(B){return this.add(new A.Item({autoEl:B}))
},addField:function(B){return this.add(B)
},insertButton:function(C,F){if(CQ.Ext.isArray(F)){var E=[];
for(var D=0,B=F.length;
D<B;
D++){E.push(this.insertButton(C+D,F[D]))
}return E
}return CQ.Ext.Toolbar.superclass.insert.call(this,C,F)
},trackMenu:function(C,B){if(this.trackMenus&&C.menu){var D=B?"mun":"mon";
this[D](C,"menutriggerover",this.onButtonTriggerOver,this);
this[D](C,"menushow",this.onButtonMenuShow,this);
this[D](C,"menuhide",this.onButtonMenuHide,this)
}},constructButton:function(C){var B=C.events?C:this.createComponent(C,C.split?"splitbutton":this.defaultType);
return B
},onAdd:function(B){CQ.Ext.Toolbar.superclass.onAdd.call(this);
this.trackMenu(B);
if(this.disabled){B.disable()
}},onRemove:function(B){CQ.Ext.Toolbar.superclass.onRemove.call(this);
this.trackMenu(B,true)
},onDisable:function(){this.items.each(function(B){if(B.disable){B.disable()
}})
},onEnable:function(){this.items.each(function(B){if(B.enable){B.enable()
}})
},onButtonTriggerOver:function(B){if(this.activeMenuBtn&&this.activeMenuBtn!=B){this.activeMenuBtn.hideMenu();
B.showMenu();
this.activeMenuBtn=B
}},onButtonMenuShow:function(B){this.activeMenuBtn=B
},onButtonMenuHide:function(B){delete this.activeMenuBtn
}});
CQ.Ext.reg("toolbar",CQ.Ext.Toolbar);
A.Item=CQ.Ext.extend(CQ.Ext.BoxComponent,{hideParent:true,enable:CQ.Ext.emptyFn,disable:CQ.Ext.emptyFn,focus:CQ.Ext.emptyFn});
CQ.Ext.reg("tbitem",A.Item);
A.Separator=CQ.Ext.extend(A.Item,{onRender:function(C,B){this.el=C.createChild({tag:"span",cls:"xtb-sep"},B)
}});
CQ.Ext.reg("tbseparator",A.Separator);
A.Spacer=CQ.Ext.extend(A.Item,{onRender:function(C,B){this.el=C.createChild({tag:"div",cls:"xtb-spacer",style:this.width?"width:"+this.width+"px":""},B)
}});
CQ.Ext.reg("tbspacer",A.Spacer);
A.Fill=CQ.Ext.extend(A.Item,{render:CQ.Ext.emptyFn,isFill:true});
CQ.Ext.reg("tbfill",A.Fill);
A.TextItem=CQ.Ext.extend(A.Item,{constructor:function(B){A.TextItem.superclass.constructor.call(this,CQ.Ext.isString(B)?{text:B}:B)
},onRender:function(C,B){this.autoEl={cls:"xtb-text",html:this.text||""};
A.TextItem.superclass.onRender.call(this,C,B)
},setText:function(B){if(this.rendered){this.el.update(B)
}else{this.text=B
}}});
CQ.Ext.reg("tbtext",A.TextItem);
A.Button=CQ.Ext.extend(CQ.Ext.Button,{});
A.SplitButton=CQ.Ext.extend(CQ.Ext.SplitButton,{});
CQ.Ext.reg("tbbutton",A.Button);
CQ.Ext.reg("tbsplit",A.SplitButton)
})();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ButtonGroup=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-btn-group",layout:"table",defaultType:"button",frame:true,internalDefaults:{removeMode:"container",hideParent:true},initComponent:function(){this.layoutConfig=this.layoutConfig||{};
CQ.Ext.applyIf(this.layoutConfig,{columns:this.columns});
if(!this.title){this.addClass("x-btn-group-notitle")
}this.on("afterlayout",this.onAfterLayout,this);
CQ.Ext.ButtonGroup.superclass.initComponent.call(this)
},applyDefaults:function(B){B=CQ.Ext.ButtonGroup.superclass.applyDefaults.call(this,B);
var A=this.internalDefaults;
if(B.events){CQ.Ext.applyIf(B.initialConfig,A);
CQ.Ext.apply(B,A)
}else{CQ.Ext.applyIf(B,A)
}return B
},onAfterLayout:function(){var A=this.body.getFrameWidth("lr")+this.body.dom.firstChild.offsetWidth;
this.body.setWidth(A);
this.el.setWidth(A+this.getFrameWidth())
}});
CQ.Ext.reg("buttongroup",CQ.Ext.ButtonGroup);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){var A=CQ.Ext.Toolbar;
CQ.Ext.PagingToolbar=CQ.Ext.extend(CQ.Ext.Toolbar,{pageSize:20,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",initComponent:function(){var C=[this.first=new A.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new A.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=new CQ.Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new A.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new A.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new A.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-",this.refresh=new A.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this})];
var B=this.items||this.buttons||[];
if(this.prependButtons){this.items=B.concat(C)
}else{this.items=C.concat(B)
}delete this.buttons;
if(this.displayInfo){this.items.push("->");
this.items.push(this.displayItem=new A.TextItem({}))
}CQ.Ext.PagingToolbar.superclass.initComponent.call(this);
this.addEvents("change","beforechange");
this.on("afterlayout",this.onFirstLayout,this,{single:true});
this.cursor=0;
this.bindStore(this.store,true)
},onFirstLayout:function(){if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)
}},updateInfo:function(){if(this.displayItem){var B=this.store.getCount();
var C=B==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+B,this.store.getTotalCount());
this.displayItem.setText(C)
}},onLoad:function(B,D,H){if(!this.rendered){this.dsLoaded=[B,D,H];
return 
}var E=this.getParams();
this.cursor=(H.params&&H.params[E.start])?H.params[E.start]:0;
var G=this.getPageData(),C=G.activePage,F=G.pages;
this.afterTextItem.setText(String.format(this.afterPageText,G.pages));
this.inputItem.setValue(C);
this.first.setDisabled(C==1);
this.prev.setDisabled(C==1);
this.next.setDisabled(C==F);
this.last.setDisabled(C==F);
this.refresh.enable();
this.updateInfo();
this.fireEvent("change",this,G)
},getPageData:function(){var B=this.store.getTotalCount();
return{total:B,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:B<this.pageSize?1:Math.ceil(B/this.pageSize)}
},changePage:function(B){this.doLoad(((B-1)*this.pageSize).constrain(0,this.store.getTotalCount()))
},onLoadError:function(){if(!this.rendered){return 
}this.refresh.enable()
},readPage:function(D){var B=this.inputItem.getValue(),C;
if(!B||isNaN(C=parseInt(B,10))){this.inputItem.setValue(D.activePage);
return false
}return C
},onPagingFocus:function(){this.inputItem.select()
},onPagingBlur:function(B){this.inputItem.setValue(this.getPageData().activePage)
},onPagingKeyDown:function(F,E){var C=E.getKey(),G=this.getPageData(),D;
if(C==E.RETURN){E.stopEvent();
D=this.readPage(G);
if(D!==false){D=Math.min(Math.max(1,D),G.pages)-1;
this.doLoad(D*this.pageSize)
}}else{if(C==E.HOME||C==E.END){E.stopEvent();
D=C==E.HOME?1:G.pages;
F.setValue(D)
}else{if(C==E.UP||C==E.PAGEUP||C==E.DOWN||C==E.PAGEDOWN){E.stopEvent();
if((D=this.readPage(G))){var B=E.shiftKey?10:1;
if(C==E.DOWN||C==E.PAGEDOWN){B*=-1
}D+=B;
if(D>=1&D<=G.pages){F.setValue(D)
}}}}}},getParams:function(){return this.paramNames||this.store.paramNames
},beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable()
}},doLoad:function(D){var C={},B=this.getParams();
C[B.start]=D;
C[B.limit]=this.pageSize;
if(this.fireEvent("beforechange",this,C)!==false){this.store.load({params:C})
}},moveFirst:function(){this.doLoad(0)
},movePrevious:function(){this.doLoad(Math.max(0,this.cursor-this.pageSize))
},moveNext:function(){this.doLoad(this.cursor+this.pageSize)
},moveLast:function(){var C=this.store.getTotalCount(),B=C%this.pageSize;
this.doLoad(B?(C-B):C-this.pageSize)
},doRefresh:function(){this.doLoad(this.cursor)
},bindStore:function(C,D){var B;
if(!D&&this.store){if(C!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.beforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.onLoadError,this)
}if(!C){this.store=null
}}if(C){C=CQ.Ext.StoreMgr.lookup(C);
C.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError});
B=true
}this.store=C;
if(B){this.onLoad(C,null,{})
}},unbind:function(B){this.bindStore(null)
},bind:function(B){this.bindStore(B)
},onDestroy:function(){this.bindStore(null);
CQ.Ext.PagingToolbar.superclass.onDestroy.call(this)
}})
})();
CQ.Ext.reg("paging",CQ.Ext.PagingToolbar);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.History=(function(){var E,C;
var J=false;
var D;
function F(){var K=top.location.href,L=K.indexOf("#");
return L>=0?K.substr(L+1):null
}function A(){C.value=D
}function G(K){D=K;
CQ.Ext.History.fireEvent("change",decodeURI(K))
}function H(L){var K=['<html><body><div id="state">',CQ.Ext.util.Format.htmlEncode(L),"</div></body></html>"].join("");
try{var N=E.contentWindow.document;
N.open();
N.write(K);
N.close();
return true
}catch(M){return false
}}function B(){if(!E.contentWindow||!E.contentWindow.document){setTimeout(B,10);
return 
}var N=E.contentWindow.document;
var L=N.getElementById("state");
var K=L?L.innerText:null;
var M=F();
setInterval(function(){N=E.contentWindow.document;
L=N.getElementById("state");
var P=L?L.innerText:null;
var O=F();
if(P!==K){K=P;
G(K);
top.location.hash=K;
M=K;
A()
}else{if(O!==M){M=O;
H(O)
}}},50);
J=true;
CQ.Ext.History.fireEvent("ready",CQ.Ext.History)
}function I(){D=C.value?C.value:F();
if(CQ.Ext.isIE){B()
}else{var K=F();
setInterval(function(){var L=F();
if(L!==K){K=L;
G(K);
A()
}},50);
J=true;
CQ.Ext.History.fireEvent("ready",CQ.Ext.History)
}}return{fieldId:"x-history-field",iframeId:"x-history-frame",events:{},init:function(L,K){if(J){CQ.Ext.callback(L,K,[this]);
return 
}if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.History.init(L,K)
});
return 
}C=CQ.Ext.getDom(CQ.Ext.History.fieldId);
if(CQ.Ext.isIE){E=CQ.Ext.getDom(CQ.Ext.History.iframeId)
}this.addEvents("ready","change");
if(L){this.on("ready",L,K,{single:true})
}I()
},add:function(K,M,L){if(M!==false){if(this.getToken()==K){return true
}}if(CQ.Ext.isIE){return H(K)
}else{if(L){CQ.shared.Util.reload(top,"#"+K,L);
top.location.replace("#"+K)
}else{top.location.hash=encodeURI(K)
}return true
}},back:function(){history.go(-1)
},forward:function(){history.go(1)
},getToken:function(){return J?D:F()
}}
})();
CQ.Ext.apply(CQ.Ext.History,new CQ.Ext.util.Observable());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.Tip=CQ.Ext.extend(CQ.Ext.Panel,{minWidth:40,maxWidth:300,shadow:"sides",defaultAlign:"tl-bl?",autoRender:true,quickShowInterval:250,frame:true,hidden:true,baseCls:"x-tip",floating:{shadow:true,shim:true,useDisplay:true,constrain:false},autoHeight:true,closeAction:"hide",initComponent:function(){CQ.Ext.Tip.superclass.initComponent.call(this);
if(this.closable&&!this.title){this.elements+=",header"
}},afterRender:function(){CQ.Ext.Tip.superclass.afterRender.call(this);
if(this.closable){this.addTool({id:"close",handler:this[this.closeAction],scope:this})
}},showAt:function(A){CQ.Ext.Tip.superclass.show.call(this);
if(this.measureWidth!==false&&(!this.initialConfig||typeof this.initialConfig.width!="number")){this.doAutoWidth()
}if(this.constrainPosition){A=this.el.adjustForConstraints(A)
}this.setPagePosition(A[0],A[1])
},doAutoWidth:function(A){A=A||0;
var B=this.body.getTextWidth();
if(this.title){B=Math.max(B,this.header.child("span").getTextWidth(this.title))
}B+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding("lr")+A;
this.setWidth(B.constrain(this.minWidth,this.maxWidth));
if(CQ.Ext.isIE7&&!this.repainted){this.el.repaint();
this.repainted=true
}},showBy:function(A,B){if(!this.rendered){this.render(CQ.Util.getRoot())
}this.showAt(this.el.getAlignToXY(A,B||this.defaultAlign))
},initDraggable:function(){this.dd=new CQ.Ext.Tip.DD(this,typeof this.draggable=="boolean"?null:this.draggable);
this.header.addClass("x-tip-draggable")
}});
CQ.Ext.reg("tip",CQ.Ext.Tip);
CQ.Ext.Tip.DD=function(B,A){CQ.Ext.apply(this,A);
this.tip=B;
CQ.Ext.Tip.DD.superclass.constructor.call(this,B.el.id,"WindowDD-"+B.id);
this.setHandleElId(B.header.id);
this.scroll=false
};
CQ.Ext.extend(CQ.Ext.Tip.DD,CQ.Ext.dd.DD,{moveOnly:true,scroll:false,headerOffsets:[100,25],startDrag:function(){this.tip.el.disableShadow()
},endDrag:function(A){this.tip.el.enableShadow(true)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.ToolTip=CQ.Ext.extend(CQ.Ext.Tip,{showDelay:500,hideDelay:200,dismissDelay:5000,trackMouse:false,anchorToTarget:true,anchorOffset:0,targetCounter:0,constrainPosition:false,initComponent:function(){CQ.Ext.ToolTip.superclass.initComponent.call(this);
this.lastActive=new Date();
this.initTarget(this.target);
this.origAnchor=this.anchor
},onRender:function(B,A){CQ.Ext.ToolTip.superclass.onRender.call(this,B,A);
this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();
this.anchorEl=this.el.createChild({cls:"x-tip-anchor "+this.anchorCls})
},afterRender:function(){CQ.Ext.ToolTip.superclass.afterRender.call(this);
this.anchorEl.setStyle("z-index",this.el.getZIndex()+1)
},initTarget:function(C){var A;
if((A=CQ.Ext.get(C))){if(this.target){var B=CQ.Ext.get(this.target);
this.mun(B,"mouseover",this.onTargetOver,this);
this.mun(B,"mouseout",this.onTargetOut,this);
this.mun(B,"mousemove",this.onMouseMove,this)
}this.mon(A,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove,scope:this});
this.target=A
}if(this.anchor){this.anchorTarget=this.target
}},onMouseMove:function(B){var A=this.delegate?B.getTarget(this.delegate):this.triggerElement=true;
if(A){this.targetXY=B.getXY();
if(A===this.triggerElement){if(!this.hidden&&this.trackMouse){this.setPagePosition(this.getTargetXY())
}}else{this.hide();
this.lastActive=new Date(0);
this.onTargetOver(B)
}}else{if(!this.closable&&this.isVisible()){this.hide()
}}},getTargetXY:function(){if(this.delegate){this.anchorTarget=this.triggerElement
}if(this.anchor){this.targetCounter++;
var C=this.getOffsets(),K=(this.anchorToTarget&&!this.trackMouse)?this.el.getAlignToXY(this.anchorTarget,this.getAnchorAlign()):this.targetXY,A=CQ.Ext.lib.Dom.getViewWidth()-5,G=CQ.Ext.lib.Dom.getViewHeight()-5,H=document.documentElement,E=document.body,J=(H.scrollLeft||E.scrollLeft||0)+5,I=(H.scrollTop||E.scrollTop||0)+5,B=[K[0]+C[0],K[1]+C[1]],F=this.getSize();
this.anchorEl.removeClass(this.anchorCls);
if(this.targetCounter<2){if(B[0]<J){if(this.anchorToTarget){this.defaultAlign="l-r";
if(this.mouseOffset){this.mouseOffset[0]*=-1
}}this.anchor="left";
return this.getTargetXY()
}if(B[0]+F.width>A){if(this.anchorToTarget){this.defaultAlign="r-l";
if(this.mouseOffset){this.mouseOffset[0]*=-1
}}this.anchor="right";
return this.getTargetXY()
}if(B[1]<I){if(this.anchorToTarget){this.defaultAlign="t-b";
if(this.mouseOffset){this.mouseOffset[1]*=-1
}}this.anchor="top";
return this.getTargetXY()
}if(B[1]+F.height>G){if(this.anchorToTarget){this.defaultAlign="b-t";
if(this.mouseOffset){this.mouseOffset[1]*=-1
}}this.anchor="bottom";
return this.getTargetXY()
}}this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();
this.anchorEl.addClass(this.anchorCls);
this.targetCounter=0;
return B
}else{var D=this.getMouseOffset();
return[this.targetXY[0]+D[0],this.targetXY[1]+D[1]]
}},getMouseOffset:function(){var A=this.anchor?[0,0]:[15,18];
if(this.mouseOffset){A[0]+=this.mouseOffset[0];
A[1]+=this.mouseOffset[1]
}return A
},getAnchorPosition:function(){if(this.anchor){this.tipAnchor=this.anchor.charAt(0)
}else{var A=this.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!A){throw"AnchorTip.defaultAlign is invalid"
}this.tipAnchor=A[1].charAt(0)
}switch(this.tipAnchor){case"t":return"top";
case"b":return"bottom";
case"r":return"right"
}return"left"
},getAnchorAlign:function(){switch(this.anchor){case"top":return"tl-bl";
case"left":return"tl-tr";
case"right":return"tr-tl";
default:return"bl-tl"
}},getOffsets:function(){var B,A=this.getAnchorPosition().charAt(0);
if(this.anchorToTarget&&!this.trackMouse){switch(A){case"t":B=[0,9];
break;
case"b":B=[0,-13];
break;
case"r":B=[-13,0];
break;
default:B=[9,0];
break
}}else{switch(A){case"t":B=[-15-this.anchorOffset,30];
break;
case"b":B=[-19-this.anchorOffset,-13-this.el.dom.offsetHeight];
break;
case"r":B=[-15-this.el.dom.offsetWidth,-13-this.anchorOffset];
break;
default:B=[25,-13-this.anchorOffset];
break
}}var C=this.getMouseOffset();
B[0]+=C[0];
B[1]+=C[1];
return B
},onTargetOver:function(B){if(this.disabled||B.within(this.target.dom,true)){return 
}var A=B.getTarget(this.delegate);
if(A){this.triggerElement=A;
this.clearTimer("hide");
this.targetXY=B.getXY();
this.delayShow()
}},delayShow:function(){if(this.hidden&&!this.showTimer){if(this.lastActive.getElapsed()<this.quickShowInterval){this.show()
}else{this.showTimer=this.show.defer(this.showDelay,this)
}}else{if(!this.hidden&&this.autoHide!==false){this.show()
}}},onTargetOut:function(A){if(this.disabled||A.within(this.target.dom,true)){return 
}this.clearTimer("show");
if(this.autoHide!==false){this.delayHide()
}},delayHide:function(){if(!this.hidden&&!this.hideTimer){this.hideTimer=this.hide.defer(this.hideDelay,this)
}},hide:function(){this.clearTimer("dismiss");
this.lastActive=new Date();
if(this.anchorEl){this.anchorEl.hide()
}CQ.Ext.ToolTip.superclass.hide.call(this);
delete this.triggerElement
},show:function(){if(this.anchor){this.showAt([-1000,-1000]);
this.origConstrainPosition=this.constrainPosition;
this.constrainPosition=false;
this.anchor=this.origAnchor
}this.showAt(this.getTargetXY());
if(this.anchor){this.syncAnchor();
this.anchorEl.show();
this.constrainPosition=this.origConstrainPosition
}else{this.anchorEl.hide()
}},showAt:function(A){this.lastActive=new Date();
this.clearTimers();
CQ.Ext.ToolTip.superclass.showAt.call(this,A);
if(this.dismissDelay&&this.autoHide!==false){this.dismissTimer=this.hide.defer(this.dismissDelay,this)
}if(this.anchor&&!this.anchorEl.isVisible()){this.syncAnchor();
this.anchorEl.show()
}},syncAnchor:function(){var A,B,C;
switch(this.tipAnchor.charAt(0)){case"t":A="b";
B="tl";
C=[20+this.anchorOffset,2];
break;
case"r":A="l";
B="tr";
C=[-2,11+this.anchorOffset];
break;
case"b":A="t";
B="bl";
C=[20+this.anchorOffset,-2];
break;
default:A="r";
B="tl";
C=[2,11+this.anchorOffset];
break
}this.anchorEl.alignTo(this.el,A+"-"+B,C)
},setPagePosition:function(A,B){CQ.Ext.ToolTip.superclass.setPagePosition.call(this,A,B);
if(this.anchor){this.syncAnchor()
}},clearTimer:function(A){A=A+"Timer";
clearTimeout(this[A]);
delete this[A]
},clearTimers:function(){this.clearTimer("show");
this.clearTimer("dismiss");
this.clearTimer("hide")
},onShow:function(){CQ.Ext.ToolTip.superclass.onShow.call(this);
CQ.Ext.getDoc().on("mousedown",this.onDocMouseDown,this)
},onHide:function(){CQ.Ext.ToolTip.superclass.onHide.call(this);
CQ.Ext.getDoc().un("mousedown",this.onDocMouseDown,this)
},onDocMouseDown:function(A){if(this.autoHide!==true&&!this.closable&&!A.within(this.el.dom)){this.disable();
this.enable.defer(100,this)
}},onDisable:function(){this.clearTimers();
this.hide()
},adjustPosition:function(A,D){if(this.contstrainPosition){var C=this.targetXY[1],B=this.getSize().height;
if(D<=C&&(D+B)>=C){D=C-B-5
}}return{x:A,y:D}
},beforeDestroy:function(){this.clearTimers();
CQ.Ext.destroy(this.anchorEl);
delete this.anchorEl;
delete this.target;
delete this.anchorTarget;
delete this.triggerElement;
CQ.Ext.ToolTip.superclass.beforeDestroy.call(this)
},onDestroy:function(){CQ.Ext.getDoc().un("mousedown",this.onDocMouseDown,this);
CQ.Ext.ToolTip.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("tooltip",CQ.Ext.ToolTip);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.QuickTip=CQ.Ext.extend(CQ.Ext.ToolTip,{interceptTitles:false,tagConfig:{namespace:"ext",attribute:"qtip",width:"qwidth",target:"target",title:"qtitle",hide:"hide",cls:"qclass",align:"qalign",anchor:"anchor"},initComponent:function(){this.target=this.target||CQ.Ext.getDoc();
this.targets=this.targets||{};
CQ.Ext.QuickTip.superclass.initComponent.call(this)
},register:function(D){var F=CQ.Ext.isArray(D)?D:arguments;
for(var E=0,A=F.length;
E<A;
E++){var H=F[E];
var G=H.target;
if(G){if(CQ.Ext.isArray(G)){for(var C=0,B=G.length;
C<B;
C++){this.targets[CQ.Ext.id(G[C])]=H
}}else{this.targets[CQ.Ext.id(G)]=H
}}}},unregister:function(A){delete this.targets[CQ.Ext.id(A)]
},cancelShow:function(B){var A=this.activeTarget;
B=CQ.Ext.get(B).dom;
if(this.isVisible()){if(A&&A.el==B){this.hide()
}}else{if(A&&A.el==B){this.clearTimer("show")
}}},getTipCfg:function(D){var B=D.getTarget(),C,A;
if(this.interceptTitles&&B.title&&CQ.Ext.isString(B.title)){C=B.title;
B.qtip=C;
B.removeAttribute("title");
D.preventDefault()
}else{A=this.tagConfig;
C=B.qtip||CQ.Ext.fly(B).getAttribute(A.attribute,A.namespace)
}return C
},onTargetOver:function(G){if(this.disabled){return 
}this.targetXY=G.getXY();
var C=G.getTarget();
if(!C||C.nodeType!==1||C==document||C==document.body){return 
}if(this.activeTarget&&((C==this.activeTarget.el)||CQ.Ext.fly(this.activeTarget.el).contains(C))){this.clearTimer("hide");
this.show();
return 
}if(C&&this.targets[C.id]){this.activeTarget=this.targets[C.id];
this.activeTarget.el=C;
this.anchor=this.activeTarget.anchor;
if(this.anchor){this.anchorTarget=C
}this.delayShow();
return 
}var E,F=CQ.Ext.fly(C),B=this.tagConfig,D=B.namespace;
if(E=this.getTipCfg(G)){var A=F.getAttribute(B.hide,D);
this.activeTarget={el:C,text:E,width:F.getAttribute(B.width,D),autoHide:A!="user"&&A!=="false",title:F.getAttribute(B.title,D),cls:F.getAttribute(B.cls,D),align:F.getAttribute(B.align,D)};
this.anchor=F.getAttribute(B.anchor,D);
if(this.anchor){this.anchorTarget=C
}this.delayShow()
}},onTargetOut:function(A){if(this.activeTarget&&A.within(this.activeTarget.el)&&!this.getTipCfg(A)){return 
}this.clearTimer("show");
if(this.autoHide!==false){this.delayHide()
}},showAt:function(B){var A=this.activeTarget;
if(A){if(!this.rendered){this.render(CQ.Util.getRoot());
this.activeTarget=A
}if(A.width){this.setWidth(A.width);
this.body.setWidth(this.adjustBodyWidth(A.width-this.getFrameWidth()));
this.measureWidth=false
}else{this.measureWidth=true
}this.setTitle(A.title||"");
this.body.update(A.text);
this.autoHide=A.autoHide;
this.dismissDelay=A.dismissDelay||this.dismissDelay;
if(this.lastCls){this.el.removeClass(this.lastCls);
delete this.lastCls
}if(A.cls){this.el.addClass(A.cls);
this.lastCls=A.cls
}if(this.anchor){this.constrainPosition=false
}else{if(A.align){B=this.el.getAlignToXY(A.el,A.align);
this.constrainPosition=false
}else{this.constrainPosition=true
}}}CQ.Ext.QuickTip.superclass.showAt.call(this,B)
},hide:function(){delete this.activeTarget;
CQ.Ext.QuickTip.superclass.hide.call(this)
}});
CQ.Ext.reg("quicktip",CQ.Ext.QuickTip);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.QuickTips=function(){var B,A=[];
return{init:function(C){if(!B){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.QuickTips.init(C)
});
return 
}B=new CQ.Ext.QuickTip({elements:"header,body"});
if(C!==false){B.render(CQ.Util.getRoot())
}}},enable:function(){if(B){A.pop();
if(A.length<1){B.enable()
}}},disable:function(){if(B){B.disable()
}A.push(1)
},isEnabled:function(){return B!==undefined&&!B.disabled
},getQuickTip:function(){return B
},register:function(){B.register.apply(B,arguments)
},unregister:function(){B.unregister.apply(B,arguments)
},tips:function(){B.register.apply(B,arguments)
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreePanel=CQ.Ext.extend(CQ.Ext.Panel,{rootVisible:true,animate:CQ.Ext.enableFx,lines:true,enableDD:false,hlDrop:CQ.Ext.enableFx,pathSeparator:"/",bubbleEvents:[],initComponent:function(){CQ.Ext.tree.TreePanel.superclass.initComponent.call(this);
if(!this.eventModel){this.eventModel=new CQ.Ext.tree.TreeEventModel(this)
}var A=this.loader;
if(!A){A=new CQ.Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod})
}else{if(CQ.Ext.isObject(A)&&!A.load){A=new CQ.Ext.tree.TreeLoader(A)
}}this.loader=A;
this.nodeHash={};
if(this.root){var B=this.root;
delete this.root;
this.setRootNode(B)
}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","containerclick","checkchange","beforedblclick","dblclick","containerdblclick","contextmenu","containercontextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover");
if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)
}},proxyNodeEvent:function(C,B,A,G,F,E,D){if(C=="collapse"||C=="expand"||C=="beforecollapse"||C=="beforeexpand"||C=="move"||C=="beforemove"){C=C+"node"
}return this.fireEvent(C,B,A,G,F,E,D)
},getRootNode:function(){return this.root
},setRootNode:function(B){CQ.Ext.destroy(this.root);
if(!B.render){B=this.loader.createNode(B)
}this.root=B;
B.ownerTree=this;
B.isRoot=true;
this.registerNode(B);
if(!this.rootVisible){var A=B.attributes.uiProvider;
B.ui=A?new A(B):new CQ.Ext.tree.RootTreeNodeUI(B)
}if(this.innerCt){this.clearInnerCt();
this.renderRoot()
}return B
},clearInnerCt:function(){this.innerCt.update("")
},renderRoot:function(){this.root.render();
if(!this.rootVisible){this.root.renderChildren()
}},getNodeById:function(A){return this.nodeHash[A]
},registerNode:function(A){this.nodeHash[A.id]=A
},unregisterNode:function(A){delete this.nodeHash[A.id]
},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"
},restrictExpand:function(A){var B=A.parentNode;
if(B){if(B.expandedChild&&B.expandedChild.parentNode==B){B.expandedChild.collapse()
}B.expandedChild=A
}},getChecked:function(A,B){B=B||this.root;
var C=[];
var D=function(){if(this.attributes.checked){C.push(!A?this:(A=="id"?this.id:this.attributes[A]))
}};
B.cascade(D);
return C
},getLoader:function(){return this.loader
},expandAll:function(){this.root.expand(true)
},collapseAll:function(){this.root.collapse(true)
},getSelectionModel:function(){if(!this.selModel){this.selModel=new CQ.Ext.tree.DefaultSelectionModel()
}return this.selModel
},expandPath:function(F,A,G){A=A||"id";
var D=F.split(this.pathSeparator);
var C=this.root;
if(C.attributes[A]!=D[1]){if(G){G(false,null)
}return 
}var B=1;
var E=function(){if(++B==D.length){if(G){G(true,C)
}return 
}var H=C.findChild(A,D[B]);
if(!H){if(G){G(false,C)
}return 
}C=H;
H.expand(false,false,E)
};
C.expand(false,false,E)
},selectPath:function(E,A,F){A=A||"id";
var C=E.split(this.pathSeparator),B=C.pop();
if(C.length>1){var D=function(H,G){if(H&&G){var I=G.findChild(A,B);
if(I){I.select();
if(F){F(true,I)
}}else{if(F){F(false,I)
}}}else{if(F){F(false,I)
}}};
this.expandPath(C.join(this.pathSeparator),A,D)
}else{this.root.select();
if(F){F(true,this.root)
}}},getTreeEl:function(){return this.body
},onRender:function(B,A){CQ.Ext.tree.TreePanel.superclass.onRender.call(this,B,A);
this.el.addClass("x-tree");
this.innerCt=this.body.createChild({tag:"ul",cls:"x-tree-root-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")})
},initEvents:function(){CQ.Ext.tree.TreePanel.superclass.initEvents.call(this);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.body)
}if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new CQ.Ext.tree.TreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.ddAppendOnly===true})
}if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new CQ.Ext.tree.TreeDragZone(this,this.dragConfig||{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})
}this.getSelectionModel().init(this)
},afterRender:function(){CQ.Ext.tree.TreePanel.superclass.afterRender.call(this);
this.renderRoot()
},beforeDestroy:function(){if(this.rendered){CQ.Ext.dd.ScrollManager.unregister(this.body);
CQ.Ext.destroy(this.dropZone,this.dragZone)
}CQ.Ext.destroy(this.root,this.loader);
this.nodeHash=this.root=this.loader=null;
CQ.Ext.tree.TreePanel.superclass.beforeDestroy.call(this)
}});
CQ.Ext.tree.TreePanel.nodeTypes={};
CQ.Ext.reg("treepanel",CQ.Ext.tree.TreePanel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeEventModel=function(A){this.tree=A;
this.tree.on("render",this.initEvents,this)
};
CQ.Ext.tree.TreeEventModel.prototype={initEvents:function(){var A=this.tree;
if(A.trackMouseOver!==false){A.mon(A.innerCt,{scope:this,mouseover:this.delegateOver,mouseout:this.delegateOut})
}A.mon(A.getTreeEl(),{scope:this,click:this.delegateClick,dblclick:this.delegateDblClick,contextmenu:this.delegateContextMenu})
},getNode:function(B){var A;
if(A=B.getTarget(".x-tree-node-el",10)){var C=CQ.Ext.fly(A,"_treeEvents").getAttribute("tree-node-id","ext");
if(C){return this.tree.getNodeById(C)
}}return null
},getNodeTarget:function(B){var A=B.getTarget(".x-tree-node-icon",1);
if(!A){A=B.getTarget(".x-tree-node-el",6)
}return A
},delegateOut:function(B,A){if(!this.beforeEvent(B)){return 
}if(B.getTarget(".x-tree-ec-icon",1)){var C=this.getNode(B);
this.onIconOut(B,C);
if(C==this.lastEcOver){delete this.lastEcOver
}}if((A=this.getNodeTarget(B))&&!B.within(A,true)){this.onNodeOut(B,this.getNode(B))
}},delegateOver:function(B,A){if(!this.beforeEvent(B)){return 
}if(CQ.Ext.isGecko&&!this.trackingDoc){CQ.Ext.getBody().on("mouseover",this.trackExit,this);
this.trackingDoc=true
}if(this.lastEcOver){this.onIconOut(B,this.lastEcOver);
delete this.lastEcOver
}if(B.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(B);
this.onIconOver(B,this.lastEcOver)
}if(A=this.getNodeTarget(B)){this.onNodeOver(B,this.getNode(B))
}},trackExit:function(A){if(this.lastOverNode){if(this.lastOverNode.ui&&!A.within(this.lastOverNode.ui.getEl())){this.onNodeOut(A,this.lastOverNode)
}delete this.lastOverNode;
CQ.Ext.getBody().un("mouseover",this.trackExit,this);
this.trackingDoc=false
}},delegateClick:function(B,A){if(this.beforeEvent(B)){if(B.getTarget("input[type=checkbox]",1)){this.onCheckboxClick(B,this.getNode(B))
}else{if(B.getTarget(".x-tree-ec-icon",1)){this.onIconClick(B,this.getNode(B))
}else{if(this.getNodeTarget(B)){this.onNodeClick(B,this.getNode(B))
}else{this.onContainerEvent(B,"click")
}}}}},delegateDblClick:function(B,A){if(this.beforeEvent(B)){if(this.getNodeTarget(B)){this.onNodeDblClick(B,this.getNode(B))
}else{this.onContainerEvent(B,"dblclick")
}}},delegateContextMenu:function(B,A){if(this.beforeEvent(B)){if(this.getNodeTarget(B)){this.onNodeContextMenu(B,this.getNode(B))
}else{this.onContainerEvent(B,"contextmenu")
}}},onContainerEvent:function(B,A){this.tree.fireEvent("container"+A,this.tree,B)
},onNodeClick:function(B,A){A.ui.onClick(B)
},onNodeOver:function(B,A){this.lastOverNode=A;
A.ui.onOver(B)
},onNodeOut:function(B,A){A.ui.onOut(B)
},onIconOver:function(B,A){A.ui.addClass("x-tree-ec-over")
},onIconOut:function(B,A){A.ui.removeClass("x-tree-ec-over")
},onIconClick:function(B,A){A.ui.ecClick(B)
},onCheckboxClick:function(B,A){A.ui.onCheckChange(B)
},onNodeDblClick:function(B,A){A.ui.onDblClick(B)
},onNodeContextMenu:function(B,A){A.ui.onContextMenu(B)
},beforeEvent:function(B){var A=this.getNode(B);
if(this.disabled||!A||!A.ui){B.stopEvent();
return false
}return true
},disable:function(){this.disabled=true
},enable:function(){this.disabled=false
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.DefaultSelectionModel=function(A){this.selNode=null;
this.addEvents("selectionchange","beforeselect");
CQ.Ext.apply(this,A);
CQ.Ext.tree.DefaultSelectionModel.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.tree.DefaultSelectionModel,CQ.Ext.util.Observable,{init:function(A){this.tree=A;
A.mon(A.getTreeEl(),"keydown",this.onKeyDown,this);
A.on("click",this.onNodeClick,this)
},onNodeClick:function(A,B){this.select(A)
},select:function(C,A){if(!CQ.Ext.fly(C.ui.wrap).isVisible()&&A){return A.call(this,C)
}var B=this.selNode;
if(C==B){C.ui.onSelectedChange(true)
}else{if(this.fireEvent("beforeselect",this,C,B)!==false){if(B&&B.ui){B.ui.onSelectedChange(false)
}this.selNode=C;
C.ui.onSelectedChange(true);
this.fireEvent("selectionchange",this,C,B)
}}return C
},unselect:function(B,A){if(this.selNode==B){this.clearSelections(A)
}},clearSelections:function(A){var B=this.selNode;
if(B){B.ui.onSelectedChange(false);
this.selNode=null;
if(A!==true){this.fireEvent("selectionchange",this,null)
}}return B
},getSelectedNode:function(){return this.selNode
},isSelected:function(A){return this.selNode==A
},selectPrevious:function(A){if(!(A=A||this.selNode||this.lastSelNode)){return null
}var C=A.previousSibling;
if(C){if(!C.isExpanded()||C.childNodes.length<1){return this.select(C,this.selectPrevious)
}else{var B=C.lastChild;
while(B&&B.isExpanded()&&CQ.Ext.fly(B.ui.wrap).isVisible()&&B.childNodes.length>0){B=B.lastChild
}return this.select(B,this.selectPrevious)
}}else{if(A.parentNode&&(this.tree.rootVisible||!A.parentNode.isRoot)){return this.select(A.parentNode,this.selectPrevious)
}}return null
},selectNext:function(B){if(!(B=B||this.selNode||this.lastSelNode)){return null
}if(B.firstChild&&B.isExpanded()&&CQ.Ext.fly(B.ui.wrap).isVisible()){return this.select(B.firstChild,this.selectNext)
}else{if(B.nextSibling){return this.select(B.nextSibling,this.selectNext)
}else{if(B.parentNode){var A=null;
B.parentNode.bubble(function(){if(this.nextSibling){A=this.getOwnerTree().selModel.select(this.nextSibling,this.selectNext);
return false
}});
return A
}}}return null
},onKeyDown:function(C){var B=this.selNode||this.lastSelNode;
var D=this;
if(!B){return 
}var A=C.getKey();
switch(A){case C.DOWN:C.stopEvent();
this.selectNext();
break;
case C.UP:C.stopEvent();
this.selectPrevious();
break;
case C.RIGHT:C.preventDefault();
if(B.hasChildNodes()){if(!B.isExpanded()){B.expand()
}else{if(B.firstChild){this.select(B.firstChild,C)
}}}break;
case C.LEFT:C.preventDefault();
if(B.hasChildNodes()&&B.isExpanded()){B.collapse()
}else{if(B.parentNode&&(this.tree.rootVisible||B.parentNode!=this.tree.getRootNode())){this.select(B.parentNode,C)
}}break
}}});
CQ.Ext.tree.MultiSelectionModel=function(A){this.selNodes=[];
this.selMap={};
this.addEvents("selectionchange");
CQ.Ext.apply(this,A);
CQ.Ext.tree.MultiSelectionModel.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.tree.MultiSelectionModel,CQ.Ext.util.Observable,{init:function(A){this.tree=A;
A.mon(A.getTreeEl(),"keydown",this.onKeyDown,this);
A.on("click",this.onNodeClick,this)
},onNodeClick:function(A,B){if(B.ctrlKey&&this.isSelected(A)){this.unselect(A)
}else{this.select(A,B,B.ctrlKey)
}},select:function(A,C,B){if(B!==true){this.clearSelections(true)
}if(this.isSelected(A)){this.lastSelNode=A;
return A
}this.selNodes.push(A);
this.selMap[A.id]=A;
this.lastSelNode=A;
A.ui.onSelectedChange(true);
this.fireEvent("selectionchange",this,this.selNodes);
return A
},unselect:function(B){if(this.selMap[B.id]){B.ui.onSelectedChange(false);
var C=this.selNodes;
var A=C.indexOf(B);
if(A!=-1){this.selNodes.splice(A,1)
}delete this.selMap[B.id];
this.fireEvent("selectionchange",this,this.selNodes)
}},clearSelections:function(B){var D=this.selNodes;
if(D.length>0){for(var C=0,A=D.length;
C<A;
C++){D[C].ui.onSelectedChange(false)
}this.selNodes=[];
this.selMap={};
if(B!==true){this.fireEvent("selectionchange",this,this.selNodes)
}}},isSelected:function(A){return this.selMap[A.id]?true:false
},getSelectedNodes:function(){return this.selNodes
},onKeyDown:CQ.Ext.tree.DefaultSelectionModel.prototype.onKeyDown,selectNext:CQ.Ext.tree.DefaultSelectionModel.prototype.selectNext,selectPrevious:CQ.Ext.tree.DefaultSelectionModel.prototype.selectPrevious});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.data.Tree=function(A){this.nodeHash={};
this.root=null;
if(A){this.setRootNode(A)
}this.addEvents("append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert");
CQ.Ext.data.Tree.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.data.Tree,CQ.Ext.util.Observable,{pathSeparator:"/",proxyNodeEvent:function(){return this.fireEvent.apply(this,arguments)
},getRootNode:function(){return this.root
},setRootNode:function(A){this.root=A;
A.ownerTree=this;
A.isRoot=true;
this.registerNode(A);
return A
},getNodeById:function(A){return this.nodeHash[A]
},registerNode:function(A){this.nodeHash[A.id]=A
},unregisterNode:function(A){delete this.nodeHash[A.id]
},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"
}});
CQ.Ext.data.Node=function(A){this.attributes=A||{};
this.leaf=this.attributes.leaf;
this.id=this.attributes.id;
if(!this.id){this.id=CQ.Ext.id(null,"xnode-");
this.attributes.id=this.id
}this.childNodes=[];
if(!this.childNodes.indexOf){this.childNodes.indexOf=function(D){for(var C=0,B=this.length;
C<B;
C++){if(this[C]==D){return C
}}return -1
}
}this.parentNode=null;
this.firstChild=null;
this.lastChild=null;
this.previousSibling=null;
this.nextSibling=null;
this.addEvents({append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true});
this.listeners=this.attributes.listeners;
CQ.Ext.data.Node.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.data.Node,CQ.Ext.util.Observable,{fireEvent:function(B){if(CQ.Ext.data.Node.superclass.fireEvent.apply(this,arguments)===false){return false
}var A=this.getOwnerTree();
if(A){if(A.proxyNodeEvent.apply(A,arguments)===false){return false
}}return true
},isLeaf:function(){return this.leaf===true
},setFirstChild:function(A){this.firstChild=A
},setLastChild:function(A){this.lastChild=A
},isLast:function(){return(!this.parentNode?true:this.parentNode.lastChild==this)
},isFirst:function(){return(!this.parentNode?true:this.parentNode.firstChild==this)
},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0
},isExpandable:function(){return this.attributes.expandable||this.hasChildNodes()
},appendChild:function(E){var F=false;
if(CQ.Ext.isArray(E)){F=E
}else{if(arguments.length>1){F=arguments
}}if(F){for(var D=0,A=F.length;
D<A;
D++){this.appendChild(F[D])
}}else{if(this.fireEvent("beforeappend",this.ownerTree,this,E)===false){return false
}var B=this.childNodes.length;
var C=E.parentNode;
if(C){if(E.fireEvent("beforemove",E.getOwnerTree(),E,C,this,B)===false){return false
}C.removeChild(E)
}B=this.childNodes.length;
if(B===0){this.setFirstChild(E)
}this.childNodes.push(E);
E.parentNode=this;
var G=this.childNodes[B-1];
if(G){E.previousSibling=G;
G.nextSibling=E
}else{E.previousSibling=null
}E.nextSibling=null;
this.setLastChild(E);
E.setOwnerTree(this.getOwnerTree());
this.fireEvent("append",this.ownerTree,this,E,B);
if(C){E.fireEvent("move",this.ownerTree,E,C,this,B)
}return E
}},removeChild:function(C,B){var A=this.childNodes.indexOf(C);
if(A==-1){return false
}if(this.fireEvent("beforeremove",this.ownerTree,this,C)===false){return false
}this.childNodes.splice(A,1);
if(C.previousSibling){C.previousSibling.nextSibling=C.nextSibling
}if(C.nextSibling){C.nextSibling.previousSibling=C.previousSibling
}if(this.firstChild==C){this.setFirstChild(C.nextSibling)
}if(this.lastChild==C){this.setLastChild(C.previousSibling)
}C.clear();
this.fireEvent("remove",this.ownerTree,this,C);
if(B){C.destroy()
}return C
},clear:function(A){this.setOwnerTree(null,A);
this.parentNode=this.previousSibling=this.nextSibling=null;
if(A){this.firstChild=this.lastChild=null
}},destroy:function(){this.purgeListeners();
this.clear(true);
CQ.Ext.each(this.childNodes,function(A){A.destroy()
});
this.childNodes=null
},insertBefore:function(D,A){if(!A){return this.appendChild(D)
}if(D==A){return false
}if(this.fireEvent("beforeinsert",this.ownerTree,this,D,A)===false){return false
}var B=this.childNodes.indexOf(A);
var C=D.parentNode;
var E=B;
if(C==this&&this.childNodes.indexOf(D)<B){E--
}if(C){if(D.fireEvent("beforemove",D.getOwnerTree(),D,C,this,B,A)===false){return false
}C.removeChild(D)
}if(E===0){this.setFirstChild(D)
}this.childNodes.splice(E,0,D);
D.parentNode=this;
var F=this.childNodes[E-1];
if(F){D.previousSibling=F;
F.nextSibling=D
}else{D.previousSibling=null
}D.nextSibling=A;
A.previousSibling=D;
D.setOwnerTree(this.getOwnerTree());
this.fireEvent("insert",this.ownerTree,this,D,A);
if(C){D.fireEvent("move",this.ownerTree,D,C,this,E,A)
}return D
},remove:function(A){this.parentNode.removeChild(this,A);
return this
},removeAll:function(A){var C=this.childNodes,B;
while((B=C[0])){this.removeChild(B,A)
}return this
},item:function(A){return this.childNodes[A]
},replaceChild:function(A,C){var B=C?C.nextSibling:null;
this.removeChild(C);
this.insertBefore(A,B);
return C
},indexOf:function(A){return this.childNodes.indexOf(A)
},getOwnerTree:function(){if(!this.ownerTree){var A=this;
while(A){if(A.ownerTree){this.ownerTree=A.ownerTree;
break
}A=A.parentNode
}}return this.ownerTree
},getDepth:function(){var B=0;
var A=this;
while(A.parentNode){++B;
A=A.parentNode
}return B
},setOwnerTree:function(A,B){if(A!=this.ownerTree){if(this.ownerTree){this.ownerTree.unregisterNode(this)
}this.ownerTree=A;
if(B!==true){CQ.Ext.each(this.childNodes,function(C){C.setOwnerTree(A)
})
}if(A){A.registerNode(this)
}}},setId:function(B){if(B!==this.id){var A=this.ownerTree;
if(A){A.unregisterNode(this)
}this.id=this.attributes.id=B;
if(A){A.registerNode(this)
}this.onIdChange(B)
}},onIdChange:CQ.Ext.emptyFn,getPath:function(B){B=B||"id";
var D=this.parentNode;
var A=[this.attributes[B]];
while(D){A.unshift(D.attributes[B]);
D=D.parentNode
}var C=this.getOwnerTree().pathSeparator;
return C+A.join(C)
},bubble:function(C,B,A){var D=this;
while(D){if(C.apply(B||D,A||[D])===false){break
}D=D.parentNode
}},cascade:function(F,E,B){if(F.apply(E||this,B||[this])!==false){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].cascade(F,E,B)
}}},eachChild:function(F,E,B){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){if(F.apply(E||this,B||[D[C]])===false){break
}}},findChild:function(D,E){var C=this.childNodes;
for(var B=0,A=C.length;
B<A;
B++){if(C[B].attributes[D]==E){return C[B]
}}return null
},findChildBy:function(E,D){var C=this.childNodes;
for(var B=0,A=C.length;
B<A;
B++){if(E.call(D||C[B],C[B])===true){return C[B]
}}return null
},sort:function(E,D){var C=this.childNodes;
var A=C.length;
if(A>0){var F=D?function(){E.apply(D,arguments)
}:E;
C.sort(F);
for(var B=0;
B<A;
B++){var G=C[B];
G.previousSibling=C[B-1];
G.nextSibling=C[B+1];
if(B===0){this.setFirstChild(G)
}if(B==A-1){this.setLastChild(G)
}}}},contains:function(A){return A.isAncestor(this)
},isAncestor:function(A){var B=this.parentNode;
while(B){if(B==A){return true
}B=B.parentNode
}return false
},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]"
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeNode=function(A){A=A||{};
if(CQ.Ext.isString(A)){A={text:A}
}this.childrenRendered=false;
this.rendered=false;
CQ.Ext.tree.TreeNode.superclass.constructor.call(this,A);
this.expanded=A.expanded===true;
this.isTarget=A.isTarget!==false;
this.draggable=A.draggable!==false&&A.allowDrag!==false;
this.allowChildren=A.allowChildren!==false&&A.allowDrop!==false;
this.text=A.text;
this.disabled=A.disabled===true;
this.hidden=A.hidden===true;
this.addEvents("textchange","beforeexpand","beforecollapse","expand","disabledchange","collapse","beforeclick","click","checkchange","beforedblclick","dblclick","contextmenu","beforechildrenrendered");
var B=this.attributes.uiProvider||this.defaultUI||CQ.Ext.tree.TreeNodeUI;
this.ui=new B(this)
};
CQ.Ext.extend(CQ.Ext.tree.TreeNode,CQ.Ext.data.Node,{preventHScroll:true,isExpanded:function(){return this.expanded
},getUI:function(){return this.ui
},getLoader:function(){var A;
return this.loader||((A=this.getOwnerTree())&&A.loader?A.loader:(this.loader=new CQ.Ext.tree.TreeLoader()))
},setFirstChild:function(A){var B=this.firstChild;
CQ.Ext.tree.TreeNode.superclass.setFirstChild.call(this,A);
if(this.childrenRendered&&B&&A!=B){B.renderIndent(true,true)
}if(this.rendered){this.renderIndent(true,true)
}},setLastChild:function(B){var A=this.lastChild;
CQ.Ext.tree.TreeNode.superclass.setLastChild.call(this,B);
if(this.childrenRendered&&A&&B!=A){A.renderIndent(true,true)
}if(this.rendered){this.renderIndent(true,true)
}},appendChild:function(C){var B,A;
if(!C.render&&!CQ.Ext.isArray(C)){C=this.getLoader().createNode(C)
}else{A=!C.parentNode
}B=CQ.Ext.tree.TreeNode.superclass.appendChild.call(this,C);
if(B){this.afterAdd(B,A)
}this.ui.updateExpandIcon();
return B
},removeChild:function(B,A){this.ownerTree.getSelectionModel().unselect(B);
CQ.Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);
if(B.ui.rendered){B.ui.remove()
}if(this.childNodes.length<1){this.collapse(false,false)
}else{this.ui.updateExpandIcon()
}if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false
}return B
},insertBefore:function(D,A){var B,C;
if(!D.render){D=this.getLoader().createNode(D)
}else{C=CQ.Ext.isObject(D.parentNode)
}B=CQ.Ext.tree.TreeNode.superclass.insertBefore.call(this,D,A);
if(B&&A){this.afterAdd(B,C)
}this.ui.updateExpandIcon();
return B
},afterAdd:function(B,A){if(this.childrenRendered){B.render(A)
}else{if(A){B.renderIndent(true,true)
}}},setText:function(B){var A=this.text;
this.text=this.attributes.text=B;
if(this.rendered){this.ui.onTextChange(this,B,A)
}this.fireEvent("textchange",this,B,A)
},select:function(){var A=this.getOwnerTree();
if(A){A.getSelectionModel().select(this)
}},unselect:function(A){var B=this.getOwnerTree();
if(B){B.getSelectionModel().unselect(this,A)
}},isSelected:function(){var A=this.getOwnerTree();
return A?A.getSelectionModel().isSelected(this):false
},expand:function(A,C,D,B){if(!this.expanded){if(this.fireEvent("beforeexpand",this,A,C)===false){return 
}if(!this.childrenRendered){this.renderChildren()
}this.expanded=true;
if(!this.isHiddenRoot()&&(this.getOwnerTree().animate&&C!==false)||C){this.ui.animExpand(function(){this.fireEvent("expand",this);
this.runCallback(D,B||this,[this]);
if(A===true){this.expandChildNodes(true)
}}.createDelegate(this));
return 
}else{this.ui.expand();
this.fireEvent("expand",this);
this.runCallback(D,B||this,[this])
}}else{this.runCallback(D,B||this,[this])
}if(A===true){this.expandChildNodes(true)
}},runCallback:function(A,C,B){if(CQ.Ext.isFunction(A)){A.apply(C,B)
}},isHiddenRoot:function(){return this.isRoot&&!this.getOwnerTree().rootVisible
},collapse:function(B,F,G,E){if(this.expanded&&!this.isHiddenRoot()){if(this.fireEvent("beforecollapse",this,B,F)===false){return 
}this.expanded=false;
if((this.getOwnerTree().animate&&F!==false)||F){this.ui.animCollapse(function(){this.fireEvent("collapse",this);
this.runCallback(G,E||this,[this]);
if(B===true){this.collapseChildNodes(true)
}}.createDelegate(this));
return 
}else{this.ui.collapse();
this.fireEvent("collapse",this);
this.runCallback(G,E||this,[this])
}}else{if(!this.expanded){this.runCallback(G,E||this,[this])
}}if(B===true){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].collapse(true,false)
}}},delayedExpand:function(A){if(!this.expandProcId){this.expandProcId=this.expand.defer(A,this)
}},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId)
}this.expandProcId=false
},toggle:function(){if(this.expanded){this.collapse()
}else{this.expand()
}},ensureVisible:function(C,B){var A=this.getOwnerTree();
A.expandPath(this.parentNode?this.parentNode.getPath():this.getPath(),false,function(){var D=A.getNodeById(this.id);
A.getTreeEl().scrollChildIntoView(D.ui.anchor);
this.runCallback(C,B||this,[this])
}.createDelegate(this))
},expandChildNodes:function(B){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].expand(B)
}},collapseChildNodes:function(B){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].collapse(B)
}},disable:function(){this.disabled=true;
this.unselect();
if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,true)
}this.fireEvent("disabledchange",this,true)
},enable:function(){this.disabled=false;
if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,false)
}this.fireEvent("disabledchange",this,false)
},renderChildren:function(B){if(B!==false){this.fireEvent("beforechildrenrendered",this)
}var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].render(true)
}this.childrenRendered=true
},sort:function(E,D){CQ.Ext.tree.TreeNode.superclass.sort.apply(this,arguments);
if(this.childrenRendered){var C=this.childNodes;
for(var B=0,A=C.length;
B<A;
B++){C[B].render(true)
}}},render:function(A){this.ui.render(A);
if(!this.rendered){this.getOwnerTree().registerNode(this);
this.rendered=true;
if(this.expanded){this.expanded=false;
this.expand(false,false)
}}},renderIndent:function(B,E){if(E){this.ui.childIndent=null
}this.ui.renderIndent();
if(B===true&&this.childrenRendered){var D=this.childNodes;
for(var C=0,A=D.length;
C<A;
C++){D[C].renderIndent(true,E)
}}},beginUpdate:function(){this.childrenRendered=false
},endUpdate:function(){if(this.expanded&&this.rendered){this.renderChildren()
}},destroy:function(){this.unselect(true);
CQ.Ext.tree.TreeNode.superclass.destroy.call(this);
CQ.Ext.destroy(this.ui,this.loader);
this.ui=this.loader=null
},onIdChange:function(A){this.ui.onIdChange(A)
}});
CQ.Ext.tree.TreePanel.nodeTypes.node=CQ.Ext.tree.TreeNode;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.AsyncTreeNode=function(A){this.loaded=A&&A.loaded===true;
this.loading=false;
CQ.Ext.tree.AsyncTreeNode.superclass.constructor.apply(this,arguments);
this.addEvents("beforeload","load")
};
CQ.Ext.extend(CQ.Ext.tree.AsyncTreeNode,CQ.Ext.tree.TreeNode,{expand:function(B,E,G,C){if(this.loading){var F;
var D=function(){if(!this.loading){clearInterval(F);
this.expand(B,E,G,C)
}}.createDelegate(this);
F=setInterval(D,200);
return 
}if(!this.loaded){if(this.fireEvent("beforeload",this)===false){return 
}this.loading=true;
this.ui.beforeLoad(this);
var A=this.loader||this.attributes.loader||this.getOwnerTree().getLoader();
if(A){A.load(this,this.loadComplete.createDelegate(this,[B,E,G,C]),this);
return 
}}CQ.Ext.tree.AsyncTreeNode.superclass.expand.call(this,B,E,G,C)
},isLoading:function(){return this.loading
},loadComplete:function(A,C,D,B){this.loading=false;
this.loaded=true;
this.ui.afterLoad(this);
this.fireEvent("load",this);
this.expand(A,C,D,B)
},isLoaded:function(){return this.loaded
},hasChildNodes:function(){if(!this.isLeaf()&&!this.loaded){return true
}else{return CQ.Ext.tree.AsyncTreeNode.superclass.hasChildNodes.call(this)
}},reload:function(B,A){this.collapse(false,false);
while(this.firstChild){this.removeChild(this.firstChild).destroy()
}this.childrenRendered=false;
this.loaded=false;
if(this.isHiddenRoot()){this.expanded=false
}this.expand(false,false,B,A)
}});
CQ.Ext.tree.TreePanel.nodeTypes.async=CQ.Ext.tree.AsyncTreeNode;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeNodeUI=function(A){this.node=A;
this.rendered=false;
this.animating=false;
this.wasLeaf=true;
this.ecc="x-tree-ec-icon x-tree-elbow";
this.emptyIcon=CQ.Ext.BLANK_IMAGE_URL
};
CQ.Ext.tree.TreeNodeUI.prototype={removeChild:function(A){if(this.rendered){this.ctNode.removeChild(A.ui.getEl())
}},beforeLoad:function(){this.addClass("x-tree-node-loading")
},afterLoad:function(){this.removeClass("x-tree-node-loading")
},onTextChange:function(B,C,A){if(this.rendered){this.textNode.innerHTML=C
}},onDisableChange:function(A,B){this.disabled=B;
if(this.checkbox){this.checkbox.disabled=B
}if(B){this.addClass("x-tree-node-disabled")
}else{this.removeClass("x-tree-node-disabled")
}},onSelectedChange:function(A){if(A){this.focus();
this.addClass("x-tree-selected")
}else{this.removeClass("x-tree-selected")
}},onMove:function(A,G,E,F,D,B){this.childIndent=null;
if(this.rendered){var H=F.ui.getContainer();
if(!H){this.holder=document.createElement("div");
this.holder.appendChild(this.wrap);
return 
}var C=B?B.ui.getEl():null;
if(C){H.insertBefore(this.wrap,C)
}else{H.appendChild(this.wrap)
}this.node.renderIndent(true,E!=F)
}},addClass:function(A){if(this.elNode){CQ.Ext.fly(this.elNode).addClass(A)
}},removeClass:function(A){if(this.elNode){CQ.Ext.fly(this.elNode).removeClass(A)
}},remove:function(){if(this.rendered){this.holder=document.createElement("div");
this.holder.appendChild(this.wrap)
}},fireEvent:function(){return this.node.fireEvent.apply(this.node,arguments)
},initEvents:function(){this.node.on("move",this.onMove,this);
if(this.node.disabled){this.onDisableChange(this.node,true)
}if(this.node.hidden){this.hide()
}var B=this.node.getOwnerTree();
var A=B.enableDD||B.enableDrag||B.enableDrop;
if(A&&(!this.node.isRoot||B.rootVisible)){CQ.Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false})
}},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode]
},hide:function(){this.node.hidden=true;
if(this.wrap){this.wrap.style.display="none"
}},show:function(){this.node.hidden=false;
if(this.wrap){this.wrap.style.display=""
}},onContextMenu:function(A){if(this.node.hasListener("contextmenu")||this.node.getOwnerTree().hasListener("contextmenu")){A.preventDefault();
this.focus();
this.fireEvent("contextmenu",this.node,A)
}},onClick:function(B){if(this.dropping){B.stopEvent();
return 
}if(this.fireEvent("beforeclick",this.node,B)!==false){var A=B.getTarget("a");
if(!this.disabled&&this.node.attributes.href&&A){this.fireEvent("click",this.node,B);
return 
}else{if(A&&B.ctrlKey){B.stopEvent()
}}B.preventDefault();
if(this.disabled){return 
}if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){this.node.toggle()
}this.fireEvent("click",this.node,B)
}else{B.stopEvent()
}},onDblClick:function(A){A.preventDefault();
if(this.disabled){return 
}if(this.fireEvent("beforedblclick",this.node,A)!==false){if(this.checkbox){this.toggleCheck()
}if(!this.animating&&this.node.isExpandable()){this.node.toggle()
}this.fireEvent("dblclick",this.node,A)
}},onOver:function(A){this.addClass("x-tree-node-over")
},onOut:function(A){this.removeClass("x-tree-node-over")
},onCheckChange:function(){var A=this.checkbox.checked;
this.checkbox.defaultChecked=A;
this.node.attributes.checked=A;
this.fireEvent("checkchange",this.node,A)
},ecClick:function(A){if(!this.animating&&this.node.isExpandable()){this.node.toggle()
}},startDrop:function(){this.dropping=true
},endDrop:function(){setTimeout(function(){this.dropping=false
}.createDelegate(this),50)
},expand:function(){this.updateExpandIcon();
this.ctNode.style.display=""
},focus:function(){if(!this.node.preventHScroll){try{this.anchor.focus()
}catch(C){}}else{try{var B=this.node.getOwnerTree().getTreeEl().dom;
var A=B.scrollLeft;
this.anchor.focus();
B.scrollLeft=A
}catch(C){}}},toggleCheck:function(B){var A=this.checkbox;
if(A){A.checked=(B===undefined?!A.checked:B);
this.onCheckChange()
}},blur:function(){try{this.anchor.blur()
}catch(A){}},animExpand:function(B){var A=CQ.Ext.get(this.ctNode);
A.stopFx();
if(!this.node.isExpandable()){this.updateExpandIcon();
this.ctNode.style.display="";
CQ.Ext.callback(B);
return 
}this.animating=true;
this.updateExpandIcon();
A.slideIn("t",{callback:function(){this.animating=false;
CQ.Ext.callback(B)
},scope:this,duration:this.node.ownerTree.duration||0.25})
},highlight:function(){var A=this.node.getOwnerTree();
CQ.Ext.fly(this.wrap).highlight(A.hlColor||"C3DAF9",{endColor:A.hlBaseColor})
},collapse:function(){this.updateExpandIcon();
this.ctNode.style.display="none"
},animCollapse:function(B){var A=CQ.Ext.get(this.ctNode);
A.enableDisplayMode("block");
A.stopFx();
this.animating=true;
this.updateExpandIcon();
A.slideOut("t",{callback:function(){this.animating=false;
CQ.Ext.callback(B)
},scope:this,duration:this.node.ownerTree.duration||0.25})
},getContainer:function(){return this.ctNode
},getEl:function(){return this.wrap
},appendDDGhost:function(A){A.appendChild(this.elNode.cloneNode(true))
},getDDRepairXY:function(){return CQ.Ext.lib.Dom.getXY(this.iconNode)
},onRender:function(){this.render()
},render:function(B){var D=this.node,A=D.attributes;
var C=D.parentNode?D.parentNode.ui.getContainer():D.ownerTree.innerCt.dom;
if(!this.rendered){this.rendered=true;
this.renderElements(D,A,C,B);
if(A.qtip){if(this.textNode.setAttributeNS){this.textNode.setAttributeNS("ext","qtip",A.qtip);
if(A.qtipTitle){this.textNode.setAttributeNS("ext","qtitle",A.qtipTitle)
}}else{this.textNode.setAttribute("ext:qtip",A.qtip);
if(A.qtipTitle){this.textNode.setAttribute("ext:qtitle",A.qtipTitle)
}}}else{if(A.qtipCfg){A.qtipCfg.target=CQ.Ext.id(this.textNode);
CQ.Ext.QuickTips.register(A.qtipCfg)
}}this.initEvents();
if(!this.node.expanded){this.updateExpandIcon(true)
}}else{if(B===true){C.appendChild(this.wrap)
}}},renderElements:function(D,I,H,J){this.indentMarkup=D.parentNode?D.parentNode.ui.getChildIndent():"";
var E=CQ.Ext.isBoolean(I.checked),A,B=I.href?I.href:CQ.Ext.isGecko?"":"#",C=['<li class="x-tree-node"><div ext:tree-node-id="',D.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',I.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',I.icon||this.emptyIcon,'" class="x-tree-node-icon',(I.icon?" x-tree-node-inline-icon":""),(I.iconCls?" "+I.iconCls:""),'" unselectable="on" />',E?('<input class="x-tree-node-cb" type="checkbox" '+(I.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',B,'" tabIndex="1" ',I.hrefTarget?' target="'+I.hrefTarget+'"':"",'><span unselectable="on">',D.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");
if(J!==true&&D.nextSibling&&(A=D.nextSibling.ui.getEl())){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",A,C)
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",H,C)
}this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1];
var G=this.elNode.childNodes;
this.indentNode=G[0];
this.ecNode=G[1];
this.iconNode=G[2];
var F=3;
if(E){this.checkbox=G[3];
this.checkbox.defaultChecked=this.checkbox.checked;
F++
}this.anchor=G[F];
this.textNode=G[F].firstChild
},getAnchor:function(){return this.anchor
},getTextEl:function(){return this.textNode
},getIconEl:function(){return this.iconNode
},isChecked:function(){return this.checkbox?this.checkbox.checked:false
},updateExpandIcon:function(){if(this.rendered){var F=this.node,D,C,A=F.isLast()?"x-tree-elbow-end":"x-tree-elbow",E=F.hasChildNodes();
if(E||F.attributes.expandable){if(F.expanded){A+="-minus";
D="x-tree-node-collapsed";
C="x-tree-node-expanded"
}else{A+="-plus";
D="x-tree-node-expanded";
C="x-tree-node-collapsed"
}if(this.wasLeaf){this.removeClass("x-tree-node-leaf");
this.wasLeaf=false
}if(this.c1!=D||this.c2!=C){CQ.Ext.fly(this.elNode).replaceClass(D,C);
this.c1=D;
this.c2=C
}}else{if(!this.wasLeaf){CQ.Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-collapsed");
delete this.c1;
delete this.c2;
this.wasLeaf=true
}}var B="x-tree-ec-icon "+A;
if(this.ecc!=B){this.ecNode.className=B;
this.ecc=B
}}},onIdChange:function(A){if(this.rendered){this.elNode.setAttribute("ext:tree-node-id",A)
}},getChildIndent:function(){if(!this.childIndent){var A=[],B=this.node;
while(B){if(!B.isRoot||(B.isRoot&&B.ownerTree.rootVisible)){if(!B.isLast()){A.unshift('<img src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')
}else{A.unshift('<img src="'+this.emptyIcon+'" class="x-tree-icon" />')
}}B=B.parentNode
}this.childIndent=A.join("")
}return this.childIndent
},renderIndent:function(){if(this.rendered){var A="",B=this.node.parentNode;
if(B){A=B.ui.getChildIndent()
}if(this.indentMarkup!=A){this.indentNode.innerHTML=A;
this.indentMarkup=A
}this.updateExpandIcon()
}},destroy:function(){if(this.elNode){CQ.Ext.dd.Registry.unregister(this.elNode.id)
}CQ.Ext.each(["textnode","anchor","checkbox","indentNode","ecNode","iconNode","elNode","ctNode","wrap","holder"],function(A){if(this[A]){CQ.Ext.fly(this[A]).remove();
delete this[A]
}},this);
delete this.node
}};
CQ.Ext.tree.RootTreeNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{render:function(){if(!this.rendered){var A=this.node.ownerTree.innerCt.dom;
this.node.expanded=true;
A.innerHTML='<div class="x-tree-root-node"></div>';
this.wrap=this.ctNode=A.firstChild
}},collapse:CQ.Ext.emptyFn,expand:CQ.Ext.emptyFn});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeLoader=function(A){this.baseParams={};
CQ.Ext.apply(this,A);
this.addEvents("beforeload","load","loadexception");
CQ.Ext.tree.TreeLoader.superclass.constructor.call(this);
if(CQ.Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}};
CQ.Ext.extend(CQ.Ext.tree.TreeLoader,CQ.Ext.util.Observable,{uiProviders:{},clearOnLoad:true,paramOrder:undefined,paramsAsHash:false,nodeParameter:"node",directFn:undefined,load:function(B,C,A){if(this.clearOnLoad){while(B.firstChild){B.removeChild(B.firstChild)
}}if(this.doPreload(B)){this.runCallback(C,A||B,[B])
}else{if(this.directFn||this.dataUrl||this.url){this.requestData(B,C,A||B)
}}},doPreload:function(D){if(D.attributes.children){if(D.childNodes.length<1){var C=D.attributes.children;
D.beginUpdate();
for(var B=0,A=C.length;
B<A;
B++){var E=D.appendChild(this.createNode(C[B]));
if(this.preloadChildren){this.doPreload(E)
}}D.endUpdate()
}return true
}return false
},getParams:function(F){var E=CQ.Ext.apply({},this.baseParams),G=this.nodeParameter,B=this.paramOrder;
G&&(E[G]=F.id);
if(this.directFn){var C=[F.id];
if(B){if(G&&B.indexOf(G)>-1){C=[]
}for(var D=0,A=B.length;
D<A;
D++){C.push(E[B[D]])
}}else{if(this.paramsAsHash){C=[E]
}}return C
}else{return E
}},requestData:function(C,D,B){if(this.fireEvent("beforeload",this,C,D)!==false){if(this.directFn){var A=this.getParams(C);
A.push(this.processDirectResponse.createDelegate(this,[{callback:D,node:C,scope:B}],true));
this.directFn.apply(window,A)
}else{this.transId=CQ.Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:D,node:C,scope:B},params:this.getParams(C)})
}}else{this.runCallback(D,B||C,[])
}},processDirectResponse:function(A,B,C){if(B.status){this.handleResponse({responseData:CQ.Ext.isArray(A)?A:null,responseText:A,argument:C})
}else{this.handleFailure({argument:C})
}},runCallback:function(A,C,B){if(CQ.Ext.isFunction(A)){A.apply(C,B)
}},isLoading:function(){return !!this.transId
},abort:function(){if(this.isLoading()){CQ.Ext.Ajax.abort(this.transId)
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(this.applyLoader!==false&&!attr.loader){attr.loader=this
}if(CQ.Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.nodeType){return new CQ.Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
}else{return attr.leaf?new CQ.Ext.tree.TreeNode(attr):new CQ.Ext.tree.AsyncTreeNode(attr)
}},processResponse:function(D,C,H,I){var J=D.responseText;
try{var A=D.responseData||CQ.Ext.decode(J);
C.beginUpdate();
for(var E=0,F=A.length;
E<F;
E++){var B=this.createNode(A[E]);
if(B){C.appendChild(B)
}}C.endUpdate();
this.runCallback(H,I||C,[C])
}catch(G){this.handleFailure(D)
}},handleResponse:function(B){this.transId=false;
var A=B.argument;
this.processResponse(B,A.node,A.callback,A.scope);
this.fireEvent("load",this,A.node,B)
},handleFailure:function(B){this.transId=false;
var A=B.argument;
this.fireEvent("loadexception",this,A.node,B);
this.runCallback(A.callback,A.scope||A.node,[A.node])
},destroy:function(){this.abort();
this.purgeListeners()
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeFilter=function(A,B){this.tree=A;
this.filtered={};
CQ.Ext.apply(this,B)
};
CQ.Ext.tree.TreeFilter.prototype={clearBlank:false,reverse:false,autoClear:false,remove:false,filter:function(D,A,B){A=A||"text";
var C;
if(typeof D=="string"){var E=D.length;
if(E==0&&this.clearBlank){this.clear();
return 
}D=D.toLowerCase();
C=function(F){return F.attributes[A].substr(0,E).toLowerCase()==D
}
}else{if(D.exec){C=function(F){return D.test(F.attributes[A])
}
}else{throw"Illegal filter type, must be string or regex"
}}this.filterBy(C,null,B)
},filterBy:function(D,C,B){B=B||this.tree.root;
if(this.autoClear){this.clear()
}var A=this.filtered,H=this.reverse;
var E=function(J){if(J==B){return true
}if(A[J.id]){return false
}var I=D.call(C||J,J);
if(!I||H){A[J.id]=J;
J.ui.hide();
return false
}return true
};
B.cascade(E);
if(this.remove){for(var G in A){if(typeof G!="function"){var F=A[G];
if(F&&F.parentNode){F.parentNode.removeChild(F)
}}}}},clear:function(){var B=this.tree;
var A=this.filtered;
for(var D in A){if(typeof D!="function"){var C=A[D];
if(C){C.ui.show()
}}}this.filtered={}
}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.tree.TreeSorter=function(B,C){CQ.Ext.apply(this,C);
B.on("beforechildrenrendered",this.doSort,this);
B.on("append",this.updateSort,this);
B.on("insert",this.updateSort,this);
B.on("textchange",this.updateSortParent,this);
var E=this.dir&&this.dir.toLowerCase()=="desc";
var F=this.property||"text";
var G=this.sortType;
var A=this.folderSort;
var D=this.caseSensitive===true;
var H=this.leafAttr||"leaf";
this.sortFn=function(J,I){if(A){if(J.attributes[H]&&!I.attributes[H]){return 1
}if(!J.attributes[H]&&I.attributes[H]){return -1
}}var L=G?G(J):(D?J.attributes[F]:J.attributes[F].toUpperCase());
var K=G?G(I):(D?I.attributes[F]:I.attributes[F].toUpperCase());
if(L<K){return E?+1:-1
}else{if(L>K){return E?-1:+1
}else{return 0
}}}
};
CQ.Ext.tree.TreeSorter.prototype={doSort:function(A){A.sort(this.sortFn)
},compareNodes:function(B,A){return(B.text.toUpperCase()>A.text.toUpperCase()?1:-1)
},updateSort:function(A,B){if(B.childrenRendered){this.doSort.defer(1,this,[B])
}},updateSortParent:function(A){var B=A.parentNode;
if(B&&B.childrenRendered){this.doSort.defer(1,this,[B])
}}};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
if(CQ.Ext.dd.DropZone){CQ.Ext.tree.TreeDropZone=function(A,B){this.allowParentInsert=B.allowParentInsert||false;
this.allowContainerDrop=B.allowContainerDrop||false;
this.appendOnly=B.appendOnly||false;
CQ.Ext.tree.TreeDropZone.superclass.constructor.call(this,A.getTreeEl(),B);
this.tree=A;
this.dragOverData={};
this.lastInsertClass="x-tree-no-status"
};
CQ.Ext.extend(CQ.Ext.tree.TreeDropZone,CQ.Ext.dd.DropZone,{ddGroup:"TreeDD",expandDelay:1000,expandNode:function(A){if(A.hasChildNodes()&&!A.isExpanded()){A.expand(false,null,this.triggerCacheRefresh.createDelegate(this))
}},queueExpand:function(A){this.expandProcId=this.expandNode.defer(this.expandDelay,this,[A])
},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId);
this.expandProcId=false
}},isValidDropPoint:function(A,I,G,D,C){if(!A||!C){return false
}var E=A.node;
var F=C.node;
if(!(E&&E.isTarget&&I)){return false
}if(I=="append"&&E.allowChildren===false){return false
}if((I=="above"||I=="below")&&(E.parentNode&&E.parentNode.allowChildren===false)){return false
}if(F&&(E==F||F.contains(E))){return false
}var B=this.dragOverData;
B.tree=this.tree;
B.target=E;
B.data=C;
B.point=I;
B.source=G;
B.rawEvent=D;
B.dropNode=F;
B.cancel=false;
var H=this.tree.fireEvent("nodedragover",B);
return B.cancel===false&&H!==false
},getDropPoint:function(E,D,I){var J=D.node;
if(J.isRoot){return J.allowChildren!==false?"append":false
}var B=D.ddel;
var K=CQ.Ext.lib.Dom.getY(B),G=K+B.offsetHeight;
var F=CQ.Ext.lib.Event.getPageY(E);
var H=J.allowChildren===false||J.isLeaf();
if(this.appendOnly||J.parentNode.allowChildren===false){return H?false:"append"
}var C=false;
if(!this.allowParentInsert){C=J.hasChildNodes()&&J.isExpanded()
}var A=(G-K)/(H?2:3);
if(F>=K&&F<(K+A)){return"above"
}else{if(!C&&(H||F>=G-A&&F<=G)){return"below"
}else{return"append"
}}},onNodeEnter:function(D,A,C,B){this.cancelExpand()
},onContainerOver:function(A,C,B){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",A,C,B)){return this.dropAllowed
}return this.dropNotAllowed
},onNodeOver:function(B,G,F,E){var I=this.getDropPoint(F,B,G);
var C=B.node;
if(!this.expandProcId&&I=="append"&&C.hasChildNodes()&&!B.node.isExpanded()){this.queueExpand(C)
}else{if(I!="append"){this.cancelExpand()
}}var D=this.dropNotAllowed;
if(this.isValidDropPoint(B,I,G,F,E)){if(I){var A=B.ddel;
var H;
if(I=="above"){D=B.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";
H="x-tree-drag-insert-above"
}else{if(I=="below"){D=B.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";
H="x-tree-drag-insert-below"
}else{D="x-tree-drop-ok-append";
H="x-tree-drag-append"
}}if(this.lastInsertClass!=H){CQ.Ext.fly(A).replaceClass(this.lastInsertClass,H);
this.lastInsertClass=H
}}}return D
},onNodeOut:function(D,A,C,B){this.cancelExpand();
this.removeDropIndicators(D)
},onNodeDrop:function(G,B,F,D){var A=this.getDropPoint(F,G,B);
var E=G.node;
E.ui.startDrop();
if(!this.isValidDropPoint(G,A,B,F,D)){E.ui.endDrop();
return false
}var C=D.node||(B.getTreeNode?B.getTreeNode(D,E,A,F):null);
return this.processDrop(E,D,A,B,F,C)
},onContainerDrop:function(A,E,C){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",A,E,C)){var D=this.tree.getRootNode();
D.ui.startDrop();
var B=C.node||(A.getTreeNode?A.getTreeNode(C,D,"append",E):null);
return this.processDrop(D,C,"append",A,E,B)
}return false
},processDrop:function(H,F,B,A,G,D){var E={tree:this.tree,target:H,data:F,point:B,source:A,rawEvent:G,dropNode:D,cancel:!D,dropStatus:false};
var C=this.tree.fireEvent("beforenodedrop",E);
if(C===false||E.cancel===true||!E.dropNode){H.ui.endDrop();
return E.dropStatus
}H=E.target;
if(B=="append"&&!H.isExpanded()){H.expand(false,null,function(){this.completeDrop(E)
}.createDelegate(this))
}else{this.completeDrop(E)
}return true
},completeDrop:function(G){var D=G.dropNode,E=G.point,C=G.target;
if(!CQ.Ext.isArray(D)){D=[D]
}var F;
for(var B=0,A=D.length;
B<A;
B++){F=D[B];
if(E=="above"){C.parentNode.insertBefore(F,C)
}else{if(E=="below"){C.parentNode.insertBefore(F,C.nextSibling)
}else{C.appendChild(F)
}}}F.ui.focus();
if(CQ.Ext.enableFx&&this.tree.hlDrop){F.ui.highlight()
}C.ui.endDrop();
this.tree.fireEvent("nodedrop",G)
},afterNodeMoved:function(A,C,E,D,B){if(CQ.Ext.enableFx&&this.tree.hlDrop){B.ui.focus();
B.ui.highlight()
}this.tree.fireEvent("nodedrop",this.tree,D,C,A,E)
},getTree:function(){return this.tree
},removeDropIndicators:function(B){if(B&&B.ddel){var A=B.ddel;
CQ.Ext.fly(A).removeClass(["x-tree-drag-insert-above","x-tree-drag-insert-below","x-tree-drag-append"]);
this.lastInsertClass="_noclass"
}},beforeDragDrop:function(B,A,C){this.cancelExpand();
return true
},afterRepair:function(A){if(A&&CQ.Ext.enableFx){A.node.ui.highlight()
}this.hideProxy()
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
}if(CQ.Ext.dd.DragZone){CQ.Ext.tree.TreeDragZone=function(A,B){CQ.Ext.tree.TreeDragZone.superclass.constructor.call(this,A.innerCt,B);
this.tree=A
};
CQ.Ext.extend(CQ.Ext.tree.TreeDragZone,CQ.Ext.dd.DragZone,{ddGroup:"TreeDD",onBeforeDrag:function(A,B){var C=A.node;
return C&&C.draggable&&!C.disabled
},onInitDrag:function(B){var A=this.dragData;
this.tree.getSelectionModel().select(A.node);
this.tree.eventModel.disable();
this.proxy.update("");
A.node.ui.appendDDGhost(this.proxy.ghost.dom);
this.tree.fireEvent("startdrag",this.tree,A.node,B)
},getRepairXY:function(B,A){return A.node.ui.getDDRepairXY()
},onEndDrag:function(A,B){this.tree.eventModel.enable.defer(100,this.tree.eventModel);
this.tree.fireEvent("enddrag",this.tree,A.node,B)
},onValidDrop:function(A,B,C){this.tree.fireEvent("dragdrop",this.tree,this.dragData.node,A,B);
this.hideProxy()
},beforeInvalidDrop:function(A,C){var B=this.tree.getSelectionModel();
B.clearSelections();
B.select(this.dragData.node)
},afterRepair:function(){if(CQ.Ext.enableFx&&this.tree.hlDrop){CQ.Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")
}this.dragging=false
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
}CQ.Ext.tree.TreeEditor=function(A,C,B){C=C||{};
var D=C.events?C:new CQ.Ext.form.TextField(C);
CQ.Ext.tree.TreeEditor.superclass.constructor.call(this,D,B);
this.tree=A;
if(!A.rendered){A.on("render",this.initEditor,this)
}else{this.initEditor(A)
}};
CQ.Ext.extend(CQ.Ext.tree.TreeEditor,CQ.Ext.Editor,{alignment:"l-l",autoSize:false,hideEl:false,cls:"x-small-editor x-tree-editor",shim:false,shadow:"frame",maxWidth:250,editDelay:350,initEditor:function(A){A.on({scope:this,beforeclick:this.beforeNodeClick,dblclick:this.onNodeDblClick});
this.on({scope:this,complete:this.updateNode,beforestartedit:this.fitToTree,specialkey:this.onSpecialKey});
this.on("startedit",this.bindScroll,this,{delay:10})
},fitToTree:function(B,C){var E=this.tree.getTreeEl().dom,D=C.dom;
if(E.scrollLeft>D.offsetLeft){E.scrollLeft=D.offsetLeft
}var A=Math.min(this.maxWidth,(E.clientWidth>20?E.clientWidth:E.offsetWidth)-Math.max(0,D.offsetLeft-E.scrollLeft)-5);
this.setSize(A,"")
},triggerEdit:function(A,C){this.completeEdit();
if(A.attributes.editable!==false){this.editNode=A;
if(this.tree.autoScroll){CQ.Ext.fly(A.ui.getEl()).scrollIntoView(this.tree.body)
}var B=A.text||"";
if(!CQ.Ext.isGecko&&CQ.Ext.isEmpty(A.text)){A.setText("&#160;")
}this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[A.ui.textNode,B]);
return false
}},bindScroll:function(){this.tree.getTreeEl().on("scroll",this.cancelEdit,this)
},beforeNodeClick:function(A,B){clearTimeout(this.autoEditTimer);
if(this.tree.getSelectionModel().isSelected(A)){B.stopEvent();
return this.triggerEdit(A)
}},onNodeDblClick:function(A,B){clearTimeout(this.autoEditTimer)
},updateNode:function(A,B){this.tree.getTreeEl().un("scroll",this.cancelEdit,this);
this.editNode.setText(B)
},onHide:function(){CQ.Ext.tree.TreeEditor.superclass.onHide.call(this);
if(this.editNode){this.editNode.ui.focus.defer(50,this.editNode.ui)
}},onSpecialKey:function(C,B){var A=B.getKey();
if(A==B.ESC){B.stopEvent();
this.cancelEdit()
}else{if(A==B.ENTER&&!B.hasModifier()){B.stopEvent();
this.completeEdit()
}}},onDestroy:function(){clearTimeout(this.autoEditTimer);
CQ.Ext.tree.TreeEditor.superclass.onDestroy.call(this);
var A=this.tree;
A.un("beforeclick",this.beforeNodeClick,this);
A.un("dblclick",this.onNodeDblClick,this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.FlashComponent=CQ.Ext.extend(CQ.Ext.BoxComponent,{flashVersion:"9.0.115",backgroundColor:"#ffffff",wmode:"opaque",flashVars:undefined,flashParams:undefined,url:undefined,swfId:undefined,swfWidth:"100%",swfHeight:"100%",expressInstall:false,initComponent:function(){CQ.Ext.FlashComponent.superclass.initComponent.call(this);
this.addEvents("initialize")
},onRender:function(){CQ.Ext.FlashComponent.superclass.onRender.apply(this,arguments);
var B=CQ.Ext.apply({allowScriptAccess:"always",bgcolor:this.backgroundColor,wmode:this.wmode},this.flashParams),A=CQ.Ext.apply({allowedDomain:document.location.hostname,elementID:this.getId(),eventHandler:"CQ.Ext.FlashEventProxy.onEvent"},this.flashVars);
new swfobject.embedSWF(this.url,this.id,this.swfWidth,this.swfHeight,this.flashVersion,this.expressInstall?CQ.Ext.FlashComponent.EXPRESS_INSTALL_URL:undefined,A,B);
this.swf=CQ.Ext.getDom(this.id);
this.el=CQ.Ext.get(this.swf)
},getSwfId:function(){return this.swfId||(this.swfId="extswf"+(++CQ.Ext.Component.AUTO_ID))
},getId:function(){return this.id||(this.id="extflashcmp"+(++CQ.Ext.Component.AUTO_ID))
},onFlashEvent:function(A){switch(A.type){case"swfReady":this.initSwf();
return ;
case"log":return 
}A.component=this;
this.fireEvent(A.type.toLowerCase().replace(/event$/,""),A)
},initSwf:function(){this.onSwfReady(!!this.isInitialized);
this.isInitialized=true;
this.fireEvent("initialize",this)
},beforeDestroy:function(){if(this.rendered){swfobject.removeSWF(this.swf.id)
}CQ.Ext.FlashComponent.superclass.beforeDestroy.call(this)
},onSwfReady:CQ.Ext.emptyFn});
CQ.Ext.FlashComponent.EXPRESS_INSTALL_URL="http://swfobject.googlecode.com/svn/trunk/swfobject/expressInstall.swf";
CQ.Ext.reg("flash",CQ.Ext.FlashComponent);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.FlashEventProxy={onEvent:function(C,B){var A=CQ.Ext.getCmp(C);
if(A){A.onFlashEvent(B)
}else{arguments.callee.defer(10,this,[C,B])
}}}
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
;
CQ.Ext.chart.Chart=CQ.Ext.extend(CQ.Ext.FlashComponent,{refreshBuffer:100,chartStyle:{padding:10,animationEnabled:true,font:{name:"Tahoma",color:4473924,size:11},dataTip:{padding:5,border:{color:10075112,size:1},background:{color:14346230,alpha:0.9},font:{name:"Tahoma",color:1393291,size:10,bold:true}}},extraStyle:null,seriesStyles:null,disableCaching:CQ.Ext.isIE||CQ.Ext.isOpera,disableCacheParam:"_dc",initComponent:function(){CQ.Ext.chart.Chart.superclass.initComponent.call(this);
if(!this.url){this.url=CQ.Ext.chart.Chart.CHART_URL
}if(this.disableCaching){this.url=CQ.Ext.urlAppend(this.url,String.format("{0}={1}",this.disableCacheParam,new Date().getTime()))
}this.addEvents("itemmouseover","itemmouseout","itemclick","itemdoubleclick","itemdragstart","itemdrag","itemdragend","beforerefresh","refresh");
this.store=CQ.Ext.StoreMgr.lookup(this.store)
},setStyle:function(A,B){this.swf.setStyle(A,CQ.Ext.encode(B))
},setStyles:function(A){this.swf.setStyles(CQ.Ext.encode(A))
},setSeriesStyles:function(B){this.seriesStyles=B;
var A=[];
CQ.Ext.each(B,function(C){A.push(CQ.Ext.encode(C))
});
this.swf.setSeriesStyles(A)
},setCategoryNames:function(A){this.swf.setCategoryNames(A)
},setTipRenderer:function(B){var A=this;
this.tipFnName=this.createFnProxy(function(F,D,E){var C=A.store.getAt(D);
return B(A,C,D,E)
},this.tipFnName);
this.swf.setDataTipFunction(this.tipFnName)
},setSeries:function(A){this.series=A;
this.refresh()
},bindStore:function(A,B){if(!B&&this.store){if(A!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("datachanged",this.refresh,this);
this.store.un("add",this.delayRefresh,this);
this.store.un("remove",this.delayRefresh,this);
this.store.un("update",this.delayRefresh,this);
this.store.un("clear",this.refresh,this)
}}if(A){A=CQ.Ext.StoreMgr.lookup(A);
A.on({scope:this,datachanged:this.refresh,add:this.delayRefresh,remove:this.delayRefresh,update:this.delayRefresh,clear:this.refresh})
}this.store=A;
if(A&&!B){this.refresh()
}},onSwfReady:function(A){CQ.Ext.chart.Chart.superclass.onSwfReady.call(this,A);
this.swf.setType(this.type);
if(this.chartStyle){this.setStyles(CQ.Ext.apply({},this.extraStyle,this.chartStyle))
}if(this.categoryNames){this.setCategoryNames(this.categoryNames)
}if(this.tipRenderer){this.setTipRenderer(this.tipRenderer)
}if(!A){this.bindStore(this.store,true)
}this.refresh.defer(10,this)
},delayRefresh:function(){if(!this.refreshTask){this.refreshTask=new CQ.Ext.util.DelayedTask(this.refresh,this)
}this.refreshTask.delay(this.refreshBuffer)
},refresh:function(){if(this.fireEvent("beforerefresh",this)!==false){var J=false;
var H=[],C=this.store.data.items;
for(var F=0,I=C.length;
F<I;
F++){H[F]=C[F].data
}var E=[];
var D=0;
var K=null;
var G=0;
if(this.series){D=this.series.length;
for(G=0;
G<D;
G++){K=this.series[G];
var B={};
for(var A in K){if(A=="style"&&K.style!==null){B.style=CQ.Ext.encode(K.style);
J=true
}else{B[A]=K[A]
}}E.push(B)
}}if(D>0){for(G=0;
G<D;
G++){K=E[G];
if(!K.type){K.type=this.type
}K.dataProvider=H
}}else{E.push({type:this.type,dataProvider:H})
}this.swf.setDataProvider(E);
if(this.seriesStyles){this.setSeriesStyles(this.seriesStyles)
}this.fireEvent("refresh",this)
}},createFnProxy:function(B,A){if(A){delete window[A]
}var C="extFnProxy"+(++CQ.Ext.chart.Chart.PROXY_FN_ID);
window[C]=B;
return C
},onDestroy:function(){CQ.Ext.chart.Chart.superclass.onDestroy.call(this);
this.bindStore(null);
var A=this.tipFnName;
if(!CQ.Ext.isEmpty(A)){delete window[A]
}}});
CQ.Ext.reg("chart",CQ.Ext.chart.Chart);
CQ.Ext.chart.Chart.PROXY_FN_ID=0;
CQ.Ext.chart.Chart.CHART_URL="http://yui.yahooapis.com/2.7.0/build/charts/assets/charts.swf";
CQ.Ext.chart.PieChart=CQ.Ext.extend(CQ.Ext.chart.Chart,{type:"pie",onSwfReady:function(A){CQ.Ext.chart.PieChart.superclass.onSwfReady.call(this,A);
this.setDataField(this.dataField);
this.setCategoryField(this.categoryField)
},setDataField:function(A){this.dataField=A;
this.swf.setDataField(A)
},setCategoryField:function(A){this.categoryField=A;
this.swf.setCategoryField(A)
}});
CQ.Ext.reg("piechart",CQ.Ext.chart.PieChart);
CQ.Ext.chart.CartesianChart=CQ.Ext.extend(CQ.Ext.chart.Chart,{onSwfReady:function(A){CQ.Ext.chart.CartesianChart.superclass.onSwfReady.call(this,A);
if(this.xField){this.setXField(this.xField)
}if(this.yField){this.setYField(this.yField)
}if(this.xAxis){this.setXAxis(this.xAxis)
}if(this.yAxis){this.setYAxis(this.yAxis)
}},setXField:function(A){this.xField=A;
this.swf.setHorizontalField(A)
},setYField:function(A){this.yField=A;
this.swf.setVerticalField(A)
},setXAxis:function(A){this.xAxis=this.createAxis("xAxis",A);
this.swf.setHorizontalAxis(this.xAxis)
},setYAxis:function(A){this.yAxis=this.createAxis("yAxis",A);
this.swf.setVerticalAxis(this.yAxis)
},createAxis:function(C,D){var E=CQ.Ext.apply({},D),A=null;
if(this[C]){A=this[C].labelFunction
}if(E.labelRenderer){var B=E.labelRenderer;
E.labelFunction=this.createFnProxy(function(F){return B(F)
},A);
delete E.labelRenderer
}return E
}});
CQ.Ext.reg("cartesianchart",CQ.Ext.chart.CartesianChart);
CQ.Ext.chart.LineChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"line"});
CQ.Ext.reg("linechart",CQ.Ext.chart.LineChart);
CQ.Ext.chart.ColumnChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"column"});
CQ.Ext.reg("columnchart",CQ.Ext.chart.ColumnChart);
CQ.Ext.chart.StackedColumnChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"stackcolumn"});
CQ.Ext.reg("stackedcolumnchart",CQ.Ext.chart.StackedColumnChart);
CQ.Ext.chart.BarChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"bar"});
CQ.Ext.reg("barchart",CQ.Ext.chart.BarChart);
CQ.Ext.chart.StackedBarChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"stackbar"});
CQ.Ext.reg("stackedbarchart",CQ.Ext.chart.StackedBarChart);
CQ.Ext.chart.Axis=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.chart.Axis.prototype={type:null,orientation:"horizontal",reverse:false,labelFunction:null,hideOverlappingLabels:true};
CQ.Ext.chart.NumericAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"numeric",minimum:NaN,maximum:NaN,majorUnit:NaN,minorUnit:NaN,snapToUnits:true,alwaysShowZero:true,scale:"linear"});
CQ.Ext.chart.TimeAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"time",minimum:null,maximum:null,majorUnit:NaN,majorTimeUnit:null,minorUnit:NaN,minorTimeUnit:null,snapToUnits:true});
CQ.Ext.chart.CategoryAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"category",categoryNames:null});
CQ.Ext.chart.Series=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.chart.Series.prototype={type:null,displayName:null};
CQ.Ext.chart.CartesianSeries=CQ.Ext.extend(CQ.Ext.chart.Series,{xField:null,yField:null});
CQ.Ext.chart.ColumnSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"column"});
CQ.Ext.chart.LineSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"line"});
CQ.Ext.chart.BarSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"bar"});
CQ.Ext.chart.PieSeries=CQ.Ext.extend(CQ.Ext.chart.Series,{type:"pie",dataField:null,categoryField:null});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.Menu=CQ.Ext.extend(CQ.Ext.Container,{minWidth:120,shadow:"sides",subMenuAlign:"tl-tr?",defaultAlign:"tl-bl?",allowOtherMenus:false,ignoreParentClicks:false,enableScrolling:true,maxHeight:null,scrollIncrement:24,showSeparator:true,defaultOffsets:[0,0],plain:false,floating:true,zIndex:15000,hidden:true,layout:"menu",hideMode:"offsets",scrollerHeight:8,autoLayout:true,defaultType:"menuitem",bufferResize:false,initComponent:function(){if(CQ.Ext.isArray(this.initialConfig)){CQ.Ext.apply(this,{items:this.initialConfig})
}this.addEvents("click","mouseover","mouseout","itemclick");
CQ.Ext.menu.MenuMgr.register(this);
if(this.floating){CQ.Ext.EventManager.onWindowResize(this.hide,this)
}else{if(this.initialConfig.hidden!==false){this.hidden=false
}this.internalDefaults={hideOnClick:false}
}CQ.Ext.menu.Menu.superclass.initComponent.call(this);
if(this.autoLayout){var A=this.doLayout.createDelegate(this,[]);
this.on({add:A,remove:A})
}},getLayoutTarget:function(){return this.ul
},onRender:function(B,A){if(!B){B=CQ.Util.getRoot()
}var C={id:this.getId(),cls:"x-menu "+((this.floating)?"x-menu-floating x-layer ":"")+(this.cls||"")+(this.plain?" x-menu-plain":"")+(this.showSeparator?"":" x-menu-nosep"),style:this.style,cn:[{tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"},{tag:"ul",cls:"x-menu-list"}]};
if(this.floating){this.el=new CQ.Ext.Layer({shadow:this.shadow,dh:C,constrain:false,parentEl:B,zindex:this.zIndex})
}else{this.el=B.createChild(C)
}CQ.Ext.menu.Menu.superclass.onRender.call(this,B,A);
if(!this.keyNav){this.keyNav=new CQ.Ext.menu.MenuNav(this)
}this.focusEl=this.el.child("a.x-menu-focus");
this.ul=this.el.child("ul.x-menu-list");
this.mon(this.ul,{scope:this,click:this.onClick,mouseover:this.onMouseOver,mouseout:this.onMouseOut});
if(this.enableScrolling){this.mon(this.el,{scope:this,delegate:".x-menu-scroller",click:this.onScroll,mouseover:this.deactivateActive})
}},findTargetItem:function(B){var A=B.getTarget(".x-menu-list-item",this.ul,true);
if(A&&A.menuItemId){return this.items.get(A.menuItemId)
}},onClick:function(B){var A=this.findTargetItem(B);
if(A){if(A.isFormField){this.setActiveItem(A)
}else{if(A instanceof CQ.Ext.menu.BaseItem){if(A.menu&&this.ignoreParentClicks){A.expandMenu();
B.preventDefault()
}else{if(A.onClick){A.onClick(B);
this.fireEvent("click",this,A,B)
}}}}}},setActiveItem:function(A,B){if(A!=this.activeItem){this.deactivateActive();
if((this.activeItem=A).isFormField){A.focus()
}else{A.activate(B)
}}else{if(B){A.expandMenu()
}}},deactivateActive:function(){var A=this.activeItem;
if(A){if(A.isFormField){if(A.collapse){A.collapse()
}}else{A.deactivate()
}delete this.activeItem
}},tryActivate:function(F,E){var B=this.items;
for(var C=F,A=B.length;
C>=0&&C<A;
C+=E){var D=B.get(C);
if(!D.disabled&&(D.canActivate||D.isFormField)){this.setActiveItem(D,false);
return D
}}return false
},onMouseOver:function(B){var A=this.findTargetItem(B);
if(A){if(A.canActivate&&!A.disabled){this.setActiveItem(A,true)
}}this.over=true;
this.fireEvent("mouseover",this,B,A)
},onMouseOut:function(B){var A=this.findTargetItem(B);
if(A){if(A==this.activeItem&&A.shouldDeactivate&&A.shouldDeactivate(B)){this.activeItem.deactivate();
delete this.activeItem
}}this.over=false;
this.fireEvent("mouseout",this,B,A)
},onScroll:function(D,B){if(D){D.stopEvent()
}var A=this.ul.dom,C=CQ.Ext.fly(B).is(".x-menu-scroller-top");
A.scrollTop+=this.scrollIncrement*(C?-1:1);
if(C?A.scrollTop<=0:A.scrollTop+this.activeMax>=A.scrollHeight){this.onScrollerOut(null,B)
}},onScrollerIn:function(D,B){var A=this.ul.dom,C=CQ.Ext.fly(B).is(".x-menu-scroller-top");
if(C?A.scrollTop>0:A.scrollTop+this.activeMax<A.scrollHeight){CQ.Ext.fly(B).addClass(["x-menu-item-active","x-menu-scroller-active"])
}},onScrollerOut:function(B,A){CQ.Ext.fly(A).removeClass(["x-menu-item-active","x-menu-scroller-active"])
},show:function(B,C,A){if(this.floating){this.parentMenu=A;
if(!this.el){this.render();
this.doLayout(false,true)
}this.showAt(this.el.getAlignToXY(B,C||this.defaultAlign,this.defaultOffsets),A)
}else{CQ.Ext.menu.Menu.superclass.show.call(this)
}},showAt:function(B,A){if(this.fireEvent("beforeshow",this)!==false){this.parentMenu=A;
if(!this.el){this.render()
}if(this.enableScrolling){this.el.setXY(B);
B[1]=this.constrainScroll(B[1]);
B=[this.el.adjustForConstraints(B)[0],B[1]]
}else{B=this.el.adjustForConstraints(B)
}this.el.setXY(B);
this.el.show();
CQ.Ext.menu.Menu.superclass.onShow.call(this);
if(CQ.Ext.isIE){this.fireEvent("autosize",this);
if(!CQ.Ext.isIE8){this.el.repaint()
}}this.hidden=false;
this.focus();
this.fireEvent("show",this)
}},constrainScroll:function(H){var B,D=this.ul.setHeight("auto").getHeight(),A=H,G,E,F,C;
if(this.floating){E=CQ.Ext.fly(this.el.dom.parentNode);
F=E.getScroll().top;
C=E.getViewSize().height;
G=H-F;
B=this.maxHeight?this.maxHeight:C-G;
if(D>C){B=C;
A=H-G
}else{if(B<D){A=H-(D-B);
B=D
}}}else{B=this.getHeight()
}if(D>B&&B>0){this.activeMax=B-this.scrollerHeight*2-this.el.getFrameWidth("tb")-CQ.Ext.num(this.el.shadowOffset,0);
this.ul.setHeight(this.activeMax);
this.createScrollers();
this.el.select(".x-menu-scroller").setDisplayed("")
}else{this.ul.setHeight(D);
this.el.select(".x-menu-scroller").setDisplayed("none")
}this.ul.dom.scrollTop=0;
return A
},createScrollers:function(){if(!this.scroller){this.scroller={pos:0,top:this.el.insertFirst({tag:"div",cls:"x-menu-scroller x-menu-scroller-top",html:"&#160;"}),bottom:this.el.createChild({tag:"div",cls:"x-menu-scroller x-menu-scroller-bottom",html:"&#160;"})};
this.scroller.top.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.topRepeater=new CQ.Ext.util.ClickRepeater(this.scroller.top,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.top],false)}});
this.scroller.bottom.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.bottomRepeater=new CQ.Ext.util.ClickRepeater(this.scroller.bottom,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.bottom],false)}})
}},onLayout:function(){if(this.isVisible()){if(this.enableScrolling){this.constrainScroll(this.el.getTop())
}if(this.floating){this.el.sync()
}}},focus:function(){if(!this.hidden){this.doFocus.defer(50,this)
}},doFocus:function(){if(!this.hidden){this.focusEl.focus()
}},hide:function(A){if(!this.isDestroyed){this.deepHide=A;
CQ.Ext.menu.Menu.superclass.hide.call(this);
delete this.deepHide
}},onHide:function(){CQ.Ext.menu.Menu.superclass.onHide.call(this);
this.deactivateActive();
if(this.el&&this.floating){this.el.hide()
}var A=this.parentMenu;
if(this.deepHide===true&&A){if(A.floating){A.hide(true)
}else{A.deactivateActive()
}}},lookupComponent:function(A){if(CQ.Ext.isString(A)){A=(A=="separator"||A=="-")?new CQ.Ext.menu.Separator():new CQ.Ext.menu.TextItem(A);
this.applyDefaults(A)
}else{if(CQ.Ext.isObject(A)){A=this.getMenuItem(A)
}else{if(A.tagName||A.el){A=new CQ.Ext.BoxComponent({el:A})
}}}return A
},applyDefaults:function(B){if(!CQ.Ext.isString(B)){B=CQ.Ext.menu.Menu.superclass.applyDefaults.call(this,B);
var A=this.internalDefaults;
if(A){if(B.events){CQ.Ext.applyIf(B.initialConfig,A);
CQ.Ext.apply(B,A)
}else{CQ.Ext.applyIf(B,A)
}}}return B
},getMenuItem:function(A){if(!A.isXType){if(!A.xtype&&CQ.Ext.isBoolean(A.checked)){return new CQ.Ext.menu.CheckItem(A)
}return CQ.Ext.create(A,this.defaultType)
}return A
},addSeparator:function(){return this.add(new CQ.Ext.menu.Separator())
},addElement:function(A){return this.add(new CQ.Ext.menu.BaseItem({el:A}))
},addItem:function(A){return this.add(A)
},addMenuItem:function(A){return this.add(this.getMenuItem(A))
},addText:function(A){return this.add(new CQ.Ext.menu.TextItem(A))
},onDestroy:function(){CQ.Ext.EventManager.removeResizeListener(this.hide,this);
var A=this.parentMenu;
if(A&&A.activeChild==this){delete A.activeChild
}delete this.parentMenu;
CQ.Ext.menu.Menu.superclass.onDestroy.call(this);
CQ.Ext.menu.MenuMgr.unregister(this);
if(this.keyNav){this.keyNav.disable()
}var B=this.scroller;
if(B){CQ.Ext.destroy(B.topRepeater,B.bottomRepeater,B.top,B.bottom)
}CQ.Ext.destroy(this.el,this.focusEl,this.ul)
}});
CQ.Ext.reg("menu",CQ.Ext.menu.Menu);
CQ.Ext.menu.MenuNav=CQ.Ext.extend(CQ.Ext.KeyNav,function(){function A(D,C){if(!C.tryActivate(C.items.indexOf(C.activeItem)-1,-1)){C.tryActivate(C.items.length-1,-1)
}}function B(D,C){if(!C.tryActivate(C.items.indexOf(C.activeItem)+1,1)){C.tryActivate(0,1)
}}return{constructor:function(C){CQ.Ext.menu.MenuNav.superclass.constructor.call(this,C.el);
this.scope=this.menu=C
},doRelay:function(E,D){var C=E.getKey();
if(this.menu.activeItem&&this.menu.activeItem.isFormField&&C!=E.TAB){return false
}if(!this.menu.activeItem&&E.isNavKeyPress()&&C!=E.SPACE&&C!=E.RETURN){this.menu.tryActivate(0,1);
return false
}return D.call(this.scope||this,E,this.menu)
},tab:function(D,C){D.stopEvent();
if(D.shiftKey){A(D,C)
}else{B(D,C)
}},up:A,down:B,right:function(D,C){if(C.activeItem){C.activeItem.expandMenu(true)
}},left:function(D,C){C.hide();
if(C.parentMenu&&C.parentMenu.activeItem){C.parentMenu.activeItem.activate()
}},enter:function(D,C){if(C.activeItem){D.stopPropagation();
C.activeItem.onClick(D);
C.fireEvent("click",this,C.activeItem);
return true
}}}
}());
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.MenuMgr=function(){var F,D,C={},A=false,K=new Date();
function M(){F={};
D=new CQ.Ext.util.MixedCollection();
CQ.Ext.getDoc().addKeyListener(27,function(){if(D.length>0){H()
}})
}function H(){if(D&&D.length>0){var N=D.clone();
N.each(function(O){O.hide()
});
return true
}return false
}function E(N){D.remove(N);
if(D.length<1){CQ.Ext.getDoc().un("mousedown",L);
A=false
}}function J(N){var O=D.last();
K=new Date();
D.add(N);
if(!A){CQ.Ext.getDoc().on("mousedown",L);
A=true
}if(N.parentMenu){N.getEl().setZIndex(parseInt(N.parentMenu.getEl().getStyle("z-index"),10)+3);
N.parentMenu.activeChild=N
}else{if(O&&!O.isDestroyed&&O.isVisible()){N.getEl().setZIndex(parseInt(O.getEl().getStyle("z-index"),10)+3)
}}}function B(N){if(N.activeChild){N.activeChild.hide()
}if(N.autoHideTimer){clearTimeout(N.autoHideTimer);
delete N.autoHideTimer
}}function G(N){var O=N.parentMenu;
if(!O&&!N.allowOtherMenus){H()
}else{if(O&&O.activeChild){O.activeChild.hide()
}}}function L(N){if(K.getElapsed()>50&&D.length>0&&!N.getTarget(".x-menu")){H()
}}function I(O,R){if(R){var Q=C[O.group];
for(var P=0,N=Q.length;
P<N;
P++){if(Q[P]!=O){Q[P].setChecked(false)
}}}}return{hideAll:function(){return H()
},register:function(N){if(!F){M()
}F[N.id]=N;
N.on({beforehide:B,hide:E,beforeshow:G,show:J})
},get:function(N){if(typeof N=="string"){if(!F){return null
}return F[N]
}else{if(N.events){return N
}else{if(typeof N.length=="number"){return new CQ.Ext.menu.Menu({items:N})
}else{return CQ.Ext.create(N,"menu")
}}}},unregister:function(N){delete F[N.id];
N.un("beforehide",B);
N.un("hide",E);
N.un("beforeshow",G);
N.un("show",J)
},registerCheckable:function(N){var O=N.group;
if(O){if(!C[O]){C[O]=[]
}C[O].push(N);
N.on("beforecheckchange",I)
}},unregisterCheckable:function(N){var O=N.group;
if(O){C[O].remove(N);
N.un("beforecheckchange",I)
}},getCheckedItem:function(P){var Q=C[P];
if(Q){for(var O=0,N=Q.length;
O<N;
O++){if(Q[O].checked){return Q[O]
}}}return null
},setCheckedItem:function(P,R){var Q=C[P];
if(Q){for(var O=0,N=Q.length;
O<N;
O++){if(Q[O].id==R){Q[O].setChecked(true)
}}}return null
}}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.BaseItem=CQ.Ext.extend(CQ.Ext.Component,{canActivate:false,activeClass:"x-menu-item-active",hideOnClick:true,clickHideDelay:1,ctype:"CQ.Ext.menu.BaseItem",actionMode:"container",initComponent:function(){CQ.Ext.menu.BaseItem.superclass.initComponent.call(this);
this.addEvents("click","activate","deactivate");
if(this.handler){this.on("click",this.handler,this.scope)
}},onRender:function(B,A){CQ.Ext.menu.BaseItem.superclass.onRender.apply(this,arguments);
if(this.ownerCt&&this.ownerCt instanceof CQ.Ext.menu.Menu){this.parentMenu=this.ownerCt
}else{this.container.addClass("x-menu-list-item");
this.mon(this.el,{scope:this,click:this.onClick,mouseenter:this.activate,mouseleave:this.deactivate})
}},setHandler:function(B,A){if(this.handler){this.un("click",this.handler,this.scope)
}this.on("click",this.handler=B,this.scope=A)
},onClick:function(A){if(!this.disabled&&this.fireEvent("click",this,A)!==false&&(this.parentMenu&&this.parentMenu.fireEvent("itemclick",this,A)!==false)){this.handleClick(A)
}else{A.stopEvent()
}},activate:function(){if(this.disabled){return false
}var A=this.container;
A.addClass(this.activeClass);
this.region=A.getRegion().adjust(2,2,-2,-2);
this.fireEvent("activate",this);
return true
},deactivate:function(){this.container.removeClass(this.activeClass);
this.fireEvent("deactivate",this)
},shouldDeactivate:function(A){return !this.region||!this.region.contains(A.getPoint())
},handleClick:function(B){var A=this.parentMenu;
if(this.hideOnClick){if(A.floating){A.hide.defer(this.clickHideDelay,A,[true])
}else{A.deactivateActive()
}}},expandMenu:CQ.Ext.emptyFn,hideMenu:CQ.Ext.emptyFn});
CQ.Ext.reg("menubaseitem",CQ.Ext.menu.BaseItem);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.TextItem=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{hideOnClick:false,itemCls:"x-menu-text",constructor:function(A){if(typeof A=="string"){A={text:A}
}CQ.Ext.menu.TextItem.superclass.constructor.call(this,A)
},onRender:function(){var A=document.createElement("span");
A.className=this.itemCls;
A.innerHTML=this.text;
this.el=A;
CQ.Ext.menu.TextItem.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("menutextitem",CQ.Ext.menu.TextItem);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.Separator=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{itemCls:"x-menu-sep",hideOnClick:false,activeClass:"",onRender:function(A){var B=document.createElement("span");
B.className=this.itemCls;
B.innerHTML="&#160;";
this.el=B;
A.addClass("x-menu-sep-li");
CQ.Ext.menu.Separator.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("menuseparator",CQ.Ext.menu.Separator);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.Item=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{itemCls:"x-menu-item",canActivate:true,showDelay:200,hideDelay:200,ctype:"CQ.Ext.menu.Item",initComponent:function(){CQ.Ext.menu.Item.superclass.initComponent.call(this);
if(this.menu){this.menu=CQ.Ext.menu.MenuMgr.get(this.menu);
this.menu.ownerCt=this
}},onRender:function(C,A){if(!this.itemTpl){this.itemTpl=CQ.Ext.menu.Item.prototype.itemTpl=new CQ.Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"',"</tpl>",">",'<img src="{icon}" class="x-menu-item-icon {iconCls}"/>','<span class="x-menu-item-text">{text}</span>',"</a>")
}var B=this.getTemplateArgs();
this.el=A?this.itemTpl.insertBefore(A,B,true):this.itemTpl.append(C,B,true);
this.iconEl=this.el.child("img.x-menu-item-icon");
this.textEl=this.el.child(".x-menu-item-text");
if(!this.href){this.mon(this.el,"click",CQ.Ext.emptyFn,null,{preventDefault:true})
}CQ.Ext.menu.Item.superclass.onRender.call(this,C,A)
},getTemplateArgs:function(){return{id:this.id,cls:this.itemCls+(this.menu?" x-menu-item-arrow":"")+(this.cls?" "+this.cls:""),href:this.href||"#",hrefTarget:this.hrefTarget,icon:this.icon||CQ.Ext.BLANK_IMAGE_URL,iconCls:this.iconCls||"",text:this.itemText||this.text||"&#160;"}
},setText:function(A){this.text=A||"&#160;";
if(this.rendered){this.textEl.update(this.text);
this.parentMenu.layout.doAutoSize()
}},setIconClass:function(A){var B=this.iconCls;
this.iconCls=A;
if(this.rendered){this.iconEl.replaceClass(B,this.iconCls)
}},beforeDestroy:function(){if(this.menu){delete this.menu.ownerCt;
this.menu.destroy()
}CQ.Ext.menu.Item.superclass.beforeDestroy.call(this)
},handleClick:function(A){if(!this.href){A.stopEvent()
}CQ.Ext.menu.Item.superclass.handleClick.apply(this,arguments)
},activate:function(A){if(CQ.Ext.menu.Item.superclass.activate.apply(this,arguments)){this.focus();
if(A){this.expandMenu()
}}return true
},shouldDeactivate:function(A){if(CQ.Ext.menu.Item.superclass.shouldDeactivate.call(this,A)){if(this.menu&&this.menu.isVisible()){return !this.menu.getEl().getRegion().contains(A.getPoint())
}return true
}return false
},deactivate:function(){CQ.Ext.menu.Item.superclass.deactivate.apply(this,arguments);
this.hideMenu()
},expandMenu:function(A){if(!this.disabled&&this.menu){clearTimeout(this.hideTimer);
delete this.hideTimer;
if(!this.menu.isVisible()&&!this.showTimer){this.showTimer=this.deferExpand.defer(this.showDelay,this,[A])
}else{if(this.menu.isVisible()&&A){this.menu.tryActivate(0,1)
}}}},deferExpand:function(A){delete this.showTimer;
this.menu.show(this.container,this.parentMenu.subMenuAlign||"tl-tr?",this.parentMenu);
if(A){this.menu.tryActivate(0,1)
}},hideMenu:function(){clearTimeout(this.showTimer);
delete this.showTimer;
if(!this.hideTimer&&this.menu&&this.menu.isVisible()){this.hideTimer=this.deferHide.defer(this.hideDelay,this)
}},deferHide:function(){delete this.hideTimer;
if(this.menu.over){this.parentMenu.setActiveItem(this,false)
}else{this.menu.hide()
}}});
CQ.Ext.reg("menuitem",CQ.Ext.menu.Item);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.CheckItem=CQ.Ext.extend(CQ.Ext.menu.Item,{itemCls:"x-menu-item x-menu-check-item",groupClass:"x-menu-group-item",checked:false,ctype:"CQ.Ext.menu.CheckItem",initComponent:function(){CQ.Ext.menu.CheckItem.superclass.initComponent.call(this);
this.addEvents("beforecheckchange","checkchange");
if(this.checkHandler){this.on("checkchange",this.checkHandler,this.scope)
}CQ.Ext.menu.MenuMgr.registerCheckable(this)
},onRender:function(A){CQ.Ext.menu.CheckItem.superclass.onRender.apply(this,arguments);
if(this.group){this.el.addClass(this.groupClass)
}if(this.checked){this.checked=false;
this.setChecked(true,true)
}},destroy:function(){CQ.Ext.menu.MenuMgr.unregisterCheckable(this);
CQ.Ext.menu.CheckItem.superclass.destroy.apply(this,arguments)
},setChecked:function(B,A){var C=A===true;
if(this.checked!=B&&(C||this.fireEvent("beforecheckchange",this,B)!==false)){if(this.container){this.container[B?"addClass":"removeClass"]("x-menu-item-checked")
}this.checked=B;
if(!C){this.fireEvent("checkchange",this,B)
}}},handleClick:function(A){if(!this.disabled&&!(this.checked&&this.group)){this.setChecked(!this.checked)
}CQ.Ext.menu.CheckItem.superclass.handleClick.apply(this,arguments)
}});
CQ.Ext.reg("menucheckitem",CQ.Ext.menu.CheckItem);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.DateMenu=CQ.Ext.extend(CQ.Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,pickerId:null,cls:"x-date-menu",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);
if(this.strict=(CQ.Ext.isIE7&&CQ.Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})
}CQ.Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new CQ.Ext.DatePicker(CQ.Ext.applyIf({internalRender:this.strict||!CQ.Ext.isIE,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});
this.picker.purgeListeners();
CQ.Ext.menu.DateMenu.superclass.initComponent.call(this);
this.relayEvents(this.picker,["select"]);
this.on("show",this.picker.focus,this.picker);
this.on("select",this.menuHide,this);
if(this.handler){this.on("select",this.handler,this.scope||this)
}},menuHide:function(){if(this.hideOnClick){this.hide(true)
}},onBeforeShow:function(){if(this.picker){this.picker.hideMonthPicker(true)
}},onShow:function(){var A=this.picker.getEl();
A.setWidth(A.getWidth())
}});
CQ.Ext.reg("datemenu",CQ.Ext.menu.DateMenu);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.menu.ColorMenu=CQ.Ext.extend(CQ.Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,cls:"x-color-menu",paletteId:null,initComponent:function(){CQ.Ext.apply(this,{plain:true,showSeparator:false,items:this.palette=new CQ.Ext.ColorPalette(CQ.Ext.applyIf({id:this.paletteId},this.initialConfig))});
this.palette.purgeListeners();
CQ.Ext.menu.ColorMenu.superclass.initComponent.call(this);
this.relayEvents(this.palette,["select"]);
this.on("select",this.menuHide,this);
if(this.handler){this.on("select",this.handler,this.scope||this)
}},menuHide:function(){if(this.hideOnClick){this.hide(true)
}}});
CQ.Ext.reg("colormenu",CQ.Ext.menu.ColorMenu);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Field=CQ.Ext.extend(CQ.Ext.BoxComponent,{invalidClass:"x-form-invalid",invalidText:"The value in this field is invalid",focusClass:"x-form-focus",validationEvent:"keyup",validateOnBlur:true,validationDelay:250,defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},fieldClass:"x-form-field",msgTarget:"qtip",msgFx:"normal",readOnly:false,disabled:false,submitValue:true,isFormField:true,msgDisplay:"",hasFocus:false,initComponent:function(){CQ.Ext.form.Field.superclass.initComponent.call(this);
this.addEvents("focus","blur","specialkey","change","invalid","valid")
},getName:function(){return this.rendered&&this.el.dom.name?this.el.dom.name:this.name||this.id||""
},onRender:function(C,A){if(!this.el){var B=this.getAutoCreate();
if(!B.name){B.name=this.name||this.id
}if(this.inputType){B.type=this.inputType
}this.autoEl=B
}CQ.Ext.form.Field.superclass.onRender.call(this,C,A);
if(this.submitValue===false){this.el.dom.removeAttribute("name")
}var D=this.el.dom.type;
if(D){if(D=="password"){D="text"
}this.el.addClass("x-form-"+D)
}if(this.readOnly){this.setReadOnly(true)
}if(this.tabIndex!==undefined){this.el.dom.setAttribute("tabIndex",this.tabIndex)
}this.el.addClass([this.fieldClass,this.cls])
},getItemCt:function(){return this.itemCt
},initValue:function(){if(this.value!==undefined){this.setValue(this.value)
}else{if(!CQ.Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value)
}}this.originalValue=this.getValue()
},isDirty:function(){if(this.disabled||!this.rendered){return false
}return String(this.getValue())!==String(this.originalValue)
},setReadOnly:function(A){if(this.rendered){this.el.dom.readOnly=A
}this.readOnly=A
},afterRender:function(){CQ.Ext.form.Field.superclass.afterRender.call(this);
this.initEvents();
this.initValue()
},fireKey:function(A){if(A.isSpecialKey()){this.fireEvent("specialkey",this,A)
}},reset:function(){this.setValue(this.originalValue);
this.clearInvalid()
},initEvents:function(){this.mon(this.el,CQ.Ext.EventManager.useKeydown?"keydown":"keypress",this.fireKey,this);
this.mon(this.el,"focus",this.onFocus,this);
this.mon(this.el,"blur",this.onBlur,this,this.inEditor?{buffer:10}:null)
},preFocus:CQ.Ext.emptyFn,onFocus:function(){this.preFocus();
if(this.focusClass){this.el.addClass(this.focusClass)
}if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},beforeBlur:CQ.Ext.emptyFn,onBlur:function(){this.beforeBlur();
if(this.focusClass){this.el.removeClass(this.focusClass)
}this.hasFocus=false;
if(this.validationEvent!==false&&(this.validateOnBlur||this.validationEvent=="blur")){this.validate()
}var A=this.getValue();
if(String(A)!==String(this.startValue)){this.fireEvent("change",this,A,this.startValue)
}this.fireEvent("blur",this);
this.postBlur()
},postBlur:CQ.Ext.emptyFn,isValid:function(A){if(this.disabled){return true
}var C=this.preventMark;
this.preventMark=A===true;
var B=this.validateValue(this.processValue(this.getRawValue()));
this.preventMark=C;
return B
},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();
return true
}return false
},processValue:function(A){return A
},validateValue:function(A){return true
},getActiveError:function(){return this.activeError||""
},markInvalid:function(C){if(!this.rendered||this.preventMark){return 
}C=C||this.invalidText;
var A=this.getMessageHandler();
if(A){A.mark(this,C)
}else{if(this.msgTarget){this.el.addClass(this.invalidClass);
var B=CQ.Ext.getDom(this.msgTarget);
if(B){B.innerHTML=C;
B.style.display=this.msgDisplay
}}}this.activeError=C;
this.fireEvent("invalid",this,C)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}this.el.removeClass(this.invalidClass);
var A=this.getMessageHandler();
if(A){A.clear(this)
}else{if(this.msgTarget){this.el.removeClass(this.invalidClass);
var B=CQ.Ext.getDom(this.msgTarget);
if(B){B.innerHTML="";
B.style.display="none"
}}}delete this.activeError;
this.fireEvent("valid",this)
},getMessageHandler:function(){return CQ.Ext.form.MessageTargets[this.msgTarget]
},getErrorCt:function(){return this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true)
},alignErrorEl:function(){this.errorEl.setWidth(this.getErrorCt().getWidth(true)-20)
},alignErrorIcon:function(){this.errorIcon.alignTo(this.el,"tl-tr",[2,0])
},getRawValue:function(){var A=this.rendered?this.el.getValue():CQ.Ext.value(this.value,"");
if(A===this.emptyText){A=""
}return A
},getValue:function(){if(!this.rendered){return this.value
}var A=this.el.getValue();
if(A===this.emptyText||A===undefined){A=""
}return A
},setRawValue:function(A){return this.rendered?(this.el.dom.value=(CQ.Ext.isEmpty(A)?"":A)):""
},setValue:function(A){this.value=A;
if(this.rendered){this.el.dom.value=(CQ.Ext.isEmpty(A)?"":A);
this.validate()
}return this
},append:function(A){this.setValue([this.getValue(),A].join(""))
}});
CQ.Ext.form.MessageTargets={qtip:{mark:function(A,B){A.el.addClass(A.invalidClass);
A.el.dom.qtip=B;
A.el.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}},clear:function(A){A.el.removeClass(A.invalidClass);
A.el.dom.qtip=""
}},title:{mark:function(A,B){A.el.addClass(A.invalidClass);
A.el.dom.title=B
},clear:function(A){A.el.dom.title=""
}},under:{mark:function(B,C){B.el.addClass(B.invalidClass);
if(!B.errorEl){var A=B.getErrorCt();
if(!A){B.el.dom.title=C;
return 
}B.errorEl=A.createChild({cls:"x-form-invalid-msg"});
B.on("resize",B.alignErrorEl,B);
B.on("destroy",function(){CQ.Ext.destroy(this.errorEl)
},B)
}B.alignErrorEl();
B.errorEl.update(C);
CQ.Ext.form.Field.msgFx[B.msgFx].show(B.errorEl,B)
},clear:function(A){A.el.removeClass(A.invalidClass);
if(A.errorEl){CQ.Ext.form.Field.msgFx[A.msgFx].hide(A.errorEl,A)
}else{A.el.dom.title=""
}}},side:{mark:function(B,C){B.el.addClass(B.invalidClass);
if(!B.errorIcon){var A=B.getErrorCt();
if(!A){B.el.dom.title=C;
return 
}B.errorIcon=A.createChild({cls:"x-form-invalid-icon"});
B.on("resize",B.alignErrorIcon,B);
B.on("destroy",function(){CQ.Ext.destroy(this.errorIcon)
},B)
}B.alignErrorIcon();
B.errorIcon.dom.qtip=C;
B.errorIcon.dom.qclass="x-form-invalid-tip";
B.errorIcon.show()
},clear:function(A){A.el.removeClass(A.invalidClass);
if(A.errorIcon){A.errorIcon.dom.qtip="";
A.errorIcon.hide()
}else{A.el.dom.title=""
}}}};
CQ.Ext.form.Field.msgFx={normal:{show:function(A,B){A.setDisplayed("block")
},hide:function(A,B){A.setDisplayed(false).update("")
}},slide:{show:function(A,B){A.slideIn("t",{stopFx:true})
},hide:function(A,B){A.slideOut("t",{stopFx:true,useDisplay:true})
}},slideRight:{show:function(A,B){A.fixDisplay();
A.alignTo(B.el,"tl-tr");
A.slideIn("l",{stopFx:true})
},hide:function(A,B){A.slideOut("l",{stopFx:true,useDisplay:true})
}}};
CQ.Ext.reg("field",CQ.Ext.form.Field);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.TextField=CQ.Ext.extend(CQ.Ext.form.Field,{grow:false,growMin:30,growMax:800,vtype:null,maskRe:null,disableKeyFilter:false,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",selectOnFocus:false,blankText:"This field is required",validator:null,regex:null,regexText:"",emptyText:null,emptyClass:"x-form-empty-field",initComponent:function(){CQ.Ext.form.TextField.superclass.initComponent.call(this);
this.addEvents("autosize","keydown","keyup","keypress")
},initEvents:function(){CQ.Ext.form.TextField.superclass.initEvents.call(this);
if(this.validationEvent=="keyup"){this.validationTask=new CQ.Ext.util.DelayedTask(this.validate,this);
this.mon(this.el,"keyup",this.filterValidation,this)
}else{if(this.validationEvent!==false&&this.validationEvent!="blur"){this.mon(this.el,this.validationEvent,this.validate,this,{buffer:this.validationDelay})
}}if(this.selectOnFocus||this.emptyText){this.mon(this.el,"mousedown",this.onMouseDown,this);
if(this.emptyText){this.applyEmptyText()
}}if(this.maskRe||(this.vtype&&this.disableKeyFilter!==true&&(this.maskRe=CQ.Ext.form.VTypes[this.vtype+"Mask"]))){this.mon(this.el,"keypress",this.filterKeys,this)
}if(this.grow){this.mon(this.el,"keyup",this.onKeyUpBuffered,this,{buffer:50});
this.mon(this.el,"click",this.autoSize,this)
}if(this.enableKeyEvents){this.mon(this.el,{scope:this,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress})
}},onMouseDown:function(A){if(!this.hasFocus){this.mon(this.el,"mouseup",CQ.Ext.emptyFn,this,{single:true,preventDefault:true})
}},processValue:function(A){if(this.stripCharsRe){var B=A.replace(this.stripCharsRe,"");
if(B!==A){this.setRawValue(B);
return B
}}return A
},filterValidation:function(A){if(!A.isNavKeyPress()){this.validationTask.delay(this.validationDelay)
}},onDisable:function(){CQ.Ext.form.TextField.superclass.onDisable.call(this);
if(CQ.Ext.isIE){this.el.dom.unselectable="on"
}},onEnable:function(){CQ.Ext.form.TextField.superclass.onEnable.call(this);
if(CQ.Ext.isIE){this.el.dom.unselectable=""
}},onKeyUpBuffered:function(A){if(this.doAutoSize(A)){this.autoSize()
}},doAutoSize:function(A){return !A.isNavKeyPress()
},onKeyUp:function(A){this.fireEvent("keyup",this,A)
},onKeyDown:function(A){this.fireEvent("keydown",this,A)
},onKeyPress:function(A){this.fireEvent("keypress",this,A)
},reset:function(){CQ.Ext.form.TextField.superclass.reset.call(this);
this.applyEmptyText()
},applyEmptyText:function(){if(this.rendered&&this.emptyText&&this.getRawValue().length<1&&!this.hasFocus){this.setRawValue(this.emptyText);
this.el.addClass(this.emptyClass)
}},preFocus:function(){var A=this.el;
if(this.emptyText){if(A.dom.value==this.emptyText){this.setRawValue("")
}A.removeClass(this.emptyClass)
}if(this.selectOnFocus){A.dom.select()
}},postBlur:function(){this.applyEmptyText()
},filterKeys:function(B){if(B.ctrlKey){return 
}var A=B.getKey();
if(CQ.Ext.isGecko&&(B.isNavKeyPress()||A==B.BACKSPACE||(A==B.DELETE&&B.button==-1))){return 
}var C=String.fromCharCode(B.getCharCode());
if(!CQ.Ext.isGecko&&B.isSpecialKey()&&!C){return 
}if(!this.maskRe.test(C)){B.stopEvent()
}},setValue:function(A){if(this.emptyText&&this.el&&!CQ.Ext.isEmpty(A)){this.el.removeClass(this.emptyClass)
}CQ.Ext.form.TextField.superclass.setValue.apply(this,arguments);
this.applyEmptyText();
this.autoSize();
return this
},validateValue:function(A){if(CQ.Ext.isFunction(this.validator)){var C=this.validator(A);
if(C!==true){this.markInvalid(C);
return false
}}if(A.length<1||A===this.emptyText){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(A.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));
return false
}if(A.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));
return false
}if(this.vtype){var B=CQ.Ext.form.VTypes;
if(!B[this.vtype](A,this)){this.markInvalid(this.vtypeText||B[this.vtype+"Text"]);
return false
}}if(this.regex&&!this.regex.test(A)){this.markInvalid(this.regexText);
return false
}return true
},selectText:function(F,A){var C=this.getRawValue();
var D=false;
if(C.length>0){F=F===undefined?0:F;
A=A===undefined?C.length:A;
var E=this.el.dom;
if(E.setSelectionRange){E.setSelectionRange(F,A)
}else{if(E.createTextRange){var B=E.createTextRange();
B.moveStart("character",F);
B.moveEnd("character",A-C.length);
B.select()
}}D=CQ.Ext.isGecko||CQ.Ext.isOpera
}else{D=true
}if(D){this.focus()
}},autoSize:function(){if(!this.grow||!this.rendered){return 
}if(!this.metrics){this.metrics=CQ.Ext.util.TextMetrics.createInstance(this.el)
}var C=this.el;
var B=C.dom.value;
var D=document.createElement("div");
D.appendChild(document.createTextNode(B));
B=D.innerHTML;
CQ.Ext.removeNode(D);
D=null;
B+="&#160;";
var A=Math.min(this.growMax,Math.max(this.metrics.getWidth(B)+10,this.growMin));
this.el.setWidth(A);
this.fireEvent("autosize",this,A)
},onDestroy:function(){if(this.validationTask){this.validationTask.cancel();
this.validationTask=null
}CQ.Ext.form.TextField.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("textfield",CQ.Ext.form.TextField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.TriggerField=CQ.Ext.extend(CQ.Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"text",size:"16",autocomplete:"off"},hideTrigger:false,editable:true,readOnly:false,wrapFocusClass:"x-trigger-wrap-focus",autoSize:CQ.Ext.emptyFn,monitorTab:true,deferHeight:true,mimicing:false,actionMode:"wrap",defaultTriggerWidth:17,onResize:function(A,C){CQ.Ext.form.TriggerField.superclass.onResize.call(this,A,C);
var B=this.getTriggerWidth();
if(CQ.Ext.isNumber(A)){this.el.setWidth(A-B)
}this.wrap.setWidth(this.el.getWidth()+B)
},getTriggerWidth:function(){var A=this.trigger.getWidth();
if(!this.hideTrigger&&A===0){A=this.defaultTriggerWidth
}return A
},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}},onRender:function(B,A){this.doc=CQ.Ext.isIE?CQ.Ext.getBody():CQ.Ext.getDoc();
CQ.Ext.form.TriggerField.superclass.onRender.call(this,B,A);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-field-trigger-wrap"});
this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});
this.initTrigger();
if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())
}this.resizeEl=this.positionEl=this.wrap
},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.dom.readOnly=true;
this.el.addClass("x-trigger-noedit");
this.mun(this.el,"click",this.onTriggerClick,this);
this.trigger.setDisplayed(false)
}else{if(!this.editable){this.el.dom.readOnly=true;
this.el.addClass("x-trigger-noedit");
this.mon(this.el,"click",this.onTriggerClick,this)
}else{this.el.dom.readOnly=false;
this.el.removeClass("x-trigger-noedit");
this.mun(this.el,"click",this.onTriggerClick,this)
}this.trigger.setDisplayed(!this.hideTrigger)
}this.onResize(this.width||this.wrap.getWidth())
}},setHideTrigger:function(A){if(A!=this.hideTrigger){this.hideTrigger=A;
this.updateEditState()
}},setEditable:function(A){if(A!=this.editable){this.editable=A;
this.updateEditState()
}},setReadOnly:function(A){if(A!=this.readOnly){this.readOnly=A;
this.updateEditState()
}},afterRender:function(){CQ.Ext.form.TriggerField.superclass.afterRender.call(this);
this.updateEditState()
},initTrigger:function(){this.mon(this.trigger,"click",this.onTriggerClick,this,{preventDefault:true});
this.trigger.addClassOnOver("x-form-trigger-over");
this.trigger.addClassOnClick("x-form-trigger-click")
},onDestroy:function(){CQ.Ext.destroy(this.trigger,this.wrap);
if(this.mimicing){this.doc.un("mousedown",this.mimicBlur,this)
}delete this.doc;
CQ.Ext.form.TriggerField.superclass.onDestroy.call(this)
},onFocus:function(){CQ.Ext.form.TriggerField.superclass.onFocus.call(this);
if(!this.mimicing){this.wrap.addClass(this.wrapFocusClass);
this.mimicing=true;
this.doc.on("mousedown",this.mimicBlur,this,{delay:10});
if(this.monitorTab){this.on("specialkey",this.checkTab,this)
}}},checkTab:function(A,B){if(B.getKey()==B.TAB){this.triggerBlur()
}},onBlur:CQ.Ext.emptyFn,mimicBlur:function(A){if(!this.isDestroyed&&!this.wrap.contains(A.target)&&this.validateBlur(A)){this.triggerBlur()
}},triggerBlur:function(){this.mimicing=false;
this.doc.un("mousedown",this.mimicBlur,this);
if(this.monitorTab&&this.el){this.un("specialkey",this.checkTab,this)
}CQ.Ext.form.TriggerField.superclass.onBlur.call(this);
if(this.wrap){this.wrap.removeClass(this.wrapFocusClass)
}},beforeBlur:CQ.Ext.emptyFn,validateBlur:function(A){return true
},onTriggerClick:CQ.Ext.emptyFn});
CQ.Ext.form.TwinTriggerField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{initComponent:function(){CQ.Ext.form.TwinTriggerField.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class}]}
},getTrigger:function(A){return this.triggers[A]
},initTrigger:function(){var A=this.trigger.select(".x-form-trigger",true);
var B=this;
A.each(function(D,F,C){var E="Trigger"+(C+1);
D.hide=function(){var G=B.wrap.getWidth();
this.dom.style.display="none";
B.el.setWidth(G-B.trigger.getWidth());
this["hidden"+E]=true
};
D.show=function(){var G=B.wrap.getWidth();
this.dom.style.display="";
B.el.setWidth(G-B.trigger.getWidth());
this["hidden"+E]=false
};
if(this["hide"+E]){D.dom.style.display="none";
this["hidden"+E]=true
}this.mon(D,"click",this["on"+E+"Click"],this,{preventDefault:true});
D.addClassOnOver("x-form-trigger-over");
D.addClassOnClick("x-form-trigger-click")
},this);
this.triggers=A.elements
},getTriggerWidth:function(){var A=0;
CQ.Ext.each(this.triggers,function(D,C){var E="Trigger"+(C+1),B=D.getWidth();
if(B===0&&!this["hidden"+E]){A+=this.defaultTriggerWidth
}else{A+=B
}},this);
return A
},onDestroy:function(){CQ.Ext.destroy(this.triggers);
CQ.Ext.form.TwinTriggerField.superclass.onDestroy.call(this)
},onTrigger1Click:CQ.Ext.emptyFn,onTrigger2Click:CQ.Ext.emptyFn});
CQ.Ext.reg("trigger",CQ.Ext.form.TriggerField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.TextArea=CQ.Ext.extend(CQ.Ext.form.TextField,{growMin:60,growMax:1000,growAppend:"&#160;\n&#160;",enterIsSpecial:false,preventScrollbars:false,onRender:function(B,A){if(!this.el){this.defaultAutoCreate={tag:"textarea",style:"width:100px;height:60px;",autocomplete:"off"}
}CQ.Ext.form.TextArea.superclass.onRender.call(this,B,A);
if(this.grow){this.textSizeEl=CQ.Ext.DomHelper.append(document.body,{tag:"pre",cls:"x-form-grow-sizer"});
if(this.preventScrollbars){this.el.setStyle("overflow","hidden")
}this.el.setHeight(this.growMin)
}},onDestroy:function(){CQ.Ext.removeNode(this.textSizeEl);
CQ.Ext.form.TextArea.superclass.onDestroy.call(this)
},fireKey:function(A){if(A.isSpecialKey()&&(this.enterIsSpecial||(A.getKey()!=A.ENTER||A.hasModifier()))){this.fireEvent("specialkey",this,A)
}},doAutoSize:function(A){return !A.isNavKeyPress()||A.getKey()==A.ENTER
},autoSize:function(){if(!this.grow||!this.textSizeEl){return 
}var C=this.el,A=CQ.Ext.util.Format.htmlEncode(C.dom.value),D=this.textSizeEl,B;
CQ.Ext.fly(D).setWidth(this.el.getWidth());
if(A.length<1){A="&#160;&#160;"
}else{A+=this.growAppend;
if(CQ.Ext.isIE){A=A.replace(/\n/g,"&#160;<br />")
}}D.innerHTML=A;
B=Math.min(this.growMax,Math.max(D.offsetHeight,this.growMin));
if(B!=this.lastHeight){this.lastHeight=B;
this.el.setHeight(B);
this.fireEvent("autosize",this,B)
}}});
CQ.Ext.reg("textarea",CQ.Ext.form.TextArea);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.NumberField=CQ.Ext.extend(CQ.Ext.form.TextField,{fieldClass:"x-form-field x-form-num-field",allowDecimals:true,decimalSeparator:".",decimalPrecision:2,allowNegative:true,minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,minText:"The minimum value for this field is {0}",maxText:"The maximum value for this field is {0}",nanText:"{0} is not a valid number",baseChars:"0123456789",initEvents:function(){var A=this.baseChars+"";
if(this.allowDecimals){A+=this.decimalSeparator
}if(this.allowNegative){A+="-"
}this.maskRe=new RegExp("["+CQ.Ext.escapeRe(A)+"]");
CQ.Ext.form.NumberField.superclass.initEvents.call(this)
},validateValue:function(B){if(!CQ.Ext.form.NumberField.superclass.validateValue.call(this,B)){return false
}if(B.length<1){return true
}B=String(B).replace(this.decimalSeparator,".");
if(isNaN(B)){this.markInvalid(String.format(this.nanText,B));
return false
}var A=this.parseValue(B);
if(A<this.minValue){this.markInvalid(String.format(this.minText,this.minValue));
return false
}if(A>this.maxValue){this.markInvalid(String.format(this.maxText,this.maxValue));
return false
}return true
},getValue:function(){return this.fixPrecision(this.parseValue(CQ.Ext.form.NumberField.superclass.getValue.call(this)))
},setValue:function(A){A=CQ.Ext.isNumber(A)?A:parseFloat(String(A).replace(this.decimalSeparator,"."));
A=isNaN(A)?"":String(A).replace(".",this.decimalSeparator);
return CQ.Ext.form.NumberField.superclass.setValue.call(this,A)
},setMinValue:function(A){this.minValue=CQ.Ext.num(A,Number.NEGATIVE_INFINITY)
},setMaxValue:function(A){this.maxValue=CQ.Ext.num(A,Number.MAX_VALUE)
},parseValue:function(A){A=parseFloat(String(A).replace(this.decimalSeparator,"."));
return isNaN(A)?"":A
},fixPrecision:function(B){var A=isNaN(B);
if(!this.allowDecimals||this.decimalPrecision==-1||A||!B){return A?"":B
}return parseFloat(parseFloat(B).toFixed(this.decimalPrecision))
},beforeBlur:function(){var A=this.parseValue(this.getRawValue());
if(!CQ.Ext.isEmpty(A)){this.setValue(this.fixPrecision(A))
}}});
CQ.Ext.reg("numberfield",CQ.Ext.form.NumberField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.DateField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{format:"m/d/Y",altFormats:"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:"x-form-date-trigger",showToday:true,defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initComponent:function(){CQ.Ext.form.DateField.superclass.initComponent.call(this);
this.addEvents("select");
if(CQ.Ext.isString(this.minValue)){this.minValue=this.parseDate(this.minValue)
}if(CQ.Ext.isString(this.maxValue)){this.maxValue=this.parseDate(this.maxValue)
}this.disabledDatesRE=null;
this.initDisabledDays()
},initEvents:function(){CQ.Ext.form.DateField.superclass.initEvents.call(this);
this.keyNav=new CQ.Ext.KeyNav(this.el,{down:function(A){this.onTriggerClick()
},scope:this,forceKeyDown:true})
},initDisabledDays:function(){if(this.disabledDates){var B=this.disabledDates,A=B.length-1,C="(?:";
CQ.Ext.each(B,function(E,D){C+=CQ.Ext.isDate(E)?"^"+CQ.Ext.escapeRe(E.dateFormat(this.format))+"$":B[D];
if(D!=A){C+="|"
}},this);
this.disabledDatesRE=new RegExp(C+")")
}},setDisabledDates:function(A){this.disabledDates=A;
this.initDisabledDays();
if(this.menu){this.menu.picker.setDisabledDates(this.disabledDatesRE)
}},setDisabledDays:function(A){this.disabledDays=A;
if(this.menu){this.menu.picker.setDisabledDays(A)
}},setMinValue:function(A){this.minValue=(CQ.Ext.isString(A)?this.parseDate(A):A);
if(this.menu){this.menu.picker.setMinDate(this.minValue)
}},setMaxValue:function(A){this.maxValue=(CQ.Ext.isString(A)?this.parseDate(A):A);
if(this.menu){this.menu.picker.setMaxDate(this.maxValue)
}},validateValue:function(E){E=this.formatDate(E);
if(!CQ.Ext.form.DateField.superclass.validateValue.call(this,E)){return false
}if(E.length<1){return true
}var C=E;
E=this.parseDate(E);
if(!E){this.markInvalid(String.format(this.invalidText,C,this.format));
return false
}var F=E.getTime();
if(this.minValue&&F<this.minValue.getTime()){this.markInvalid(String.format(this.minText,this.formatDate(this.minValue)));
return false
}if(this.maxValue&&F>this.maxValue.getTime()){this.markInvalid(String.format(this.maxText,this.formatDate(this.maxValue)));
return false
}if(this.disabledDays){var A=E.getDay();
for(var B=0;
B<this.disabledDays.length;
B++){if(A===this.disabledDays[B]){this.markInvalid(this.disabledDaysText);
return false
}}}var D=this.formatDate(E);
if(this.disabledDatesRE&&this.disabledDatesRE.test(D)){this.markInvalid(String.format(this.disabledDatesText,D));
return false
}return true
},validateBlur:function(){return !this.menu||!this.menu.isVisible()
},getValue:function(){return this.parseDate(CQ.Ext.form.DateField.superclass.getValue.call(this))||""
},setValue:function(A){return CQ.Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(A)))
},parseDate:function(D){if(!D||CQ.Ext.isDate(D)){return D
}var B=Date.parseDate(D,this.format);
if(!B&&this.altFormats){if(!this.altFormatsArray){this.altFormatsArray=this.altFormats.split("|")
}for(var C=0,A=this.altFormatsArray.length;
C<A&&!B;
C++){B=Date.parseDate(D,this.altFormatsArray[C])
}}return B
},onDestroy:function(){CQ.Ext.destroy(this.menu,this.keyNav);
CQ.Ext.form.DateField.superclass.onDestroy.call(this)
},formatDate:function(A){return CQ.Ext.isDate(A)?A.dateFormat(this.format):A
},onTriggerClick:function(){if(this.disabled){return 
}if(this.menu==null){this.menu=new CQ.Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})
}this.onFocus();
CQ.Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});
this.menu.picker.setValue(this.getValue()||new Date());
this.menu.show(this.el,"tl-bl?");
this.menuEvents("on")
},menuEvents:function(A){this.menu[A]("select",this.onSelect,this);
this.menu[A]("hide",this.onMenuHide,this);
this.menu[A]("show",this.onFocus,this)
},onSelect:function(A,B){this.setValue(B);
this.fireEvent("select",this,B);
this.menu.hide()
},onMenuHide:function(){this.focus(false,60);
this.menuEvents("un")
},beforeBlur:function(){var A=this.parseDate(this.getRawValue());
if(A){this.setValue(A)
}}});
CQ.Ext.reg("datefield",CQ.Ext.form.DateField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.DisplayField=CQ.Ext.extend(CQ.Ext.form.Field,{validationEvent:false,validateOnBlur:false,defaultAutoCreate:{tag:"div"},fieldClass:"x-form-display-field",htmlEncode:false,initEvents:CQ.Ext.emptyFn,isValid:function(){return true
},validate:function(){return true
},getRawValue:function(){var A=this.rendered?this.el.dom.innerHTML:CQ.Ext.value(this.value,"");
if(A===this.emptyText){A=""
}if(this.htmlEncode){A=CQ.Ext.util.Format.htmlDecode(A)
}return A
},getValue:function(){return this.getRawValue()
},getName:function(){return this.name
},setRawValue:function(A){if(this.htmlEncode){A=CQ.Ext.util.Format.htmlEncode(A)
}return this.rendered?(this.el.dom.innerHTML=(CQ.Ext.isEmpty(A)?"":A)):(this.value=A)
},setValue:function(A){this.setRawValue(A);
return this
}});
CQ.Ext.reg("displayfield",CQ.Ext.form.DisplayField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.ComboBox=CQ.Ext.extend(CQ.Ext.form.TriggerField,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:"",selectedClass:"x-combo-selected",listEmptyText:"",triggerClass:"x-form-arrow-trigger",shadow:"sides",listAlign:"tl-bl?",maxHeight:300,minHeight:90,triggerAction:"query",minChars:4,autoSelect:true,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:"query",loadingText:"Loading...",resizable:false,handleHeight:8,allQuery:"",mode:"remote",minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,clearFilterOnReset:true,submitValue:undefined,initComponent:function(){CQ.Ext.form.ComboBox.superclass.initComponent.call(this);
this.addEvents("expand","collapse","beforeselect","select","beforequery");
if(this.transform){var C=CQ.Ext.getDom(this.transform);
if(!this.hiddenName){this.hiddenName=C.name
}if(!this.store){this.mode="local";
var G=[],D=C.options;
for(var B=0,A=D.length;
B<A;
B++){var F=D[B],E=(F.hasAttribute?F.hasAttribute("value"):F.getAttributeNode("value").specified)?F.value:F.text;
if(F.selected&&CQ.Ext.isEmpty(this.value,true)){this.value=E
}G.push([E,F.text])
}this.store=new CQ.Ext.data.ArrayStore({id:0,fields:["value","text"],data:G,autoDestroy:true});
this.valueField="value";
this.displayField="text"
}C.name=CQ.Ext.id();
if(!this.lazyRender){this.target=true;
this.el=CQ.Ext.DomHelper.insertBefore(C,this.autoCreate||this.defaultAutoCreate);
this.render(this.el.parentNode,C)
}CQ.Ext.removeNode(C)
}else{if(this.store){this.store=CQ.Ext.StoreMgr.lookup(this.store);
if(this.store.autoCreated){this.displayField=this.valueField="field1";
if(!this.store.expandData){this.displayField="field2"
}this.mode="local"
}}}this.selectedIndex=-1;
if(this.mode=="local"){if(!CQ.Ext.isDefined(this.initialConfig.queryDelay)){this.queryDelay=10
}if(!CQ.Ext.isDefined(this.initialConfig.minChars)){this.minChars=0
}}},onRender:function(B,A){if(this.hiddenName&&!CQ.Ext.isDefined(this.submitValue)){this.submitValue=false
}CQ.Ext.form.ComboBox.superclass.onRender.call(this,B,A);
if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true)
}if(CQ.Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")
}if(!this.lazyInit){this.initList()
}else{this.on("focus",this.initList,this,{single:true})
}},initValue:function(){CQ.Ext.form.ComboBox.superclass.initValue.call(this);
if(this.hiddenField){this.hiddenField.value=CQ.Ext.value(CQ.Ext.isDefined(this.hiddenValue)?this.hiddenValue:this.value,"")
}},initList:function(){if(!this.list){var A="x-combo-list",D=CQ.Ext.getDom(this.getListParent()||CQ.Ext.getBody()),B=parseInt(CQ.Ext.fly(D).getStyle("z-index"),10);
if(this.ownerCt&&!B){this.findParentBy(function(E){B=parseInt(E.getPositionEl().getStyle("z-index"),10);
return !!B
})
}this.list=new CQ.Ext.Layer({parentEl:D,shadow:this.shadow,cls:[A,this.listClass].join(" "),constrain:false,zindex:(B||12000)+5});
var C=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);
this.list.setSize(C,0);
this.list.swallowEvent("mousewheel");
this.assetHeight=0;
if(this.syncFont!==false){this.list.setStyle("font-size",this.el.getStyle("font-size"))
}if(this.title){this.header=this.list.createChild({cls:A+"-hd",html:this.title});
this.assetHeight+=this.header.getHeight()
}this.innerList=this.list.createChild({cls:A+"-inner"});
this.mon(this.innerList,"mouseover",this.onViewOver,this);
this.mon(this.innerList,"mousemove",this.onViewMove,this);
this.innerList.setWidth(C-this.list.getFrameWidth("lr"));
if(this.pageSize){this.footer=this.list.createChild({cls:A+"-ft"});
this.pageTb=new CQ.Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});
this.assetHeight+=this.footer.getHeight()
}if(!this.tpl){this.tpl='<tpl for="."><div class="'+A+'-item">{'+this.displayField+"}</div></tpl>"
}this.view=new CQ.Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+A+"-item",emptyText:this.listEmptyText,deferEmptyText:false});
this.mon(this.view,{containerclick:this.onViewClick,click:this.onViewClick,scope:this});
this.bindStore(this.store,true);
if(this.resizable){this.resizer=new CQ.Ext.Resizable(this.list,{pinned:true,handles:"se"});
this.mon(this.resizer,"resize",function(G,E,F){this.maxHeight=F-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;
this.listWidth=E;
this.innerList.setWidth(E-this.list.getFrameWidth("lr"));
this.restrictHeight()
},this);
this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")
}}},getListParent:function(){return CQ.Util.getRoot()
},getStore:function(){return this.store
},bindStore:function(A,B){if(this.store&&!B){if(this.store!==A&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.collapse,this)
}if(!A){this.store=null;
if(this.view){this.view.bindStore(null)
}if(this.pageTb){this.pageTb.bindStore(null)
}}}if(A){if(!B){this.lastQuery=null;
if(this.pageTb){this.pageTb.bindStore(A)
}}this.store=CQ.Ext.StoreMgr.lookup(A);
this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.collapse});
if(this.view){this.view.bindStore(A)
}}},reset:function(){CQ.Ext.form.ComboBox.superclass.reset.call(this);
if(this.clearFilterOnReset&&this.mode=="local"){this.store.clearFilter()
}},initEvents:function(){CQ.Ext.form.ComboBox.superclass.initEvents.call(this);
this.keyNav=new CQ.Ext.KeyNav(this.el,{up:function(A){this.inKeyMode=true;
this.selectPrev()
},down:function(A){if(!this.isExpanded()){this.onTriggerClick()
}else{this.inKeyMode=true;
this.selectNext()
}},enter:function(A){this.onViewClick()
},esc:function(A){this.collapse()
},tab:function(A){this.collapse();
return true
},scope:this,doRelay:function(C,B,A){if(A=="down"||this.scope.isExpanded()){var D=CQ.Ext.KeyNav.prototype.doRelay.apply(this,arguments);
if(!CQ.Ext.isIE&&CQ.Ext.EventManager.useKeydown){this.scope.fireKey(C)
}return D
}return true
},forceKeyDown:true,defaultEventAction:"stopEvent"});
this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);
this.dqTask=new CQ.Ext.util.DelayedTask(this.initQuery,this);
if(this.typeAhead){this.taTask=new CQ.Ext.util.DelayedTask(this.onTypeAhead,this)
}if(!this.enableKeyEvents){this.mon(this.el,"keyup",this.onKeyUp,this)
}},onDestroy:function(){if(this.dqTask){this.dqTask.cancel();
this.dqTask=null
}this.bindStore(null);
CQ.Ext.destroy(this.resizer,this.view,this.pageTb,this.list);
CQ.Ext.destroyMembers(this,"hiddenField");
CQ.Ext.form.ComboBox.superclass.onDestroy.call(this)
},fireKey:function(A){if(!this.isExpanded()){CQ.Ext.form.ComboBox.superclass.fireKey.call(this,A)
}},onResize:function(A,B){CQ.Ext.form.ComboBox.superclass.onResize.apply(this,arguments);
if(this.isVisible()&&this.list){this.doResize(A)
}else{this.bufferSize=A
}},doResize:function(A){if(!CQ.Ext.isDefined(this.listWidth)){var B=Math.max(A,this.minListWidth);
this.list.setWidth(B);
this.innerList.setWidth(B-this.list.getFrameWidth("lr"))
}},onEnable:function(){CQ.Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);
if(this.hiddenField){this.hiddenField.disabled=false
}},onDisable:function(){CQ.Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);
if(this.hiddenField){this.hiddenField.disabled=true
}},onBeforeLoad:function(){if(!this.hasFocus){return 
}this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+"</div>":"");
this.restrictHeight();
this.selectedIndex=-1
},onLoad:function(){if(!this.hasFocus){return 
}if(this.store.getCount()>0||this.listEmptyText){this.expand();
this.restrictHeight();
if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()
}if(this.autoSelect!==false&&!this.selectByValue(this.value,true)){this.select(0,true)
}}else{if(this.autoSelect!==false){this.selectNext()
}if(this.typeAhead&&this.lastKey!=CQ.Ext.EventObject.BACKSPACE&&this.lastKey!=CQ.Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)
}}}else{this.collapse()
}},onTypeAhead:function(){if(this.store.getCount()>0){var B=this.store.getAt(0);
var C=B.data[this.displayField];
var A=C.length;
var D=this.getRawValue().length;
if(D!=A){this.setRawValue(C);
this.selectText(D,C.length)
}}},assertValue:function(){var B=this.getRawValue(),A=this.findRecord(this.displayField,B);
if(!A&&this.forceSelection){if(B.length>0&&B!=this.emptyText){this.el.dom.value=CQ.Ext.value(this.lastSelectionText,"");
this.applyEmptyText()
}else{this.clearValue()
}}else{if(A){B=A.get(this.valueField||this.displayField)
}this.setValue(B)
}},onSelect:function(A,B){if(this.fireEvent("beforeselect",this,A,B)!==false){this.setValue(A.data[this.valueField||this.displayField]);
this.collapse();
this.fireEvent("select",this,A,B)
}},getName:function(){var A=this.hiddenField;
return A&&A.name?A.name:this.hiddenName||CQ.Ext.form.ComboBox.superclass.getName.call(this)
},getValue:function(){if(this.valueField){return CQ.Ext.isDefined(this.value)?this.value:""
}else{return CQ.Ext.form.ComboBox.superclass.getValue.call(this)
}},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""
}this.setRawValue("");
this.lastSelectionText="";
this.applyEmptyText();
this.value=""
},setValue:function(A){var C=A;
if(this.valueField){var B=this.findRecord(this.valueField,A);
if(B){C=B.data[this.displayField]
}else{if(CQ.Ext.isDefined(this.valueNotFoundText)){C=this.valueNotFoundText
}}}this.lastSelectionText=C;
if(this.hiddenField){this.hiddenField.value=CQ.Ext.value(A,"")
}CQ.Ext.form.ComboBox.superclass.setValue.call(this,C);
this.value=A;
return this
},findRecord:function(C,B){var A;
if(this.store.getCount()>0){this.store.each(function(D){if(D.data[C]==B){A=D;
return false
}})
}return A
},onViewMove:function(B,A){this.inKeyMode=false
},onViewOver:function(D,B){if(this.inKeyMode){return 
}var C=this.view.findItemFromChild(B);
if(C){var A=this.view.indexOf(C);
this.select(A,false)
}},onViewClick:function(B){var A=this.view.getSelectedIndexes()[0],C=this.store,D=C.getAt(A);
if(D){this.onSelect(D,A)
}else{this.collapse()
}if(B!==false){this.el.focus()
}},restrictHeight:function(){this.innerList.dom.style.height="";
var B=this.innerList.dom,E=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,C=Math.max(B.clientHeight,B.offsetHeight,B.scrollHeight),A=this.getPosition()[1]-CQ.Ext.getBody().getScroll().top,F=CQ.Ext.lib.Dom.getViewHeight()-A-this.getSize().height,D=Math.max(A,F,this.minHeight||0)-this.list.shadowOffset-E-5;
C=Math.min(C,D,this.maxHeight);
this.innerList.setHeight(C);
this.list.beginUpdate();
this.list.setHeight(C+E);
this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.endUpdate()
},isExpanded:function(){return this.list&&this.list.isVisible()
},selectByValue:function(A,C){if(!CQ.Ext.isEmpty(A,true)){var B=this.findRecord(this.valueField||this.displayField,A);
if(B){this.select(this.store.indexOf(B),C);
return true
}}return false
},select:function(A,C){this.selectedIndex=A;
this.view.select(A);
if(C!==false){var B=this.view.getNode(A);
if(B){this.innerList.scrollChildIntoView(B,false)
}}},selectNext:function(){var A=this.store.getCount();
if(A>0){if(this.selectedIndex==-1){this.select(0)
}else{if(this.selectedIndex<A-1){this.select(this.selectedIndex+1)
}}}},selectPrev:function(){var A=this.store.getCount();
if(A>0){if(this.selectedIndex==-1){this.select(0)
}else{if(this.selectedIndex!==0){this.select(this.selectedIndex-1)
}}}},onKeyUp:function(B){var A=B.getKey();
if(this.editable!==false&&this.readOnly!==true&&(A==B.BACKSPACE||!B.isSpecialKey())){this.lastKey=A;
this.dqTask.delay(this.queryDelay)
}CQ.Ext.form.ComboBox.superclass.onKeyUp.call(this,B)
},validateBlur:function(){return !this.list||!this.list.isVisible()
},initQuery:function(){this.doQuery(this.getRawValue())
},beforeBlur:function(){this.assertValue()
},postBlur:function(){CQ.Ext.form.ComboBox.superclass.postBlur.call(this);
this.collapse();
this.inKeyMode=false
},doQuery:function(C,B){C=CQ.Ext.isEmpty(C)?"":C;
var A={query:C,forceAll:B,combo:this,cancel:false};
if(this.fireEvent("beforequery",A)===false||A.cancel){return false
}C=A.query;
B=A.forceAll;
if(B===true||(C.length>=this.minChars)){if(this.lastQuery!==C){this.lastQuery=C;
if(this.mode=="local"){this.selectedIndex=-1;
if(B){this.store.clearFilter()
}else{this.store.filter(this.displayField,C)
}this.onLoad()
}else{this.store.baseParams[this.queryParam]=C;
this.store.load({params:this.getParams(C)});
this.expand()
}}else{this.selectedIndex=-1;
this.onLoad()
}}},getParams:function(A){var B={};
if(this.pageSize){B.start=0;
B.limit=this.pageSize
}return B
},collapse:function(){if(!this.isExpanded()){return 
}this.list.hide();
CQ.Ext.getDoc().un("mousewheel",this.collapseIf,this);
CQ.Ext.getDoc().un("mousedown",this.collapseIf,this);
this.fireEvent("collapse",this)
},collapseIf:function(A){if(!A.within(this.wrap)&&!A.within(this.list)){this.collapse()
}},expand:function(){if(this.isExpanded()||!this.hasFocus){return 
}if(this.bufferSize){this.doResize(this.bufferSize);
delete this.bufferSize
}this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.show();
if(CQ.Ext.isGecko2){this.innerList.setOverflow("auto")
}this.mon(CQ.Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});
this.fireEvent("expand",this)
},onTriggerClick:function(){if(this.readOnly||this.disabled){return 
}if(this.isExpanded()){this.collapse();
this.el.focus()
}else{this.onFocus({});
if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)
}else{this.doQuery(this.getRawValue())
}this.el.focus()
}}});
CQ.Ext.reg("combo",CQ.Ext.form.ComboBox);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Checkbox=CQ.Ext.extend(CQ.Ext.form.Field,{focusClass:undefined,fieldClass:"x-form-field",checked:false,defaultAutoCreate:{tag:"input",type:"checkbox",autocomplete:"off"},actionMode:"wrap",initComponent:function(){CQ.Ext.form.Checkbox.superclass.initComponent.call(this);
this.addEvents("check")
},onResize:function(){CQ.Ext.form.Checkbox.superclass.onResize.apply(this,arguments);
if(!this.boxLabel&&!this.fieldLabel){this.el.alignTo(this.wrap,"c-c")
}},initEvents:function(){CQ.Ext.form.Checkbox.superclass.initEvents.call(this);
this.mon(this.el,{scope:this,click:this.onClick,change:this.onClick})
},markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,onRender:function(B,A){CQ.Ext.form.Checkbox.superclass.onRender.call(this,B,A);
if(this.inputValue!==undefined){this.el.dom.value=this.inputValue
}this.wrap=this.el.wrap({cls:"x-form-check-wrap"});
if(this.boxLabel){this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})
}if(this.checked){this.setValue(true)
}else{this.checked=this.el.dom.checked
}if(CQ.Ext.isIE){this.wrap.repaint()
}this.resizeEl=this.positionEl=this.wrap
},onDestroy:function(){CQ.Ext.destroy(this.wrap);
CQ.Ext.form.Checkbox.superclass.onDestroy.call(this)
},initValue:function(){this.originalValue=this.getValue()
},getValue:function(){if(this.rendered){return this.el.dom.checked
}return this.checked
},onClick:function(){if(this.el.dom.checked!=this.checked){this.setValue(this.el.dom.checked)
}},setValue:function(A){var B=this.checked;
this.checked=(A===true||A==="true"||A=="1"||String(A).toLowerCase()=="on");
if(this.rendered){this.el.dom.checked=this.checked;
this.el.dom.defaultChecked=this.checked
}if(B!=this.checked){this.fireEvent("check",this,this.checked);
if(this.handler){this.handler.call(this.scope||this,this,this.checked)
}}return this
}});
CQ.Ext.reg("checkbox",CQ.Ext.form.Checkbox);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.CheckboxGroup=CQ.Ext.extend(CQ.Ext.form.Field,{columns:"auto",vertical:false,allowBlank:true,blankText:"You must select at least one item in this group",defaultType:"checkbox",groupCls:"x-form-check-group",initComponent:function(){this.addEvents("change");
this.on("change",this.validate,this);
CQ.Ext.form.CheckboxGroup.superclass.initComponent.call(this)
},onRender:function(H,F){if(!this.el){var M={autoEl:{id:this.id},cls:this.groupCls,layout:"column",renderTo:H,bufferResize:false};
var A={xtype:"container",defaultType:this.defaultType,layout:"form",defaults:{hideLabel:true,anchor:"100%"}};
if(this.items[0].items){CQ.Ext.apply(M,{layoutConfig:{columns:this.items.length},defaults:this.defaults,items:this.items});
for(var E=0,J=this.items.length;
E<J;
E++){CQ.Ext.applyIf(this.items[E],A)
}}else{var D,K=[];
if(typeof this.columns=="string"){this.columns=this.items.length
}if(!CQ.Ext.isArray(this.columns)){var I=[];
for(var E=0;
E<this.columns;
E++){I.push((100/this.columns)*0.01)
}this.columns=I
}D=this.columns.length;
for(var E=0;
E<D;
E++){var B=CQ.Ext.apply({items:[]},A);
B[this.columns[E]<=1?"columnWidth":"width"]=this.columns[E];
if(this.defaults){B.defaults=CQ.Ext.apply(B.defaults||{},this.defaults)
}K.push(B)
}if(this.vertical){var O=Math.ceil(this.items.length/D),L=0;
for(var E=0,J=this.items.length;
E<J;
E++){if(E>0&&E%O==0){L++
}if(this.items[E].fieldLabel){this.items[E].hideLabel=false
}K[L].items.push(this.items[E])
}}else{for(var E=0,J=this.items.length;
E<J;
E++){var N=E%D;
if(this.items[E].fieldLabel){this.items[E].hideLabel=false
}K[N].items.push(this.items[E])
}}CQ.Ext.apply(M,{layoutConfig:{columns:D},items:K})
}this.panel=new CQ.Ext.Container(M);
this.panel.ownerCt=this;
this.el=this.panel.getEl();
if(this.forId&&this.itemCls){var C=this.el.up(this.itemCls).child("label",true);
if(C){C.setAttribute("htmlFor",this.forId)
}}var G=this.panel.findBy(function(P){return P.isFormField
},this);
this.items=new CQ.Ext.util.MixedCollection();
this.items.addAll(G)
}CQ.Ext.form.CheckboxGroup.superclass.onRender.call(this,H,F)
},initValue:function(){if(this.value){this.setValue.apply(this,this.buffered?this.value:[this.value]);
delete this.buffered;
delete this.value
}},afterRender:function(){CQ.Ext.form.CheckboxGroup.superclass.afterRender.call(this);
this.eachItem(function(A){A.on("check",this.fireChecked,this);
A.inGroup=true
})
},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;
this.panel.doLayout()
}},fireChecked:function(){var A=[];
this.eachItem(function(B){if(B.checked){A.push(B)
}});
this.fireEvent("change",this,A)
},validateValue:function(A){if(!this.allowBlank){var B=true;
this.eachItem(function(C){if(C.checked){return(B=false)
}});
if(B){this.markInvalid(this.blankText);
return false
}}return true
},isDirty:function(){if(this.disabled||!this.rendered){return false
}var A=false;
this.eachItem(function(B){if(B.isDirty()){A=true;
return false
}});
return A
},onDisable:function(){this.eachItem(function(A){A.disable()
})
},onEnable:function(){this.eachItem(function(A){A.enable()
})
},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;
this.panel.doLayout()
}},onResize:function(A,B){this.panel.setSize(A,B);
this.panel.doLayout()
},reset:function(){this.eachItem(function(A){if(A.reset){A.reset()
}});
(function(){this.clearInvalid()
}).defer(50,this)
},setValue:function(){if(this.rendered){this.onSetValue.apply(this,arguments)
}else{this.buffered=true;
this.value=arguments
}return this
},onSetValue:function(D,C){if(arguments.length==1){if(CQ.Ext.isArray(D)){CQ.Ext.each(D,function(G,E){var F=this.items.itemAt(E);
if(F){F.setValue(G)
}},this)
}else{if(CQ.Ext.isObject(D)){for(var A in D){var B=this.getBox(A);
if(B){B.setValue(D[A])
}}}else{this.setValueForItem(D)
}}}else{var B=this.getBox(D);
if(B){B.setValue(C)
}}},beforeDestroy:function(){CQ.Ext.destroy(this.panel);
CQ.Ext.form.CheckboxGroup.superclass.beforeDestroy.call(this)
},setValueForItem:function(A){A=String(A).split(",");
this.eachItem(function(B){if(A.indexOf(B.inputValue)>-1){B.setValue(true)
}})
},getBox:function(B){var A=null;
this.eachItem(function(C){if(B==C||C.dataIndex==B||C.id==B||C.getName()==B){A=C;
return false
}});
return A
},getValue:function(){var A=[];
this.eachItem(function(B){if(B.checked){A.push(B)
}});
return A
},eachItem:function(A){if(this.items&&this.items.each){this.items.each(A,this)
}},getRawValue:CQ.Ext.emptyFn,setRawValue:CQ.Ext.emptyFn});
CQ.Ext.reg("checkboxgroup",CQ.Ext.form.CheckboxGroup);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Radio=CQ.Ext.extend(CQ.Ext.form.Checkbox,{inputType:"radio",markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,getGroupValue:function(){var A=this.el.up("form")||CQ.Ext.getBody();
var B=A.child("input[name="+this.el.dom.name+"]:checked",true);
return B?B.value:null
},onClick:function(){if(this.el.dom.checked!=this.checked){var A=this.getCheckEl().select("input[name="+this.el.dom.name+"]");
A.each(function(B){if(B.dom.id==this.id){this.setValue(true)
}else{CQ.Ext.getCmp(B.dom.id).setValue(false)
}},this)
}},setValue:function(A){if(typeof A=="boolean"){CQ.Ext.form.Radio.superclass.setValue.call(this,A)
}else{if(this.rendered){var B=this.getCheckEl().child("input[name="+this.el.dom.name+"][value="+A+"]",true);
if(B){CQ.Ext.getCmp(B.id).setValue(true)
}}}return this
},getCheckEl:function(){if(this.inGroup){return this.el.up(".x-form-radio-group")
}return this.el.up("form")||CQ.Ext.getBody()
}});
CQ.Ext.reg("radio",CQ.Ext.form.Radio);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.RadioGroup=CQ.Ext.extend(CQ.Ext.form.CheckboxGroup,{allowBlank:true,blankText:"You must select one item in this group",defaultType:"radio",groupCls:"x-form-radio-group",getValue:function(){var A=null;
this.eachItem(function(B){if(B.checked){A=B;
return false
}});
return A
},onSetValue:function(C,B){if(arguments.length>1){var A=this.getBox(C);
if(A){A.setValue(B);
if(A.checked){this.eachItem(function(D){if(D!==A){D.setValue(false)
}})
}}}else{this.setValueForItem(C)
}},setValueForItem:function(A){A=String(A).split(",")[0];
this.eachItem(function(B){B.setValue(A==B.inputValue)
})
},fireChecked:function(){if(!this.checkTask){this.checkTask=new CQ.Ext.util.DelayedTask(this.bufferChecked,this)
}this.checkTask.delay(10)
},bufferChecked:function(){var A=null;
this.eachItem(function(B){if(B.checked){A=B;
return false
}});
this.fireEvent("change",this,A)
},onDestroy:function(){if(this.checkTask){this.checkTask.cancel();
this.checkTask=null
}CQ.Ext.form.RadioGroup.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("radiogroup",CQ.Ext.form.RadioGroup);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Hidden=CQ.Ext.extend(CQ.Ext.form.Field,{inputType:"hidden",onRender:function(){CQ.Ext.form.Hidden.superclass.onRender.apply(this,arguments)
},initEvents:function(){this.originalValue=this.getValue()
},setSize:CQ.Ext.emptyFn,setWidth:CQ.Ext.emptyFn,setHeight:CQ.Ext.emptyFn,setPosition:CQ.Ext.emptyFn,setPagePosition:CQ.Ext.emptyFn,markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn});
CQ.Ext.reg("hidden",CQ.Ext.form.Hidden);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.BasicForm=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(B,A){CQ.Ext.apply(this,A);
if(CQ.Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}this.items=new CQ.Ext.util.MixedCollection(false,function(C){return C.getItemId()
});
this.addEvents("beforeaction","actionfailed","actioncomplete");
if(B){this.initEl(B)
}CQ.Ext.form.BasicForm.superclass.constructor.call(this)
},timeout:30,paramOrder:undefined,paramsAsHash:false,waitTitle:"Please Wait...",activeAction:null,trackResetOnLoad:false,initEl:function(A){this.el=CQ.Ext.get(A);
this.id=this.el.id||CQ.Ext.id();
if(!this.standardSubmit){this.el.on("submit",this.onSubmit,this)
}this.el.addClass("x-form")
},getEl:function(){return this.el
},onSubmit:function(A){A.stopEvent()
},destroy:function(){this.items.each(function(A){CQ.Ext.destroy(A)
});
if(this.el){this.el.removeAllListeners();
this.el.remove()
}this.purgeListeners()
},isValid:function(){var A=true;
this.items.each(function(B){if(!B.validate()){A=false
}});
return A
},isDirty:function(){var A=false;
this.items.each(function(B){if(B.isDirty()){A=true;
return false
}});
return A
},doAction:function(B,A){if(CQ.Ext.isString(B)){B=new CQ.Ext.form.Action.ACTION_TYPES[B](this,A)
}if(this.fireEvent("beforeaction",this,B)!==false){this.beforeAction(B);
B.run.defer(100,B)
}return this
},submit:function(B){if(this.standardSubmit){var A=this.isValid();
if(A){var C=this.el.dom;
if(this.url&&CQ.Ext.isEmpty(C.action)){C.action=this.url
}C.submit()
}return A
}var D=String.format("{0}submit",this.api?"direct":"");
this.doAction(D,B);
return this
},load:function(A){var B=String.format("{0}load",this.api?"direct":"");
this.doAction(B,A);
return this
},updateRecord:function(B){B.beginEdit();
var A=B.fields;
A.each(function(C){var D=this.findField(C.name);
if(D){B.set(C.name,D.getValue())
}},this);
B.endEdit();
return this
},loadRecord:function(A){this.setValues(A.data);
return this
},beforeAction:function(A){var B=A.options;
if(B.waitMsg){if(this.waitMsgTarget===true){this.el.mask(B.waitMsg,"x-mask-loading")
}else{if(this.waitMsgTarget){this.waitMsgTarget=CQ.Ext.get(this.waitMsgTarget);
this.waitMsgTarget.mask(B.waitMsg,"x-mask-loading")
}else{CQ.Ext.MessageBox.wait(B.waitMsg,B.waitTitle||this.waitTitle)
}}}},afterAction:function(A,C){this.activeAction=null;
var B=A.options;
if(B.waitMsg){if(this.waitMsgTarget===true){this.el.unmask()
}else{if(this.waitMsgTarget){this.waitMsgTarget.unmask()
}else{CQ.Ext.MessageBox.updateProgress(1);
CQ.Ext.MessageBox.hide()
}}}if(C){if(B.reset){this.reset()
}CQ.Ext.callback(B.success,B.scope,[this,A]);
this.fireEvent("actioncomplete",this,A)
}else{CQ.Ext.callback(B.failure,B.scope,[this,A]);
this.fireEvent("actionfailed",this,A)
}},findField:function(B){var A=this.items.get(B);
if(!CQ.Ext.isObject(A)){this.items.each(function(C){if(C.isFormField&&(C.dataIndex==B||C.id==B||C.getName()==B)){A=C;
return false
}})
}return A||null
},markInvalid:function(G){if(CQ.Ext.isArray(G)){for(var C=0,A=G.length;
C<A;
C++){var B=G[C];
var D=this.findField(B.id);
if(D){D.markInvalid(B.msg)
}}}else{var E,F;
for(F in G){if(!CQ.Ext.isFunction(G[F])&&(E=this.findField(F))){E.markInvalid(G[F])
}}}return this
},setValues:function(C){if(CQ.Ext.isArray(C)){for(var D=0,A=C.length;
D<A;
D++){var B=C[D];
var E=this.findField(B.id);
if(E){E.setValue(B.value);
if(this.trackResetOnLoad){E.originalValue=E.getValue()
}}}}else{var F,G;
for(G in C){if(!CQ.Ext.isFunction(C[G])&&(F=this.findField(G))){F.setValue(C[G]);
if(this.trackResetOnLoad){F.originalValue=F.getValue()
}}}}return this
},getValues:function(B){var A=CQ.Ext.lib.Ajax.serializeForm(this.el.dom);
if(B===true){return A
}return CQ.Ext.urlDecode(A)
},getFieldValues:function(A){var D={},E,B,C;
this.items.each(function(F){if(A!==true||F.isDirty()){E=F.getName();
B=D[E];
C=F.getValue();
if(CQ.Ext.isDefined(B)){if(CQ.Ext.isArray(B)){D[E].push(C)
}else{D[E]=[B,C]
}}else{D[E]=C
}}});
return D
},clearInvalid:function(){this.items.each(function(A){A.clearInvalid()
});
return this
},reset:function(){this.items.each(function(A){A.reset()
});
return this
},add:function(){this.items.addAll(Array.prototype.slice.call(arguments,0));
return this
},remove:function(A){this.items.remove(A);
return this
},render:function(){this.items.each(function(A){if(A.isFormField&&!A.rendered&&document.getElementById(A.id)){A.applyToMarkup(A.id)
}});
return this
},applyToFields:function(A){this.items.each(function(B){CQ.Ext.apply(B,A)
});
return this
},applyIfToFields:function(A){this.items.each(function(B){CQ.Ext.applyIf(B,A)
});
return this
},callFieldMethod:function(B,A){A=A||[];
this.items.each(function(C){if(CQ.Ext.isFunction(C[B])){C[B].apply(C,A)
}});
return this
}});
CQ.Ext.BasicForm=CQ.Ext.form.BasicForm;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.FormPanel=CQ.Ext.extend(CQ.Ext.Panel,{minButtonWidth:75,labelAlign:"left",monitorValid:false,monitorPoll:200,layout:"form",initComponent:function(){this.form=this.createForm();
CQ.Ext.FormPanel.superclass.initComponent.call(this);
this.bodyCfg={tag:"form",cls:this.baseCls+"-body",method:this.method||"POST",id:this.formId||CQ.Ext.id()};
if(this.fileUpload){this.bodyCfg.enctype="multipart/form-data"
}this.initItems();
this.addEvents("clientvalidation");
this.relayEvents(this.form,["beforeaction","actionfailed","actioncomplete"])
},createForm:function(){var A=CQ.Ext.applyIf({listeners:{}},this.initialConfig);
return new CQ.Ext.form.BasicForm(null,A)
},initFields:function(){var C=this.form;
var A=this;
var B=function(D){if(A.isField(D)){C.add(D)
}else{if(D.findBy&&D!=A){A.applySettings(D);
if(D.items&&D.items.each){D.items.each(B,this)
}}}};
this.items.each(B,this)
},applySettings:function(B){var A=B.ownerCt;
CQ.Ext.applyIf(B,{labelAlign:A.labelAlign,labelWidth:A.labelWidth,itemCls:A.itemCls})
},getLayoutTarget:function(){return this.form.el
},getForm:function(){return this.form
},onRender:function(B,A){this.initFields();
CQ.Ext.FormPanel.superclass.onRender.call(this,B,A);
this.form.initEl(this.body)
},beforeDestroy:function(){this.stopMonitoring();
CQ.Ext.destroy(this.form);
this.form.items.clear();
CQ.Ext.FormPanel.superclass.beforeDestroy.call(this)
},isField:function(A){return !!A.setValue&&!!A.getValue&&!!A.markInvalid&&!!A.clearInvalid
},initEvents:function(){CQ.Ext.FormPanel.superclass.initEvents.call(this);
this.on({scope:this,add:this.onAddEvent,remove:this.onRemoveEvent});
if(this.monitorValid){this.startMonitoring()
}},onAdd:function(A){CQ.Ext.FormPanel.superclass.onAdd.call(this,A);
this.processAdd(A)
},onAddEvent:function(A,B){if(A!==this){this.processAdd(B)
}},processAdd:function(A){if(this.isField(A)){this.form.add(A)
}else{if(A.findBy){this.applySettings(A);
this.form.add.apply(this.form,A.findBy(this.isField))
}}},onRemove:function(A){CQ.Ext.FormPanel.superclass.onRemove.call(this,A);
this.processRemove(A)
},onRemoveEvent:function(A,B){if(A!==this){this.processRemove(B)
}},processRemove:function(B){if(this.isField(B)){this.form.remove(B)
}else{if(B.findBy){var A=function(C){return !!C.isDestroyed
};
this.form.items.filterBy(A,this.form).each(this.form.remove,this.form)
}}},startMonitoring:function(){if(!this.validTask){this.validTask=new CQ.Ext.util.TaskRunner();
this.validTask.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})
}},stopMonitoring:function(){if(this.validTask){this.validTask.stopAll();
this.validTask=null
}},load:function(){this.form.load.apply(this.form,arguments)
},onDisable:function(){CQ.Ext.FormPanel.superclass.onDisable.call(this);
if(this.form){this.form.items.each(function(){this.disable()
})
}},onEnable:function(){CQ.Ext.FormPanel.superclass.onEnable.call(this);
if(this.form){this.form.items.each(function(){this.enable()
})
}},bindHandler:function(){var E=true;
this.form.items.each(function(F){if(!F.isValid(true)){E=false;
return false
}});
if(this.fbar){var B=this.fbar.items.items;
for(var D=0,A=B.length;
D<A;
D++){var C=B[D];
if(C.formBind===true&&C.disabled===E){C.setDisabled(!E)
}}}this.fireEvent("clientvalidation",this,E)
}});
CQ.Ext.reg("form",CQ.Ext.FormPanel);
CQ.Ext.form.FormPanel=CQ.Ext.FormPanel;
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.FieldSet=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-fieldset",layout:"form",animCollapse:false,onRender:function(B,A){if(!this.el){this.el=document.createElement("fieldset");
this.el.id=this.id;
if(this.title||this.header||this.checkboxToggle){this.el.appendChild(document.createElement("legend")).className=this.baseCls+"-header"
}}CQ.Ext.form.FieldSet.superclass.onRender.call(this,B,A);
if(this.checkboxToggle){var C=typeof this.checkboxToggle=="object"?this.checkboxToggle:{tag:"input",type:"checkbox",name:this.checkboxName||this.id+"-checkbox"};
this.checkbox=this.header.insertFirst(C);
this.checkbox.dom.checked=!this.collapsed;
this.mon(this.checkbox,"click",this.onCheckClick,this)
}},onCollapse:function(A,B){if(this.checkbox){this.checkbox.dom.checked=false
}CQ.Ext.form.FieldSet.superclass.onCollapse.call(this,A,B)
},onExpand:function(A,B){if(this.checkbox){this.checkbox.dom.checked=true
}CQ.Ext.form.FieldSet.superclass.onExpand.call(this,A,B)
},onCheckClick:function(){this[this.checkbox.dom.checked?"expand":"collapse"]()
}});
CQ.Ext.reg("fieldset",CQ.Ext.form.FieldSet);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.HtmlEditor=CQ.Ext.extend(CQ.Ext.form.Field,{enableFormat:true,enableFontSize:true,enableColors:true,enableAlignments:true,enableLists:true,enableSourceEdit:true,enableLinks:true,enableFont:true,createLinkText:"Please enter the URL for the link:",defaultLinkValue:"http://",fontFamilies:["Arial","Courier New","Tahoma","Times New Roman","Verdana"],defaultFont:"tahoma",defaultValue:(CQ.Ext.isOpera||CQ.Ext.isIE6)?"&#160;":"&#8203;",actionMode:"wrap",validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:CQ.Ext.emptyFn,iframePad:3,hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},initComponent:function(){this.addEvents("initialize","activate","beforesync","beforepush","sync","push","editmodechange")
},createFontOptions:function(){var D=[],B=this.fontFamilies,C,F;
for(var E=0,A=B.length;
E<A;
E++){C=B[E];
F=C.toLowerCase();
D.push('<option value="',F,'" style="font-family:',C,';"',(this.defaultFont==F?' selected="true">':">"),C,"</option>")
}return D.join("")
},createToolbar:function(E){var C=[];
var A=CQ.Ext.QuickTips&&CQ.Ext.QuickTips.isEnabled();
function D(I,G,H){return{itemId:I,cls:"x-btn-icon",iconCls:"x-edit-"+I,enableToggle:G!==false,scope:E,handler:H||E.relayBtnCmd,clickEvent:"mousedown",tooltip:A?E.buttonTips[I]||undefined:undefined,overflowText:E.buttonTips[I].title||undefined,tabIndex:-1}
}if(this.enableFont&&!CQ.Ext.isSafari2){var F=new CQ.Ext.Toolbar.Item({autoEl:{tag:"select",cls:"x-font-select",html:this.createFontOptions()}});
C.push(F,"-")
}if(this.enableFormat){C.push(D("bold"),D("italic"),D("underline"))
}if(this.enableFontSize){C.push("-",D("increasefontsize",false,this.adjustFont),D("decreasefontsize",false,this.adjustFont))
}if(this.enableColors){C.push("-",{itemId:"forecolor",cls:"x-btn-icon",iconCls:"x-edit-forecolor",clickEvent:"mousedown",tooltip:A?E.buttonTips.forecolor||undefined:undefined,tabIndex:-1,menu:new CQ.Ext.menu.ColorMenu({allowReselect:true,focus:CQ.Ext.emptyFn,value:"000000",plain:true,listeners:{scope:this,select:function(H,G){this.execCmd("forecolor",CQ.Ext.isWebKit||CQ.Ext.isIE?"#"+G:G);
this.deferFocus()
}},clickEvent:"mousedown"})},{itemId:"backcolor",cls:"x-btn-icon",iconCls:"x-edit-backcolor",clickEvent:"mousedown",tooltip:A?E.buttonTips.backcolor||undefined:undefined,tabIndex:-1,menu:new CQ.Ext.menu.ColorMenu({focus:CQ.Ext.emptyFn,value:"FFFFFF",plain:true,allowReselect:true,listeners:{scope:this,select:function(H,G){if(CQ.Ext.isGecko){this.execCmd("useCSS",false);
this.execCmd("hilitecolor",G);
this.execCmd("useCSS",true);
this.deferFocus()
}else{this.execCmd(CQ.Ext.isOpera?"hilitecolor":"backcolor",CQ.Ext.isWebKit||CQ.Ext.isIE?"#"+G:G);
this.deferFocus()
}}},clickEvent:"mousedown"})})
}if(this.enableAlignments){C.push("-",D("justifyleft"),D("justifycenter"),D("justifyright"))
}if(!CQ.Ext.isSafari2){if(this.enableLinks){C.push("-",D("createlink",false,this.createLink))
}if(this.enableLists){C.push("-",D("insertorderedlist"),D("insertunorderedlist"))
}if(this.enableSourceEdit){C.push("-",D("sourceedit",true,function(G){this.toggleSourceEdit(!this.sourceEditMode)
}))
}}var B=new CQ.Ext.Toolbar({renderTo:this.wrap.dom.firstChild,items:C});
if(F){this.fontSelect=F.el;
this.mon(this.fontSelect,"change",function(){var G=this.fontSelect.dom.value;
this.relayCmd("fontname",G);
this.deferFocus()
},this)
}this.mon(B.el,"click",function(G){G.preventDefault()
});
this.tb=B
},onDisable:function(){this.wrap.mask();
CQ.Ext.form.HtmlEditor.superclass.onDisable.call(this)
},onEnable:function(){this.wrap.unmask();
CQ.Ext.form.HtmlEditor.superclass.onEnable.call(this)
},setReadOnly:function(B){CQ.Ext.form.HtmlEditor.superclass.setReadOnly.call(this,B);
if(this.initialized){this.setDesignMode(!B);
var A=this.getEditorBody();
if(A){A.style.cursor=this.readOnly?"default":"text"
}this.disableItems(B)
}},getDocMarkup:function(){return'<html><head><meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /><style type="text/css">body{border:0;margin:0;padding:3px;height:98%;cursor:text;}</style></head><body></body></html>'
},getEditorBody:function(){var A=this.getDoc();
return A.body||A.documentElement
},getDoc:function(){return CQ.Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)
},getWin:function(){return CQ.Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]
},onRender:function(B,A){CQ.Ext.form.HtmlEditor.superclass.onRender.call(this,B,A);
this.el.dom.style.border="0 none";
this.el.dom.setAttribute("tabIndex",-1);
this.el.addClass("x-hidden");
if(CQ.Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")
}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",cn:{cls:"x-html-editor-tb"}});
this.createToolbar(this);
this.disableItems(true);
this.tb.doLayout();
this.createIFrame();
if(!this.width){var C=this.el.getSize();
this.setSize(C.width,this.height||C.height)
}this.resizeEl=this.positionEl=this.wrap
},createIFrame:function(){var A=document.createElement("iframe");
A.name=CQ.Ext.id();
A.frameBorder="0";
A.style.overflow="auto";
this.wrap.dom.appendChild(A);
this.iframe=A;
this.monitorTask=CQ.Ext.TaskMgr.start({run:this.checkDesignMode,scope:this,interval:100})
},initFrame:function(){CQ.Ext.TaskMgr.stop(this.monitorTask);
var B=this.getDoc();
this.win=this.getWin();
B.open();
B.write(this.getDocMarkup());
B.close();
var A={run:function(){var C=this.getDoc();
if(C.body||C.readyState=="complete"){CQ.Ext.TaskMgr.stop(A);
this.setDesignMode(true);
this.initEditor.defer(10,this)
}},interval:10,duration:10000,scope:this};
CQ.Ext.TaskMgr.start(A)
},checkDesignMode:function(){if(this.wrap&&this.wrap.dom.offsetWidth){var A=this.getDoc();
if(!A){return 
}if(!A.editorInitialized||this.getDesignMode()!="on"){this.initFrame()
}}},setDesignMode:function(B){var A;
if(A=this.getDoc()){if(this.readOnly){B=false
}A.designMode=(/on|true/i).test(String(B).toLowerCase())?"on":"off"
}},getDesignMode:function(){var A=this.getDoc();
if(!A){return""
}return String(A.designMode).toLowerCase()
},disableItems:function(A){if(this.fontSelect){this.fontSelect.dom.disabled=A
}this.tb.items.each(function(B){if(B.getItemId()!="sourceedit"){B.setDisabled(A)
}})
},onResize:function(B,C){CQ.Ext.form.HtmlEditor.superclass.onResize.apply(this,arguments);
if(this.el&&this.iframe){if(CQ.Ext.isNumber(B)){var E=B-this.wrap.getFrameWidth("lr");
this.el.setWidth(E);
this.tb.setWidth(E);
this.iframe.style.width=Math.max(E,0)+"px"
}if(CQ.Ext.isNumber(C)){var A=C-this.wrap.getFrameWidth("tb")-this.tb.el.getHeight();
this.el.setHeight(A);
this.iframe.style.height=Math.max(A,0)+"px";
var D=this.getEditorBody();
if(D){D.style.height=Math.max((A-(this.iframePad*2)),0)+"px"
}}}},toggleSourceEdit:function(A){if(A===undefined){A=!this.sourceEditMode
}this.sourceEditMode=A===true;
var C=this.tb.getComponent("sourceedit");
if(C.pressed!==this.sourceEditMode){C.toggle(this.sourceEditMode);
if(!C.xtbHidden){return 
}}if(this.sourceEditMode){this.disableItems(true);
this.syncValue();
this.iframe.className="x-hidden";
this.el.removeClass("x-hidden");
this.el.dom.removeAttribute("tabIndex");
this.el.focus()
}else{if(this.initialized){this.disableItems(this.readOnly)
}this.pushValue();
this.iframe.className="";
this.el.addClass("x-hidden");
this.el.dom.setAttribute("tabIndex",-1);
this.deferFocus()
}var B=this.lastSize;
if(B){delete this.lastSize;
this.setSize(B)
}this.fireEvent("editmodechange",this,this.sourceEditMode)
},createLink:function(){var A=prompt(this.createLinkText,this.defaultLinkValue);
if(A&&A!="http://"){this.relayCmd("createlink",A)
}},initEvents:function(){this.originalValue=this.getValue()
},markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,setValue:function(A){CQ.Ext.form.HtmlEditor.superclass.setValue.call(this,A);
this.pushValue();
return this
},cleanHtml:function(A){A=String(A);
if(CQ.Ext.isWebKit){A=A.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,"")
}if(A.charCodeAt(0)==this.defaultValue.replace(/\D/g,"")){A=A.substring(1)
}return A
},syncValue:function(){if(this.initialized){var D=this.getEditorBody();
var C=D.innerHTML;
if(CQ.Ext.isWebKit){var B=D.getAttribute("style");
var A=B.match(/text-align:(.*?);/i);
if(A&&A[1]){C='<div style="'+A[0]+'">'+C+"</div>"
}}C=this.cleanHtml(C);
if(this.fireEvent("beforesync",this,C)!==false){this.el.dom.value=C;
this.fireEvent("sync",this,C)
}}},getValue:function(){this[this.sourceEditMode?"pushValue":"syncValue"]();
return CQ.Ext.form.HtmlEditor.superclass.getValue.call(this)
},pushValue:function(){if(this.initialized){var A=this.el.dom.value;
if(!this.activated&&A.length<1){A=this.defaultValue
}if(this.fireEvent("beforepush",this,A)!==false){this.getEditorBody().innerHTML=A;
if(CQ.Ext.isGecko){this.setDesignMode(false)
}this.setDesignMode(true);
this.fireEvent("push",this,A)
}}},deferFocus:function(){this.focus.defer(10,this)
},focus:function(){if(this.win&&!this.sourceEditMode){this.win.focus()
}else{this.el.focus()
}},initEditor:function(){try{var C=this.getEditorBody(),A=this.el.getStyles("font-size","font-family","background-image","background-repeat"),E,B;
A["background-attachment"]="fixed";
C.bgProperties="fixed";
CQ.Ext.DomHelper.applyStyles(C,A);
E=this.getDoc();
if(E){try{CQ.Ext.EventManager.removeAll(E)
}catch(D){}}B=this.onEditorEvent.createDelegate(this);
CQ.Ext.EventManager.on(E,{mousedown:B,dblclick:B,click:B,keyup:B,buffer:100});
if(CQ.Ext.isGecko){CQ.Ext.EventManager.on(E,"keypress",this.applyCommand,this)
}if(CQ.Ext.isIE||CQ.Ext.isWebKit||CQ.Ext.isOpera){CQ.Ext.EventManager.on(E,"keydown",this.fixKeys,this)
}E.editorInitialized=true;
this.initialized=true;
this.pushValue();
this.setReadOnly(this.readOnly);
this.fireEvent("initialize",this)
}catch(D){}},onDestroy:function(){if(this.monitorTask){CQ.Ext.TaskMgr.stop(this.monitorTask)
}if(this.rendered){CQ.Ext.destroy(this.tb);
var B=this.getDoc();
if(B){try{CQ.Ext.EventManager.removeAll(B);
for(var C in B){delete B[C]
}}catch(A){}}if(this.wrap){this.wrap.dom.innerHTML="";
this.wrap.remove()
}}if(this.el){this.el.removeAllListeners();
this.el.remove()
}this.purgeListeners()
},onFirstFocus:function(){this.activated=true;
this.disableItems(this.readOnly);
if(CQ.Ext.isGecko){this.win.focus();
var A=this.win.getSelection();
if(!A.focusNode||A.focusNode.nodeType!=3){var B=A.getRangeAt(0);
B.selectNodeContents(this.getEditorBody());
B.collapse(true);
this.deferFocus()
}try{this.execCmd("useCSS",true);
this.execCmd("styleWithCSS",false)
}catch(C){}}this.fireEvent("activate",this)
},adjustFont:function(B){var D=B.getItemId()=="increasefontsize"?1:-1,C=this.getDoc(),A=parseInt(C.queryCommandValue("FontSize")||2,10);
if((CQ.Ext.isSafari&&!CQ.Ext.isSafari2)||CQ.Ext.isChrome||CQ.Ext.isAir){if(A<=10){A=1+D
}else{if(A<=13){A=2+D
}else{if(A<=16){A=3+D
}else{if(A<=18){A=4+D
}else{if(A<=24){A=5+D
}else{A=6+D
}}}}}A=A.constrain(1,6)
}else{if(CQ.Ext.isSafari){D*=2
}A=Math.max(1,A+D)+(CQ.Ext.isSafari?"px":0)
}this.execCmd("FontSize",A)
},onEditorEvent:function(A){this.updateToolbar()
},updateToolbar:function(){if(this.readOnly){return 
}if(!this.activated){this.onFirstFocus();
return 
}var B=this.tb.items.map,C=this.getDoc();
if(this.enableFont&&!CQ.Ext.isSafari2){var A=(C.queryCommandValue("FontName")||this.defaultFont).toLowerCase();
if(A!=this.fontSelect.dom.value){this.fontSelect.dom.value=A
}}if(this.enableFormat){B.bold.toggle(C.queryCommandState("bold"));
B.italic.toggle(C.queryCommandState("italic"));
B.underline.toggle(C.queryCommandState("underline"))
}if(this.enableAlignments){B.justifyleft.toggle(C.queryCommandState("justifyleft"));
B.justifycenter.toggle(C.queryCommandState("justifycenter"));
B.justifyright.toggle(C.queryCommandState("justifyright"))
}if(!CQ.Ext.isSafari2&&this.enableLists){B.insertorderedlist.toggle(C.queryCommandState("insertorderedlist"));
B.insertunorderedlist.toggle(C.queryCommandState("insertunorderedlist"))
}CQ.Ext.menu.MenuMgr.hideAll();
this.syncValue()
},relayBtnCmd:function(A){this.relayCmd(A.getItemId())
},relayCmd:function(B,A){(function(){this.focus();
this.execCmd(B,A);
this.updateToolbar()
}).defer(10,this)
},execCmd:function(B,A){var C=this.getDoc();
C.execCommand(B,false,A===undefined?null:A);
this.syncValue()
},applyCommand:function(B){if(B.ctrlKey){var C=B.getCharCode(),A;
if(C>0){C=String.fromCharCode(C);
switch(C){case"b":A="bold";
break;
case"i":A="italic";
break;
case"u":A="underline";
break
}if(A){this.win.focus();
this.execCmd(A);
this.deferFocus();
B.preventDefault()
}}}},insertAtCursor:function(C){if(!this.activated){return 
}if(CQ.Ext.isIE){this.win.focus();
var B=this.getDoc(),A=B.selection.createRange();
if(A){A.pasteHTML(C);
this.syncValue();
this.deferFocus()
}}else{this.win.focus();
this.execCmd("InsertHTML",C);
this.deferFocus()
}},fixKeys:function(){if(CQ.Ext.isIE){return function(E){var A=E.getKey(),D=this.getDoc(),B;
if(A==E.TAB){E.stopEvent();
B=D.selection.createRange();
if(B){B.collapse(true);
B.pasteHTML("&nbsp;&nbsp;&nbsp;&nbsp;");
this.deferFocus()
}}else{if(A==E.ENTER){B=D.selection.createRange();
if(B){var C=B.parentElement();
if(!C||C.tagName.toLowerCase()!="li"){E.stopEvent();
B.pasteHTML("<br />");
B.collapse(false);
B.select()
}}}}}
}else{if(CQ.Ext.isOpera){return function(B){var A=B.getKey();
if(A==B.TAB){B.stopEvent();
this.win.focus();
this.execCmd("InsertHTML","&nbsp;&nbsp;&nbsp;&nbsp;");
this.deferFocus()
}}
}else{if(CQ.Ext.isWebKit){return function(B){var A=B.getKey();
if(A==B.TAB){B.stopEvent();
this.execCmd("InsertText","\t");
this.deferFocus()
}else{if(A==B.ENTER){B.stopEvent();
this.execCmd("InsertHtml","<br /><br />");
this.deferFocus()
}}}
}}}}(),getToolbar:function(){return this.tb
},buttonTips:{bold:{title:"Bold (Ctrl+B)",text:"Make the selected text bold.",cls:"x-html-editor-tip"},italic:{title:"Italic (Ctrl+I)",text:"Make the selected text italic.",cls:"x-html-editor-tip"},underline:{title:"Underline (Ctrl+U)",text:"Underline the selected text.",cls:"x-html-editor-tip"},increasefontsize:{title:"Grow Text",text:"Increase the font size.",cls:"x-html-editor-tip"},decreasefontsize:{title:"Shrink Text",text:"Decrease the font size.",cls:"x-html-editor-tip"},backcolor:{title:"Text Highlight Color",text:"Change the background color of the selected text.",cls:"x-html-editor-tip"},forecolor:{title:"Font Color",text:"Change the color of the selected text.",cls:"x-html-editor-tip"},justifyleft:{title:"Align Text Left",text:"Align text to the left.",cls:"x-html-editor-tip"},justifycenter:{title:"Center Text",text:"Center text in the editor.",cls:"x-html-editor-tip"},justifyright:{title:"Align Text Right",text:"Align text to the right.",cls:"x-html-editor-tip"},insertunorderedlist:{title:"Bullet List",text:"Start a bulleted list.",cls:"x-html-editor-tip"},insertorderedlist:{title:"Numbered List",text:"Start a numbered list.",cls:"x-html-editor-tip"},createlink:{title:"Hyperlink",text:"Make the selected text a hyperlink.",cls:"x-html-editor-tip"},sourceedit:{title:"Source Edit",text:"Switch to source editing mode.",cls:"x-html-editor-tip"}}});
CQ.Ext.reg("htmleditor",CQ.Ext.form.HtmlEditor);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.TimeField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{minValue:undefined,maxValue:undefined,minText:"The time in this field must be equal to or after {0}",maxText:"The time in this field must be equal to or before {0}",invalidText:"{0} is not a valid time",format:"g:i A",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H",increment:15,mode:"local",triggerAction:"all",typeAhead:false,initDate:"1/1/2008",initComponent:function(){if(CQ.Ext.isDefined(this.minValue)){this.setMinValue(this.minValue,true)
}if(CQ.Ext.isDefined(this.maxValue)){this.setMaxValue(this.maxValue,true)
}if(!this.store){this.generateStore(true)
}CQ.Ext.form.TimeField.superclass.initComponent.call(this)
},setMinValue:function(B,A){this.setLimit(B,true,A);
return this
},setMaxValue:function(B,A){this.setLimit(B,false,A);
return this
},generateStore:function(B){var C=this.minValue||new Date(this.initDate).clearTime(),A=this.maxValue||new Date(this.initDate).clearTime().add("mi",(24*60)-1),D=[];
while(C<=A){D.push(C.dateFormat(this.format));
C=C.add("mi",this.increment)
}this.bindStore(D,B)
},setLimit:function(B,E,A){var D;
if(CQ.Ext.isString(B)){D=this.parseDate(B)
}else{if(CQ.Ext.isDate(B)){D=B
}}if(D){var C=new Date(this.initDate).clearTime();
C.setHours(D.getHours(),D.getMinutes(),E?0:59,0);
this[E?"minValue":"maxValue"]=C;
if(!A){this.generateStore()
}}},getValue:function(){var A=CQ.Ext.form.TimeField.superclass.getValue.call(this);
return this.formatDate(this.parseDate(A))||""
},setValue:function(A){return CQ.Ext.form.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(A)))
},validateValue:CQ.Ext.form.DateField.prototype.validateValue,parseDate:CQ.Ext.form.DateField.prototype.parseDate,formatDate:CQ.Ext.form.DateField.prototype.formatDate,beforeBlur:function(){var A=this.parseDate(this.getRawValue());
if(A){this.setValue(A.dateFormat(this.format))
}CQ.Ext.form.TimeField.superclass.beforeBlur.call(this)
}});
CQ.Ext.reg("timefield",CQ.Ext.form.TimeField);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Label=CQ.Ext.extend(CQ.Ext.BoxComponent,{onRender:function(B,A){if(!this.el){this.el=document.createElement("label");
this.el.id=this.getId();
this.el.innerHTML=this.text?CQ.Ext.util.Format.htmlEncode(this.text):(this.html||"");
if(this.forId){this.el.setAttribute("for",this.forId)
}}CQ.Ext.form.Label.superclass.onRender.call(this,B,A)
},setText:function(A,B){var C=B===false;
this[!C?"text":"html"]=A;
delete this[C?"text":"html"];
if(this.rendered){this.el.dom.innerHTML=B!==false?CQ.Ext.util.Format.htmlEncode(A):A
}return this
}});
CQ.Ext.reg("label",CQ.Ext.form.Label);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.Action=function(B,A){this.form=B;
this.options=A||{}
};
CQ.Ext.form.Action.CLIENT_INVALID="client";
CQ.Ext.form.Action.SERVER_INVALID="server";
CQ.Ext.form.Action.CONNECT_FAILURE="connect";
CQ.Ext.form.Action.LOAD_FAILURE="load";
CQ.Ext.form.Action.prototype={type:"default",run:function(A){},success:function(A){},handleResponse:function(A){},failure:function(A){this.response=A;
this.failureType=CQ.Ext.form.Action.CONNECT_FAILURE;
this.form.afterAction(this,false)
},processResponse:function(A){this.response=A;
if(!A.responseText&&!A.responseXML){return true
}this.result=this.handleResponse(A);
return this.result
},getUrl:function(C){var A=this.options.url||this.form.url||this.form.el.dom.action;
if(C){var B=this.getParams();
if(B){A=CQ.Ext.urlAppend(A,B)
}}return A
},getMethod:function(){return(this.options.method||this.form.method||this.form.el.dom.method||"POST").toUpperCase()
},getParams:function(){var A=this.form.baseParams;
var B=this.options.params;
if(B){if(typeof B=="object"){B=CQ.Ext.urlEncode(CQ.Ext.applyIf(B,A))
}else{if(typeof B=="string"&&A){B+="&"+CQ.Ext.urlEncode(A)
}}}else{if(A){B=CQ.Ext.urlEncode(A)
}}return B
},createCallback:function(A){var A=A||{};
return{success:this.success,failure:this.failure,scope:this,timeout:(A.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined}
}};
CQ.Ext.form.Action.Submit=function(B,A){CQ.Ext.form.Action.Submit.superclass.constructor.call(this,B,A)
};
CQ.Ext.extend(CQ.Ext.form.Action.Submit,CQ.Ext.form.Action,{type:"submit",run:function(){var B=this.options;
var C=this.getMethod();
var A=C=="GET";
if(B.clientValidation===false||this.form.isValid()){CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(B),{form:this.form.el.dom,url:this.getUrl(A),method:C,headers:B.headers,params:!A?this.getParams():null,isUpload:this.form.fileUpload}))
}else{if(B.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}},success:function(B){var A=this.processResponse(B);
if(A===true||A.success){this.form.afterAction(this,true);
return 
}if(A.errors){this.form.markInvalid(A.errors)
}this.failureType=CQ.Ext.form.Action.SERVER_INVALID;
this.form.afterAction(this,false)
},handleResponse:function(C){if(this.form.errorReader){var B=this.form.errorReader.read(C);
var F=[];
if(B.records){for(var D=0,A=B.records.length;
D<A;
D++){var E=B.records[D];
F[D]=E.data
}}if(F.length<1){F=null
}return{success:B.success,errors:F}
}return CQ.Ext.decode(C.responseText)
}});
CQ.Ext.form.Action.Load=function(B,A){CQ.Ext.form.Action.Load.superclass.constructor.call(this,B,A);
this.reader=this.form.reader
};
CQ.Ext.extend(CQ.Ext.form.Action.Load,CQ.Ext.form.Action,{type:"load",run:function(){CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(this.options),{method:this.getMethod(),url:this.getUrl(false),headers:this.options.headers,params:this.getParams()}))
},success:function(B){var A=this.processResponse(B);
if(A===true||!A.success||!A.data){this.failureType=CQ.Ext.form.Action.LOAD_FAILURE;
this.form.afterAction(this,false);
return 
}this.form.clearInvalid();
this.form.setValues(A.data);
this.form.afterAction(this,true)
},handleResponse:function(B){if(this.form.reader){var A=this.form.reader.read(B);
var C=A.records&&A.records[0]?A.records[0].data:null;
return{success:A.success,data:C}
}return CQ.Ext.decode(B.responseText)
}});
CQ.Ext.form.Action.DirectLoad=CQ.Ext.extend(CQ.Ext.form.Action.Load,{constructor:function(B,A){CQ.Ext.form.Action.DirectLoad.superclass.constructor.call(this,B,A)
},type:"directload",run:function(){var A=this.getParams();
A.push(this.success,this);
this.form.api.load.apply(window,A)
},getParams:function(){var C=[],G={};
var E=this.form.baseParams;
var F=this.options.params;
CQ.Ext.apply(G,F,E);
var B=this.form.paramOrder;
if(B){for(var D=0,A=B.length;
D<A;
D++){C.push(G[B[D]])
}}else{if(this.form.paramsAsHash){C.push(G)
}}return C
},processResponse:function(A){this.result=A;
return A
},success:function(A,B){if(B.type==CQ.Ext.Direct.exceptions.SERVER){A={}
}CQ.Ext.form.Action.DirectLoad.superclass.success.call(this,A)
}});
CQ.Ext.form.Action.DirectSubmit=CQ.Ext.extend(CQ.Ext.form.Action.Submit,{constructor:function(B,A){CQ.Ext.form.Action.DirectSubmit.superclass.constructor.call(this,B,A)
},type:"directsubmit",run:function(){var A=this.options;
if(A.clientValidation===false||this.form.isValid()){this.success.params=this.getParams();
this.form.api.submit(this.form.el.dom,this.success,this)
}else{if(A.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}},getParams:function(){var C={};
var A=this.form.baseParams;
var B=this.options.params;
CQ.Ext.apply(C,B,A);
return C
},processResponse:function(A){this.result=A;
return A
},success:function(A,B){if(B.type==CQ.Ext.Direct.exceptions.SERVER){A={}
}CQ.Ext.form.Action.DirectSubmit.superclass.success.call(this,A)
}});
CQ.Ext.form.Action.ACTION_TYPES={load:CQ.Ext.form.Action.Load,submit:CQ.Ext.form.Action.Submit,directload:CQ.Ext.form.Action.DirectLoad,directsubmit:CQ.Ext.form.Action.DirectSubmit};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.form.VTypes=function(){var C=/^[a-zA-Z_]+$/,D=/^[a-zA-Z0-9_]+$/,B=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,A=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;
return{email:function(E){return B.test(E)
},emailText:'This field should be an e-mail address in the format "user@example.com"',emailMask:/[a-z0-9_\.\-@]/i,url:function(E){return A.test(E)
},urlText:'This field should be a URL in the format "http://www.example.com"',alpha:function(E){return C.test(E)
},alphaText:"This field should only contain letters and _",alphaMask:/[a-z_]/i,alphanum:function(E){return D.test(E)
},alphanumText:"This field should only contain letters, numbers and _",alphanumMask:/[a-z0-9_]/i}
}();
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.GridPanel=CQ.Ext.extend(CQ.Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:"{0} selected row{1}",deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:["columnmove","columnresize","sortchange","groupchange"],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){CQ.Ext.grid.GridPanel.superclass.initComponent.call(this);
if(this.columnLines){this.cls=(this.cls||"")+" x-grid-with-col-lines"
}this.autoScroll=false;
this.autoWidth=false;
if(CQ.Ext.isArray(this.columns)){this.colModel=new CQ.Ext.grid.ColumnModel(this.columns);
delete this.columns
}if(this.ds){this.store=this.ds;
delete this.ds
}if(this.cm){this.colModel=this.cm;
delete this.cm
}if(this.sm){this.selModel=this.sm;
delete this.sm
}this.store=CQ.Ext.StoreMgr.lookup(this.store);
this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellmousedown","rowmousedown","headermousedown","groupmousedown","rowbodymousedown","containermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","groupclick","groupdblclick","containerclick","containerdblclick","rowbodyclick","rowbodydblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","groupcontextmenu","containercontextmenu","rowbodycontextmenu","bodyscroll","columnresize","columnmove","sortchange","groupchange","reconfigure","viewready")
},onRender:function(C,A){CQ.Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);
var D=this.getGridEl();
this.el.addClass("x-grid-panel");
this.mon(D,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});
this.relayEvents(D,["mousedown","mouseup","mouseover","mouseout","keypress","keydown"]);
var B=this.getView();
B.init(this);
B.render();
this.getSelectionModel().init(this)
},initEvents:function(){CQ.Ext.grid.GridPanel.superclass.initEvents.call(this);
if(this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.bwrap,CQ.Ext.apply({store:this.store},this.loadMask))
}},initStateEvents:function(){CQ.Ext.grid.GridPanel.superclass.initStateEvents.call(this);
this.mon(this.colModel,"hiddenchange",this.saveState,this,{delay:100})
},applyState:function(A){var I=this.colModel,E=A.columns,H=this.store,J,F,G;
if(E){for(var C=0,D=E.length;
C<D;
C++){J=E[C];
F=I.getColumnById(J.id);
if(F){F.hidden=J.hidden;
F.width=J.width;
G=I.getIndexById(J.id);
if(G!=C){I.moveColumn(G,C)
}}}}if(H){J=A.sort;
if(J){H[H.remoteSort?"setDefaultSort":"sort"](J.field,J.direction)
}J=A.group;
if(H.groupBy){if(J){H.groupBy(J)
}else{H.clearGrouping()
}}}var B=CQ.Ext.apply({},A);
delete B.columns;
delete B.sort;
CQ.Ext.grid.GridPanel.superclass.applyState.call(this,B)
},getState:function(){var E={columns:[]},B=this.store,D,A;
for(var C=0,F;
(F=this.colModel.config[C]);
C++){E.columns[C]={id:F.id,width:F.width};
if(F.hidden){E.columns[C].hidden=true
}}if(B){D=B.getSortState();
if(D){E.sort=D
}if(B.getGroupState){A=B.getGroupState();
if(A){E.group=A
}}}return E
},afterRender:function(){CQ.Ext.grid.GridPanel.superclass.afterRender.call(this);
var A=this.view;
this.on("bodyresize",A.layout,A);
A.layout();
if(this.deferRowRender){A.afterRender.defer(10,this.view)
}else{A.afterRender()
}this.viewReady=true
},reconfigure:function(A,B){var C=this.rendered;
if(C){if(this.loadMask){this.loadMask.destroy();
this.loadMask=new CQ.Ext.LoadMask(this.bwrap,CQ.Ext.apply({},{store:A},this.initialConfig.loadMask))
}}if(this.view){this.view.initData(A,B)
}this.store=A;
this.colModel=B;
if(C){this.view.refresh(true)
}this.fireEvent("reconfigure",this,A,B)
},onDestroy:function(){if(this.rendered){CQ.Ext.destroy(this.view,this.loadMask)
}else{if(this.store&&this.store.autoDestroy){this.store.destroy()
}}CQ.Ext.destroy(this.colModel,this.selModel);
this.store=this.selModel=this.colModel=this.view=this.loadMask=null;
CQ.Ext.grid.GridPanel.superclass.onDestroy.call(this)
},processEvent:function(D,F){this.fireEvent(D,F);
var E=F.getTarget(),C=this.view,H=C.findHeaderIndex(E);
if(H!==false){this.fireEvent("header"+D,this,H,F)
}else{var G=C.findRowIndex(E),B,A;
if(G!==false){this.fireEvent("row"+D,this,G,F);
B=C.findCellIndex(E);
A=C.findRowBody(E);
if(B!==false){this.fireEvent("cell"+D,this,G,B,F)
}if(A){this.fireEvent("rowbody"+D,this,G,F)
}}else{this.fireEvent("container"+D,this,F)
}}this.view.processEvent(D,F)
},onClick:function(A){this.processEvent("click",A)
},onMouseDown:function(A){this.processEvent("mousedown",A)
},onContextMenu:function(B,A){this.processEvent("contextmenu",B)
},onDblClick:function(A){this.processEvent("dblclick",A)
},walkCells:function(J,C,B,E,I){var H=this.colModel,F=H.getColumnCount(),A=this.store,G=A.getCount(),D=true;
if(B<0){if(C<0){J--;
D=false
}while(J>=0){if(!D){C=F-1
}D=false;
while(C>=0){if(E.call(I||this,J,C,H)===true){return[J,C]
}C--
}J--
}}else{if(C>=F){J++;
D=false
}while(J<G){if(!D){C=0
}D=false;
while(C<F){if(E.call(I||this,J,C,H)===true){return[J,C]
}C++
}J++
}}return null
},onResize:function(){CQ.Ext.grid.GridPanel.superclass.onResize.apply(this,arguments);
if(this.viewReady){this.view.layout()
}},getGridEl:function(){return this.body
},stopEditing:CQ.Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new CQ.Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:CQ.Ext.emptyFn}:null)
}return this.selModel
},getStore:function(){return this.store
},getColumnModel:function(){return this.colModel
},getView:function(){if(!this.view){this.view=new CQ.Ext.grid.GridView(this.viewConfig)
}return this.view
},getDragDropText:function(){var A=this.selModel.getCount();
return String.format(this.ddText,A,A==1?"":"s")
}});
CQ.Ext.reg("grid",CQ.Ext.grid.GridPanel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.GridView=CQ.Ext.extend(CQ.Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",selectedRowClass:"x-grid3-row-selected",borderWidth:2,tdClass:"x-grid3-cell",hdCls:"x-grid3-hd",markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,rowBodySelectorDepth:10,cellSelector:"td.x-grid3-cell",rowSelector:"div.x-grid3-row",rowBodySelector:"div.x-grid3-row-body",firstRowCls:"x-grid3-row-first",lastRowCls:"x-grid3-row-last",rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,constructor:function(A){CQ.Ext.apply(this,A);
this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");
CQ.Ext.grid.GridView.superclass.constructor.call(this)
},initTemplates:function(){var C=this.templates||{};
if(!C.master){C.master=new CQ.Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")
}if(!C.header){C.header=new CQ.Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>',"</table>")
}if(!C.hcell){C.hcell=new CQ.Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',CQ.Ext.BLANK_IMAGE_URL,'" />',"</div></td>")
}if(!C.body){C.body=new CQ.Ext.Template("{rows}")
}if(!C.row){C.row=new CQ.Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>")
}if(!C.cell){C.cell=new CQ.Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")
}for(var A in C){var B=C[A];
if(B&&CQ.Ext.isFunction(B.compile)&&!B.compiled){B.disableFormats=true;
B.compile()
}}this.templates=C;
this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")
},fly:function(A){if(!this._flyweight){this._flyweight=new CQ.Ext.Element.Flyweight(document.body)
}this._flyweight.dom=A;
return this._flyweight
},getEditorParent:function(){return this.scroller.dom
},initElements:function(){var C=CQ.Ext.Element;
var B=this.grid.getGridEl().dom.firstChild;
var A=B.childNodes;
this.el=new C(B);
this.mainWrap=new C(A[0]);
this.mainHd=new C(this.mainWrap.dom.firstChild);
if(this.grid.hideHeaders){this.mainHd.setDisplayed(false)
}this.innerHd=this.mainHd.dom.firstChild;
this.scroller=new C(this.mainWrap.dom.childNodes[1]);
if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")
}this.mainBody=new C(this.scroller.dom.firstChild);
this.focusEl=new C(this.scroller.dom.childNodes[1]);
this.focusEl.swallowEvent("click",true);
this.resizeMarker=new C(A[1]);
this.resizeProxy=new C(A[2])
},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]
},findCell:function(A){if(!A){return false
}return this.fly(A).findParent(this.cellSelector,this.cellSelectorDepth)
},findCellIndex:function(C,B){var A=this.findCell(C);
if(A&&(!B||this.fly(A).hasClass(B))){return this.getCellIndex(A)
}return false
},getCellIndex:function(B){if(B){var A=B.className.match(this.colRe);
if(A&&A[1]){return this.cm.getIndexById(A[1])
}}return false
},findHeaderCell:function(B){var A=this.findCell(B);
return A&&this.fly(A).hasClass(this.hdCls)?A:null
},findHeaderIndex:function(A){return this.findCellIndex(A,this.hdCls)
},findRow:function(A){if(!A){return false
}return this.fly(A).findParent(this.rowSelector,this.rowSelectorDepth)
},findRowIndex:function(A){var B=this.findRow(A);
return B?B.rowIndex:false
},findRowBody:function(A){if(!A){return false
}return this.fly(A).findParent(this.rowBodySelector,this.rowBodySelectorDepth)
},getRow:function(A){return this.getRows()[A]
},getCell:function(B,A){return this.getRow(B).getElementsByTagName("td")[A]
},getHeaderCell:function(A){return this.mainHd.dom.getElementsByTagName("td")[A]
},addRowClass:function(C,A){var B=this.getRow(C);
if(B){this.fly(B).addClass(A)
}},removeRowClass:function(C,A){var B=this.getRow(C);
if(B){this.fly(B).removeClass(A)
}},removeRow:function(A){CQ.Ext.removeNode(this.getRow(A));
this.syncFocusEl(A)
},removeRows:function(C,A){var B=this.mainBody.dom;
for(var D=C;
D<=A;
D++){CQ.Ext.removeNode(B.childNodes[C])
}this.syncFocusEl(C)
},getScrollState:function(){var A=this.scroller.dom;
return{left:A.scrollLeft,top:A.scrollTop}
},restoreScroll:function(A){var B=this.scroller.dom;
B.scrollLeft=A.left;
B.scrollTop=A.top
},scrollToTop:function(){this.scroller.dom.scrollTop=0;
this.scroller.dom.scrollLeft=0
},syncScroll:function(){this.syncHeaderScroll();
var A=this.scroller.dom;
this.grid.fireEvent("bodyscroll",A.scrollLeft,A.scrollTop)
},syncHeaderScroll:function(){var A=this.scroller.dom;
this.innerHd.scrollLeft=A.scrollLeft;
this.innerHd.scrollLeft=A.scrollLeft
},updateSortIcon:function(B,A){var D=this.sortClasses;
var C=this.mainHd.select("td").removeClass(D);
C.item(B).addClass(D[A=="DESC"?1:0])
},updateAllColumnWidths:function(){var D=this.getTotalWidth(),I=this.cm.getColumnCount(),F=[],E,B;
for(B=0;
B<I;
B++){F[B]=this.getColumnWidth(B)
}this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=D;
this.mainBody.dom.style.width=D;
for(B=0;
B<I;
B++){var C=this.getHeaderCell(B);
C.style.width=F[B]
}var H=this.getRows(),J,G;
for(B=0,E=H.length;
B<E;
B++){J=H[B];
J.style.width=D;
if(J.firstChild){J.firstChild.style.width=D;
G=J.firstChild.rows[0];
for(var A=0;
A<I;
A++){G.childNodes[A].style.width=F[A]
}}}this.onAllColumnWidthsUpdated(F,D)
},updateColumnWidth:function(B,A){var H=this.getColumnWidth(B);
var E=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=E;
this.mainBody.dom.style.width=E;
var D=this.getHeaderCell(B);
D.style.width=H;
var G=this.getRows(),I;
for(var C=0,F=G.length;
C<F;
C++){I=G[C];
I.style.width=E;
if(I.firstChild){I.firstChild.style.width=E;
I.firstChild.rows[0].childNodes[B].style.width=H
}}this.onColumnWidthUpdated(B,H,E)
},updateColumnHidden:function(A,E){var D=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=D;
this.mainBody.dom.style.width=D;
var G=E?"none":"";
var C=this.getHeaderCell(A);
C.style.display=G;
var H=this.getRows(),I;
for(var B=0,F=H.length;
B<F;
B++){I=H[B];
I.style.width=D;
if(I.firstChild){I.firstChild.style.width=D;
I.firstChild.rows[0].childNodes[A].style.display=G
}}this.onColumnHiddenUpdated(A,E,D);
delete this.lastViewWidth;
this.layout()
},doRender:function(E,G,M,A,L,Q){var B=this.templates,D=B.cell,F=B.row,H=L-1;
var C="width:"+this.getTotalWidth()+";";
var T=[],N,U,O={},I={tstyle:C},K;
for(var P=0,S=G.length;
P<S;
P++){K=G[P];
N=[];
var J=(P+A);
for(var R=0;
R<L;
R++){U=E[R];
O.id=U.id;
O.css=R===0?"x-grid3-cell-first ":(R==H?"x-grid3-cell-last ":"");
O.attr=O.cellAttr="";
O.value=U.renderer.call(U.scope,K.data[U.name],O,K,J,R,M);
O.style=U.style;
if(CQ.Ext.isEmpty(O.value)){O.value="&#160;"
}if(this.markDirty&&K.dirty&&CQ.Ext.isDefined(K.modified[U.name])){O.css+=" x-grid3-dirty-cell"
}N[N.length]=D.apply(O)
}var V=[];
if(Q&&((J+1)%2===0)){V[0]="x-grid3-row-alt"
}if(K.dirty){V[1]=" x-grid3-dirty-row"
}I.cols=L;
if(this.getRowClass){V[2]=this.getRowClass(K,J,I,M)
}I.alt=V.join(" ");
I.cells=N.join("");
T[T.length]=F.apply(I)
}return T.join("")
},processRows:function(B,F){if(!this.ds||this.ds.getCount()<1){return 
}var E=this.getRows(),A=E.length,C,D;
F=F||!this.grid.stripeRows;
B=B||0;
for(C=0;
C<A;
C++){D=E[C];
if(D){D.rowIndex=C;
if(!F){D.className=D.className.replace(this.rowClsRe," ");
if((C+1)%2===0){D.className+=" x-grid3-row-alt"
}}}}if(B===0){CQ.Ext.fly(E[0]).addClass(this.firstRowCls)
}CQ.Ext.fly(E[E.length-1]).addClass(this.lastRowCls)
},afterRender:function(){if(!this.ds||!this.cm){return 
}this.mainBody.dom.innerHTML=this.renderRows()||"&#160;";
this.processRows(0,true);
if(this.deferEmptyText!==true){this.applyEmptyText()
}this.grid.fireEvent("viewready",this.grid)
},renderUI:function(){var D=this.renderHeaders();
var A=this.templates.body.apply({rows:"&#160;"});
var B=this.templates.master.apply({body:A,header:D,ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"});
var C=this.grid;
C.getGridEl().dom.innerHTML=B;
this.initElements();
CQ.Ext.fly(this.innerHd).on("click",this.handleHdDown,this);
this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});
this.scroller.on("scroll",this.syncScroll,this);
if(C.enableColumnResize!==false){this.splitZone=new CQ.Ext.grid.GridView.SplitDragZone(C,this.mainHd.dom)
}if(C.enableColumnMove){this.columnDrag=new CQ.Ext.grid.GridView.ColumnDragZone(C,this.innerHd);
this.columnDrop=new CQ.Ext.grid.HeaderDropZone(C,this.mainHd.dom)
}if(C.enableHdMenu!==false){this.hmenu=new CQ.Ext.menu.Menu({id:C.id+"-hctx"});
this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});
if(C.enableColumnHide!==false){this.colMenu=new CQ.Ext.menu.Menu({id:C.id+"-hcols-menu"});
this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})
}this.hmenu.on("itemclick",this.handleHdMenuClick,this)
}if(C.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})
}if(C.enableDragDrop||C.enableDrag){this.dragZone=new CQ.Ext.grid.GridDragZone(C,{ddGroup:C.ddGroup||"GridDD"})
}this.updateHeaderSortState()
},processEvent:CQ.Ext.emptyFn,layout:function(){if(!this.mainBody){return 
}var C=this.grid;
var F=C.getGridEl();
var A=F.getSize(true);
var B=A.width;
if(!C.hideHeaders&&(B<20||A.height<20)){return 
}if(C.autoHeight){this.scroller.dom.style.overflow="visible";
if(CQ.Ext.isWebKit){this.scroller.dom.style.position="static"
}}else{this.el.setSize(A.width,A.height);
var E=this.mainHd.getHeight();
var D=A.height-(E);
this.scroller.setSize(B,D);
if(this.innerHd){this.innerHd.style.width=(B)+"px"
}}if(this.forceFit){if(this.lastViewWidth!=B){this.fitColumns(false,false);
this.lastViewWidth=B
}}else{this.autoExpand();
this.syncHeaderScroll()
}this.onLayout(B,D)
},onLayout:function(A,B){},onColumnWidthUpdated:function(C,A,B){},onAllColumnWidthsUpdated:function(A,B){},onColumnHiddenUpdated:function(B,C,A){},updateColumnText:function(A,B){},afterMove:function(A){},init:function(A){this.grid=A;
this.initTemplates();
this.initData(A.store,A.colModel);
this.initUI(A)
},getColumnId:function(A){return this.cm.getColumnId(A)
},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+"px"
},getScrollOffset:function(){return CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth())
},renderHeaders:function(){var C=this.cm,G=this.templates,E=G.hcell,B=[],H={},A=C.getColumnCount(),F=A-1;
for(var D=0;
D<A;
D++){H.id=C.getColumnId(D);
H.value=C.getColumnHeader(D)||"";
H.style=this.getColumnStyle(D,true);
H.tooltip=this.getColumnTooltip(D);
H.css=D===0?"x-grid3-cell-first ":(D==F?"x-grid3-cell-last ":"");
if(C.config[D].align=="right"){H.istyle="padding-right:16px"
}else{delete H.istyle
}B[B.length]=E.apply(H)
}return G.header.apply({cells:B.join(""),tstyle:"width:"+this.getTotalWidth()+";"})
},getColumnTooltip:function(A){var B=this.cm.getColumnTooltip(A);
if(B){if(CQ.Ext.QuickTips.isEnabled()){return'ext:qtip="'+B+'"'
}else{return'title="'+B+'"'
}}return""
},beforeUpdate:function(){this.grid.stopEditing(true)
},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth()
},focusRow:function(A){this.focusCell(A,0,false)
},focusCell:function(C,A,B){this.syncFocusEl(this.ensureVisible(C,A,B));
if(CQ.Ext.isGecko){this.focusEl.focus()
}else{this.focusEl.focus.defer(1,this.focusEl)
}},resolveCell:function(G,D,F){if(!CQ.Ext.isNumber(G)){G=G.rowIndex
}if(!this.ds){return null
}if(G<0||G>=this.ds.getCount()){return null
}D=(D!==undefined?D:0);
var C=this.getRow(G),A=this.cm,E=A.getColumnCount(),B;
if(!(F===false&&D===0)){while(D<E&&A.isHidden(D)){D++
}B=this.getCell(G,D)
}return{row:C,cell:B}
},getResolvedXY:function(A){if(!A){return null
}var B=this.scroller.dom,D=A.cell,C=A.row;
return D?CQ.Ext.fly(D).getXY():[this.el.getX(),CQ.Ext.fly(C).getY()]
},syncFocusEl:function(D,A,C){var B=D;
if(!CQ.Ext.isArray(B)){D=Math.min(D,Math.max(0,this.getRows().length-1));
B=this.getResolvedXY(this.resolveCell(D,A,C))
}this.focusEl.setXY(B||this.scroller.getXY())
},ensureVisible:function(Q,E,D){var O=this.resolveCell(Q,E,D);
if(!O||!O.row){return 
}var I=O.row,F=O.cell,L=this.scroller.dom,P=0,C=I,M=this.el.dom;
while(C&&C!=M){P+=C.offsetTop;
C=C.offsetParent
}P-=this.mainHd.dom.offsetHeight;
M=parseInt(L.scrollTop,10);
var N=P+I.offsetHeight,A=L.clientHeight,K=M+A;
if(P<M){L.scrollTop=P
}else{if(N>K){L.scrollTop=N-A
}}if(D!==false){var J=parseInt(F.offsetLeft,10);
var H=J+F.offsetWidth;
var G=parseInt(L.scrollLeft,10);
var B=G+L.clientWidth;
if(J<G){L.scrollLeft=J
}else{if(H>B){L.scrollLeft=H-L.clientWidth
}}}return this.getResolvedXY(O)
},insertRows:function(A,H,E,G){var D=A.getCount()-1;
if(!G&&H===0&&E>=D){this.fireEvent("beforerowsinserted",this,H,E);
this.refresh();
this.fireEvent("rowsinserted",this,H,E)
}else{if(!G){this.fireEvent("beforerowsinserted",this,H,E)
}var B=this.renderRows(H,E),F=this.getRow(H);
if(F){if(H===0){CQ.Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)
}CQ.Ext.DomHelper.insertHtml("beforeBegin",F,B)
}else{var C=this.getRow(D-1);
if(C){CQ.Ext.fly(C).removeClass(this.lastRowCls)
}CQ.Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,B)
}if(!G){this.fireEvent("rowsinserted",this,H,E);
this.processRows(H)
}else{if(H===0||H>=D){CQ.Ext.fly(this.getRow(H)).addClass(H===0?this.firstRowCls:this.lastRowCls)
}}}this.syncFocusEl(H)
},deleteRows:function(A,C,B){if(A.getRowCount()<1){this.refresh()
}else{this.fireEvent("beforerowsdeleted",this,C,B);
this.removeRows(C,B);
this.processRows(C);
this.fireEvent("rowsdeleted",this,C,B)
}},getColumnStyle:function(A,C){var B=!C?(this.cm.config[A].css||""):"";
B+="width:"+this.getColumnWidth(A)+";";
if(this.cm.isHidden(A)){B+="display:none;"
}var D=this.cm.config[A].align;
if(D){B+="text-align:"+D+";"
}return B
},getColumnWidth:function(B){var A=this.cm.getColumnWidth(B);
if(CQ.Ext.isNumber(A)){return(CQ.Ext.isBorderBox||(CQ.Ext.isWebKit&&!CQ.Ext.isSafari2)?A:(A-this.borderWidth>0?A-this.borderWidth:0))+"px"
}return A
},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"
},fitColumns:function(D,G,H){var O=this.cm,I;
var J=O.getTotalWidth(false);
var A=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();
if(A<20){return 
}var E=A-J;
if(E===0){return false
}var K=O.getColumnCount(true);
var Q=K-(CQ.Ext.isNumber(H)?1:0);
if(Q===0){Q=1;
H=undefined
}var P=O.getColumnCount();
var M=[];
var L=0;
var C=0;
var N;
for(I=0;
I<P;
I++){if(!O.isHidden(I)&&!O.isFixed(I)&&I!==H){N=O.getColumnWidth(I);
M.push(I);
L=I;
M.push(N);
C+=N
}}var B=(A-O.getTotalWidth())/C;
while(M.length){N=M.pop();
I=M.pop();
O.setColumnWidth(I,Math.max(this.grid.minColumnWidth,Math.floor(N+N*B)),true)
}if((J=O.getTotalWidth(false))>A){var F=Q!=K?H:L;
O.setColumnWidth(F,Math.max(1,O.getColumnWidth(F)-(J-A)),true)
}if(D!==true){this.updateAllColumnWidths()
}return true
},autoExpand:function(B){var G=this.grid,A=this.cm;
if(!this.userResized&&G.autoExpandColumn){var D=A.getTotalWidth(false);
var H=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();
if(D!=H){var F=A.getIndexById(G.autoExpandColumn);
var E=A.getColumnWidth(F);
var C=Math.min(Math.max(((H-D)+E),G.autoExpandMin),G.autoExpandMax);
if(C!=E){A.setColumnWidth(F,C,true);
if(B!==true){this.updateColumnWidth(F,C)
}}}}},getColumnData:function(){var D=[],A=this.cm,E=A.getColumnCount();
for(var C=0;
C<E;
C++){var B=A.getDataIndex(C);
D[C]={name:(!CQ.Ext.isDefined(B)?this.ds.fields.get(C).name:B),renderer:A.getRenderer(C),scope:A.getRendererScope(C),id:A.getColumnId(C),style:this.getColumnStyle(C)}
}return D
},renderRows:function(H,C){var D=this.grid,F=D.colModel,A=D.store,I=D.stripeRows;
var G=F.getColumnCount();
if(A.getCount()<1){return""
}var E=this.getColumnData();
H=H||0;
C=!CQ.Ext.isDefined(C)?A.getCount()-1:C;
var B=A.getRange(H,C);
return this.doRender(E,B,A,H,G,I)
},renderBody:function(){var A=this.renderRows()||"&#160;";
return this.templates.body.apply({rows:A})
},refreshRow:function(A){var C=this.ds,B;
if(CQ.Ext.isNumber(A)){B=A;
A=C.getAt(B);
if(!A){return 
}}else{B=C.indexOf(A);
if(B<0){return 
}}this.insertRows(C,B,B,true);
this.getRow(B).rowIndex=B;
this.onRemove(C,A,B+1,true);
this.fireEvent("rowupdated",this,B,A)
},refresh:function(B){this.fireEvent("beforerefresh",this);
this.grid.stopEditing(true);
var A=this.renderBody();
this.mainBody.update(A).setWidth(this.getTotalWidth());
if(B===true){this.updateHeaders();
this.updateHeaderSortState()
}this.processRows(0,true);
this.layout();
this.applyEmptyText();
this.fireEvent("refresh",this)
},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")
}},updateHeaderSortState:function(){var B=this.ds.getSortState();
if(!B){return 
}if(!this.sortState||(this.sortState.field!=B.field||this.sortState.direction!=B.direction)){this.grid.fireEvent("sortchange",this.grid,B)
}this.sortState=B;
var C=this.cm.findColumnIndex(B.field);
if(C!=-1){var A=B.direction;
this.updateSortIcon(C,A)
}},clearHeaderSortState:function(){if(!this.sortState){return 
}this.grid.fireEvent("sortchange",this.grid,null);
this.mainHd.select("td").removeClass(this.sortClasses);
delete this.sortState
},destroy:function(){if(this.colMenu){CQ.Ext.menu.MenuMgr.unregister(this.colMenu);
this.colMenu.destroy();
delete this.colMenu
}if(this.hmenu){CQ.Ext.menu.MenuMgr.unregister(this.hmenu);
this.hmenu.destroy();
delete this.hmenu
}this.initData(null,null);
this.purgeListeners();
CQ.Ext.fly(this.innerHd).un("click",this.handleHdDown,this);
if(this.grid.enableColumnMove){CQ.Ext.destroy(this.columnDrag.el,this.columnDrag.proxy.ghost,this.columnDrag.proxy.el,this.columnDrop.el,this.columnDrop.proxyTop,this.columnDrop.proxyBottom,this.columnDrag.dragData.ddel,this.columnDrag.dragData.header);
if(this.columnDrag.proxy.anim){CQ.Ext.destroy(this.columnDrag.proxy.anim)
}delete this.columnDrag.proxy.ghost;
delete this.columnDrag.dragData.ddel;
delete this.columnDrag.dragData.header;
this.columnDrag.destroy();
delete CQ.Ext.dd.DDM.locationCache[this.columnDrag.id];
delete this.columnDrag._domRef;
delete this.columnDrop.proxyTop;
delete this.columnDrop.proxyBottom;
this.columnDrop.destroy();
delete CQ.Ext.dd.DDM.locationCache["gridHeader"+this.grid.getGridEl().id];
delete this.columnDrop._domRef;
delete CQ.Ext.dd.DDM.ids[this.columnDrop.ddGroup]
}if(this.splitZone){this.splitZone.destroy();
delete this.splitZone._domRef;
delete CQ.Ext.dd.DDM.ids["gridSplitters"+this.grid.getGridEl().id]
}CQ.Ext.fly(this.innerHd).removeAllListeners();
CQ.Ext.removeNode(this.innerHd);
delete this.innerHd;
CQ.Ext.destroy(this.el,this.mainWrap,this.mainHd,this.scroller,this.mainBody,this.focusEl,this.resizeMarker,this.resizeProxy,this.activeHdBtn,this.dragZone,this.splitZone,this._flyweight);
delete this.grid.container;
if(this.dragZone){this.dragZone.destroy()
}CQ.Ext.dd.DDM.currentTarget=null;
delete CQ.Ext.dd.DDM.locationCache[this.grid.getGridEl().id];
CQ.Ext.EventManager.removeResizeListener(this.onWindowResize,this)
},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var A=this.grid.ownerCt;
if(A&&A.getLayout()){A.on("afterlayout",function(){this.fitColumns(true,true);
this.updateHeaders()
},this,{single:true})
}else{this.fitColumns(true,true)
}}else{if(this.forceFit){this.fitColumns(true,false)
}else{if(this.grid.autoExpandColumn){this.autoExpand(true)
}}}this.renderUI()
},initData:function(B,A){if(this.ds){this.ds.un("load",this.onLoad,this);
this.ds.un("datachanged",this.onDataChange,this);
this.ds.un("add",this.onAdd,this);
this.ds.un("remove",this.onRemove,this);
this.ds.un("update",this.onUpdate,this);
this.ds.un("clear",this.onClear,this);
if(this.ds!==B&&this.ds.autoDestroy){this.ds.destroy()
}}if(B){B.on({scope:this,load:this.onLoad,datachanged:this.onDataChange,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.onClear})
}this.ds=B;
if(this.cm){this.cm.un("configchange",this.onColConfigChange,this);
this.cm.un("widthchange",this.onColWidthChange,this);
this.cm.un("headerchange",this.onHeaderChange,this);
this.cm.un("hiddenchange",this.onHiddenChange,this);
this.cm.un("columnmoved",this.onColumnMove,this)
}if(A){delete this.lastViewWidth;
A.on({scope:this,configchange:this.onColConfigChange,widthchange:this.onColWidthChange,headerchange:this.onHeaderChange,hiddenchange:this.onHiddenChange,columnmoved:this.onColumnMove})
}this.cm=A
},onDataChange:function(){this.refresh();
this.updateHeaderSortState();
this.syncFocusEl(0)
},onClear:function(){this.refresh();
this.syncFocusEl(0)
},onUpdate:function(B,A){this.refreshRow(A)
},onAdd:function(C,A,B){this.insertRows(C,B,B+(A.length-1))
},onRemove:function(D,A,B,C){if(C!==true){this.fireEvent("beforerowremoved",this,B,A)
}this.removeRow(B);
if(C!==true){this.processRows(B);
this.applyEmptyText();
this.fireEvent("rowremoved",this,B,A)
}},onLoad:function(){this.scrollToTop.defer(CQ.Ext.isGecko?1:0,this)
},onColWidthChange:function(A,B,C){this.updateColumnWidth(B,C)
},onHeaderChange:function(A,B,C){this.updateHeaders()
},onHiddenChange:function(A,B,C){this.updateColumnHidden(B,C)
},onColumnMove:function(A,D,B){this.indexMap=null;
var C=this.getScrollState();
this.refresh(true);
this.restoreScroll(C);
this.afterMove(B);
this.grid.fireEvent("columnmove",D,B)
},onColConfigChange:function(){delete this.lastViewWidth;
this.indexMap=null;
this.refresh(true)
},initUI:function(A){A.on("headerclick",this.onHeaderClick,this)
},initEvents:function(){},onHeaderClick:function(B,A){if(this.headersDisabled||!this.cm.isSortable(A)){return 
}B.stopEditing(true);
B.store.sort(this.cm.getDataIndex(A))
},onRowOver:function(B,A){var C;
if((C=this.findRowIndex(A))!==false){this.addRowClass(C,"x-grid3-row-over")
}},onRowOut:function(B,A){var C;
if((C=this.findRowIndex(A))!==false&&!B.within(this.getRow(C),true)){this.removeRowClass(C,"x-grid3-row-over")
}},handleWheel:function(A){A.stopPropagation()
},onRowSelect:function(A){this.addRowClass(A,this.selectedRowClass)
},onRowDeselect:function(A){this.removeRowClass(A,this.selectedRowClass)
},onCellSelect:function(C,B){var A=this.getCell(C,B);
if(A){this.fly(A).addClass("x-grid3-cell-selected")
}},onCellDeselect:function(C,B){var A=this.getCell(C,B);
if(A){this.fly(A).removeClass("x-grid3-cell-selected")
}},onColumnSplitterMoved:function(C,B){this.userResized=true;
var A=this.grid.colModel;
A.setColumnWidth(C,B,true);
if(this.forceFit){this.fitColumns(true,false,C);
this.updateAllColumnWidths()
}else{this.updateColumnWidth(C,B);
this.syncHeaderScroll()
}this.grid.fireEvent("columnresize",C,B)
},handleHdMenuClick:function(C){var B=this.hdCtxIndex,A=this.cm,D=this.ds,E=C.getItemId();
switch(E){case"asc":D.sort(A.getDataIndex(B),"ASC");
break;
case"desc":D.sort(A.getDataIndex(B),"DESC");
break;
default:B=A.getIndexById(E.substr(4));
if(B!=-1){if(C.checked&&A.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();
return false
}A.setHidden(B,C.checked)
}}return true
},isHideableColumn:function(A){return !A.hidden&&!A.fixed
},beforeColMenuShow:function(){var A=this.cm,C=A.getColumnCount();
this.colMenu.removeAll();
for(var B=0;
B<C;
B++){if(A.config[B].fixed!==true&&A.config[B].hideable!==false){this.colMenu.add(new CQ.Ext.menu.CheckItem({itemId:"col-"+A.getColumnId(B),text:A.getColumnHeader(B),checked:!A.isHidden(B),hideOnClick:false,disabled:A.config[B].hideable===false}))
}}},handleHdDown:function(F,D){if(CQ.Ext.fly(D).hasClass("x-grid3-hd-btn")){F.stopEvent();
var E=this.findHeaderCell(D);
CQ.Ext.fly(E).addClass("x-grid3-hd-menu-open");
var C=this.getCellIndex(E);
this.hdCtxIndex=C;
var B=this.hmenu.items,A=this.cm;
B.get("asc").setDisabled(!A.isSortable(C));
B.get("desc").setDisabled(!A.isSortable(C));
this.hmenu.on("hide",function(){CQ.Ext.fly(E).removeClass("x-grid3-hd-menu-open")
},this,{single:true});
this.hmenu.show(D,"tl-bl?")
}},handleHdOver:function(D,A){var C=this.findHeaderCell(A);
if(C&&!this.headersDisabled){this.activeHdRef=A;
this.activeHdIndex=this.getCellIndex(C);
var B=this.fly(C);
this.activeHdRegion=B.getRegion();
if(!this.cm.isMenuDisabled(this.activeHdIndex)){B.addClass("x-grid3-hd-over");
this.activeHdBtn=B.child(".x-grid3-hd-btn");
if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(C.firstChild.offsetHeight-1)+"px"
}}}},handleHdMove:function(G,D){var F=this.findHeaderCell(this.activeHdRef);
if(F&&!this.headersDisabled){var B=this.splitHandleWidth||5,E=this.activeHdRegion,A=G.getPageX(),C=F.style,H="";
if(this.grid.enableColumnResize!==false){if(A-E.left<=B&&this.cm.isResizable(this.activeHdIndex-1)){H=CQ.Ext.isAir?"move":CQ.Ext.isWebKit?"e-resize":"col-resize"
}else{if(E.right-A<=(!this.activeHdBtn?B:2)&&this.cm.isResizable(this.activeHdIndex)){H=CQ.Ext.isAir?"move":CQ.Ext.isWebKit?"w-resize":"col-resize"
}}}C.cursor=H
}},handleHdOut:function(C,A){var B=this.findHeaderCell(A);
if(B&&(!CQ.Ext.isIE||!C.within(B,true))){this.activeHdRef=null;
this.fly(B).removeClass("x-grid3-hd-over");
B.style.cursor=""
}},hasRows:function(){var A=this.mainBody.dom.firstChild;
return A&&A.nodeType==1&&A.className!="x-grid-empty"
},bind:function(A,B){this.initData(A,B)
}});
CQ.Ext.grid.GridView.SplitDragZone=function(A,B){this.grid=A;
this.view=A.getView();
this.marker=this.view.resizeMarker;
this.proxy=this.view.resizeProxy;
CQ.Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,B,"gridSplitters"+this.grid.getGridEl().id,{dragElId:CQ.Ext.id(this.proxy.dom),resizeFrame:false});
this.scroll=false;
this.hw=this.view.splitHandleWidth||5
};
CQ.Ext.extend(CQ.Ext.grid.GridView.SplitDragZone,CQ.Ext.dd.DDProxy,{b4StartDrag:function(A,E){this.view.headersDisabled=true;
var D=this.view.mainWrap.getHeight();
this.marker.setHeight(D);
this.marker.show();
this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);
this.proxy.setHeight(D);
var B=this.cm.getColumnWidth(this.cellIndex);
var C=Math.max(B-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(C,1000);
this.setYConstraint(0,0);
this.minX=A-C;
this.maxX=A+1000;
this.startPos=A;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,A,E)
},allowHeaderDrag:function(A){return true
},handleMouseDown:function(A){var G=this.view.findHeaderCell(A.getTarget());
if(G&&this.allowHeaderDrag(A)){var J=this.view.fly(G).getXY(),D=J[0],C=J[1];
var H=A.getXY(),B=H[0];
var F=G.offsetWidth,E=false;
if((B-D)<=this.hw){E=-1
}else{if((D+F)-B<=this.hw){E=0
}}if(E!==false){this.cm=this.grid.colModel;
var I=this.view.getCellIndex(G);
if(E==-1){if(I+E<0){return 
}while(this.cm.isHidden(I+E)){--E;
if(I+E<0){return 
}}}this.cellIndex=I+E;
this.split=G.dom;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){CQ.Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(A)
}}}},endDrag:function(D){this.marker.hide();
var A=this.view;
var B=Math.max(this.minX,D.getPageX());
var C=B-this.startPos;
A.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+C);
setTimeout(function(){A.headersDisabled=false
},50)
},autoOffset:function(){this.setDelta(0,0)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.HeaderDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{maxDragWidth:120,constructor:function(A,C,B){this.grid=A;
this.view=A.getView();
this.ddGroup="gridHeader"+this.grid.getGridEl().id;
CQ.Ext.grid.HeaderDragZone.superclass.constructor.call(this,C);
if(B){this.setHandleElId(CQ.Ext.id(C));
this.setOuterHandleElId(CQ.Ext.id(B))
}this.scroll=false
},getDragData:function(C){var A=CQ.Ext.lib.Event.getTarget(C);
var B=this.view.findHeaderCell(A);
if(B){return{ddel:B.firstChild,header:B}
}return false
},onInitDrag:function(A){this.view.headersDisabled=true;
var B=this.dragData.ddel.cloneNode(true);
B.id=CQ.Ext.id();
B.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";
this.proxy.update(B);
return true
},afterValidDrop:function(){var A=this.view;
setTimeout(function(){A.headersDisabled=false
},50)
},afterInvalidDrop:function(){var A=this.view;
setTimeout(function(){A.headersDisabled=false
},50)
}});
CQ.Ext.grid.HeaderDropZone=CQ.Ext.extend(CQ.Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:CQ.Ext.Element.fly,constructor:function(A,C,B){this.grid=A;
this.view=A.getView();
this.proxyTop=CQ.Ext.DomHelper.append(CQ.Util.getRoot(),{cls:"col-move-top",html:"&#160;"},true);
this.proxyBottom=CQ.Ext.DomHelper.append(CQ.Util.getRoot(),{cls:"col-move-bottom",html:"&#160;"},true);
this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);
this.setStyle("visibility","hidden")
};
this.ddGroup="gridHeader"+this.grid.getGridEl().id;
CQ.Ext.grid.HeaderDropZone.superclass.constructor.call(this,A.getGridEl().dom)
},getTargetFromEvent:function(C){var A=CQ.Ext.lib.Event.getTarget(C);
var B=this.view.findCellIndex(A);
if(B!==false){return this.view.getHeaderCell(B)
}},nextVisible:function(C){var B=this.view,A=this.grid.colModel;
C=C.nextSibling;
while(C){if(!A.isHidden(B.getCellIndex(C))){return C
}C=C.nextSibling
}return null
},prevVisible:function(C){var B=this.view,A=this.grid.colModel;
C=C.prevSibling;
while(C){if(!A.isHidden(B.getCellIndex(C))){return C
}C=C.prevSibling
}return null
},positionIndicator:function(D,H,G){var A=CQ.Ext.lib.Event.getPageX(G);
var E=CQ.Ext.lib.Dom.getRegion(H.firstChild);
var C,F,B=E.top+this.proxyOffsets[1];
if((E.right-A)<=(E.right-E.left)/2){C=E.right+this.view.borderWidth;
F="after"
}else{C=E.left;
F="before"
}if(this.grid.colModel.isFixed(this.view.getCellIndex(H))){return false
}C+=this.proxyOffsets[0];
this.proxyTop.setLeftTop(C,B);
this.proxyTop.show();
if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight()
}this.proxyBottom.setLeftTop(C,B+this.proxyTop.dom.offsetHeight+this.bottomOffset);
this.proxyBottom.show();
return F
},onNodeEnter:function(D,A,C,B){if(B.header!=D){this.positionIndicator(B.header,D,C)
}},onNodeOver:function(E,B,D,C){var A=false;
if(C.header!=E){A=this.positionIndicator(C.header,E,D)
}if(!A){this.proxyTop.hide();
this.proxyBottom.hide()
}return A?this.dropAllowed:this.dropNotAllowed
},onNodeOut:function(D,A,C,B){this.proxyTop.hide();
this.proxyBottom.hide()
},onNodeDrop:function(B,J,E,C){var D=C.header;
if(D!=B){var H=this.grid.colModel;
var G=CQ.Ext.lib.Event.getPageX(E);
var A=CQ.Ext.lib.Dom.getRegion(B.firstChild);
var K=(A.right-G)<=((A.right-A.left)/2)?"after":"before";
var F=this.view.getCellIndex(D);
var I=this.view.getCellIndex(B);
if(K=="after"){I++
}if(F<I){I--
}H.moveColumn(F,I);
return true
}return false
}});
CQ.Ext.grid.GridView.ColumnDragZone=CQ.Ext.extend(CQ.Ext.grid.HeaderDragZone,{constructor:function(A,B){CQ.Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,A,B,null);
this.proxy.el.addClass("x-grid3-col-dd")
},handleMouseDown:function(A){},callHandleMouseDown:function(A){CQ.Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,A)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.SplitDragZone=CQ.Ext.extend(CQ.Ext.dd.DDProxy,{fly:CQ.Ext.Element.fly,constructor:function(A,C,B){this.grid=A;
this.view=A.getView();
this.proxy=this.view.resizeProxy;
CQ.Ext.grid.SplitDragZone.superclass.constructor.call(this,C,"gridSplitters"+this.grid.getGridEl().id,{dragElId:CQ.Ext.id(this.proxy.dom),resizeFrame:false});
this.setHandleElId(CQ.Ext.id(C));
this.setOuterHandleElId(CQ.Ext.id(B));
this.scroll=false
},b4StartDrag:function(A,D){this.view.headersDisabled=true;
this.proxy.setHeight(this.view.mainWrap.getHeight());
var B=this.cm.getColumnWidth(this.cellIndex);
var C=Math.max(B-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(C,1000);
this.setYConstraint(0,0);
this.minX=A-C;
this.maxX=A+1000;
this.startPos=A;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,A,D)
},handleMouseDown:function(C){var B=CQ.Ext.EventObject.setEvent(C);
var A=this.fly(B.getTarget());
if(A.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(A.dom);
this.split=A.dom;
this.cm=this.grid.colModel;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){CQ.Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}}},endDrag:function(C){this.view.headersDisabled=false;
var A=Math.max(this.minX,CQ.Ext.lib.Event.getPageX(C));
var B=A-this.startPos;
this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+B)
},autoOffset:function(){this.setDelta(0,0)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.GridDragZone=function(B,A){this.view=B.getView();
CQ.Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,A);
this.scroll=false;
this.grid=B;
this.ddel=document.createElement("div");
this.ddel.className="x-grid-dd-wrap"
};
CQ.Ext.extend(CQ.Ext.grid.GridDragZone,CQ.Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(B){var A=CQ.Ext.lib.Event.getTarget(B);
var D=this.view.findRowIndex(A);
if(D!==false){var C=this.grid.selModel;
if(!C.isSelected(D)||B.hasModifier()){C.handleMouseDown(this.grid,D,B)
}return{grid:this.grid,ddel:this.ddel,rowIndex:D,selections:C.getSelections()}
}return false
},onInitDrag:function(B){var A=this.dragData;
this.ddel.innerHTML=this.grid.getDragDropText();
this.proxy.update(this.ddel)
},afterRepair:function(){this.dragging=false
},getRepairXY:function(B,A){return false
},onEndDrag:function(A,B){},onValidDrop:function(A,B,C){this.hideProxy()
},beforeInvalidDrop:function(A,B){}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.ColumnModel=CQ.Ext.extend(CQ.Ext.util.Observable,{defaultWidth:100,defaultSortable:false,constructor:function(A){if(A.columns){CQ.Ext.apply(this,A);
this.setConfig(A.columns,true)
}else{this.setConfig(A,true)
}this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");
CQ.Ext.grid.ColumnModel.superclass.constructor.call(this)
},getColumnId:function(A){return this.config[A].id
},getColumnAt:function(A){return this.config[A]
},setConfig:function(C,B){var D,F,A;
if(!B){delete this.totalWidth;
for(D=0,A=this.config.length;
D<A;
D++){this.config[D].destroy()
}}this.defaults=CQ.Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);
this.config=C;
this.lookup={};
for(D=0,A=C.length;
D<A;
D++){F=CQ.Ext.applyIf(C[D],this.defaults);
if(CQ.Ext.isEmpty(F.id)){F.id=D
}if(!F.isColumn){var E=CQ.Ext.grid.Column.types[F.xtype||"gridcolumn"];
F=new E(F);
C[D]=F
}this.lookup[F.id]=F
}if(!B){this.fireEvent("configchange",this)
}},getColumnById:function(A){return this.lookup[A]
},getIndexById:function(C){for(var B=0,A=this.config.length;
B<A;
B++){if(this.config[B].id==C){return B
}}return -1
},moveColumn:function(C,A){var B=this.config[C];
this.config.splice(C,1);
this.config.splice(A,0,B);
this.dataMap=null;
this.fireEvent("columnmoved",this,C,A)
},getColumnCount:function(C){if(C===true){var D=0;
for(var B=0,A=this.config.length;
B<A;
B++){if(!this.isHidden(B)){D++
}}return D
}return this.config.length
},getColumnsBy:function(D,C){var E=[];
for(var B=0,A=this.config.length;
B<A;
B++){var F=this.config[B];
if(D.call(C||this,F,B)===true){E[E.length]=F
}}return E
},isSortable:function(A){return !!this.config[A].sortable
},isMenuDisabled:function(A){return !!this.config[A].menuDisabled
},getRenderer:function(A){if(!this.config[A].renderer){return CQ.Ext.grid.ColumnModel.defaultRenderer
}return this.config[A].renderer
},getRendererScope:function(A){return this.config[A].scope
},setRenderer:function(A,B){this.config[A].renderer=B
},getColumnWidth:function(A){return this.config[A].width
},setColumnWidth:function(B,C,A){this.config[B].width=C;
this.totalWidth=null;
if(!A){this.fireEvent("widthchange",this,B,C)
}},getTotalWidth:function(B){if(!this.totalWidth){this.totalWidth=0;
for(var C=0,A=this.config.length;
C<A;
C++){if(B||!this.isHidden(C)){this.totalWidth+=this.getColumnWidth(C)
}}}return this.totalWidth
},getColumnHeader:function(A){return this.config[A].header
},setColumnHeader:function(A,B){this.config[A].header=B;
this.fireEvent("headerchange",this,A,B)
},getColumnTooltip:function(A){return this.config[A].tooltip
},setColumnTooltip:function(A,B){this.config[A].tooltip=B
},getDataIndex:function(A){return this.config[A].dataIndex
},setDataIndex:function(A,B){this.config[A].dataIndex=B
},findColumnIndex:function(C){var D=this.config;
for(var B=0,A=D.length;
B<A;
B++){if(D[B].dataIndex==C){return B
}}return -1
},isCellEditable:function(B,D){var C=this.config[B],A=C.editable;
return !!(A||(!CQ.Ext.isDefined(A)&&C.editor))
},getCellEditor:function(A,B){return this.config[A].getCellEditor(B)
},setEditable:function(A,B){this.config[A].editable=B
},isHidden:function(A){return !!this.config[A].hidden
},isFixed:function(A){return !!this.config[A].fixed
},isResizable:function(A){return A>=0&&this.config[A].resizable!==false&&this.config[A].fixed!==true
},setHidden:function(A,B){var C=this.config[A];
if(C.hidden!==B){C.hidden=B;
this.totalWidth=null;
this.fireEvent("hiddenchange",this,A,B)
}},setEditor:function(A,B){this.config[A].setEditor(B)
},destroy:function(){for(var B=0,A=this.config.length;
B<A;
B++){this.config[B].destroy()
}this.purgeListeners()
}});
CQ.Ext.grid.ColumnModel.defaultRenderer=function(A){if(typeof A=="string"&&A.length<1){return"&#160;"
}return A
};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.AbstractSelectionModel=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(){this.locked=false;
CQ.Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)
},init:function(A){this.grid=A;
this.initEvents()
},lock:function(){this.locked=true
},unlock:function(){this.locked=false
},isLocked:function(){return this.locked
},destroy:function(){this.purgeListeners()
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.RowSelectionModel=CQ.Ext.extend(CQ.Ext.grid.AbstractSelectionModel,{singleSelect:false,constructor:function(A){CQ.Ext.apply(this,A);
this.selections=new CQ.Ext.util.MixedCollection(false,function(B){return B.id
});
this.last=false;
this.lastActive=false;
this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");
CQ.Ext.grid.RowSelectionModel.superclass.constructor.call(this)
},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)
}this.rowNav=new CQ.Ext.KeyNav(this.grid.getGridEl(),{up:function(B){if(!B.shiftKey||this.singleSelect){this.selectPrevious(false)
}else{if(this.last!==false&&this.lastActive!==false){var A=this.last;
this.selectRange(this.last,this.lastActive-1);
this.grid.getView().focusRow(this.lastActive);
if(A!==false){this.last=A
}}else{this.selectFirstRow()
}}},down:function(B){if(!B.shiftKey||this.singleSelect){this.selectNext(false)
}else{if(this.last!==false&&this.lastActive!==false){var A=this.last;
this.selectRange(this.last,this.lastActive+1);
this.grid.getView().focusRow(this.lastActive);
if(A!==false){this.last=A
}}else{this.selectFirstRow()
}}},scope:this});
this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove})
},onRefresh:function(){var F=this.grid.store,B;
var D=this.getSelections();
this.clearSelections(true);
for(var C=0,A=D.length;
C<A;
C++){var E=D[C];
if((B=F.indexOfId(E.id))!=-1){this.selectRow(B,true)
}}if(D.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)
}},onRemove:function(A,B,C){if(this.selections.remove(C)!==false){this.fireEvent("selectionchange",this)
}},onRowUpdated:function(A,B,C){if(this.isSelected(C)){A.onRowSelect(B)
}},selectRecords:function(B,E){if(!E){this.clearSelections()
}var D=this.grid.store;
for(var C=0,A=B.length;
C<A;
C++){this.selectRow(D.indexOf(B[C]),true)
}},getCount:function(){return this.selections.length
},selectFirstRow:function(){this.selectRow(0)
},selectLastRow:function(A){this.selectRow(this.grid.store.getCount()-1,A)
},selectNext:function(A){if(this.hasNext()){this.selectRow(this.last+1,A);
this.grid.getView().focusRow(this.last);
return true
}return false
},selectPrevious:function(A){if(this.hasPrevious()){this.selectRow(this.last-1,A);
this.grid.getView().focusRow(this.last);
return true
}return false
},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount()
},hasPrevious:function(){return !!this.last
},getSelections:function(){return[].concat(this.selections.items)
},getSelected:function(){return this.selections.itemAt(0)
},each:function(E,D){var C=this.getSelections();
for(var B=0,A=C.length;
B<A;
B++){if(E.call(D||this,C[B],B)===false){return false
}}return true
},clearSelections:function(A){if(this.isLocked()){return 
}if(A!==true){var C=this.grid.store;
var B=this.selections;
B.each(function(D){this.deselectRow(C.indexOfId(D.id))
},this);
B.clear()
}else{this.selections.clear()
}this.last=false
},selectAll:function(){if(this.isLocked()){return 
}this.selections.clear();
for(var B=0,A=this.grid.store.getCount();
B<A;
B++){this.selectRow(B,true)
}},hasSelection:function(){return this.selections.length>0
},isSelected:function(A){var B=CQ.Ext.isNumber(A)?this.grid.store.getAt(A):A;
return(B&&this.selections.key(B.id)?true:false)
},isIdSelected:function(A){return(this.selections.key(A)?true:false)
},handleMouseDown:function(D,F,E){if(E.button!==0||this.isLocked()){return 
}var A=this.grid.getView();
if(E.shiftKey&&!this.singleSelect&&this.last!==false){var C=this.last;
this.selectRange(C,F,E.ctrlKey);
this.last=C;
A.focusRow(F)
}else{var B=this.isSelected(F);
if(E.ctrlKey&&B){this.deselectRow(F)
}else{if(!B||this.getCount()>1){this.selectRow(F,E.ctrlKey||E.shiftKey);
A.focusRow(F)
}}}},selectRows:function(C,D){if(!D){this.clearSelections()
}for(var B=0,A=C.length;
B<A;
B++){this.selectRow(C[B],true)
}},selectRange:function(B,A,D){var C;
if(this.isLocked()){return 
}if(!D){this.clearSelections()
}if(B<=A){for(C=B;
C<=A;
C++){this.selectRow(C,true)
}}else{for(C=B;
C>=A;
C--){this.selectRow(C,true)
}}},deselectRange:function(C,B,A){if(this.isLocked()){return 
}for(var D=C;
D<=B;
D++){this.deselectRow(D,A)
}},selectRow:function(B,D,A){if(this.isLocked()||(B<0||B>=this.grid.store.getCount())||(D&&this.isSelected(B))){return 
}var C=this.grid.store.getAt(B);
if(C&&this.fireEvent("beforerowselect",this,B,D,C)!==false){if(!D||this.singleSelect){this.clearSelections()
}this.selections.add(C);
this.last=this.lastActive=B;
if(!A){this.grid.getView().onRowSelect(B)
}this.fireEvent("rowselect",this,B,C);
this.fireEvent("selectionchange",this)
}},deselectRow:function(B,A){if(this.isLocked()){return 
}if(this.last==B){this.last=false
}if(this.lastActive==B){this.lastActive=false
}var C=this.grid.store.getAt(B);
if(C){this.selections.remove(C);
if(!A){this.grid.getView().onRowDeselect(B)
}this.fireEvent("rowdeselect",this,B,C);
this.fireEvent("selectionchange",this)
}},restoreLast:function(){if(this._last){this.last=this._last
}},acceptsNav:function(C,B,A){return !A.isHidden(B)&&A.isCellEditable(B,C)
},onEditorKey:function(I,G){var C=G.getKey(),D,E=this.grid,J=E.lastEdit,F=E.activeEditor,K,J,A,H;
var B=G.shiftKey;
if(C==G.TAB){G.stopEvent();
F.completeEdit();
if(B){D=E.walkCells(F.row,F.col-1,-1,this.acceptsNav,this)
}else{D=E.walkCells(F.row,F.col+1,1,this.acceptsNav,this)
}}else{if(C==G.ENTER){if(this.moveEditorOnEnter!==false){if(B){D=E.walkCells(J.row-1,J.col,-1,this.acceptsNav,this)
}else{D=E.walkCells(J.row+1,J.col,1,this.acceptsNav,this)
}}}}if(D){A=D[0];
H=D[1];
if(J.row!=A){this.selectRow(A)
}if(E.isEditor&&E.editing){K=E.activeEditor;
if(K&&K.field.triggerBlur){K.field.triggerBlur()
}}E.startEditing(A,H)
}},destroy:function(){if(this.rowNav){this.rowNav.disable();
this.rowNav=null
}CQ.Ext.grid.RowSelectionModel.superclass.destroy.call(this)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.Column=CQ.Ext.extend(Object,{isColumn:true,constructor:function(B){CQ.Ext.apply(this,B);
if(CQ.Ext.isString(this.renderer)){this.renderer=CQ.Ext.util.Format[this.renderer]
}else{if(CQ.Ext.isObject(this.renderer)){this.scope=this.renderer.scope;
this.renderer=this.renderer.fn
}}if(!this.scope){this.scope=this
}var A=this.editor;
delete this.editor;
this.setEditor(A)
},renderer:function(A){if(CQ.Ext.isString(A)&&A.length<1){return"&#160;"
}return A
},getEditor:function(A){return this.editable!==false?this.editor:null
},setEditor:function(A){if(this.editor){this.editor.destroy()
}this.editor=null;
if(A){if(!A.isXType){A=CQ.Ext.create(A,"textfield")
}if(!A.startEdit){A=new CQ.Ext.grid.GridEditor(A)
}this.editor=A
}},destroy:function(){this.setEditor(null)
},getCellEditor:function(A){return this.getEditor(A)
}});
CQ.Ext.grid.BooleanColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(A){CQ.Ext.grid.BooleanColumn.superclass.constructor.call(this,A);
var C=this.trueText,D=this.falseText,B=this.undefinedText;
this.renderer=function(E){if(E===undefined){return B
}if(!E||E==="false"){return D
}return C
}
}});
CQ.Ext.grid.NumberColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{format:"0,000.00",constructor:function(A){CQ.Ext.grid.NumberColumn.superclass.constructor.call(this,A);
this.renderer=CQ.Ext.util.Format.numberRenderer(this.format)
}});
CQ.Ext.grid.DateColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{format:"m/d/Y",constructor:function(A){CQ.Ext.grid.DateColumn.superclass.constructor.call(this,A);
this.renderer=CQ.Ext.util.Format.dateRenderer(this.format)
}});
CQ.Ext.grid.TemplateColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{constructor:function(A){CQ.Ext.grid.TemplateColumn.superclass.constructor.call(this,A);
var B=(!CQ.Ext.isPrimitive(this.tpl)&&this.tpl.compile)?this.tpl:new CQ.Ext.XTemplate(this.tpl);
this.renderer=function(D,E,C){return B.apply(C.data)
};
this.tpl=B
}});
CQ.Ext.grid.Column.types={gridcolumn:CQ.Ext.grid.Column,booleancolumn:CQ.Ext.grid.BooleanColumn,numbercolumn:CQ.Ext.grid.NumberColumn,datecolumn:CQ.Ext.grid.DateColumn,templatecolumn:CQ.Ext.grid.TemplateColumn};
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.RowNumberer=CQ.Ext.extend(Object,{header:"",width:23,sortable:false,constructor:function(A){CQ.Ext.apply(this,A);
if(this.rowspan){this.renderer=this.renderer.createDelegate(this)
}},fixed:true,menuDisabled:true,dataIndex:"",id:"numberer",rowspan:undefined,renderer:function(B,C,A,D){if(this.rowspan){C.cellAttr='rowspan="'+this.rowspan+'"'
}return D+1
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.CheckboxSelectionModel=CQ.Ext.extend(CQ.Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,dataIndex:"",id:"checker",constructor:function(){CQ.Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);
if(this.checkOnly){this.handleMouseDown=CQ.Ext.emptyFn
}},initEvents:function(){CQ.Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);
this.grid.on("render",function(){var A=this.grid.getView();
A.mainBody.on("mousedown",this.onMouseDown,this);
CQ.Ext.fly(A.innerHd).on("mousedown",this.onHdMouseDown,this)
},this)
},onMouseDown:function(C,B){if(C.button===0&&B.className=="x-grid3-row-checker"){C.stopEvent();
var D=C.getTarget(".x-grid3-row");
if(D){var A=D.rowIndex;
if(this.isSelected(A)){this.deselectRow(A)
}else{this.selectRow(A,true)
}}}},onHdMouseDown:function(C,A){if(A.className=="x-grid3-hd-checker"){C.stopEvent();
var B=CQ.Ext.fly(A.parentNode);
var D=B.hasClass("x-grid3-hd-checker-on");
if(D){B.removeClass("x-grid3-hd-checker-on");
this.clearSelections()
}else{B.addClass("x-grid3-hd-checker-on");
this.selectAll()
}}},renderer:function(B,C,A){return'<div class="x-grid3-row-checker">&#160;</div>'
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.CellSelectionModel=CQ.Ext.extend(CQ.Ext.grid.AbstractSelectionModel,{constructor:function(A){CQ.Ext.apply(this,A);
this.selection=null;
this.addEvents("beforecellselect","cellselect","selectionchange");
CQ.Ext.grid.CellSelectionModel.superclass.constructor.call(this)
},initEvents:function(){this.grid.on("cellmousedown",this.handleMouseDown,this);
this.grid.on(CQ.Ext.EventManager.useKeydown?"keydown":"keypress",this.handleKeyDown,this);
this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearSelections,beforerowsinserted:this.clearSelections});
if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)
}},beforeEdit:function(A){this.select(A.row,A.column,false,true,A.record)
},onRowUpdated:function(A,B,C){if(this.selection&&this.selection.record==C){A.onCellSelect(B,this.selection.cell[1])
}},onViewChange:function(){this.clearSelections(true)
},getSelectedCell:function(){return this.selection?this.selection.cell:null
},clearSelections:function(B){var A=this.selection;
if(A){if(B!==true){this.grid.view.onCellDeselect(A.cell[0],A.cell[1])
}this.selection=null;
this.fireEvent("selectionchange",this,null)
}},hasSelection:function(){return this.selection?true:false
},handleMouseDown:function(B,D,A,C){if(C.button!==0||this.isLocked()){return 
}this.select(D,A)
},select:function(F,C,B,E,D){if(this.fireEvent("beforecellselect",this,F,C)!==false){this.clearSelections();
D=D||this.grid.store.getAt(F);
this.selection={record:D,cell:[F,C]};
if(!B){var A=this.grid.getView();
A.onCellSelect(F,C);
if(E!==true){A.focusCell(F,C)
}}this.fireEvent("cellselect",this,F,C);
this.fireEvent("selectionchange",this,this.selection)
}},isSelectable:function(C,B,A){return !A.isHidden(B)
},onEditorKey:function(B,A){if(A.getKey()==A.TAB){this.handleKeyDown(A)
}},handleKeyDown:function(F){if(!F.isNavKeyPress()){return 
}var C=F.getKey(),E=this.grid,K=this.selection,B=this,H=function(N,L,M){return E.walkCells(N,L,M,E.isEditor&&E.editing?B.acceptsNav:B.isSelectable,B)
},J,D,A,G,I;
switch(C){case F.ESC:case F.PAGE_UP:case F.PAGE_DOWN:break;
default:F.stopEvent();
break
}if(!K){J=H(0,0,1);
if(J){this.select(J[0],J[1])
}return 
}J=K.cell;
A=J[0];
G=J[1];
switch(C){case F.TAB:if(F.shiftKey){D=H(A,G-1,-1)
}else{D=H(A,G+1,1)
}break;
case F.DOWN:D=H(A+1,G,1);
break;
case F.UP:D=H(A-1,G,-1);
break;
case F.RIGHT:D=H(A,G+1,1);
break;
case F.LEFT:D=H(A,G-1,-1);
break;
case F.ENTER:if(E.isEditor&&!E.editing){E.startEditing(A,G);
return 
}break
}if(D){A=D[0];
G=D[1];
this.select(A,G);
if(E.isEditor&&E.editing){I=E.activeEditor;
if(I&&I.field.triggerBlur){I.field.triggerBlur()
}E.startEditing(A,G)
}}},acceptsNav:function(C,B,A){return !A.isHidden(B)&&A.isCellEditable(B,C)
}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.EditorGridPanel=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{clicksToEdit:2,forceValidation:false,isEditor:true,detectEdit:false,autoEncode:false,trackMouseOver:false,initComponent:function(){CQ.Ext.grid.EditorGridPanel.superclass.initComponent.call(this);
if(!this.selModel){this.selModel=new CQ.Ext.grid.CellSelectionModel()
}this.activeEditor=null;
this.addEvents("beforeedit","afteredit","validateedit")
},initEvents:function(){CQ.Ext.grid.EditorGridPanel.superclass.initEvents.call(this);
this.getGridEl().on("mousewheel",this.stopEditing.createDelegate(this,[true]),this);
this.on("columnresize",this.stopEditing,this,[true]);
if(this.clicksToEdit==1){this.on("cellclick",this.onCellDblClick,this)
}else{var A=this.getView();
if(this.clicksToEdit=="auto"&&A.mainBody){A.mainBody.on("mousedown",this.onAutoEditClick,this)
}this.on("celldblclick",this.onCellDblClick,this)
}},onResize:function(){CQ.Ext.grid.EditorGridPanel.superclass.onResize.apply(this,arguments);
var A=this.activeEditor;
if(this.editing&&A){A.realign(true)
}},onCellDblClick:function(B,C,A){this.startEditing(C,A)
},onAutoEditClick:function(C,B){if(C.button!==0){return 
}var E=this.view.findRowIndex(B),A=this.view.findCellIndex(B);
if(E!==false&&A!==false){this.stopEditing();
if(this.selModel.getSelectedCell){var D=this.selModel.getSelectedCell();
if(D&&D[0]===E&&D[1]===A){this.startEditing(E,A)
}}else{if(this.selModel.isSelected(E)){this.startEditing(E,A)
}}}},onEditComplete:function(B,D,A){this.editing=false;
this.activeEditor=null;
var C=B.record,F=this.colModel.getDataIndex(B.col);
D=this.postEditValue(D,A,C,F);
if(this.forceValidation===true||String(D)!==String(A)){var E={grid:this,record:C,field:F,originalValue:A,value:D,row:B.row,column:B.col,cancel:false};
if(this.fireEvent("validateedit",E)!==false&&!E.cancel&&String(D)!==String(A)){C.set(F,E.value);
delete E.cancel;
this.fireEvent("afteredit",E)
}}this.view.focusCell(B.row,B.col)
},startEditing:function(G,C){this.stopEditing();
if(this.colModel.isCellEditable(C,G)){this.view.ensureVisible(G,C,true);
var D=this.store.getAt(G),F=this.colModel.getDataIndex(C),E={grid:this,record:D,field:F,value:D.data[F],row:G,column:C,cancel:false};
if(this.fireEvent("beforeedit",E)!==false&&!E.cancel){this.editing=true;
var B=this.colModel.getCellEditor(C,G);
if(!B){return 
}if(!B.rendered){B.parentEl=this.view.getEditorParent(B);
B.on({scope:this,render:{fn:function(H){H.field.focus(false,true)
},single:true,scope:this},specialkey:function(I,H){this.getSelectionModel().onEditorKey(I,H)
},complete:this.onEditComplete,canceledit:this.stopEditing.createDelegate(this,[true])})
}CQ.Ext.apply(B,{row:G,col:C,record:D});
this.lastEdit={row:G,col:C};
this.activeEditor=B;
B.selectSameEditor=(this.activeEditor==this.lastActiveEditor);
var A=this.preEditValue(D,F);
B.startEdit(this.view.getCell(G,C).firstChild,CQ.Ext.isDefined(A)?A:"");
(function(){delete B.selectSameEditor
}).defer(50)
}}},preEditValue:function(A,C){var B=A.data[C];
return this.autoEncode&&CQ.Ext.isString(B)?CQ.Ext.util.Format.htmlDecode(B):B
},postEditValue:function(C,A,B,D){return this.autoEncode&&CQ.Ext.isString(C)?CQ.Ext.util.Format.htmlEncode(C):C
},stopEditing:function(B){if(this.editing){var A=this.lastActiveEditor=this.activeEditor;
if(A){A[B===true?"cancelEdit":"completeEdit"]();
this.view.focusCell(A.row,A.col)
}this.activeEditor=null
}this.editing=false
}});
CQ.Ext.reg("editorgrid",CQ.Ext.grid.EditorGridPanel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.GridEditor=function(B,A){CQ.Ext.grid.GridEditor.superclass.constructor.call(this,B,A);
B.monitorTab=false
};
CQ.Ext.extend(CQ.Ext.grid.GridEditor,CQ.Ext.Editor,{alignment:"tl-tl",autoSize:"width",hideEl:false,cls:"x-small-editor x-grid-editor",shim:false,shadow:false});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.PropertyRecord=CQ.Ext.data.Record.create([{name:"name",type:"string"},"value"]);
CQ.Ext.grid.PropertyStore=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(A,B){this.grid=A;
this.store=new CQ.Ext.data.Store({recordType:CQ.Ext.grid.PropertyRecord});
this.store.on("update",this.onUpdate,this);
if(B){this.setSource(B)
}CQ.Ext.grid.PropertyStore.superclass.constructor.call(this)
},setSource:function(C){this.source=C;
this.store.removeAll();
var B=[];
for(var A in C){if(this.isEditableValue(C[A])){B.push(new CQ.Ext.grid.PropertyRecord({name:A,value:C[A]},A))
}}this.store.loadRecords({records:B},{},true)
},onUpdate:function(E,A,D){if(D==CQ.Ext.data.Record.EDIT){var B=A.data.value;
var C=A.modified.value;
if(this.grid.fireEvent("beforepropertychange",this.source,A.id,B,C)!==false){this.source[A.id]=B;
A.commit();
this.grid.fireEvent("propertychange",this.source,A.id,B,C)
}else{A.reject()
}}},getProperty:function(A){return this.store.getAt(A)
},isEditableValue:function(A){return CQ.Ext.isPrimitive(A)||CQ.Ext.isDate(A)
},setValue:function(D,C,A){var B=this.getRec(D);
if(B){B.set("value",C);
this.source[D]=C
}else{if(A){this.source[D]=C;
B=new CQ.Ext.grid.PropertyRecord({name:D,value:C},D);
this.store.add(B)
}}},remove:function(B){var A=this.getRec(B);
if(A){this.store.remove(A);
delete this.source[B]
}},getRec:function(A){return this.store.getById(A)
},getSource:function(){return this.source
}});
CQ.Ext.grid.PropertyColumnModel=CQ.Ext.extend(CQ.Ext.grid.ColumnModel,{nameText:"Name",valueText:"Value",dateFormat:"m/j/Y",trueText:"true",falseText:"false",constructor:function(C,B){var D=CQ.Ext.grid,E=CQ.Ext.form;
this.grid=C;
D.PropertyColumnModel.superclass.constructor.call(this,[{header:this.nameText,width:50,sortable:true,dataIndex:"name",id:"name",menuDisabled:true},{header:this.valueText,width:50,resizable:false,dataIndex:"value",id:"value",menuDisabled:true}]);
this.store=B;
var A=new E.Field({autoCreate:{tag:"select",children:[{tag:"option",value:"true",html:this.trueText},{tag:"option",value:"false",html:this.falseText}]},getValue:function(){return this.el.dom.value=="true"
}});
this.editors={date:new D.GridEditor(new E.DateField({selectOnFocus:true})),string:new D.GridEditor(new E.TextField({selectOnFocus:true})),number:new D.GridEditor(new E.NumberField({selectOnFocus:true,style:"text-align:left;"})),"boolean":new D.GridEditor(A,{autoSize:"both"})};
this.renderCellDelegate=this.renderCell.createDelegate(this);
this.renderPropDelegate=this.renderProp.createDelegate(this)
},renderDate:function(A){return A.dateFormat(this.dateFormat)
},renderBool:function(A){return this[A?"trueText":"falseText"]
},isCellEditable:function(A,B){return A==1
},getRenderer:function(A){return A==1?this.renderCellDelegate:this.renderPropDelegate
},renderProp:function(A){return this.getPropertyName(A)
},renderCell:function(D,B,C){var A=this.grid.customRenderers[C.get("name")];
if(A){return A.apply(this,arguments)
}var E=D;
if(CQ.Ext.isDate(D)){E=this.renderDate(D)
}else{if(typeof D=="boolean"){E=this.renderBool(D)
}}return CQ.Ext.util.Format.htmlEncode(E)
},getPropertyName:function(B){var A=this.grid.propertyNames;
return A&&A[B]?A[B]:B
},getCellEditor:function(A,E){var B=this.store.getProperty(E),D=B.data.name,C=B.data.value;
if(this.grid.customEditors[D]){return this.grid.customEditors[D]
}if(CQ.Ext.isDate(C)){return this.editors.date
}else{if(typeof C=="number"){return this.editors.number
}else{if(typeof C=="boolean"){return this.editors["boolean"]
}else{return this.editors.string
}}}},destroy:function(){CQ.Ext.grid.PropertyColumnModel.superclass.destroy.call(this);
for(var A in this.editors){CQ.Ext.destroy(this.editors[A])
}}});
CQ.Ext.grid.PropertyGrid=CQ.Ext.extend(CQ.Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},initComponent:function(){this.customRenderers=this.customRenderers||{};
this.customEditors=this.customEditors||{};
this.lastEditRow=null;
var B=new CQ.Ext.grid.PropertyStore(this);
this.propStore=B;
var A=new CQ.Ext.grid.PropertyColumnModel(this,B);
B.store.sort("name","ASC");
this.addEvents("beforepropertychange","propertychange");
this.cm=A;
this.ds=B.store;
CQ.Ext.grid.PropertyGrid.superclass.initComponent.call(this);
this.mon(this.selModel,"beforecellselect",function(E,D,C){if(C===0){this.startEditing.defer(200,this,[D,1]);
return false
}},this)
},onRender:function(){CQ.Ext.grid.PropertyGrid.superclass.onRender.apply(this,arguments);
this.getGridEl().addClass("x-props-grid")
},afterRender:function(){CQ.Ext.grid.PropertyGrid.superclass.afterRender.apply(this,arguments);
if(this.source){this.setSource(this.source)
}},setSource:function(A){this.propStore.setSource(A)
},getSource:function(){return this.propStore.getSource()
},setProperty:function(C,B,A){this.propStore.setValue(C,B,A)
},removeProperty:function(A){this.propStore.remove(A)
}});
CQ.Ext.reg("propertygrid",CQ.Ext.grid.PropertyGrid);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.Ext.grid.GroupingView=CQ.Ext.extend(CQ.Ext.grid.GridView,{groupByText:"Group By This Field",showGroupsText:"Show in Groups",hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:"(None)",ignoreAdd:false,groupTextTpl:"{text}",groupMode:"value",gidSeed:1000,initTemplates:function(){CQ.Ext.grid.GroupingView.superclass.initTemplates.call(this);
this.state={};
var A=this.grid.getSelectionModel();
A.on(A.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);
if(!this.startGroup){this.startGroup=new CQ.Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')
}this.startGroup.compile();
if(!this.endGroup){this.endGroup="</div></div>"
}this.endGroup="</div></div>"
},findGroup:function(A){return CQ.Ext.fly(A).up(".x-grid-group",this.mainBody.dom)
},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]
},onAdd:function(){if(this.canGroup()&&!this.ignoreAdd){var A=this.getScrollState();
this.refresh();
this.restoreScroll(A)
}else{if(!this.canGroup()){CQ.Ext.grid.GroupingView.superclass.onAdd.apply(this,arguments)
}}},onRemove:function(E,A,B,D){CQ.Ext.grid.GroupingView.superclass.onRemove.apply(this,arguments);
var C=document.getElementById(A._groupId);
if(C&&C.childNodes[1].childNodes.length<1){CQ.Ext.removeNode(C)
}this.applyEmptyText()
},refreshRow:function(A){if(this.ds.getCount()==1){this.refresh()
}else{this.isUpdating=true;
CQ.Ext.grid.GroupingView.superclass.refreshRow.apply(this,arguments);
this.isUpdating=false
}},beforeMenuShow:function(){var C,A=this.hmenu.items,B=this.cm.config[this.hdCtxIndex].groupable===false;
if((C=A.get("groupBy"))){C.setDisabled(B)
}if((C=A.get("showGroups"))){C.setDisabled(B);
C.setChecked(this.enableGrouping,true)
}},renderUI:function(){CQ.Ext.grid.GroupingView.superclass.renderUI.call(this);
this.mainBody.on("mousedown",this.interceptMouse,this);
if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});
if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})
}this.hmenu.on("beforeshow",this.beforeMenuShow,this)
}},processEvent:function(B,F){var E=F.getTarget(".x-grid-group-hd",this.mainBody);
if(E){var D=this.getGroupField(),C=this.getPrefix(D),A=E.id.substring(C.length);
A=A.substr(0,A.length-3);
if(A){this.grid.fireEvent("group"+B,this.grid,D,A,F)
}}},onGroupByClick:function(){this.enableGrouping=true;
this.grid.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));
this.grid.fireEvent("groupchange",this,this.grid.store.getGroupState());
this.beforeMenuShow();
this.refresh()
},onShowGroupsClick:function(A,B){this.enableGrouping=B;
if(B){this.onGroupByClick()
}else{this.grid.store.clearGrouping();
this.grid.fireEvent("groupchange",this,null)
}},toggleRowIndex:function(C,A){if(!this.canGroup()){return 
}var B=this.getRow(C);
if(B){this.toggleGroup(this.findGroup(B),A)
}},toggleGroup:function(C,B){var A=CQ.Ext.get(C);
B=CQ.Ext.isDefined(B)?B:A.hasClass("x-grid-group-collapsed");
if(this.state[A.id]!==B){this.grid.stopEditing(true);
this.state[A.id]=B;
A[B?"removeClass":"addClass"]("x-grid-group-collapsed")
}},toggleAllGroups:function(C){var B=this.getGroups();
for(var D=0,A=B.length;
D<A;
D++){this.toggleGroup(B[D],C)
}},expandAllGroups:function(){this.toggleAllGroups(true)
},collapseAllGroups:function(){this.toggleAllGroups(false)
},interceptMouse:function(B){var A=B.getTarget(".x-grid-group-hd",this.mainBody);
if(A){B.stopEvent();
this.toggleGroup(A.parentNode)
}},getGroup:function(A,D,F,G,B,E){var C=F?F(A,{},D,G,B,E):String(A);
if(C===""||C==="&#160;"){C=this.cm.config[B].emptyGroupText||this.emptyGroupText
}return C
},getGroupField:function(){return this.grid.store.getGroupState()
},afterRender:function(){if(!this.ds||!this.cm){return 
}CQ.Ext.grid.GroupingView.superclass.afterRender.call(this);
if(this.grid.deferRowRender){this.updateGroupWidths()
}},renderRows:function(){var A=this.getGroupField();
var E=!!A;
if(this.hideGroupedColumn){var B=this.cm.findColumnIndex(A),D=CQ.Ext.isDefined(this.lastGroupField);
if(!E&&D){this.mainBody.update("");
this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);
delete this.lastGroupField
}else{if(E&&!D){this.lastGroupField=A;
this.cm.setHidden(B,true)
}else{if(E&&D&&A!==this.lastGroupField){this.mainBody.update("");
var C=this.cm.findColumnIndex(this.lastGroupField);
this.cm.setHidden(C,false);
this.lastGroupField=A;
this.cm.setHidden(B,true)
}}}}return CQ.Ext.grid.GroupingView.superclass.renderRows.apply(this,arguments)
},doRender:function(C,F,N,A,M,O){if(F.length<1){return""
}if(!this.canGroup()||this.isUpdating){return CQ.Ext.grid.GroupingView.superclass.doRender.apply(this,arguments)
}var V=this.getGroupField(),L=this.cm.findColumnIndex(V),S,G="width:"+this.getTotalWidth()+";",E=this.cm.config[L],B=E.groupRenderer||E.renderer,P=this.showGroupName?(E.groupName||E.header)+": ":"",U=[],I,Q,R,K;
for(Q=0,R=F.length;
Q<R;
Q++){var H=A+Q,J=F[Q],D=J.data[V];
S=this.getGroup(D,J,B,H,L,N);
if(!I||I.group!=S){K=this.constructId(D,V,L);
this.state[K]=!(CQ.Ext.isDefined(this.state[K])?!this.state[K]:this.startCollapsed);
I={group:S,gvalue:D,text:P+S,groupId:K,startRow:H,rs:[J],cls:this.state[K]?"":"x-grid-group-collapsed",style:G};
U.push(I)
}else{I.rs.push(J)
}J._groupId=K
}var T=[];
for(Q=0,R=U.length;
Q<R;
Q++){S=U[Q];
this.doGroupStart(T,S,C,N,M);
T[T.length]=CQ.Ext.grid.GroupingView.superclass.doRender.call(this,C,S.rs,N,S.startRow,M,O);
this.doGroupEnd(T,S,C,N,M)
}return T.join("")
},getGroupId:function(A){var B=this.getGroupField();
return this.constructId(A,B,this.cm.findColumnIndex(B))
},constructId:function(C,E,A){var B=this.cm.config[A],D=B.groupRenderer||B.renderer,F=(this.groupMode=="value")?C:this.getGroup(C,{data:{}},D,0,A,this.ds);
return this.getPrefix(E)+CQ.Ext.util.Format.htmlEncode(F)
},canGroup:function(){return this.enableGrouping&&!!this.getGroupField()
},getPrefix:function(A){return this.grid.getGridEl().id+"-gp-"+A+"-"
},doGroupStart:function(A,D,B,E,C){A[A.length]=this.startGroup.apply(D)
},doGroupEnd:function(A,D,B,E,C){A[A.length]=this.endGroup
},getRows:function(){if(!this.canGroup()){return CQ.Ext.grid.GroupingView.superclass.getRows.call(this)
}var G=[];
var F,C=this.getGroups();
for(var E=0,A=C.length;
E<A;
E++){F=C[E].childNodes[1].childNodes;
for(var D=0,B=F.length;
D<B;
D++){G[G.length]=F[D]
}}return G
},updateGroupWidths:function(){if(!this.canGroup()||!this.hasRows()){return 
}var C=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.getScrollOffset())+"px";
var B=this.getGroups();
for(var D=0,A=B.length;
D<A;
D++){B[D].firstChild.style.width=C
}},onColumnWidthUpdated:function(C,A,B){CQ.Ext.grid.GroupingView.superclass.onColumnWidthUpdated.call(this,C,A,B);
this.updateGroupWidths()
},onAllColumnWidthsUpdated:function(A,B){CQ.Ext.grid.GroupingView.superclass.onAllColumnWidthsUpdated.call(this,A,B);
this.updateGroupWidths()
},onColumnHiddenUpdated:function(B,C,A){CQ.Ext.grid.GroupingView.superclass.onColumnHiddenUpdated.call(this,B,C,A);
this.updateGroupWidths()
},onLayout:function(){this.updateGroupWidths()
},onBeforeRowSelect:function(B,A){this.toggleRowIndex(A,true)
}});
CQ.Ext.grid.GroupingView.GROUP_ID=1000;
CQ.data.SlingStore=function(A){CQ.data.SlingStore.superclass.constructor.call(this,CQ.Ext.apply(A,{proxy:!A.data?new CQ.Ext.data.HttpProxy({url:A.url}):undefined,reader:new CQ.data.SlingReader(A)}))
};
CQ.Ext.extend(CQ.data.SlingStore,CQ.Ext.data.Store);
CQ.data.SlingReader=function(){CQ.data.SlingReader.superclass.constructor.call(this,{})
};
CQ.Ext.extend(CQ.data.SlingReader,CQ.Ext.data.JsonReader,{read:function(response){var json=response.responseText;
var rootData=eval("("+json+")");
if(!rootData){throw {message:"SlingReader.read: Json object not found"}
}var fields=[];
var data={};
for(var propName in rootData){var mappedName=propName.replace(/\./g,"%2e");
if(mappedName!=propName){fields.push({name:propName,mapping:mappedName})
}else{fields.push(propName)
}data[mappedName]=rootData[propName]
}var o={root:[data],results:1,success:true,metaData:{successProperty:"success",totalProperty:"results",root:"root",fields:fields}};
delete this.ef;
this.meta=o.metaData;
this.onMetaChange(this.meta,this.recordType,o);
this.recordType=CQ.data.SlingRecord.create(o.metaData.fields);
delete o.metaData;
return this.readRecords(o)
}});
CQ.data.SlingRecord=CQ.Ext.extend(CQ.Ext.data.Record,{get:function(A){var E;
if(A&&A.indexOf("/")>=0){var D=this.data;
A=A.replace("./","");
var F=A.split("/");
for(var B=0;
B<F.length;
B++){if(D){var C=F[B];
if(B==F.length-1){E=D[C]
}else{D=D[C]
}}}}else{E=this.data[A]
}E=CQ.Sling.processBinaryData(E);
return E
}});
CQ.data.SlingRecord.create=function(E){var C=CQ.Ext.extend(CQ.data.SlingRecord,{});
var D=C.prototype;
D.fields=new CQ.Ext.util.MixedCollection(false,function(F){return F.name
});
for(var B=0,A=E.length;
B<A;
B++){D.fields.add(new CQ.Ext.data.Field(E[B]))
}C.getField=function(F){return D.fields.get(F)
};
return C
};
CQ.data.SlingRecord.AUTO_ID=1000;
CQ.Ext.override(CQ.Ext.Element,{setWidth:function(B,A){if(isNaN(B)&&typeof B!="string"){B="auto"
}var C=this;
B=C.adjustWidth(B);
!A||!C.anim?C.dom.style.width=C.addUnits(B):C.anim({width:{to:B}},C.preanim(arguments,1));
return C
}});
CQ.Ext.Updater.defaults.timeout=CQ.REQUEST_TIMEOUT/1000;
CQ.Ext.dd.DragDropMgr.fireEvents=function(K,L){var N=this.dragCurrent;
if(!N||N.isLocked()){return 
}var O=K.getPoint();
var A=[];
var E=[];
var I=[];
var G=[];
var C=[];
for(var F in this.dragOvers){var B=this.dragOvers[F];
if(!this.isTypeOfDD(B)){continue
}if(!this.isOverTarget(O,B,this.mode)){E.push(B)
}A[F]=true;
delete this.dragOvers[F]
}var D=[];
for(var M in N.groups){if("string"!=typeof M){continue
}for(F in this.ids[M]){var H=this.ids[M][F];
if(!this.isTypeOfDD(H)){continue
}if(H.isTarget&&!H.isLocked()&&((H!=N)||(N.ignoreSelf===false))){if(this.isOverTarget(O,H,this.mode)){if(N.enableMultipleEventsFiring){D.push(H)
}else{if(D.length==0){D.push(H)
}else{D[0]=this.getTopfrontElement(D[0],H)
}}}}}}for(var F=0;
F<D.length;
F++){var H=D[F];
if(L&&G.indexOf(H)==-1){G.push(H)
}else{if(!A[H.id]&&C.indexOf(H)==-1){C.push(H)
}else{if(I.indexOf(H)==-1){I.push(H)
}}this.dragOvers[H.id]=H
}}if(this.mode){if(E.length){N.b4DragOut(K,E);
N.onDragOut(K,E)
}if(C.length){N.onDragEnter(K,C)
}if(I.length){N.b4DragOver(K,I);
N.onDragOver(K,I)
}if(G.length){N.b4DragDrop(K,G);
N.onDragDrop(K,G)
}}else{delete N.cachedTarget;
var J=0;
for(F=0,J=E.length;
F<J;
++F){N.b4DragOut(K,E[F].id);
N.onDragOut(K,E[F].id)
}for(F=0,J=C.length;
F<J;
++F){N.onDragEnter(K,C[F].id)
}for(F=0,J=I.length;
F<J;
++F){N.b4DragOver(K,I[F].id);
N.onDragOver(K,I[F].id)
}for(F=0,J=G.length;
F<J;
++F){N.b4DragDrop(K,G[F].id);
N.onDragDrop(K,G[F].id)
}}if(L&&!G.length){N.onInvalidDrop(K)
}};
CQ.Ext.dd.DragDropMgr.getTopfrontElement=function(Q,P){var F=CQ.Ext.get(Q.getEl());
var E=CQ.Ext.get(P.getEl());
var D=0;
var B=F.getStyle("z-index");
var C=F;
while((B=="auto")&&D++<30){C=C.parent();
if(C!=null){B=C.getStyle("z-index")
}else{break
}}D=0;
var L=E.getStyle("z-index");
C=E;
while((L=="auto")&&D++<30){C=C.parent();
if(C!=null){L=C.getStyle("z-index")
}else{break
}}if(B!="auto"&&!isNaN(B)&&parseInt(B)!=0){if(L!="auto"&&!isNaN(L)){if(parseInt(B)!=parseInt(L)){if(parseInt(B)>parseInt(L)){return Q
}return P
}}else{if(parseInt(B)>0){return Q
}return P
}}else{if(L!="auto"&&!isNaN(L)&&parseInt(L)!=0){if(parseInt(L)>0){return P
}return Q
}}if(F.up("[id="+E.id+"]")){return Q
}if(E.up("[id="+F.id+"]")){return P
}var O=function(S){var R="";
if(S){R+=O(S.parent())+"/"+S.id
}return R
};
var N=O(F);
var K=O(E);
var I=N.split("/"),H=K.split("/"),M,J;
for(var G=0;
G<I.length&&G<H.length;
G++){if(I[G]!=H[G]){M=I[G];
J=H[G];
break
}}if(M&&J){var A=CQ.Ext.get(M);
if(A.next("[id="+J+"]")){return P
}else{return Q
}}return Q
};
CQ.Ext.override(CQ.Ext.dd.DragZone,{destroy:function(A){if(this.containerScroll){CQ.Ext.dd.ScrollManager.unregister(this.el)
}CQ.Ext.dd.DragZone.superclass.destroy.call(this)
}});
var BEFOREREQUEST="beforerequest",UNDEFINED=undefined,POST="POST",GET="GET",WINDOW=window;
CQ.Ext.override(CQ.Ext.data.Connection,{timeout:CQ.REQUEST_TIMEOUT,request:function(E){var H=this;
if(H.fireEvent(BEFOREREQUEST,H,E)){if(E.el){if(!CQ.Ext.isEmpty(E.indicatorText)){H.indicatorText='<div class="loading-indicator">'+E.indicatorText+"</div>"
}if(H.indicatorText){CQ.Ext.getDom(E.el).innerHTML=H.indicatorText
}E.success=(CQ.Ext.isFunction(E.success)?E.success:function(){}).createInterceptor(function(J){CQ.Ext.getDom(E.el).innerHTML=J.responseText
})
}var C=E.params,B=E.url||H.url,A,F={success:H.handleResponse,failure:H.handleFailure,scope:H,argument:{options:E},timeout:E.timeout||H.timeout},D,I;
if(CQ.Ext.isFunction(C)){C=C.call(E.scope||WINDOW,E)
}C=CQ.Ext.urlEncode(H.extraParams,CQ.Ext.isObject(C)?CQ.Ext.urlEncode(C):C);
if(CQ.Ext.isFunction(B)){B=B.call(E.scope||WINDOW,E)
}B=CQ.HTTP.externalize(B,true);
if((D=CQ.Ext.getDom(E.form))){B=B||D.action;
if(E.isUpload||/multipart\/form-data/i.test(D.getAttribute("enctype"))){return H.doFormUpload.call(H,E,C,B)
}I=CQ.Ext.lib.Ajax.serializeForm(D);
C=C?(C+"&"+I):I
}A=E.method||H.method||((C||E.xmlData||E.jsonData)?POST:GET);
if(A===GET&&(H.disableCaching&&E.disableCaching!==false)||E.disableCaching===true){var G=E.disableCachingParam||H.disableCachingParam;
B=CQ.Ext.urlAppend(B,G+"="+(new Date().getTime()))
}E.headers=CQ.Ext.apply(E.headers||{},H.defaultHeaders||{});
if(E.autoAbort===true||H.autoAbort){H.abort()
}if((A==GET||E.xmlData||E.jsonData)&&C){B=CQ.Ext.urlAppend(B,C);
C=""
}return(H.transId=CQ.Ext.lib.Ajax.request(A,CQ.shared.HTTP.getXhrHookedURL(B),F,C,E))
}else{return E.callback?E.callback.apply(E.scope,[E,UNDEFINED,UNDEFINED]):null
}}});
CQ.Ext.override(CQ.Ext.data.Store,{sortData:function(C,D){D=D||"ASC";
var A=this.fields.get(C).sortType;
var B=function(F,E){var H=A(F.data[C]),G=A(E.data[C]);
if(typeof H=="string"){if(typeof G=="number"){return 1
}else{return H.localeCompare(""+G)
}}else{return H>G?1:(H<G?-1:0)
}};
this.data.sort(D,B);
if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(D,B)
}}});
CQ.Ext.override(CQ.Ext.data.Node,{getPath:function(B){B=B||"name";
var E=this.parentNode;
var A=[this.attributes[B]];
while(E){if(E.attributes[B]!=""){A.unshift(E.attributes[B])
}E=E.parentNode
}var D=this.getOwnerTree();
var C=D?D.pathSeparator:"/";
return C+A.join(C)
}});
CQ.Ext.override(CQ.Ext.state.CookieProvider,{set:function(A,B){if(A.indexOf("cq-comp-")==0||typeof B=="undefined"||B===null){this.clear(A);
return 
}this.setCookie(A,B);
CQ.Ext.state.CookieProvider.superclass.set.call(this,A,B)
}});
CQ.Ext.override(CQ.Ext.Component,{fieldSubLabel:null,fieldDescription:"",stateful:false,hasClass:function(A){if(this.el){return this.el.hasClass(A)
}else{if(this.cls){if(this.cls.indexOf(" ")!=-1){return this.cls.indexOf(A+" ")!=-1||this.cls.indexOf(" "+A)!=-1
}else{return this.cls==A
}}}return false
},focus:function(B,A){if(A){this.focus.defer(CQ.Ext.isNumber(A)?A:10,this,[B,false]);
return 
}if(this.rendered){this.el.focus();
if(B===true){if(this.el.dom.select){this.el.dom.select()
}}}return this
}});
CQ.Ext.override(CQ.Ext.Panel,{createElement:function(A,C){if(this[A]){C.appendChild(this[A].dom);
return 
}if(A==="bwrap"||this.elements.indexOf(A)!=-1){if(this[A+"Cfg"]){this[A]=CQ.Ext.fly(C).createChild(this[A+"Cfg"])
}else{var B=document.createElement("div");
B.className=this[A+"Cls"];
this[A]=CQ.Ext.get(C.tagName.toLowerCase()=="iframe"?B:C.appendChild(B))
}if(this[A+"CssClass"]){this[A].addClass(this[A+"CssClass"])
}if(this[A+"Style"]){this[A].applyStyles(this[A+"Style"])
}}}});
CQ.Ext.override(CQ.Ext.TabPanel,{stateful:false,stateEvents:["tabchange"],getState:function(){var A=this.getActiveTab();
if(A.items.get(0)){A=A.items.get(0)
}return{activeTab:A.id}
},applyState:function(C){try{var D=C.activeTab;
this.setActiveTab(D);
if(this.getActiveTab()!=D){if(C.activeTab){var B=CQ.Ext.getCmp(D);
if(B){var D=B.ownerCt||0;
this.setActiveTab(D)
}}if(this.getActiveTab()!=D){this.setActiveTab(this.initialConfig.activeTab||0)
}}}catch(A){this.setActiveTab(0)
}}});
CQ.Ext.override(CQ.Ext.Viewport,{debug:false,initComponent:function(){CQ.Ext.Viewport.superclass.initComponent.call(this);
document.getElementsByTagName("html")[0].className+=" x-viewport";
this.el=CQ.Ext.getBody();
this.el.setHeight=CQ.Ext.emptyFn;
this.el.setWidth=CQ.Ext.emptyFn;
this.el.setSize=CQ.Ext.emptyFn;
this.el.dom.scroll="no";
this.allowDomMove=false;
this.autoWidth=true;
this.autoHeight=true;
CQ.Ext.EventManager.onWindowResize(this.fireResize,this);
this.renderTo=this.el;
this.on("render",function(){if(!this.debug){if(!CQ.HTTP.getCookie("cq-firebug-warn")&&window.console&&window.console.firebug){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Warning"),CQ.I18n.getMessage("Firebug is known to cause performance issues. ")+CQ.I18n.getMessage("Disable Firebug if you experience performance problems."));
CQ.HTTP.setCookie("cq-firebug-warn","1",CQ.HTTP.externalize("/"),1)
}}},this)
}});
CQ.Ext.override(CQ.Ext.Window,{anchorTo:function(C,E,D,B){if(this.doAnchor){CQ.Ext.EventManager.removeResizeListener(this.doAnchor,this);
CQ.Ext.EventManager.un(window,"scroll",this.doAnchor,this)
}this.doAnchor=function(){this.alignTo(C,E,D)
};
CQ.Ext.EventManager.onWindowResize(this.doAnchor,this);
var A=typeof B;
if(A!="undefined"){CQ.Ext.EventManager.on(window,"scroll",this.doAnchor,this,{buffer:A=="number"?B:50})
}this.doAnchor.call(this);
return this
}});
CQ.Ext.override(CQ.Ext.form.BasicForm,{timeout:CQ.REQUEST_TIMEOUT/1000});
CQ.Ext.override(CQ.Ext.form.FormPanel,{initFields:function(){var C=this.form;
var A=this;
var B=function(D){if(D.findBy&&D!=A){A.applySettings(D);
if(D.items&&D.items.each){D.items.each(B,this)
}}if(A.isField(D)){C.add(D)
}};
this.items.each(B,this)
}});
CQ.Ext.override(CQ.Ext.form.Field,{ignoreData:false,defaultValue:null,readOnlyClass:"x-form-disabled",dropTargets:null,processRecord:function(A,C){if(this.fireEvent("beforeloadcontent",this,A,C)!==false){var B=A.get(this.getName());
if(B==undefined&&this.defaultValue!=null){if(this.isApplyDefault(A,C)){this.setValue(this.defaultValue)
}}else{this.setValue(B)
}this.fireEvent("loadcontent",this,A,C)
}},processPath:function(B,A){},isApplyDefault:function(A,C){var D=A.get("jcr:created");
if(!D&&A.data.length==0){return false
}var B=A.get("jcr:lastModified");
if(!B){B=A.get("cq:lastModified")
}return D==B
},getDropTargets:function(){return this.dropTargets
},afterRender:function(){CQ.Ext.form.Field.superclass.afterRender.call(this);
if(this.tooltip){var B=this.getEl().up("div.x-form-item");
if(B){var A=B.child("label");
if(A){CQ.Ext.QuickTips.register({target:A,title:"",text:this.tooltip,enabled:true})
}}}if(this.readOnly&&this.readOnlyClass){this.el.addClass(this.readOnlyClass)
}this.initEvents();
this.initValue()
}});
CQ.Ext.override(CQ.Ext.form.TextField,{evaluateValidatorsFirst:false,executeCustomValidators:function(A){if(this.vtype){var C=CQ.Ext.form.VTypes;
if(!C[this.vtype](A,this)){this.markInvalid(this.vtypeText||C[this.vtype+"Text"]);
return false
}}if(typeof this.validator=="function"){var B=this.validator(A);
if(B!==true){this.markInvalid(B);
return false
}}return null
},validateValue:function(B){var A;
if(this.evaluateValidatorsFirst){A=this.executeCustomValidators(B);
if(A!==null){return A
}}if(CQ.Ext.isFunction(this.validator)){var D=this.validator(B);
if(D!==true){this.markInvalid(D);
return false
}}if(B.length<1||B===this.emptyText){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(B.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));
return false
}if(B.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));
return false
}if(!this.evaluateValidatorsFirst){A=this.executeCustomValidators(B);
if(A!==null){return A
}}if(this.vtype){var C=CQ.Ext.form.VTypes;
if(!C[this.vtype](B,this)){this.markInvalid(this.vtypeText||C[this.vtype+"Text"]);
return false
}}if(this.regex&&!this.regex.test(B)){this.markInvalid(this.regexText);
return false
}return true
},getCaretPosition:function(){var B=this.getRawValue();
if(B.length==0){return 0
}var C=this.el.dom;
if(document.selection!=undefined){C.focus();
var A=document.selection.createRange();
A.moveStart("character",-B.length);
return A.text.length
}else{if(C.selectionStart!=undefined){return C.selectionStart
}else{return B.length
}}},setCaretPosition:function(D){var C=this.el.dom;
if(document.selection!=undefined){var B=this.getRawValue();
C.focus();
var A=document.selection.createRange();
A.moveStart("character",-B.length);
A.moveStart("character",D);
A.moveEnd("character",0)
}else{if(C.selectionStart!=undefined){C.selectionStart=D;
C.selectionEnd=D;
C.focus()
}else{C.focus()
}}},getTermAtCaret:function(){return this.getTermAt(this.getCaretPosition())
},getTermAt:function(D){var B=this.getRawValue();
if(B.charAt(D)==" "){D-=1
}var C=B.lastIndexOf(" ",D)+1;
var A=B.indexOf(" ",D);
if(A==-1){return B.substring(C)
}else{return B.substring(C,A)
}}});
CQ.Ext.override(CQ.Ext.form.DateField,{startDay:0,onTriggerClick:function(){if(this.disabled){return 
}if(this.menu==null){this.menu=new CQ.Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})
}this.onFocus();
CQ.Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});
this.menu.picker.setValue(this.getValue()||new Date());
this.menu.show(this.el,"tl-bl?");
this.menuEvents("on")
}});
CQ.Ext.form.VTypes.digitsMask=/^\d*$/;
CQ.Ext.form.VTypes.digits=function(A){return/^\d*$/.test(A)
};
CQ.Ext.form.VTypes.percentMask=/[\d\%]/;
CQ.Ext.form.VTypes.percent=function(A){return/^\d.*\%?$/.test(A)
};
CQ.Ext.form.VTypes.itemnameMask=/[a-z0-9_\-]/i;
CQ.Ext.form.VTypes.itemname=function(A){return/^[a-zA-Z0-9_\-]+$/.test(A)
};
CQ.Ext.form.VTypes.makeItemname=function(A,D){if(CQ.Ext.form.VTypes.itemname(A)){return A
}D=D==undefined?"-":D;
var C="";
for(var B=0;
B<A.length;
B++){C+=/^[a-zA-Z0-9_\-]$/.test(A[B])?A[B]:D
}if(C.length==0){C=D==""?"-":D
}return C
};
CQ.Ext.form.VTypes.authorizableIdMask=/[a-z0-9@_\-\.]/;
CQ.Ext.form.VTypes.authorizableId=function(A){return/^[a-z0-9@_\-\.]+$/.test(A)
};
CQ.Ext.form.VTypes.makeAuthorizableId=function(C,B){if(CQ.Ext.form.VTypes.authorizableId(C)){return C
}B=B==undefined?"-":B;
var D="";
for(var A=0;
A<C.length;
A++){if(/^[a-z0-9@_\-\.]$/.test(C[A])){D+=C[A]
}else{if(/^[A-Z]$/.test(C[A])){D+=C[A].toLowerCase()
}else{D+=B
}}}if(D.length==0){D=B==""?"-":B
}return D
};
CQ.Ext.form.VTypes.nameMaskTerm=/^([^\|\[\]\*\/: \.]+|[^\|\[\]\*\/: \.]+[^\|\[\]\*\/:]*[^\|\[\]\*\/: ]+)$/;
CQ.Ext.form.VTypes.nameMask=/^[^\|\[\]\*\/:]$/;
CQ.Ext.form.VTypes.name=function(A){return CQ.Ext.form.VTypes.nameMaskTerm.test(A)
};
CQ.Ext.form.VTypes.makeName=function(A,D){if(CQ.Ext.form.VTypes.name(A)){return A
}D=D==undefined?"-":D;
var C="";
for(var B=0;
B<A.length;
B++){if(B==0){C+=/^[^\|\[\]\*\/: \.]$/.test(A[B])?A[B]:""
}else{if(B==A.length-1){C+=/^[^\|\[\]\*\/: ]$/.test(A[B])?A[B]:""
}else{C+=/^[^\|\[\]\*\/:]$/.test(A[B])?A[B]:D
}}}if(C.length==0){C=D==""?"-":D
}return C
};
CQ.Ext.form.VTypes.requiredOnLinkedData=function(I,H){var E=H.findParentByType("dialog");
var D=CQ.utils.Util.findFormFields(E);
var B=H.linkedComponent;
var A=D[B];
if(A){var C=false;
var J=A.length;
for(var G=0;
G<J;
G++){var F=A[G];
if(F.hasData){if(F.hasData()){C=true;
break
}}}if(!C){return true
}return(I.length>0)
}return true
};
CQ.Ext.form.VTypes.daterange=function(C,D){var B=D.parseDate(C);
if(!B){return 
}if(D.startDateField&&(!this.dateRangeMax||(B.getTime()!=this.dateRangeMax.getTime()))){var E=CQ.Ext.getCmp(D.startDateField);
E.setMaxValue(B);
E.validate();
this.dateRangeMax=B
}else{if(D.endDateField&&(!this.dateRangeMin||(B.getTime()!=this.dateRangeMin.getTime()))){var A=CQ.Ext.getCmp(D.endDateField);
A.setMinValue(B);
A.validate();
this.dateRangeMin=B
}}return true
};
CQ.Ext.override(CQ.Ext.form.ComboBox,{doQuery:function(C,B){C=CQ.Ext.isEmpty(C)?"":C;
var A={query:C,forceAll:B,combo:this,cancel:false};
if(this.fireEvent("beforequery",A)===false||A.cancel){return false
}C=A.query;
B=A.forceAll;
if(B===true||(C.length>=this.minChars)){if(this.lastQuery!==C){this.lastQuery=C;
if(this.mode=="local"){this.selectedIndex=-1;
if(B){this.store.clearFilter()
}else{this.store.filter(this.displayField,C,this.anyMatch)
}this.onLoad()
}else{this.store.baseParams[this.queryParam]=C;
this.store.load({params:this.getParams(C)});
this.expand()
}}else{this.selectedIndex=-1;
this.onLoad()
}}}});
CQ.Ext.form.ComboBox.prototype.initComponent=CQ.Ext.form.ComboBox.prototype.initComponent.createSequence(function(){this.on("expand",function(A){if(A.assetHeight==0&&A.pageSize>0&&CQ.Ext.isIE7){A.assetHeight=28
}})
});
CQ.Ext.override(CQ.Ext.form.Checkbox,{onRender:function(C,A){CQ.Ext.form.Checkbox.superclass.onRender.call(this,C,A);
if(this.inputValue!==undefined){this.el.dom.value=this.inputValue
}this.wrap=this.el.wrap({cls:"x-form-check-wrap"});
if(this.boxLabel){var B="x-form-cb-label";
if(this.hideLabel){B="x-form-cb-label-hidden"
}this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:B,html:this.boxLabel})
}if(this.checked){this.setValue(true)
}else{this.checked=this.el.dom.checked
}if(CQ.Ext.isIE){this.wrap.repaint()
}this.resizeEl=this.positionEl=this.wrap
},setValue:function(A,C){var B=this.checked;
this.checked=(A===true||A==="true"||A=="1"||String(A).toLowerCase()=="on");
if(this.rendered){this.el.dom.checked=this.checked;
this.el.dom.defaultChecked=this.checked
}if(!C){if(B!=this.checked){this.fireEvent("check",this,this.checked);
if(this.handler){this.handler.call(this.scope||this,this,this.checked)
}}}return this
}});
CQ.Ext.override(CQ.Ext.grid.GridView,{initTemplates:function(){var C=this.templates||{};
if(!C.master){C.master=new CQ.Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")
}if(!C.header){C.header=new CQ.Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>',"</table>")
}if(!C.hcell){C.hcell=new CQ.Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',CQ.Ext.BLANK_IMAGE_URL,'" />',"</div></td>")
}if(!C.body){C.body=new CQ.Ext.Template("{rows}")
}if(!C.row){C.row=new CQ.Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>")
}if(!C.cell){C.cell=new CQ.Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")
}for(var A in C){var B=C[A];
if(B&&CQ.Ext.isFunction(B.compile)&&!B.compiled){B.disableFormats=true;
B.compile()
}}this.templates=C;
this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")
},getColumnStyle:function(A,C){var B=C?(this.cm.config[A].headerStyle||""):(this.cm.config[A].cellStyle||this.cm.config[A].css||"");
B+="width:"+this.getColumnWidth(A)+";";
if(this.cm.isHidden(A)){B+="display:none;"
}var D=this.cm.config[A].align;
if(D){B+="text-align:"+D+";"
}return B
},getColumnData:function(){var D=[],A=this.cm,E=A.getColumnCount();
for(var C=0;
C<E;
C++){var B=A.getDataIndex(C);
D[C]={name:(!CQ.Ext.isDefined(B)?this.ds.fields.get(C).name:B),renderer:A.getRenderer(C),scope:A.getRendererScope(C),id:A.getColumnId(C),style:this.getColumnStyle(C),css:A.config[C].cellCls}
}return D
},renderHeaders:function(){var C=this.cm,G=this.templates,E=G.hcell,B=[],H={},A=C.getColumnCount(),F=A-1;
for(var D=0;
D<A;
D++){H.id=C.getColumnId(D);
H.value=C.getColumnHeader(D)||"";
H.style=this.getColumnStyle(D,true);
H.tooltip=this.getColumnTooltip(D);
H.css=D===0?"x-grid3-cell-first ":(D==F?"x-grid3-cell-last ":"");
H.css+=C.config[D].headerCls?C.config[D].headerCls+" ":"";
if(C.config[D].align=="right"){H.istyle="padding-right:16px"
}else{delete H.istyle
}B[B.length]=E.apply(H)
}return G.header.apply({cells:B.join(""),tstyle:"width:"+this.getTotalWidth()+";"})
},doRender:function(E,G,M,A,L,Q){var B=this.templates,D=B.cell,F=B.row,H=L-1;
var C="width:"+this.getTotalWidth()+";";
var T=[],N,U,O={},I={tstyle:C},K;
for(var P=0,S=G.length;
P<S;
P++){K=G[P];
N=[];
var J=(P+A);
for(var R=0;
R<L;
R++){U=E[R];
O.id=U.id;
O.css=R===0?"x-grid3-cell-first ":(R==H?"x-grid3-cell-last ":"");
O.css+=(U.css?U.css+" ":"");
O.attr=O.cellAttr="";
O.value=U.renderer.call(U.scope,K.data[U.name],O,K,J,R,M);
O.style=U.style;
if(CQ.Ext.isEmpty(O.value)){O.value="&#160;"
}if(this.markDirty&&K.dirty&&CQ.Ext.isDefined(K.modified[U.name])){O.css+=" x-grid3-dirty-cell"
}N[N.length]=D.apply(O)
}var V=[];
if(Q&&((J+1)%2===0)){V[0]="x-grid3-row-alt"
}if(K.dirty){V[1]=" x-grid3-dirty-row"
}I.cols=L;
if(this.getRowClass){V[2]=this.getRowClass(K,J,I,M)
}I.alt=V.join(" ");
I.cells=N.join("");
T[T.length]=F.apply(I)
}return T.join("")
}});
CQ.Ext.override(CQ.Ext.grid.GridView.SplitDragZone,{b4StartDrag:function(A,E){this.view.headersDisabled=true;
var D=this.view.mainWrap.getHeight();
this.marker.setHeight(D);
this.marker.show();
this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);
this.proxy.setHeight(D);
var B=this.cm.getColumnWidth(this.cellIndex);
var C=Math.max(B-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(C,1000);
this.setYConstraint(0,0);
this.minX=A-C;
this.maxX=A+1000;
this.startPos=A;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,A,E);
if(this.enableTooltip&&this.showTooltip){this.showTooltip(A,E)
}},endDrag:function(D){this.marker.hide();
var A=this.view;
var B=Math.max(this.minX,D.getPageX());
var C=B-this.startPos;
A.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+C);
setTimeout(function(){A.headersDisabled=false
},50);
if(this.enableTooltip&&this.hideTooltip){this.hideTooltip(D.getPageX(),D.getPageY())
}}});
CQ.Ext.override(CQ.Ext.grid.ColumnModel,{setConfig:function(D,C){var E,G,A;
if(!C){delete this.totalWidth;
for(E=0,A=this.config.length;
E<A;
E++){this.config[E].destroy()
}}this.defaults=CQ.Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);
this.config=D;
this.lookup={};
for(E=0,A=D.length;
E<A;
E++){G=CQ.Ext.applyIf(D[E],this.defaults);
if(CQ.Ext.isEmpty(G.id)){G.id=E
}if(!G.isColumn){if(G.xtype=="nt:unstructured"){G.xtype="gridcolumn"
}if(G.width){try{G.width=parseInt(G.width)
}catch(B){}}var F=CQ.Ext.grid.Column.types[G.xtype||"gridcolumn"];
G=new F(G);
D[E]=G
}this.lookup[G.id]=G
}if(!C){this.fireEvent("configchange",this)
}}});
CQ.Ext.override(CQ.Ext.layout.FormLayout,{labelSeparator:"",getTemplateArgs:function(B){var A=!B.fieldLabel||B.hideLabel;
return{id:B.id,label:(!B.fieldLabel&&!B.allowBlank)?"&nbsp;":B.fieldLabel,labelStyle:this.getLabelStyle(B.labelStyle),elementStyle:this.elementStyle||"",labelSeparator:A?"":(CQ.Ext.isDefined(B.labelSeparator)?B.labelSeparator:this.labelSeparator),itemCls:(B.itemCls||this.container.itemCls||"")+(B.hideLabel?" x-hide-label":""),clearCls:B.clearCls||"x-form-clear-left",fieldSubLabel:B.fieldSubLabel?'<br><span class="sub-label">'+B.fieldSubLabel+"</span>":"",fieldDescription:B.fieldDescription?'<div style="'+(this.elementStyle||"")+'" class="x-form-item-description">'+B.fieldDescription+"</div>":"",asterisk:B.allowBlank===false?'<span class="cq-asterisk">*</span>':""}
},fieldTpl:(function(){var A=new CQ.Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}{fieldSubLabel}{asterisk}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div>{fieldDescription}<div class="{clearCls}"></div>',"</div>");
A.disableFormats=true;
return A.compile()
})()});
CQ.Ext.override(CQ.Ext.layout.TableLayout,{getNextCell:function(H){var A=this.getNextNonSpan(this.currentColumn,this.currentRow);
var E=this.currentColumn=A[0],D=this.currentRow=A[1];
for(var G=D;
G<D+(H.rowspan||1);
G++){if(!this.cells[G]){this.cells[G]=[]
}for(var C=E;
C<E+(H.colspan||1);
C++){this.cells[G][C]=true
}}var F=document.createElement("td");
if(H.cellId){F.id=H.cellId
}var B="x-table-layout-cell";
if(H.cellCls){B+=" "+H.cellCls
}if(H.cellStyle){CQ.Ext.DomHelper.applyStyles(F,H.cellStyle)
}F.className=B;
if(H.colspan){F.colSpan=H.colspan
}if(H.rowspan){F.rowSpan=H.rowspan
}this.getRow(D).appendChild(F);
return F
}});
CQ.Ext.override(CQ.Ext.menu.Menu,{constrainScroll:function(H){var B,D=this.ul.setHeight("auto").getHeight(),A=H,G,E,F,C;
if(this.floating){E=CQ.Ext.fly(this.el.dom.parentNode);
F=E.getScroll().top;
C=E.getViewSize().height;
if(E.dom.id==CQ.utils.Util.ROOT_ID){F=CQ.Ext.getBody().getScroll().top;
C=CQ.Ext.getBody().getViewSize().height
}G=H-F;
B=this.maxHeight?this.maxHeight:C-G;
if(D>C){B=C;
A=H-G
}else{if(B<D){A=H-(D-B);
B=D
}}}else{B=this.getHeight()
}if(D>B&&B>0){this.activeMax=B-this.scrollerHeight*2-this.el.getFrameWidth("tb")-CQ.Ext.num(this.el.shadowOffset,0);
this.ul.setHeight(this.activeMax);
this.createScrollers();
this.el.select(".x-menu-scroller").setDisplayed("")
}else{this.ul.setHeight(D);
this.el.select(".x-menu-scroller").setDisplayed("none")
}this.ul.dom.scrollTop=0;
return A
}});
CQ.Ext.override(CQ.Ext.tree.TreePanel,{stateful:false,stateEvents:["selectionchange"],getState:function(){var A=this.getBox();
return{width:A.width,selectedPath:this.selectedPath}
},initComponent:function(){CQ.Ext.tree.TreePanel.superclass.initComponent.call(this);
if(!this.eventModel){this.eventModel=new CQ.Ext.tree.TreeEventModel(this)
}var A=this.loader;
if(!A){A=new CQ.Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod})
}else{if(CQ.Ext.isObject(A)&&!A.load){A=new CQ.Ext.tree.TreeLoader(A)
}}this.loader=A;
this.nodeHash={};
if(this.root){var B=this.root;
delete this.root;
this.setRootNode(B)
}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","containerclick","checkchange","beforedblclick","dblclick","containerdblclick","contextmenu","containercontextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover","selectionchange");
if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)
}if(this.getSelectionModel()){this.getSelectionModel().on("selectionchange",function(C,D){if(D){this.selectedPath=D.getPath();
this.fireEvent("selectionchange",this,this.selectedPath)
}},this)
}this.on("render",function(C){if(C.selectedPath){window.setTimeout(function(){C.selectPath(C.selectedPath)
},0)
}},this)
},splitPath:function(E,A){A=A||"name";
var C=E.split(this.pathSeparator);
var B=this.root.attributes[A];
var D=B.split("/").length;
if(D>1){C.splice(1,D,B)
}return C
},expandPath:function(F,A,G){A=A||"name";
var D=this.splitPath(F,A);
var C=this.root;
if(C.attributes[A]!=D[1]){if(G){G(false,null)
}return 
}var B=1;
var E=function(){if(++B==D.length){if(G){G(true,C)
}return 
}var H=C.findChild(A,D[B]);
if(!H){if(G){G(false,C)
}return 
}C=H;
H.expand(false,false,E)
};
C.expand(false,false,E)
},selectPath:function(E,A,F){A=A||"name";
var C=E.split(this.pathSeparator),B=C.pop();
if(C.length>1){var D=function(H,G){if(H&&G){var I=G.findChild(A,B);
if(I){I.select();
if(F){F(true,I)
}}else{if(F){F(false,I)
}}}else{if(F){F(false,I)
}}};
this.expandPath(C.join(this.pathSeparator),A,D)
}else{this.root.select();
if(F){F(true,this.root)
}}}});
CQ.Ext.tree.TreeNodeUI.prototype.onClick=function(B){if(this.dropping){B.stopEvent();
return 
}if(this.fireEvent("beforeclick",this.node,B)!==false){var A=B.getTarget("a");
if(!this.disabled&&this.node.attributes.href&&A){this.fireEvent("click",this.node,B);
return 
}else{if(A&&B.ctrlKey){B.stopEvent()
}}B.preventDefault();
if(this.disabled){return 
}if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){if(!this.node.isExpanded()){if(!this.node.attributes.autoExpandMax||this.node.attributes.sub<=this.node.attributes.autoExpandMax){this.node.toggle()
}}}this.fireEvent("click",this.node,B)
}else{B.stopEvent()
}};
CQ.state.PreferencesProvider=function(B){if(B.data){var A=CQ.data.SlingRecord.create({name:"data"});
this.data=new A(B.data)
}else{if(B.url){this.url=B.url
}}CQ.state.PreferencesProvider.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.state.PreferencesProvider,CQ.Ext.state.Provider,{url:null,data:null,get:function(A){if(!this.data){this.loadPreferences()
}if(this.data){return this.data.get(A)
}else{CQ.Log.warn("CQ.state.PreferencesProvider#get failed: could not load data")
}},set:function(A,B){this.data.beginEdit();
this.data.set(A,B);
this.data.endEdit()
},loadPreferences:function(){try{if(this.url){var prefs=CQ.HTTP.eval(this.url);
if(prefs){var con=CQ.data.SlingRecord.create({name:"data"});
this.data=new con(prefs)
}else{CQ.Log.debug("CQ.state.PreferencesProvider#loadPreferences: no response for {0}, empty data}",this.url)
}}}catch(e){CQ.Log.warn("CQ.state.PreferencesProvider#loadPreferences: {0}",e.message)
}}});
CQ.utils.Util=function(){var observations={};
var pins=[];
var scrollInterval=null;
var busyCheckingPins=false;
var checkPinsNow=false;
var winWidth=-1;
var idCounter={};
var checkPins=function(){var vpw=CQ.Ext.lib.Dom.getViewportWidth();
winWidth=winWidth>0?winWidth:vpw;
if(!checkPinsNow&&(CQ.utils.Util.docScrolling||vpw<winWidth)){checkPinsNow=true
}else{if(!busyCheckingPins&&checkPinsNow){busyCheckingPins=true;
for(var i=0;
i<pins.length;
i++){var el=pins[i].pin;
if(el.getEl){el=el.getEl()
}var box=el.getBox();
var offsetLeft=0;
var totalWidth=box.x+box.width+CQ.themes.Dialog.CORNER_X;
if(winWidth<totalWidth){offsetLeft=winWidth-totalWidth
}var curScroll=CQ.Ext.getDoc().getScroll();
var lastScroll=pins[i].scroll;
var offsetTop=curScroll.top-lastScroll.top;
offsetLeft+=curScroll.left-lastScroll.left;
var x=(box.x+offsetLeft);
var y=(box.y+offsetTop);
el.shift({x:x,y:y,duration:0.2});
pins[i].scroll=curScroll
}busyCheckingPins=false;
checkPinsNow=false
}}winWidth=vpw
};
var getObservation=function(interval){var name;
if(!interval){name=CQ.SHORT_INTERVAL
}else{if(typeof interval=="number"&&interval>0){name="CUSTOM_INTERVAL_"+interval
}else{name=interval
}}if(!observations[name]){var time;
if(typeof interval=="number"&&interval>0){time=interval
}else{switch(interval){case CQ.VERY_SHORT_INTERVAL:time=CQ.VERY_SHORT_INTERVAL_VALUE;
break;
case CQ.LONG_INTERVAL:time=CQ.LONG_INTERVAL_VALUE;
break;
case CQ.VERY_LONG_INTERVAL:time=CQ.VERY_LONG_INTERVAL_VALUE;
break;
default:time=CQ.SHORT_INTERVAL_VALUE
}}observations[name]={components:[],name:name,time:time,started:false}
}return observations[name]
};
var isCqInstance=function(item){return item instanceof CQ.Ext.util.Observable||item instanceof CQ.Ext.Element||item instanceof CQ.Ext.data.DataReader||item instanceof CQ.Class
};
var processIncludes=function(data){if(typeof (data)!="object"){return data
}if(data.xtype=="cqinclude"){if(data.path){CQ.Log.debug("CQ.utils.Util#processIncludes: processing include: {0}",data);
var path=CQ.HTTP.externalize(data.path);
path=CQ.HTTP.addSelector(path,"overlay");
data=CQ.Util.eval(path)
}else{CQ.Log.debug("CQ.utils.Util#processIncludes: no include path defined in {0}",data[i])
}return processIncludes(data)
}else{for(var i in data){if(!data[i]){continue
}if(typeof (data[i])=="object"){if(data[i].xtype){if(data[i].xtype=="cqinclude"){if(data[i].path){CQ.Log.debug("CQ.utils.Util#processIncludes: processing include: {0}",data[i]);
var path=CQ.HTTP.externalize(data[i].path);
path=CQ.HTTP.addSelector(path,"overlay");
data[i]=CQ.Util.eval(path)
}else{CQ.Log.debug("CQ.utils.Util#processIncludes: no include path defined in {0}",data[i])
}}data[i]=processIncludes(data[i])
}}}}return data
};
return{ROOT_ID:"CQ",I18N_ONLY:1,FORMAT_ONLY:2,NO_I18N_SUFFIX:"_noI18n",COMMENT_I18N_SUFFIX:"_commentI18n",docScrolling:false,createRoot:function(){var root=new CQ.Ext.Element(document.createElement("div"));
root.dom.id=CQ.utils.Util.ROOT_ID;
try{document.body.appendChild(root.dom);
return root
}catch(e){return null
}},getRoot:function(){return CQ.Ext.get(CQ.utils.Util.ROOT_ID)
},isRoot:function(item){return item==document.body||item==CQ.utils.Util.ROOT_ID||item==CQ.Ext.getBody()
},build:function(data,noFormatting,callback,debug,extensions){if(typeof data!="object"){CQ.Log.debug("CQ.utils.Util.build: retrieving component data from {0}",data);
try{if(callback){var buildCallback=function(options,success,xhr,response){if(success){var component=CQ.utils.Util.build(CQ.HTTP.eval(response),noFormatting,callback,debug,extensions);
callback(component)
}else{CQ.Log.error("CQ.utils.Util.build: callback failed to fetch data ({0})",response.statusText)
}};
return CQ.HTTP.get(data,buildCallback)
}else{return CQ.utils.Util.build(CQ.HTTP.eval(data),noFormatting,callback,debug,extensions)
}}catch(e){CQ.Log.error("CQ.utils.Util.build: failed to fetch data ({0})",e.message);
return null
}}else{if(!noFormatting){data=CQ.utils.Util.formatData(data)
}if(debug){data.debug=debug
}if(extensions){if(!data.extensions){data.extensions={}
}for(var xnName in extensions){data.extensions[xnName]=[];
for(var i=0;
i<extensions[xnName].length;
i++){var xn=extensions[xnName][i];
data.extensions[xnName].push(xn)
}}}CQ.Log.info("CQ.utils.Util.build: building component of type '{0}'",data.xtype);
return CQ.Ext.ComponentMgr.create(data)
}},formatData:function(data,mode){if(!data||data.nodeType||isCqInstance(data)){return data
}if(data instanceof Array){for(var i=0;
i<data.length;
i++){data[i]=CQ.utils.Util.formatData(data[i])
}return data
}if(mode!=CQ.Util.I18N_ONLY){if(!data.xtype&&data["jcr:primaryType"]&&!data["jcr:primaryType"].match(/cq\:Widget/)&&data["jcr:primaryType"].indexOf("cq:")==0){data.xtype=data["jcr:primaryType"].toLowerCase().replace("cq:","")
}if(data["jcr:title"]&&!data.title){data.title=data["jcr:title"]
}}data=processIncludes(data);
for(var i in data){if(!data[i]){continue
}if(typeof (data[i])=="object"){data[i]=CQ.utils.Util.formatData(data[i]);
if(mode==CQ.Util.I18N_ONLY){continue
}if(data[i]["jcr:primaryType"]){if(data[i]["jcr:primaryType"].match(/cq\:.*Collection/)){var array=[];
for(var j in data[i]){if(typeof (data[i][j])=="object"||(j!="xtype"&&j!="jcr:primaryType")){array.push(data[i][j])
}}if(i=="items"&&array.length==1){data[i]=array[0]
}else{data[i]=array
}}}}else{if(typeof data[i]=="string"){if(data[i]=="true"){data[i]=true
}else{if(data[i]=="false"){data[i]=false
}else{if(i=="regex"){try{data[i]=eval(data[i])
}catch(e){}}else{if(/^\d+$/.test(data[i])){data[i]=parseInt(data[i])
}else{if(/function\(.*/.test(data[i])){try{eval("data[i] = "+data[i]+";")
}catch(e){}}}}}}}}}if(mode!=CQ.Util.FORMAT_ONLY){var names=["title","text","tooltip","qtip","tabTip","fieldLabel","fieldSubLabel","fieldDescription","boxLabel","regexText","vtypeText","emptyText","cq:emptyText","rootTitle","widthPrefix","widthSuffix","heightPrefix","heightSuffix","displayMsg","pageText","maxMsg","emptyMsg","beforePageText","afterPageText","firstText","prevText","nextText","lastText","refreshText"];
if(data.header&&typeof data.header=="string"){names.push("header")
}for(var i=0;
i<names.length;
i++){var name=names[i];
if(data[name+CQ.utils.Util.NO_I18N_SUFFIX]){data[name]=data[name+CQ.utils.Util.NO_I18N_SUFFIX];
delete data[name+CQ.utils.Util.NO_I18N_SUFFIX]
}else{if(data[name]&&(typeof (data[name])=="string")){data[name]=CQ.I18n.getVarMessage(data[name],data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX])
}}if(data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX]){delete data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX]
}}}return data
},merge:function(base,upgrade){if(!upgrade){return base
}if(!base){if(upgrade instanceof Array){return upgrade
}base=new Object()
}for(var name in upgrade){var value=upgrade[name];
if(value instanceof CQ.Ext.Component){base[name]=value
}else{if(value&&typeof value=="object"){if(value instanceof Array){base[name]=value
}else{base[name]=CQ.utils.Util.merge(base[name],value)
}}else{base[name]=value
}}}return base
},applyDefaults:function(base,defaults){if(!defaults){return base
}if(defaults instanceof Array||typeof defaults!="object"){if(typeof base=="undefined"){return defaults
}else{return base
}}if(!base){base=new Object()
}for(var name in defaults){var value=defaults[name];
if(value&&typeof value=="object"&&!(value instanceof Array)&&!isCqInstance(value)){base[name]=CQ.utils.Util.applyDefaults(base[name],value)
}else{if(typeof base[name]=="undefined"){base[name]=value
}}}return base
},patchText:function(text,snippets){if(snippets){if(!CQ.Ext.isArray(snippets)){text=text.replace("{0}",snippets)
}else{for(var i=0;
i<snippets.length;
i++){text=text.replace(("{"+i+"}"),snippets[i])
}}}return text
},eval:function(response){return CQ.HTTP.eval(response)
},evalHTML:function(html){try{var node=document.createElement("div");
node.innerHTML=html;
var obj=CQ.utils.Util.evalNode(node);
node=null;
return obj
}catch(e){return{}
}},evalNode:function(node,obj){if(!node){return null
}if(obj==undefined){obj=new Object()
}try{for(var i=0;
i<node.childNodes.length;
i++){var child=node.childNodes[i];
if(child.tagName){if(child.id){if(child.href){obj[child.id]=child.href
}else{obj[child.id]=child.innerHTML
}}obj=CQ.utils.Util.evalNode(child,obj)
}}}catch(e){}return obj
},reload:function(win,url){if(!win){win=window
}if(CQ.WCM.getTopWindow()!==win){CQ.WCM.setContentWindowLoading(true)
}CQ.shared.Util.reload(win,url)
},clearDocumentSelection:function(win){CQ.DOM.clearDocumentSelection(win)
},getContextPath:function(){return CQ.HTTP.getContextPath()
},detectContextPath:function(){CQ.HTTP.detectContextPath()
},externalize:function(url){return CQ.HTTP.externalize(url)
},internalize:function(url,doc){return CQ.HTTP.internalize(url,doc)
},getPath:function(url){return CQ.HTTP.getPath(url)
},getSingleItemConfig:function(config,xtype){try{if(config.items.xtype==xtype){return config.items
}}catch(e){return null
}},copyObject:function(object){var newObj;
if(object instanceof Array||CQ.Ext.isArray(object)){newObj=new Array();
for(var i=0;
i<object.length;
i++){if(typeof object[i]=="object"&&!isCqInstance(object[i])){newObj.push(CQ.utils.Util.copyObject(object[i]))
}else{newObj.push(object[i])
}}}else{newObj=new Object();
for(var i in object){if(typeof object[i]=="object"&&!isCqInstance(object[i])&&!(object[i] instanceof RegExp)){newObj[i]=CQ.utils.Util.copyObject(object[i])
}else{newObj[i]=object[i]
}}}return newObj
},indexInArray:function(array,value){for(var i=0;
i<array.length;
i++){if(array[i]==value){return i
}}return -1
},compareValues:function(v1,v2){if(v1 instanceof Array&&v2 instanceof Array){if(v1.length==v2.length){for(var i=0;
i<v1.length;
i++){var check=CQ.utils.Util.compareValues(v1[i],v2[i]);
if(check!=0){return check
}}return 0
}else{return v1.length>v1.length?1:-1
}}else{return v1>v2?1:(v1<v2?-1:0)
}},pin:function(item){pins.push({pin:item,scroll:{top:0,left:0}});
if(!scrollInterval){CQ.Ext.EventManager.on(window,"scroll",function(){docScrolling=true;
window.setTimeout(function(){docScrolling=false
},274)
});
scrollInterval=window.setInterval(function(){checkPins()
},195)
}},unpin:function(item){for(var i=0;
i<pins.length;
i++){if(pins[i].pin==item){pins.splice(i,1);
break
}}},createId:function(id){id=id?id:"cq-id";
if(!idCounter[id]){idCounter[id]=0
}return id+"-"+idCounter[id]++
},isIntersecting:function(firstObj,secondObj,exclude){if(firstObj&&secondObj){for(var prop in firstObj){if((!exclude||!exclude[prop])&&secondObj[prop]==firstObj[prop]){return true
}}}return false
},runComponentObservation:function(interval,rerun){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){try{if(obs.components[i].observe){obs.components[i].observe(obs.name)
}else{CQ.Log.warn("CQ.Util#runComponentObservation: component has no method observe")
}}catch(e){CQ.Log.error("CQ.Util#runComponentObservation: observe method throws an exception: {0}",e.message)
}}if(rerun){window.setTimeout("CQ.Util.runComponentObservation('"+obs.name+"', true);",obs.time)
}},observeComponent:function(component,interval){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){if(obs.components[i]==component){return 
}}obs.components.push(component);
if(!obs.started){obs.started=true;
CQ.Util.runComponentObservation(obs.name,true)
}},cancelObservation:function(component,interval){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){if(obs.components[i]==component){obs.components.splice(i,1);
return 
}}},getFlashVersion:function(){var flashVer=null;
if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";
var flashDescription=navigator.plugins["Shockwave Flash"+swVer2].description;
var descArray=flashDescription.split(" ");
var tempArrayMajor=descArray[2].split(".");
var versionMajor=tempArrayMajor[0];
var versionMinor=tempArrayMajor[1];
var versionRevision=descArray[3];
if(versionRevision==""){versionRevision=descArray[4]
}if(versionRevision[0]=="d"){versionRevision=versionRevision.substring(1)
}else{if(versionRevision[0]=="r"){versionRevision=versionRevision.substring(1);
if(versionRevision.indexOf("d")>0){versionRevision=versionRevision.substring(0,versionRevision.indexOf("d"))
}}}flashVer=[parseInt(versionMajor),parseInt(versionMinor),parseInt(versionRevision)]
}}else{if(CQ.Ext.isIE&&CQ.Ext.isWindows&&!CQ.Ext.isOpera){var version;
var axo;
try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
version=axo.GetVariable("$version")
}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
version="WIN 6,0,21,0";
axo.AllowScriptAccess="sameDomain";
version=axo.GetVariable("$version")
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version=axo.GetVariable("$version")
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version="WIN 3,0,18,0"
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
version="WIN 2,0,0,11"
}catch(e){}}if(version){var platformSplit=version.split(" ");
if(platformSplit.length==2){flashVer=platformSplit[1].split(",");
for(var i=0;
i<flashVer.length;
i++){flashVer[i]=parseInt(flashVer[i])
}}}}}return flashVer
},isEqualPosition:function(position1,position2,tolerance){if(!tolerance){tolerance=0
}if(position1&&position2){var xdiff=Math.abs(position1[0]-position2[0]);
var ydiff=Math.abs(position1[1]-position2[1]);
return(xdiff<=tolerance)&&(ydiff<=tolerance)
}return false
},findFormFields:function(container,fields){if(!container){return{}
}if(!fields){fields=new Object()
}if(container.items&&container.items.length){for(var i=0;
i<container.items.length;
i++){var item=container.getComponent(i);
if(item.isFormField){var name=item.getName();
if(!name){name=item.name
}if(fields[name]==undefined){fields[name]=new Array()
}fields[name].push(item)
}else{if(item.items){fields=CQ.Util.findFormFields(item,fields)
}}}}return fields
},enableFields:function(container){var fields=CQ.Util.findFormFields(container);
for(var name in fields){for(var i=0;
i<fields[name].length;
i++){var field=fields[name][i];
if(field){if(field.enable){field.enable()
}if(field.dropTargets){for(var i=0;
i<field.dropTargets.length;
i++){if(field.dropTargets[i].unlock){field.dropTargets[i].unlock()
}}}}}}},disableFields:function(container){var fields=CQ.Util.findFormFields(container);
for(var name in fields){for(var i=0;
i<fields[name].length;
i++){var field=fields[name][i];
if(field){if(field.disable){field.disable()
}if(field.dropTargets){for(var i=0;
i<field.dropTargets.length;
i++){if(field.dropTargets[i].lock){field.dropTargets[i].lock()
}}}}}}},toggleComponent:function(component,enableCondition){if(component){enableCondition?component.enable():component.disable()
}},logout:function(){CQ.User.logout()
},isAcceptedMimeType:function(acceptPatternArray,mimeType){for(var i=0;
i<acceptPatternArray.length;
i++){var acceptPattern=acceptPatternArray[i];
if(mimeType.match(acceptPattern)){return true
}}return false
},escapePath:function(path){var pathComponents=path.split("/");
CQ.Ext.each(pathComponents,function(item,index){pathComponents[index]=encodeURIComponent(item)
});
return pathComponents.join("/")
},sortByRanking:function(array){try{array.sort(function(a,b){try{var result=a.ranking-b.ranking;
if(!isNaN(result)){return result
}}catch(e){}var ar=isNaN(a.ranking)?"X":parseInt(a.ranking);
var br=isNaN(b.ranking)?"X":parseInt(b.ranking);
ar=ar!="X"?ar:(br=="X"?0:br+1);
br=br!="X"?br:ar+1;
return ar-br
})
}catch(e){}return array
},isEmptyObject:function(obj){if(!obj){return false
}for(var p in obj){return false
}return true
},renderDate:function(date){if(!date){return""
}var ms=new Date(date).getElapsed();
var seconds=Math.floor(ms/1000);
var minutes=Math.floor(ms/(60*1000));
var hours=Math.floor(ms/(60*60*1000));
var days=Math.floor(ms/(24*60*60*1000));
var weeks=Math.floor(ms/(7*24*60*60*1000));
var months=Math.floor(ms/(30*24*60*60*1000));
var years=Math.floor(ms/(365*24*60*60*1000));
if(seconds<80){return CQ.I18n.getMessage("now")
}else{if(minutes<2){return CQ.I18n.getMessage("{0} seconds ago",""+seconds)
}else{if(hours<2){return CQ.I18n.getMessage("{0} minutes ago",""+minutes)
}else{if(days<2){return CQ.I18n.getMessage("{0} hours ago",""+hours)
}else{if(weeks<2){return CQ.I18n.getMessage("{0} days ago",""+days)
}else{if(months<2){return CQ.I18n.getMessage("{0} weeks ago",""+weeks)
}else{if(years<2){return CQ.I18n.getMessage("{0} months ago",""+months)
}else{return CQ.I18n.getMessage("{0} years ago",""+years)
}}}}}}}},formatFileSize:function(size){var unit;
if(size<1000){unit="bytes"
}else{if(size<1048576){size=Math.round(size/1024);
unit="KB"
}else{if(size<1073741824){size=new String(size/1048576);
unit="MB"
}else{size=new String(size/1073741824);
unit="GB"
}var point=size.indexOf(".");
if(point>0){if(size.charAt(point+1)=="0"){size=size.substring(0,point)
}else{size=size.substring(0,point+2)
}}}}return size+" "+unit
},getAbsoluteParent:function(path,level){if(path&&path.indexOf("/")==0&&level>0){var newPath="";
var segments=path.split("/");
segments.splice(0,1);
if(level>segments.length){return path
}var i=0;
while(i<=level-1&&i<segments.length){newPath+="/"+segments[i];
i++
}return newPath
}return path
}}
}();
CQ.Util=CQ.utils.Util;
CQ.utils.Log=function(){var logCounter=0;
var logLevelNames={0:" OFF ",1:"FATAL",2:"ERROR",3:"WARN ",4:"INFO ",5:"DEBUG",6:"TRACE",7:" ALL "};
var getInitialLogLevel=function(){if(window.CQ_initial_log_level){if(typeof window.CQ_initial_log_level==="string"){for(var i in logLevelNames){if(logLevelNames[i].indexOf(window.CQ_initial_log_level)>=0){return i
}}}else{if(typeof window.CQ_initial_log_level==="number"){return window.CQ_initial_log_level
}}}return 0
};
var logLevel=getInitialLogLevel();
var log=function(level,message,snippets){if(logLevel>=level){var text=(++logCounter)+"";
var i=text.length;
while((4-i)>0){text="0"+text;
i++
}text+=" "+logLevelNames[level];
text+=" "+CQ.Ext.util.Format.date(new Date(),"H:m:s");
text+=" "+CQ.Util.patchText(message,snippets);
try{console.log(text)
}catch(e){}}};
return{OFF:0,FATAL:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,ALL:7,setLevel:function(level){logLevel=level;
try{var console=CQ.Ext.get("x-debug-browser");
if(level==CQ.utils.Log.OFF){console.hide()
}else{console.show()
}}catch(e){}},fatal:function(message,snippets){log(CQ.utils.Log.FATAL,message,snippets)
},error:function(message,snippets){log(CQ.utils.Log.ERROR,message,snippets)
},warn:function(message,snippets){log(CQ.utils.Log.WARN,message,snippets)
},info:function(message,snippets){log(CQ.utils.Log.INFO,message,snippets)
},debug:function(message,snippets){log(CQ.utils.Log.DEBUG,message,snippets)
},trace:function(message,snippets){log(CQ.utils.Log.TRACE,message,snippets)
},traceMethodCalls:function(obj,xtype,onlyOwnMethods,loggerFunc){loggerFunc=loggerFunc||function(objName,methodName,argList,args){console.log(">> "+objName+"."+methodName+"("+argList+")")
};
function functionLogger(objName,funcName){return function(){var argList="";
CQ.Ext.each(arguments,function(o,i,array){var arg;
if(typeof o==="string"){arg='"'+o+'"'
}else{if(typeof o==="function"){arg="function("+o.length+")"
}else{arg=o
}}argList=argList+arg;
if(i<(array.length-1)){argList+=", "
}});
loggerFunc(objName,funcName,argList,arguments)
}
}var objName=(typeof obj==="string"?obj:xtype||"");
var clazz;
if(typeof obj==="string"){eval("clazz = "+obj+".prototype; var tmp = "+obj+"; "+obj+" = "+obj+".createInterceptor(functionLogger('"+obj+"', 'constructor')); for (var x in tmp) {     "+obj+"[x] = tmp[x]; } if (xtype) {     CQ.Ext.reg(xtype, "+obj+"); } ")
}else{clazz=obj
}var logInheritedMethods=onlyOwnMethods?false:true;
for(var i in clazz){if(logInheritedMethods||clazz.hasOwnProperty(i)){var o=clazz[i];
if(typeof o==="function"&&o.createInterceptor){clazz[i]=o.createInterceptor(functionLogger(objName,i))
}}}}}
}();
CQ.Log=CQ.utils.Log;
CQ.utils.HTTP=function(){var createResponse=function(){var response=new Object();
response.headers=new Object();
response.body=new Object();
return response
};
return{EXTENSION_HTML:CQ.shared.HTTP.EXTENSION_HTML,EXTENSION_JSON:CQ.shared.HTTP.EXTENSION_JSON,EXTENSION_RES:CQ.shared.HTTP.EXTENSION_RES,HEADER_STATUS:CQ.shared.HTTP.HEADER_STATUS,HEADER_MESSAGE:CQ.shared.HTTP.HEADER_MESSAGE,HEADER_LOCATION:CQ.shared.HTTP.HEADER_LOCATION,HEADER_PATH:CQ.shared.HTTP.HEADER_PATH,PARAM_NO_CACHE:CQ.shared.HTTP.PARAM_NO_CACHE,get:function(url,callback,scope){url=CQ.HTTP.externalize(url,true);
if(typeof CQ_XHR_HOOK!="undefined"&&CQ.Ext.isFunction(CQ_XHR_HOOK)){var p={url:url,method:"GET"};
try{var out=CQ_XHR_HOOK(p);
if(out){url=out.url
}}catch(e){CQ.Log.error("CQ.utils.HTTP#get: error during CQ_XHR_HOOK call: {0}",[url,e.message])
}}if(callback!=undefined){CQ.Log.debug("CQ.utils.HTTP#get: requesting {0} asynchronously",url);
return CQ.Ext.Ajax.request({url:url,callback:callback,scope:scope})
}else{CQ.Log.debug("CQ.utils.HTTP#get: requesting {0} synchronously",url);
var request=document.all?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
try{request.open("GET",url,false);
request.send(null);
var response=createResponse();
response.body=request.responseText;
response.headers[CQ.utils.HTTP.HEADER_STATUS]=request.status;
response.responseText=request.responseText;
response.status=request.status;
return response
}catch(e){CQ.Log.error("CQ.utils.HTTP#get: failed to get {0}: {1}",[url,e.message]);
return null
}}},post:function(url,callback,params,scope,suppressErrorMsg){url=CQ.HTTP.externalize(url,true);
if(typeof CQ_XHR_HOOK!="undefined"&&CQ.Ext.isFunction(CQ_XHR_HOOK)){var p={url:url,method:"POST",params:params};
try{var out=CQ_XHR_HOOK(p);
if(out){url=out.url;
params=out.params
}}catch(e){CQ.Log.error("CQ.utils.HTTP#get: error during CQ_XHR_HOOK call: {0}",[url,e.message])
}}if(callback!=undefined){CQ.Log.debug("CQ.utils.HTTP#post: requesting {0} asynchronously",url);
return CQ.Ext.Ajax.request({url:url,method:"POST",callback:function(options,success,xhr){var response=CQ.HTTP.buildPostResponseFromHTML(xhr.responseText);
if(!CQ.utils.HTTP.isOk(response)&&!suppressErrorMsg){CQ.Notification.notifyFromResponse(response)
}callback.call(this,options,success,xhr,response)
},params:params,scope:scope})
}else{CQ.Log.debug("CQ.utils.HTTP#post: requesting {0} synchronously",url);
var response=null;
var request=document.all?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
var tmp=url.split("?");
var url0=tmp[0];
var body=tmp[1]?tmp[1]:"";
var p=CQ.Ext.urlEncode(params);
body+=(p?(body?"&":"")+p:"");
try{request.open("post",url0,false);
request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
request.send(body);
response=CQ.HTTP.buildPostResponseFromHTML(request.responseText);
if(!CQ.utils.HTTP.isOk(response)&&!suppressErrorMsg){CQ.Notification.notifyFromResponse(response)
}return response
}catch(e){CQ.Log.error("CQ.utils.HTTP#post: failed to post {0}: {1}",[url,e.message])
}return response
}},getParameter:function(url,name){return CQ.shared.HTTP.getParameter(url,name)
},getParameters:function(url,name){return CQ.shared.HTTP.getParameters(url,name)
},addParameter:function(url,name,value){return CQ.shared.HTTP.addParameter(url,name,value)
},setParameter:function(url,name,value){return CQ.shared.HTTP.setParameter(url,name,value)
},removeParameter:function(url,name){return CQ.shared.HTTP.removeParameter(url,name)
},removeParameters:function(url){return CQ.shared.HTTP.removeParameters(url)
},addSelector:function(url,selector,index){return CQ.shared.HTTP.addSelector(url,selector,index)
},setSelector:function(url,selector,index){return CQ.shared.HTTP.setSelector(url,selector,index)
},getAnchor:function(url){return CQ.shared.HTTP.getAnchor(url)
},setAnchor:function(url,anchor){return CQ.shared.HTTP.setAnchor(url,anchor)
},removeAnchor:function(url){return CQ.shared.HTTP.removeAnchor(url)
},noCaching:function(url){return CQ.shared.HTTP.noCaching(url)
},buildPostResponseFromNode:function(node,response){if(!node){return null
}if(response==undefined){response=createResponse()
}try{for(var i=0;
i<node.childNodes.length;
i++){var child=node.childNodes[i];
if(child.tagName){if(child.id){if(child.href){response.headers[child.id]=child.href
}else{response.headers[child.id]=child.innerHTML
}}response=CQ.utils.HTTP.buildPostResponseFromNode(child,response)
}}}catch(e){CQ.Log.error("CQ.utils.HTTP#buildPostResponseFromNode: "+e.message)
}return response
},buildPostResponseFromHTML:function(html){var response=createResponse();
try{if(html.responseText!=undefined){html=html.responseText
}else{if(typeof html!="string"){html=html.toString()
}}var div=document.createElement("div");
div.innerHTML=html;
response=CQ.utils.HTTP.buildPostResponseFromNode(div,response);
div=null
}catch(e){}return response
},isOkStatus:function(status){return CQ.shared.HTTP.isOkStatus(status)
},isOk:function(response){return CQ.shared.HTTP.isOk(response)
},getCookie:function(name){return CQ.shared.HTTP.getCookie(name)
},setCookie:function(name,value,path,days,domain,secure){return CQ.shared.HTTP.setCookie(name,value,path,days,domain,secure)
},clearCookie:function(name,path,domain,secure){return CQ.shared.HTTP.clearCookie(name,path,domain,secure)
},getSchemeAndAuthority:function(url){return CQ.shared.HTTP.getSchemeAndAuthority(url)
},getContextPath:function(){return CQ.shared.HTTP.getContextPath()
},detectContextPath:function(){return CQ.shared.HTTP.detectContextPath()
},externalize:function(url,encode){return CQ.shared.HTTP.externalize(url,encode)
},internalize:function(url,doc){return CQ.shared.HTTP.internalize(url,doc)
},getPath:function(url){return CQ.shared.HTTP.getPath(url)
},getSuffix:function(){return CQ.shared.HTTP.getSuffix()
},getSelectors:function(url){return CQ.shared.HTTP.getSelectors(url)
},getExtension:function(url){return CQ.shared.HTTP.getExtension(url)
},encodePathOfURI:function(url){return CQ.shared.HTTP.encodePathOfURI(url)
},encodePath:function(path){return CQ.shared.HTTP.encodePath(path)
},eval:function(response){return CQ.shared.HTTP.eval(response)
}}
}();
CQ.HTTP=CQ.utils.HTTP;
CQ.utils.I18n=function(){var dicts=new Object();
var initialized=false;
var urlPrefix="/libs/cq/i18n/dict.";
var urlSuffix=".json";
var currentLocale=null;
var languages=null;
return{LOCALE_DEFAULT:"en",init:function(config){if(!config){config=new Object()
}if(config.locale){CQ.utils.I18n.setLocale(config.locale)
}if(config.urlPrefix){CQ.utils.I18n.setUrlPrefix(config.urlPrefix)
}if(config.urlSuffix){CQ.utils.I18n.setUrlSuffix(config.urlSuffix)
}initialized=true
},getLocale:function(){return currentLocale?currentLocale:CQ.utils.I18n.LOCALE_DEFAULT
},setLocale:function(locale){currentLocale=locale
},setUrlPrefix:function(prefix){urlPrefix=prefix
},setUrlSuffix:function(suffix){urlSuffix=suffix
},getDictionary:function(locale){if(!locale){locale=CQ.utils.I18n.getLocale()
}if(!dicts[locale]){CQ.Log.debug("CQ.utils.I18n#getDictionary: loading dictionary for locale '{0}'",locale);
var url=urlPrefix+locale+urlSuffix;
try{var response=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(response)){dicts[locale]=CQ.Util.eval(response);
CQ.Log.debug("CQ.utils.I18n#getDictionary: dictionary for locale '{0}' loaded",locale)
}}catch(e){CQ.Log.warn("CQ.utils.I18n#getDictionary: {0}",e.message)
}if(!dicts[locale]){CQ.Log.warn("CQ.utils.I18n#getDictionary: failed to load dictionary from {0}",url);
dicts[locale]={}
}}return dicts[locale]
},getMessage:function(text,snippets,note){var dict,newText,lookupText;
lookupText=note?text+" (("+note+"))":text;
if(initialized){dict=CQ.utils.I18n.getDictionary()
}if(dict){newText=dict[lookupText]
}if(!newText){newText=text
}CQ.Log.trace("CQ.utils.I18n#getMessage: translating '{0}' with '{1}'",[text,newText]);
return CQ.Util.patchText(newText,snippets)
},getVarMessage:function(text,note){if(!text){return null
}return this.getMessage(text,null,note)
},getLanguages:function(){if(!languages){try{var json=CQ.HTTP.eval("/libs/wcm/core/resources/languages.infinity.json");
CQ.Ext.iterate(json,function(name,lang){lang.title=lang.language;
if(lang.title&&lang.country&&lang.country!="*"){lang.title+=" ("+lang.country+")"
}});
languages=json
}catch(e){CQ.Log.error("CQ.I18n#getLanguages failed: "+e.message);
languages={}
}}return languages
},parseLocale:function(langCode){if(!langCode){return null
}var pos=langCode.indexOf("_"),language,country;
if(pos<0){language=langCode;
country=null
}else{language=langCode.substring(0,pos);
country=langCode.substring(pos+1)
}return{code:langCode,language:language,country:country}
}}
}();
CQ.I18n=CQ.utils.I18n;
CQ.utils.DOM=function(){var DEFAULT_STYLES={"font-weight":"normal","font-style":"normal","font-variant":"normal","text-transform":"none","text-decoration":"none","text-indent":"0","letter-spacing":"normal","word-spacing":"normal","line-height":"normal","text-align":"left","vertical-align":"baseline",direction:"ltr","background-color":"transparent","background-image":"none","background-repeat":"repeat","background-attachment":"scroll","background-position":"top left",opacity:"1",width:"auto",height:"auto",top:"auto",right:"auto",bottom:"auto",left:"auto",margin:"0",padding:"0","border-style":"none","border-width":"0",position:"static",display:"inline",visibility:"visible",overflow:"visible","white-space":"normal","float":"none",clear:"none",cursor:"auto","list-style":"disc outside none"};
var buildDefaultStyles=function(styles){var defaults=CQ.Util.copyObject(DEFAULT_STYLES);
return CQ.Util.merge(defaults,styles)
};
var DEFAULT_STYLES_BLOCK=buildDefaultStyles({display:"block"});
var DEFAULT_STYLES_TABLE=buildDefaultStyles({display:"table","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TBODY=buildDefaultStyles({display:"table-row-group","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TR=buildDefaultStyles({display:"table-row","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TD=buildDefaultStyles({display:"table-cell","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_INPUT=buildDefaultStyles({"background-color":"#FF0000",padding:"1px 0 1px 0","border-width":"2px","border-color":"#F0F0F0","border-style":"inset"});
return{getBlockDefaultStyles:function(){return CQ.Util.copyObject(DEFAULT_STYLES_BLOCK)
},executeScripts:function(element){if(!element&&!element.dom){return 
}var scripts=CQ.Ext.DomQuery.select("script",element.dom);
for(var i=0;
i<scripts.length;
i++){if(scripts[i].src){try{var response=CQ.HTTP.get(scripts[i].src);
if(CQ.HTTP.isOk(response)){if(window.execScript){window.execScript(scripts[i].innerHTML)
}else{eval.call(null,response.body?response.body:response.responseText)
}}}catch(err){}}if(scripts[i].innerHTML){try{if(window.execScript){window.execScript(scripts[i].innerHTML)
}else{eval.call(null,scripts[i].innerHTML)
}}catch(err){}}}},encodeId:function(str){if(!str){return""
}var encStr="";
for(var i=0;
i<str.length;
i++){var c=str.charCodeAt(i);
if(c==45||c==46||c==95||c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){encStr+=str.charAt(i)
}else{encStr+=":"+str.charCodeAt(i)
}}return encStr
},encodeClass:function(str,prefix){if(!str){return""
}var encStr="";
for(var i=0;
i<str.length;
i++){var c=str.charCodeAt(i);
if(c==45||c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){encStr+=str.charAt(i)
}else{encStr+="_"+str.charCodeAt(i)
}}if(prefix==undefined){prefix="cq"
}prefix=prefix?prefix+"-":"";
return prefix+encStr
},clearDocumentSelection:function(win){if(!win){win=window
}if(CQ.Ext.isIE){win.document.selection.empty()
}else{win.getSelection().removeAllRanges()
}}}
}();
CQ.DOM=CQ.utils.DOM;
CQ.utils.Notification=function(){var B;
var C=4;
function A(G,F,E){var D='<div class="cq-notification-msg">';
D+='<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>';
D+='<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc">';
if(G){if(E){G=CQ.shared.XSS.getXSSValue(G)
}D+='<span class="cq-notification-msg-title">'+G+"</span>"
}if(E){F=CQ.shared.XSS.getXSSValue(F)
}D+='<span class="cq-notification-msg-content">'+F+"</span>";
D+="</div></div></div>";
D+='<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div></div>';
return D
}return{notify:function(I,H,F,G){if(!B){B=CQ.Ext.DomHelper.insertFirst(CQ.Util.ROOT_ID,{id:"cq-notification-div"},true)
}B.alignTo(document,"tr-tr",[-20,4]);
var D=CQ.Ext.DomHelper.append(B,{html:A(I,H,G)},true);
B.on("click",function(){D.stopFx()
});
var E=F?F:C;
D.slideIn("t").pause(E).ghost("t",{remove:true})
},notifyFromResponse:function(D,E,G){var F=D.headers[CQ.HTTP.HEADER_MESSAGE];
F=F!=undefined?F:CQ.I18n.getMessage("Unspecified error");
CQ.Notification.notify(null,F,E,G)
}}
}();
CQ.Notification=CQ.utils.Notification;
CQ.utils.Sling=CQ.shared.Sling;
CQ.utils.WCM=function(){var currentMode=null;
var editConfigs=[];
var editables={};
var pagePath=null;
var dialogs={};
var dropTargetComponents=[];
var defaultEditConfig={xtype:"editrollover"};
var readOnly=false;
var defaultSidekickConfig={xtype:"sidekick"};
var layers=null;
var getCurrentElement=function(path,finder){var scripts=document.getElementsByTagName("script");
try{var toFind=finder.replace("$PATH$",path);
var testScript=function(script){return(script.innerHTML.indexOf(toFind)!=-1)
};
var selectedScript=scripts[scripts.length-1];
if(!testScript(selectedScript)){for(var i=0;
i<scripts.length;
i++){if(testScript(scripts[i])){selectedScript=scripts[i];
break
}}}if(selectedScript){var element=selectedScript.parentNode;
return element.tagName!="head"?element:null
}return null
}catch(e){return null
}};
var clearSelection=function(e){if(window.CQ_selectionLocked){window.CQ_selectionLocked=false;
return 
}if(!e.shiftKey&&!e.ctrlKey){CQ.utils.WCM.getSelection().clear()
}else{CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}};
var isFormElement=function(elem){return elem&&elem.tagName&&(elem.tagName.toLowerCase()=="input"||elem.tagName.toLowerCase()=="textarea"||elem.tagName.toLowerCase()=="select")
};
var processKeyDown=function(e){if(isFormElement(e.getTarget())){return 
}try{var contentWin=CQ.utils.WCM.getContentWindow();
if(contentWin&&contentWin.CQ_inplaceEditComp){return 
}CQ.utils.WCM.altKey=e.altKey;
if(e.ctrlKey&&e.getCharCode()==67){CQ.utils.WCM.copy(CQ.utils.WCM.getSelectedItems())
}else{if(e.ctrlKey&&e.getCharCode()==88){CQ.utils.WCM.cut(CQ.utils.WCM.getSelectedItems())
}else{if(e.ctrlKey&&e.getCharCode()==86){var targets=CQ.utils.WCM.getSelectedItems();
if(targets.length>0){var target=targets[0];
var toPaste=CQ.utils.WCM.paste();
while(toPaste.length>0){var item=toPaste.shift();
if(e.altKey){target.referenceParagraph(item.path)
}else{if(item.action!=CQ.utils.WCM.ACTION_CUT){target.copyParagraph(item.path,item.resourceType)
}else{target.moveParagraph(item.path,item.resourceType)
}}}CQ.utils.WCM.deselect()
}}else{if(e.getCharCode()==e.DELETE){CQ.utils.WCM.remove(CQ.utils.WCM.getSelectedItems());
CQ.utils.WCM.getContentWindow().CQ.wcm.Annotation.removeSelectedSketch()
}}}}}catch(e){}};
var processKeyUp=function(e){CQ.utils.WCM.altKey=e.altKey
};
var editablesConfigSorter=function(a,b){if(a.path.lastIndexOf("/")>b.path.lastIndexOf("/")){return 1
}if(b.path.lastIndexOf("/")>a.path.lastIndexOf("/")){return -1
}return 0
};
var editableReadyListeners={};
var editableBeforeRenderListeners={};
var editablesReady=false;
var sidekickReady=false;
return CQ.Ext.apply(new CQ.Ext.util.Observable(),{initComponent:function(){CQ.utils.WCM.superclass.initComponent.call(this);
this.addEvents("sidekickready","editablesready","pageinfoloaded")
},pageInfos:{},componentLists:{},TIMEWARP_COOKIE:"timewarp",MODE_TIMEWARP:"timewarp",MODE_COOKIE:"wcmmode",MODE_COOKIE_PATH:CQ.HTTP.externalize("/"),MODE_EDIT:"edit",MODE_PREVIEW:"preview",MODE_DESIGN:"design",ACTION_COPY:"COPY",ACTION_CUT:"CUT",LAYERS_COOKIE:"wcmlayers",LAYERS_COOKIE_PATH:CQ.HTTP.externalize("/"),LAYER_LCSTATUS:"liveCopyStatusLayer",EDITABLE_SCRIPT_FINDER:'CQ.WCM.edit({"path":"$PATH$"',altKey:false,getMode:function(force){var currentMode;
if(force||!currentMode){currentMode=CQ.HTTP.getCookie(CQ.utils.WCM.MODE_COOKIE)
}if(CQ.HTTP.getCookie(CQ.utils.WCM.TIMEWARP_COOKIE)){return CQ.utils.WCM.MODE_TIMEWARP
}return currentMode
},setMode:function(mode){CQ.utils.WCM.setModeCss(mode);
CQ.HTTP.setCookie(CQ.utils.WCM.MODE_COOKIE,mode,CQ.utils.WCM.MODE_COOKIE_PATH);
CQ.HTTP.clearCookie(CQ.utils.WCM.TIMEWARP_COOKIE,"/");
currentMode=mode;
return currentMode
},setModeCss:function(mode){var doc=CQ.utils.WCM.getContentWindow().document;
var body=doc.body||doc.getElementsByTagName("body")[0];
if(!body){window.setTimeout(function(){CQ.utils.WCM.setModeCss(mode)
},300);
return 
}if(!mode){if(CQ.utils.WCM.isEditMode()){mode=CQ.utils.WCM.MODE_EDIT
}else{if(CQ.utils.WCM.isDesignMode()){mode=CQ.utils.WCM.MODE_DESIGN
}else{if(CQ.utils.WCM.isPreviewMode()){mode=CQ.utils.WCM.MODE_PREVIEW
}}}}var pre="cq-wcm-";
var b=CQ.Ext.get(body);
b.removeClass([pre+CQ.utils.WCM.MODE_EDIT,pre+CQ.utils.WCM.MODE_DESIGN,pre+CQ.utils.WCM.MODE_PREVIEW]);
b.addClass(pre+mode)
},isTimewarpMode:function(force){if(force){CQ.utils.WCM.getMode(force)
}var cookie=CQ.HTTP.getCookie(CQ.utils.WCM.TIMEWARP_COOKIE);
return(cookie&&cookie!="")
},isPreviewMode:function(force){return(CQ.utils.WCM.getMode(force)==CQ.utils.WCM.MODE_PREVIEW)
},isEditMode:function(force){var mode=CQ.utils.WCM.getMode(force);
return(!mode||mode==CQ.utils.WCM.MODE_EDIT)
},isDesignMode:function(force){return(CQ.utils.WCM.getMode(force)==CQ.utils.WCM.MODE_DESIGN)
},getLayers:function(){if(!layers){layers=CQ.Ext.state.Manager.get(CQ.utils.WCM.LAYERS_COOKIE)
}return(layers=(layers?layers:{}))
},isShownLayer:function(layer){return CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer]===true
},showLayer:function(layer){CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer]=true;
CQ.Ext.state.Manager.set(CQ.utils.WCM.LAYERS_COOKIE,CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers())
},hideLayer:function(layer){delete CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer];
CQ.Ext.state.Manager.set(CQ.utils.WCM.LAYERS_COOKIE,CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers())
},remove:function(item){if(!item){return 
}try{if(item instanceof Array&&item.length>0){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.getClipboard().remove(item[i])
}item[0].removeParagraph();
return 
}else{CQ.utils.WCM.getClipboard().remove(item);
item.removeParagraph()
}}catch(e){}CQ.utils.WCM.deselect()
},copy:function(item,additive,move){var clipboard=CQ.utils.WCM.getClipboard();
if(!item){clipboard.clear();
return null
}if(item instanceof Array){if(item.length>0){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.copy(item[i],additive,move);
if(!additive){additive=true
}}}else{clipboard.clear()
}return item
}if(!additive){clipboard.clear()
}if(!item.isActionCopyMove()){return item
}clipboard.add({path:item.path,title:item.path.substring(item.path.lastIndexOf("/")+1),icon:item.getIconPath(),resourceType:item.getResourceType(),xtype:item.xtype,action:move?CQ.utils.WCM.ACTION_CUT:CQ.utils.WCM.ACTION_COPY,hasAnnotations:item.hasAnnotations()});
return item
},cut:function(item,additive){return CQ.utils.WCM.copy(item,additive,true)
},paste:function(){var clipboard=CQ.utils.WCM.getClipboard();
var items=[];
var cutItems=[];
for(var i=0;
i<clipboard.items.length;
i++){var item=clipboard.items[i];
items.push(item);
if(item.action==CQ.utils.WCM.ACTION_CUT){cutItems.push(item)
}}for(var i=0;
i<cutItems.length;
i++){clipboard.remove(cutItems[i])
}return items
},getClipboardRecords:function(){var clipboard=CQ.utils.WCM.getClipboard();
var records=[];
for(var i=0;
i<clipboard.items.length;
i++){var item=clipboard.items[i];
records.push(new CQ.Ext.data.Record(item))
}return records
},getClipboard:function(finder){if(!finder&&CQ.utils.WCM.getContentFinder()){return CQ.utils.WCM.getContentFinder().getClipboard()
}else{if(!window.CQ_Clipboard){window.CQ_Clipboard=new CQ.Ext.util.MixedCollection()
}}return window.CQ_Clipboard
},clearClipboard:function(){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.clear()
},onClipboardChange:function(listener){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.on("add",listener);
clipboard.on("remove",listener);
clipboard.on("clear",listener);
CQ.Ext.EventManager.on(window.document,"unload",function(){CQ.utils.WCM.unClipboardChange(listener)
})
},unClipboardChange:function(listener){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.un("add",listener);
clipboard.un("remove",listener);
clipboard.un("clear",listener)
},select:function(item,additive,lock){var selection=CQ.utils.WCM.getSelection();
if(item&&selection.contains(item)){return item
}if(additive){CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}else{selection.clear()
}if(!item){selection.clear();
return item
}if(item instanceof Array){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.select(item[i],true)
}return item
}selection.add(item);
if(lock){window.CQ_selectionLocked=true
}if(!window.CQ_selectionObserved){CQ.Ext.EventManager.on(document.body,"click",clearSelection);
window.CQ_selectionObserved=1
}return item
},deselect:function(item,additive){var selection=CQ.utils.WCM.getSelection();
if(!item||!additive){selection.clear()
}else{if(item){selection.remove(item)
}}if(additive){CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}if(!selection.getCount()&&window.CQ_selectionObserved){CQ.Ext.EventManager.un(document.body,"click",clearSelection);
window.CQ_selectionObserved=0
}return item
},getSelectedItems:function(){var selection=CQ.utils.WCM.getSelection();
var items=[];
for(var i=0;
i<selection.items.length;
i++){items.push(selection.items[i])
}return items
},getSelection:function(){var win=CQ.utils.WCM.getContentWindow();
if(!win.CQ_Selection){win.CQ_Selection=new CQ.Ext.util.MixedCollection()
}return win.CQ_Selection
},onSelectionChange:function(listener){var selection=CQ.utils.WCM.getSelection();
selection.on("add",listener);
selection.on("remove",listener);
selection.on("clear",listener)
},unSelectionChange:function(listener){var selection=CQ.utils.WCM.getSelection();
selection.un("add",listener);
selection.un("remove",listener);
selection.un("clear",listener)
},getEditable:function(path){return editables[path]
},getNestedEditables:function(path){var res=[];
var parentSelector;
if(editables[path]&&editables[path].element){parentSelector="[id="+editables[path].element.id+"]"
}for(var p in editables){if(p.indexOf(path+"/")==0){if(parentSelector){if(editables[p].element.up(parentSelector)){res.push(p)
}}else{res.push(p)
}}}return res
},getEditables:function(){return editables
},unregisterEditable:function(path){delete editables[path]
},onEditableBeforeRender:function(path,listener,scope){if(listener){if(!editableBeforeRenderListeners[path]){editableBeforeRenderListeners[path]=[]
}editableBeforeRenderListeners[path].push({fct:listener,scope:scope})
}},onEditableReady:function(path,listener,scope){if(listener){if(!editableReadyListeners[path]){editableReadyListeners[path]=[]
}editableReadyListeners[path].push({fct:listener,scope:scope})
}},areEditablesReady:function(){return editablesReady
},isSidekickReady:function(){return sidekickReady
},makeEditable:function(config){if(!config.path){CQ.Log.error("CQ.util.WCM#makeEditable: path null or undefined");
return null
}var display=config.dialog||config.editConfig;
var editConfig=config.editConfig;
if(!editConfig){editConfig=CQ.Util.copyObject(defaultEditConfig)
}else{if(!editConfig.xtype){editConfig.xtype=defaultEditConfig.xtype
}}if(config.dialog){editConfig.dialog=config.dialog
}if(!display){editConfig.inactiveMode=true
}editConfig.path=config.path;
editConfig.cellSearchPath=config.csp;
editConfig.isContainer=config.isContainer;
if(config.type){if(!editConfig.params){editConfig.params={}
}if(!editConfig.params["./sling:resourceType"]){editConfig.params["./sling:resourceType"]=config.type
}}if(config.childConfig){editConfig.childConfig=config.childConfig
}if(!editConfig.element){if(config.element){editConfig.element=config.element
}else{editConfig.element=getCurrentElement(editConfig.path,this.EDITABLE_SCRIPT_FINDER)
}}if(config[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]){editConfig[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]=CQ.Util.copyObject(config[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP])
}if(this.enableEditablesQueue===true){this.editablesQueue.push(editConfig)
}else{if(CQ.Ext.isLoaded){return CQ.utils.WCM.createEditable(editConfig)
}else{editConfigs.push(editConfig);
if(editConfigs.length==1){CQ.Ext.onLoad(function(){editConfigs.sort(editablesConfigSorter);
CQ.Timing.stamp("start building editings","SBE",true);
window.setTimeout(CQ.utils.WCM.buildEditables,1)
})
}}}return null
},startMakeEditablesQueue:function(){this.enableEditablesQueue=true;
this.editablesQueue=[]
},endMakeEditablesQueue:function(){this.enableEditablesQueue=false;
this.editablesQueue.sort(editablesConfigSorter);
for(var i=0;
i<this.editablesQueue.length;
i++){CQ.utils.WCM.createEditable(this.editablesQueue[i])
}this.editablesQueue=[]
},createEditable:function(config){if(config&&config.path){var beforeRenderListeners=editableBeforeRenderListeners[config.path];
while(beforeRenderListeners&&beforeRenderListeners.length>0){var listenerObj=editableBeforeRenderListeners[config.path].shift();
if(listenerObj.fct.call(listenerObj.scope?listenerObj.scope:this,config)===false){return null
}}if(editables[config.path]){editables[config.path].hide()
}var editable=CQ.Util.build(config);
editables[config.path]=editable;
if(readOnly){editable.hide()
}var readyListeners=editableReadyListeners[config.path];
while(readyListeners&&readyListeners.length>0){var listenerObj=editableReadyListeners[config.path].shift();
listenerObj.fct.call(listenerObj.scope?listenerObj.scope:editable,editable)
}return editable
}return null
},buildEditables:function(){if(editConfigs.length==0){CQ.Timing.stamp("finished building editings","WCM#makeEditable");
editablesReady=true;
this.fireEvent("editablesready");
return 
}var editConfig=editConfigs.shift(editConfigs.length-1);
CQ.utils.WCM.createEditable(editConfig);
CQ.utils.WCM.buildEditables()
},show:function(){var refresh=true;
for(var i in editables){editables[i].show();
refresh=false
}if(refresh){CQ.Util.reload()
}},hide:function(){CQ.utils.WCM.deselect();
for(var i in editables){editables[i].hide()
}for(var i in dialogs){dialogs[i].hide()
}},hidePlaceholders:function(element){var placeholders=element.query("*[class*='-placeholder']");
for(var i=0;
i<placeholders.length;
i++){var clazz=placeholders[i].className;
if(clazz){var repl=clazz.replace(/(cq-.+-placeholder)(-off)?\b/,"$1-off");
if(repl!=clazz){placeholders[i].className=repl
}}}},showPlaceholders:function(element){var placeholders=element.query("*[class*='-placeholder']");
for(var i=0;
i<placeholders.length;
i++){var clazz=placeholders[i].className;
if(clazz){var repl=clazz.replace(/(cq-.+-placeholder)-off/,"$1");
if(repl!=clazz){placeholders[i].className=repl
}}}},getDialog:function(config,key,nocreate){if(nocreate){return key?dialogs[key]:null
}var dialogConfig,dialogKey,dialog;
if(typeof config=="string"&&dialogs[config]&&key!="NEW"){return dialogs[config]
}else{if(key&&dialogs[key]){return dialogs[key]
}else{if(typeof config!="object"||config.xtype!="dialog"){dialogConfig=CQ.utils.WCM.getDialogConfig(config)
}else{dialogConfig=config
}}}if(!dialogConfig){return null
}dialogKey=key;
if(!dialogKey){dialogKey=(typeof config=="string")?config:dialogConfig.path
}if(!dialogKey){dialogKey="dialog-"+new Date().valueOf()
}dialog=CQ.Util.build(dialogConfig,true);
if(dialogKey!="NEW"){dialogs[dialogKey]=dialog
}return dialog
},unregisterDialog:function(key){if(dialogs[key]&&dialogs[key].destroy){dialogs[key].destroy()
}delete dialogs[key]
},registerDialog:function(key,dlg){dialogs[key]=dlg
},getDialogConfig:function(config){var url;
var snippet;
if(typeof config=="string"){url=config
}else{if(config.url){url=config.url
}}if(url){var ext=CQ.HTTP.EXTENSION_JSON;
if(url.indexOf(ext)!=(url.length-ext.length)){url+=CQ.Sling.SELECTOR_INFINITY+ext
}url=CQ.HTTP.addSelector(url,"overlay");
try{var json=CQ.HTTP.eval(url);
snippet=CQ.Util.formatData(json)
}catch(e){CQ.Log.error("CQ.utils.WCM#getDialogConfig failed: "+e.message);
return null
}}else{snippet=CQ.Util.formatData(config)
}if(!snippet){CQ.Log.error("CQ.utils.WCM#getDialogConfig failed");
return null
}var dialogConfig;
if(snippet.xtype.indexOf("dialog")!=-1||snippet.xtype.indexOf("wizard")!=-1){dialogConfig=snippet
}else{dialogConfig={xtype:"dialog"};
if(snippet.xtype=="panel"&&snippet.title){dialogConfig.items={xtype:"tabpanel",items:snippet}
}else{dialogConfig.items=snippet
}}if(dialogConfig.buttons==undefined){dialogConfig.buttons=CQ.Dialog.OKCANCEL
}dialogConfig.helpPath=snippet.helpPath?snippet.helpPath:config.helpPath;
dialogConfig.responseScope=snippet.responseScope?snippet.responseScope:config.responseScope;
dialogConfig.success=snippet.success?snippet.success:config.success;
dialogConfig.failure=snippet.failure?snippet.failure:config.failure;
dialogConfig.params=snippet.params?snippet.params:config.params;
return dialogConfig
},getDialogs:function(){return dialogs
},launchSidekick:function(path,config,setup){window.setTimeout(function(){CQ.utils.WCM.internalLaunchSidekick(path,config,setup)
},1)
},internalLaunchSidekick:function(path,config,setup){CQ.utils.WCM.setModeCss();
if(path){pagePath=path;
var page=CQ.utils.WCM.getPage(path);
if(page.isReadOnly()){CQ.utils.WCM.setReadOnly(true);
config.readOnly=true
}}if(config&&config.url){var url=config.url;
var ext=CQ.HTTP.EXTENSION_JSON;
if(url.indexOf(ext)!=(url.length-ext.length)){url+=CQ.Sling.SELECTOR_INFINITY+ext
}try{var json=CQ.HTTP.eval(url);
var snippet=CQ.Util.formatData(json);
config=CQ.utils.Util.applyDefaults(snippet,config)
}catch(e){CQ.Log.error("CQ.utils.WCM#launchSidekick failed: "+e.message);
return null
}}if(!CQ.WCM.getTopWindow().CQ_Sidekick){var createSidekick=function(){CQ.WCM.getTopWindow().CQ.utils.WCM.createSidekick(path,config,setup)
};
if(CQ.Ext.isReady){window.setTimeout(createSidekick,1)
}else{CQ.Ext.onReady(function(){window.setTimeout(createSidekick,1)
});
return null
}}else{window.setTimeout(function(){CQ.WCM.getTopWindow().CQ_Sidekick.loadContent(path,config)
},1)
}},getSidekick:function(){return CQ.WCM.getTopWindow().CQ_Sidekick
},createSidekick:function(path,config,setup){if(typeof config!="string"){config=CQ.utils.Util.merge(config,defaultSidekickConfig)
}var sidekick=CQ.utils.Util.build(config);
if(setup){setup.call(sidekick)
}if(path){sidekick.loadContent(path,config)
}sidekick.show();
CQ.WCM.getTopWindow().CQ_Sidekick=sidekick;
sidekickReady=true;
this.fireEvent("sidekickready",CQ.WCM.getTopWindow().CQ_Sidekick)
},getPage:function(path){var info=CQ.utils.WCM.getPageInfo(path);
info=info.status?info:path;
return new CQ.wcm.Page(info,CQ.User.getCurrentUser())
},getDesign:function(path){if(!path){path=CQ.utils.WCM.getPagePath()
}var info=CQ.utils.WCM.getPageInfo(path);
if(!info.designObject){if(info.design.path){var url=CQ.HTTP.externalize(info.design.path+"/_jcr_content."+info.design.lastModified+".json/");
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){info.designObject=new CQ.wcm.Design(info.design.path,CQ.Util.eval(res))
}}}return info.designObject
},getPageInfo:function(path,forceLoad){if(path){var index=path.indexOf("/jcr:content");
if(index>0){path=path.substring(0,index)
}}var info=this.getContentWindow().CQ.utils.WCM.pageInfos[path];
if(!info||forceLoad){var url=CQ.HTTP.externalize("/libs/wcm/core/content/pageinfo.json");
url=CQ.HTTP.addParameter(url,"path",path);
url=CQ.HTTP.addParameter(url,"_charset_","utf8");
url=CQ.HTTP.noCaching(url);
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){info=CQ.Util.eval(res)
}else{info={}
}this.getContentWindow().CQ.utils.WCM.pageInfos[path]=info;
this.fireEvent("pageinfoloaded",this.getContentWindow().CQ.utils.WCM.pageInfos[path])
}return info
},getPageLanguage:function(path){return CQ.utils.WCM.getPageInfo(path).language
},getPageLocale:function(path){return CQ.I18n.parseLocale(CQ.utils.WCM.getPageInfo(path).language)
},getContentFinder:function(){return CQ.WCM.getTopWindow().CQ_ContentFinder
},getContentWindow:function(){var finder=CQ.utils.WCM.getContentFinder();
return finder?finder.getContentWindow():window
},getTopWindow:function(){var win=window;
try{while(win.parent&&win!==win.parent&&win.parent.location.href){win=win.parent
}}catch(error){}return win
},isContentWindow:function(win){if(!win){win=window
}return win==CQ.utils.WCM.getContentWindow()
},getContentUrl:function(){return CQ.utils.WCM.getContentWindow().location.href
},loadToolbar:function(toolbar){var finder=CQ.utils.WCM.getContentFinder();
if(finder){finder.loadToolbar(toolbar)
}else{CQ.Log.info("CQ.utils.WCM#loadToolbar: unable to load toolbar without content finder")
}if(!CQ.utils.WCM.getContentWindow().CQ_toolbarObserved){CQ.Ext.EventManager.on(CQ.utils.WCM.getContentWindow(),"unload",function(){CQ.utils.WCM.unloadToolbar()
},this);
CQ.utils.WCM.getContentWindow().CQ_toolbarObserved=1
}},unloadToolbar:function(){var finder=CQ.utils.WCM.getContentFinder();
if(finder){finder.unloadToolbar()
}else{CQ.Log.info("CQ.utils.WCM#loadToolbar: unable to unload toolbar without content finder")
}CQ.utils.WCM.getContentWindow().CQ_toolbarObserved=0
},getPagePath:function(){if(window!=CQ.utils.WCM.getContentWindow()){try{return CQ.utils.WCM.getContentWindow().CQ.WCM.getPagePath()
}catch(e){return""
}}if(pagePath){return pagePath
}else{return CQ.shared.HTTP.getPath()
}},setReadOnly:function(mode){readOnly=mode
},getDesignStyleOptions:function(contentPath){this.setOptions(CQ.utils.WCM.getStyleOptions.call(this,contentPath))
},getStyleOptions:function(contentPath){var dlg=this.findParentByType("dialog");
var cell=dlg?dlg.cell:null;
var value=null;
if(cell){var design=CQ.utils.WCM.getDesign();
if(design){value=design.getStyleProperty(cell,this.initialConfig.newStylePath)
}}try{if(!value){var suffix="";
if(contentPath.lastIndexOf("/*")>0){contentPath=contentPath.substring(0,contentPath.length-2);
if(this.initialConfig.newStylePath){suffix="/"+this.initialConfig.newStylePath
}}else{if(this.initialConfig.stylePath){suffix="/"+this.initialConfig.stylePath
}}var url=contentPath+".style.json"+suffix;
var json=CQ.Util.eval(url);
for(var a in json){value=json[a];
break
}}if(value){if(typeof value=="string"){value=value.split("\n")
}var opts=[];
for(var i=0;
i<value.length;
i++){var nm=value[i];
if(typeof nm=="string"){nm=nm.split("\t")
}opts.push({value:nm[0],text:nm[1]?nm[1]:nm[0]})
}return opts
}}catch(e){CQ.Log.error("CQ.utils.WCM#getStyleOptions failed: "+e.message)
}return[]
},setContentLanguageOptionsCB:function(){this.setOptions(CQ.utils.WCM.getLanguageOptions())
},getLanguageOptions:function(){try{var json=CQ.I18n.getLanguages();
var opts=[];
for(var name in json){var langObj=json[name];
var title=langObj.language;
if(title){var country=langObj.country;
if(country&&country!="*"){title+=" ("+country+")"
}opts.push({value:name,text:title})
}}opts.sort(function(l1,l2){if(l1.text<l2.text){return -1
}else{if(l1.text==l2.text){return 0
}else{return 1
}}});
return opts
}catch(e){CQ.Log.error("CQ.utils.WCM#getLanguageOptions failed: "+e.message)
}return[]
},getWorkflowPackageOptions:function(packages){try{var options=[];
for(var i=0;
i<packages.length;
i++){var wp=packages[i];
options.push({value:wp.path,text:wp.title})
}options.sort(function(l1,l2){if(l1.text<l2.text){return -1
}else{if(l1.text==l2.text){return 0
}else{return 1
}}});
return options
}catch(e){CQ.Log.error("CQ.utils.WCM#getWorkflowPackageOptions failed: "+e.message)
}return[]
},getContainerStepOptions:function(path,record){try{var options=[];
var json=CQ.HTTP.eval("/libs/cq/workflow/content/console/models.json");
var models=json.models;
if(models){var ommit="";
if(path){var index=path.indexOf("/jcr:content");
ommit=path.substring(0,index)
}for(var model in models){var modelObject=models[model];
var item=modelObject.item;
var doOmmit=0;
if(item){var doOmmit=item.search(ommit)
}if(doOmmit==-1){options.push({value:modelObject.item,text:modelObject.title,qtip:modelObject.description})
}}}return options
}catch(e){CQ.Log.error("CQ.utils.WCM#getContainerWorkflowOptions failed: "+e.message)
}return[]
},observeKeypress:function(win){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.utils.WCM.observeKeypress(win)
})
}else{if(!win){win=window
}var target=CQ.Ext.isIE?win.document:win;
if(!win.CQ_keypressObserved){CQ.Ext.EventManager.on(target,"keydown",processKeyDown);
CQ.Ext.EventManager.on(target,"keyup",processKeyUp);
win.CQ_keypressObserved=1;
CQ.Ext.EventManager.on(win.document,"unload",function(){CQ.Ext.EventManager.un(target,"keydown",processKeyDown);
CQ.Ext.EventManager.un(target,"keyup",processKeyUp)
})
}}},getComponentList:function(path){var list=this.getContentWindow().CQ.utils.WCM.componentLists[""];
if(!list){if(!path){path=CQ.utils.WCM.getPagePath()
}var info=CQ.utils.WCM.getPageInfo(path);
var compsRef=info.componentsRef;
if(!compsRef){compsRef="/libs/wcm/core/content/components.json"
}var url=CQ.HTTP.externalize(compsRef);
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){if(!path){path=CQ.utils.WCM.getPagePath()
}var idx=path.indexOf("/jcr:content");
if(idx>0){path=path.substring(0,idx)
}list=new CQ.wcm.ComponentList(path,CQ.Util.eval(res));
this.getContentWindow().CQ.utils.WCM.componentLists[""]=list
}}return list
},getComponentConfig:function(resourceType){try{var cl=CQ.utils.WCM.getComponentList();
var config=cl.getComponent(resourceType);
return CQ.Util.copyObject(config)
}catch(e){CQ.Log.error("CQ.util.WCM#getComponentConfig: unable to load components.");
return null
}},setContentWindowLoading:function(loading){CQ.WCM.getTopWindow().CQ_isContentWindowLoading=loading
},isContentWindowLoading:function(){return CQ.WCM.getTopWindow().CQ_isContentWindowLoading
},registerDropTargetComponent:function(dropTargetComp){dropTargetComponents.push(dropTargetComp)
},unregisterDropTargetComponent:function(dropTarget){var i=dropTargetComponents.indexOf(dropTarget);
if(i>=0){dropTargetComponents.splice(i,1)
}},getDropTargetComponents:function(){return dropTargetComponents
},getEmulatorManager:function(config){var cw=this.getContentWindow();
if(cw.CQ.wcm.emulator.EmulatorManager){return cw.CQ.wcm.emulator.EmulatorManager.getInstance(config)
}return null
}})
}();
CQ.WCM=CQ.utils.WCM;
CQ.WCM.edit=CQ.utils.WCM.makeEditable;
CQ.utils.Date=function(){var B=86400000;
var A=function(C){return C?C:new Date()
};
return{TODAY:CQ.I18n.getMessage("today"),YESTERDAY:CQ.I18n.getMessage("yesterday"),THIS_WEEK:CQ.I18n.getMessage("this week"),LAST_WEEK:CQ.I18n.getMessage("last week"),THIS_MONTH:CQ.I18n.getMessage("this month"),LAST_MONTH:CQ.I18n.getMessage("last month"),isToday:function(D,C){C=A(C);
return D.getTime()+B>C.getTime()&&D.getDate()==C.getDate()
},isYesterday:function(D,C){C=A(C);
return D.getTime()+(2*B)>C.getTime()&&!CQ.Date.isToday(D,C)
},isThisWeek:function(G,E,F){E=A(E);
var D=G.getDay();
var C=E.getDay();
if(F){D=D==0?7:D;
C=C==0?7:C
}if(G<=E){return(G.getTime()+(7*B)>E.getTime()&&D<C)||CQ.Date.isToday(G,E)
}else{return E.getTime()+(7*B)>G.getTime()&&C<=D
}},isLastWeek:function(E,C,D){C=A(C);
return !CQ.Date.isToday(E,C)&&CQ.Date.isThisWeek(E,new Date(C.getTime()-(7*B)),D)
},isThisMonth:function(D,C){C=A(C);
return D.getMonth()==C.getMonth()&&D.getFullYear()==C.getFullYear()
},isThisYear:function(D,C){return D.getFullYear()==A(C).getFullYear()
}}
}();
CQ.Date=CQ.utils.Date;
CQ.utils.S7={THUMBS_TEMPLATE:'<tpl for="."><tpl if="CQ.S7.hasQuery(values.thumb)"><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[values.thumb]}&wid=152&nanos={[values.nanos]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "type"))]}</nobr>{[values.type ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></div><span>{shortTitle}</span></div></tpl><tpl if="CQ.S7.hasQuery(values.thumb)==false"><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[values.thumb]}?wid=152&nanos={[values.nanos]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "type"))]}</nobr>{[values.type ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></div><span>{shortTitle}</span></div></tpl></tpl><div class="x-clear"></div>',DETAILS_TEMPLATE:'<tpl for="."><tpl if="CQ.S7.hasQuery(values.thumb)"><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{pathEncodedTitle}" class="cq-cft-search-thumb" style="background-image:url(\'{[values.thumb]}&wid=64\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "type") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "type") + " " + (CQ.shared.XSS.getXSSTablePropertyValue(values, "cqContent") == "true" ? "(CQ)" : "") + "</div>" : ""]}{[CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") + "</div>" : ""]}</div><div class="cq-cft-search-separator"></div></div></tpl><tpl if="CQ.S7.hasQuery(values.thumb)==false"><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{pathEncodedTitle}" class="cq-cft-search-thumb" style="background-image:url(\'{[values.thumb]}?wid=64\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "type") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "type") + " " + (CQ.shared.XSS.getXSSTablePropertyValue(values, "cqContent") == "true" ? "(CQ)" : "") + "</div>" : ""]}{[CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") + "</div>" : ""]}</div><div class="cq-cft-search-separator"></div></div></tpl></tpl>',hasQuery:function(A){return A.indexOf("?")==-1?false:true
},getCqRootPath:function(){var B="/libs/dam/scene7/config/servlet";
B=CQ.HTTP.addParameter(B,"prop","cqRootPath");
var C=CQ.HTTP.get(B);
var A=JSON.parse(C.responseText);
if(A!=null&&A.cqRootPath){return A.cqRootPath.substring(0,A.cqRootPath.length-1)
}else{return""
}},getRootPath:function(){var B="/libs/dam/scene7/config/servlet";
B=CQ.HTTP.addParameter(B,"prop","rootPath");
var C=CQ.HTTP.get(B);
var A=JSON.parse(C.responseText);
if(A!=null&&A.rootPath){return A.rootPath.substring(0,A.rootPath.length-1)
}else{return""
}},getDefaultSearchQualifiers:function(){return{assetType:"Flash,Image,Template,AdjustedView,Video,MasterVideo"}
},getSearchQualifiers:function(){var C=new Object();
var D=CQ.Ext.getCmp("cfTab-S7Browse-Tree").getSelectionModel().getSelectedNode();
if(D!=null){C.path=CQ.shared.HTTP.encodePath(D.getPath()+"/")
}var B=CQ.Ext.getCmp("cfTab-S7Browse-searchField").getRawValue();
if(B!=""){C.searchTerm=CQ.shared.HTTP.encodePath(B)
}var A=CQ.Ext.getCmp("cfTab-S7Browse-assetType").getValue();
if(A!=""&&A!="None"){if(A=="Video"){A="Video,MasterVideo"
}C.assetType=A
}else{C.assetType="Flash,Image,Template,AdjustedView,Video,MasterVideo"
}return C
},setSearchQualifiers:function(A){var B=CQ.S7.getSearchQualifiers();
A.baseParams=null;
A.lastOptions=null;
if(B.path!=null){A.setBaseParam("path",B.path)
}if(B.searchTerm!=null){A.setBaseParam("searchTerm",B.searchTerm)
}if(B.assetType!=null){A.setBaseParam("assetType",B.assetType)
}},appendQuery:function(B,D){if(D==null||D==""){return B
}var A=(D.charAt(0)=="&");
var C=(D.charAt(0)=="?");
if(B.indexOf("?")==-1){if(A){return B+"?"+D.substring(1)
}else{if(C){return B+D
}else{return B+"?"+D
}}}else{if(CQ.S7.endsWith(B,"?")){if(A||C){return B+D.substring(1)
}else{return B+D
}}else{if(A){return B+D
}else{if(C){return B+"&"+D.substring(1)
}else{return B+"&"+D
}}}}},endsWith:function(C,B){var A=C.lastIndexOf(B);
return(A>=0&&A==C.length-B.length)
},findLimits:function(E,D,C){var B=E.indexOf(D);
var A=-1;
if(B!=-1){A=E.indexOf(C,B)
}return[B,A]
}};
CQ.S7=CQ.utils.S7;
CQ.User=function(infoData){if(infoData){this.data=infoData
}else{var url=this.getUserPropsUrl();
url=CQ.HTTP.noCaching(url);
var response=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(response)){this.data=CQ.Util.eval(response)
}}if(this.data){if(this.data.preferences){this.preferencesProvider=new CQ.state.PreferencesProvider({data:this.data.preferences,id:CQ.User.PREFERENCES_PROVIDER_ID})
}var data=new Object();
var fields=new Array();
if(this.data.permissions){var per=this.data.permissions;
var i=0;
for(var n in per){data[i++]=n;
fields.push(n)
}}this.permissionStore=new CQ.Ext.data.SimpleStore({id:0,data:[data],fields:fields,autoLoad:false})
}else{this.data={}
}};
CQ.User.prototype=function(){return{data:null,language:null,preferencesProvider:null,userPropsPath:null,permissionStore:null,isImpersonated:function(){return this.data.impersonated
},isImperonated:function(){return this.isImpersonated()
},getUserID:function(){return this.data.userID
},getAuthType:function(){return this.data.authType
},getUserName:function(A){return A&&this.data[CQ.shared.XSS.getXSSPropertyName("userName")]?this.data[CQ.shared.XSS.getXSSPropertyName("userName")]:this.data.userName
},getHome:function(){return CQ.HTTP.encodePath(this.data.home)
},getLanguage:function(){if(!this.language&&this.preferencesProvider){var A=this.preferencesProvider.get(CQ.User.LANGUAGE);
if(!A){A=this.preferencesProvider.get(CQ.User.PLATFORM_LANGUAGE)
}this.language=A||"en"
}return this.language
},getLocale:function(){return CQ.WCM.parseLocale(this.getLanguage())
},getAllowedApps:function(){return this.data.allowedApps
},getPreference:function(A){return this.preferencesProvider?this.preferencesProvider.get(A):null
},hasPermission:function(A){return this.hasPermissionOn(A)
},hasPermissionOn:function(A,C){var B=CQ.Ext.StoreMgr.lookup(CQ.User.PRIVILEGES_STORE_ID);
if(!B){B=this.permissionStore
}if(!C){C="/"
}var D=B.getById(C);
return D!=undefined&&D&&D.get(A)
},sudoAs:function(A){this.postImpersonation(A)
},revertSelf:function(){this.postImpersonation("-")
},login:function(A){CQ.User.login(null,A)
},getUserPropsUrl:function(){if(!this.userPropsPath){this.userPropsPath=CQ.User.PROXY_URI
}return this.userPropsPath
},postImpersonation:function(B){var C=this.getHome()+".impersonate"+CQ.HTTP.EXTENSION_JSON;
C=CQ.HTTP.addParameter(C,"impersonate",B);
var A=CQ.Ext.getDoc().dom.URL;
C=CQ.HTTP.addParameter(C,"path",CQ.HTTP.getPath(A));
C=CQ.HTTP.noCaching(CQ.HTTP.externalize(C)+CQ.HTTP.EXTENSION_HTML);
CQ.shared.Util.reload(document,C)
},setPermissionStore:function(A){this.permissionStore=A
},getPath:function(A){var B=A.replace(/.*\:[\/][\/]/,"");
B=B.substring(B.indexOf("/"));
if(B.indexOf("?")>=0){B=B.substring(0,B.indexOf("?"))
}if(B.indexOf("#")>=0){B=B.substring(0,B.indexOf("#"))
}if(B.indexOf(".")>-1){B=B.substring(0,B.indexOf("."))
}return B
}}
}();
CQ.User.getCurrentUser=function(){var A=CQ.WCM.getTopWindow();
if(!A.CQ_User){A.CQ_User=new CQ.User()
}return A.CQ_User
};
CQ.User.getUserID=function(){return CQ.User.getCurrentUser().getUserID()
};
CQ.User.getUserName=function(A){return CQ.User.getCurrentUser().getUserName(A)
};
CQ.User.PROXY_URI=CQ.HTTP.externalize("/libs/cq/security/userinfo"+CQ.HTTP.EXTENSION_JSON);
CQ.User.PREFERENCES_PROVIDER_ID="cq-security-preferences-provider";
CQ.User.PRIVILEGES_STORE_ID="cq-security-privileges-store";
CQ.User.PERMISSION_UPDATE="update";
CQ.User.ADMIN="admin";
CQ.User.ANONYMOUS="anonymous";
CQ.User.LANGUAGE="language";
CQ.User.PLATFORM_LANGUAGE="platform/language";
CQ.User.LOGIN_SERVLET_URL="/bin/login.html";
CQ.User.TOKEN_LOGIN_SERVLET_URL="/libs/cq/core/content/login.html";
CQ.User.LOGOUT_URL="/system/sling/logout.html";
CQ.User.login=function(C,G){var A=CQ.HTTP.externalize(CQ.User.LOGIN_SERVLET_URL);
var D=CQ.HTTP.addParameter(A,"resource",CQ.utils.WCM.getPagePath()||"/");
if(navigator.userAgent.indexOf("MSIE")>0||navigator.userAgent.indexOf("Firefox")>0){var F;
if(window.XMLHttpRequest){F=new XMLHttpRequest()
}else{if(window.ActiveXObject){try{F=new ActiveXObject("Msxml2.XMLHTTP")
}catch(E){F=new ActiveXObject("Microsoft.XMLHTTP")
}}}if(F.readyState<4){F.abort()
}if(!C){C=CQ.User.getCurrentUser().getUserID()
}F.open("POST",D,false,C,G);
F.send("");
return F.status==200
}else{A=CQ.HTTP.externalize(CQ.User.TOKEN_LOGIN_SERVLET_URL);
D=CQ.HTTP.addParameter(A,"resource",CQ.utils.WCM.getPagePath()||"/");
var B=CQ.HTTP.post(D,callback,{_charset_:"utf-8",resource:CQ.utils.WCM.getPagePath(),j_username:C.getUserID(),j_password:G});
return CQ.HTTP.isOk(B)
}};
CQ.User.logout=function(){if(navigator.userAgent.indexOf("MSIE")>0||navigator.userAgent.indexOf("Firefox")>0){if(document.all){document.execCommand("ClearAuthenticationCache")
}else{var C;
if(window.XMLHttpRequest){C=new XMLHttpRequest()
}else{if(window.ActiveXObject){try{C=new ActiveXObject("Msxml2.XMLHTTP")
}catch(B){try{C=new ActiveXObject("Microsoft.XMLHTTP")
}catch(B){}}}}if(C.readyState<4){C.abort()
}var A=CQ.HTTP.externalize("/?"+CQ.Sling.REQUEST_LOGIN_PARAM+"=1");
C.open("POST",A,false,"anonymous","");
C.send("")
}CQ.Util.reload()
}else{CQ.Util.reload(null,CQ.HTTP.externalize(CQ.User.LOGOUT_URL))
}};
CQ.utils.User=CQ.User;
if(!CQ.Ext.QuickTips.isEnabled()){CQ.Ext.QuickTips.init(false)
}CQ.Ext.state.Manager.setProvider(new CQ.Ext.state.CookieProvider({path:document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/"))}));
CQ.Ext.BLANK_IMAGE_URL=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/cq/ui/resources/0.gif"));
CQ.Ext.SSL_SECURE_URL=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/cq/ui/resources/0.html"));
CQ.I18n.init({locale:CQ.User.getCurrentUser().getLanguage()});
CQ.Ext.EventManager.on(window,"beforeunload",function(){CQ.WCM.deselect()
});
CQ.Ext.EventManager.on(window,"unload",function(){CQ.WCM.setContentWindowLoading(true);
try{CQ.WCM.getContentFinder().contentWindow=null
}catch(A){}window.CQ_Selection=null;
window.CQ_inplaceEditDialog=null;
if(CQ.Ext.isIE){window.console=null
}});
CQ.WCM.setContentWindowLoading(true);
if(CQ.WCM.isContentWindow()){CQ.Ext.onLoad(function(){CQ.WCM.setContentWindowLoading(false)
})
}CQ.WCM.observeKeypress();
CQ.Ext.UpdateManager.defaults.indicatorText='<div class="loading-indicator">'+CQ.I18n.getMessage("Loading...")+"</div>";
if(CQ.Ext.View){CQ.Ext.View.prototype.emptyText=""
}if(CQ.Ext.grid.Grid){CQ.Ext.grid.Grid.prototype.ddText=CQ.I18n.getMessage("{0} selected row(s)")
}if(CQ.Ext.TabPanelItem){CQ.Ext.TabPanelItem.prototype.closeText=CQ.I18n.getMessage("Close this tab")
}if(CQ.Ext.form.Field){CQ.Ext.form.Field.prototype.invalidText=CQ.I18n.getMessage("The value in this field is invalid")
}if(CQ.Ext.LoadMask){CQ.Ext.LoadMask.prototype.msg=CQ.I18n.getMessage("Loading...")
}Date.monthNames=[CQ.I18n.getMessage("January"),CQ.I18n.getMessage("February"),CQ.I18n.getMessage("March"),CQ.I18n.getMessage("April"),CQ.I18n.getMessage("May"),CQ.I18n.getMessage("June"),CQ.I18n.getMessage("July"),CQ.I18n.getMessage("August"),CQ.I18n.getMessage("September"),CQ.I18n.getMessage("October"),CQ.I18n.getMessage("November"),CQ.I18n.getMessage("December")];
Date.getShortMonthName=function(A){return Date.monthNames[A].substring(0,3)
};
Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
Date.getMonthNumber=function(A){return Date.monthNumbers[A.substring(0,1).toUpperCase()+A.substring(1,3).toLowerCase()]
};
Date.dayNames=[CQ.I18n.getMessage("Sunday"),CQ.I18n.getMessage("Monday"),CQ.I18n.getMessage("Tuesday"),CQ.I18n.getMessage("Wednesday"),CQ.I18n.getMessage("Thursday"),CQ.I18n.getMessage("Friday"),CQ.I18n.getMessage("Saturday")];
Date.getShortDayName=function(A){return Date.dayNames[A].substring(0,3)
};
if(CQ.Ext.MessageBox){CQ.Ext.MessageBox.buttonText={ok:CQ.I18n.getMessage("OK"),cancel:CQ.I18n.getMessage("Cancel"),yes:CQ.I18n.getMessage("Yes"),no:CQ.I18n.getMessage("No")}
}if(CQ.Ext.util.Format){CQ.Ext.util.Format.date=function(A,B){if(!A){return""
}if(!(A instanceof Date)){A=new Date(Date.parse(A))
}return A.dateFormat(B||CQ.I18n.getMessage("m/d/Y",null,"General date format for ExtJS (http://extjs.com/deploy/ext/docs/output/Date.html)"))
}
}if(CQ.Ext.DatePicker){CQ.Ext.apply(CQ.Ext.DatePicker.prototype,{todayText:CQ.I18n.getMessage("Today"),minText:CQ.I18n.getMessage("This date is before the minimum date"),maxText:CQ.I18n.getMessage("This date is after the maximum date"),disabledDaysText:"",disabledDatesText:"",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:CQ.I18n.getMessage("Next Month (Control+Right)"),prevText:CQ.I18n.getMessage("Previous Month (Control+Left)"),monthYearText:CQ.I18n.getMessage("Choose a month (Control+Up/Down to move years)"),todayTip:CQ.I18n.getMessage("{0} (Spacebar)"),format:CQ.I18n.getMessage("m/d/y",null,"Date format for ExtJS DatePicker (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)"),okText:CQ.I18n.getMessage("&#160;OK&#160;"),cancelText:CQ.I18n.getMessage("Cancel"),startDay:Number(CQ.I18n.getMessage("0",null,"Start day for week view in calendar (0=Sunday, 1=Monday, etc.)"))})
}if(CQ.Ext.PagingToolbar){CQ.Ext.apply(CQ.Ext.PagingToolbar.prototype,{beforePageText:CQ.I18n.getMessage("Page"),afterPageText:CQ.I18n.getMessage("of {0}"),firstText:CQ.I18n.getMessage("First Page"),prevText:CQ.I18n.getMessage("Previous Page"),nextText:CQ.I18n.getMessage("Next Page"),lastText:CQ.I18n.getMessage("Last Page"),refreshText:CQ.I18n.getMessage("Refresh"),displayMsg:CQ.I18n.getMessage("Displaying {0} - {1} of {2}"),emptyMsg:CQ.I18n.getMessage("No data to display")})
}if(CQ.Ext.form.TextField){CQ.Ext.apply(CQ.Ext.form.TextField.prototype,{minLengthText:CQ.I18n.getMessage("The minimum length for this field is {0}"),maxLengthText:CQ.I18n.getMessage("The maximum length for this field is {0}"),blankText:CQ.I18n.getMessage("This field is required"),regexText:"",emptyText:null})
}if(CQ.Ext.form.NumberField){CQ.Ext.apply(CQ.Ext.form.NumberField.prototype,{minText:CQ.I18n.getMessage("The minimum value for this field is {0}"),maxText:CQ.I18n.getMessage("The maximum value for this field is {0}"),nanText:CQ.I18n.getMessage("{0} is not a valid number")})
}if(CQ.Ext.form.DateField){CQ.Ext.apply(CQ.Ext.form.DateField.prototype,{disabledDaysText:CQ.I18n.getMessage("Disabled"),disabledDatesText:CQ.I18n.getMessage("Disabled"),minText:CQ.I18n.getMessage("The date in this field must be after {0}"),maxText:CQ.I18n.getMessage("The date in this field must be before {0}"),invalidText:CQ.I18n.getMessage("{0} is not a valid date - it must be in the format {1}"),format:CQ.I18n.getMessage("m/d/y",null,"Date format for ExtJS DateField (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)"),altFormats:CQ.I18n.getMessage("m/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",null,"Date formats to try when parsing input from ExtJS DateField, in order (http://extjs.com/deploy/ext/docs/output/Date.html)")})
}if(CQ.Ext.form.ComboBox){CQ.Ext.apply(CQ.Ext.form.ComboBox.prototype,{loadingText:CQ.I18n.getMessage("Loading..."),valueNotFoundText:undefined})
}if(CQ.Ext.form.VTypes){CQ.Ext.apply(CQ.Ext.form.VTypes,{emailText:CQ.I18n.getMessage('This field should be an e-mail address in the format "user@domain.com"'),urlText:CQ.I18n.getMessage('This field should be a URL in the format "http://www.domain.com"'),alphaText:CQ.I18n.getMessage("This field should only contain letters and _"),alphanumText:CQ.I18n.getMessage("This field should only contain letters, numbers and _")})
}if(CQ.Ext.form.HtmlEditor){CQ.Ext.apply(CQ.Ext.form.HtmlEditor.prototype,{createLinkText:CQ.I18n.getMessage("Please enter the URL for the link:"),buttonTips:{bold:{title:CQ.I18n.getMessage("Bold (Ctrl+B)"),text:CQ.I18n.getMessage("Make the selected text bold."),cls:"x-html-editor-tip"},italic:{title:CQ.I18n.getMessage("Italic (Ctrl+I)"),text:CQ.I18n.getMessage("Make the selected text italic."),cls:"x-html-editor-tip"},underline:{title:CQ.I18n.getMessage("Underline (Ctrl+U)"),text:CQ.I18n.getMessage("Underline the selected text."),cls:"x-html-editor-tip"},increasefontsize:{title:CQ.I18n.getMessage("Grow Text"),text:CQ.I18n.getMessage("Increase the font size."),cls:"x-html-editor-tip"},decreasefontsize:{title:CQ.I18n.getMessage("Shrink Text"),text:CQ.I18n.getMessage("Decrease the font size."),cls:"x-html-editor-tip"},backcolor:{title:CQ.I18n.getMessage("Text Highlight Color"),text:CQ.I18n.getMessage("Change the background color of the selected text."),cls:"x-html-editor-tip"},forecolor:{title:CQ.I18n.getMessage("Font Color"),text:CQ.I18n.getMessage("Change the color of the selected text."),cls:"x-html-editor-tip"},justifyleft:{title:CQ.I18n.getMessage("Align Text Left"),text:CQ.I18n.getMessage("Align text to the left."),cls:"x-html-editor-tip"},justifycenter:{title:CQ.I18n.getMessage("Center Text"),text:CQ.I18n.getMessage("Center text in the editor."),cls:"x-html-editor-tip"},justifyright:{title:CQ.I18n.getMessage("Align Text Right"),text:CQ.I18n.getMessage("Align text to the right."),cls:"x-html-editor-tip"},insertunorderedlist:{title:CQ.I18n.getMessage("Bullet List"),text:CQ.I18n.getMessage("Start a bulleted list."),cls:"x-html-editor-tip"},insertorderedlist:{title:CQ.I18n.getMessage("Numbered List"),text:CQ.I18n.getMessage("Start a numbered list."),cls:"x-html-editor-tip"},createlink:{title:CQ.I18n.getMessage("Hyperlink"),text:CQ.I18n.getMessage("Make the selected text a hyperlink."),cls:"x-html-editor-tip"},sourceedit:{title:CQ.I18n.getMessage("Source Edit"),text:CQ.I18n.getMessage("Switch to source editing mode."),cls:"x-html-editor-tip"}}})
}if(CQ.Ext.grid.GridView){CQ.Ext.apply(CQ.Ext.grid.GridView.prototype,{sortAscText:CQ.I18n.getMessage("Sort Ascending"),sortDescText:CQ.I18n.getMessage("Sort Descending"),lockText:CQ.I18n.getMessage("Lock Column"),unlockText:CQ.I18n.getMessage("Unlock Column"),columnsText:CQ.I18n.getMessage("Columns")})
}if(CQ.Ext.grid.GroupingView){CQ.Ext.apply(CQ.Ext.grid.GroupingView.prototype,{emptyGroupText:CQ.I18n.getMessage("(None)"),groupByText:CQ.I18n.getMessage("Group By This Field"),showGroupsText:CQ.I18n.getMessage("Show in Groups")})
}if(CQ.Ext.grid.PropertyColumnModel){CQ.Ext.apply(CQ.Ext.grid.PropertyColumnModel.prototype,{nameText:CQ.I18n.getMessage("Name"),valueText:CQ.I18n.getMessage("Value"),dateFormat:CQ.I18n.getMessage("m/j/Y",null,"Date format for ExtJS grid columns (http://extjs.com/deploy/ext/docs/output/Date.html)")})
}if(CQ.Ext.layout.BorderLayout.SplitRegion){CQ.Ext.apply(CQ.Ext.layout.BorderLayout.SplitRegion.prototype,{splitTip:CQ.I18n.getMessage("Drag to resize."),collapsibleSplitTip:CQ.I18n.getMessage("Drag to resize. Double click to hide.")})
}if(CQ.Ext.form.BasicForm){CQ.Ext.form.BasicForm.prototype.waitTitle=CQ.I18n.getMessage("Please wait...")
}if(CQ.Ext.form.TimeField){CQ.Ext.apply(CQ.Ext.form.TimeField.prototype,{minText:CQ.I18n.getMessage("The time in this field must be equal to or after {0}"),maxText:CQ.I18n.getMessage("The time in this field must be equal to or before {0}"),invalidText:CQ.I18n.getMessage("{0} is not a valid time"),format:CQ.I18n.getMessage("g:i A",null,"Time format for ExtJS TimeField (http://extjs.com/deploy/ext/docs/output/Date.html)")})
}if(CQ.Ext.form.VTypes){CQ.Ext.apply(CQ.Ext.form.VTypes,{nameText:CQ.I18n.getMessage("The name must not contain<br><br>/ : [ ] * |<br><br>nor must it start with a space or a period<br>nor end with a space."),itemnameText:CQ.I18n.getMessage("This field should only contain numbers, letters, dashes and underscores"),percentText:CQ.I18n.getMessage("This field should only contain a percentage in the format '50%'"),digitsText:CQ.I18n.getMessage("This field should only contain numbers"),requiredOnLinkedDataText:CQ.I18n.getMessage("This field must not be empty when data in the linked field is available."),authorizableIdText:'This field should only contain lowercase letters, numbers, ".", "-", "_" and "@".'})
}CQ.PrivilegedAction=CQ.Ext.extend(CQ.Ext.Action,{privileges:null,conditions:null,path:null,isChecked:false,allowed:false,constructor:function(A){CQ.Ext.applyIf(A,{path:"/",disabled:false});
this.privileges=A.privileges;
this.conditions=A.conditions;
CQ.PrivilegedAction.superclass.constructor.call(this,A);
this.path=this.initialConfig.path
},setPath:function(A,C){var B=C?false:A==this.path;
this.isChecked=false;
this.path=A;
this.setDisabled(!this.isAllowed(B))
},isDisabled:function(){return this.initialConfig.disabled||!this.isAllowed()
},enable:function(){this.setDisabled(!this.isAllowed())
},addComponent:function(A){A.disabled=this.isDisabled();
CQ.PrivilegedAction.superclass.addComponent.call(this,A)
},isAllowed:function(A){if(this.isChecked){return this.allowed
}if(this.path==null){return false
}this.conditionsAllowed=this.checkConditions();
if(!A){this.permissionsAllowed=this.hasPermission()
}this.allowed=this.conditionsAllowed&&this.permissionsAllowed;
this.isChecked=true;
return this.allowed
},hasPermission:function(){var C=!this.privileges;
if(!C){var A=CQ.User.getCurrentUser();
if(typeof this.privileges=="object"){for(var B=0;
B<this.privileges.length;
B++){C=A.hasPermissionOn(this.privileges[B],this.path);
if(!C){break
}}}else{C=CQ.User.hasPermissionOn(this.privileges,this.path)
}}return C
},checkConditions:function(){var allowed=!this.conditions;
if(!allowed){for(var i=0;
i<this.conditions.length;
i++){if(typeof (this.conditions[i])=="string"){this.conditions[i]=eval(this.conditions[i])
}allowed=this.conditions[i].call(this);
if(!allowed){break
}}}return allowed
}});
CQ.Highlight=CQ.Ext.extend(CQ.Ext.Component,{frameCls:null,frameWidth:null,framePadding:null,zIndex:null,frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,constructor:function(A){CQ.Util.applyDefaults(A,{frameCls:"cq-highlight",frameWidth:CQ.themes.Highlight.FRAME_WIDTH,framePadding:CQ.themes.Highlight.FRAME_PADDING});
CQ.Highlight.superclass.constructor.call(this);
this.initialConfig=A;
this.frameLeft=this.createFrame("left");
this.frameRight=this.createFrame("right");
this.frameTop=this.createFrame("top");
this.frameBottom=this.createFrame("bottom");
this.addEvents("beforeshowframe","beforehideframe");
if(A.cls){this.addClass(A.cls)
}},createFrame:function(B){var A=this.initialConfig;
return new CQ.Ext.BoxComponent({autoEl:"div",cls:A.frameCls+" "+B})
},showFrame:function(){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}var B=this.initialConfig;
if(B.listeners&&B.listeners.beforeshowframe){var F=B.listeners.beforeshowframe.handler?B.listeners.beforeshowframe.handler:B.listeners.beforeshowframe;
var E=B.listeners.beforeshowframe.scope?B.listeners.beforeshowframe.scope:this;
F.call(E)
}var C=CQ.Ext.get(B.element);
var D=C.getWidth();
var A=C.getHeight();
var H=C.getLeft();
var G=C.getTop();
this.frameLeft.setWidth(B.frameWidth);
this.frameLeft.setHeight(A+(2*B.framePadding));
this.frameLeft.setPosition(H-B.frameWidth-B.framePadding,G-B.framePadding);
this.frameRight.setWidth(B.frameWidth);
this.frameRight.setHeight(A+(2*B.framePadding));
this.frameRight.setPosition(H+D+B.framePadding,G-B.framePadding);
this.frameTop.setWidth(D+(2*B.frameWidth)+(2*B.framePadding));
this.frameTop.setHeight(B.frameWidth);
this.frameTop.setPosition(H-B.frameWidth-B.framePadding,G-B.frameWidth-B.framePadding);
this.frameBottom.setWidth(D+(2*B.frameWidth)+(2*B.framePadding));
this.frameBottom.setHeight(B.frameWidth);
this.frameBottom.setPosition(H-B.frameWidth-B.framePadding,G+A+B.framePadding);
this.frameLeft.show();
this.frameRight.show();
this.frameTop.show();
this.frameBottom.show();
if(this.zIndex){this.frameLeft.el.setStyle("z-index",this.zIndex);
this.frameRight.el.setStyle("z-index",this.zIndex);
this.frameTop.el.setStyle("z-index",this.zIndex);
this.frameBottom.el.setStyle("z-index",this.zIndex)
}},hideFrame:function(){var A=this.initialConfig;
if(A.listeners&&A.listeners.beforehideframe){var C=A.listeners.beforehideframe.handler?A.listeners.beforehideframe.handler:A.listeners.beforehideframe;
var B=A.listeners.beforehideframe.scope?A.listeners.beforehideframe.scope:this;
C.call(B)
}this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide()
},flash:function(){var A=this.initialConfig;
CQ.Ext.get(A.element).frame(CQ.themes.Highlight.FLASH_COLOR,CQ.themes.Highlight.FLASH_NUM,{duration:CQ.themes.Highlight.FLASH_DURATION})
},addClass:function(A){this.frameLeft.addClass(A);
this.frameRight.addClass(A);
this.frameBottom.addClass(A);
this.frameTop.addClass(A)
},removeClass:function(A){this.frameLeft.removeClass(A);
this.frameRight.removeClass(A);
this.frameBottom.removeClass(A);
this.frameTop.removeClass(A)
},on:function(A,C,B){this.frameLeft.on(A,C,B);
this.frameRight.on(A,C,B);
this.frameBottom.on(A,C,B);
this.frameTop.on(A,C,B)
},un:function(A,C,B){this.frameLeft.un(A,C,B);
this.frameRight.un(A,C,B);
this.frameBottom.un(A,C,B);
this.frameTop.un(A,C,B)
}});
CQ.Static=CQ.Ext.extend(CQ.Ext.BoxComponent,{text:"",html:"",tag:"div",href:null,target:null,small:false,bold:false,italic:false,right:false,topmargin:false,bottommargin:false,noWrap:false,constructor:function(A){CQ.Static.superclass.constructor.call(this,A)
},initComponent:function(){CQ.Static.superclass.initComponent.call(this);
this.addClass("cq-static");
if(this.small){this.addClass("cq-static-small")
}if(this.bold){this.addClass("cq-static-bold")
}if(this.italic){this.addClass("cq-static-italic")
}if(this.right){this.addClass("cq-static-right")
}if(this.topmargin){this.addClass("cq-static-topmargin")
}if(this.bottommargin){this.addClass("cq-static-bottommargin")
}if(this.noWrap){this.addClass("cq-static-nowrap")
}},onRender:function(B,A){if(!this.el){var C=document.createElement(this.href?"a":this.tag);
if(this.href){C.href=this.href;
if(this.target){C.target=this.target
}}C.id=this.getId();
this.el=new CQ.Ext.Element(C);
if(this.text){this.updateText(this.text)
}else{if(this.html){this.updateHtml(this.html)
}}}CQ.Static.superclass.onRender.call(this,B,A)
},updateHtml:function(A){this.el.dom.innerHTML=A
},updateText:function(A){this.updateHtml(CQ.Ext.util.Format.htmlEncode(A))
}});
CQ.Ext.reg("static",CQ.Static);
CQ.TextButton=CQ.Ext.extend(CQ.Ext.Button,{scale:"medium",buttonSelector:"span:first-child",getTemplateArgs:function(){return[this.id,"cq-tbtn-"+this.scale,this.cls]
},onRender:function(B,A){if(!this.template){if(!CQ.TextButton.buttonTemplate){CQ.TextButton.buttonTemplate=new CQ.Ext.Template('<span id="{0}" class="cq-tbtn {1} {2}">',"<span></span>","</span>");
CQ.TextButton.buttonTemplate.compile()
}this.template=CQ.TextButton.buttonTemplate
}CQ.TextButton.superclass.onRender.call(this,B,A)
}});
CQ.Ext.reg("textbutton",CQ.TextButton);
CQ.PropertyGrid=function(A){A=CQ.Util.applyDefaults(A,{region:"east",title:CQ.I18n.getMessage("Properties"),collapsible:true,collapsed:true,split:true,autoScroll:true,containerScroll:true,animate:true,width:240,margins:"5 5 5 0"});
CQ.PropertyGrid.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.PropertyGrid,CQ.Ext.grid.PropertyGrid,{listeners:{afteredit:function(A){this.srcComp.setProperties(A.grid.getSource());
this.srcComp.afterPropChange()
}},showProperties:function(A){this.srcComp=A;
this.customEditors=A.getPropertyEditors();
this.setSource(A.getProperties());
if(this.collapsed){this.expand()
}}});
CQ.Ext.reg("propgrid",CQ.PropertyGrid);
CQ.Dialog=CQ.Ext.extend(CQ.Ext.Window,{okText:null,cancelText:null,buttons:[],params:{},responseScope:null,success:null,failure:null,formUrl:null,path:null,helpPath:null,editLockMode:null,editLock:null,formPanel:null,form:null,titleFromConfig:false,formUrlFromConfig:false,configDefaults:null,isPinned:false,warnIfModified:true,processedValues:null,setElId:function(A){this.el.dom.id=A
},loadContent:function(B,C){if(typeof (B)=="string"){this.path=B;
var A=CQ.HTTP.externalize(this.path,true);
C=C||CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON;
this.store=new CQ.data.SlingStore({url:A+C});
if(!this.formUrlFromConfig){if(A.substring(A.length-2)=="/*"){A=A.substring(0,A.length-1)
}this.form.url=A
}if(!this.titleFromConfig){this.setTitle(A)
}if(CQ.Ext.isIE6&&this.title&&this.title.length>CQ.themes.Dialog.IE6_TITLE_MAX_CHAR){this.setTitle(this.title.substring(0,CQ.themes.Dialog.IE6_TITLE_MAX_CHAR))
}}else{if(B instanceof CQ.Ext.data.Store){this.store=B
}}if(this.store){this.store.load({callback:this.processRecords,scope:this})
}},focusFirstField:function(B){if(!B){B=this.getActiveTab()
}var A=CQ.Util.findFormFields(B);
for(var C in A){if(A[C][0].focus){A[C][0].focus(true,400);
break
}}},processRecords:function(I,A,J){var D=this.getRecord(I,J);
CQ.Log.debug("CQ.Dialog#processRecords: processing records for fields");
var C=false;
var G=D.get("jcr:mixinTypes");
if(G&&((G.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_RELATIONSHIP)!=-1)||(G.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC)!=-1))){C=true
}var F=CQ.Util.findFormFields(this.formPanel);
this.processedValues={};
for(var B in F){for(var E=0;
E<F[B].length;
E++){try{if(F[B][E].processPath){CQ.Log.debug("CQ.Dialog#processRecords: calling processPath of field '{0}'",[B]);
F[B][E].processPath(this.path,F[B][E].initialConfig.ignoreData)
}if(!F[B][E].initialConfig.ignoreData){CQ.Log.debug("CQ.Dialog#processRecords: calling processRecord of field '{0}'",[B]);
F[B][E].processRecord(D,this.path)
}if(!this.processedValues[B]){this.processedValues[B]=[]
}this.processedValues[B].push({field:F[B][E],value:F[B][E].getValue()});
if(this.fieldEditLockMode&&C){CQ.Log.debug("CQ.Dialog#processRecords: process fieldEditLock for field '{0}'",[B]);
this.handleFieldLock(F[B][E],D)
}}catch(H){CQ.Log.debug("CQ.Dialog#processRecords: {0}",H.message)
}}}this.fireEvent("loadcontent",this,I,A,J);
this.focusFirstField()
},handleFieldLock:function(J,B){if(J.getName().match("^\\./")!="./"){return 
}var C=J.getName().substr(J.getName().lastIndexOf("/")+1);
if(CQ.wcm.msm.MSM.isExcludedProperty(C)){return 
}var D=true;
var A=false;
var M="cq-dialog-locked";
var E=B.get("jcr:mixinTypes");
if(E&&(E.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){D=false;
A=true;
M="cq-dialog-unlocked"
}if(B.get(CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED)){var H=B.get(CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED);
if(H.indexOf(C)!=-1){D=false;
M="cq-dialog-unlocked"
}}J.editLock=D;
if(J.handleFieldLock){J.handleFieldLock(M,D,A,B)
}else{if(J.fieldEditLockBtn){J.setDisabled(D);
J.fieldEditLockBtn.setIconClass(M);
J.fieldEditLockBtn.setTooltip(M=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
J.fieldEditLockBtn.setDisabled(A)
}else{var K="";
if(A){K=CQ.Dialog.INHERITANCE_BROKEN
}else{K=D?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}try{J.setDisabled(D);
var G=this;
J.fieldEditLockBtn=new CQ.TextButton({disabled:A,tooltip:K,cls:"cq-dialog-editlock",iconCls:M,handleMouseEvents:false,handler:function(){G.switchPropertyInheritance(J,C,function(O,N){J.fieldEditLockBtn.setIconClass(O);
J.fieldEditLockBtn.setTooltip(O=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
J.setDisabled(N);
J.editLock=N
},G)
}});
var L=CQ.Ext.get("x-form-el-"+J.id);
var I=L.parent().first();
L.parent().first().dom.style.width=(parseInt(I.dom.style.width)-CQ.themes.Dialog.LOCK_WIDTH)+"px";
if(J.rendered){J.fieldEditLockBtn.render(L.parent(),I.next())
}else{this.on("render",function(N){J.fieldEditLockBtn.render(L.parent(),I.next())
})
}}catch(F){}}}},switchPropertyInheritance:function(C,B,D,A){CQ.Ext.Msg.confirm(C.editLock?CQ.I18n.getMessage("Cancel inheritance"):CQ.I18n.getMessage("Revert inheritance"),C.editLock?CQ.I18n.getMessage("Do you really want to cancel the inheritance?"):CQ.I18n.getMessage("Do you really want to revert the inheritance?"),function(K){if(K=="yes"){var E=false;
var F="cq-dialog-unlocked";
var I={};
I.cmd="cancelPropertyInheritance";
if(!C.editLock){var E=true;
var F="cq-dialog-locked";
I.cmd="reenablePropertyInheritance"
}I[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME]=[];
if(C.getFieldLockParameters){I=C.getFieldLockParameters(I)
}else{I[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME].push(B)
}var H=this;
var G=H.path;
if(C.getFieldLockTarget){G=C.getFieldLockTarget(G)
}var J=CQ.utils.HTTP.post(G+".msm.conf",null,I,this);
if(CQ.utils.HTTP.isOk(J)){if(D){D.call(C,F,E)
}if(E){H.store.reload({callback:function(M,L,O){var N=H.getRecord(M,O);
C.processRecord(N,H.path);
if(!N.get(B)&&(C.getValue()!=C.defaultValue)){C.setValue(null)
}}})
}}}},A||this)
},getRecord:function(A,C){var B;
if(C&&this.path.charAt(this.path.length-1)!="/"&&this.path.charAt(this.path.length-1)!="*"){B=A[0]
}else{if(!C){CQ.Log.warn("CQ.Dialog#processRecords: retrieval of records unsuccessful")
}else{CQ.Log.info("CQ.Dialog#processRecords: skipping paths ending in '/' or /*'")
}B=new CQ.data.SlingRecord();
B.data={}
}return B
},processPath:function(E){CQ.Log.debug("CQ.Dialog#processPath: processing path for fields");
var A=CQ.Util.findFormFields(this.formPanel);
for(var B in A){for(var C=0;
C<A[B].length;
C++){try{if(A[B][C].processPath){CQ.Log.debug("CQ.Dialog#processPath: field '{0}'",[B]);
A[B][C].processPath(E)
}}catch(D){CQ.Log.debug("CQ.Dialog#processPath: {0}",D.message)
}}}},addHidden:function(D,B){for(var A in D){var C=CQ.Util.build({xtype:"hidden",name:A,value:D[A],ignoreData:B!==false});
this.formPanel.add(C);
D[A]=C
}this.formPanel.doLayout();
return D
},addParams:function(E,C){var D={};
var A=CQ.Util.findFormFields(this.formPanel);
for(var B in E){if(!A[B]){D[B]=E[B]
}}this.addHidden(D,C)
},getField:function(B){var A=CQ.Util.findFormFields(this.formPanel);
if(A[B]&&A[B].length==1){return A[B][0]
}else{return A[B]
}},enableFields:function(){var A=CQ.Util.findFormFields(this.formPanel);
for(var B in A){for(var C=0;
C<A[B].length;
C++){var D=A[B][C];
if(D){if(D.enable){D.enable()
}}}}},disableFields:function(){var A=CQ.Util.findFormFields(this.formPanel);
for(var B in A){for(var C=0;
C<A[B].length;
C++){var D=A[B][C];
if(D){if(D.disable){D.disable()
}}}}},applySingleConfigDefaults:function(B,C,D){var A=CQ.Util.getSingleItemConfig(B,D);
if(A){return CQ.Util.applyDefaults(A,C)
}return B
},applyConfigDefaults:function(config,defaults){CQ.Util.applyDefaults(config,defaults.dialog);
if(config.items.xtype=="tabpanel"){var tabPanel=this.applySingleConfigDefaults(config,defaults.tabpanel,"tabpanel");
if(tabPanel&&tabPanel.items){if(tabPanel.items instanceof Array){for(var i=0;
i<tabPanel.items.length;
i++){var tab=CQ.Util.applyDefaults(tabPanel.items[i],defaults.panel)
}}else{var tab=CQ.Util.applyDefaults(tabPanel.items,defaults.panel)
}}}else{var singlePanel=this.applySingleConfigDefaults(config,defaults.panel,"panel")
}if(config.buttons){if(typeof config.buttons=="string"){config.buttons=[config.buttons]
}var buttons=[];
if(config.editLockMode){config.buttonAlign="left";
var cls,tip;
if(config.editLock){cls="cq-dialog-locked";
tip=CQ.I18n.getMessage("Cancel inheritance")
}else{cls="cq-dialog-unlocked";
tip=CQ.I18n.getMessage("Revert inheritance")
}var dlg=this;
var cfg={iconCls:cls,cls:"cq-dialog-editlock",tooltip:tip,enableToggle:true,handleMouseEvents:false,toggleHandler:function(button){if(dlg.editLock){dlg.enableFields(dlg.formPanel);
button.setIconClass("cq-dialog-unlocked");
button.setTooltip(CQ.Dialog.REVERT_INHERITANCE);
dlg.fireEvent("beforeeditunlocked",dlg)
}else{dlg.disableFields(dlg.formPanel);
button.setIconClass("cq-dialog-locked");
button.setTooltip(CQ.Dialog.CANCEL_INHERITANCE);
dlg.fireEvent("beforeeditlocked",dlg)
}}};
if(config.editLockDisabled===true||config.editLockDisabled=="true"){cfg.disabled=true;
cfg.tooltip=config.editLockDisabledTitle
}buttons.push(cfg)
}if(config.params){var dialogType=config.params["./sling:resourceType"];
if(dialogType&&config.helpPath){buttons.push(CQ.Util.applyDefaults(CQ.wcm.HelpBrowser.createHelpButton(config.helpPath),defaults.button))
}}for(var i=0;
i<config.buttons.length;
i++){if(typeof config.buttons[i]=="string"){if(config.buttons[i]==CQ.Dialog.OK){var okButton=this.getOkConfig();
buttons.push(CQ.Util.applyDefaults(okButton,defaults.button))
}if(config.buttons[i]==CQ.Dialog.CANCEL){var cancelButton=this.getCancelConfig();
buttons.push(CQ.Util.applyDefaults(cancelButton,defaults.button))
}}else{if(config.buttons[i]){if(typeof config.buttons[i].handler=="string"){config.buttons[i].handler=eval(config.buttons[i].handler)
}if(config.buttons[i].menu){CQ.Util.applyDefaults(config.buttons[i].menu,defaults.menu)
}buttons.push(CQ.Util.applyDefaults(config.buttons[i],defaults.button))
}}}config.buttons=buttons
}},getOkConfig:function(){return{text:this.okText,cls:"cq-btn-ok",handler:function(A){this.ok(A)
}}
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(A){this[this.closeAction]()
}}
},getActiveTab:function(){var A=this.formPanel.getComponent(0).getComponent(0);
if(A.xtype=="tabpanel"){A=A.getActiveTab()
}return A
},setFormUrl:function(A){this.form.url=A
},ok:function(D,G,C){var B={};
var E;
var A;
if(this.responseScope){B.scope=this.responseScope;
E=this.responseScope.success;
A=this.responseScope.failure
}B.success=G?G:this.success?this.success:E;
B.failure=C?C:this.failure?this.failure:A;
if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}this.form.items.each(function(H){if(H.emptyText&&H.el&&H.el.dom&&H.el.dom.value==H.emptyText){H.setRawValue("")
}});
var F=new CQ.form.SlingSubmitAction(this.form,B);
this.form.doAction(F);
this[this.closeAction]()
}else{CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Validation Failed"),msg:CQ.I18n.getMessage("Verify the values of the marked fields."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},pin:function(A){this.alignToViewport(A);
if(!this.isPinned){CQ.Util.pin(this);
this.isPinned=true
}},unpin:function(){if(this.isPinned){CQ.Util.unpin(this);
this.isPinned=false
}},alignToViewport:function(G){if(!G){return 
}var I,H=0;
var E=CQ.Ext.lib.Dom.getViewportWidth();
var B=CQ.Ext.lib.Dom.getViewportHeight();
var F=CQ.themes.Dialog.CORNER_X;
var D=CQ.themes.Dialog.CORNER_Y;
var C=this.getBox();
switch(G){case"tl":I=F;
H=D;
break;
case"tr":I=E-C.width-F;
H=D;
break;
case"bl":I=F;
H=B-C.height-F;
break;
case"br":I=E-C.width-F;
H=B-C.height-D;
break;
case"c":default:var A=this.getEl().getCenterXY();
I=A[0];
H=A[1]
}this.setPosition(I,H)
},overridePosition:function(){if(!this.disableOverridePosition){var A=CQ.Ext.getDoc().getScroll();
if(this.x){this.originalX=this.x;
this.x+=A.left
}if(this.y){this.originalY=this.y;
this.y+=A.top
}}},resetPosition:function(){if(this.originalX){this.x=this.originalX
}if(this.originalY){this.y=this.originalY
}},constructor:function(A){if(A.header===false||A.title){this.titleFromConfig=true
}this.okText=A.okText?A.okText:CQ.I18n.getMessage("OK");
this.cancelText=A.cancelText?A.cancelText:CQ.I18n.getMessage("Cancel");
this.configDefaults={dialog:{xtype:"dialog",closable:true,closeAction:"hide",width:CQ.themes.Dialog.WIDTH,height:CQ.themes.Dialog.HEIGHT,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,y:20,title:"&nbsp;",layout:"fit",plain:CQ.themes.Dialog.PLAIN,bodyStyle:CQ.themes.Dialog.BODY_STYLE,buttonAlign:CQ.themes.Dialog.BUTTON_ALIGN,minButtonWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH,stateful:false,disableOverridePosition:false},tabpanel:{xtype:"tabpanel",activeTab:0,deferredRender:false,plain:CQ.themes.Dialog.TABPANEL_PLAIN,border:CQ.themes.Dialog.TABPANEL_BORDER,enableTabScroll:true,stateful:false,listeners:{tabchange:{fn:function(D,C){if(D.rendered){if(CQ.Ext.isIE){C.hide();
C.show()
}this.focusFirstField(C)
}},scope:this}}},panel:{layout:"form",autoScroll:true,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,defaultType:"textfield",stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false}},button:{xtype:"button",scope:this},menu:{defaults:{scope:this}}};
this.applyConfigDefaults(A,this.configDefaults);
CQ.Dialog.superclass.constructor.call(this,A);
var B={xtype:"form",renderTo:CQ.Util.ROOT_ID,baseCls:"x-window-plain",items:this};
if(this.fileUpload){B.fileUpload=this.fileUpload
}this.formPanel=new CQ.Ext.form.FormPanel(B);
this.form=this.formPanel.getForm();
if(A.formUrl){this.form.url=A.formUrl;
this.formUrlFromConfig=true
}if(!A.params){A.params=new Object()
}if(A.params[CQ.Sling.CHARSET]==undefined){A.params[CQ.Sling.CHARSET]=CQ.Dialog.DEFAULT_ENCODING
}if(A.params[CQ.Sling.STATUS]==undefined){A.params[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER
}this.addParams(A.params);
if(A.content){this.loadContent(A.content)
}this.success=A.success;
this.failure=A.failure;
this.responseScope=A.responseScope;
this.on("beforeshow",this.overridePosition);
this.on("hide",this.resetPosition);
this.on("show",function(C){C.focusFirstField()
});
this.addEvents("beforesubmit","loadContent","loadcontent","beforeeditlocked","editLocked","editlocked","beforeeditunlocked","editUnlocked","editunlocked");
if(this.warnIfModified){if(!window.CQ_Dialog_checkBeforeUnload){window.CQ_Dialog_checkBeforeUnload=[];
window.onbeforeunload=CQ.Dialog.checkModified;
CQ.Ext.EventManager.addListener(window,"unload",function(){window.CQ_Dialog_checkBeforeUnload=null;
window.onbeforeunload=null
})
}window.CQ_Dialog_checkBeforeUnload.push(this)
}},observe:function(){if(!this.hidden){if(this.anchoredTo){var B=this.anchoredTo.getInlinePlaceholder();
if(B){var C=this.anchoredTo.getInlinePlaceholderInitialHeight();
var D=this.getPosition();
var A=B.getXY();
if(D[0]!=A[0]||D[1]!=A[1]+C){this.alignTo(B,"tl",[0,C])
}}}}},initComponent:function(){CQ.Dialog.superclass.initComponent.call(this);
if(this.editLockMode){this.editLockButton=this.buttons[0];
this.on("show",function(){this.setEditLock(this.editLock,true,true)
},this)
}},setEditLock:function(B,C,A){if(B){this.disableFields();
this.editLockButton.setIconClass("cq-dialog-locked");
this.editLockButton.setTooltip(CQ.Dialog.CANCEL_INHERITANCE)
}else{this.enableFields();
this.editLockButton.setIconClass("cq-dialog-unlocked");
this.editLockButton.setTooltip(CQ.Dialog.REVERT_INHERITANCE)
}this.editLock=B;
if(A){this.fireEvent((this.editLock?"editlocked":"editunlocked"),this,C)
}}});
CQ.Dialog.checkModified=function(){if(this.CQ_Dialog_checkBeforeUnload){for(var F=0;
F<this.CQ_Dialog_checkBeforeUnload.length;
F++){var C=this.CQ_Dialog_checkBeforeUnload[F];
if(!C.hidden&&C.processedValues){for(var A in C.processedValues){for(var B=0;
B<C.processedValues[A].length;
B++){var E=C.processedValues[A][B].field;
var D=C.processedValues[A][B].value;
if(CQ.Util.compareValues(E.getValue(),D)!=0){return CQ.I18n.getMessage("There are unsaved changes in the currently open dialog(s)")
}}}}}}};
CQ.Dialog.DEFAULT_ENCODING="utf-8";
CQ.Dialog.OK="OK";
CQ.Dialog.CANCEL="CANCEL";
CQ.Dialog.OKCANCEL=[CQ.Dialog.OK,CQ.Dialog.CANCEL];
CQ.Dialog.CANCEL_INHERITANCE=CQ.I18n.getMessage("Cancel inheritance");
CQ.Dialog.REVERT_INHERITANCE=CQ.I18n.getMessage("Revert inheritance");
CQ.Dialog.INHERITANCE_BROKEN=CQ.I18n.getMessage("Inheritance is broken at the page level");
CQ.Ext.reg("dialog",CQ.Dialog);
CQ.DialogEditor=CQ.Ext.extend(CQ.Ext.Viewport,{fieldCount:0,constructor:function(B){this.debug=B.debug;
var C=this;
B=CQ.Util.applyDefaults(B,{treeRoot:{name:"dialog",text:CQ.I18n.getMessage("Dialog"),draggable:false,expanded:true,editor:this}});
this.preview=new CQ.Ext.Panel({id:"cq-dialogeditor-preview-wrapper",region:"center",bodyStyle:"padding:12px",margins:"5 0 5 0",autoScroll:true,containerScroll:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,listeners:{render:function(E){E.loadMask=new CQ.Ext.LoadMask(E.bwrap)
}},tbar:[{id:"cq-dialogeditor-save",text:CQ.I18n.getMessage("Save"),handler:function(){C.fireEvent("save",C.getDialog())
},tooltip:{title:CQ.I18n.getMessage("Save Dialog"),text:CQ.I18n.getMessage("Save the current dialog"),autoHide:true}}]});
this.dialogTree=new CQ.Ext.tree.TreePanel({id:"cq-dialogeditor-structure",title:CQ.I18n.getMessage("Structure"),region:"center",autoScroll:true,containerScroll:true,split:true,enableDD:true,ddScroll:true,ddGroup:CQ.DialogEditor.DD_GROUP,root:new CQ.DialogEditor.DialogTreeNode(B.treeRoot),listeners:{click:function(F,E){if(F.getProperties){C.props.showProperties(F)
}},beforenodedrop:function(E){if(E.dropNode instanceof CQ.DialogEditor.TreeNode){E.target.handleReorder(E)
}else{E.target.handleDrop(E);
E.dropStatus=true;
return false
}},nodedragover:function(E){if(E.dropNode instanceof CQ.DialogEditor.TreeNode){return E.target.isReorderAllowed(E)
}else{return E.target.isInsertAllowed(E)
}},contextmenu:function(F,E){var I=F.getContextMenuActions();
if(I&&(I.length>0)){var H=new CQ.Ext.menu.Menu({items:I});
var G=E.getXY();
H.showAt(G)
}E.stopEvent()
}}});
var D=CQ.Ext.data.Record.create([{name:"title"},{name:"category"},{name:"insertCfg"}]);
var A=new CQ.Ext.XTemplate('<tpl for=".">','<div class="x-control">{text}</div>',"</tpl>");
this.tools=new CQ.Ext.Panel({id:"cq-dialogeditor-tools",title:CQ.I18n.getMessage("Palette"),autoScroll:true,layout:"accordion",region:"north",height:320,stateful:true,split:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,listeners:{render:function(F){var K=[];
for(var H in CQ.DialogEditor.MAPPINGS){var J=CQ.DialogEditor.MAPPINGS[H].text;
var I=CQ.DialogEditor.MAPPINGS[H].category;
if(CQ.DialogEditor.MAPPINGS[H].hideInList){continue
}var G;
if(K[I]){G=K[I]
}else{G=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},D)});
K[I]=G;
var E=new CQ.Ext.DataView({store:G,tpl:A,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-control-over",selectedClass:"x-control-selected",itemSelector:"div.x-control",loadingText:CQ.I18n.getMessage("Loading controls"),prepareData:function(L){L.title=CQ.I18n.getVarMessage(L.title);
return L
},listeners:{render:function(M){var L=new CQ.DialogEditor.DragZone(M,{containerScroll:true,ddGroup:CQ.DialogEditor.DD_GROUP})
}}});
F.add(new CQ.Ext.Panel({title:CQ.I18n.getVarMessage(I),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:E}))
}G.addSorted(new CQ.Ext.data.Record(CQ.DialogEditor.MAPPINGS[H],I+"#"+J))
}}}});
this.props=new CQ.PropertyGrid({region:"east",margins:"5 5 5 0",width:320,collapsible:true,collapseMode:"mini",animate:true,collapsed:false,hideCollapseTool:true});
this.props.on("rowcontextmenu",function(E,J,F){var I=E.getSource();
if((E.getStore().getAt(J).data.name.indexOf(CQ.DialogEditor.NT_JCR_NS_PREFIX)==-1)||(E.getStore().getAt(J).data.name=="xtype")){var H=new CQ.Ext.menu.Menu({items:[{text:CQ.I18n.getMessage("Remove"),handler:function(){delete I[E.getStore().getAt(J).data.name];
C.props.setSource(I);
C.updatePreview()
},tooltip:{title:CQ.I18n.getMessage("Remove Property"),text:CQ.I18n.getMessage("Remove selected property"),autoHide:true}}]});
var G=F.getXY();
H.showAt(G)
}F.stopEvent()
});
CQ.DialogEditor.superclass.constructor.call(this,{id:"cq-dialogeditor",layout:"border",renderTo:"CQ",items:[{xtype:"panel",id:"cq-dialogeditor-wrapper",layout:"border",region:"center",border:false,items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar"}]},{xtype:"panel",region:"west",layout:"border",margins:"5 0 5 5",width:320,collapsible:true,collapseMode:"mini",hideCollapseTool:true,animate:true,split:true,border:false,items:[this.dialogTree,this.tools]},this.preview,this.props]}]})
},initComponent:function(){CQ.DialogEditor.superclass.initComponent.call(this);
this.addEvents("save")
},updatePreview:function(){this.preview.loadMask.show();
var A=CQ.Util.copyObject(this.getDialog());
CQ.Ext.apply(A,{y:0,draggable:false,floating:false,closeAction:"closeCallback",closeCallback:CQ.Ext.emptyFn,resizable:false});
CQ.Util.formatData(A);
if(A.buttons==undefined){A.buttons=CQ.Dialog.OKCANCEL
}var C=CQ.WCM.getDialog(A);
for(var B=0;
B<C.buttons.length;
B++){C.buttons[B].setHandler(function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Button clicked"),this.text+CQ.I18n.getMessage(" was clicked."))
},C.buttons[B])
}if(this.preview.items&&(this.preview.items.getCount()>0)){this.preview.remove(this.preview.items.get(0))
}this.preview.add(C);
this.preview.doLayout();
this.preview.loadMask.hide()
},getDialog:function(){return this.dialogTree.getRootNode().getWidgetConfig()
},loadDialog:function(config){var dlgConfig;
if(typeof (config)=="string"){config=CQ.HTTP.eval(config)
}if(typeof config!="object"||config.xtype!="dialog"){dlgConfig=this.getDialogConfig(config)
}else{dlgConfig=config
}var root=this.dialogTree.getRootNode();
if(dlgConfig.title){root.setText(dlgConfig.title)
}root.setWidgetConfig(dlgConfig);
this.loadDialogTree(dlgConfig,root);
this.loadButtons(dlgConfig,root);
root.expand(true);
this.updatePreview()
},getDialogConfig:function(B){var A;
if(CQ.DialogEditor.getXType(B)=="dialog"){A=B
}else{A={xtype:"dialog","jcr:primaryType":"cq:Dialog"};
if(B["jcr:primaryType"]=="cq:Dialog"){delete B["jcr:primaryType"]
}if(B.xtype=="panel"&&B.title){A.items={xtype:"tabpanel",items:B}
}else{A.items=B
}}A.responseScope=B.responseScope;
A.success=B.success;
A.failure=B.failure;
A.params=B.params;
return A
},loadDialogTree:function(I,C){if(CQ.DialogEditor.getXType(I)=="dialog"){this.loadDialogTree(I.items,C)
}else{if(CQ.DialogEditor.getXType(I)=="widgetcollection"){for(var G in I){if(typeof (I[G])!="object"){continue
}var B=CQ.DialogEditor.getXType(I[G]);
var E=I[G].fieldLabel?I[G].fieldLabel:null;
var D=I[G].title?I[G].title:E;
var A=CQ.DialogEditor.MAPPINGS[B];
if(A){var F=CQ.DialogEditor.createDialogTreeNode(A,G,D,this);
F.setWidgetConfig(I[G]);
C.appendChild(F);
if(G.match("^"+CQ.DialogEditor.PROP_PREFIX)==CQ.DialogEditor.PROP_PREFIX){var H=parseInt(G.substring(CQ.DialogEditor.PROP_PREFIX.length));
if(H>this.fieldCount){this.fieldCount=H
}}if(I[G].items){this.loadDialogTree(I[G].items,F)
}}}}else{var B=CQ.DialogEditor.getXType(I);
var E=I.fieldLabel?I.fieldLabel:null;
var D=I.title?I.title:E;
var A=CQ.DialogEditor.MAPPINGS[B];
if(A){var F=CQ.DialogEditor.createDialogTreeNode(A,B,D,this);
F.setWidgetConfig(I);
C.appendChild(F);
if(I.items){this.loadDialogTree(I.items,F)
}}}}},loadButtons:function(C,E){if(C.buttons){var D=new CQ.DialogEditor.ButtonsTreeNode({name:"buttons",text:CQ.I18n.getMessage("Buttons"),editor:this});
D.setWidgetConfig(C.buttons);
E.appendChild(D);
for(var A in C.buttons){if(typeof (C.buttons[A])=="string"){continue
}C.buttons[A].xtype="button";
var B=CQ.DialogEditor.createButtonTreeNode(C.buttons[A].text,this);
B.setWidgetConfig(C.buttons[A]);
D.appendChild(B)
}}},getNextPropName:function(){this.fieldCount++;
return CQ.DialogEditor.PROP_PREFIX+this.fieldCount
}});
CQ.Ext.reg("dialogeditor",CQ.DialogEditor);
CQ.DialogEditor.getXType=function(A){if(A.xtype){return A.xtype
}else{if(A[CQ.DialogEditor.JCR_PRIMARY_TYPE]){return A[CQ.DialogEditor.JCR_PRIMARY_TYPE].substring(CQ.DialogEditor.NT_CQ_NS_PREFIX.length).toLowerCase()
}else{return CQ.DialogEditor.DEFAULT_FIELD_TYPE
}}};
CQ.DialogEditor.createDialogTreeNode=function(C,B,E,D){var A={name:B,text:(E!=null)?E:C.text,category:C.category,allowedChilds:C.allowedChilds,editor:D};
if(C.category==CQ.DialogEditor.CONTAINER){return new CQ.DialogEditor.ContainerTreeNode(A)
}else{return new CQ.DialogEditor.FieldTreeNode(A)
}};
CQ.DialogEditor.createButtonTreeNode=function(D,C){var B=CQ.DialogEditor.MAPPINGS.button;
var A={name:C.getNextPropName(),text:(D!=null)?D:B.text,category:B.category,editor:C};
return new CQ.DialogEditor.ButtonTreeNode(A)
};
CQ.DialogEditor.DD_GROUP="cq.dialogeditor";
CQ.DialogEditor.DEFAULT_FIELD_TYPE="textfield";
CQ.DialogEditor.PROP_PREFIX="prop";
CQ.DialogEditor.NT_CQ_NS_PREFIX="cq:";
CQ.DialogEditor.NT_DIALOG=CQ.DialogEditor.NT_CQ_NS_PREFIX+"Dialog";
CQ.DialogEditor.NT_COLLECTION=CQ.DialogEditor.NT_CQ_NS_PREFIX+"WidgetCollection";
CQ.DialogEditor.NT_TABPANEL=CQ.DialogEditor.NT_CQ_NS_PREFIX+"TabPanel";
CQ.DialogEditor.NT_PANEL=CQ.DialogEditor.NT_CQ_NS_PREFIX+"Panel";
CQ.DialogEditor.NT_JCR_NS_PREFIX="jcr:";
CQ.DialogEditor.JCR_PRIMARY_TYPE=CQ.DialogEditor.NT_JCR_NS_PREFIX+"primaryType";
CQ.DialogEditor.CONTAINER=CQ.I18n.getMessage("Container");
CQ.DialogEditor.FIELD=CQ.I18n.getMessage("Fields");
CQ.DialogEditor.BUTTON=CQ.I18n.getMessage("Buttons");
CQ.DialogEditor.MAPPINGS={dialog:{hideInList:true,category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Dialog"),insertCfg:{"jcr:primaryType":"cq:Dialog",xtype:"dialog",title:"Dialog",items:{"jcr:primaryType":"cq:WidgetCollection"}},propList:{title:"",width:"",height:"",okText:"",cancelText:""}},panel:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Panel"),insertCfg:{"jcr:primaryType":"cq:Panel",xtype:"panel",title:"Panel"},allowedChilds:["textfield","textarea","numberfield","selection","combo","hidden","richtext"],propList:{title:"",width:"",height:"",border:false}},tabpanel:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Tab Panel"),insertCfg:{xtype:"tabpanel"},allowedChilds:["panel"],propsList:{width:"",height:"",border:false}},selection:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Selection"),insertCfg:{xtype:"selection"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false}},widgetcollection:{hideInList:true,category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Collection"),insertCfg:{"jcr:primaryType":"cq:WidgetCollection"},propList:{}},buttons:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Buttons"),insertCfg:{"jcr:primaryType":"cq:WidgetCollection"},propList:{}},textfield:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Text Field"),insertCfg:{xtype:"textfield"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},textarea:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Text Area"),insertCfg:{xtype:"textarea"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},richtext:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Rich Text"),insertCfg:{xtype:"richtext"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},numberfield:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Number Field"),insertCfg:{xtype:"numberfield"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},tableedit:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Table"),insertCfg:{xtype:"tableedit"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},combo:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Combo Box"),insertCfg:{xtype:"combo"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},hidden:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Hidden"),insertCfg:{xtype:"hidden"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},button:{category:CQ.DialogEditor.BUTTON,text:CQ.I18n.getMessage("Button"),insertCfg:{xtype:"button"},propList:{text:"",handler:""}}};
CQ.DialogEditor.TreeNode=CQ.Ext.extend(CQ.Ext.tree.TreeNode,{afterPropChange:function(){this.updatePreview()
},getEditor:function(){return this.attributes.editor
},getEventRecord:function(A){return A.data.records[0]
},getCategory:function(){return this.attributes.category
},getContextMenuActions:function(){return null
},getWidgetConfig:function(){return this.attributes.widget
},setWidgetConfig:function(A){this.attributes.widget=A
},isInsertAllowed:function(A){return false
},isReorderAllowed:function(A){return false
},handleDrop:function(A){this.updatePreview()
},handleReorder:function(A){this.updatePreview()
},updatePreview:function(){this.getEditor().updatePreview()
},setText:function(A){if(A){CQ.DialogEditor.TreeNode.superclass.setText.call(this,A)
}else{var B=CQ.DialogEditor.getXType(this.getWidgetConfig());
var A=CQ.DialogEditor.MAPPINGS[B].text;
CQ.DialogEditor.TreeNode.superclass.setText.call(this,A)
}},setProperties:function(A){for(var B in A){if(A[B]==""){delete A[B]
}}this.setWidgetConfig(A)
},getProperties:function(){var A=CQ.DialogEditor.getXType(this.getWidgetConfig());
return CQ.Ext.applyIf(this.getWidgetConfig(),CQ.DialogEditor.MAPPINGS[A].propList)
},getPropertyEditors:function(){return{"jcr:primaryType":new CQ.Ext.grid.GridEditor(new CQ.Ext.form.Hidden({})),xtype:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.Hidden({})),height:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),width:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),minLength:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),maxLength:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),validationDelay:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),layout:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,store:["form","border","fit"]})),inputType:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,editable:false,store:["text","password","file"]})),hideMode:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,editable:false,store:["display","offests","visibility"]})),msgTarget:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,store:["qtip","title","under","side"]}))}
},containsObjects:function(A){for(var B in A){if(typeof (A[B])=="object"){return true
}}return false
},getPropertyIndex:function(C,D){var A=0;
for(var B in C){if(D==C[B]){break
}A++
}return A
},insertProperty:function(G,C,F,B){var A={};
var E=0;
var D=false;
for(var H in G){if(E==B){A[C]=F;
D=true
}A[H]=G[H];
E++
}if(!D){A[C]=F
}return A
},removeProperty:function(C,D){var B=true;
for(var A in C){if(typeof (C[A])!="object"){continue
}if(C[A]==D){delete C[A]
}else{B=false
}}if(B){delete C
}}});
CQ.DialogEditor.ContainerTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(B){var A=this.getEventRecord(B);
var C=A.get("insertCfg").xtype;
if(B.point=="append"){return this.isDropAllowed(C)
}else{return(this.parentNode instanceof CQ.DialogEditor.ContainerTreeNode)?this.parentNode.isDropAllowed(C):false
}},isReorderAllowed:function(A){var B=CQ.DialogEditor.getXType(A.dropNode.getWidgetConfig());
if(A.point=="append"){return this.isDropAllowed(B)
}else{return(this.parentNode instanceof CQ.DialogEditor.ContainerTreeNode)?this.parentNode.isDropAllowed(B):false
}},isDropAllowed:function(B){var C=false;
if(this.attributes.allowedChilds){for(var A=0;
A<this.attributes.allowedChilds.length;
A++){if(this.attributes.allowedChilds[A]==B){C=true;
break
}}}else{C=true
}return C
},handleDrop:function(C){var A=this.getEventRecord(C);
var B=CQ.Util.copyObject(A.get("insertCfg"));
if(C.point=="append"){this.insert(B,C.point)
}else{this.parentNode.insert(B,C.point,this)
}CQ.DialogEditor.ContainerTreeNode.superclass.handleDrop.call(this)
},handleReorder:function(D){var B=D.dropNode.parentNode.getWidgetConfig();
var A=D.dropNode.getWidgetConfig();
var E=D.target.getWidgetConfig();
var C;
if(D.point=="append"){C=D.target.getWidgetConfig()
}else{C=D.target.parentNode.getWidgetConfig()
}this.reorder(A,E,B,C,D.point);
CQ.DialogEditor.ContainerTreeNode.superclass.handleReorder.call(this)
},reorder:function(B,H,E,I,F){for(var C in E.items){if(E.items[C]==B){delete E.items[C]
}}var A=this.getEditor().getNextPropName();
if(F=="append"){if(!I.items){I.items=B
}else{if(I.items[CQ.DialogEditor.JCR_PRIMARY_TYPE]==CQ.DialogEditor.NT_COLLECTION){I.items[A]=B
}else{var J=I.items;
I.items={};
I.items[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_COLLECTION;
I.items[A]=J;
I.items[this.getEditor().getNextPropName()]=B
}}}else{if(F=="above"){var D=this.getPropertyIndex(I.items,H);
var G=this.insertProperty(I.items,A,B,D);
I.items=G
}else{if(F=="below"){var D=this.getPropertyIndex(I.items,H)+1;
var G=this.insertProperty(I.items,A,B,D);
I.items=G
}}}},remove:function(A){this.removeProperty(this.getWidgetConfig().items,A.getWidgetConfig());
if(this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]!=CQ.DialogEditor.NT_COLLECTION){delete this.getWidgetConfig().items
}else{if(!this.containsObjects(this.getWidgetConfig().items)){delete this.getWidgetConfig().items
}}this.removeChild(A);
this.updatePreview()
},insert:function(E,A,B){var H=this.getEditor().getNextPropName();
var G=CQ.DialogEditor.createDialogTreeNode(CQ.DialogEditor.MAPPINGS[E.xtype],H,null,this.getEditor());
G.setWidgetConfig(E);
if(A=="append"){this.appendChild(G);
if(!this.getWidgetConfig().items){this.getWidgetConfig().items=E
}else{if(this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]==CQ.DialogEditor.NT_COLLECTION){this.getWidgetConfig().items[H]=E
}else{var F=this.getWidgetConfig().items;
this.getWidgetConfig().items={};
this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_COLLECTION;
this.getWidgetConfig().items[H]=F;
this.getWidgetConfig().items[this.getEditor().getNextPropName()]=E
}}}else{if(A=="above"){this.insertBefore(G,B);
var D=this.getPropertyIndex(this.getWidgetConfig().items,B.getWidgetConfig());
var C=this.insertProperty(this.getWidgetConfig().items,H,E,D);
this.getWidgetConfig().items=C
}else{if(A=="below"){if(B.nextSibling){this.insertBefore(G,B.nextSibling);
var D=this.getPropertyIndex(this.getWidgetConfig().items,B.getWidgetConfig())+1;
var C=this.insertProperty(this.getWidgetConfig().items,H,E,D);
this.getWidgetConfig().items=C
}else{this.appendChild(G);
this.getWidgetConfig().items[H]=E
}}}}G.select();
this.getEditor().props.showProperties(G)
},getContextMenuActions:function(){if(CQ.DialogEditor.getXType(this.parentNode.getWidgetConfig())=="dialog"){return[]
}return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Container"),text:CQ.I18n.getMessage("Removes the container widget from the dialog"),autoHide:true}}]
},afterPropChange:function(){this.setText(this.getWidgetConfig().title);
CQ.DialogEditor.ContainerTreeNode.superclass.updatePreview.call(this)
}});
CQ.DialogEditor.FieldTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(B){var A=this.getEventRecord(B);
var C;
if(A&&A.get("insertCfg")){C=A.get("insertCfg").xtype
}else{C=CQ.DialogEditor.getXType(B.dropNode.getWidgetConfig())
}return(B.point!="append")&&this.parentNode.isDropAllowed(C)
},isReorderAllowed:function(A){var B;
if(A.dropNode.attributes.insertCfg){B=A.dropNode.attributes.insertCfg.xtype
}else{B=CQ.DialogEditor.getXType(A.dropNode.getWidgetConfig())
}return(A.point!="append")&&this.parentNode.isDropAllowed(B)
},handleDrop:function(C){var A=this.getEventRecord(C);
var B=A.get("insertCfg");
this.parentNode.insert(B,C.point,this);
CQ.DialogEditor.FieldTreeNode.superclass.handleDrop.call(this)
},handleReorder:function(D){var B=D.dropNode.parentNode.getWidgetConfig();
var C=D.target.parentNode.getWidgetConfig();
var A=D.dropNode.getWidgetConfig();
var E=D.target.getWidgetConfig();
this.parentNode.reorder(A,E,B,C,D.point);
CQ.DialogEditor.FieldTreeNode.superclass.handleReorder.call(this)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Field"),text:CQ.I18n.getMessage("Removes the field from the dialog"),autoHide:true}}]
},afterPropChange:function(){this.setText(this.getWidgetConfig().fieldLabel);
CQ.DialogEditor.FieldTreeNode.superclass.updatePreview.call(this)
}});
CQ.DialogEditor.DialogTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{afterPropChange:function(){this.setText(this.getWidgetConfig().title);
CQ.DialogEditor.DialogTreeNode.superclass.updatePreview.call(this)
},remove:function(A){this.removeProperty(this.getWidgetConfig(),A.getWidgetConfig());
this.removeChild(A);
this.updatePreview()
},isInsertAllowed:function(B){var A=this.getEventRecord(B);
if(A&&A.get("text")&&(A.get("text")==CQ.I18n.getMessage("Buttons"))&&(!this.getWidgetConfig().buttons)){return true
}return false
},handleDrop:function(C){var A=this.getEventRecord(C);
this.getWidgetConfig().buttons=A.get("insertCfg");
var B=new CQ.DialogEditor.ButtonsTreeNode({name:"buttons",text:CQ.I18n.getMessage("Buttons"),editor:this.getEditor()});
B.setWidgetConfig(this.getWidgetConfig().buttons);
this.appendChild(B);
CQ.DialogEditor.DialogTreeNode.superclass.handleDrop.call(this)
}});
CQ.DialogEditor.ButtonsTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(B){var A=this.getEventRecord(B);
if(A&&(A.get("category")==CQ.DialogEditor.BUTTON)){return true
}return false
},handleDrop:function(E){if(!this.getWidgetConfig()){this.setWidgetConfig({});
this.getWidgetConfig()[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_WIDGET_COLLECTION
}var A=this.getEventRecord(E);
var C=CQ.Util.copyObject(A.get("insertCfg"));
var B=this.getEditor().getNextPropName();
this.getWidgetConfig()[B]=C;
var D=CQ.DialogEditor.createButtonTreeNode(C.text,this.getEditor());
D.setWidgetConfig(C);
this.appendChild(D);
CQ.DialogEditor.ButtonsTreeNode.superclass.handleDrop.call(this)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Buttons Container"),text:CQ.I18n.getMessage("Removes the buttons container from the dialog"),autoHide:true}}]
},remove:function(A){this.removeProperty(this.getWidgetConfig(),A.getWidgetConfig());
this.removeChild(A);
this.updatePreview()
}});
CQ.DialogEditor.ButtonTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{afterPropChange:function(){this.setText.call(this,this.getWidgetConfig().text);
CQ.DialogEditor.DialogTreeNode.superclass.updatePreview.call(this)
},getProperties:function(){return CQ.Ext.applyIf(this.getWidgetConfig(),CQ.DialogEditor.MAPPINGS.button.propList)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Button"),text:CQ.I18n.getMessage("Removes the button from the dialog"),autoHide:true}}]
}});
CQ.DialogEditor.DragZone=function(A,B){this.view=A;
CQ.DialogEditor.DragZone.superclass.constructor.call(this,A.getEl(),B)
};
CQ.Ext.extend(CQ.DialogEditor.DragZone,CQ.Ext.dd.DragZone,{getDragData:function(F){var E=F.getTarget(".x-control");
if(E){var A=this.view;
if(!A.isSelected(E)){A.onClick(F)
}var C=A.getSelectedNodes();
var B=A.getSelectedRecords();
var D={nodes:C,records:B};
D.ddel=E;
D.single=true;
return D
}return false
},afterRepair:function(){for(var B=0,A=this.dragData.nodes.length;
B<A;
B++){CQ.Ext.fly(this.dragData.nodes[B]).frame("#8db2e3",1)
}this.dragging=false
},getRepairXY:function(B){if(!this.dragData.multi){var A=CQ.Ext.Element.fly(this.dragData.ddel).getXY();
A[0]+=3;
A[1]+=3;
return A
}return false
}});
CQ.MediaBrowseDialog=CQ.Ext.extend(CQ.Dialog,{deleteButton:null,getSelectedPath:function(){try{return this.tree.getSelectionModel().getSelectedNode().getPath()
}catch(A){return""
}},loadContent:function(A){if(typeof A=="string"){this.path=A;
this.tree.selectPath(A)
}},constructor:function(A){var B=this;
if(!A){A=new Object()
}CQ.Ext.applyIf(A,{title:CQ.I18n.getMessage("Select a media item")});
this.mediaView=new CQ.Ext.DataView({cls:"cq-media-view",loadingText:CQ.I18n.getMessage("Loading media..."),templates:{thumbs:{itemSelector:".thumb-wrap",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">','<img src="{[CQ.HTTP.externalize(values.path + values.img140Postfix)]}"',' qtip="{qtipTitle}: {name}<br/>',"{qtipSize}: {sizeString}<br/>","{qtipCreated}: {createdString}<br/>",'{qtipModified}: {modifiedString}"/>',"</div>","<span>{shortName}</span>","</div>","</tpl>",'<div class="x-clear"></div>')},details:{itemSelector:".detail-wrap",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="detail-wrap">','<div class="detail">','<img src="{[CQ.HTTP.externalize(values.path + values.img70Postfix)]}"/>','<div><span class="bold">{qtipTitle}:</span> {name}</div>','<div><span class="bold">{qtipSize}:</span> {sizeString}</div>','<div><span class="bold">{qtipCreated}:</span> {createdString}</div>','<div><span class="bold">{qtipModified}:</span> {modifiedString}</div>',"</div>","</div>",'<div class="x-clear"></div>',"</tpl>")}},multiSelect:false,singleSelect:true,overClass:"x-view-over",emptyText:CQ.I18n.getMessage("No media items to display"),prepareData:function(C){C.qtipTitle=CQ.I18n.getMessage("Title");
C.shortName=CQ.Ext.util.Format.ellipsis(C.name,15);
C.qtipSize=CQ.I18n.getMessage("Size");
C.sizeString=CQ.Ext.util.Format.fileSize(C.size);
C.qtipCreated=CQ.I18n.getMessage("Created");
C.createdString=C.created.format(CQ.themes.MediaBrowseDialog.MEDIA_DATE);
C.qtipModified=CQ.I18n.getMessage("Last Modified");
C.modifiedString=C.lastmod.format(CQ.themes.MediaBrowseDialog.MEDIA_DATE);
C.img140Postfix=".thumb.100.140.png";
C.img70Postfix=".thumb.50.70.png";
return C
},listeners:{render:function(C){C.loadMask=new CQ.Ext.LoadMask(C.getEl(),{store:this.store});
C.dragZone=new CQ.MediaBrowseDialog.DragZone(C,{containerScroll:true});
C.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_ASSET);
C.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
},selectionchange:function(D,C){if(!B.deleteButton){B.deleteButton=B.findByType("panel")[1].getTopToolbar().items.get(1)
}if(C.length==0){B.deleteButton.disable()
}else{B.deleteButton.enable()
}}}});
this.mediaView.tpl=this.mediaView.templates.thumbs.tpl;
this.mediaView.itemSelector=this.mediaView.templates.thumbs.itemSelector;
if(!A.treeRoot){A.treeRoot=new Object()
}this.treeRootConfig=CQ.Ext.applyIf(A.treeRoot,{name:"content/dam",text:CQ.I18n.getMessage("Media"),draggable:false,expanded:true});
if(!A.treeLoader){A.treeLoader=new Object()
}this.treeLoaderConfig=CQ.Ext.applyIf(A.treeLoader,{baseParams:{predicate:"hierarchy"},requestMethod:"GET",dataUrl:"/bin/tree/ext.json",baseAttrs:{singleClickExpand:true,draggable:false},listeners:{beforeload:function(C,D){this.baseParams.path=D.getPath()
}}});
this.tree=new CQ.Ext.tree.TreePanel({lines:false,animate:true,enableDD:false,containerScroll:true,autoScroll:true,split:true,region:"north",height:115,loader:new CQ.Ext.tree.TreeLoader(this.treeLoaderConfig),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootConfig),listeners:{click:function(D,C){B.loadMedia.call(B,D.getPath())
}}});
A=CQ.Util.merge(A,{closable:true,cls:"cq-mediabrowse",height:CQ.themes.MediaBrowseDialog.HEIGHT,minHeight:CQ.themes.MediaBrowseDialog.MIN_HEIGHT,width:CQ.themes.MediaBrowseDialog.WIDTH,minWidth:CQ.themes.MediaBrowseDialog.MIN_WIDTH,autoHeight:false,autoWidth:false,resizable:CQ.themes.MediaBrowseDialog.RESIZABLE,resizeHandles:CQ.themes.MediaBrowseDialog.RESIZE_HANDLES,items:{xtype:"panel",layout:"border",autoScroll:false,border:false,items:[this.tree,new CQ.Ext.Panel({autoEl:"div",region:"center",autoScroll:true,collapsible:true,items:[this.mediaView],tbar:[{text:CQ.I18n.getMessage("Upload"),tooltip:{title:CQ.I18n.getMessage("Upload Media"),text:CQ.I18n.getMessage("Allows uploading media items to the selected location"),autoHide:true},handler:function(){var D=CQ.utils.Util.getFlashVersion();
var C=(D!=null)&&(D[0]>=9);
var F;
C=false;
if(C){F={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Upload Media to")+": "+B.getSelectedPath(),formUrl:B.getSelectedPath(),items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",file:{xtype:"smartfile",allowUploadOnly:true,simpleUpload:true,fieldLabel:CQ.I18n.getMessage("File"),autoUploadDelay:"-1",sizeLimit:"1000",name:"./*",uploadUrl:"/tmp/media_upload"+B.getSelectedPath()}}}}
}else{F={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Upload Media to")+": "+B.getSelectedPath(),formUrl:B.getSelectedPath().replace("/content/dam","/var/dam"),fileUpload:true,items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",file:{xtype:"fileuploadfield",fieldLabel:CQ.I18n.getMessage("File"),name:"./*"}}}}
}var E=CQ.WCM.getDialog(F);
E.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not upload media."))
};
E.success=function(){if(B.mediaView.store!=null){B.mediaView.store.reload()
}};
E.show()
}},{text:CQ.I18n.getMessage("Delete"),disabled:true,tooltip:{title:CQ.I18n.getMessage("Delete Media"),text:CQ.I18n.getMessage("Deletes the selected media"),autoHide:true},handler:function(){var H=CQ.I18n.getMessage("You are going to delete the following media: ")+"<br/>";
var E=B.mediaView;
var G=E.getSelectedRecords();
var I=E.getSelectedNodes();
for(var D=0;
D<G.length;
D++){H+=(G[D].data.name?G[D].data.name:G[D].data.path)+"<br/>"
}H+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var F=CQ.I18n.getMessage("Delete Page?");
var C=this;
CQ.Ext.Msg.show({title:F,msg:H,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(N){if(N=="yes"){var M=[];
var K=[];
for(var L=0;
L<G.length;
L++){var J=G[L];
M.push(J.data.path)
}CQ.HTTP.post("/bin/wcmcommand",function(P,S,O){if(S){for(var Q=0;
Q<I.length;
Q++){var R=I[Q];
E.deselect(R);
R.style.display="none"
}}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getVarMessage(O.message))
}},{path:M,_charset_:"utf-8",cmd:"deletePage",deep:true})
}},scope:this})
}},"->",{text:CQ.I18n.getMessage("Thumbnails"),toggleGroup:"view",view:"thumbs",enableToggle:true,toggleHandler:B.switchView,scope:B,pressed:true,allowDepress:false,tooltip:{title:CQ.I18n.getMessage("Thumbnails View"),text:CQ.I18n.getMessage("Switch to thumbnails view"),autoHide:true}},{text:CQ.I18n.getMessage("Details"),toggleGroup:"view",view:"details",enableToggle:true,toggleHandler:B.switchView,scope:B,pressed:false,allowDepress:false,tooltip:{title:CQ.I18n.getMessage("Details View"),text:CQ.I18n.getMessage("Switch to details view"),autoHide:true}}]})]}});
CQ.MediaBrowseDialog.superclass.constructor.call(this,A);
this.tree.selectPath(this.tree.getRootNode().id);
this.loadMedia(this.tree.getRootNode().getPath())
},loadMedia:function(B){var A=new CQ.Ext.data.JsonStore({url:B+".media.json",root:"items",fields:["name","path",{name:"size",type:"float"},{name:"created",type:"date",dateFormat:"timestamp"},{name:"lastmod",type:"date",dateFormat:"timestamp"}]});
this.mediaView.setStore(A);
this.mediaView.store.reload()
},switchView:function(A,B){if(B){this.mediaView.tpl=this.mediaView.templates[A.view].tpl;
this.mediaView.itemSelector=this.mediaView.templates[A.view].itemSelector
}if(this.mediaView.store!=null){this.mediaView.refresh()
}}});
CQ.Ext.reg("mediabrowsedialog",CQ.MediaBrowseDialog);
CQ.MediaBrowseDialog.DragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{constructor:function(A,B){this.view=A;
CQ.MediaBrowseDialog.DragZone.superclass.constructor.call(this,A.getEl(),B)
},getDragData:function(G){var H=G.getTarget(this.view.itemSelector);
if(H){var I=this.view;
if(!I.isSelected(H)){I.onClick(G)
}var B=I.getSelectedNodes();
var E=I.getSelectedRecords();
var C={nodes:B,records:E};
if(B.length==1){C.ddel=H.firstChild.firstChild;
C.single=true
}else{var A=document.createElement("div");
A.className="multi-proxy";
for(var D=0,F=B.length;
D<F;
D++){A.appendChild(B[D].firstChild.firstChild.cloneNode(true));
if((D+1)%2==0){A.appendChild(document.createElement("br"))
}}C.ddel=A;
C.multi=true
}return C
}return false
},afterRepair:function(){for(var B=0,A=this.dragData.nodes.length;
B<A;
B++){CQ.Ext.fly(this.dragData.nodes[B]).frame("#8db2e3",1)
}this.dragging=false
},getRepairXY:function(B){if(!this.dragData.multi){var A=CQ.Ext.Element.fly(this.dragData.ddel).getXY();
A[0]+=3;
A[1]+=3;
return A
}return false
},notifyDropDT:function(C,B,A){if(this.isDropAllowed(C)){if(C.groups){if(C.groups[CQ.wcm.EditBase.DD_GROUP_ASSET]){return C.editComponent.updateParagraph(C.propertyName,A.records[0].data.path,C.postParams)
}}else{return C.editComponent.updateParagraph(C.propertyName,A.records[0].data.path,C.postParams)
}}return false
},notifyEnterDT:function(C,B,A){return""
},notifyOutDT:function(C,B,A){return""
},notifyOverDT:function(C,B,A){if(this.isDropAllowed(C)){return this.dropAllowed
}else{return this.dropNotAllowed
}},isDropAllowed:function(A){if(A&&A.groups&&CQ.Util.isIntersecting(this.groups,A.groups)){return true
}return false
}});
CQ.Switcher=CQ.Ext.extend(CQ.Ext.Toolbar,{constructor:function(A){try{A=CQ.Util.applyDefaults(A,{id:"cq-switcher",columnWidth:0.9});
A.items=this.setUpButtons(A);
CQ.Switcher.superclass.constructor.call(this,A)
}catch(B){CQ.Log.error(B.message)
}},setUpButtons:function(E){var D=CQ.User.getCurrentUser().getAllowedApps();
var C=new Array();
var G=this;
for(var F in D){if(!D.hasOwnProperty(F)){continue
}var H=D[F];
var B=H.appName?H.appName:CQ.I18n.getMessage("CQ5 Console");
var A=H.iconClass?H.iconClass:"siteadmin";
A=(this.isActive(H))?A:A+"-inactive";
if(CQ.Ext.isIE6){A+="-ie6"
}C.push(new CQ.Ext.Toolbar.Button({tooltip:B,iconCls:"cq-switcher-"+A,disabled:false,scope:this,handler:this.doSwitch,app:H,scale:"large",handleMouseEvents:false}))
}return C
},isActive:function(B){var A=window.location.pathname;
return((A.match("^"+B.path)==B.path)||(A.match("^"+B.vanityPath)==B.vanityPath))
},doSwitch:function(C,A){var E=C.app;
var D=E.vanityPath?E.vanityPath:E.path;
if(!this.isActive(E)){var B=CQ.Util.externalize(D);
if(A.shiftKey){CQ.shared.Util.open(B)
}else{CQ.shared.Util.load(B)
}}}});
CQ.Ext.reg("switcher",CQ.Switcher);
CQ.HistoryButton=CQ.Ext.extend(CQ.Ext.Toolbar.Button,{id:null,forwardId:null,forwardHandler:null,backHandler:null,historyId:null,pos:0,stack:null,constructor:function(A){if(A.historyId){A=CQ.Util.applyDefaults(A,{tooltip:CQ.I18n.getMessage("Go Forward"),disabled:true,scope:this,forwardHandler:A.forwardHandler,handler:function(){try{var C=CQ.Ext.getCmp(this.historyId);
C.goForward()
}catch(B){}},text:"&raquo;"})
}else{A=CQ.Util.applyDefaults(A,{tooltip:CQ.I18n.getMessage("Go Back"),disabled:true,scope:this,backHandler:A.backHandler,handler:this.goBack,text:"&laquo;"});
this.stack=new Array()
}CQ.HistoryButton.superclass.constructor.call(this,A)
},goForward:function(){if(this.forwardHandler){this.pos=this.pos+1;
this.forwardHandler(this.stack[this.pos]);
if(this.pos==(this.stack.length-1)){this.forwardButton.setDisabled(true)
}this.setDisabled(false)
}},goBack:function(){if(this.backHandler){this.pos=this.pos-1;
var A=this.stack[this.pos];
this.backHandler(A);
if(this.pos==0){this.setDisabled(true)
}this.forwardButton.setDisabled(false)
}},addHistory:function(A){if(this.pos+1!=this.stack.length){this.stack.splice(this.pos+1)
}this.stack.push(A);
this.pos=this.stack.length-1;
if(!this.forwardButton){this.forwardButton=CQ.Ext.getCmp(this.forwardId)
}this.setDisabled(false);
this.forwardButton.setDisabled(true)
}});
CQ.Ext.reg("historybutton",CQ.HistoryButton);
CQ.CustomContentPanel=CQ.Ext.extend(CQ.Ext.Panel,{urlGET:null,pathGet:null,urlPOST:null,pathPost:null,urlExtensionGET:null,extensionGet:null,urlExtensionPOST:null,extensionPost:null,executePost:true,urlGet:null,urlPost:null,constructor:function(A){A=(!A?{}:A);
var B={};
CQ.Util.applyDefaults(A,B);
this.formPanel=this;
CQ.CustomContentPanel.superclass.constructor.call(this,A)
},initComponent:function(){CQ.CustomContentPanel.superclass.initComponent.call(this);
var A=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(B){A.computeUrlGET(this.path);
A.loadContent()
},this.parentDialog);
this.parentDialog.on("beforesubmit",function(){A.computeUrlPOST(this.path);
A.submitPanel(A.urlPost)
},this.parentDialog)
}},this)
},computeUrlGET:function(A){this.urlGet=(this.pathGet||this.urlGET)?this.pathGet||this.urlGET:A;
if(this.extensionGet||this.urlExtensionGET){this.urlGet+=this.extensionGet||this.urlExtensionGET
}},computeUrlPOST:function(A){this.urlPost=(this.pathPost||this.urlPOST)?this.pathPost||this.urlPOST:A;
if(this.extensionPost||this.urlExtensionPost){this.urlPost+=this.extensionPost||this.urlExtensionPost
}},submitPanel:function(){var A=CQ.Util.findFormFields(this.formPanel);
if(!this.disabled){var D={};
for(var B in A){for(var C=0;
C<A[B].length;
C++){if(!A[B][C].disabled){if(!D[B]){D[B]=new Array()
}D[B]=D[B].concat(A[B][C].getValue());
A[B][C].disable()
}}}if(this.executePost){var E=CQ.utils.HTTP.post(this.urlPost,null,D,this);
return CQ.utils.HTTP.isOk(E)
}}else{for(var B in A){for(var C=0;
C<A[B].length;
C++){A[B][C].disable()
}}}return false
},loadContent:function(){var A=null;
if(!this.content){var B=CQ.HTTP.externalize(this.urlGet);
A=new CQ.data.SlingStore({url:B})
}else{if(this.content instanceof CQ.Ext.data.Store){A=this.content
}}A.load({callback:this.processRecords,scope:this})
},processRecords:function(E,D,H){var G;
if(H){G=E[0]
}else{CQ.Log.warn("CQ.CustomContentPanel#processRecords: retrieval of records unsuccessful");
G=new CQ.data.SlingRecord();
G.data={}
}CQ.Log.debug("CQ.CustomContentPanel#processRecords: processing records for fields");
var A=CQ.Util.findFormFields(this.formPanel);
for(var B in A){for(var C=0;
C<A[B].length;
C++){try{if((!A[B][C].initialConfig||!A[B][C].initialConfig.disabled)&&A[B][C].enable){A[B][C].enable()
}if(A[B][C].processPath){CQ.Log.debug("CQ.CustomContentPanel#processRecords: calling processPath of field '{0}'",[B]);
A[B][C].processPath(this.path)
}if(!A[B][C].initialConfig.ignoreData){CQ.Log.debug("CQ.CustomContentPanel#processRecords: calling processRecord of field '{0}'",[B]);
A[B][C].processRecord(G,this.path)
}}catch(F){CQ.Log.debug("CQ.CustomContentPanel#processRecords: {0}",F.message)
}}}this.fireEvent("loadcontent",this)
}});
CQ.Ext.reg("customcontentpanel",CQ.CustomContentPanel);
CQ.WrappingToolbar=CQ.Ext.extend(CQ.Ext.Toolbar,{rewrapWidth:null,constructor:function(A){CQ.WrappingToolbar.superclass.constructor.call(this,A)
},getTableCells:function(A,C){var B=CQ.Ext.DomQuery.select("td[class=x-toolbar-cell]",A);
C.push.apply(C,B)
},rewrap:function(L){var F=this.el.dom;
var P=F.childNodes;
var E=[];
for(var I=0;
I<P.length;
I++){var G=P[I];
this.getTableCells(G,E)
}var U=[];
var B={width:0,cells:[],sepWidth:0,sepCell:null};
U.push(B);
for(var O=0;
O<E.length;
O++){var N=E[O].clientWidth;
var R=(CQ.Ext.DomQuery.select("span[class=xtb-sep]",E[O]).length==1);
if(R){B.sepWidth=N;
B.sepCell=E[O];
B={width:0,cells:[],sepWidth:0,sepCell:0};
U.push(B)
}else{B.width+=N;
B.cells.push(E[O])
}}var T=CQ.Ext.DomQuery.select("td[class=x-toolbar-left]>table",F);
var M=T.length;
for(var J=0;
J<M;
J++){T[J].parentNode.removeChild(T[J])
}var K=CQ.Ext.DomQuery.select("td[class=x-toolbar-left]",F)[0];
var A=0;
var D=null;
var Q=0;
while(Q<U.length){if(A==0){var S=document.createElement("table");
S.cellSpacing=0;
K.appendChild(S);
var C=document.createElement("tbody");
S.appendChild(C);
D=document.createElement("tr");
var W=CQ.Ext.get(D);
W.addClass("x-toolbar-left-row");
C.appendChild(D)
}var H=A+U[Q].width+U[Q].sepWidth;
if((A>0)&&(H>L)){A=0
}else{for(var V=0;
V<U[Q].cells.length;
V++){D.appendChild(U[Q].cells[V])
}if(U[Q].sepCell){D.appendChild(U[Q].sepCell)
}A=H;
Q++
}}},onResize:function(A,B){if(typeof (A)=="object"){A=A.width
}if(A&&(A!=this.rewrapWidth)){this.rewrap(A);
this.rewrapWidth=A
}CQ.WrappingToolbar.superclass.onResize.call(this,A,B)
}});
CQ.IframePanel=CQ.Ext.extend(CQ.Ext.Panel,{iframe:null,setUrl:function(A){var B=this.getIframe();
if(B){B.src=A
}},getUrl:function(){var A=this.getIframe();
if(A){return A.src
}return null
},getIframe:function(){if(!this.iframe){if(this.iframeID){this.iframe=document.getElementById(this.iframeID)
}}return this.iframe
},getDoc:function(){var A=this.getIframe();
if(A){return A.contentWindow.document
}return null
},getContentWin:function(){var A=this.getIframe();
if(A){return A.contentWindow
}return null
},constructor:function(C){var E=C.id;
if(!E){E=CQ.Ext.id()
}this.iframeID=E+"-iframe";
var B='CQ.Ext.getCmp("'+E+'").onIframeLoad(this, event)';
var A=C.iframeStyle||"width:100%; height:100%; border:0px;";
var D="<iframe id='"+this.iframeID+"' onload='"+B+"' style='"+A+"' ";
if(CQ.Ext.isIE){D=D+"frameborder='0' "
}if(C.url){D=D+"src='"+C.url+"'"
}D=D+"/>";
CQ.Util.applyDefaults(C,{cls:"cq-iframe-panel",id:E,html:D});
CQ.IframePanel.superclass.constructor.call(this,C)
},initComponent:function(){CQ.IframePanel.superclass.initComponent.call(this);
this.addEvents("iframeload")
},onIframeLoad:function(A,B){this.iframe=A;
this.fireEvent("iframeload",this,A,B)
},onDestroy:function(){var A=this.getIframe();
if(A&&A.parentNode){A.parentNode.removeChild(A);
this.iframe=null
}CQ.IframePanel.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("iframepanel",CQ.IframePanel);
CQ.IframeDialog=CQ.Ext.extend(CQ.Dialog,{iframePanel:null,submitted:false,getIframePanel:function(){if(!this.iframePanel){this.iframePanel=this.findByType("iframepanel")[0]
}return this.iframePanel
},getDoc:function(){var A=this.getIframePanel();
if(A){return A.getDoc()
}return null
},getContentWin:function(){var A=this.getIframePanel();
if(A){return A.getContentWin()
}return null
},getIframeForm:function(){var A=this.getIframePanel();
if(A){var B=A.getContentWin();
if(B[this.iframeFormName]){return B[this.iframeFormName]
}else{var C=A.getDoc().forms[this.iframeFormName];
return new CQ.form.FormWrapper({form:C})
}}return null
},buildIframeUrl:function(B){if(this.pathSuffix){var A=(B.charAt(B.length-1)==="/");
var C=(this.pathSuffix.charAt(0)==="/");
if(A&&C){B=B+this.pathSuffix.substr(1)
}else{if(A||C){B=B+this.pathSuffix
}else{B=B+"/"+this.pathSuffix
}}}if(this.formPath){if(B.charAt(B.length-1)==="/"){B=B+".form.create.html"+this.formPath
}else{B=B+".form.html"+this.formPath
}}if(window.location.search&&window.location.search.indexOf("debugClientLibs=true")!=-1){B=CQ.HTTP.addParameter(B,"debugClientLibs","true")
}if(!this.allowEditMode){B=CQ.HTTP.addParameter(B,CQ.WCM.MODE_COOKIE,"disabled")
}return B
},constructor:function(A){this.formPath=A.formPath;
this.allowEditMode=A.allowEditMode;
this.pathSuffix=A.pathSuffix;
this.iframeFormName=A.iframeFormName||"formpage_form";
this.okText=A.okText?A.okText:CQ.I18n.getMessage("OK");
this.cancelText=A.cancelText?A.cancelText:CQ.I18n.getMessage("Cancel");
CQ.Util.applyDefaults(A,{cls:"cq-iframe-dialog",plain:false,bodyStyle:"",maskMsg:CQ.I18n.getMessage("Loading..."),maskCls:"x-mask-loading"});
var B={xtype:"iframepanel",border:false,listeners:{iframeload:this.onIframeLoad,scope:this}};
if(A.iframeStyle){B.iframeStyle=A.iframeStyle
}A.items=B;
CQ.IframeDialog.superclass.constructor.call(this,A)
},initComponent:function(){CQ.IframeDialog.superclass.initComponent.call(this);
this.setButtonsDisabled(true);
this.addEvents("iframeformload")
},loadContent:function(B){if(typeof B==="string"){this.setButtonsDisabled(true);
if(this.maskMsg){this.body.mask(this.maskMsg,this.maskCls)
}var C=this.getIframePanel();
if(C){var A=this.buildIframeUrl(B);
if(A){A=CQ.HTTP.externalize(A);
this.submitted=false;
C.setUrl(A)
}}}},setButtonsDisabled:function(A){CQ.Ext.each(this.buttons,function(B){B.setDisabled(A)
})
},onIframeLoad:function(A,C,E){CQ.WCM.setContentWindowLoading(false);
if(this.submitted){var B={};
if(this.responseScope){B={scope:this.responseScope,success:this.success?this.success:this.responseScope.success,failure:this.failure?this.failure:this.responseScope.failure}
}else{if(this.success){B.success=this.success
}if(this.failure){B.failure=this.failure
}}if(typeof B.success==="function"){B.success.apply(B.scope,[this,{}])
}}else{this.setButtonsDisabled(false);
if(this.maskMsg){this.body.unmask()
}var D=this.getIframeForm();
if(D){D.on("beforesubmit",function(){if(this.fireEvent("beforesubmit",this)===false){return false
}this.submitted=true;
this.hide()
},this)
}this.fireEvent("loadContent",this)
}},ok:function(){this.submit()
},submit:function(B){var A=this.getIframeForm();
if(A&&A.submit(B)){this.submitted=true;
this.hide();
return true
}return false
},onDestroy:function(){var A=this.getIframePanel();
if(A){A.destroy();
this.iframePanel=null
}CQ.IframeDialog.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("iframedialog",CQ.IframeDialog);
CQ.form.SlingSubmitAction=CQ.Ext.extend(CQ.Ext.form.Action.Submit,{type:"slingsubmit",success:function(B){var A=this.processResponse(B);
if(A.Status&&A.Status.indexOf("2")==0){this.form.afterAction(this,B,true);
return 
}this.form.afterAction(this,false)
},handleResponse:function(D){if(this.form.errorReader){var C=this.form.errorReader.read(D);
var G=[];
if(C.records){for(var E=0,A=C.records.length;
E<A;
E++){var F=C.records[E];
G[E]=F.data
}}if(G.length<1){G=null
}return{success:C.success,errors:G}
}var B=CQ.Util.evalHTML(D.responseText);
return B
}});
CQ.form.UploadSubmitAction=CQ.Ext.extend(CQ.form.SlingSubmitAction,{type:"uploadsubmit",run:function(){var D=this.options;
var E=this.getMethod();
var C=E=="GET";
if(D.clientValidation===false||this.form.isValid()){if(this.form.flashUpload){if(!D.usePIN||D.usePIN===false){this.form.flashUpload.setUploadURL(this.getUrl(C));
this.form.flashUpload.startUpload()
}else{var B=CQ.HTTP.getCookie("cqpin");
if(B){this.form.flashUpload.setUploadURL(this.getUrl(C));
this.form.flashUpload.addPostParam(":cqpin",B);
this.form.flashUpload.startUpload()
}else{var A=this;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/cq/security/content/pin"),params:{userid:CQ.User.getCurrentUser().getUserID(),enabled:true},success:function(F){B=F.responseText.split("\n")[0].replace("Pin ","");
A.form.flashUpload.setUploadURL(A.getUrl(C));
A.form.flashUpload.addPostParam(":cqpin",B);
CQ.HTTP.setCookie("cqpin",B,"/",0);
A.form.flashUpload.startUpload()
},failure:D.failure?D.failure:this.failure})
}}}else{CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(D),{form:this.form.el.dom,url:this.getUrl(C),method:E,headers:D.headers,params:!C?this.getParams():null,isUpload:true,success:D.success?D.success:this.success,failure:D.failure?D.failure:this.failure}))
}}else{if(D.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}return false
}});
if(!CQ.form.Action){CQ.form.Action={}
}CQ.form.Action.Submit=CQ.Ext.extend(CQ.form.SlingSubmitAction,{type:"cqsubmit"});
CQ.form.CompositeField=CQ.Ext.extend(CQ.Ext.Panel,{allowBlank:true,blankText:CQ.Ext.form.TextField.prototype.blankText,readOnly:false,defaultValue:null,ignoreData:false,invalidClass:"x-form-invalid",invalidText:"The value of this field is invalid",layout:"form",value:null,isFormField:true,dropTargets:null,initComponent:function(){CQ.form.CompositeField.superclass.initComponent.call(this);
this.addEvents("invalid","valid","beforeloadcontent","loadcontent")
},getName:function(){return this.name
},getRawValue:function(){return this.value
},getValue:function(){return this.value!=null?this.value:""
},setValue:function(A){this.value=A
},isValid:function(A){return CQ.Ext.form.Field.prototype.isValid(A)
},processRecord:function(A,C){if(this.fireEvent("beforeloadcontent",this,A,C)!==false){var B=A.get(this.getName());
if(B==undefined&&this.defaultValue!=null){if(this.isApplyDefault(A,C)){this.setValue(this.defaultValue)
}}else{this.setValue(B)
}this.fireEvent("loadcontent",this,A,C)
}},processPath:function(B,A){},isApplyDefault:function(A,C){var D=A.get("jcr:created");
if(!D&&A.data.length==0){return false
}var B=A.get("jcr:lastModified");
if(!B){B=A.get("cq:lastModified")
}return D==B
},getDropTargets:function(){return this.dropTargets
},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();
return true
}return false
},processValue:function(A){if((A===undefined)||(A===null)){A=""
}return A
},validateValue:function(A){if(A.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(this.vtype){var C=CQ.Ext.form.VTypes;
if(!C[this.vtype](A,this)){this.markInvalid(this.vtypeText||C[this.vtype+"Text"]);
return false
}}if(typeof this.validator=="function"){var B=this.validator(A);
if(B!==true){this.markInvalid(B);
return false
}}if(this.regex&&!this.regex.test(A)){this.markInvalid(this.regexText);
return false
}return true
},markInvalid:function(A){this.fireEvent("invalid",this,A)
},clearInvalid:function(){this.fireEvent("valid",this)
},getMessageHandler:function(){return CQ.Ext.form.MessageTargets[this.msgTarget]
},afterRender:function(){CQ.form.CompositeField.superclass.afterRender.call(this);
this.initValue()
},reset:function(){this.setValue(this.originalValue);
this.clearInvalid()
},initValue:function(){this.originalValue=this.getValue()
}});
CQ.Ext.reg("compositefield",CQ.form.CompositeField);
CQ.form.ClearableComboBox=CQ.Ext.extend(CQ.Ext.form.ComboBox,{editable:false,triggerAction:"all",initComponent:function(){CQ.Ext.form.TwinTriggerField.prototype.initComponent.call(this);
CQ.Ext.form.ComboBox.prototype.initComponent.call(this)
},setValue:function(A){CQ.form.ClearableComboBox.superclass.setValue.call(this,A);
if(this.triggers&&A&&(A!="")){this.triggers[0].show()
}},listeners:{render:function(A){var B=this.getValue();
if(B&&(B!="")){this.triggers[0].show()
}}},getTrigger:CQ.Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:CQ.Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",trigger2Class:CQ.Ext.form.ComboBox.prototype.triggerClass,hideTrigger1:true,onTrigger2Click:CQ.Ext.form.ComboBox.prototype.onTriggerClick,onTrigger1Click:function(){this.clearValue();
this.triggers[0].hide();
this.fireEvent("clear",this)
}});
CQ.Ext.reg("clearcombo",CQ.form.ClearableComboBox);
CQ.form.ColorField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{constructor:function(A){A=CQ.Util.applyDefaults(A,{showHexValue:false,triggerClass:"x-form-color-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off",maxlength:"6"},lengthText:CQ.I18n.getMessage("Hexadecimal color values must have either 3 or 6 characters."),blankText:CQ.I18n.getMessage("Must have a hexidecimal value of the format ABCDEF."),defaultColor:"FFFFFF",curColor:"ffffff",maskRe:/[a-f0-9]/i,regex:/[a-f0-9]/i});
CQ.form.ColorField.superclass.constructor.call(this,A);
this.on("render",this.setDefaultColor)
},validateValue:function(A){if(!this.showHexValue){return true
}if(A.length<1){this.el.setStyle({"background-color":"#"+this.defaultColor});
if(!this.allowBlank){this.markInvalid(String.format(this.blankText,A));
return false
}return true
}if(A.length!=3&&A.length!=6){this.markInvalid(String.format(this.lengthText,A));
return false
}this.setColor(A);
return true
},validateBlur:function(){return !this.menu||!this.menu.isVisible()
},getValue:function(){return this.curColor||this.defaultColor
},setValue:function(A){CQ.form.ColorField.superclass.setValue.call(this,A);
this.setColor(A)
},setColor:function(A){this.curColor=A;
this.el.setStyle({"background-color":"#"+A,"background-image":"none"});
if(!this.showHexValue){this.el.setStyle({"text-indent":"-100px"});
if(CQ.Ext.isIE){this.el.setStyle({"margin-left":"100px"})
}}},setDefaultColor:function(){this.setValue(this.defaultColor)
},menuListeners:{select:function(A,B){this.setValue(B)
},show:function(){this.onFocus()
},hide:function(){this.focus();
var A=this.menuListeners;
this.menu.un("select",A.select,this);
this.menu.un("show",A.show,this);
this.menu.un("hide",A.hide,this)
}},handleSelect:function(B,A){this.setValue(A)
},onTriggerClick:function(){if(this.disabled){return 
}if(this.menu==null){this.menu=new CQ.Ext.menu.ColorMenu();
this.menu.palette.on("select",this.handleSelect,this)
}this.menu.on(CQ.Ext.apply({},this.menuListeners,{scope:this}));
this.menu.show(this.el,"tl-bl?")
}});
CQ.Ext.reg("colorfield",CQ.form.ColorField);
CQ.form.ColorList=CQ.Ext.extend(CQ.form.CompositeField,{constructor:function(A){var B=this;
this.valueField=new CQ.Ext.form.Hidden({name:A.name});
A=CQ.Util.applyDefaults(A,{items:[{xtype:"panel",border:false,bodyStyle:"padding:4px",items:[{xtype:"button",text:"Add",handler:function(){B.addItem()
}},this.valueField]}],listeners:{render:function(C){var D=C.findParentByType("dialog");
if(D){D.on("beforesubmit",function(F){var E=B.getValue();
B.valueField.setValue(E)
})
}}}});
CQ.form.ColorList.superclass.constructor.call(this,A)
},addItem:function(B){var A=this.insert(this.items.getCount()-1,{xtype:"colorlistitem"});
this.doLayout();
if(B){A.setValue(B)
}},getValue:function(){var A="";
var B="";
this.items.each(function(E,C,D){if(E instanceof CQ.form.ColorList.Item){A=A+B+E.getValue();
B=":"
}},this);
return A
},setValue:function(C){if((C!=null)&&(C!="")){var A=C.split(":");
for(var B=0;
B<A.length;
B++){this.addItem(A[B])
}this.doLayout()
}}});
CQ.Ext.reg("colorlist",CQ.form.ColorList);
CQ.form.ColorList.Item=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){this.field=new CQ.form.ColorField({width:60,name:""});
this.field.isFormField=false;
var B=this;
A=CQ.Util.applyDefaults(A,{layout:"table",border:false,layoutConfig:{columns:4},defaults:{bodyStyle:"padding:4px"},items:[{xtype:"panel",border:false,width:90,items:this.field},{xtype:"panel",border:false,items:{xtype:"button",text:"Up",handler:function(){var D=B.ownerCt;
var C=D.items.indexOf(B)-1;
if(C>=0){B.reorder(B,D,C)
}}}},{xtype:"panel",border:false,items:{xtype:"button",text:"Down",handler:function(){var D=B.ownerCt;
var C=D.items.indexOf(B)+1;
if(C<D.items.getCount()-1){B.reorder(B,D,C)
}}}},{xtype:"panel",border:false,items:{xtype:"button",text:"Remove",handler:function(){B.ownerCt.remove(B)
}}}]});
CQ.form.ColorList.superclass.constructor.call(this,A);
if(A.value){this.field.setValue(A.value)
}},reorder:function(D,C,B){var E=D.field.getValue();
C.remove(D);
var A=C.insert(B,{xtype:"colorlistitem"});
C.doLayout();
A.setValue(E)
},getValue:function(){return this.field.getValue()
},setValue:function(A){this.field.setValue(A)
}});
CQ.Ext.reg("colorlistitem",CQ.form.ColorList.Item);
CQ.form.ComponentStyles=CQ.Ext.extend(CQ.form.CompositeField,{styles:null,initialValue:null,constructor:function(B){var A=this;
this.name=B.name||"./cq:cssClass";
this.valueField=new CQ.Ext.form.Hidden({name:this.name});
this.oldValueField=new CQ.Ext.form.Hidden({name:"oldCqCssClass"});
B=CQ.Util.applyDefaults(B,{title:"Styles",items:[this.valueField,this.oldValueField],listeners:{render:function(C){var D=C.findParentByType("dialog");
if(D){D.on("beforesubmit",function(F){var E=A.getValue();
A.valueField.setValue(E);
A.oldValueField.setValue(A.initialValue)
})
}}}});
CQ.form.ComponentStyles.superclass.constructor.call(this,B)
},getValue:function(){if(!this.styles){return 
}var B="";
var D="";
for(var A in this.styles){var C=this.styles[A];
D=D+B+C.field.getValue();
B=" "
}return D
},setValue:function(F){this.value=F;
if(!this.styles){return 
}for(var C in this.styles){this.styles[C].initialized=false
}if(F){var B=F.split(" ");
for(var D=0;
D<B.length;
D++){var A=B[D];
for(var C in this.styles){var E=this.styles[C];
if(E.values[A]){E.field.setValue(A);
E.initialized=true
}}}}for(var C in this.styles){var E=this.styles[C];
if(!E.initialized){E.field.setValue(E.defaultValue)
}}},processPath:function(path){if(this.styles){return 
}var url=path+".style.json/cq:styles";
var self=this;
CQ.HTTP.get(url,function(opts,success,response){if(success){var json=eval("("+response.responseText+")");
self.setStyles(json)
}})
},processRecord:function(A,B){this.initialValue=A.get(this.getName());
CQ.form.ComponentStyles.superclass.processRecord.call(this,A,B)
},setStyles:function(E){this.styles=E;
for(var B in E){var D=E[B];
D.field=new CQ.form.Selection({type:"select",fieldLabel:D.title||D.name,fieldDescription:D.description,options:D.options});
this.add(D.field);
D.values={};
for(var C=0;
C<D.options.length;
C++){var A=D.options[C].value;
if(D.defaultValue==undefined){D.defaultValue=A
}if(A){D.values[D.options[C].value]=true
}}}this.setValue(this.value);
this.doLayout()
}});
CQ.Ext.reg("componentstyles",CQ.form.ComponentStyles);
CQ.form.MultiField=CQ.Ext.extend(CQ.form.CompositeField,{fieldConfig:null,path:"",bodyPadding:4,fieldWidth:0,constructor:function(B){var C=this;
if(typeof B.orderable==="undefined"){B.orderable=true
}if(!B.fieldConfig){B.fieldConfig={}
}if(!B.fieldConfig.xtype){B.fieldConfig.xtype="textfield"
}B.fieldConfig.name=B.name;
B.fieldConfig.ownerCt=this;
B.fieldConfig.orderable=B.orderable;
var A=new Array();
if(B.readOnly){B.fieldConfig.readOnly=true
}else{A.push({xtype:"button",cls:"cq-multifield-btn",text:"+",handler:function(){C.addItem()
}})
}this.hiddenDeleteField=new CQ.Ext.form.Hidden({name:B.name+CQ.Sling.DELETE_SUFFIX});
A.push(this.hiddenDeleteField);
if(B.typeHint){this.typeHintField=new CQ.Ext.form.Hidden({name:B.name+CQ.Sling.TYPEHINT_SUFFIX,value:B.typeHint+"[]"});
A.push(this.typeHintField)
}B=CQ.Util.applyDefaults(B,{defaults:{xtype:"multifielditem",fieldConfig:B.fieldConfig},items:[{xtype:"panel",border:false,bodyStyle:"padding:"+this.bodyPadding+"px",items:A}]});
CQ.form.MultiField.superclass.constructor.call(this,B);
if(this.defaults.fieldConfig.regex){this.defaults.fieldConfig.regex=B.fieldConfig.regex
}this.addEvents("change")
},initComponent:function(){CQ.form.MultiField.superclass.initComponent.call(this);
this.on("resize",function(){var B=this.items.get(0);
this.calculateFieldWidth(B);
if(this.fieldWidth>0){for(var A=0;
A<this.items.length;
A++){try{this.items.get(A).field.setWidth(this.fieldWidth)
}catch(C){CQ.Log.debug("CQ.form.MultiField#initComponent: "+C.message)
}}}});
this.on("disable",function(){this.hiddenDeleteField.disable();
if(this.typeHintField){this.typeHintField.disable()
}this.items.each(function(A){if(A instanceof CQ.form.MultiField.Item){A.field.disable()
}},this)
});
this.on("enable",function(){this.hiddenDeleteField.enable();
if(this.typeHintField){this.typeHintField.enable()
}this.items.each(function(A){if(A instanceof CQ.form.MultiField.Item){A.field.enable()
}},this)
})
},calculateFieldWidth:function(C){try{this.fieldWidth=this.getSize().width-2*this.bodyPadding;
for(var B=1;
B<C.items.length;
B++){var A=C.items.get(B).getSize().width;
if(A==0){this.fieldWidth=0;
return 
}this.fieldWidth-=C.items.get(B).getSize().width
}}catch(D){this.fieldWidth=0
}},addItem:function(B){var A=this.insert(this.items.getCount()-1,{});
this.findParentByType("form").getForm().add(A.field);
this.doLayout();
if(A.field.processPath){A.field.processPath(this.path)
}if(B){A.setValue(B)
}if(this.fieldWidth<0){return 
}if(!this.fieldWidth){this.calculateFieldWidth(A)
}try{A.field.setWidth(this.fieldWidth)
}catch(C){CQ.Log.debug("CQ.form.MultiField#addItem: "+C.message)
}},processPath:function(A){this.path=A
},getValue:function(){var A=new Array();
this.items.each(function(C,B){if(C instanceof CQ.form.MultiField.Item){A[B]=C.getValue();
B++
}},this);
return A
},setValue:function(B){this.fireEvent("change",this,B,this.getValue());
var C=this.items;
C.each(function(D){if(D instanceof CQ.form.MultiField.Item){this.remove(D,true);
this.findParentByType("form").getForm().remove(D)
}},this);
this.doLayout();
if((B!=null)&&(B!="")){if(B instanceof Array||CQ.Ext.isArray(B)){for(var A=0;
A<B.length;
A++){this.addItem(B[A])
}}else{this.addItem(B)
}}}});
CQ.Ext.reg("multifield",CQ.form.MultiField);
CQ.form.MultiField.Item=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(B){var D=this;
var C=CQ.Util.copyObject(B.fieldConfig);
this.field=CQ.Util.build(C,true);
var A=new Array();
A.push({xtype:"panel",border:false,cellCls:"cq-multifield-itemct",items:D.field});
if(!C.readOnly){if(C.orderable){A.push({xtype:"panel",border:false,items:{xtype:"button",text:CQ.I18n.getMessage("Up",null,"Ordering upwards in MultiField"),handler:function(){var F=D.ownerCt;
var E=F.items.indexOf(D);
if(E>0){D.reorder(F.items.itemAt(E-1))
}}}});
A.push({xtype:"panel",border:false,items:{xtype:"button",text:CQ.I18n.getMessage("Down",null,"Ordering downwards in MultiField"),handler:function(){var F=D.ownerCt;
var E=F.items.indexOf(D);
if(E<F.items.getCount()-1){D.reorder(F.items.itemAt(E+1))
}}}})
}A.push({xtype:"panel",border:false,items:{xtype:"button",cls:"cq-multifield-btn",text:"-",handler:function(){D.ownerCt.remove(D)
}}})
}B=CQ.Util.applyDefaults(B,{layout:"table",anchor:"100%",border:false,layoutConfig:{columns:4},defaults:{bodyStyle:"padding:3px"},items:A});
CQ.form.MultiField.Item.superclass.constructor.call(this,B);
if(B.value){this.field.setValue(B.value)
}},reorder:function(A){var B=A.field.getValue();
A.field.setValue(this.field.getValue());
this.field.setValue(B)
},getValue:function(){return this.field.getValue()
},setValue:function(A){this.field.setValue(A)
}});
CQ.Ext.reg("multifielditem",CQ.form.MultiField.Item);
CQ.form.InlineTextField=CQ.Ext.extend(CQ.Ext.form.TextField,{enabledCls:"cq-inline-textfield",disabledCls:"cq-inline-textfield-disabled",onRender:function(){CQ.form.InlineTextField.superclass.onRender.apply(this,arguments);
this.el.addClass(this.enabledCls)
},onFocus:function(){CQ.form.InlineTextField.superclass.onFocus.apply(this,arguments);
this.el.removeClass(this.enabledCls)
},onBlur:function(){CQ.form.InlineTextField.superclass.onBlur.apply(this,arguments);
if(this.isValid()&&!this.el.hasClass(this.enabledCls)){this.el.addClass(this.enabledCls)
}},constructor:function(A){CQ.Util.applyDefaults(A,{listeners:{specialkey:function(B,C){if(C.getKey()==C.ENTER){B.blur()
}else{if(C.getKey()==C.ESC){B.setValue(this.startValue);
B.blur()
}}}}});
CQ.form.InlineTextField.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("inlinetextfield",CQ.form.InlineTextField);
CQ.form.Password=CQ.Ext.extend(CQ.Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"password",size:"20",autocomplete:"off"}});
CQ.Ext.reg("password",CQ.form.Password);
CQ.form.Spinner=function(A){CQ.form.Spinner.superclass.constructor.call(this,A);
this.addEvents({spinup:true,spindown:true})
};
CQ.Ext.extend(CQ.form.Spinner,CQ.Ext.form.TriggerField,{triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:CQ.Ext.EventObject.shiftKey,strategy:undefined,onRender:function(B,A){CQ.form.Spinner.superclass.onRender.call(this,B,A);
this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});
this.splitter.show().setRight((CQ.Ext.isIE)?1:2);
this.splitter.show().setTop(10);
this.proxy=this.trigger.createProxy("",this.splitter,true);
this.proxy.addClass("x-form-spinner-proxy");
this.proxy.setStyle("left","0px");
this.proxy.setSize(14,1);
this.proxy.hide();
this.dd=new CQ.Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});
this.initSpinner()
},initSpinner:function(){this.keyNav=new CQ.Ext.KeyNav(this.el,{up:function(A){A.preventDefault();
this.onSpinUp()
},down:function(A){A.preventDefault();
this.onSpinDown()
},pageUp:function(A){A.preventDefault();
this.onSpinUpAlternate()
},pageDown:function(A){A.preventDefault();
this.onSpinDownAlternate()
},scope:this});
this.trigger.un("click",this.onTriggerClick);
this.repeater=new CQ.Ext.util.ClickRepeater(this.trigger);
this.repeater.on("click",this.onTriggerClick,this,{preventDefault:true});
this.trigger.on("mouseover",this.onMouseOver,this,{preventDefault:true});
this.trigger.on("mouseout",this.onMouseOut,this,{preventDefault:true});
this.trigger.on("mousemove",this.onMouseMove,this,{preventDefault:true});
this.trigger.on("mousedown",this.onMouseDown,this,{preventDefault:true});
this.trigger.on("mouseup",this.onMouseUp,this,{preventDefault:true});
this.wrap.on("mousewheel",this.handleMouseWheel,this);
this.dd.setXConstraint(0,0,10);
this.dd.setYConstraint(1500,1500,10);
this.dd.endDrag=this.endDrag.createDelegate(this);
this.dd.startDrag=this.startDrag.createDelegate(this);
this.dd.onDrag=this.onDrag.createDelegate(this);
if("object"==typeof this.strategy&&this.strategy.xtype){switch(this.strategy.xtype){case"number":this.strategy=new CQ.form.Spinner.NumberStrategy(this.strategy);
break;
case"date":this.strategy=new CQ.form.Spinner.DateStrategy(this.strategy);
break;
case"time":this.strategy=new CQ.form.Spinner.TimeStrategy(this.strategy);
break;
default:delete (this.strategy);
break
}delete (this.strategy.xtype)
}if(this.strategy==undefined){this.strategy=new CQ.form.Spinner.NumberStrategy()
}},onMouseOver:function(){if(this.disabled){return 
}var A=this.getMiddle();
this.__tmphcls=(CQ.Ext.EventObject.getPageY()<A)?"x-form-spinner-overup":"x-form-spinner-overdown";
this.trigger.addClass(this.__tmphcls)
},onMouseOut:function(){this.trigger.removeClass(this.__tmphcls)
},onMouseMove:function(){if(this.disabled){return 
}var A=this.getMiddle();
if(((CQ.Ext.EventObject.getPageY()>A)&&this.__tmphcls=="x-form-spinner-overup")||((CQ.Ext.EventObject.getPageY()<A)&&this.__tmphcls=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return 
}var A=this.getMiddle();
this.__tmpccls=(CQ.Ext.EventObject.getPageY()<A)?"x-form-spinner-clickup":"x-form-spinner-clickdown";
this.trigger.addClass(this.__tmpccls)
},onMouseUp:function(){this.trigger.removeClass(this.__tmpccls)
},onTriggerClick:function(){if(this.disabled||this.getEl().dom.readOnly){return 
}var B=this.getMiddle();
var A=(CQ.Ext.EventObject.getPageY()<B)?"Up":"Down";
this["onSpin"+A]()
},getMiddle:function(){var B=this.trigger.getTop();
var C=this.trigger.getHeight();
var A=B+(C/2);
return A
},handleMouseWheel:function(A){if(this.disabled||this.getEl().dom.readOnly){CQ.Ext.EventObject.preventDefault();
return 
}var B=A.getWheelDelta();
if(B>0){this.onSpinUp();
A.stopEvent()
}else{if(B<0){this.onSpinDown();
A.stopEvent()
}}},startDrag:function(){this.proxy.show();
this._previousY=CQ.Ext.fly(this.dd.getDragEl()).getTop()
},endDrag:function(){this.proxy.hide()
},onDrag:function(){if(this.disabled){return 
}var B=CQ.Ext.fly(this.dd.getDragEl()).getTop();
var A="";
if(this._previousY>B){A="Up"
}if(this._previousY<B){A="Down"
}if(A!=""){this["onSpin"+A]()
}this._previousY=B
},onSpinUp:function(){if(CQ.Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();
return 
}else{this.strategy.onSpinUp(this)
}this.fireEvent("spinup",this)
},onSpinDown:function(){if(CQ.Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();
return 
}else{this.strategy.onSpinDown(this)
}this.fireEvent("spindown",this)
},onSpinUpAlternate:function(){this.strategy.onSpinUpAlternate(this);
this.fireEvent("spinup",this)
},onSpinDownAlternate:function(){this.strategy.onSpinDownAlternate(this);
this.fireEvent("spindown",this)
}});
CQ.Ext.reg("spinner",CQ.form.Spinner);
CQ.form.Spinner.Strategy=function(A){CQ.Ext.apply(this,A)
};
CQ.Ext.extend(CQ.form.Spinner.Strategy,CQ.Ext.util.Observable,{defaultValue:0,minValue:undefined,maxValue:undefined,incrementValue:1,alternateIncrementValue:5,onSpinUp:function(A){this.spin(A,false,false)
},onSpinDown:function(A){this.spin(A,true,false)
},onSpinUpAlternate:function(A){this.spin(A,false,true)
},onSpinDownAlternate:function(A){this.spin(A,true,true)
},spin:function(A,C,B){},fixBoundries:function(A){return A
}});
CQ.form.Spinner.NumberStrategy=function(A){CQ.form.Spinner.NumberStrategy.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.form.Spinner.NumberStrategy,CQ.form.Spinner.Strategy,{allowDecimals:true,decimalPrecision:2,spin:function(B,E,C){CQ.form.Spinner.NumberStrategy.superclass.spin.call(this,B,E,C);
var A=parseFloat(B.getValue());
var D=(C==true)?this.alternateIncrementValue:this.incrementValue;
(E==true)?A-=D:A+=D;
A=(isNaN(A))?this.defaultValue:A;
A=this.fixBoundries(A);
B.setRawValue(A)
},fixBoundries:function(B){var A=B;
if(this.minValue!=undefined&&A<this.minValue){A=this.minValue
}if(this.maxValue!=undefined&&A>this.maxValue){A=this.maxValue
}return this.fixPrecision(A)
},fixPrecision:function(B){var A=isNaN(B);
if(!this.allowDecimals||this.decimalPrecision==-1||A||!B){return A?"":B
}return parseFloat(parseFloat(B).toFixed(this.decimalPrecision))
}});
CQ.form.Spinner.DateStrategy=function(A){CQ.form.Spinner.DateStrategy.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.form.Spinner.DateStrategy,CQ.form.Spinner.Strategy,{defaultValue:new Date(),format:"Y-m-d",incrementValue:1,incrementConstant:Date.DAY,alternateIncrementValue:1,alternateIncrementConstant:Date.MONTH,spin:function(D,G,E){CQ.form.Spinner.DateStrategy.superclass.spin.call(this);
var A=D.getRawValue();
A=Date.parseDate(A,this.format);
var C=(G==true)?-1:1;
var F=(E==true)?this.alternateIncrementValue:this.incrementValue;
var B=(E==true)?this.alternateIncrementConstant:this.incrementConstant;
if(typeof this.defaultValue=="string"){this.defaultValue=Date.parseDate(this.defaultValue,this.format)
}A=(A)?A.add(B,C*F):this.defaultValue;
A=this.fixBoundries(A);
D.setRawValue(CQ.Ext.util.Format.date(A,this.format))
},fixBoundries:function(B){var D=B;
var C=(typeof this.minValue=="string")?Date.parseDate(this.minValue,this.format):this.minValue;
var A=(typeof this.maxValue=="string")?Date.parseDate(this.maxValue,this.format):this.maxValue;
if(this.minValue!=undefined&&D<C){D=C
}if(this.maxValue!=undefined&&D>A){D=A
}return D
}});
CQ.form.Spinner.TimeStrategy=function(A){CQ.form.Spinner.TimeStrategy.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.form.Spinner.TimeStrategy,CQ.form.Spinner.DateStrategy,{format:"H:i",incrementValue:1,incrementConstant:Date.MINUTE,alternateIncrementValue:1,alternateIncrementConstant:Date.HOUR});
CQ.form.DateTime=CQ.Ext.extend(CQ.Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},hideTime:false,timeWidth:100,dateWidth:200,dtSeparator:" ",hiddenFormat:"Y-m-d\\TH:i:s.000P",defaultValue:"",allowBlank:true,timePosition:"right",disableTypeHint:false,valueAsString:false,typeHint:null,defaultTriggerWidth:17,initComponent:function(){CQ.form.DateTime.superclass.initComponent.call(this);
var B=CQ.Ext.apply({},{id:this.id+"-date",format:this.dateFormat||CQ.Ext.form.DateField.prototype.format,width:this.readOnly?this.dateWidth-this.defaultTriggerWidth:this.dateWidth,selectOnFocus:this.selectOnFocus,allowBlank:this.allowBlank,hideTrigger:this.readOnly,readOnly:this.readOnly,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);
this.df=new CQ.Ext.form.DateField(B);
delete (this.dateFormat);
var A=CQ.Ext.apply({},{id:this.id+"-time",format:this.timeFormat||CQ.Ext.form.TimeField.prototype.format,width:this.readOnly?this.timeWidth-this.defaultTriggerWidth:this.timeWidth,hideTrigger:this.readOnly,minListWidth:this.timeWidth,selectOnFocus:this.selectOnFocus,allowBlank:this.allowBlank,readOnly:this.readOnly,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);
this.tf=new CQ.Ext.form.TimeField(A);
delete (this.timeFormat);
this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);
this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])
},onRender:function(C,A){if(this.isRendered){return 
}CQ.form.DateTime.superclass.onRender.call(this,C,A);
var B;
if("below"===this.timePosition||"bellow"===this.timePosition){B=CQ.Ext.DomHelper.append(C,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",style:this.hideTime?"display:none;":"",cls:"ux-datetime-time"}]}]},true)
}else{B=CQ.Ext.DomHelper.append(C,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:"+(this.readOnly?this.defaultTriggerWidth:"0")+"px",cls:"ux-datetime-date"},{tag:"td",style:this.hideTime?"display:none;":"",cls:"ux-datetime-time"}]}]},true)
}this.tableEl=B;
this.wrap=B.wrap();
this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});
this.df.render(B.child("td.ux-datetime-date"));
this.tf.render(B.child("td.ux-datetime-time"));
if(CQ.Ext.isIE&&CQ.Ext.isStrict){B.select("input").applyStyles({top:0})
}this.on("specialkey",this.onSpecialKey,this);
this.df.el.swallowEvent(["keydown","keypress"]);
this.tf.el.swallowEvent(["keydown","keypress"]);
if("side"===this.msgTarget){var E=this.el.findParent(".x-form-element",10,true);
this.errorIcon=E.createChild({cls:"x-form-invalid-icon"});
this.df.errorIcon=this.errorIcon;
this.tf.errorIcon=this.errorIcon
}this.el.dom.name=this.hiddenName||this.name||this.id;
this.df.el.dom.removeAttribute("name");
this.tf.el.dom.removeAttribute("name");
if(!this.disableTypeHint){var D=new CQ.Ext.form.Hidden({name:this.name+"@TypeHint",value:this.typeHint?this.typeHint:"Date",ignoreDate:true,renderTo:C})
}this.isRendered=true;
this.updateHidden()
},adjustSize:CQ.Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])
},initDateValue:function(){if(this.defaultValue=="now"){this.dateValue=new Date()
}else{if(this.defaultValue){this.dateValue=Date.parseDate(this.defaultValue,this.hiddenFormat);
if(!this.dateValue){this.dateValue=new Date()
}}else{this.dateValue=new Date()
}}},clearInvalid:function(){this.df.clearInvalid();
this.tf.clearInvalid()
},disable:function(){if(this.isRendered){this.onDisable();
this.df.disabled=this.disabled;
this.df.onDisable();
this.tf.onDisable()
}this.disabled=true;
this.df.disabled=true;
this.tf.disabled=true;
this.fireEvent("disable",this);
return this
},enable:function(){if(this.rendered){this.onEnable();
this.df.onEnable();
this.tf.onEnable()
}this.disabled=false;
this.df.disabled=false;
this.tf.disabled=false;
this.fireEvent("enable",this);
return this
},focus:function(){this.df.focus()
},getPositionEl:function(){return this.wrap
},getResizeEl:function(){return this.wrap
},getValue:function(){if(this.valueAsString){return(this.dateValue&&(typeof this.dateValue.format==="function"))?this.dateValue.format(this.hiddenFormat):""
}else{return this.dateValue?this.dateValue.clone():""
}},getDateValue:function(){return this.dateValue?this.dateValue.clone():null
},valueToDate:function(A){return Date.parseDate(A,this.hiddenFormat)
},isValid:function(){return this.df.isValid()&&this.tf.isValid()
},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()
},onBlur:function(A){if(this.wrapClick){A.focus();
this.wrapClick=false
}if(A===this.df){this.updateDate()
}else{this.updateTime()
}this.updateHidden();
(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){this.checkIfChanged(true);
this.hasFocus=false;
this.fireEvent("blur",this)
}}).defer(100,this)
},checkIfChanged:function(B){if(!B){this.updateValue()
}var A=this.getValue();
if(this.startValue!==undefined&&String(A)!==String(this.startValue)){this.fireEvent("change",this,A,this.startValue);
this.startValue=A;
return true
}return false
},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},onMouseDown:function(A){if(!this.disabled){this.wrapClick="td"===A.target.nodeName.toLowerCase()
}},onSpecialKey:function(B,C){var A=C.getKey();
if(A===C.TAB){if(B===this.df&&!C.shiftKey){C.stopEvent();
this.tf.focus()
}if(B===this.tf&&C.shiftKey){C.stopEvent();
this.df.focus()
}}if(A===C.ENTER){this.updateValue()
}},setDate:function(A){this.df.setValue(A)
},setTime:function(A){this.tf.setValue(A)
},setSize:function(A,B){if(!A){return 
}if(typeof A=="object"){B=A.height;
A=A.width
}if("below"===this.timePosition){this.df.setSize(A,B);
this.tf.setSize(A,B);
if(CQ.Ext.isIE){this.df.el.up("td").setWidth(A);
this.tf.el.up("td").setWidth(A)
}}else{this.df.setSize(A-this.timeWidth,B);
this.tf.setSize(this.timeWidth,B);
if(CQ.Ext.isIE){this.df.el.up("td").setWidth(A-this.timeWidth);
this.tf.el.up("td").setWidth(this.timeWidth)
}}this.fireEvent("resize",this,A,B,A,B)
},setValue:function(C){if(!C){this.setDate("");
this.setTime("");
this.updateValue();
return 
}if("number"===typeof C){C=new Date(C)
}if("string"===typeof C){if(C=="now"){C=new Date()
}else{var A=Date.parse(C);
if(!A){A=Date.parseDate(C,this.hiddenFormat)
}if(A){C=new Date(A)
}}}C=C?C:new Date();
if(typeof C.setDate=="function"&&typeof C.setTime=="function"){this.setDate(C);
this.setTime(C);
this.dateValue=C.clone()
}else{var B=C.split(this.dtSeparator);
this.setDate(B[0]);
if(B[1]){this.setTime(B[1])
}}this.updateValue();
this.startValue=this.getValue()
},setVisible:function(A){if(A){this.df.show();
this.tf.show()
}else{this.df.hide();
this.tf.hide()
}return this
},show:function(){return this.setVisible(true)
},hide:function(){return this.setVisible(false)
},updateDate:function(){var A=this.df.getValue();
if(A){if(!this.isDate(this.dateValue)){this.initDateValue();
if(!this.tf.getValue()){this.setTime(this.dateValue)
}}this.dateValue.setMonth(0);
this.dateValue.setFullYear(A.getFullYear());
this.dateValue.setMonth(A.getMonth());
this.dateValue.setDate(A.getDate())
}else{this.dateValue="";
this.setTime("")
}},isDate:function(A){return(typeof (A)!="undefined")&&((typeof A.setDate==="function")&&(typeof A.setTime==="function")&&(typeof A.getFirstDateOfMonth==="function")&&(typeof A.getFirstDayOfMonth==="function"))
},updateTime:function(){var A=this.tf.getValue();
if(A&&!this.isDate(A)){if(A=="now"){A=new Date()
}else{A=Date.parseDate(A,this.tf.format)
}}if(A&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue)
}if((typeof this.dateValue.setHours==="function")&&(typeof this.dateValue.setMinutes==="function")&&(typeof this.dateValue.setSeconds==="function")){if(A){this.dateValue.setHours(A.getHours());
this.dateValue.setMinutes(A.getMinutes());
this.dateValue.setSeconds(A.getSeconds())
}else{this.dateValue.setHours(0);
this.dateValue.setMinutes(0);
this.dateValue.setSeconds(0)
}}},updateHidden:function(){if(this.isRendered){this.el.dom.value=(this.dateValue&&(typeof this.dateValue.format==="function"))?this.dateValue.format(this.hiddenFormat):""
}},updateValue:function(){this.updateDate();
this.updateTime();
this.updateHidden()
},validate:function(){return this.df.validate()&&this.tf.validate()
},renderer:function(B){var A=B.editor.dateFormat||CQ.Ext.form.DateField.prototype.format;
A+=" "+(B.editor.timeFormat||CQ.Ext.form.TimeField.prototype.format);
return function(C){return CQ.Ext.util.Format.date(C,A)
}
}});
CQ.Ext.reg("datetime",CQ.form.DateTime);
CQ.form.DialogFieldSet=CQ.Ext.extend(CQ.Ext.form.FieldSet,{constructor:function(A){if(A.collapsed===false&&A.autoHeight==undefined){A.autoHeight=true
}if(!A.labelWidth){A.labelWidth=CQ.themes.DialogFieldSet.LABEL_WIDTH
}if(!A.defaults){A.defaults={}
}if(!A.defaults.anchor){A.defaults.anchor=CQ.themes.DialogFieldSet.ANCHOR
}CQ.form.DialogFieldSet.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("dialogfieldset",CQ.form.DialogFieldSet);
CQ.form.FileUploadField=CQ.Ext.extend(CQ.Ext.form.TextField,{buttonText:null,buttonOnly:false,buttonOffset:3,removable:false,useFlash:false,readOnly:true,valueUpdated:false,autoSize:CQ.Ext.emptyFn,fileNameParameter:null,placeHolder:null,allowEnctypeSetting:true,constructor:function(A){if(A.fileNameParameter){this.readOnly=false
}CQ.form.FileUploadField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("fileselected","fileremoved","flashuploadstart","flashuploadsuccess","flashuploaderror","flashuploadcomplete")
},setName:function(A){if(A){this.fileInput.dom.setAttribute("name",A);
this.name=A
}},swfu:null,onRender:function(E,B){var C=this;
CQ.form.FileUploadField.superclass.onRender.call(this,E,B);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap cq-fileupload-wrapper"});
this.el.addClass("x-form-file-text");
if(this.fileNameParameter){this.el.dom.setAttribute("name",this.fileNameParameter)
}else{this.el.dom.setAttribute("name","")
}if(CQ.endorsed.swfobject.getFlashPlayerVersion().major<9){this.useFlash=false
}if(this.placeHolder){this.useFlash=false
}if(this.useFlash){var F="swf"+new Date().getTime();
this.fileInput=this.wrap.createChild({cls:"x-form-file",tag:"div",children:{id:F}});
this.swfu=new SWFUpload({flash_url:CQ.HTTP.externalize("/libs/cq/ui/resources/swfupload")+"/swfupload.swf",button_placeholder_id:F,button_text_left_padding:34,button_text_top_padding:10,button_width:70,button_height:20,file_post_name:C.getName(),file_queued_handler:function(G){C.fireEvent("fileselected",C,{flash:C.swfu,file:G});
return true
},file_dialog_complete_handler:function(I,H,G){},upload_start_handler:function(G){C.button.disable();
C.swfu.setButtonDisabled(true);
C.swfu.setFilePostName(encodeURIComponent(G.name));
try{C.delegatee=C.findParentByType("form").getForm().findField(G.id)
}catch(I){}var H=C.delegatee?C.delegatee:C;
H.fireEvent("flashuploadstart",H,G);
return true
},upload_progress_handler:function(H,G,I){var J=C.delegatee?C.delegatee:C;
if(J.getName()!=H.id){return true
}window.setTimeout(function(){J.handleUploadProgress(H,G,I)
},1);
return true
},upload_success_handler:function(H,G,J){var I=C.delegatee?C.delegatee:C;
if(I.getName()!=H.id){return true
}I.fireEvent("flashuploadsuccess",I,H);
return true
},upload_error_handler:function(I,H,K){var J=C.delegatee?C.delegatee:C;
if(J.getName()!=I.id){return true
}if(K==201){var G=C.swfu.getStats();
G.upload_errors--;
G.successful_uploads++;
C.swfu.setStats(G);
J.fireEvent("flashuploadsuccess",J,I);
return true
}J.markInvalid();
J.fireEvent("flashuploaderror",J,I,K);
return true
},upload_complete_handler:function(G){var H=C.delegatee?C.delegatee:C;
if(H.getName()!=G.id){return true
}H.handleUploadComplete(G);
if(C.swfu.getStats().files_queued>0){C.swfu.startUpload()
}else{C.fireEvent("flashuploadcomplete",C)
}return true
},swfupload_loaded_handler:function(){this.setButtonDimensions(C.button.getEl().getWidth(),C.button.getEl().getHeight())
}});
CQ.swfu=this.swfu
}else{if(this.placeHolder){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.placeHolder.id||this.getId(),cls:"x-form-file",tag:"input",type:"hidden",value:this.placeHolder.name});
this.el.dom.name=this.placeHolder.id;
this.setValue(this.placeHolder.name)
}else{this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})
}}var D=CQ.Ext.applyIf(this.buttonCfg||{},{text:this.buttonText?this.buttonText:CQ.I18n.getMessage("Browse...")});
this.button=new CQ.Ext.Button(CQ.Ext.apply(D,{renderTo:this.wrap,cls:"x-form-file-btn"+(D.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth())
}this.fileInput.setWidth((this.button.getEl().getComputedWidth()||55));
if(this.placeHolder){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this)
}else{if(this.useFlash){var A=this.findParentByType("form");
A.getForm().flashUpload=this.swfu
}else{if(!this.useFlash){this.fileInput.on("change",function(){var H=this.fileInput.dom.value;
if(CQ.Ext.isIE&&H.lastIndexOf("\\")!=-1){H=H.substring(H.lastIndexOf("\\")+1)
}this.setValue(H);
if(this.allowEnctypeSetting){try{var G=this.findParentByType("form");
G.getForm().el.dom.enctype="multipart/form-data"
}catch(I){}}this.fireEvent("fileselected",this,H);
this.valueUpdated=true;
if(this.removable){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this);
this.fileInput.applyStyles("z-index:-100")
}},this)
}}}},clearFile:function(){var A=this.ownerCt;
var C=this.getName();
this.fireEvent("fileremoved",this.getValue());
A.remove(this,true);
A.ownerCt.doLayout();
try{CQ.swfu.cancelUpload(C)
}catch(B){}},destroy:function(){var A=this.getEl().dom.parentNode;
this.fileInput.remove();
this.button.destroy();
CQ.form.FileUploadField.superclass.destroy.call(this);
A.parentNode.removeChild(A)
},getFileInputId:function(){return this.id+"-file"
},initProgressBar:function(){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
this.progressText=new CQ.Static({cls:"cq-fileuploadfield-progress-text"});
new CQ.Ext.Panel({renderTo:this.wrap.insertSibling({tag:"div",cls:"cq-fileupload-progress-wrapper"}),border:false,bodyStyle:"width:"+this.wrap.getWidth(true)+"px;",anchorTo:this.wrap,items:[this.progressBar,this.progressText]});
new CQ.Ext.Button({renderTo:this.progressBar.wrap,text:CQ.I18n.getMessage("Cancel")});
this.wrap.remove()
},handleUploadProgress:function(A,B,E){if(!this.progressBar){this.initProgressBar()
}var D=Math.round(100*B/E);
var C=CQ.I18n.getMessage("{0} of {1}",[CQ.Util.formatFileSize(B),CQ.Util.formatFileSize(E)],"file upload progress");
this.progressBar.updateProgress(D/100,A.name);
this.progressText.updateText(C)
},handleUploadComplete:function(A){if(!this.progressBar){this.initProgressBar()
}this.progressBar.updateProgress(1);
this.progressText.updateText(CQ.I18n.getMessage("Complete",null,"adjective"))
},onResize:function(A,B){CQ.form.FileUploadField.superclass.onResize.call(this,A,B);
this.wrap.setWidth(A);
if(!this.buttonOnly){var A=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(A)
}},preFocus:CQ.Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}});
CQ.Ext.reg("fileuploadfield",CQ.form.FileUploadField);
CQ.form.FileUploadDialogButton=CQ.Ext.extend(CQ.Ext.Button,{constructor:function(A){A=CQ.Util.applyDefaults(A,{formUrl:window.location,fileNameParameter:"file",text:CQ.I18n.getMessage("Upload file"),fileLabel:CQ.I18n.getMessage("File"),fileDescription:"",okText:CQ.I18n.getMessage("Upload"),cancelText:CQ.I18n.getMessage("Cancel"),listeners:{scope:this,click:this.handleClick},success:this.handleSuccess,failure:this.handleFailure});
if(!A.dialogTitle){A.dialogTitle=A.text
}this.dialogConfig=CQ.WCM.getDialogConfig({xtype:"panel",items:{name:"file",xtype:"fileuploadfield",fieldLabel:A.fileLabel,fieldDescription:A.fileDescription}});
this.dialogConfig=CQ.Util.applyDefaults(this.dialogConfig,{title:A.dialogTitle,formUrl:A.formUrl,fileUpload:true,height:180,okText:A.okText,cancelText:A.cancelText,buttons:CQ.Dialog.OKCANCEL,responseScope:this,success:A.success,failure:A.failure});
CQ.form.FileUploadDialogButton.superclass.constructor.call(this,A)
},handleClick:function(){if(!this.dialog){this.dialog=CQ.Util.build(this.dialogConfig,true)
}this.dialog.show()
},handleSuccess:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Success"),CQ.I18n.getMessage("File was successfully uploaded."))
},handleFailure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not upload file."))
}});
CQ.Ext.reg("fileuploaddialogbutton",CQ.form.FileUploadDialogButton);
CQ.form.Selection=CQ.Ext.extend(CQ.form.CompositeField,{allowBlank:true,type:"radio",options:null,optionsRoot:null,optionsTextField:null,optionsValueField:null,optionsQTipField:null,optionsCallback:null,optionsProvider:null,optionsConfig:null,checkboxBoolTypeHint:false,blankText:CQ.I18n.getMessage("You must select at least one item in this group"),sortDir:null,comboBox:null,hiddenField:null,optionItems:null,isComboBox:false,isSelect:false,isCheckbox:false,isRadio:false,getValue:function(){if(!this.rendered){return this.value!=null?this.value:""
}if(this.isComboBox||this.isSelect){if(this.isSelect){return this.hiddenField.getValue()
}return this.comboBox.getValue()
}if(this.isRadio){if(this.optionItems){for(var B=0;
B<this.optionItems.length;
B++){var C=this.optionItems.get(B);
if(C.getValue()){return C.inputValue
}}}return""
}var A=[];
if(this.optionItems){for(var B=0;
B<this.optionItems.length;
B++){var C=this.optionItems.get(B);
if(C.getValue()){A.push(C.inputValue)
}}}else{return A[this.initialValue]
}return A
},getRawValue:function(){if(this.isRadio||this.isCheckbox){return this.getValue()
}else{return this.comboBox.getRawValue()
}},processPath:function(path){if(this.optionsProvider){if(path==undefined){path=null
}var options=[];
try{if(typeof this.optionsProvider!="function"){try{var p;
eval("p = "+this.optionsProvider);
options=p.call(this,path)
}catch(e){CQ.Log.warn("Selection#processPath: failed to evaluate optionsProvider: "+e.message)
}}else{options=this.optionsProvider.call(this,path)
}this.setOptions(options)
}catch(e){CQ.Log.warn("Selection#processPath: "+e.message)
}}else{if(this.optionsCallback){if(path==undefined){path=null
}try{if(typeof this.optionsCallback!="function"){try{eval(this.optionsCallback).call(this,path)
}catch(e){CQ.Log.warn("Selection#processPath: failed to evaluate optionsCallback: "+e.message)
}}else{this.optionsCallback.call(this,path)
}}catch(e){CQ.Log.warn("Selection#processPath: failed to call optionsCallback: "+e.message)
}}else{if(this.contentBasedOptionsURL){var url=this.contentBasedOptionsURL;
url=url.replace(CQ.form.Selection.PATH_PLACEHOLDER_REGEX,path);
this.setOptions(this.fetchOptions(url,this))
}}}},setOptions:function(B){if(this.isCheckbox||this.isRadio){if(this.optionItems&&this.optionItems.getCount()>0){var A=this.optionItems.getCount();
for(var C=0;
C<A;
C++){var F=this.optionItems.get(C);
this.remove(F);
if(F.rendered&&F.dom){F.dom.setStyle("display","none")
}F.destroy()
}this.optionItems.clear()
}if(this.sortDir){this.sortOptions(B)
}for(var C=0;
C<B.length;
C++){var D=B[C];
this.optionsConfig.inputValue=D.value==undefined?"":D.value;
this.optionsConfig.boxLabel=D.text?D.text:"&nbsp;";
this.optionsConfig.checked=D.checked?D.checked:false;
var F;
if(this.isRadio){F=new CQ.Ext.form.Radio(this.optionsConfig)
}else{F=new CQ.Ext.form.Checkbox(this.optionsConfig)
}this.add(F);
this.optionItems.add(D.value,F)
}}else{var E={fields:["value","text",CQ.shared.XSS.getXSSPropertyName("text"),"qtip"],data:[]};
for(var C=0;
C<B.length;
C++){var F=B[C];
F.value=F.value!=undefined?F.value:"";
F.text=F.text?CQ.I18n.getVarMessage(F.text):F.value;
F[CQ.shared.XSS.getXSSPropertyName("text")]=CQ.shared.XSS.getXSSTablePropertyValue(F,"text")?CQ.shared.XSS.getXSSTablePropertyValue(F,"text"):F.value;
F.qtip=F.qtip?F.qtip:""
}if(this.sortDir){this.sortOptions(B)
}for(var C=0;
C<B.length;
C++){var F=B[C];
E.data.push([F.value,F.text,F[CQ.shared.XSS.getXSSPropertyName("text")],F.qtip])
}if(!this.comboBox){this.optionsConfig.store=new CQ.Ext.data.SimpleStore(E);
this.optionsConfig.listClass=CQ.Util.createId(CQ.DOM.encodeClass(this.name));
this.comboBox=new CQ.Ext.form.ComboBox(this.optionsConfig);
this.add(this.comboBox)
}else{this.optionsConfig.store.loadData(E.data)
}}if(this.rendered){this.doLayout()
}},sortOptions:function(B){if(this.sortDir!="ASC"&&this.sortDir!="DESC"){return 
}var A=this.sortDir=="ASC"?1:-1;
B.sort(function(E,C){var F=E.text.toLowerCase();
var D=C.text.toLowerCase();
if(F>D){return A
}if(F<D){return -A
}return 0
})
},setValue:function(F){if(F instanceof Array&&(this.isRadio||this.isComboBox||this.isSelect)){F=F[0]
}this.value=F;
if(this.rendered){if(this.isRadio){if(this.value instanceof Array){this.value=F[0]
}if(this.value==null){this.optionItems.get(0).setValue(true);
for(var B=1;
B<this.optionItems.length;
B++){this.optionItems.get(B).setValue(false)
}}else{for(var B=0;
B<this.optionItems.length;
B++){var D=this.optionItems.get(B);
if(D.inputValue.toString()==this.value.toString()){D.setValue(true)
}else{D.setValue(false)
}}}}else{if(this.isCheckbox){var A;
if(this.value instanceof Array){A="|"+F.join("|")+"|"
}else{A="|"+F+"|"
}for(var B=0;
B<this.optionItems.length;
B++){var D=this.optionItems.get(B);
if(A.indexOf("|"+D.inputValue+"|")!=-1){D.setValue(true)
}else{D.setValue(false)
}}}else{if(this.isSelect){var C=this.comboBox.store.getTotalCount();
var B=0;
for(;
B<C;
B++){var E=this.comboBox.store.getAt(B).data;
if(E.value==this.value){this.hiddenField.setValue(E.value);
this.comboBox.setValue(E.text);
break
}}if(B==C){if(this.defaultValue){this.value=this.defaultValue
}else{this.value=""
}this.hiddenField.setValue(this.value);
this.comboBox.setValue(this.value)
}}else{this.comboBox.setValue(this.value)
}}}}},validateValue:function(A){if(this.isRadio||this.isCheckbox){if(A.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}else{this.clearInvalid();
return true
}}else{return this.comboBox.validateValue(A)
}},markInvalid:function(B){if(this.isRadio||this.isCheckbox){this.el.addClass(this.invalidClass);
B=B||this.invalidText;
var A=this.getMessageHandler();
if(A){A.mark(this,B)
}}this.fireEvent("invalid",this,B)
},clearInvalid:function(){if(this.isRadio||this.isCheckbox){this.el.removeClass(this.invalidClass);
var A=this.getMessageHandler();
if(A){A.clear(this)
}}this.fireEvent("valid",this)
},selectCombo:function(C,A,B){if(A.data.text=="&nbsp;"){this.comboBox.setValue("")
}this.hiddenField.setValue(A.data.value);
this.fireComboboxSelectionChanged(C,A,B)
},fireBoxSelectionChanged:function(B,C){this.validateValue(this.getValue());
var A;
if(B.constructor==CQ.Ext.form.Radio){A=C
}else{A=true
}if(A){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,B.getRawValue(),C)
}},fireComboboxSelectionChanged:function(C,A,B){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,A.data.value,true)
},fireComboboxContentChanged:function(C,B,A){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,B,true)
},fetchOptions:function(url,config){var options=[];
try{var json=CQ.HTTP.eval(url);
if(config.optionsRoot){var optVF=config.optionsValueField||"value";
var optTF=config.optionsTextField||"text";
var optTFXSS=CQ.shared.XSS.getXSSPropertyName(optTF);
var optQF=config.optionsQTipField||"qtip";
var root=(config.optionsRoot==".")?json:json[config.optionsRoot];
for(var i=0;
i<root.length;
i++){var opt={value:root[i][optVF],text:root[i][optTF],text_xss:root[i][optTFXSS]};
if(root[i][optQF]){opt.qtip=root[i][optQF]
}options.push(opt)
}}else{options=CQ.Util.formatData(json)
}}catch(e){CQ.Log.warn("CQ.form.Selection#fetchOptions failed: "+e.message);
options=[]
}return options
},constructor:function(C){if(C.type){this.type=C.type
}switch(this.type){case"combobox":this.isComboBox=true;
break;
case"checkbox":this.isCheckbox=true;
break;
case"select":this.isSelect=true;
break;
default:this.isRadio=true
}if(C.allowBlank!=undefined){this.allowBlank=C.allowBlank
}if(C.optionsCallback){this.optionsCallback=C.optionsCallback;
if(!C.options){C.options=[]
}}if(typeof C.options=="string"){if(C.options.indexOf(CQ.form.Selection.PATH_PLACEHOLDER)>=0){this.contentBasedOptionsURL=C.options;
C.options=[]
}else{C.options=this.fetchOptions(C.options,C)
}}else{if(!C.options){if(this.isCheckbox){C.options=[{value:C.inputValue?C.inputValue:"true",text:C.boxLabel?C.boxLabel:""}]
}else{C.options=[]
}}}this.optionsConfig=C.optionsConfig?C.optionsConfig:{};
var D={height:"auto",border:this.isCheckbox||this.isRadio,style:"padding:0;margin-bottom:0;",hideMode:"display",defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET}};
CQ.Util.applyDefaults(C,D);
CQ.form.CompositeField.superclass.constructor.call(this,C);
if(this.isCheckbox||this.isRadio){this.optionItems=new CQ.Ext.util.MixedCollection();
var B={xtype:"checkbox",name:C.name,fieldLabel:"&nbsp;",hideLabel:true,hideMode:"display",anchor:CQ.themes.Dialog.SELECT_CHECKBOX_ANCHOR,stateful:false};
CQ.Util.applyDefaults(this.optionsConfig,B);
this.optionsConfig.listeners={render:function(F){var G=F.getEl().dom.parentNode.parentNode.parentNode;
G.style.overflow="hidden"
},check:{fn:this.fireBoxSelectionChanged,scope:this}};
this.setOptions(C.options);
if(!this.isRadio){this.hiddenField=new CQ.Ext.form.Hidden({name:C.name+CQ.Sling.DELETE_SUFFIX,value:"true"});
this.add(this.hiddenField);
if(C.checkboxBoolTypeHint){var E=new CQ.Ext.form.Hidden({name:C.name+CQ.Sling.TYPEHINT_SUFFIX,value:"Boolean"});
this.add(E)
}}}else{var A={xtype:"combo",name:this.name,fieldLabel:"&nbsp;",hideLabel:true,anchor:"100%",tpl:new CQ.Ext.XTemplate('<tpl for="."><div ext:qtip="{[CQ.shared.Util.htmlEncode(values["qtip"])]}" class="x-combo-list-item">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "text")]}</div></tpl>'),displayField:"text",typeAhead:false,mode:"local",emptyText:"",triggerAction:"all",allowBlank:this.allowBlank,hideMode:"display",stateful:false,vtype:C.vtype};
if(this.isSelect){A.selectOnFocus=false;
A.editable=false;
A.listeners={select:{fn:this.selectCombo,scope:this},render:function(F){F.getEl().dom.removeAttribute("name")
}};
this.hiddenField=new CQ.Ext.form.Hidden({name:this.name});
this.add(this.hiddenField)
}else{A.listeners={select:{fn:this.fireComboboxSelectionChanged,scope:this},change:{fn:this.fireComboboxContentChanged,scope:this}}
}CQ.Util.applyDefaults(this.optionsConfig,A);
this.setOptions(C.options)
}},initComponent:function(){CQ.form.Selection.superclass.initComponent.call(this);
this.addClass(CQ.DOM.encodeClass(this.name)+" cq-selection");
this.addEvents(CQ.form.Selection.EVENT_SELECTION_CHANGED)
},onRender:function(A,B){CQ.form.Selection.superclass.onRender.call(this,A,B);
if(this.value!=null){this.setValue(this.value)
}},disable:function(){CQ.form.Selection.superclass.disable.call(this);
for(var B=0;
B<this.items.getCount();
B++){var A=this.items.get(B);
if(A.disable){A.disable()
}}return this
},enable:function(){CQ.form.Selection.superclass.enable.call(this);
for(var B=0;
B<this.items.getCount();
B++){var A=this.items.get(B);
if(A.enable){A.enable()
}}return this
},focus:function(C,A){if(this.isComboBox||this.isSelect){return this.comboBox.focus(C,A)
}if(this.optionItems&&this.optionItems.length>0){var B=this.optionItems.get(0);
return B.focus()
}return this
}});
CQ.form.Selection.EVENT_SELECTION_CHANGED="selectionchanged";
CQ.form.Selection.PATH_PLACEHOLDER="$PATH";
CQ.form.Selection.PATH_PLACEHOLDER_REGEX=/\$PATH/g;
CQ.Ext.reg("selection",CQ.form.Selection);
CQ.form.SuggestField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{url:"",minTermLength:3,suggestDelay:500,searchDelay:0,suggestIntervalId:0,searchIntervalId:0,lastTerm:null,constructor:function(A){CQ.Util.applyDefaults(A,{tpl:new CQ.Ext.XTemplate("<div>",'<tpl for=".">','<div class="x-combo-list-item">','<div ext:qtip="{value}" class="name {cls}">{name}</div>','<div ext:qtip="{value}" class="title">{[values.title && values.title != "null" ? values.title : ""]}</div>','<div class="nav">','<tpl if="up === true">&laquo;</tpl>','<tpl if="up === false"><span style="color:gray">&laquo;</span></tpl>','<tpl if="down === true">&raquo;</tpl>','<tpl if="down === false"><span style="color:gray">&raquo;</span></tpl>',"</div>","</div>","</tpl>","</div>"),autoSelect:false,displayField:"value",triggerClass:"x-form-search-trigger",listWidth:CQ.themes.SuggestField.LIST_WIDTH,maxHeight:CQ.themes.SuggestField.MAX_HEIGHT,listClass:"cq-suggestions",mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false});
if(!(A.store instanceof CQ.Ext.data.Store)){var B=CQ.Util.applyDefaults(A.store,{proxy:new CQ.Ext.data.HttpProxy({url:A.url,method:"GET"}),baseParams:{_charset_:"utf-8"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"suggestions",id:"value",fields:["value","name","title","up","down","pre","post","cls"]})});
A.store=new CQ.Ext.data.Store(B)
}this.store=A.store;
CQ.form.SuggestField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.SuggestField.superclass.initComponent.call(this);
this.addListener("keyup",this.keyupListener,this);
this.addListener("keydown",this.keydownListener,this);
this.addListener("beforeSelect",this.beforeSelectListener,this);
this.addEvents("search")
},keydownListener:function(F,L){var J=L.getKey();
if((J==39||J==37)&&this.isExpanded()){var E=this.store.getAt(this.selectedIndex);
var I=E.get("value");
var B=E.get("pre");
var K=E.get("post");
var G=-1;
var A=false;
var D=true;
if(J==39){if(E.get("down")===false){A=true;
D=false
}}else{if(E.get("up")===false){return 
}var C=I.lastIndexOf("/",I.lastIndexOf("/")-1);
I=I.substring(0,C);
G+=2;
if(K==""){K=" "
}}this.setRawValue(B+I+K);
var H=B.length+I.length+G;
if(this.getRawValue().charAt(H)=='"'){H--
}this.setCaretPosition(H);
if(D){this.requestSuggestions(I,B,K)
}else{this.collapse()
}if(A){this.fireEvent("search",this,B+I+K)
}}},keyupListener:function(C,A){var F=this.getRawValue();
var D=this.getCaretPosition();
var B=this.getTermAt(D);
var E=A.getKey();
if(A.isSpecialKey()){if(E==13){this.fireEvent("search",this,F);
if(this.isExpanded&&this.selectedIndex==-1){this.collapse()
}return 
}if(!this.isExpanded()){if(E==40){this.suggest(B,F,D);
return 
}}return 
}if(B.length<this.minTermLength){return 
}if(E==8&&/\/$/.test(B)==false){return 
}var G=this;
window.clearTimeout(this.suggestIntervalId);
this.suggestIntervalId=window.setTimeout(function(){G.suggest(B,F,D)
},this.suggestDelay);
if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
this.searchIntervalId=window.setTimeout(function(){G.fireEvent("search",G,F)
},this.searchDelay)
}},suggest:function(D,E,A){this.lastTerm=D;
this.caretPos=A;
var F=E.substring(0,(E.lastIndexOf(D,A)));
var C=E.indexOf(" ",A);
var B=C==-1?"":E.substring(C);
this.requestSuggestions(D,F,B)
},requestSuggestions:function(C,D,B){var A=this.name?this.name:this.id;
var E={pre:D,post:B};
E[A]=D+C+B;
E[A+"_term"]=C;
this.store.load({params:E})
},beforeSelectListener:function(E,A,B){var D=A.get("pre");
var C=A.get("value");
this.setRawValue(D+C+A.get("post"));
var F=D.length+C.length;
if(this.getRawValue().charAt(F)=='"'){F--
}this.setCaretPosition(F);
this.collapse();
return false
},getTermAt:function(F){var A=this.getRawValue();
if(A.charAt(F)==" "){F-=1
}var D=false;
var C="";
for(var B=0;
B<A.length;
B++){var E=A.charAt(B);
if(E==" "){if(D){C+=E
}else{if(B>=F){return C
}else{C=""
}}}else{if(E=='"'){D=!D
}else{C+=E
}}}return C
}});
CQ.Ext.reg("suggestfield",CQ.form.SuggestField);
CQ.form.PathCompletion=CQ.Ext.extend(CQ.Ext.form.ComboBox,{searchDelay:200,rootPath:"",lastValue:null,searchIntervalId:0,constructor:function(A){CQ.Util.applyDefaults(A,{tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div ext:qtip="{path}" class="x-combo-list-item">','<span class="cq-pathcompletion-list-name">{label}</span>','<span class="cq-pathcompletion-list-title">{title}</span>',"</div>","</tpl>"),displayField:"path",triggerClass:"x-form-search-trigger",typeAhead:true,mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false});
if(!(A.store instanceof CQ.Ext.data.Store)){var B=CQ.Util.applyDefaults(A.store,{proxy:new CQ.Ext.data.HttpProxy({url:"/",method:"GET"}),baseParams:{predicate:"hierarchyNotFile"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"pages",id:"path",fields:["label","title","path"]})});
A.store=new CQ.Ext.data.Store(B)
}this.store=A.store;
CQ.form.PathCompletion.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.PathCompletion.superclass.initComponent.call(this);
this.addListener("keyup",this.keyup,this);
this.addEvents("search")
},adjustNewValue:function(A,B){if(/^path:"/.test(A)){B='"'+B+'"'
}return B
},keyup:function(B,A){var E=this.getRawValue();
var D=A.getKey();
if(D==13){this.fireEvent("search",this,E)
}if(E==this.lastValue){return 
}this.lastValue=E;
var F=E;
if(/^\//.test(F)&&/\/$/.test(F)){if(F=="/"){F=this.rootPath?this.rootPath:"/"
}else{F=F.replace(/\/$/,"")
}this.loadStore(F)
}else{if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
var C=this;
this.searchIntervalId=window.setTimeout(function(){C.fireEvent("search",C,E)
},this.searchDelay)
}}},loadStore:function(A){this.store.proxy.api.read.url=A+".pages.json";
this.store.reload()
}});
CQ.Ext.reg("pathcompletion",CQ.form.PathCompletion);
CQ.form.HtmlUpload=CQ.Ext.extend(CQ.form.FileUploadField,{initComponent:function(){CQ.form.HtmlUpload.superclass.initComponent.call(this)
},onRender:function(C,A){CQ.form.HtmlUpload.superclass.onRender.call(this,C,A);
var B=this.findParentByType("dialog");
if(B){B.on("beforesubmit",function(){},this)
}}});
CQ.Ext.reg("htmlupload",CQ.form.HtmlUpload);
CQ.form.SizeField=CQ.Ext.extend(CQ.form.CompositeField,{widthParameter:null,widthPrefix:null,widthSuffix:null,heightParameter:null,heightPrefix:null,heightSuffix:null,fieldWidth:0,widthField:null,heightField:null,widthPrefixStyle:null,widthInputClass:null,heightPrefixStyle:null,heightInputClass:null,constructor:function(A){A=A||{};
var B={widthParameter:"./width",heightParameter:"./height",fieldWidth:"40",border:false,layout:"column",widthSuffix:"px",widthSuffixStyle:"padding-top: 3px; padding-left: 4px;",widthInputClass:"cq-sif-widthinput",heightPrefix:"&times;",heightPrefixStyle:"padding-top: 3px; padding-left: 15px; padding-right: 15px;",heightSuffix:"px",heightSuffixStyle:"padding-top: 3px; padding-left: 4px;",heightInputClass:"cq-sif-heightinput",fieldConfig:{vtype:"percent"},stateful:false};
A=CQ.Util.applyDefaults(A,B);
CQ.form.SizeField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.SizeField.superclass.initComponent.call(this);
var A;
if(this.widthPrefix){this.add(new CQ.Ext.Panel({html:this.widthPrefix,border:false,style:(this.widthPrefixStyle?this.widthPrefixStyle:null)}))
}A={name:this.widthParameter,maxLength:5,width:this.fieldWidth,cls:(this.widthInputClass?this.widthInputClass:""),stateful:false};
CQ.Ext.apply(A,this.fieldConfig);
this.widthField=new CQ.Ext.form.TextField(A);
this.add(this.widthField);
if(this.widthSuffix){this.add(new CQ.Ext.Panel({html:this.widthSuffix,border:false,style:(this.widthSuffixStyle?this.widthSuffixStyle:null)}))
}if(this.heightPrefix){this.add(new CQ.Ext.Panel({html:this.heightPrefix,border:false,style:(this.heightPrefixStyle?this.heightPrefixStyle:null)}))
}A={name:this.heightParameter,maxLength:5,width:this.fieldWidth,cls:(this.heightInputClass?this.heightInputClass:""),stateful:false};
CQ.Ext.apply(A,this.fieldConfig);
this.heightField=new CQ.Ext.form.TextField(A);
this.add(this.heightField);
if(this.heightSuffix){this.add(new CQ.Ext.Panel({html:this.heightSuffix,border:false,style:(this.heightSuffixStyle?this.heightSuffixStyle:null)}))
}},processRecord:function(C,G){if(this.fireEvent("beforeloadcontent",this,C,G)!==false){var H=null;
var F=null;
if(this.defaultValue){var B=this.defaultValue.split(",");
if(B.length==2){try{H=parseInt(B[0]);
F=parseInt(B[1])
}catch(E){}}}var D=C.get(this.widthParameter);
if(D==undefined&&H!=null){if(this.isApplyDefault(C,G)){this.widthField.setValue(H)
}}else{this.widthField.setValue(D)
}var A=C.get(this.heightParameter);
if(A==undefined&&F!=null){if(this.isApplyDefault(C,G)){this.heightField.setValue(F)
}}else{this.heightField.setValue(A)
}this.fireEvent("loadcontent",this,C,G)
}},setValue:function(D){var B=null;
var A=null;
if(D){var C=D.split(",");
if(C.length==2){try{B=parseInt(C[0]);
A=parseInt(C[1])
}catch(E){}}}this.widthField.setValue(B);
this.heightField.setValue(A)
},getValue:function(){return this.getRawValue()
},getRawValue:function(){var B=this.widthField.getValue()||"";
var A=this.heightField.getValue()||"";
if((B.length==0)&&(A.length==0)){return""
}return B+","+A
},markInvalid:function(A){this.widthField.markInvalid(A);
this.heightField.markInvalid(A)
},clearInvalid:function(){this.widthField.clearInvalid();
this.heightField.clearInvalid()
}});
CQ.Ext.reg("sizefield",CQ.form.SizeField);
CQ.form.SmartFile=CQ.Ext.extend(CQ.form.CompositeField,{uploadUrl:null,resourcePath:null,iconResources:null,extensionToIcon:null,defaultIcon:null,useFlash:true,mimeTypes:null,mimeTypesDescription:null,ddGroups:null,ddAccept:null,sizeLimit:0,fileLimit:0,invalidClass:null,fixedHeight:null,compWidth:0,compHeight:0,fileNameParameter:null,fileReferenceParameter:null,fileNameInputField:null,moveParameter:null,deleteFileParameter:null,deletePathParameter:null,uploadText:null,uploadTextUpload:null,uploadTextReference:null,uploadTextFallback:null,uploadIconCls:null,uploadPanelCls:null,uploadHintCls:null,removeUploadPanelClsOnProgress:false,validateOnSubmitOnly:false,allowUpload:false,allowFileReference:false,allowFileNameEditing:false,transferFileName:false,noFileNameText:"",isUploaded:false,flash:null,flashEl:null,swfEl:null,queuedFlashCommands:null,uploadPanel:null,fileInfo:null,serverFileInstance:null,referencedFileInfo:null,renditionSuffix:null,fallbackRenditionSuffix:null,headPanel:null,footPanel:null,instanceId:0,usePIN:false,constructor:function(A){this.instanceId=CQ.form.SmartFile.ID_COUNTER++;
A=A||{};
var B={hideBorders:true,border:false,anchor:CQ.themes.Dialog.ANCHOR,resourcePath:CQ.form.SmartFile.RESOURCE_PATH,mimeTypes:"*.*",mimeTypesDescription:CQ.I18n.getMessage("All files"),ddAccept:"*",sizeLimit:0,fileLimit:100,stateful:false,allowBlank:true,validateOnSubmitOnly:false,invalidClass:"cq-smartfile-invalid",allowUpload:true,allowFileReference:true,allowFileNameEditing:true,transferFileName:true,noFileNameText:"???",uploadPanelCls:"cq-upload-border",uploadHintCls:"cq-upload-hint",removeUploadPanelClsOnProgress:true,uploadIconCls:"cq-file-placeholder",uploadTextUpload:CQ.I18n.getMessage("Click to upload"),uploadTextReference:CQ.I18n.getMessage("Drop an asset"),uploadTextFallback:CQ.I18n.getMessage("Upload file"),uploadText:CQ.I18n.getMessage("Drop an asset or click to upload"),iconResources:CQ.themes.SmartFile.ICON_RESOURCES,extensionToIcon:CQ.themes.SmartFile.EXTENSION_TO_ICON,defaultIcon:CQ.themes.SmartFile.DEFAULT_ICON,renditionSuffix:CQ.form.SmartFile.DAM_RENDITIONS_PATH+CQ.form.SmartFile.DAM_WEB_RENDITION_NAME,fallbackRenditionSuffix:CQ.form.SmartFile.DAM_RENDITION_SUFFIX,height:120,listeners:{resize:this.onComponentResize}};
if(A.allowFileReferenceOnly!==undefined){A.allowFileReference=!A.allowFileReferenceOnly;
delete A.allowFileReferenceOnly
}if(this.allowUploadOnly!==undefined){A.allowUpload=!A.allowUploadOnly;
delete A.allowUploadOnly
}if(!A.allowFileReference&&!A.allowUpload){A.allowFileReference=true
}A.autoScroll=false;
A.bodyStyle="padding: 0px; overflow: hidden;";
A.layout="border";
CQ.Util.applyDefaults(A,B);
if(A.height&&(A.height!="auto")){this.fixedHeight=A.height
}else{this.fixedHeight=null
}if(CQ.endorsed.swfobject.getFlashPlayerVersion().major<9){A.useFlash=false
}CQ.form.SmartFile.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.SmartFile.superclass.initComponent.call(this);
var B=this;
this.containerPanel=new CQ.Ext.Panel({region:"center",ctCls:CQ.DOM.encodeClass("smartfile-"+this.name),activeItem:0,autoScroll:false,bodyStyle:"padding: 0px; overflow: hidden;",layout:"card"});
this.add(this.containerPanel);
this.uploadPanel=new CQ.Ext.Panel({itemId:"upload",cls:this.uploadPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(E,F,D){if(typeof F=="object"){D=F.height;
F=F.width
}this._width=F;
this._height=D;
if(this.rendered){B.setTextElSize(F,D);
B.setProgressBarSize(F,D);
B.setFlashSize(F,D)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(B.fixedHeight){var D=B.fixedHeight;
this.el.setHeight(D);
this.body.setHeight(D-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.uploadPanel);
this.createFileNameEditingCapability();
this.processingPanel=this.createProcessingPanel();
this.containerPanel.add(this.processingPanel);
this.createHiddenInterfaceFields();
if(this.headPanel){this.headPanel.region="north";
this.add(this.headPanel)
}if(this.footPanel){this.footPanel.region="south";
this.add(this.footPanel)
}if(!this.useFlash){var A={name:this.name,fieldLabel:this.uploadTextFallback,fileNameParameter:this.fileNameParameter,allowFileNameEditing:this.allowFileNameEditing};
if(this.fullTab){A.fieldLabel=this.uploadTextFallback
}this.fallbackFileField=new CQ.form.FileUploadField(A);
var C={itemId:"fallback",layout:"form",defaults:{anchor:CQ.themes.Dialog.ANCHOR},hideMode:"offsets",border:false,items:this.fallbackFileField};
if(this.fullTab){C.bodyStyle=CQ.themes.Dialog.TAB_BODY_STYLE
}else{C.defaults.hideLabel=true
}this.fallbackPanel=new CQ.Ext.Panel(C);
this.containerPanel.add(this.fallbackPanel)
}},getToplevel:function(){var A=this.findParentByType("dialog");
if(!A){A=this.findParentByType(CQ.Ext.form.FormPanel)
}return A
},onRender:function(B,E){CQ.form.SmartFile.superclass.onRender.call(this,B,E);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var A=this.findParentByType("dialog");
if(A){A.on("beforesubmit",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}else{var C=this.findParentByType(CQ.Ext.form.FormPanel);
if(C){var D=C.getForm();
D.on("beforeaction",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}}},afterRender:function(){CQ.form.SmartFile.superclass.afterRender.call(this);
this.initializeDragAndDrop()
},onComponentResize:function(B,A){if(typeof B=="object"){A=B.height;
B=B.width
}this.compWidth=B;
this.compHeight=A
},markInvalid:function(A){if(!this.rendered||this.preventMark){return 
}A=A||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.processingPanel.markInvalid(this.invalidClass);
this.uploadPanel.body.dom.qtip=A;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,A)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}this.uploadPanel.body.removeClass(this.invalidClass);
this.processingPanel.clearInvalid(this.invalidClass);
this.fireEvent("valid",this)
},validateOnStateChange:function(){if(!this.validateOnSubmitOnly){this.validate()
}this.validateLinkingFieldsOnStateChange()
},validateLinkingFieldsOnStateChange:function(){var D=this.getToplevel();
if(D){var B=CQ.Util.findFormFields(D);
if(B){for(var A in B){if(B.hasOwnProperty(A)){var F=B[A];
var E=F.length;
for(var G=0;
G<E;
G++){var C=F[G];
if(C.linkedComponent==this.name){C.validate()
}}}}}}},hasData:function(){return(this.fileInfo!=null)||(this.referencedFileInfo!=null)
},hasUploadedData:function(){return(this.fileInfo!=null)
},hasReferencedData:function(){return(this.referencedFileInfo!=null)
},createFileNameEditingCapability:function(){if(!this.allowFileNameEditing){this.fileNameField=new CQ.Ext.form.Hidden({disabled:!this.transferFileName})
}else{this.fileNameField=new CQ.Ext.form.TextField({autoHeight:false});
this.transferFileName=true
}this.containerPanel.add(this.fileNameField)
},createHiddenInterfaceFields:function(){this.fileReferenceField=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.fileReferenceField);
this.moveParameter=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.moveParameter);
this.deleteFileParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deleteFileParameter);
this.deletePathParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deletePathParameter);
this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},onBeforeSubmit:function(){return true
},getRawValue:function(){var A="";
if(this.fileInfo){A+='[instance:"'+this.fileInfo.dataPath+'" "'+this.fileInfo.mimeType+'" '+this.fileInfo.size+"]"
}if(this.referencedFileInfo){A+='[reference:"'+this.referencedFileInfo.dataPath+'" "'+this.referencedFileInfo.mimeType+'" '+this.referencedFileInfo.size+"]"
}if(this.fileNameInputField){A+='[fileName:"'+this.fileNameInputField.getValue()+'"]'
}return A
},createRefUrl:function(A){var C="";
for(var D in A.renditions){var E=CQ.form.SmartFile.DAM_RENDITIONS_PATH+D;
if(E==this.renditionSuffix){break
}if(E.indexOf(this.renditionSuffix)==0){C=D.substring(D.lastIndexOf("."));
break
}}var B=A.dataPath+this.renditionSuffix+C;
return CQ.HTTP.externalize(B,true)
},createFallbackRefUrl:function(A){var B=A.dataPath+this.fallbackRenditionSuffix;
return CQ.HTTP.externalize(B,true)
},getSuitableFileInfo:function(){if(this.referencedFileInfo!=null){return this.referencedFileInfo
}return this.fileInfo
},processPath:function(B,A){if(A){this.dataPath=B;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
this.validateOnStateChange();
this.syncFormElements();
this.updateView()
}},processRecord:function(A,E){if(this.fireEvent("beforeloadcontent",this,A,E)!==false){this.dataPath=E;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
var F;
if(this.fileNameParameter){F=A.get(this.fileNameParameter)
}if(this.fileReferenceParameter){var B=A.get(this.fileReferenceParameter);
if(B){this.referencedFileInfo=this.resolveReference(B,E);
if(F){this.referencedFileInfo.fileName=F
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo)
}}var D=A.get(this.name);
if(D){if(D["jcr:content"]){D=CQ.Sling.processBinaryData(D["jcr:content"])
}else{D=CQ.Sling.processBinaryData(D)
}if(D){var C=CQ.Sling.getContentPath(this.name,E);
this.fileInfo={fileName:F,dataPath:C,mimeType:D.type,size:D.size,url:CQ.HTTP.externalize(C,true)};
this.serverFileInstance=this.fileInfo
}}this.postProcessRecord(A,E);
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
this.fireEvent("loadcontent",this,A,E)
}},postProcessRecord:function(A,B){},resolveReference:function(fileRef,basePath){var refFileInfo=null;
var originalFileRef=fileRef;
try{if(fileRef.indexOf("/")==0){fileRef=fileRef+"/jcr:content.infinity";
var json=CQ.HTTP.eval(fileRef+CQ.HTTP.EXTENSION_JSON);
var refValue=CQ.Util.formatData(json);
if(refValue){refFileInfo=CQ.Sling.processBinaryData(refValue);
if(refFileInfo.renditions&&refFileInfo.renditions.original&&refFileInfo.renditions.original["jcr:content"]){refFileInfo.size=refFileInfo.renditions.original["jcr:content"][":jcr:data"];
refFileInfo.mimeType=refFileInfo.renditions.original["jcr:content"]["jcr:mimeType"]
}if(!refFileInfo.mimeType&&refFileInfo.metadata){refFileInfo.mimeType=refFileInfo.metadata["dc:format"]
}if(basePath){refFileInfo.dataPath=CQ.Sling.getContentPath(originalFileRef,basePath);
refFileInfo.url=CQ.HTTP.externalize(refFileInfo.dataPath)
}else{refFileInfo.dataPath=originalFileRef;
refFileInfo.url=originalFileRef
}}}else{refFileInfo={dataPath:fileRef,url:fileRef}
}}catch(e){CQ.Log.error("SmartFile#resolveReference: failed to resolve reference: "+e.message)
}return refFileInfo
},syncFormElements:function(){if(this.fileNameField){if(!this.fileNameParameter){this.fileNameParameter=this.name+CQ.form.SmartFile.PARAM_FILENAME_SUFFIX
}if(this.useFlash||this.containerPanel.layout.activeItem.itemId!="fallback"){this.fileNameField.getEl().dom.name=this.fileNameParameter
}else{this.fileNameField.getEl().dom.name=""
}}if(this.fileReferenceField){if(!this.fileReferenceParameter){this.fileReferenceParameter=this.name+CQ.form.SmartFile.PARAM_REFERENCE_SUFFIX
}this.fileReferenceField.getEl().dom.name=this.fileReferenceParameter
}if(this.moveParameter){this.moveParameter.getEl().dom.name=this.name+CQ.Sling.MOVE_SUFFIX
}if(this.deleteFileParameter){this.deleteFileParameter.getEl().dom.name=this.name+CQ.Sling.DELETE_SUFFIX
}if(this.fileReferenceField){var C=(this.referencedFileInfo?this.referencedFileInfo.dataPath:"");
this.fileReferenceField.setValue(C);
this.fileReferenceField.enable()
}if(this.moveParameter){if(this.fileInfo&&this.isUploaded){this.moveParameter.setValue(this.fileInfo.dataPath);
this.moveParameter.enable()
}else{this.moveParameter.disable()
}}if(this.useFlash&&this.deleteFileParameter){if(this.serverFileInstance&&!this.fileInfo){this.deleteFileParameter.enable()
}else{this.deleteFileParameter.disable()
}}var A=false;
var B;
var E=this.name.lastIndexOf("/");
if(E>0){var D=this.name.substring(0,E);
if(D!="."){A=true;
B=D
}}if(A){this.lastModifiedParameter.getEl().dom.name=B+"/jcr:lastModified";
this.lastModifiedByParameter.getEl().dom.name=B+"/jcr:lastModifiedBy";
this.lastModifiedParameter.enable();
this.lastModifiedByParameter.enable()
}else{this.lastModifiedParameter.getEl().dom.name=null;
this.lastModifiedByParameter.getEl().dom.name=null;
this.lastModifiedParameter.disable();
this.lastModifiedByParameter.disable()
}},flush:function(){if(this.referencedFileInfo){this.referencedFileInfo=null
}else{if(this.fileInfo){this.fileInfo=null
}}if((this.referencedFileInfo==null)&&(this.fileInfo==null)&&this.fileNameField){this.fileNameField.setValue("")
}this.validateOnStateChange();
if(!this.useFlash){this.deleteFileParameter.enable();
this.fallbackFileField.fileInput.dom.name="";
this.fallbackFileField.setValue("")
}},updateView:function(){var A=(this.fileInfo!=null)||(this.referencedFileInfo!=null);
this.updateViewBasics(A);
if(A){this.createProcessingPanelContents()
}this.doLayout()
},updateViewBasics:function(A){if(!A){this.containerPanel.getLayout().setActiveItem("upload");
if(!this.isUploadPanelCreated){this.createUploadPanel()
}else{this.switchToUploadBase()
}if(this.uploadHintCls){this.body.addClass(this.uploadHintCls);
if(this.textEl){this.textEl.addClass(this.uploadHintCls)
}}this.isUploadAvailable=true
}else{if(CQ.Ext.isIE){if(this.flash){this.flash.destroy();
this.flash=null
}}if(this.uploadHintCls){this.body.removeClass(this.uploadHintCls);
if(this.textEl){this.textEl.removeClass(this.uploadHintCls)
}}this.containerPanel.getLayout().setActiveItem("processing");
this.isUploadAvailable=false
}},createProcessingPanel:function(){return new CQ.form.SmartFile.FileInfoDisplay({itemId:"processing",fileNameField:(this.allowFileNameEditing&&this.fileNameField?this.fileNameField:null),parentComponent:this})
},createProcessingPanelContents:function(){var D=this.getSuitableFileInfo();
var C=D.fileName;
var H=null;
if(C){var E=C.lastIndexOf(".");
if((E>=0)&&(E<(C.length-1))){H=C.substring(E+1,C.length).toLowerCase()
}}var F=this.defaultIcon;
if(H&&this.extensionToIcon[H]){F=this.extensionToIcon[H]
}var G=this.iconResources;
if(G.charAt(G.length-1)!="/"){G+="/"
}var A=CQ.HTTP.externalize(G+F);
var J=CQ.I18n.getMessage("unknown");
if(D.mimeType){J=D.mimeType
}var B=CQ.I18n.getMessage("unknown");
if(D.size){B=CQ.Util.formatFileSize(D.size)
}var I=CQ.I18n.getMessage("MIME type: {0}<br>Size: {1}",[J,B]);
if(this.referencedFileInfo){I+="<br>"+this.getRefText(this.referencedFileInfo.dataPath,C)
}if(!this.transferFileName){C=this.noFileNameText
}this.processingPanel.updateContent(C,I,A)
},getRefText:function(B,C){var A=CQ.User.getCurrentUser().hasPermissionOn("update",B);
var E=CQ.HTTP.externalize(B,true);
var D=CQ.I18n.getMessage("Referenced from:")+" ";
if(A){D+='<a href="'+E+'" target="_blank" title="'+CQ.I18n.getMessage("Click here to open referenced file")+'" style="cursor:pointer;">'
}D+=C?C:B;
if(A){D+="</a>"
}return D
},createUploadPanel:function(){this.isUploadPanelCreated=true;
var C=this.uploadPanel.body;
var G=this.uploadPanel.items.getCount();
for(var B=G-1;
B>=0;
B--){this.remove(this.uploadPanel.items.itemAt(B))
}var A;
if(this.uploadIconCls){A='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.uploadIconCls+'"><br>'
}else{A=""
}var D=this.uploadText;
if(!this.allowUpload){D=this.uploadTextReference
}if(!this.allowFileReference){D=this.uploadTextUpload
}var F=A+D;
this.textEl=C.createChild({tag:"div",html:F});
if(!this.useFlash){this.textEl.addListener("click",function(){this.containerPanel.getLayout().setActiveItem("fallback");
this.fallbackFileField.fileInput.dom.name=this.name;
this.deleteFileParameter.disable()
},this)
}if(this.uploadHintCls){this.textEl.addClass(this.uploadHintCls)
}this.textEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setTextElSize(this.uploadPanel._width,this.uploadPanel._height)
}if(this.useFlash){this.flashEl=C.createChild({tag:"div",id:"_"+this.getXType()+"_"+this.instanceId+"_upload",cls:"cq-smartfile-upload",style:"position: absolute; top: 0px; left: 0px;"});
var E=this.flashEl.createChild({tag:"span"});
this.swfEl=null;
if(this.uploadHintCls){this.body.addClass(this.uploadHintCls)
}if(this.allowUpload){this.initFlash(E);
if(this.flash){this.swfEl=CQ.Ext.get(this.flash.movieName)
}}}},switchToUploadProgress:function(){if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.removeClass(this.uploadPanelCls)
}var B=this.uploadPanel.body;
this.textEl.setVisible(false);
if(this.flash){this.flash.setButtonDisabled(true)
}if(!this.progressBar){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
var A="padding-left: 5px; padding-right: 5px; position: absolute; top: 0px; left: 0px;";
if(this.fixedHeight){A+=" height: "+this.fixedHeight+"px"
}this.progressBarDiv=B.createChild({tag:"div",style:A});
this.progressBarDiv.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setProgressBarSize(this.uploadPanel._width,this.uploadPanel._height)
}this.progressBar.render(this.progressBarDiv);
this.progressBar.updateProgress(0,"Uploading ...")
}else{this.progressBarDiv.setVisible(true)
}},switchToUploadBase:function(){if(this.allowUpload){if(CQ.Ext.isIE){if(this.useFlash){var A=this.flashEl.dom;
if(this.swfEl){try{A.removeChild(this.swfEl.dom)
}catch(C){}this.swfEl=null
}var B=document.createElement("span");
B.id="__ieworkaround_"+new Date().getTime();
A.appendChild(B);
this.initFlash(B);
if(this.flash){this.swfEl=CQ.Ext.get(this.flash.movieName)
}}}else{if(this.uploadPanel._width&&this.uploadPanel._height){this.setFlashSize(this.uploadPanel._width,this.uploadPanel._height)
}if(this.flash){this.executeFlashCommand(this.flash.setButtonDisabled,[false])
}}}if(this.progressBarDiv){this.progressBarDiv.setVisible(false)
}if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.addClass(this.uploadPanelCls)
}this.textEl.setVisible(true)
},setTextElSize:function(B,A){if(this.textEl){if(!this.msgHeight){this.msgHeight=this.textEl.getHeight()
}var C=Math.round((A-this.msgHeight)/2);
if(C>0){this.textEl.setStyle("padding-top",C+"px")
}}},setProgressBarSize:function(B,A){if(this.progressBarDiv){this.progressBarDiv.setSize(B,A)
}},setFlashSize:function(B,A){if(this.flashEl){this.flashEl.setSize(B,A);
if(this.swfEl){this.swfEl.setSize(B,A)
}if(this.flash){this.executeFlashCommand(this.flash.setButtonDimensions,[B,A])
}}},flushFile:function(){this.flush();
this.syncFormElements();
this.updateView()
},initializeDragAndDrop:function(){if(this.allowFileReference&&this.ddGroups){if(typeof (this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var E=this;
var F=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(J,G,I){if(J&&J.clearAnimations){J.clearAnimations(this)
}if(J.isDropAllowed(this)){var H=E.handleDrop(I);
if(H){G.stopEvent()
}return H
}}});
var C=this.getToplevel();
if(C){C.on("activate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F);
C.on("deactivate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F)
}for(var B=0;
B<this.ddGroups.length;
B++){F.addToGroup(this.ddGroups[B])
}F.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var A=this.ddAccept;
if(A){if(!CQ.Ext.isArray(A)){var D=new RegExp("[ ;]+","g");
A=A.split(D)
}F.ddAccept=A
}this.dropTargets=[];
this.dropTargets.push(F)
}},handleDrop:function(A){if(this.handleDropBasics(A)){this.syncFormElements();
this.updateView();
return true
}return false
},handleDropBasics:function(C){if(C.records&&C.single){var A=C.records[0];
var B=A.get("path");
this.referencedFileInfo=this.resolveReference(B,this.dataPath);
var D=A.get("name");
if(D){this.referencedFileInfo.fileName=D
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo);
this.validateOnStateChange();
return true
}return false
},onUploaded:function(){this.syncFormElements();
this.updateView();
return true
},correctFileSize:function(A){if(A===0){return A
}return A+"MB"
},formatTimeLeft:function(B){if(B>86399){B=Math.round(B/86400);
if(B==1){return CQ.I18n.getMessage("{0} day",[B])
}else{return CQ.I18n.getMessage("{0} days",[B])
}}else{if(B>3599){B=new String(B/3600);
var A=B.indexOf(".");
if(A>0){if(B.charAt(A+1)=="0"){B=B.substring(0,A)
}else{B=B.substring(0,A+2)
}}if(B==1){return CQ.I18n.getMessage("{0} hour",[B])
}else{return CQ.I18n.getMessage("{0} hours",[B])
}}else{if(B<=3600&&B>59){B=Math.round(B/60)+"";
if(B==1){return CQ.I18n.getMessage("{0} minute",[B])
}else{return CQ.I18n.getMessage("{0} minutes",[B])
}}else{if(B==1){return CQ.I18n.getMessage("{0} second",[B])
}else{return CQ.I18n.getMessage("{0} seconds",[B])
}}}}},estimateTimeLeft:function(A,B){var C=new Date().valueOf()-this.startTime;
var D=Math.round(C*(B-A)/A/1000);
return this.formatTimeLeft(D)
},handleDialogStart:function(){if(this.pendingFiles>0){this.flash.cancelUpload();
this.pendingFiles=0
}},handleQueueSuccess:function(A){},handleQueueError:function(A,C,B){B=A.name+": "+B;
switch(C){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:B+=" ("+this.sizeLimit+" MB)";
break;
case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:B+=" ("+this.fileLimit+")";
break
}this.notify(B,CQ.form.SmartFile.STATUS_ERROR)
},handleDialogComplete:function(){if(this.name){this.flash.setFilePostName(this.name)
}if(!this.usePIN){this.flash.startUpload()
}else{var B=CQ.HTTP.getCookie("cqpin");
if(B){this.flash.addPostParam(":cqpin",B);
this.flash.startUpload()
}else{var A=this;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/cq/security/content/pin"),params:{userid:CQ.User.getCurrentUser().getUserID(),enabled:true},success:function(C){B=C.responseText.split("\n")[0].replace("Pin ","");
A.flash.addPostParam(":cqpin",B);
CQ.HTTP.setCookie("cqpin",B,"/",0);
A.flash.startUpload()
},failure:A.failure})
}}},handleUploadStart:function(A){this.hasUploadErrors=false;
this.startTime=new Date().valueOf();
this.switchToUploadProgress();
return true
},handleUploadProgress:function(A,E,D){var C=Math.round(100*E/D);
var B=CQ.I18n.getMessage("{0} of {1} - {2}",[CQ.Util.formatFileSize(E),CQ.Util.formatFileSize(D),this.estimateTimeLeft(E,D)]);
this.progressBar.updateProgress(C/100,B)
},handleUploadSuccess:function(C,B){var A=false;
var G=this.fileInfo;
B=CQ.HTTP.buildPostResponseFromHTML(B);
if(CQ.HTTP.isOk(B)){try{var F=B.headers[CQ.HTTP.HEADER_PATH];
if(this.name=="./*"){F=F+"/"+C.name
}else{F=F+"/"+this.name
}try{this.fileInfo=this.resolveReference(F,this.dataPath);
this.fileInfo.fileName=C.name
}catch(E){this.fileInfo={fileName:C.name,dataPath:F,url:CQ.HTTP.externalize(F),size:C.size}
}this.isUploaded=true;
A=(this.onUploaded()!==false);
if(this.transferFileName&&this.fileNameField){this.fileNameField.setValue(this.fileInfo.fileName)
}else{this.fileNameField.setValue("")
}this.validateOnStateChange()
}catch(E){CQ.Log.error("CQ.form.SmartFile#handleUploadSuccess: "+E.message)
}}else{CQ.Log.error("CQ.form.SmartFile#handleUploadSuccess: response not ok")
}var D;
if(!A){this.fileInfo=G;
this.hasUploadErrors=true;
D=CQ.I18n.getMessage("Error uploading '{0}'",[C.name]);
this.notify(D,CQ.form.SmartFile.STATUS_ERROR)
}},handleUploadError:function(A,C,B){this.hasUploadErrors=true;
B=CQ.I18n.getMessage("Failed to upload '{0}': {1}",[A.name,B]);
this.notify(B,CQ.form.SmartFile.STATUS_ERROR);
if(C!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){}},handleUploadComplete:function(){this.startTime=0;
this.pendingFiles=0
},initFlash:function(A){this.flashReady=false;
this.queuedFlashCommands=null;
var B=new Object();
B[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
this.flash=new SWFUpload({upload_url:CQ.HTTP.externalize(this.uploadUrl),file_post_name:this.name,flash_url:CQ.HTTP.externalize(this.resourcePath)+"/swfupload_f9.swf",file_size_limit:this.correctFileSize(this.sizeLimit),file_upload_limit:this.fileLimit,file_queue_limit:this.fileLimit,file_types:this.mimeTypes,file_types_description:this.mimeTypesDescription,post_params:B,button_placeholder_id:(A.dom?A.dom.id:A.id),button_width:this.uploadPanel.el.getWidth(),button_height:this.uploadPanel.el.getHeight(),debug:false,use_query_string:false,swfupload_loaded_handler:function(){this.processFlashCommandQueue();
this.flashReady=true
}.createDelegate(this),file_dialog_start_handler:this.handleDialogStart.createDelegate(this),file_dialog_complete_handler:this.handleDialogComplete.createDelegate(this),file_queued_handler:this.handleQueueSuccess.createDelegate(this),file_queue_error_handler:this.handleQueueError.createDelegate(this),upload_start_handler:this.handleUploadStart.createDelegate(this),upload_progress_handler:this.handleUploadProgress.createDelegate(this),upload_error_handler:this.handleUploadError.createDelegate(this),upload_success_handler:this.handleUploadSuccess.createDelegate(this),upload_complete_handler:this.handleUploadComplete.createDelegate(this),debug_handler:function(D){D=D.split("\n");
for(var C in D){}}})
},executeFlashCommand:function(B,A){if(this.flashReady){try{B.apply(this.flash,A)
}catch(C){this.queueDeferredFlashCommand(B,A)
}}else{if(!this.queuedFlashCommands){this.queuedFlashCommands=[]
}this.queuedFlashCommands.push({fn:B,args:A})
}},queueDeferredFlashCommand:function(B,A){if(!this.queuedFlashCommands){this.queuedFlashCommands=[]
}this.queuedFlashCommands.push({fn:B,args:A});
if(this.intervalId==null){this.intervalId=window.setInterval(function(){this.processFlashCommandQueue();
if(!this.queuedFlashCommands||(this.queuedFlashCommands.length==0)){window.clearInterval(this.intervalId);
this.intervalId=null
}}.createDelegate(this),50)
}},processFlashCommandQueue:function(){if(this.queuedFlashCommands){var A=false;
while((this.queuedFlashCommands.length>0)&&(!A)){var B=this.queuedFlashCommands[0];
try{B.fn.apply(this.flash,B.args);
this.queuedFlashCommands.splice(0,1)
}catch(C){A=true
}}}},reset:function(){this.flush();
CQ.form.SmartFile.superclass.reset.call(this)
},notify:function(B,A){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Upload"),B)
}});
CQ.form.SmartFile.RESOURCE_PATH="/libs/cq/ui/resources/swfupload";
CQ.form.SmartFile.PARAM_FILENAME_SUFFIX="Name";
CQ.form.SmartFile.PARAM_REFERENCE_SUFFIX="Reference";
CQ.form.SmartFile.DAM_RENDITION_SUFFIX="/jcr:content/renditions/original";
CQ.form.SmartFile.DAM_WEB_RENDITION_NAME="cq5dam.web.1280.1280";
CQ.form.SmartFile.DAM_RENDITIONS_PATH="/jcr:content/renditions/";
CQ.form.SmartFile.STATUS_SUCCESS=0;
CQ.form.SmartFile.STATUS_ERROR=1;
CQ.form.SmartFile.STATUS_SUBMISSION=2;
CQ.form.SmartFile.ID_COUNTER=0;
CQ.Ext.reg("smartfile",CQ.form.SmartFile);
CQ.form.SmartFile.FileInfoDisplay=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){A=A||{};
var B={fullTab:false,hideBorders:true,border:false,basicPadding:5,afterRender:function(){CQ.form.SmartFile.FileInfoDisplay.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}};
CQ.Util.applyDefaults(A,B);
CQ.form.SmartFile.FileInfoDisplay.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.SmartFile.FileInfoDisplay.superclass.initComponent.call(this);
this.iconPanel=new CQ.Ext.Panel({hideBorders:true,border:false,html:"&nbsp;",fixedWidth:CQ.themes.SmartFile.ICON_COLUMN_WIDTH});
this.basicPanel=new CQ.Ext.Panel({hideBorders:true,border:false,autoHeight:false});
if(this.fileNameField){this.basicPanel.add(this.fileNameField)
}else{this.fileNameDisplay=new CQ.Ext.Panel({hideBorders:true,border:false,cls:"x-form-field",html:"&nbsp;"});
this.basicPanel.add(this.fileNameDisplay)
}this.fileInfoDisplay=new CQ.Ext.Panel({hideBorders:true,border:false,html:"&nbsp;"});
this.basicPanel.add(this.fileInfoDisplay);
this.buttonsPanel=new CQ.Ext.Panel({hideBorders:true,border:false,autoHeight:false,fixedWidth:CQ.themes.SmartFile.BUTTONS_COLUMN_WIDTH});
this.flushButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Clear"),minWidth:CQ.themes.SmartFile.BUTTONS_COLUMN_WIDTH,listeners:{click:{fn:this.parentComponent.flushFile,scope:this.parentComponent}}});
this.buttonsPanel.add(this.flushButton)
},onRender:function(A,B){CQ.form.SmartFile.FileInfoDisplay.superclass.onRender.call(this,A,B);
this.iconPanel.render(this.body);
this.iconPanel.getEl().setStyle("position","absolute");
this.iconPanel.getEl().setStyle("top","0px");
this.iconPanel.getEl().setStyle("left","0px");
this.iconPanel.setWidth(this.iconPanel.fixedWidth);
this.basicPanel.render(this.body);
this.basicPanel.getEl().setStyle("position","absolute");
this.basicPanel.getEl().setStyle("top","0px");
this.basicPanel.getEl().setStyle("left",this.iconPanel.fixedWidth+"px");
this.buttonsPanel.render(this.body);
this.buttonsPanel.setWidth(this.buttonsPanel.fixedWidth);
this.buttonsPanel.getEl().setStyle("position","absolute");
this.buttonsPanel.getEl().setStyle("top","0px")
},onResize:function(C,A){CQ.form.SmartFile.FileInfoDisplay.superclass.onResize.call(this,C,A);
if(typeof C=="object"){A=C.height;
C=C.width
}var B=C-this.iconPanel.fixedWidth-this.buttonsPanel.fixedWidth-this.basicPadding;
this.basicPanel.setWidth(B);
if(this.fileNameField){this.fileNameField.setWidth(B)
}this.buttonsPanel.getEl().setStyle("left",(C-this.buttonsPanel.fixedWidth)+"px")
},updateContent:function(C,A,B){this.iconPanel.body.dom.innerHTML='<img src="'+B+'" border="0" alt="">';
if(this.fileNameField){this.fileNameField.setValue(C)
}else{this.fileNameDisplay.body.dom.innerHTML=C
}this.fileInfoDisplay.body.dom.innerHTML=A
},markInvalid:function(A){if(this.rendered){this.body.addClass(A);
this.iconPanel.body.addClass(A);
this.fileInfoDisplay.body.addClass(A);
this.basicPanel.body.addClass(A);
this.buttonsPanel.body.addClass(A)
}},clearInvalid:function(A){if(this.rendered){this.body.removeClass(A);
this.iconPanel.body.removeClass(A);
this.fileInfoDisplay.body.removeClass(A);
this.basicPanel.body.removeClass(A);
this.buttonsPanel.body.removeClass(A)
}}});
CQ.form.SmartImage=CQ.Ext.extend(CQ.form.SmartFile,{originalImage:null,processedImage:null,originalRefImage:null,processedRefImage:null,requestSuffix:null,imageToolDefs:null,mapParameter:null,cropParameter:null,rotateParameter:null,disableFlush:null,disableZoom:null,toolComponents:null,pathProvider:null,hideMainToolbar:false,imagesPending:0,disableInfo:false,infoTip:null,constructor:function(B){B=B||{};
var D={fullTab:true,mimeTypes:"*.jpg;*.jpeg;*.gif;*.png",mimeTypesDescription:CQ.I18n.getMessage("Images"),ddAccept:"image/",uploadPanelCls:null,removeUploadPanelClsOnProgress:false,allowFileNameEditing:false,transferFileName:false,uploadIconCls:"cq-image-placeholder",uploadTextReference:CQ.I18n.getMessage("Drop an image"),uploadTextFallback:CQ.I18n.getMessage("Upload image"),uploadText:CQ.I18n.getMessage("Drop an image or click to upload"),height:"auto",anchor:null,pathProvider:CQ.form.SmartImage.defaultPathProvider,hideMainToolbar:false};
this.imageToolDefs=[];
if(B.mapParameter){this.imageToolDefs.push(new CQ.form.ImageMap(B.mapParameter));
delete B.mapParameter
}if(B.cropParameter){this.imageToolDefs.push(new CQ.form.ImageCrop(B.cropParameter));
delete B.cropParameter
}if(B.rotateParameter){this.imageToolDefs.push(new CQ.form.SmartImage.Tool.Rotate(B.rotateParameter));
delete B.rotateParameter
}CQ.Util.applyDefaults(B,D);
CQ.form.SmartImage.superclass.constructor.call(this,B);
this.addEvents("beforeloadimage","loadimage","imagestate");
var A=this.imageToolDefs.length;
for(var C=0;
C<A;
C++){this.imageToolDefs[C].initialize(B)
}},initComponent:function(){CQ.form.SmartImage.superclass.initComponent.call(this);
this.workingAreaContainer=new CQ.Ext.Panel({itemId:"workingArea",border:false,layout:"border"});
this.processingPanel.add(this.workingAreaContainer);
this.workingArea=new CQ.Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,listeners:{beforeadd:function(C,D){if(C._width&&C._height&&D.notifyResize){D.notifyResize.call(D,this._width,this._height)
}},bodyresize:function(D,F,C){if(typeof F=="object"){C=F.height;
F=F.width
}if(F&&C){D._width=F;
D._height=C;
var H=D.items.getCount();
for(var E=0;
E<H;
E++){var G=D.items.get(E);
if(G.notifyResize){G.notifyResize.call(G,F,C)
}}}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}});
this.workingAreaContainer.add(this.workingArea);
this.imagePanel=new CQ.form.SmartImage.ImagePanel({itemId:"imageview",listeners:{"smartimage.zoomchange":{fn:function(C){if(this.zoomSlider){this.suspendEvents();
this.zoomSlider.setValue(C*10);
this.resumeEvents()
}},scope:this},"smartimage.defaultview":{fn:this.disableTools,scope:this}}});
this.workingArea.add(this.imagePanel);
if(this.topPanel){this.topPanel.region="north";
this.workingAreaContainer.add(this.topPanel)
}var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].initComponent(this)
}this.on("loadimage",this.adjustUI,this)
},onRender:function(B,C){CQ.form.SmartImage.superclass.onRender.call(this,B,C);
var A=this.getToplevel();
if(A){A.on("hide",function(){this.hideTools();
this.imagePanel.ignoreRotation=false;
this.toolSelector.disable();
this.imagePanel.disablePanelTemporaryily()
},this);
A.on("editlocked",function(D,E){if(this.savedDropTargets==null){this.savedDropTargets=this.dropTargets
}this.dropTargets=null
},this);
A.on("editunlocked",function(D,E){if(this.savedDropTargets!=null){this.dropTargets=this.savedDropTargets
}},this)
}},handleFieldLock:function(I,D,B,C){var G=this;
if(C.get("image")){var A=C.get("image");
var E=A["jcr:mixinTypes"];
if(E&&(E.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){D=false;
B=true;
I="cq-dialog-unlocked"
}if(A[CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED]){D=false;
I="cq-dialog-unlocked"
}}G.editLock=D;
G.editLockDisabled=B;
this.setToolbarEnabled(!(D&&!B));
if(D&&!B){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}var H="";
if(B){H=CQ.Dialog.INHERITANCE_BROKEN
}else{H=D?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}if(!this.fieldEditLockBtn){var F=this.findParentByType("dialog");
G.fieldEditLockBtn=new CQ.TextButton({disabled:B,tooltip:H,cls:"cq-dialog-editlock cq-smartimage-editlock",iconCls:I,handler:function(){F.switchPropertyInheritance(this,null,function(K,J){this.fieldEditLockBtn.setIconClass(K);
this.fieldEditLockBtn.setTooltip(K=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
this.editLock=J;
if(J){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}else{this.dropTargets[0].unlock();
this.processingPanel.body.unmask()
}this.setToolbarEnabled(!J)
})
},scope:this});
this.toolSelector.add(this.fieldEditLockBtn)
}else{this.fieldEditLockBtn.setDisabled(B);
this.fieldEditLockBtn.setIconClass(I);
this.fieldEditLockBtn.setTooltip(I=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE)
}},getFieldLockParameters:function(B){if(!B[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME]){B[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME]=[]
}B[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME].push(this.getPropertyName(this.fileNameParameter));
B[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME].push(this.getPropertyName(this.fileReferenceParameter));
for(var A=0;
A<this.imageToolDefs.length;
A++){B[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME].push(this.getPropertyName(this.imageToolDefs[A].transferFieldName))
}return B
},getFieldLockTarget:function(A){return A+="/image"
},getPropertyName:function(A){return A.substr(A.lastIndexOf("/")+1)
},markInvalid:function(A){if(!this.rendered||this.preventMark){return 
}A=A||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.imagePanel.addCanvasClass(this.invalidClass);
this.uploadPanel.body.dom.qtip=A;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,A)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}this.uploadPanel.body.removeClass(this.invalidClass);
this.imagePanel.removeCanvasClass(this.invalidClass);
this.fireEvent("valid",this)
},postProcessRecord:function(B,F){this.dataRecord=B;
if(this.originalImage!=null){this.fireEvent("statechange","originalremoved",true)
}this.originalImage=null;
if(this.processedImage!=null){this.fireEvent("statechange","processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage!=null){this.fireEvent("statechange","originalremoved",false)
}this.originalRefImage=null;
if(this.processedRefImage!=null){this.fireEvent("statechange","processedremoved",false)
}this.processedRefImage=null;
var E=null;
this.fireEvent("beforeloadimage",this);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image({dataPath:this.referencedFileInfo.dataPath,url:this.referencedFileInfo.url,fallbackUrl:this.referencedFileInfo.fallbackUrl});
this.notifyImageLoad(this.originalRefImage);
E=this.createProcessedImageConfig(this.referencedFileInfo.dataPath);
if(E){this.processedRefImage=new CQ.form.SmartImage.Image(E);
this.notifyImageLoad(this.processedRefImage)
}this.originalRefImage.load();
if(E){this.processedRefImage.load()
}}if(this.fileInfo){this.originalImage=new CQ.form.SmartImage.Image({dataPath:this.fileInfo.dataPath,url:this.fileInfo.url});
this.notifyImageLoad(this.originalImage);
E=this.createProcessedImageConfig(F);
if(E){this.processedImage=new CQ.form.SmartImage.Image(this.createProcessedImageConfig(F));
this.notifyImageLoad(this.processedImage)
}this.originalImage.load();
if(E){this.processedImage.load()
}}var A=this.imageToolDefs.length;
for(var D=0;
D<A;
D++){var C=this.imageToolDefs[D];
C.processRecord(B)
}},notifyImageLoad:function(A){if(!this.toolSelector.disabled&&!this.hideMainToolbar){this.toolSelector.disable()
}this.imagesPending++;
A.addToolLoadHandler(function(){this.imagesPending--;
if(this.imagesPending==0){this.fireEvent("loadimage",this)
}if(A==this.processedImage){this.fireEvent("imagestate",this,"processedavailable",true)
}else{if(A==this.processedRefImage){this.fireEvent("imagestate",this,"processedavailable",false)
}else{if(A==this.originalImage){this.fireEvent("imagestate",this,"originalavailable",true)
}else{if(A==this.originalRefImage){this.fireEvent("imagestate",this,"originalavailable",false)
}}}}}.createDelegate(this),true)
},createProcessedImageConfig:function(D){var E="";
if(D){var B=D.lastIndexOf(".");
var A=D.lastIndexOf("/");
if((B>0)&&(B>(A+1))){E=D.substring(B,D.length)
}}var C=this.pathProvider.call(this,this.dataPath,this.requestSuffix,E,this.dataRecord,this);
if(C==null){return null
}return{url:C}
},syncFormElements:function(){CQ.form.SmartImage.superclass.syncFormElements.call(this);
var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){var C=this.imageToolDefs[B];
C.transferToField()
}},usesProcessedImage:function(){var A=this.getSuitableImage(false);
return(A==this.processedImage)||(A==this.processedRefImage)
},invalidateProcessedImages:function(){if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}},createProcessingPanel:function(){if(!this.hideMainToolbar){var A,C;
this.imageTools=[];
var B=[];
A=this.imageToolDefs.length;
for(C=0;
C<A;
C++){var D=this.imageToolDefs[C];
var E;
if(!D.isCommandTool){E=new CQ.Ext.Toolbar.Button({text:D.toolName,itemId:D.toolId,toolRef:D,iconCls:D.iconCls,actionHandler:this.toolClicked.createDelegate(this),enableToggle:true,toggleGroup:"imageTools",allowDepress:true,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}else{E=new CQ.Ext.Toolbar.Button({text:D.toolName,itemId:D.toolId,toolRef:D,iconCls:D.iconCls,actionHandler:this.commandToolClicked.createDelegate(this),enableToggle:false,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}D.buttonComponent=E;
this.imageTools.push(E);
D.createTransferField(this);
B.push(E)
}if(!this.disableFlush){B.push({xtype:"tbseparator"});
B.push({xtype:"tbbutton",text:CQ.I18n.getMessage("Clear"),iconCls:"cq-image-icon-clear",listeners:{click:{fn:this.flushImage,scope:this}}})
}if(!this.disableInfo){B.push({xtype:"tbseparator"});
B.push({itemId:"infoTool",xtype:"tbbutton",iconCls:"cq-image-icon-info",listeners:{click:{fn:this.showImageInfo,scope:this}}})
}B.push({xtype:"tbfill"});
if(!this.disableZoom){this.zoomSlider=new CQ.Ext.Slider({width:200,minValue:0,maxValue:90,vertical:false,listeners:{change:{fn:function(F,G){this.imagePanel.setZoom(G/10)
},scope:this}}});
B.push(this.zoomSlider)
}}this.toolSelector=new CQ.Ext.Toolbar(B);
this.toolSelector.disable();
return new CQ.Ext.Panel({itemId:"processing",layout:"fit",border:false,bbar:(!this.hideMainToolbar?this.toolSelector:null),afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}})
},updateView:function(){var A=this.originalImage||this.originalRefImage||this.processedImage||this.processedRefImage;
this.updateViewBasics(A);
if(A){this.workingArea.getLayout().setActiveItem("imageview");
this.resetTools();
this.resetZoomSlider()
}this.updateImageInfoState();
this.doLayout();
if(this.processedRefImage){this.imagePanel.updateImage(this.processedRefImage)
}else{if(this.originalRefImage){this.imagePanel.updateImage(this.originalRefImage)
}else{if(this.processedImage){this.imagePanel.updateImage(this.processedImage)
}else{if(this.originalImage){this.imagePanel.updateImage(this.originalImage)
}}}}},resetTools:function(){if(!this.hideMainToolbar){var A=this.imageTools.length;
for(var C=0;
C<A;
C++){var B=this.imageTools[C];
if(B.enableToggle){B.toggle(false)
}}}this.imagePanel.hideAllShapeSets(false)
},resetZoomSlider:function(){if(this.zoomSlider){this.zoomSlider.suspendEvents();
this.zoomSlider.setValue(0);
this.zoomSlider.resumeEvents()
}},getImagePanel:function(){return this.imagePanel
},adjustUI:function(){if(!this.hideMainToolbar){var A;
if(!this.disableInfo){A=this.toolSelector.items.get("infoTool");
var B=A.disabled
}if(!this.editLock||this.editLockDisabled){this.toolSelector.enable();
this.enableToolbar();
if(!this.disableInfo){A.setDisabled(B)
}}if(this.fieldEditLockBtn){this.fieldEditLockBtn.setDisabled(this.editLockDisabled)
}}},setToolbarEnabled:function(A){(A?this.enableToolbar():this.disableToolbar())
},disableToolbar:function(){this.toolSelector.items.each(function(A){if(A!=this.fieldEditLockBtn){A.setDisabled(true)
}},this)
},enableToolbar:function(){this.toolSelector.items.each(function(B){if(B!=this.fieldEditLockBtn){var A=(!this.editLock||this.editLockDisabled);
if(A&&B.toolRef){A=B.toolRef.isEnabled()
}B.setDisabled(!A)
}},this)
},onUploaded:function(){this.originalImage=new CQ.form.SmartImage.Image(this.fileInfo);
this.originalImage.loadHandler=function(){var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].onImageUploaded(this.originalImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalImage);
this.originalImage.load();
if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}return true
},toolClicked:function(E){var C;
var H=E.buttonComponent;
if(H.pressed){var G=false;
if(this.toolComponents==null){this.toolComponents={}
}if(!this.toolComponents[E.toolId]){this.toolComponents[E.toolId]={isVisible:false,toolRef:E};
G=true
}var D=this.toolComponents[E.toolId];
C=this.hideTools(E.toolId);
if(E.userInterface&&(!E.userInterface.rendered)){E.userInterface.render(CQ.Util.getRoot())
}if(C){C.onDeactivation()
}if(E.userInterface){E.userInterface.show();
D.isVisible=true;
if(!(E.userInterface.saveX&&E.userInterface.saveY)){var I=E.userInterface.getSize().height;
var F=this.getPosition();
var B=F[0];
var A=F[1]-(I+4);
if(B<0){B=0
}if(A<0){A=0
}E.userInterface.setPosition(B,A)
}else{E.userInterface.setPosition(E.userInterface.saveX,E.userInterface.saveY)
}}E.onActivation()
}else{C=this.hideTools();
if(C){C.onDeactivation()
}this.imagePanel.drawImage()
}},commandToolClicked:function(A){A.onCommand()
},hideTools:function(C){if(!this.hideMainToolbar){var D;
for(var B in this.toolComponents){var A=this.toolComponents[B];
if(B!=C){if(A.isVisible){A.toolRef.userInterface.hide();
A.isVisible=false;
D=A.toolRef
}}}}return D
},disableTools:function(){if(!this.hideMainToolbar){var D=this.hideTools();
if(D){D.onDeactivation()
}var A=this.imageTools.length;
for(var B=0;
B<A;
B++){var C=this.imageTools[B];
if(C.pressed){C.suspendEvents();
C.toggle(false);
C.resumeEvents()
}}}},updateImageInfoState:function(){if(!this.disableInfo&&!this.hideMainToolbar){var A=this.toolSelector.items.get("infoTool");
var B=(this.referencedFileInfo!=null);
(B?A.enable():A.disable())
}},showImageInfo:function(){if(this.infoTip!=null){var B=this.infoTip.hidden==false;
this.infoTip.hide();
if(B){return 
}}var C=function(){if(this.infoTip!=null){this.infoTip.hide();
this.infoTip=null
}};
var A=this.toolSelector.items.get("infoTool");
this.infoTip=new CQ.Ext.Tip({title:CQ.I18n.getMessage("Image info"),html:'<span class="cq-smartimage-refinfo">'+this.getRefText(this.referencedFileInfo.dataPath)+"</span>",maxWidth:500,autoHide:false,closable:true,listeners:{hide:function(){CQ.Ext.EventManager.un(document,"click",C,this)
},scope:this}});
CQ.Ext.EventManager.on.defer(10,this,[document,"click",C,this]);
this.infoTip.showBy(A.el,"tl-tr")
},flushImage:function(A){this.flush();
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage){this.originalRefImage=null;
this.fireEvent("imagestate",this,"originalremoved",false)
}else{if(this.originalImage){this.originalImage=null;
this.fireEvent("imagestate",this,"originalremoved",true)
}}if(A!==true){this.syncFormElements();
this.notifyToolsOnFlush();
this.hideTools();
this.updateView()
}},reset:function(){this.flushImage();
CQ.form.SmartImage.superclass.reset.call(this)
},notifyToolsOnFlush:function(){var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].onImageFlushed()
}},getSuitableImage:function(A){var B;
if(this.processedRefImage&&!A){B=this.processedRefImage
}else{if(this.originalRefImage){B=this.originalRefImage
}else{if(this.processedImage&&!A){B=this.processedImage
}else{if(this.originalImage){B=this.originalImage
}}}}return B
},handleDrop:function(A){if(this.handleDropBasics(A)){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var B=this.imageToolDefs.length;
for(var C=0;
C<B;
C++){this.imageToolDefs[C].onImageUploaded(this.originalRefImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalRefImage);
this.originalRefImage.load();
return true
}return false
}});
CQ.form.SmartImage.defaultPathProvider=function(C,B,D,A){if(!B){return null
}return CQ.HTTP.externalize(C+B)
};
CQ.Ext.reg("smartimage",CQ.form.SmartImage);
CQ.form.SmartImage.Image=CQ.Ext.extend(CQ.Ext.emptyFn,{dataPath:null,url:null,image:null,width:null,height:null,isLoaded:false,loadHandler:null,toolLoadHandlers:null,constructor:function(A){this.url=A.url;
this.dataPath=A.dataPath;
this.fallbackUrl=A.fallbackUrl;
this.isLoaded=false;
this.loadHandler=A.loadHandler;
this.toolLoadHandlers=[]
},load:function(){this.image=new Image();
CQ.Ext.EventManager.on(this.image,"load",function(){this.width=this.image.width;
this.height=this.image.height;
this.isLoaded=true;
if(this.loadHandler){this.loadHandler(this)
}var C=this.toolLoadHandlers.length;
for(var B=C-1;
B>=0;
B--){var A=this.toolLoadHandlers[B];
A.fn(this);
if(A.runOnce){this.toolLoadHandlers.splice(B,1)
}}},this,{single:true});
CQ.Ext.EventManager.on(this.image,"error",function(){if(this.fallbackUrl!=null){this.image.src=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.noCaching(this.fallbackUrl))
}},this,{single:true});
if(CQ.Ext.isIE){this.image.galleryimg=false
}this.image.src=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.noCaching(this.url))
},addToolLoadHandler:function(C,A){var B={fn:C,runOnce:A};
this.toolLoadHandlers.push(B)
}});
CQ.form.SmartImage.ImagePanel=CQ.Ext.extend(CQ.Ext.Panel,{isInitialized:false,backgroundColor:null,imageToDisplay:null,zoom:0,rotation:0,ignoreRotation:false,basicSize:null,workingAreaSize:null,originalImageSize:null,basicImageSize:null,zoomedImageSize:null,centerPoint:null,internalOffset:null,internalPadding:null,positioningContainer:null,scollerDiv:null,spacerImage:null,canvasDiv:null,imageCanvas:null,imageOffsets:null,shapeSets:null,shapeDefs:null,rolledOverShapes:null,selectedShapes:null,scheduledDragShapes:null,tolerance:0,canvasClass:null,zoomedTolerance:0,isRollOverHandlingBlocked:false,doc:null,temporaryHandlers:null,constructor:function(A){if(!A){A={}
}var B={backgroundColor:CQ.themes.SmartImage.BACKGROUND_COLOR,canvasClass:CQ.themes.SmartImage.CANVAS_CLASS,border:false,layout:"fit",zoom:0,tolerance:3,internalPadding:{width:8,height:8}};
this.addEvents("smartimage.zoomchange","zoomchange","smartimage.addrequest","addrequest","smartimage.custom","smartimage.selchanged","selectionchange","smartimage.rollover","rollover","smartimage.dragchange","dragchange","smartimage.contentchange","contentchange","smartimage.defaultview","defaultview");
CQ.Util.applyDefaults(A,B);
CQ.form.SmartImage.ImagePanel.superclass.constructor.call(this,A);
this.shapeSets={};
this.rolledOverShapes=[];
this.selectedShapes=[];
this.scheduledDragShapes=[];
this.internalOffset={x:0,y:0}
},onRender:function(A,B){CQ.form.SmartImage.ImagePanel.superclass.onRender.call(this,A,B);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.positioningContainer=document.createElement("div");
this.positioningContainer.style.position="relative";
this.positioningContainer.style.top="0";
this.positioningContainer.style.left="0";
this.body.dom.appendChild(this.positioningContainer);
this.canvasDiv=document.createElement("div");
this.canvasDiv.style.position="absolute";
this.canvasDiv.style.top="0";
this.canvasDiv.style.left="0";
this.positioningContainer.appendChild(this.canvasDiv);
this.scrollerDiv=document.createElement("div");
this.scrollerDiv.style.position="absolute";
this.scrollerDiv.style.top="0";
this.scrollerDiv.style.left="0";
this.scrollerDiv.style.overflow="scroll";
CQ.Ext.EventManager.on(this.scrollerDiv,"scroll",this.handleScroll,this);
this.positioningContainer.appendChild(this.scrollerDiv);
this.spacerImage=document.createElement("img");
this.spacerImage.src=CQ.Ext.BLANK_IMAGE_URL;
this.scrollerDiv.appendChild(this.spacerImage);
this.spacerImage.style.display="block";
if(CQ.Ext.isIE){this.spacerImage.galleryimg=false
}this.imageCanvas=this.createCanvas(this.canvasDiv,1,1);
this.doc=CQ.Ext.get(document);
if(this.canvasClass){CQ.Ext.get(this.imageCanvas).addClass(this.canvasClass)
}if(this.backgroundColor!=null){this.imageCanvas.style.backgroundColor=this.backgroundColor
}CQ.Ext.EventManager.on(this.spacerImage,"mousemove",this.onMouseMove,this);
CQ.Ext.EventManager.on(this.spacerImage,"mousedown",this.onMouseDown,this);
CQ.Ext.EventManager.on(this.spacerImage,"mouseup",this.onMouseUp,this);
CQ.Ext.EventManager.on(this.spacerImage,"mouseout",this.onComponentLeave,this)
},addCanvasClass:function(A){CQ.Ext.get(this.imageCanvas).addClass(A)
},removeCanvasClass:function(A){CQ.Ext.get(this.imageCanvas).removeClass(A)
},updateImage:function(B){this.imageToDisplay=B;
if(this.rendered){if(this.imageToDisplay.isLoaded){this.handleImageLoaded()
}else{var A=this.imageToDisplay.loadHandler;
this.imageToDisplay.loadHandler=function(){this.handleImageLoaded();
if(A){A(this.imageToDisplay)
}}.createDelegate(this)
}}},switchToDefaultView:function(){this.fireEvent("defaultview");
this.fireEvent("smartimage.defaultview");
this.setZoom(0);
this.fireEvent("zoomchange",0);
this.fireEvent("smartimage.zoomchange",0)
},notifyResize:function(B,A){this.body.setSize(B,A);
this.calculateBasicSize();
this.propagateWorkingArea(this.notifyResizeAsync.createDelegate(this))
},notifyResizeAsync:function(){if(CQ.Ext.isIE&&this.shapeDefs){var B=this.shapeDefs.length;
for(var A=0;
A<B;
A++){var C=this.shapeDefs[A];
this.setCanvasSize(C.canvas,this.workingAreaSize)
}}if(this.imageToDisplay&&this.imageToDisplay.isLoaded){this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
}this.isInitialized=true
},onMouseMove:function(D){if(!this.zoomedImageSize){return 
}var E=false;
var C=this.calculateTransformedCoords(D);
if(this.deferredDragShapes!=null){E=true;
if(C.isVirtual){return 
}var G=this.calculateDistance(this.draggingBaseCoords.unzoomedUnclipped,C.unzoomedUnclipped);
if(G>=this.zoomedTolerance){this.directDragShapes=this.deferredDragShapes;
this.fireDragStart(this.draggingBaseCoords);
this.deferredDragShapes=null
}}if(this.directDragShapes!=null){var A=C.unzoomedUnclipped;
var F=A.x-this.draggingBaseCoords.unzoomed.x;
var B=A.y-this.draggingBaseCoords.unzoomed.y;
this.fireMove(F,B,C);
this.fireEvent("dragchange",this.directDragShapes,false);
this.fireEvent("smartimage.dragchange",this.directDragShapes,false)
}else{if(!E&&!this.isRollOverHandlingBlocked){this.executeFnOnShapes(function(H){var I=(this.rolledOverShapes.indexOf(H)>=0);
var J=H.isTouched(C,this.zoomedTolerance);
if(J!=I){if(J){this.addShapeToRollovers(H,C)
}else{this.removeShapeFromRollovers(H,C)
}}else{if(J){if(H.onRolledOver(C)){this.drawImage()
}}}}.createDelegate(this),true);
this.fireEvent("rollover",this.rolledOverShapes);
this.fireEvent("smartimage.rollover",this.rolledOverShapes)
}}if(!CQ.Ext.isIE){D.stopPropagation()
}else{return false
}},onComponentLeave:function(){if(this.directDragShapes==null){var A=false;
var C=this.rolledOverShapes.length;
for(var B=0;
B<C;
B++){var D=this.rolledOverShapes[B];
if(D.onRollOut()){A=true
}}this.rolledOverShapes.length=0;
if(A){this.drawImage()
}this.fireEvent("rollover",[]);
this.fireEvent("smartimage.rollover",[])
}},onMouseDown:function(A){if(!this.zoomedImageSize){return 
}var H=this.calculateTransformedCoords(A);
this.scheduledDragShapes.length=0;
this.fireEvent("addrequest",H);
this.fireEvent("smartimage.addrequest",H);
var F=this.scheduledDragShapes.length;
if((this.rolledOverShapes.length>0)||(F>0)){var E=[];
var B=[];
var G=this.rolledOverShapes.length;
for(var J=0;
J<G;
J++){var C=this.rolledOverShapes[J];
if(C.isDirectlyDraggable(H,this.zoomedTolerance)){E.push(C)
}else{if(C.isDeferredDraggable(H,this.zoomedTolerance)){B.push(C)
}}}for(var I=0;
I<F;
I++){var D=this.scheduledDragShapes[I];
D.onAddForDrag(H);
E.push(D)
}if(E.length>0){this.directDragShapes=E;
this.deferredDragShapes=null;
this.draggingBaseCoords=H;
this.fireDragStart(H);
this.fireEvent("dragchange",this.directDragShapes,false);
this.fireEvent("smartimage.dragchange",this.directDragShapes,false)
}else{if(B.length>0){this.directDragShapes=null;
this.deferredDragShapes=B;
this.draggingBaseCoords=H
}else{this.directDragShapes=null;
this.deferredDragShapes=null;
this.draggingBaseCoords=null
}}}this.addTemporaryHandler(this.doc,"mousemove",this.onMouseMove,this);
if(CQ.Ext.isGecko){this.addTemporaryHandler(this.doc,"mouseup",this.onMouseUp,this)
}},onMouseUp:function(D){if(!this.zoomedImageSize){return 
}var E=this.calculateTransformedCoords(D);
var C=E.unzoomedUnclipped;
var B=false;
if((this.directDragShapes!=null)||(this.deferredDragShapes!=null)){if(this.directDragShapes!=null){B=true;
var F=C.x-this.draggingBaseCoords.unzoomedUnclipped.x;
var A=C.y-this.draggingBaseCoords.unzoomedUnclipped.y;
this.fireMove(F,A,E);
this.fireDragEnd(E);
this.fireEvent("dragchange",this.directDragShapes,true);
this.fireEvent("smartimage.dragchange",this.directDragShapes,true);
this.directDragShapes=null
}this.deferredDragShapes=null;
this.draggingBaseCoords=null
}if(!B){this.selectRollovers()
}else{this.onMouseMove(D)
}if(!CQ.Ext.isIE){D.stopPropagation()
}this.removeTemporaryHandlers()
},fireMove:function(G,B,E){var F=false;
var D=this.directDragShapes.length;
for(var A=0;
A<D;
A++){var C=this.directDragShapes[A];
if(C.moveShapeBy(G,B,E)){F=true
}}if(F){this.drawImage()
}},fireDragStart:function(D){var E=false;
var C=this.directDragShapes.length;
for(var A=0;
A<C;
A++){var B=this.directDragShapes[A];
if(B.onDragStart(D,this.zoomedTolerance)){E=true
}}if(E){this.drawImage()
}},fireDragEnd:function(D){var E=false;
var C=this.directDragShapes.length;
for(var A=0;
A<C;
A++){var B=this.directDragShapes[A];
if(B.onDragEnd(D,this.zoomedTolerance)){E=true
}}if(E){this.drawImage()
}},addTemporaryHandler:function(E,B,D,C){if(this.temporaryHandlers==null){this.temporaryHandlers=[]
}var A={el:E,handlerName:B,fn:D,scope:C};
this.temporaryHandlers.push(A);
E.on(B,D,C)
},removeTemporaryHandlers:function(){if(this.temporaryHandlers!=null){var B=this.temporaryHandlers.length;
for(var C=0;
C<B;
C++){var A=this.temporaryHandlers[C];
A.el.un(A.handlerName,A.fn,A.scope)
}this.temporaryHandlers=null
}},blockRollOver:function(){this.isRollOverHandlingBlocked=true;
var A=this.rolledOverShapes.length;
for(var B=A-1;
B>=0;
B--){this.removeShapeFromRollovers(this.rolledOverShapes[B])
}this.drawImage();
this.fireEvent("rollover",this.rolledOverShapes);
this.fireEvent("smartimage.rollover",this.rolledOverShapes)
},unblockRollOver:function(){this.isRollOverHandlingBlocked=false
},addShapeToRollovers:function(A,B){this.rolledOverShapes.push(A);
if(A.onRollOver(B)){this.drawImage()
}},removeShapeFromRollovers:function(A,D,C){var B=this.rolledOverShapes.indexOf(A);
if(B>=0){this.rolledOverShapes.splice(B,1);
if(A.onRollOut(D)&&!C){this.drawImage()
}}},getRolledOverShapes:function(){var A=[];
var C=this.rolledOverShapes.length;
for(var B=0;
B<C;
B++){A.push(this.rolledOverShapes[B])
}return A
},selectRollovers:function(){var F=false;
var C=false;
var D;
var B=this.selectedShapes.length;
for(D=0;
D<B;
D++){var G=this.selectedShapes[D];
if(this.rolledOverShapes.indexOf(G)<0){F=true;
if(G.onUnSelect()){C=true
}}}var A=[];
var H=this.rolledOverShapes.length;
for(D=0;
D<H;
D++){F=true;
var E=this.rolledOverShapes[D];
A.push(E);
if(this.selectedShapes.indexOf(E)<0){if(E.onSelect()){C=true
}}if(E.onClick()){C=true
}}this.selectedShapes=A;
if(C){this.drawImage()
}CQ.Log.debug("Firing selection change event.");
this.fireEvent("selectionchange",A);
this.fireEvent("smartimage.selchanged",A);
return F
},clearSelection:function(){var B=false;
var A=this.selectedShapes.length;
for(var C=0;
C<A;
C++){var E=this.selectedShapes[C];
if(E.onUnSelect()){B=true
}}var D=this.selectedShapes;
this.selectedShapes=[];
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes);
return D
},deleteSelectedShapes:function(){var B=this.selectedShapes.length;
if(B>0){for(var A=0;
A<B;
A++){var D=this.selectedShapes[A];
var C=this.getSuitableShapeSet(D);
C.removeShape(D)
}this.drawImage();
this.selectedShapes.length=0;
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes)
}},getSelectedShapes:function(){var C=[];
var B=this.selectedShapes.length;
for(var A=0;
A<B;
A++){C.push(this.selectedShapes[A])
}return C
},selectShape:function(E,F){if(F===true){var B=this.selectedShapes.length;
for(var A=0;
A<B;
A++){var D=this.selectedShapes[A];
var C=this.getSuitableShapeSet(D);
C.removeShape(D)
}this.selectedShapes.length=0
}E.onSelect();
this.selectedShapes.push(E);
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes)
},getTolerance:function(){return this.zoomedTolerance
},calculateBasicSize:function(){this.basicSize={width:this.body.dom.clientWidth,height:this.body.dom.clientHeight}
},calculateWorkingAreaSize:function(){this.workingAreaSize={width:this.scrollerDiv.clientWidth,height:this.scrollerDiv.clientHeight}
},calculateOriginalImageSize:function(){this.originalImageSize={width:this.imageToDisplay.width,height:this.imageToDisplay.height,ratio:(this.imageToDisplay.width/this.imageToDisplay.height)}
},calculateZoom:function(A,B){if(B.width!==undefined){return{width:Math.round((A+1)*B.width),height:Math.round((A+1)*B.height)}
}else{if(B.x!==undefined){return{x:Math.round((A+1)*B.x),y:Math.round((A+1)*B.y)}
}}return null
},calculateAbsoluteZoom:function(){return((this.zoom+1)*this.basicImageSize.baseZoom)-1
},calculateInverseZoom:function(B,A){if(A.width!==undefined){return{width:Math.round(A.width/(B+1)),height:Math.round(A.height/(B+1))}
}else{if(A.x!==undefined){return{x:Math.round(A.x/(B+1)),y:Math.round(A.y/(B+1))}
}}return null
},calculateBasicImageSizeForAngle:function(D){while(D<0){D+=360
}D=D%360;
var B=this.originalImageSize.width;
var I=this.originalImageSize.height;
var F=this.originalImageSize.ratio;
if((D==90)||(D==270)){var H=B;
B=I;
I=H;
F=1/F
}var A=B;
var J=B+(this.internalPadding.width*2);
var C=I+(this.internalPadding.height*2);
var E=this.workingAreaSize.width;
var G=this.workingAreaSize.height;
if(J>E){J=E;
B=J-this.internalPadding.width*2;
I=Math.round(B/F);
C=I+this.internalPadding.height*2
}if(C>G){C=G;
I=C-this.internalPadding.height*2;
B=Math.round(I*F);
J=B+this.internalPadding.width*2
}if(B<1){B=1
}if(I<1){I=1
}return{width:B,height:I,displayWidth:J,displayHeight:C,baseZoom:(B/A)}
},calculateBasicImageSize:function(){this.basicImageSize=this.calculateBasicImageSizeForAngle(this.getActualRotation())
},calculateZoomedImageSize:function(){this.zoomedImageSize=this.calculateZoom(this.zoom,this.basicImageSize);
this.zoomedTolerance=this.tolerance/(this.calculateAbsoluteZoom()+1);
this.zoomedImageSize.displayWidth=this.zoomedImageSize.width+(this.internalPadding.width*2);
this.zoomedImageSize.displayHeight=this.zoomedImageSize.height+(this.internalPadding.height*2)
},precalculateRotatedSize:function(C){var A=this.calculateBasicImageSizeForAngle(C);
var B=this.calculateZoom(this.zoom,A);
B.displayWidth=B.width+(this.internalPadding.width*2);
B.displayHeight=B.height+(this.internalPadding.height*2);
return B
},calculateSpacerSize:function(){var B=this.workingAreaSize.width;
var A=this.workingAreaSize.height;
if(this.zoomedImageSize){if(this.zoomedImageSize.displayWidth>B){B=this.zoomedImageSize.displayWidth
}if(this.zoomedImageSize.height>A){A=this.zoomedImageSize.displayHeight
}}return{width:B,height:A}
},calculateTransformedCoords:function(C){var J=this.calcCompFromMouseCoords(C);
if(this.imageOffsets){J.x-=this.imageOffsets.x;
J.y-=this.imageOffsets.y
}var B=this.zoomedImageSize.width;
var A=this.zoomedImageSize.height;
J.isVirtual=(J.x<0)||(J.x>=B)||(J.y<0)||(J.y>=A);
var G=this.calculateAbsoluteZoom();
var I=this.calculateInverseZoom(G,J);
var D=this.getActualRotation();
var H=(D==90)||(D==270);
I.zoom=this.zoom;
I.absoluteZoom=G;
I.imageSize=this.originalImageSize;
I.rotatedImageSize={width:(H?this.originalImageSize.height:this.originalImageSize.width),height:(H?this.originalImageSize.width:this.originalImageSize.height)};
var F={x:I.x,y:I.y,zoom:I.zoom,absoluteZoom:I.absoluteZoom,imageSize:I.imageSize,rotatedImageSize:I.rotatedImageSize};
if(I.x<0){I.x=0
}if(I.y<0){I.y=0
}if(H){if(I.y>=this.originalImageSize.width){I.y=this.originalImageSize.width-1
}if(I.x>=this.originalImageSize.height){I.x=this.originalImageSize.height-1
}}else{if(I.x>=this.originalImageSize.width){I.x=this.originalImageSize.width-1
}if(I.y>=this.originalImageSize.height){I.y=this.originalImageSize.height-1
}}var E;
switch(D){case 0:E={x:I.x,y:I.y};
break;
case 90:E={x:I.y,y:this.originalImageSize.height-I.x};
break;
case 180:E={x:this.originalImageSize.width-I.x,y:this.originalImageSize.height-I.y};
break;
case 270:E={x:this.originalImageSize.width-I.y,y:I.x};
break
}return{screen:J,unzoomed:I,unzoomedUnclipped:F,unrotated:E}
},calcCompFromMouseCoords:function(C){var A=new Object();
var D=CQ.Ext.get(this.canvasDiv).getXY();
var B={hOffset:D[0],vOffset:D[1]};
A.x=C.getPageX();
A.y=C.getPageY();
A.x-=B.hOffset;
A.y-=B.vOffset;
A.x+=this.scrollerDiv.scrollLeft;
A.y+=this.scrollerDiv.scrollTop;
C.preventDefault();
if(this.scrollerDiv.clientWidth<this.scrollerDiv.scrollWidth){A.x-=this.internalPadding.width
}if(this.scrollerDiv.clientHeight<this.scrollerDiv.scrollHeight){A.y-=this.internalPadding.height
}return A
},propagateImage:function(){this.blockRedraw=true;
this.calculateInternalOffset();
var F=this.workingAreaSize.width;
var C=this.workingAreaSize.height;
var E=this.zoomedImageSize.displayWidth;
var A=this.zoomedImageSize.displayHeight;
if((this.internalOffset.x+F)>E){this.internalOffset.x=E-F
}if((this.internalOffset.y+C)>A){this.internalOffset.y=A-C
}if(this.internalOffset.x<0){this.internalOffset.x=0
}else{if(this.internalOffset.y<0){this.internalOffset.y=0
}}var D=(this.internalOffset.x!=this.scrollerDiv.scrollLeft);
var B=(this.internalOffset.y!=this.scrollerDiv.scrollTop);
if(B){this.scrollerDiv.scrollTop=this.internalOffset.y
}if(D){this.scrollerDiv.scrollLeft=this.internalOffset.x
}this.drawImage();
this.blockRedraw=false
},propagateWorkingArea:function(B){this.setCSSSize(this.positioningContainer,this.basicSize);
this.setCSSSize(this.scrollerDiv,this.basicSize);
var A=this.propagateWorkingAreaAsync.createDelegate(this,[B]);
A.defer(1)
},propagateWorkingAreaAsync:function(A){this.calculateWorkingAreaSize();
this.adjustSpacerImage();
this.setCanvasSize(this.imageCanvas,this.workingAreaSize);
if(A){A()
}},setZoom:function(A){this.calculateCenterPoint();
this.zoom=A;
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
},calculateCenterPoint:function(){var F=this.workingAreaSize.width;
var A=this.workingAreaSize.height;
var E=this.scrollerDiv.scrollLeft;
var D=this.scrollerDiv.scrollTop;
var B={x:E+(F/2)-this.internalPadding.width,y:D+(A/2)-this.internalPadding.height};
if(B.x<0){B=0
}if(B.y<0){B=0
}var C=this.calculateAbsoluteZoom();
this.centerPoint=this.calculateInverseZoom(C,B)
},calculateInternalOffset:function(){var F=this.workingAreaSize.width;
var A=this.workingAreaSize.height;
if(this.centerPoint){var B=this.calculateAbsoluteZoom();
var C=this.calculateZoom(B,this.centerPoint);
var E=Math.round(C.x+this.internalPadding.width-(F/2));
var D=Math.round(C.y+this.internalPadding.height-(A/2));
if(E<0){E=0
}if(D<0){D=0
}this.internalOffset.x=E;
this.internalOffset.y=D
}else{this.internalOffset.x=0;
this.internalOffset.y=0
}},handleScroll:function(){if(!this.blockRedraw){var C=this.scrollerDiv.scrollLeft;
var B=this.scrollerDiv.scrollTop;
var A=(this.internalOffset.x!=C)||(this.internalOffset.y!=B);
if(A){this.internalOffset.x=C;
this.internalOffset.y=B;
this.calculateCenterPoint();
this.drawImage()
}}},setRotation:function(A){this.calculateCenterPoint();
this.rotation=A;
this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
},getActualRotation:function(){return(this.ignoreRotation?0:this.rotation)
},setImageSize:function(A,B){A.width=B.width;
A.height=B.height;
A.style.width=B.width+"px";
A.style.height=B.height+"px"
},setCSSSize:function(B,A){B.style.width=A.width+"px";
B.style.height=A.height+"px"
},setCanvasSize:function(B,A){B.width=A.width;
B.height=A.height
},calculateDistance:function(B,A){return Math.sqrt(Math.pow(B.x-A.x,2)+Math.pow(B.y-A.y,2))
},handleImageLoaded:function(){this.zoom=0;
this.internalOffset.x=0;
this.internalOffset.y=0;
this.centerPoint=null;
this.calculateOriginalImageSize();
if(this.isInitialized){this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
}},adjustSpacerImage:function(){this.setImageSize(this.spacerImage,this.calculateSpacerSize())
},addShapeSet:function(B){this.shapeSets[B.id]=B;
B.imageComponent=this;
var C=B.getShapeCount();
for(var A=0;
A<C;
A++){this.addShapeToDOM(B.getShapeAt(A))
}if(B.isVisible){this.drawImage()
}},drawShapeSets:function(D,E){var B=this.calculateAbsoluteZoom()+1;
for(var C in this.shapeSets){if(this.shapeSets.hasOwnProperty(C)){var A=this.shapeSets[C];
if(A.isVisible){A.drawShapes(D,B,E)
}}}},executeFnOnShapes:function(C,B){for(var A in this.shapeSets){if(this.shapeSets.hasOwnProperty(A)){var D=this.shapeSets[A];
if(D.isVisible||!B){D.executeFnOnShapes(C)
}}}},getShapeSet:function(A){if(this.shapeSets.hasOwnProperty(A)){return this.shapeSets[A]
}return null
},getSuitableShapeSet:function(B){for(var F in this.shapeSets){if(this.shapeSets.hasOwnProperty(F)){var A=this.shapeSets[F];
var E=A.getShapeCount();
for(var C=0;
C<E;
C++){var D=A.getShapeAt(C);
if(D==B){return A
}}}}return null
},setShapeSetVisible:function(C,A,D){var B=this.shapeSets[C];
if(B){B.executeFnOnShapes(function(F){if(!A){var G=(this.rolledOverShapes.indexOf(F)>=0);
var E=(this.selectedShapes.indexOf(F)>=0);
if(G){this.removeShapeFromRollovers(F,null,true)
}if(E>=0){F.onUnSelect();
this.selectedShapes.splice(E,1)
}}}.createDelegate(this),true);
B.setVisible(A);
if(D){this.drawImage()
}}},hideAllShapeSets:function(C){for(var A in this.shapeSets){var B=this.shapeSets[A];
if(B.isVisible){this.setShapeSetVisible(A,false,false)
}}if(C){this.drawImage()
}},scheduleForDragging:function(A){this.scheduledDragShapes.push(A)
},createCanvas:function(E,C,A){var B;
CQ.Log.debug("SmartImage.Image#createCanvas: Started.");
B=document.createElement("canvas");
E.appendChild(B);
if(B){if(C){B.width=C
}if(A){B.height=A
}if(CQ.Ext.isIE){try{B=G_vmlCanvasManager.initElement(B)
}catch(D){B=null
}if(!B){CQ.Log.fatal("SmartImage.Image#createCanvas: Could not create Canvas emulation for Internet Explorer.")
}}}CQ.Log.debug("SmartImage.Image#createCanvas:Finished; creating canvas "+(B?"was successful":"failed")+".");
return B
},disablePanelTemporaryily:function(){if(!this.workingAreaSize&&this.scrollerDiv){this.calculateWorkingAreaSize()
}if(this.imageCanvas&&this.workingAreaSize){var B=this.imageCanvas.getContext("2d");
B.save();
B.globalCompositeOperation="source-over";
var C=this.workingAreaSize.width;
var A=this.workingAreaSize.height;
if(CQ.Ext.isIE){B.clearRect()
}else{B.clearRect(0,0,C,A)
}B.restore()
}},drawImage:function(){var N=this.getActualRotation();
var V=this.imageCanvas.getContext("2d");
V.save();
V.globalCompositeOperation="source-over";
var Y=this.workingAreaSize.width;
var E=this.workingAreaSize.height;
var H=Math.floor(Y/2);
var F=Math.floor(E/2);
V.translate(H,F);
V.rotate((N*Math.PI)/180);
var Q=0,D=0;
var C=0,g=0;
var S=0,B=0;
var M=Y;
var W=this.zoomedImageSize.displayWidth-Y-this.internalPadding.width;
var d=this.zoomedImageSize.displayHeight-E-this.internalPadding.height;
if(Y>=this.zoomedImageSize.displayWidth){M=this.zoomedImageSize.width;
Q=Math.round((Y-M)/2)
}else{C=(this.internalOffset.x<this.internalPadding.width?this.internalPadding.width-this.internalOffset.x:0);
if(this.internalOffset.x>W){g=this.internalOffset.x-W
}M-=C+g
}var K=E;
if(E>=this.zoomedImageSize.displayHeight){K=this.zoomedImageSize.height;
D=Math.round((E-K)/2)
}else{S=(this.internalOffset.y<this.internalPadding.height?this.internalPadding.height-this.internalOffset.y:0);
if(this.internalOffset.y>d){B=this.internalOffset.y-d
}K-=S+B
}this.imageOffsets={x:Q,y:D};
var Z=-H;
var G=-F;
var O=(N==90)||(N==270);
if(CQ.Ext.isIE){V.clearRect()
}else{if(O){V.clearRect(G,Z,E,Y)
}else{V.clearRect(Z,G,Y,E)
}}var c={x:0,y:0};
var I=this.calculateAbsoluteZoom();
var T={x:this.internalOffset.x-this.internalPadding.width,y:this.internalOffset.y-this.internalPadding.height};
if(T.x<0){T.x=0
}if(T.y<0){T.y=0
}var U=this.calculateInverseZoom(I,T);
switch(N){case 90:T.x=this.zoomedImageSize.width-T.x-M;
break;
case 180:T.x=this.zoomedImageSize.width-T.x-M;
T.y=this.zoomedImageSize.height-T.y-K;
break;
case 270:T.y=this.zoomedImageSize.height-T.y-K;
break
}c=this.calculateInverseZoom(I,T);
var X=this.calculateInverseZoom(I,{width:M,height:K});
var A=(O?c.y:c.x);
var m=(O?c.x:c.y);
if(A<0){A=0
}if(m<0){m=0
}var R=(O?X.height:X.width);
var b=(O?X.width:X.height);
if(R>this.originalImageSize.width){R=this.originalImageSize.width
}if(b>this.originalImageSize.height){b=this.originalImageSize.height
}var k,j,L,P;
switch(N){case 0:k=Z+Q+C;
j=G+D+S;
L=M;
P=K;
break;
case 90:k=G+D+S;
j=Z+Q+g;
L=K;
P=M;
break;
case 180:k=Z+Q+g;
j=G+D+B;
L=M;
P=K;
break;
case 270:k=G+D+B;
j=Z+Q+C;
L=K;
P=M;
break
}var J=false;
try{V.drawImage(this.imageToDisplay.image,A,m,R,b,k,j,L,P)
}catch(a){window.setTimeout(this.drawImage.createDelegate(this),1);
J=true
}V.restore();
if(!J){this.drawShapeSets(V,{destX:Q+C,destY:D+S,srcX:U.x,srcY:U.y,imageSize:this.originalImageSize,zoomedSize:this.zoomedImageSize})
}},addShapeToDOM:function(B){if(CQ.Ext.isIE){var A=CQ.Ext.DomHelper.insertBefore(this.scrollerDiv,{tag:"div"},false);
A.style.position="absolute";
A.style.top="0";
A.style.left="0";
var C=this.createCanvas(A,this.workingAreaSize.width,this.workingAreaSize.height);
var D={container:A,canvas:C,shape:B};
if(!this.shapeDefs){this.shapeDefs=new Array()
}this.shapeDefs.push(D);
B.shapeDef=D
}},removeShapeFromDOM:function(C){if(CQ.Ext.isIE){var D=C.shapeDef;
var B=CQ.Ext.get(D.canvas);
var A=CQ.Ext.get(D.container);
B.remove();
A.remove()
}},getCanvasContext:function(){return this.imageCanvas.getContext("2d")
}});
CQ.form.SmartImage.Tool=CQ.Ext.extend(CQ.Ext.emptyFn,{toolId:null,toolName:null,transferFieldName:null,transferField:null,isCommandTool:false,userInterface:null,imageComponent:null,buttonComponent:null,constructor:function(A){A=A||{};
CQ.Ext.apply(this,A)
},initialize:function(A){},initComponent:function(A){this.imageComponent=A
},onActivation:function(){},onDeactivation:function(){},onCommand:function(){},onImageUploaded:function(A){},onImageFlushed:function(){this.resetToolValue()
},createTransferField:function(A){this.transferField=new CQ.Ext.form.Hidden({name:this.transferFieldName});
A.add(this.transferField)
},transferToField:function(){var A=this.serialize();
if(A==null){A=this.initialValue
}this.transferField.setValue(A)
},resetToolValue:function(){this.transferField.setValue("")
},processRecord:function(A){this.initialValue=A.get(this.transferFieldName);
if(this.initialValue==null){this.initialValue=""
}},serialize:function(){return null
},deserialize:function(A){},isEnabled:function(){return true
}});
CQ.form.SmartImage.Tool.UserInterface=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){var B={title:CQ.I18n.getMessage("Tool options"),floating:true,draggable:{insertProxy:false,onDrag:function(E){var D=this.proxy.getEl();
this.x=D.getLeft(true);
this.y=D.getTop(true);
var C=this.panel.getEl().shadow;
if(C){C.realign(this.x,this.y,D.getWidth(),D.getHeight())
}},endDrag:function(C){this.panel.setPosition(this.x,this.y)
}},collapsible:true,renderTo:CQ.Util.ROOT_ID,width:400,hidden:true,stateful:false};
CQ.Util.applyDefaults(A,B);
if(!A.items&&!A.tbar&&!A.bbar){A.html="No tools available"
}CQ.form.SmartImage.Tool.UserInterface.superclass.constructor.call(this,A)
},setPosition:function(A,B){CQ.form.SmartImage.Tool.UserInterface.superclass.setPosition.call(this,A,B);
this.saveX=this.x;
this.saveY=this.y
}});
CQ.form.SmartImage.Tool.Rotate=CQ.Ext.extend(CQ.form.SmartImage.Tool,{preRotation:0,constructor:function(A){CQ.form.SmartImage.Tool.Rotate.superclass.constructor.call(this,{toolId:"smartimageRotate",toolName:CQ.I18n.getMessage("Rotate"),iconCls:"cq-image-icon-rotate",isCommandTool:true,userInterface:null,transferFieldName:A})
},onCommand:function(){var C=this.imageComponent.getImagePanel();
var B=new CQ.form.SmartImage.Animation({imageComponent:this.imageComponent,onFinished:this.executeRotate.createDelegate(this)});
var A=0;
if(C.zoom>0){A=200;
B.addStep(new CQ.form.SmartImage.Animation.ZoomOut({durationMs:300,startZoom:C.zoom,endZoom:0}))
}B.addStep(new CQ.form.SmartImage.Animation.ExecuteFn({durationMs:A,fn:function(){C.switchToDefaultView();
var I=C.rotation;
var K=(I==90)||(I==270);
var E={width:(K?C.zoomedImageSize.height:C.zoomedImageSize.width),height:(K?C.zoomedImageSize.width:C.zoomedImageSize.height)};
var G=I+90;
var J=C.precalculateRotatedSize(G);
var H=(G==90)||(G==270);
if(H){var F=J;
J={width:F.height,height:F.width}
}var D=C.imageToDisplay;
B.addStep(new CQ.form.SmartImage.Animation.Rotation({image:D,durationMs:300,startAngle:I,endAngle:I+90,startSize:E,endSize:J}))
}}));
B.play()
},executeRotate:function(){var B=this.imageComponent.getImagePanel();
B.setRotation(Math.round(B.rotation+90)%360);
var A={changeType:"rotate",newValue:B.rotation,valueDelta:90};
B.fireEvent("contentchange",A);
B.fireEvent("smartimage.contentchange",A)
},onImageFlushed:function(){var A=this.imageComponent.getImagePanel();
A.setRotation(0);
this.preRotation=0;
CQ.form.SmartImage.Tool.Rotate.superclass.onImageFlushed.call(this)
},processRecord:function(A){CQ.form.SmartImage.Tool.Rotate.superclass.processRecord.call(this,A);
this.deserialize(this.initialValue)
},serialize:function(){var A=this.imageComponent.getImagePanel();
return(Math.round(A.rotation)+this.preRotation)%360
},deserialize:function(D){var C=this.imageComponent.getImagePanel();
if(D&&(D.length>0)){var A=0;
try{A=parseInt(D)
}catch(B){}this.preRotation=A
}else{this.preRotation=0
}C.rotation=0
}});
CQ.form.SmartImage.Shape=CQ.Ext.extend(CQ.Ext.emptyFn,{calculateDistance:function(B,A){return Math.sqrt(Math.pow(B.x-A.x,2)+Math.pow(B.y-A.y,2))
},calculateDisplayCoords:function(C,B,A,D){if(typeof (A)=="object"){D=A.y;
A=A.x
}A=Math.round((A-B.srcX)*C)+B.destX;
D=Math.round((D-B.srcY)*C)+B.destY;
return{x:A,y:D}
},calculateDisplaySize:function(C,B,A){if(typeof (B)=="object"){A=B.height;
B=B.width
}B=Math.round(B*C);
A=Math.round(A*C);
return{width:B,height:A}
},onRollOver:function(A){return false
},onRollOut:function(A){return false
},onRolledOver:function(A){return false
},onSelect:function(){return false
},onUnSelect:function(){return false
},onClick:function(){return false
},isDirectlyDraggable:function(B,A){return false
},isDeferredDraggable:function(B,A){return false
},moveShapeBy:function(C,A,B){return false
},onDragStart:function(B,A){return false
},onDragEnd:function(B,A){return false
},onDrag:function(B,A){return false
},onAddForDrag:function(A){},isTouched:function(B,A){return false
},draw:function(A,C,B){}});
CQ.form.SmartImage.ShapeSet=CQ.Ext.extend(CQ.Ext.emptyFn,{id:null,isVisible:false,shapes:null,imageComponent:null,constructor:function(A){this.id=A;
this.isVisible=true;
this.shapes=new Array()
},addShape:function(A){this.shapes.push(A);
if(this.imageComponent){this.imageComponent.addShapeToDOM(A);
this.imageComponent.drawImage()
}},removeShape:function(A){var B=this.getShapeIndex(A);
if(B>=0){this.shapes.splice(B,1);
if(this.imageComponent){this.imageComponent.removeShapeFromDOM(A);
this.imageComponent.drawImage()
}}},removeAllShapes:function(){var B=this.shapes.length;
for(var A=B-1;
A>=0;
A--){this.removeShape(this.shapes[A])
}},getShapeIndex:function(A){var D=this.shapes.length;
for(var B=0;
B<D;
B++){var C=this.shapes[B];
if(C==A){return B
}}return -1
},getShapeCount:function(){return this.shapes.length
},getShapeAt:function(A){return this.shapes[A]
},setVisible:function(A){this.isVisible=A;
if(CQ.Ext.isIE){this.executeFnOnShapes(function(C){var D=C.shapeDef.canvas;
var B=D.getContext("2d");
B.clearRect()
})
}},drawShapes:function(A,E,D){var F=this.shapes.length;
for(var C=0;
C<F;
C++){var B=this.shapes[C];
if(CQ.Ext.isIE){A=B.shapeDef.canvas.getContext("2d");
A.clearRect()
}A.save();
if(CQ.themes.SmartImage.DEFAULT_DRAWING_MODE!=null){A.globalCompositeOperation=CQ.themes.SmartImage.DEFAULT_DRAWING_MODE
}B.draw(A,E,D);
A.restore()
}},executeFnOnShapes:function(B){var C=this.shapes.length;
for(var A=0;
A<C;
A++){var D=this.shapes[A];
B(D)
}}});
CQ.form.SmartImage.Animation=CQ.Ext.extend(CQ.Ext.emptyFn,{imageComponent:null,onFinished:null,steps:null,stepPlayed:null,stepStartTc:null,constructor:function(A){A=A||{};
var B={};
CQ.Ext.apply(this,A,B);
this.steps=[];
this.stepPlayed=null
},addStep:function(A){this.steps.push(A)
},isPlayed:function(){return this.stepPlayed!=null
},play:function(){this.stepPlayed=0;
this.stepStartTc=new Date().getTime();
this.playTick()
},playTick:function(){var C=new Date().getTime();
if(this.stepPlayed<this.steps.length){var B=this.steps[this.stepPlayed];
var A=C-this.stepStartTc;
var D=1;
if(B.durationMs>0){D=A/B.durationMs
}if(D>=1){D=1;
this.stepPlayed++;
this.stepStartTc=C
}B.tick(this.imageComponent,D);
window.setTimeout(this.playTick.createDelegate(this),10)
}else{this.stepPlayed=null;
if(this.onFinished){this.onFinished(this)
}}}});
CQ.form.SmartImage.Animation.Step=CQ.Ext.extend(CQ.Ext.emptyFn,{durationMs:0,constructor:function(A){A=A||{};
var B={durationMs:500};
CQ.Ext.apply(this,A,B)
},tick:function(B,A){}});
CQ.form.SmartImage.Animation.Rotation=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{startAngle:null,startSize:null,endAngle:null,endSize:null,image:null,deltaAngle:null,deltaSize:null,constructor:function(A){CQ.form.SmartImage.Animation.Rotation.superclass.constructor.call(this,A);
this.deltaAngle=this.endAngle-this.startAngle;
this.deltaSize={width:this.endSize.width-this.startSize.width,height:this.endSize.height-this.startSize.height}
},tick:function(D,K){var J=D.getImagePanel();
var A=this.startAngle+(K*this.deltaAngle);
var F={width:this.startSize.width+(K*this.deltaSize.width),height:this.startSize.height+(K*this.deltaSize.height)};
var M=J.getCanvasContext();
M.save();
var C=J.imageCanvas.width;
var I=J.imageCanvas.height;
M.clearRect(0,0,C,I);
var L=J.workingAreaSize;
var G=Math.floor(L.width/2);
var E=Math.floor(L.height/2);
M.translate(G,E);
M.rotate((A*Math.PI)/180);
var H=-(F.width/2);
var B=-(F.height/2);
M.drawImage(this.image.image,H,B,F.width,F.height);
M.restore()
}});
CQ.form.SmartImage.Animation.ZoomOut=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{startZoom:null,endZoom:null,deltaZoom:null,constructor:function(A){CQ.form.SmartImage.Animation.ZoomOut.superclass.constructor.call(this,A);
this.deltaZoom=this.endZoom-this.startZoom
},tick:function(B,A){var D=B.getImagePanel();
var C=this.startZoom+(A*this.deltaZoom);
D.setZoom(C);
if(A==1){B.resetZoomSlider()
}}});
CQ.form.SmartImage.Animation.ExecuteFn=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{fn:null,scopr:null,constructor:function(A){A=A||{};
var B={durationMs:0};
A=CQ.Util.applyDefaults(A,B);
CQ.form.SmartImage.Animation.ExecuteFn.superclass.constructor.call(this,A);
this.deltaZoom=this.endZoom-this.startZoom
},tick:function(B,A){if(this.fn!=null){if(this.scope){this.fn.call(this.scope)
}else{this.fn()
}this.fn=null
}}});
CQ.form.ImageMap=CQ.Ext.extend(CQ.form.SmartImage.Tool,{isInitialized:false,isLoading:false,constructor:function(A){CQ.form.ImageMap.superclass.constructor.call(this,{toolId:"smartimageMap",toolName:CQ.I18n.getMessage("Map"),iconCls:"cq-image-icon-map",isCommandTool:false,userInterface:new CQ.form.ImageMap.UI({title:CQ.I18n.getMessage("Image map tools")}),transferFieldName:A})
},initComponent:function(A){CQ.form.ImageMap.superclass.initComponent.call(this,A);
this.workingArea=this.imageComponent.getImagePanel();
this.workingArea.on("contentchange",this.onContentChange,this);
this.imageComponent.on("beforeloadimage",function(){this.isLoading=true;
if(this.buttonComponent!=null){this.buttonComponent.setTooltip(null)
}},this);
this.imageComponent.on("loadimage",function(){this.isLoading=false;
this.adjustButtonToState()
},this);
this.imageComponent.on("imagestate",function(){if(!this.isLoading){this.adjustButtonToState()
}},this)
},onActivation:function(){CQ.form.ImageMap.superclass.onActivation.call(this);
if(!this.isInitialized){if(this.mapShapeSet==null){this.mapShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageMap.SHAPESET_ID);
this.workingArea.addShapeSet(this.mapShapeSet)
}this.userInterface.notifyWorkingArea(this.workingArea,this.mapShapeSet);
this.isInitialized=true
}this.workingArea.hideAllShapeSets(false);
if(this.initialValue!=null){this.deserialize(this.initialValue);
this.initialValue=null
}this.userInterface.isActive=true;
this.workingArea.setShapeSetVisible(CQ.form.ImageMap.SHAPESET_ID,true,true)
},onDeactivation:function(){this.workingArea.clearSelection();
this.userInterface.isActive=false;
this.workingArea.setShapeSetVisible(CQ.form.ImageMap.SHAPESET_ID,false,false);
CQ.form.ImageMap.superclass.onDeactivation.call(this)
},clearMappingInformation:function(){if(this.mapShapeSet){try{this.workingArea.clearSelection();
this.mapShapeSet.removeAllShapes()
}catch(A){}}this.initialValue=null
},onImageUploaded:function(){this.clearMappingInformation();
CQ.form.ImageMap.superclass.onImageUploaded.call(this)
},onImageFlushed:function(){this.clearMappingInformation();
CQ.form.ImageMap.superclass.onImageFlushed.call(this)
},onContentChange:function(G){if(G.changeType=="rotate"){var F=this.workingArea.originalImageSize;
if(this.mapShapeSet==null){this.mapShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageMap.SHAPESET_ID);
this.mapShapeSet.isVisible=false;
this.workingArea.addShapeSet(this.mapShapeSet);
if(this.initialValue){this.deserialize(this.initialValue);
this.initialValue=null
}}var C=parseInt(G.valueDelta);
var A=parseInt(G.newValue);
if(C!=0){var E=this.mapShapeSet.getShapeCount();
for(var B=0;
B<E;
B++){var D=this.mapShapeSet.getShapeAt(B);
D.rotateBy(C,A,F)
}this.workingArea.drawImage()
}}},transferToField:function(){if(this.userInterface){this.userInterface.saveDestinationArea()
}CQ.form.ImageMap.superclass.transferToField.call(this)
},serialize:function(){if(!this.isInitialized){return null
}if(this.mapShapeSet==null){return""
}var D="";
var C=this.mapShapeSet.getShapeCount();
for(var A=0;
A<C;
A++){var B=this.mapShapeSet.getShapeAt(A);
D+="["+B.serialize()+"]"
}return D
},deserialize:function(C){this.mapShapeSet.removeAllShapes();
if(C&&(C.length>0)){var D=0;
while(D<C.length){var B=C.indexOf("[",D);
if(B<0){break
}var A=C.indexOf(")",B+1);
if(A<0){break
}var G=C.substring(B+1,A+1);
var F=null;
if(CQ.form.ImageMap.RectArea.isStringRepresentation(G)){F=CQ.form.ImageMap.RectArea.deserialize(G)
}else{if(CQ.form.ImageMap.PolyArea.isStringRepresentation(G)){F=CQ.form.ImageMap.PolyArea.deserialize(G)
}else{if(CQ.form.ImageMap.CircularArea.isStringRepresentation(G)){F=CQ.form.ImageMap.CircularArea.deserialize(G)
}}}if(F!=null){var E=D;
D=F.destination.deserialize(C,A+1);
this.mapShapeSet.addShape(F);
if(D==null){CQ.Log.error("CQ.form.ImageMap#deserialize: Invalid map definition: "+C+"; trying to continue parsing.");
D=C.indexOf("]",E)+1
}}else{CQ.Log.error("CQ.form.ImageMap#deserialize: Invalid area definition string: "+G);
D=C.indexOf("]",D)+1
}}}},isEnabled:function(){return this.imageComponent.usesProcessedImage()
},adjustButtonToState:function(){var A=this.isEnabled()&&(!this.imageComponent.editLock||this.imageComponent.editLockDisabled);
this.buttonComponent.setDisabled(!A);
this.buttonComponent.setTooltip(A?null:CQ.I18n.getMessage("This action will become available once the image has been saved for the first time."))
}});
CQ.form.ImageMap.SHAPESET_ID="smartimage.imagemap";
CQ.form.ImageMap.EDITMODE_ADD=0;
CQ.form.ImageMap.EDITMODE_EDIT=1;
CQ.form.ImageMap.AREATYPE_RECT=0;
CQ.form.ImageMap.AREATYPE_CIRCLE=1;
CQ.form.ImageMap.AREATYPE_POLYGON=2;
CQ.form.ImageMap.AREATYPE_POINT=3;
CQ.form.ImageMap.EVENT_PREFIX="imagemap.";
CQ.form.ImageMap.EVENT_MODE_CHANGE=CQ.form.ImageMap.EVENT_PREFIX+"modechange";
CQ.form.ImageMap.EVENT_VISUAL_CHANGE=CQ.form.ImageMap.EVENT_PREFIX+"visualchange";
CQ.form.ImageMap.UI=CQ.Ext.extend(CQ.form.SmartImage.Tool.UserInterface,{isActive:false,workingArea:null,editMode:null,areaType:null,polyAreaAdded:null,mapShapeSet:null,constructor:function(A){var D=function(E){this.toolClicked(E.itemId)
}.createDelegate(this);
this.toolbarButtons={addRect:new CQ.Ext.Toolbar.Button({itemId:"addRect",text:CQ.I18n.getMessage("Rectangle"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:D}),addCircle:new CQ.Ext.Toolbar.Button({itemId:"addCircle",text:CQ.I18n.getMessage("Circle"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:D}),addPoly:new CQ.Ext.Toolbar.Button({itemId:"addPoly",text:CQ.I18n.getMessage("Polygon"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:D}),editPolyPoint:new CQ.Ext.Toolbar.Button({itemId:"editPolyPoint",xtype:"tbbutton",text:CQ.I18n.getMessage("Polygon point"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:D}),edit:new CQ.Ext.Toolbar.Button({itemId:"edit",text:CQ.I18n.getMessage("Edit"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:D})};
var B=new CQ.Ext.Toolbar({xtype:"toolbar",items:[CQ.I18n.getMessage("Add")+":",this.toolbarButtons.addRect,this.toolbarButtons.addCircle,this.toolbarButtons.addPoly,this.toolbarButtons.editPolyPoint,{xtype:"tbseparator"},this.toolbarButtons.edit,{xtype:"tbseparator"},{itemId:"delete",xtype:"tbbutton",text:CQ.I18n.getMessage("Delete"),handler:function(){this.deleteSelection()
}.createDelegate(this)}]});
var C={layout:"column",bodyStyle:"padding-top: 1px; padding-bottom: 1px; padding-left: 3px; padding-right: 2px;",width:CQ.themes.SmartImage.Tool.MAP_TOOLS_WIDTH,tbar:B,items:[{itemId:"col1",xtype:"panel",layout:"form",border:false,columnWidth:0.5,labelWidth:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_LABEL_WIDTH,defaults:{itemCls:"cq-map-areaeditor-fieldlabel",cls:"cq-map-areaeditor-text",fieldClass:"cq-map-areaeditor-text",width:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_FIELD_WIDTH},items:[{itemId:"areaDefUrl",name:"url",xtype:"pathfield",fieldLabel:"HREF",listeners:{dialogopen:{fn:function(){this.__position=this.getPosition();
this.hide()
},scope:this},dialogclose:{fn:function(){this.show();
this.setPosition(this.__position)
},scope:this}}},{itemId:"areaDefTarget",name:"target",xtype:"textfield",fieldLabel:"Target"}]},{itemId:"col2",xtype:"panel",layout:"form",border:false,columnWidth:0.5,labelWidth:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_LABEL_WIDTH,defaults:{itemCls:"cq-map-areaeditor-fieldlabel",cls:"cq-map-areaeditor-text",fieldClass:"cq-map-areaeditor-text",width:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_FIELD_WIDTH},items:[{itemId:"areaDefText",name:"text",xtype:"textfield",fieldLabel:"Text"},{itemId:"areaDefCoords",name:"coords",xtype:"textfield",fieldLabel:"Coordinates"}]}]};
CQ.Util.applyDefaults(A,C);
CQ.form.ImageMap.UI.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.ImageMap.UI.superclass.initComponent.call(this);
this.areaDefUrl=this.items.get("col1").items.get("areaDefUrl");
this.areaDefTarget=this.items.get("col1").items.get("areaDefTarget");
this.areaDefText=this.items.get("col2").items.get("areaDefText");
this.areaDefCoords=this.items.get("col2").items.get("areaDefCoords");
this.areaDefCoords.on("specialkey",function(C,B){var A=this.editedArea;
if((B.getKey()==CQ.Ext.EventObject.ENTER)&&(A!=null)){if(A.fromCoordString(this.areaDefCoords.getValue())){this.workingArea.drawImage()
}this.areaDefCoords.setValue(A.toCoordString())
}},this);
this.setDestinationAreaEditorEnabled(false)
},notifyWorkingArea:function(A,B){this.workingArea=A;
this.mapShapeSet=B;
this.workingArea.on("addrequest",this.onAddRequest,this);
this.workingArea.on("selectionchange",this.onSelectionChange,this);
this.workingArea.on("dragchange",this.onVisualChange,this);
this.workingArea.on("rollover",this.onRollover,this)
},toolClicked:function(A){if(A=="edit"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,null)
}else{if(A=="editPolyPoint"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,CQ.form.ImageMap.AREATYPE_POINT)
}else{if(A=="addRect"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_RECT)
}else{if(A=="addCircle"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_CIRCLE)
}else{if(A=="addPoly"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_POLYGON)
}}}}}},setDestinationAreaEditorEnabled:function(A){this.areaDefUrl.setDisabled(!A);
this.areaDefTarget.setDisabled(!A);
this.areaDefText.setDisabled(!A);
this.areaDefCoords.setDisabled(!A)
},saveDestinationArea:function(C){if(!C){C=this.editedArea
}if(C){var A=this.areaDefUrl.getValue();
if(A.length>0){if(A.charAt(0)!="/"){var B=A.indexOf("://");
if(B<0){if(A.indexOf("mailto:")!=0){A="http://"+A
}}}}C.destination.url=A;
C.destination.target=this.areaDefTarget.getValue();
C.destination.text=this.areaDefText.getValue()
}},loadDestinationArea:function(A){if(A!=null){this.areaDefUrl.setValue(A.destination.url);
this.areaDefTarget.setValue(A.destination.target);
this.areaDefText.setValue(A.destination.text);
this.areaDefCoords.setValue(A.toCoordString())
}else{this.areaDefUrl.setValue("");
this.areaDefTarget.setValue("");
this.areaDefText.setValue("");
this.areaDefCoords.setValue("")
}},switchEditMode:function(B,A){this.editMode=B;
this.areaType=A;
this.adjustToolbar();
if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){this.finishPolygonBuilding(false);
this.workingArea.blockRollOver();
this.workingArea.clearSelection();
this.workingArea.drawImage()
}else{if(this.editMode==CQ.form.ImageMap.EDITMODE_EDIT){if(this.areaType!=CQ.form.ImageMap.AREATYPE_POINT){this.finishPolygonBuilding(false)
}this.workingArea.unblockRollOver();
this.workingArea.drawImage()
}}if(!this.polyAreaAdded){this.workingArea.drawImage()
}},adjustToolbar:function(){var A=null;
if(this.editMode==CQ.form.ImageMap.EDITMODE_EDIT){if(this.areaType==CQ.form.ImageMap.AREATYPE_POINT){A="editPolyPoint"
}else{A="edit"
}}else{if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){if(this.areaType==CQ.form.ImageMap.AREATYPE_RECT){A="addRect"
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){A="addPoly"
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_CIRCLE){A="addCircle"
}}}}}for(var B in this.toolbarButtons){if(this.toolbarButtons.hasOwnProperty(B)){var C=this.toolbarButtons[B];
C.suspendEvents();
C.toggle(B==A);
C.resumeEvents()
}}},deleteSelection:function(){var D=false;
var B=this.mapShapeSet.getShapeCount();
for(var A=0;
A<B;
A++){var C=this.mapShapeSet.getShapeAt(A);
if(C.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){if(C.selectedHandle!=null){C.removePoint(C.selectedHandle);
D=true
}}}if(!D){this.workingArea.deleteSelectedShapes()
}else{this.workingArea.drawImage()
}},finishPolygonBuilding:function(A){if(this.polyAreaAdded){this.polyAreaAdded.isSelected=false;
this.polyAreaAdded.selectedHandle=null;
if(A){this.workingArea.drawImage()
}}this.polyAreaAdded=null
},onAddRequest:function(H){if(this.isActive){H=H.unzoomed;
if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){var C;
if(this.areaType==CQ.form.ImageMap.AREATYPE_RECT){C=new CQ.form.ImageMap.RectArea({},H.y,H.x,H.y+1,H.x+1)
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_CIRCLE){C=new CQ.form.ImageMap.CircularArea({},H.x,H.y,1)
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){C=new CQ.form.ImageMap.PolyArea({},H.x,H.y);
C.selectPointAt(0);
this.polyAreaAdded=C
}}}if(C){this.workingArea.selectShape(C);
this.mapShapeSet.addShape(C);
this.workingArea.scheduleForDragging(C)
}}else{if((this.editMode==CQ.form.ImageMap.EDITMODE_EDIT)&&(this.areaType==CQ.form.ImageMap.AREATYPE_POINT)){var E;
if(this.polyAreaAdded){E=[this.polyAreaAdded]
}else{E=this.workingArea.getRolledOverShapes()
}var J;
var D=false;
var G=false;
var F=this.workingArea.getTolerance();
E=this.filterOnAreaType(E,CQ.form.ImageMap.AREATYPE_POLYGON);
if(E.length>0){var A=E.length;
for(var I=0;
I<A;
I++){var B=E[I];
if(B.handleId==null){J=B.insertPoint(H.x,H.y,F);
if(J!=null){B.handleId=J;
B.selectPoint(J);
D=true
}}else{G=true
}}}if(!D&&this.polyAreaAdded&&!G){J=this.polyAreaAdded.addPoint(H.x,H.y);
if(J!=null){this.polyAreaAdded.selectPoint(J)
}}this.workingArea.drawImage()
}}}},onSelectionChange:function(D){if(this.isActive){var C="ImageMap#onSelectionChange: Received selection change for areas: ";
if(D.length>0){var A=D.length;
for(var B=0;
B<A;
B++){if(B>0){C+=", "
}C+=D[B].serialize()
}}else{C+="None"
}CQ.Log.debug(C);
if(this.editedArea!=null){this.saveDestinationArea(this.editedArea)
}if(D.length==1){this.editedArea=D[0];
this.loadDestinationArea(this.editedArea);
this.setDestinationAreaEditorEnabled(true)
}else{this.editedArea=null;
this.loadDestinationArea(null);
this.setDestinationAreaEditorEnabled(false)
}}},onVisualChange:function(B,D){if(this.isActive){var C=B.length;
var F;
var E=false;
for(var A=0;
A<C;
A++){if(B[A]==this.editedArea){F=this.editedArea.toCoordString();
this.areaDefCoords.setValue(F);
E=true;
break
}}if(!E&&(B.length==1)){F=B[0].toCoordString();
this.areaDefCoords.setValue(F)
}if(D&&((this.editMode==CQ.form.ImageMap.EDITMODE_ADD)&&(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON))){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,CQ.form.ImageMap.AREATYPE_POINT)
}}},onRollover:function(C){if(this.isActive){var D="ImageMap#onRollover: Received rollover for areas: ";
if(C.length>0){var B=C.length;
for(var A=0;
A<B;
A++){if(A>0){D+=", "
}D+=C[A].serialize()
}}else{D+="None"
}CQ.Log.debug(D);
if(this.editedArea==null){if(C.length==1){this.loadDestinationArea(C[0])
}else{this.loadDestinationArea(null)
}}}},filterOnAreaType:function(D,A){var F=new Array();
var C=D.length;
for(var B=0;
B<C;
B++){var E=D[B];
if(E.areaType==A){F.push(E)
}}return F
}});
CQ.form.ImageMap.Helpers=function(){return{checkIntersection:function(B,A){if(A<0){return(B>A)&&(B<=0)
}else{return(B>=0)&&(B<A)
}},calculateNoAngledDistance:function(D,C,B){var E=Math.abs(D);
var A=C-B;
if(B<0){if(C>0){E=Math.sqrt(Math.pow(C,2)+Math.pow(D,2))
}else{if(C<B){E=Math.sqrt(Math.pow(A,2)+Math.pow(D,2))
}}}else{if(C<0){E=Math.sqrt(Math.pow(C,2)+Math.pow(D,2))
}else{if(C>B){E=Math.sqrt(Math.pow(A,2)+Math.pow(D,2))
}}}return E
},calculateDistance:function(K,F,P){var A=K.x;
var O=K.y;
var G=F.x-A;
var C=F.y-O;
var N=P.x-A;
var J=P.y-O;
if((Math.abs(G)>0)&&(Math.abs(C)>0)){var M=C/G;
var H=1/M;
var E=(N*H+J)/(M+H);
var B=E*M;
var L=CQ.form.ImageMap.Helpers.checkIntersection(E,G)&&CQ.form.ImageMap.Helpers.checkIntersection(B,C);
if(L){return Math.sqrt(Math.pow(E-N,2)+Math.pow(J-B,2))
}else{var D=Math.sqrt(Math.pow(N,2)+Math.pow(J,2));
var I=Math.sqrt(Math.pow(N-G,2)+Math.pow(J-C,2));
return(D<I?D:I)
}}else{if((G==0)&&(C==0)){return Math.sqrt(Math.pow(N,2),Math.pow(J,2))
}else{if(G==0){return CQ.form.ImageMap.Helpers.calculateNoAngledDistance(N,J,C)
}else{return CQ.form.ImageMap.Helpers.calculateNoAngledDistance(J,N,G)
}}}},calculateDistanceToCircle:function(G,J){var D=J.x-G.x;
var B=J.y-G.y;
var F=B/D;
if((D!=0)&&(B!=0)){var A=Math.atan(F);
var E=Math.cos(A)*G.radius;
var C=Math.sin(A)*G.radius;
if(D<0){C=-C;
E=-E
}var I=E-D;
var H=C-B;
return Math.sqrt(Math.pow(I,2)+Math.pow(H,2))
}else{return Math.abs(B-G.radius)
}},compactArray:function(D){var C=D.length;
var A=0;
for(var B=0;
B<C;
B++){if(D[B]!=null){if(B!=A){D[A]=D[B]
}A++
}}D.length=A
},encodeString:function(G){var B=G.length;
var E="";
var D=0;
for(var F=0;
F<B;
F++){var A=G.charAt(F);
var C=null;
switch(A){case"\\":C="\\\\";
break;
case'"':C='\\"';
break;
case"[":C="\\[";
break;
case"]":C="\\]";
break;
case"|":C="\\|";
break
}if(C!=null){if(D<F){E+=G.substring(D,F)
}E+=C;
D=F+1
}}if(D<B){E+=G.substring(D,B)
}return E
},decodeFromContainingString:function(E,A){var C=E.indexOf('"',A);
if(C<0){return null
}var D=false;
var F=C+1;
var G="";
var B=false;
while(!D){var H=E.charAt(F);
if((H=='"')&&(!B)){D=true
}else{if(H=="\\"){if(B){G+="\\";
B=false
}else{B=true
}}else{if(B){G+=H;
B=false
}else{G+=H
}}}F++;
if((F>=E.length)&&(!D)){return null
}}return{decoded:G,nextPos:F}
},parseCoordinateFromContainingString:function(D,P){var B=D.length;
var O=P;
while(O<B){var J=D.charAt(O);
if(J!=" "){break
}O++
}if(O>=B){return null
}var Q=new Object();
Q.isError=false;
if(D.charAt(O)=="("){var I=D.indexOf(")",O+1);
if(I<0){Q.isError=true;
return Q
}var H=D.substring(O+1,I);
var G=H.split("/");
if(G.length!=2){Q.isError=true;
return Q
}var F=parseInt(G[0]);
var E=parseInt(G[1]);
if(isNaN(F)||isNaN(E)){Q.isError=true;
return Q
}Q.coordinates={x:F,y:E};
Q.isCoordinatesPair=true;
O=I+1
}else{var A=D.indexOf(":",O);
if(A<(O+1)){Q.isError=true;
return Q
}var L=D.substring(O,A);
var N=D.indexOf(" ",A+1);
var M=D.indexOf("(",A+1);
var K;
if((N>=0)&&(M>=0)){if(N<M){K=D.substring(A+1,N);
O=N
}else{K=D.substring(A+1,M);
O=M
}}else{if(N>=0){K=D.substring(A+1,N);
O=N
}else{if(M>=0){K=D.substring(A+1,M);
O=M
}else{if((A+1)>=D.length){Q.isError=true;
return Q
}K=D.substring(A+1,D.length);
O=D.length
}}}if(L=="r"){var C=parseInt(K);
if(isNaN(C)){Q.isError=true;
return Q
}Q.coordinates={radius:C};
Q.isCoordinatesPair=false
}else{Q.isError=true;
return Q
}}Q.nextPos=O;
return Q
},parseCoordinateString:function(C){var B=new Array();
var A=0;
var E=0;
while(A>=0){var D=CQ.form.ImageMap.Helpers.parseCoordinateFromContainingString(C,A);
if(D!=null){if(D.isError){return null
}B[B.length]=D.coordinates;
if(D.isCoordinatesPair){E++
}A=D.nextPos
}else{A=-1
}}return{coordinates:B,coordinatesPairCnt:E}
},parseRectDef:function(F){var E=null;
var C=F.indexOf("(");
if(C>=0){var B=F.indexOf(")",C+1);
if(B>C){var D=F.substring(C+1,B);
var A=D.split(" ");
if(A.length==4){E=new Object();
E.top=A[0];
E.left=A[3];
E.bottom=A[2];
E.right=A[1]
}}}return E
}}
}();
CQ.form.ImageMap.AreaDestination=CQ.Ext.extend(CQ.Ext.emptyFn,{url:null,target:null,text:null,constructor:function(A,B,C){this.url=(A?A:"");
this.target=(B?B:"");
this.text=(C?C:"")
},serialize:function(){var A="";
if(this.url&&(this.url.length>0)){A+='"'+CQ.form.ImageMap.Helpers.encodeString(this.url)+'"'
}A+="|";
if(this.target&&(this.target.length>0)){A+='"'+CQ.form.ImageMap.Helpers.encodeString(this.target)+'"'
}A+="|";
if(this.text&&(this.text.length>0)){A+='"'+CQ.form.ImageMap.Helpers.encodeString(this.text)+'"'
}return A
},deserialize:function(D,B){var C=B;
var E,A;
if(C<D.length){A=D.charAt(C);
if(A!="|"){E=CQ.form.ImageMap.Helpers.decodeFromContainingString(D,C);
if(E==null){return null
}else{this.url=E.decoded;
C=E.nextPos
}}C++
}if(C<D.length){A=D.charAt(C);
if(A!="|"){E=CQ.form.ImageMap.Helpers.decodeFromContainingString(D,C);
if(E==null){return null
}else{this.target=E.decoded;
C=E.nextPos
}}C++
}if(C<D.length){A=D.charAt(C);
if(A!="]"){E=CQ.form.ImageMap.Helpers.decodeFromContainingString(D,C);
if(E==null){return null
}else{this.text=E.decoded;
C=E.nextPos
}}}return C+1
}});
CQ.form.ImageMap.Area=CQ.Ext.extend(CQ.form.SmartImage.Shape,{areaType:null,destination:null,fillColor:null,shadowColor:null,basicShapeColor:null,rolloverColor:null,selectedColor:null,handleSize:0,handleColor:null,handleRolloverColor:null,handleSelectedColor:null,isRollOver:false,isSelected:false,isHandleRolledOver:false,handleId:null,constructor:function(A,B){this.areaType=A;
this.destination=new CQ.form.ImageMap.AreaDestination();
this.handleId=null;
this.isSelected=false;
this.isRollOver=false;
B=B||{};
var C={fillColor:CQ.themes.ImageMap.FILL_COLOR,shadowColor:CQ.themes.ImageMap.SHADOW_COLOR,basicShapeColor:CQ.themes.ImageMap.BASIC_SHAPE_COLOR,rolloverColor:CQ.themes.ImageMap.ROLLOVER_COLOR,selectedColor:CQ.themes.ImageMap.SELECTED_COLOR,handleSize:CQ.themes.ImageMap.HANDLE_SIZE,handleColor:CQ.themes.ImageMap.HANDLE_COLOR,handleRolloverColor:CQ.themes.ImageMap.HANDLE_ROLLOVER_COLOR,handleSelectedColor:CQ.themes.ImageMap.HANDLE_SELECTED_COLOR};
CQ.Ext.apply(this,B,C)
},isPartOfHandle:function(B,A,G){var I=(G.unzoomed.absoluteZoom+1);
var E=Math.ceil(this.handleSize/I);
var D=B-E;
var C=B+E;
var H=A-E;
var F=A+E;
G=G.unzoomedUnclipped;
return((G.x>=D)&&(G.x<=C)&&(G.y>=H)&&(G.y<=F))
},checkAndSetHandle:function(A){this.handleId=this.calculateHandleId(A);
return(this.handleId!=null)
},calcBasicAngle:function(B,C){var A=C-B;
while(A<0){A=360-A
}A=A%360;
return A
},isDirectlyDraggable:function(B,A){return this.checkAndSetHandle(B)
},isDeferredDraggable:function(B,A){return this.isTouched(B,A)
},onRollOver:function(A){this.isRollOver=true;
this.isHandleRolledOver=this.checkAndSetHandle(A);
CQ.Log.debug("CQ.form.ImageMap.Area.onRollOver: rollover detected.");
return true
},onRolledOver:function(B){var A=this.handleId;
this.checkAndSetHandle(B);
return(A!=this.handleId)
},onRollOut:function(){this.isRollOver=false;
this.isHandleRolledOver=false;
this.handleId=null;
CQ.Log.debug("CQ.form.ImageMap.Area.onRollOut: rollout detected.");
return true
},onSelect:function(){this.isSelected=true;
return true
},onUnSelect:function(){this.isSelected=false;
return true
},onDragStart:function(B,A){this.pointToMove=this.handleId;
this.calculateDraggingReference();
return false
},calculateDestCoords:function(F,C,E,D){var B=E.x+F;
var A=E.y+C;
if(D){if(B<0){B=0
}if(B>=D.width){B=D.width-1
}if(A<0){A=0
}if(A>=D.height){A=D.height-1
}}return{x:B,y:A}
},isValid:function(A){return false
},calculateHandleId:function(A){return null
},calculateDraggingReference:function(){},rotateBy:function(B,C,A){},getColor:function(){var A=this.basicShapeColor;
if(this.isSelected){A=this.selectedColor
}else{if(this.isRollOver){A=this.rolloverColor
}}return A
},drawHandle:function(A,H,D,C,B){var F=A-this.handleSize;
var E=H-this.handleSize;
var G=this.handleSize*2;
B.lineWidth=1;
B.strokeStyle=this.shadowColor;
B.strokeRect(F+1,E+1,G,G);
if(C){B.strokeStyle=this.handleSelectedColor
}else{if(D){B.strokeStyle=this.handleRolloverColor
}else{B.strokeStyle=this.handleColor
}}B.strokeRect(F,E,G,G)
}});
CQ.form.ImageMap.RectArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(B,E,D,A,C){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_RECT,B);
this.top=E;
this.left=D;
this.bottom=A;
this.right=C
},isTouched:function(I,F){var E=this.calculateHandleId(I);
if(E!=null){return true
}I=I.unzoomedUnclipped;
var H=this.top-F;
var G=this.top+F;
if((I.y>=H)&&(I.y<=G)){if((I.x>=this.left)&&(I.x<=this.right)){return true
}}var D=this.bottom-F;
var B=this.bottom+F;
if((I.y>=D)&&(I.y<=B)){if((I.x>=this.left)&&(I.x<=this.right)){return true
}}var K=this.left-F;
var J=this.left+F;
if((I.x>=K)&&(I.x<=J)){if((I.y>=this.top)&&(I.y<=this.bottom)){return true
}}var C=this.right-F;
var A=this.right+F;
if((I.x>=C)&&(I.x<=A)){if((I.y>=this.top)&&(I.y<=this.bottom)){return true
}}return false
},calculateDraggingReference:function(){if((this.pointToMove=="topleft")||(this.pointToMove==null)){this.draggingReference={x:this.left,y:this.top}
}else{if(this.pointToMove=="topright"){this.draggingReference={x:this.right,y:this.top}
}else{if(this.pointToMove=="bottomleft"){this.draggingReference={x:this.left,y:this.bottom}
}else{if(this.pointToMove=="bottomright"){this.draggingReference={x:this.right,y:this.bottom}
}}}}},moveShapeBy:function(G,B,F){var E=F.unzoomed.rotatedImageSize;
var D=this.calculateDestCoords(G,B,this.draggingReference,E);
if(this.pointToMove==null){var C=this.right-this.left;
this.left=D.x;
this.right=this.left+C;
var A=this.bottom-this.top;
this.top=D.y;
this.bottom=this.top+A;
if(this.right>=E.width){var H=this.right-E.width+1;
this.left-=H;
this.right-=H
}if(this.bottom>=E.height){H=this.bottom-E.height+1;
this.top-=H;
this.bottom-=H
}}else{if(this.pointToMove=="topleft"){this.left=D.x;
this.top=D.y
}else{if(this.pointToMove=="topright"){this.right=D.x;
this.top=D.y
}else{if(this.pointToMove=="bottomleft"){this.left=D.x;
this.bottom=D.y
}else{if(this.pointToMove=="bottomright"){this.right=D.x;
this.bottom=D.y
}}}}}return true
},onDragEnd:function(){var A;
if(this.top>this.bottom){A=this.top;
this.top=this.bottom;
this.bottom=A
}if(this.left>this.right){A=this.left;
this.left=this.right;
this.right=A
}},calculateHandleId:function(A){if(this.isPartOfHandle(this.left,this.top,A)){return"topleft"
}if(this.isPartOfHandle(this.right,this.top,A)){return"topright"
}if(this.isPartOfHandle(this.left,this.bottom,A)){return"bottomleft"
}if(this.isPartOfHandle(this.right,this.bottom,A)){return"bottomright"
}return null
},isValid:function(){return(this.top!=this.bottom)&&(this.left!=this.right)
},rotateBy:function(D,A,F){var B;
var H;
var I=this.calcBasicAngle(D,A);
var E=((I==90)||(I==270)?F.width:F.height);
var G=Math.round(D/90);
for(var C=0;
C<G;
C++){B=this.top;
H=this.bottom;
this.top=this.left;
this.bottom=this.right;
this.right=E-B;
this.left=E-H
}},onAddForDrag:function(A){this.handleId="bottomright"
},draw:function(J,I,D){CQ.Log.debug("CQ.form.ImageMap.RectArea#draw: Started.");
var A=this.right-this.left;
var G=this.bottom-this.top;
var C=this.left;
var E=this.top;
if(A<0){A=-A;
C=this.right
}else{if(A==0){A=1
}}if(G<0){G=-G;
E=this.bottom
}else{if(G==0){G=1
}}var F=this.calculateDisplayCoords(I,D,C,E);
var K=this.calculateDisplaySize(I,A,G);
var H={x:F.x+K.width,y:F.y+K.height};
if(this.fillColor){J.fillStyle=this.fillColor;
J.fillRect(F.x,F.y,K.width,K.height)
}var B=(this.isRollOver);
if(B){this.drawHandle(F.x,F.y,(this.handleId=="topleft"),false,J);
this.drawHandle(H.x,F.y,(this.handleId=="topright"),false,J);
this.drawHandle(F.x,H.y,(this.handleId=="bottomleft"),false,J);
this.drawHandle(H.x,H.y,(this.handleId=="bottomright"),false,J)
}J.strokeStyle=this.getColor();
J.lineWidth=1;
J.strokeRect(F.x,F.y,K.width,K.height);
CQ.Log.debug("CQ.form.ImageMap.RectArea#draw: Finished.")
},serialize:function(){return"rect("+this.left+","+this.top+","+this.right+","+this.bottom+")"+this.destination.serialize()
},toCoordString:function(){return"("+this.left+"/"+this.top+") ("+this.right+"/"+this.bottom+")"
},fromCoordString:function(F){var D=CQ.form.ImageMap.Helpers.parseCoordinateString(F);
if(D==null){return false
}var G=D.coordinates;
if((G.length!=2)||(D.coordinatesPairCnt!=2)){return false
}var B=G[0].x;
var E=G[0].y;
var A=G[1].x;
var C=G[1].y;
if(B==A){return false
}if(E==C){return false
}if(B<A){this.left=B;
this.right=A
}else{this.left=A;
this.right=B
}if(E<C){this.top=E;
this.bottom=C
}else{this.top=C;
this.bottom=E
}return true
}});
CQ.form.ImageMap.RectArea.isStringRepresentation=function(D){var B=D.length;
if(B<13){return false
}var A=D.indexOf("(");
if(A<=0){return false
}var C=D.substring(0,A);
if(C!="rect"){return false
}if(!D.charAt(B)==")"){return false
}return true
};
CQ.form.ImageMap.RectArea.deserialize=function(C){var H=C.indexOf("(");
if(H<0){return null
}var E=C.indexOf(")",H+1);
if(E<0){return null
}var A=C.substring(H+1,E);
var G;
var I=A.split(",");
if(I.length!=4){return null
}var B=new Array();
var F=I.length;
for(G=0;
G<F;
G++){var D=parseInt(I[G]);
if(isNaN(D)){return null
}B[G]=D
}return new CQ.form.ImageMap.RectArea({},B[1],B[0],B[3],B[2])
};
CQ.form.ImageMap.CircularArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(C,B,D,A){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_CIRCLE,C);
this.x=B;
this.y=D;
this.radius=A;
this.handlePosition={x:B+A,y:D}
},isTouched:function(C,B){var A=this.calculateHandleId(C);
if(A!=null){return true
}C=C.unzoomedUnclipped;
var D=CQ.form.ImageMap.Helpers.calculateDistanceToCircle(this,C);
return(D<=B)
},calculateDraggingReference:function(){if(this.pointToMove==null){this.draggingReference={x:this.x,y:this.y}
}else{this.draggingReference={x:this.pointToMove.x,y:this.pointToMove.y}
}},moveShapeBy:function(J,H,M){var K=M.unzoomed.rotatedImageSize;
var A=this.calculateDestCoords(J,H,this.draggingReference,K);
if(this.pointToMove==null){var C=this.handlePosition.x-this.x;
var B=this.handlePosition.y-this.y;
this.x=A.x;
this.y=A.y;
if(this.x<this.radius){this.x=this.radius
}if(this.y<this.radius){this.y=this.radius
}if(this.x>=(K.width-this.radius)){this.x=K.width-this.radius-1
}if(this.y>=(K.height-this.radius)){this.y=K.height-this.radius-1
}this.handlePosition.x=this.x+C;
this.handlePosition.y=this.y+B
}else{this.pointToMove.x=A.x;
this.pointToMove.y=A.y;
var G=this.pointToMove.x-this.x;
var L=this.pointToMove.y-this.y;
this.radius=Math.sqrt((G*G)+(L*L));
var D=null;
if(G!=0){D=Math.atan(L/G)
}var I=false;
if((this.x-this.radius)<0){this.radius=this.x;
I=true
}if((this.x+this.radius)>=K.width){this.radius=K.width-this.x-1;
I=true
}if((this.y-this.radius)<0){this.radius=this.y;
I=true
}if((this.y+this.radius)>=K.height){this.radius=K.height-this.y-1;
I=true
}if(I){if(D!=null){var F=this.radius*Math.cos(D);
var E=this.radius*Math.sin(D);
if(G<0){F=-F;
E=-E
}this.pointToMove.x=this.x+F;
this.pointToMove.y=this.y+E
}else{this.pointToMove.x=this.x;
if(L<0){this.pointToMove.y=this.y-this.radius
}else{this.pointToMove.y=this.y+this.radius
}}}}return true
},calculateHandleId:function(A){if(this.isPartOfHandle(this.handlePosition.x,this.handlePosition.y,A)){return this.handlePosition
}return null
},isValid:function(){return(this.radius>0)
},rotateBy:function(G,H,E){var F=this.calcBasicAngle(G,H);
var D=((F==90)||(F==270)?E.width:E.height);
var A=Math.round(G/90);
var B;
for(var C=0;
C<A;
C++){B=this.x;
this.x=D-this.y;
this.y=B;
B=this.handlePosition.x;
this.handlePosition.x=D-this.handlePosition.y;
this.handlePosition.y=B
}},onAddForDrag:function(A){this.handleId=this.handlePosition
},draw:function(C,G,F){CQ.Log.debug("CQ.form.ImageMap.CircularArea#paint: Started.");
var H=this.calculateDisplayCoords(G,F,this.x,this.y);
var E=this.calculateDisplaySize(G,this.radius,0).width;
if(this.fillColor){C.fillStyle=this.fillColor;
C.beginPath();
C.arc(H.x,H.y,E,0,2*Math.PI,false);
C.closePath();
C.fill()
}C.lineWidth=1;
C.strokeStyle=this.getColor();
C.beginPath();
C.arc(H.x,H.y,E,0,2*Math.PI,false);
C.closePath();
C.stroke();
var B=(this.isRollOver);
if(B){var D=(this.handleId!=null);
var A=this.calculateDisplayCoords(G,F,this.handlePosition);
this.drawHandle(A.x,A.y,D,false,C)
}CQ.Log.debug("CQ.form.ImageMap.CircularArea#paint: Finished.")
},serialize:function(){return"circle("+this.x+","+this.y+","+Math.round(this.radius)+")"+this.destination.serialize()
},toCoordString:function(){return"("+this.x+"/"+this.y+") r:"+Math.round(this.radius)
},fromCoordString:function(B){var G=CQ.form.ImageMap.Helpers.parseCoordinateString(B);
if(G==null){return false
}var I=G.coordinates;
if((I.length!=2)||(G.coordinatesPairCnt!=1)){return false
}var F,J,H;
if(I[0].radius){F=I[0].radius;
J=I[1].x;
H=I[1].y
}else{F=I[1].radius;
J=I[0].x;
H=I[0].y
}var A,K;
var E=this.handlePosition.x-this.x;
var D=this.handlePosition.y-this.y;
if(E!=0){var C=Math.atan(D/E);
A=Math.cos(C)*F;
K=Math.sin(C)*F;
if(E<0){A=-A;
K=-K
}this.handlePosition.x=A+J;
this.handlePosition.y=K+H
}else{this.handlePosition.x=J;
K=(this.handlePosition.y<this.y?-F:F);
this.handlePosition.y=K+H
}this.x=J;
this.y=H;
this.radius=F;
return true
}});
CQ.form.ImageMap.CircularArea.isStringRepresentation=function(D){var B=D.length;
if(B<13){return false
}var A=D.indexOf("(");
if(A<=0){return false
}var C=D.substring(0,A);
if(C!="circle"){return false
}if(!D.charAt(B)==")"){return false
}return true
};
CQ.form.ImageMap.CircularArea.deserialize=function(C){var H=C.indexOf("(");
if(H<0){return null
}var E=C.indexOf(")",H+1);
if(E<0){return null
}var A=C.substring(H+1,E);
var G;
var I=A.split(",");
if(I.length!=3){return null
}var B=new Array();
var F=I.length;
for(G=0;
G<F;
G++){var D=parseInt(I[G]);
if(isNaN(D)){return null
}B[G]=D
}return new CQ.form.ImageMap.CircularArea({},B[0],B[1],B[2])
};
CQ.form.ImageMap.PolyArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(B,A,C){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_POLYGON,B);
this.areaType=CQ.form.ImageMap.AREATYPE_POLYGON;
this.destination=new CQ.form.ImageMap.AreaDestination();
this.points=new Array();
this.points.push({x:A,y:C})
},addPoint:function(A,C){var B={x:A,y:C};
this.points.push(B);
return B
},insertPoint:function(B,G,C){var D={x:B,y:G};
var E=this.points.length;
var A=this.calculatePointInsertIndex(B,G,C);
if(A<0){return null
}if(A<E){for(var F=E;
F>A;
F--){this.points[F]=this.points[F-1]
}}this.points[A]=D;
return D
},removePoint:function(C){var D=this.points.length;
var B=false;
var A,E;
for(A=0;
A<D;
A++){E=this.points[A];
if(E==C){this.points[A]=null;
if(this.handleId==E){this.handleId=null
}if(this.selectedHandle==E){this.selectedHandle=null
}B=true;
break
}}if(!B){for(A=0;
A<D;
A++){E=this.points[A];
if((E.x==C.x)&&(E.y==C.y)){this.points[A]=null;
if(this.handleId==E){this.handleId=null
}if(this.selectedHandle==E){this.selectedHandle=null
}break
}}}CQ.form.ImageMap.Helpers.compactArray(this.points)
},isOnLine:function(B,C,D,A){var E=CQ.form.ImageMap.Helpers.calculateDistance(C,D,B);
return(E<=A)
},calcBoundingRect:function(){if(this.points.length==0){return null
}var A=this.points[0].x;
var H=this.points[0].y;
var F=A;
var D=H;
var E=this.points.length;
for(var C=0;
C<E;
C++){var G=this.points[C];
if(G.x<A){A=G.x
}else{if(G.x>F){F=G.x
}}if(G.y<H){H=G.y
}else{if(G.y>D){D=G.y
}}}var B=new Object();
B.top=H;
B.left=A;
B.bottom=D;
B.right=F;
return B
},calculatePointInsertIndex:function(F,D,C){var G=this.points.length;
if(G==1){return 1
}var A=new Object();
A.x=F;
A.y=D;
for(var E=1;
E<G;
E++){var I=this.points[E-1];
var H=this.points[E];
if(this.isOnLine(A,I,H,C)){return E
}}var B=this.isOnLine(A,this.points[0],this.points[G-1],C);
if(B){return G
}return -1
},cleanUp:function(){var C=this.points.length;
for(var A=0;
A<(C-1);
A++){var D=this.points[A];
var B=this.points[A+1];
if((D.x==B.x)&&(D.y==B.y)){this.points[A]=null;
CQ.Log.info("CQ.form.ImageMap.PolyArea#cleanUp: Polygon point with identical coordinates removed: "+D.x+"/"+D.y)
}}CQ.form.ImageMap.Helpers.compactArray(this.points)
},isTouched:function(F,D){var A=this.calculateHandleId(F);
if(A!=null){return true
}var H=this.points.length;
F=F.unzoomedUnclipped;
if(H==1){var B=Math.abs(this.points[0].x-F.x);
var E=Math.abs(this.points[0].y-F.y);
return(B<D)&&(E<D)
}else{var C;
for(var G=1;
G<H;
G++){var J=this.points[G-1];
var I=this.points[G];
C=this.isOnLine(F,J,I,D);
if(C){return true
}}return this.isOnLine(F,this.points[0],this.points[H-1],D)
}},calculateDraggingReference:function(){if(this.pointToMove==null){var A=this.calcBoundingRect();
this.draggingReference={x:A.left,y:A.top,width:A.right-A.left+1,height:A.bottom-A.top+1}
}else{this.draggingReference={x:this.pointToMove.x,y:this.pointToMove.y}
}},moveShapeBy:function(F,E,K){var H=K.unzoomed.rotatedImageSize;
var A=this.calculateDestCoords(F,E,this.draggingReference,H);
var L=A.x;
var I=A.y;
if(this.pointToMove==null){var O=L+this.draggingReference.width;
if(O>=H.width){L=H.width-this.draggingReference.width
}var N=I+this.draggingReference.height;
if(N>=H.height){I=H.height-this.draggingReference.height
}var D=this.calcBoundingRect();
var C=L-D.left;
var B=I-D.top;
var M=this.points.length;
for(var J=0;
J<M;
J++){var G=this.points[J];
G.x+=C;
G.y+=B
}}else{this.pointToMove.x=L;
this.pointToMove.y=I
}return true
},calculateHandleId:function(A,E){var C=this.points.length;
for(var B=0;
B<C;
B++){var D=this.points[B];
if(this.isPartOfHandle(D.x,D.y,A,E)){return D
}}return null
},onUnSelect:function(){this.selectedHandle=null;
CQ.form.ImageMap.PolyArea.superclass.onUnSelect.call(this);
return true
},isValid:function(){return(this.points.length>0)
},rotateBy:function(D,A,G){var K=this.calcBasicAngle(D,A);
var E=((K==90)||(K==270)?G.width:G.height);
var H=Math.round(D/90);
var F;
for(var B=0;
B<H;
B++){var J=this.points.length;
for(var I=0;
I<J;
I++){var C=this.points[I];
F=C.x;
C.x=E-C.y;
C.y=F
}}},onAddForDrag:function(A){this.handleId=this.points[0]
},onDragStart:function(){this.selectedHandle=this.handleId;
CQ.form.ImageMap.PolyArea.superclass.onDragStart.call(this);
return true
},selectPointAt:function(A){if((A>=0)&&(A<this.points.length)){this.selectedHandle=this.points[A]
}else{this.selectedHandle=null
}},selectPoint:function(A){if(A==null){this.selectedHandle=null
}else{var C=this.points.length;
for(var B=0;
B<C;
B++){var D=this.points[B];
if((D.x==A.x)&&(D.y==A.y)){this.selectedHandle=D;
return 
}}}},draw:function(L,K,E){CQ.Log.debug("CQ.form.ImageMap.PolyArea#paint: Started.");
var G,A;
var H=this.points.length;
var I=this.calculateDisplayCoords(K,E,this.points[0]);
if(this.fillColor){L.fillStyle=this.fillColor;
L.beginPath();
L.moveTo(I.x,I.y);
for(G=0;
G<H;
G++){A=this.calculateDisplayCoords(K,E,this.points[G]);
L.lineTo(A.x,A.y)
}L.closePath();
L.fill()
}L.lineWidth=1;
L.strokeStyle=this.getColor();
L.beginPath();
L.moveTo(I.x,I.y);
for(G=1;
G<H;
G++){A=this.calculateDisplayCoords(K,E,this.points[G]);
L.lineTo(A.x,A.y)
}L.closePath();
L.stroke();
var C=this.isRollOver||(this.selectedHandle!=null)||this.isSelected;
var F=(this.selectedHandle==this.points[0]);
var D=(this.handleId==this.points[0]);
if(C||F){this.drawHandle(I.x,I.y,D,F,L)
}for(G=1;
G<H;
G++){A=this.calculateDisplayCoords(K,E,this.points[G]);
var B=(this.selectedHandle==this.points[G]);
var J=(this.handleId==this.points[G]);
if(C||B){this.drawHandle(A.x,A.y,J,B,L)
}}CQ.Log.debug("CQ.form.ImageMap.PolyArea#paint: Finished.")
},serialize:function(){var D="poly(";
var C=this.points.length;
for(var B=0;
B<C;
B++){if(B>0){D+=","
}var A=this.points[B];
D+=A.x+","+A.y
}D+=")";
D+=this.destination.serialize();
return D
},toCoordString:function(){var B="";
var D=this.points.length;
for(var A=0;
A<D;
A++){if(A>0){B+=" "
}var C=this.points[A];
B+="("+C.x+"/"+C.y+")"
}return B
},fromCoordString:function(D){var B=CQ.form.ImageMap.Helpers.parseCoordinateString(D);
if(B==null){return false
}var E=B.coordinates;
if((E.length<2)||(B.coordinatesPairCnt!=E.length)){return false
}this.points.length=0;
var F=E.length;
for(var C=0;
C<F;
C++){var A=E[C];
this.addPoint(A.x,A.y)
}return true
}});
CQ.form.ImageMap.PolyArea.isStringRepresentation=function(D){var B=D.length;
if(B<9){return false
}var A=D.indexOf("(");
if(A<=0){return false
}var C=D.substring(0,A);
if(C!="poly"){return false
}if(!D.charAt(B)==")"){return false
}return true
};
CQ.form.ImageMap.PolyArea.deserialize=function(C){var G=C.indexOf("(");
if(G<0){return null
}var E=C.indexOf(")",G+1);
if(E<0){return null
}var A=C.substring(G+1,E);
var K=A.split(",");
var B=new Array();
var I;
var J=K.length;
if((J&1)!=0){return null
}for(I=0;
I<J;
I+=2){var H=parseInt(K[I]);
var F=parseInt(K[I+1]);
if(isNaN(H)){return null
}if(isNaN(F)){return null
}B[I/2]={x:H,y:F}
}J=B.length;
var D=new CQ.form.ImageMap.PolyArea({},B[0].x,B[0].y);
for(I=1;
I<J;
I++){D.addPoint(B[I].x,B[I].y)
}return D
};
CQ.form.ImageCrop=CQ.Ext.extend(CQ.form.SmartImage.Tool,{cropRect:null,cropRectDef:null,aspectRatioDef:null,constructor:function(A){CQ.form.ImageCrop.superclass.constructor.call(this,{toolId:"smartimageCrop",toolName:CQ.I18n.getMessage("Crop"),iconCls:"cq-image-icon-crop",isCommandTool:false,userInterface:new CQ.form.ImageCrop.UI({title:CQ.I18n.getMessage("Image crop tools")}),transferFieldName:A,cropMinWidth:32,cropMinHeight:32});
this.cropRectDef=null;
this.aspectRatioDef=null
},initialize:function(A){if(A.cropConfig){this.aspectRatios=A.cropConfig.aspectRatios
}this.userInterface.updateAspectRatios(this.aspectRatios)
},initComponent:function(A){CQ.form.ImageMap.superclass.initComponent.call(this,A);
this.workingArea=this.imageComponent.getImagePanel();
this.workingArea.on("contentchange",this.onContentChange,this);
this.workingArea.on("dragchange",function(B){var D=(B.length==1)&&(B[0]==this.cropRect);
if(D){this.imageComponent.invalidateProcessedImages();
var C={changeType:"crop",newValue:{x:this.cropRect.x,y:this.cropRect.y,width:this.cropRect.width,height:this.cropRect.height}};
this.workingArea.fireEvent("contentchange",C);
this.workingArea.fireEvent("smartimage.contentchange",C)
}},this)
},onActivation:function(){CQ.form.ImageCrop.superclass.onActivation.call(this);
this.workingArea.hideAllShapeSets(false);
if(!this.isInitialized){this.cropShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageCrop.SHAPESET_ID);
this.workingArea.addShapeSet(this.cropShapeSet);
this.isInitialized=true
}if(this.initialValue!=null){this.deserialize(this.initialValue);
this.initialValue=null
}var A=this.imageComponent.getSuitableImage(true);
if(A){this.workingArea.ignoreRotation=true;
this.workingArea.updateImage(A);
this.initializeEdit();
this.imageComponent.resetZoomSlider()
}this.userInterface.isActive=true;
this.workingArea.setShapeSetVisible(CQ.form.ImageCrop.SHAPESET_ID,true,true)
},initializeEdit:function(){var A=false;
if(this.cropRect==null){A=true;
this.cropRect=new CQ.form.ImageCrop.CropRect({cropMinWidth:this.cropMinWidth,cropMinHeight:this.cropMinHeight},null,null,null,null);
this.userInterface.notifyWorkingArea(this.workingArea,this.cropRect)
}if(this.cropRectDef!=null){this.cropRect.x=this.cropRectDef.x;
this.cropRect.y=this.cropRectDef.y;
this.cropRect.width=this.cropRectDef.width;
this.cropRect.height=this.cropRectDef.height
}else{this.cropRect.x=0;
this.cropRect.y=0;
this.userInterface.calculateInitialCropSize()
}this.userInterface.setAspectRatioUI(this.aspectRatioDef);
if(A){this.cropShapeSet.addShape(this.cropRect)
}else{this.workingArea.drawImage()
}},onDeactivation:function(){this.userInterface.isActive=false;
this.workingArea.setShapeSetVisible(CQ.form.ImageCrop.SHAPESET_ID,false,false);
var A=this.imageComponent.getSuitableImage();
if(A){this.workingArea.ignoreRotation=false;
this.workingArea.updateImage(A);
this.imageComponent.resetZoomSlider()
}CQ.form.ImageCrop.superclass.onDeactivation.call(this)
},clearCroppingInformation:function(){this.cropRectDef=null;
this.initialValue=null
},resetAspectRatio:function(){this.aspectRatioDef=null;
this.userInterface.setAspectRatioUI(null)
},onImageUploaded:function(){this.clearCroppingInformation();
this.resetAspectRatio();
CQ.form.ImageCrop.superclass.onImageUploaded.call(this)
},onImageFlushed:function(){this.clearCroppingInformation();
this.resetAspectRatio();
CQ.form.ImageCrop.superclass.onImageFlushed.call(this)
},onContentChange:function(A){if(A.changeType=="rotate"){}},serialize:function(){if(!this.isInitialized){return null
}var A="";
var B=this.userInterface.aspectRatio;
if((B!=null)&&(B!="0,0")){A="/"+B
}if(this.cropRect==null){return A
}return this.cropRect.x+","+this.cropRect.y+","+(this.cropRect.x+this.cropRect.width)+","+(this.cropRect.y+this.cropRect.height)+A
},deserialize:function(F){this.cropRectDef=null;
this.aspectRatioDef=null;
if((F==null)||(F.length==0)){return 
}var C=null;
var B=F.indexOf("/");
if((B>=0)&&(F.length>(B+1))){C=F.substring(B+1,F.length);
F=F.substring(0,B)
}this.aspectRatioDef=C;
var D=F.split(",");
if(D.length==4){var A=parseInt(D[0]);
var E=parseInt(D[1]);
this.cropRectDef={x:A,y:E,width:parseInt(D[2])-A,height:parseInt(D[3])-E}
}}});
CQ.form.ImageCrop.SHAPESET_ID="smartimage.imagecrop";
CQ.form.ImageCrop.UI=CQ.Ext.extend(CQ.form.SmartImage.Tool.UserInterface,{isActive:false,workingArea:null,cropMinWidth:0,cropMinHeight:0,aspectRatio:null,constructor:function(A){this.aspectRatioText=CQ.I18n.getMessage("Aspect ratio");
this.aspectRatioMenu=new CQ.Ext.menu.Menu({items:[]});
this.toolbar=new CQ.Ext.Toolbar({itemId:"toolbar",items:[{itemId:"ratio",text:this.aspectRatioText,menu:this.aspectRatioMenu}]});
var B={items:[this.toolbar],width:CQ.themes.SmartImage.Tool.CROP_TOOLS_WIDTH,cropMinWidth:32,cropMinHeight:32};
CQ.Util.applyDefaults(A,B);
CQ.form.ImageCrop.UI.superclass.constructor.call(this,A)
},notifyWorkingArea:function(A,B){this.workingArea=A;
this.cropRect=B;
if(this.initialRatio){var C=this.parseRatioFromString(this.initialRatio);
this.defineRatio(C[0],C[1])
}else{this.cropRect.ratio=null
}},updateAspectRatios:function(E){this.aspectRatioMenu.removeAll();
if(!E){E={freeCrop:{value:"0,0",text:CQ.I18n.getMessage("Free crop")}}
}var B=[];
var H,K;
for(var G in E){if(E.hasOwnProperty(G)){var C=E[G];
if(C.value&&C.text){var F=C.checked;
var D={text:C.text,value:C.value,checked:F,group:"aspectRatio",handler:function(M,L){if(L){this.onRatioChanged(M.value,M.text)
}}.createDelegate(this)};
if(F){K=D
}B.push(D);
if(C.value=="0,0"){H=D
}}}}if(!K&&H){H.checked=true;
K=H
}if(K){var J=K.text;
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+J)
}var I=B.length;
for(var A=0;
A<I;
A++){this.aspectRatioMenu.addItem(new CQ.Ext.menu.CheckItem(B[A]))
}this.initialRatio=null;
if(K){this.initialRatio=K.value;
this.aspectRatio=K.value
}},setAspectRatioUI:function(C){if((C==null)||(C.length==0)){C="0,0"
}this.aspectRatio=null;
var A=this.aspectRatioMenu.items;
A.each(function(D){if(D.value==C){D.setChecked(true,true);
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+D.text);
this.aspectRatio=C
}},this);
if(this.aspectRatio==null){this.defineRatio(0,0)
}else{var B=this.parseRatioFromString(this.aspectRatio);
this.defineRatio(B[0],B[1])
}},onRatioChanged:function(C,B){this.aspectRatio=C;
var A=this.parseRatioFromString(C);
this.changeAspectRatio(A[0],A[1]);
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+B)
},calculateInitialCropSize:function(A){if(!A){A=this.workingArea.originalImageSize
}if(this.cropRect.ratio!=null){var B=this.applyRatio(A.width);
this.cropRect.width=B.width;
this.cropRect.height=B.height
}else{this.cropRect.width=A.width;
this.cropRect.height=A.height
}},changeAspectRatio:function(B,A){if(B!==undefined){this.xRatio=B
}if(A!==undefined){this.yRatio=A
}if((this.xRatio!=0)&&(this.yRatio!=0)){this.cropRect.ratio=this.xRatio/this.yRatio;
var C=this.applyRatio(this.cropRect.width);
this.cropRect.width=C.width;
this.cropRect.height=C.height
}else{this.cropRect.ratio=null
}this.workingArea.drawImage()
},applyRatio:function(B){var C=this.workingArea.originalImageSize;
var A=Math.round(B/this.cropRect.ratio);
if((A+this.cropRect.y)>C.height){A=C.height-this.cropRect.y;
B=Math.round(A*this.cropRect.ratio)
}return{width:B,height:A}
},defineRatio:function(A,B){this.xRatio=A;
this.yRatio=B;
this.calcCropRectRatio()
},calcCropRectRatio:function(){if(this.cropRect!=null){if((this.xRatio>0)||(this.yRatio>0)){this.cropRect.ratio=this.xRatio/this.yRatio
}else{this.cropRect.ratio=null
}}},parseRatioFromString:function(A){var B=[0,0];
var C=A.split(",");
if(C.length==2){B[0]=parseInt(C[0]);
B[1]=parseInt(C[1])
}return B
}});
CQ.form.ImageCrop.CropRect=CQ.Ext.extend(CQ.form.SmartImage.Shape,{rectColor:null,invalidPartsBackground:null,handleDistance:0,handleLength:0,handleThickness:0,cropMinWidth:0,cropMinHeight:0,ratio:null,x:0,y:0,width:0,height:0,drawSections:false,fixedCoordinates:null,constructor:function(C,B,F,D,A){var E={rectColor:CQ.themes.ImageCrop.CROP_RECT_COLOR,invalidPartsBackground:CQ.themes.ImageCrop.BACKGROUND_INVALIDPARTS,handleDistance:CQ.themes.ImageCrop.HANDLE_DISTANCE,handleLength:CQ.themes.ImageCrop.HANDLE_LENGTH,handleThickness:CQ.themes.ImageCrop.HANDLE_THICKNESS,handleRollover:CQ.themes.ImageCrop.HANDLE_ROLLOVER};
CQ.Util.applyDefaults(C,E);
CQ.Ext.apply(this,C);
CQ.form.ImageCrop.CropRect.superclass.constructor.call(this,C);
this.x=B;
this.y=F;
this.width=D;
this.height=A;
this.drawSections=false
},isTouched:function(C,B){var A=this.calculateHandleId(C);
if(A!=null){return true
}C=C.unzoomedUnclipped;
return(C.x>=this.x)&&(C.x<(this.x+this.width))&&(C.y>=this.y)&&(C.y<(this.y+this.height))
},isPartOfHandle:function(A,C,B){var D=this.calculateDistance(A,{x:C,y:B});
return D<Math.ceil(this.handleLength/(A.absoluteZoom+1))
},calculateHandleId:function(B){B=B.unzoomedUnclipped;
var A=null;
if(this.isPartOfHandle(B,this.x,this.y)){return"topleft"
}if(this.isPartOfHandle(B,this.x+this.width,this.y)){return"topright"
}if(this.isPartOfHandle(B,this.x,this.y+this.height)){return"bottomleft"
}if(this.isPartOfHandle(B,this.x+this.width,this.y+this.height)){return"bottomright"
}return A
},isDirectlyDraggable:function(B,A){return this.isTouched(B)
},moveShapeBy:function(G,E,I){var F=I.unzoomed.imageSize;
if(this.pointToMove==null){this.x=this.draggingReference.x+G;
this.y=this.draggingReference.y+E;
this.correctCoordinates(F)
}else{var A=this.draggingReference.x+G;
if(A<0){A=0
}if(A>=F.width){A=F.width-1
}var J=this.draggingReference.y+E;
if(J<0){J=0
}if(J>=F.height){J=F.height-1
}var C,H;
if(this.pointToMove=="topleft"){C=this.x-A;
this.x=A;
this.width+=C;
H=this.y-J;
this.y=J;
this.height+=H
}else{if(this.pointToMove=="topright"){this.width=A-this.x+1;
H=this.y-J;
this.y=J;
this.height+=H
}else{if(this.pointToMove=="bottomleft"){C=this.x-A;
this.x=A;
this.width+=C;
this.height=J-this.y+1
}else{if(this.pointToMove=="bottomright"){this.width=A-this.x+1;
this.height=J-this.y+1
}}}}if(this.width<this.cropMinWidth){this.width=this.cropMinWidth;
this.correctXCoord()
}if(this.height<this.cropMinHeight){this.height=this.cropMinHeight;
this.correctYCoord()
}if(this.ratio!=null){this.height=Math.round(this.width/this.ratio);
this.correctYCoord();
var D=false;
if(this.x<0){this.width+=this.x;
this.x=0;
D=true
}if(D){this.height=Math.round(this.width/this.ratio);
this.correctXCoord();
this.correctYCoord()
}var B=false;
if(this.y<0){this.height+=this.y;
this.y=0;
B=true
}if((this.y+this.height)>F.height){this.height=F.height-this.y;
B=true
}if(B){this.width=Math.round(this.height*this.ratio);
this.correctXCoord();
this.correctYCoord()
}}}return true
},correctXCoord:function(){if(this.fixedCoordinates.widthMult<0){this.x=this.fixedCoordinates.x-this.width
}},correctYCoord:function(){if(this.fixedCoordinates.heightMult<0){this.y=this.fixedCoordinates.y-this.height
}},correctCoordinates:function(B){if(this.x<0){this.x=0
}if(this.y<0){this.y=0
}var A=this.x+this.width;
var C=this.y+this.height;
if(A>B.width){this.x=B.width-this.width;
if(this.x<0){this.width+=this.x;
this.x=0
}}if(C>B.height){this.y=B.height-this.height;
if(this.y<0){this.height+=this.y;
this.y=0
}}},onRollOver:function(A){this.handleId=this.calculateHandleId(A);
return true
},onRollOut:function(A){this.handleId=null;
return true
},onRolledOver:function(B){var A=this.handleId;
this.handleId=this.calculateHandleId(B);
return(this.handleId!=A)
},onDragStart:function(B,A){this.pointToMove=this.calculateHandleId(B);
if((this.pointToMove=="topleft")||(this.pointToMove==null)){this.draggingReference={x:this.x,y:this.y};
if(this.pointToMove!=null){this.fixedCoordinates={x:this.x+this.width-1,y:this.y+this.height-1,widthMult:-1,heightMult:-1}
}}else{if(this.pointToMove=="topright"){this.draggingReference={x:this.x+this.width-1,y:this.y};
this.fixedCoordinates={x:this.x,y:this.y+this.height-1,widthMult:1,heightMult:-1}
}else{if(this.pointToMove=="bottomleft"){this.draggingReference={x:this.x,y:this.y+this.height-1};
this.fixedCoordinates={x:this.x+this.width-1,y:this.y,widthMult:-1,heightMult:1}
}else{if(this.pointToMove=="bottomright"){this.draggingReference={x:this.x+this.width-1,y:this.y+this.height-1};
this.fixedCoordinates={x:this.x,y:this.y,widthMult:1,heightMult:1}
}}}}this.drawSections=true;
return true
},onDragEnd:function(B,A){this.drawSections=false;
return true
},draw:function(O,A,I){var Q=this.calculateDisplayCoords(A,I,this.x,this.y);
var N=this.calculateDisplaySize(A,this.width,this.height);
var S=Q.x+N.width;
var C=Q.y+N.height;
O.save();
if(this.invalidPartsBackground){O.fillStyle=this.invalidPartsBackground;
var K=I.imageSize;
var E=this.calculateDisplayCoords(A,I,0,0);
var F=this.calculateDisplayCoords(A,I,K.width,K.height);
var B=E.x;
var L=E.y;
var J=F.x;
var P=F.y;
if(Q.x>0){O.fillRect(B,L,Q.x-B,P-L)
}if(Q.y>0){O.fillRect(Q.x,L,N.width,Q.y-L)
}var R=Q.y+N.height;
if(R<P){O.fillRect(Q.x,R,N.width,P-R)
}var D=Q.x+N.width;
if(D<J){O.fillRect(D,L,J-D,P-L)
}}O.restore();
O.strokeStyle=this.rectColor;
if(this.drawSections){O.beginPath();
var G=(N.height/3);
O.moveTo(Q.x,Q.y+G);
O.lineTo(S,Q.y+G);
O.moveTo(Q.x,Q.y+2*G);
O.lineTo(S,Q.y+2*G);
var H=(N.width/3);
O.moveTo(Q.x+H,Q.y);
O.lineTo(Q.x+H,C);
O.moveTo(Q.x+2*H,Q.y);
O.lineTo(Q.x+2*H,C);
O.stroke()
}O.lineWidth=1;
O.strokeRect(Q.x,Q.y,N.width,N.height);
O.lineWidth=this.handleThickness;
var M=this.handleLength-this.handleDistance;
O.beginPath();
O.strokeStyle=(this.handleId=="topleft"?this.handleRollover:this.rectColor);
O.moveTo(Q.x-this.handleDistance,Q.y+M);
O.lineTo(Q.x-this.handleDistance,Q.y-this.handleDistance);
O.lineTo(Q.x+M,Q.y-this.handleDistance);
O.stroke();
O.beginPath();
O.strokeStyle=(this.handleId=="topright"?this.handleRollover:this.rectColor);
O.moveTo(S+this.handleDistance,Q.y+M);
O.lineTo(S+this.handleDistance,Q.y-this.handleDistance);
O.lineTo(S-M,Q.y-this.handleDistance);
O.stroke();
O.beginPath();
O.strokeStyle=(this.handleId=="bottomleft"?this.handleRollover:this.rectColor);
O.moveTo(Q.x-this.handleDistance,C-M);
O.lineTo(Q.x-this.handleDistance,C+this.handleDistance);
O.lineTo(Q.x+M,C+this.handleDistance);
O.stroke();
O.beginPath();
O.strokeStyle=(this.handleId=="bottomright"?this.handleRollover:this.rectColor);
O.moveTo(S+this.handleDistance,C-M);
O.lineTo(S+this.handleDistance,C+this.handleDistance);
O.lineTo(S-M,C+this.handleDistance);
O.stroke()
}});
CQ.form.Slideshow=CQ.Ext.extend(CQ.form.SmartImage,{fileReferencePrefix:null,headPanel:null,slides:null,editedSlide:null,activeTabToPreselect:null,name:"",constructor:function(A){A=A||{};
var B={headPanel:new CQ.form.Slideshow.SlidesPanel({onSlideChanged:this.onSlideChanged.createDelegate(this),onAddButton:this.onAddButton.createDelegate(this),onRemoveButton:this.onRemoveButton.createDelegate(this)}),footPanel:new CQ.form.Slideshow.TitlePanel({}),fileReferencePrefix:"./image$",hideMainToolbar:true,allowReference:true,allowUpload:false};
CQ.Util.applyDefaults(A,B);
CQ.form.Slideshow.superclass.constructor.call(this,A);
this.slides=[]
},initComponent:function(){CQ.form.Slideshow.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.superclass.afterRender.call(this);
if(this.fixedHeight==null){if(CQ.Ext.isIE){var A=this.findParentByType("dialog");
A.on("beforehide",function(){var C=this.ownerCt;
var B=this;
while(C&&!C.isXType("tabpanel")){B=C;
C=C.ownerCt
}if(C){this.activeTabToPreselect=C.getActiveTab();
C.setActiveTab(B)
}},this)
}}},createFileNameEditingCapability:function(){},createHiddenInterfaceFields:function(){this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},createInterface:function(E){this.headPanel.disableFormElements();
this.footPanel.disableFormElements();
if(!this.interfaceFields){this.interfaceFields=[]
}else{this.interfaceFields.length=0
}var F=this.slides.length;
for(var H=0;
H<F;
H++){var B=this.slides[H];
var A=B.createTransferFields(this.fileReferencePrefix);
var C=A.length;
for(var D=0;
D<C;
D++){var G=A[D];
G.render(E);
this.interfaceFields.push(G)
}}},removeOldInterface:function(){if(this.interfaceFields){var A=this.interfaceFields.length;
for(var B=0;
B<A;
B++){var C=this.interfaceFields[B];
C.getEl().remove()
}this.interfaceFields.length=0
}},onBeforeSubmit:function(){this.saveChanges();
this.removeOldInterface();
this.createInterface(this.el);
return true
},createSlideIndex:function(){var B;
var E=this.slides.length;
var F=0;
for(var D=0;
D<E;
D++){B=this.slides[D];
if(!B.isDeleted&&(B.slideIndex>F)){F=this.slides[D].slideIndex
}}for(var G=1;
G<=F;
G++){var A=false;
for(var C=0;
C<E;
C++){B=this.slides[C];
if(!B.isDeleted&&(B.slideIndex==G)){A=true;
break
}}if(!A){return G
}}return F+1
},getFirstSlide:function(){var B=this.slides.length;
for(var C=0;
C<B;
C++){var A=this.slides[C];
if(!A.isDeleted){return A
}}return null
},addNewSlide:function(){this.saveChanges();
var B=this.createSlideIndex();
var A=this.createSlide(null,B,this.dataPath);
this.showSlide(A);
this.editedSlide=A
},removeSlide:function(){if(this.editedSlide){this.editedSlide.isDeleted=true;
var A=this.getFirstSlide();
if(!A){this.addNewSlide()
}else{this.editedSlide=A;
this.showSlide(this.editedSlide)
}}},createSlide:function(D,E,G){var F=(D?D["jcr:title"]:null);
var C=(D?D.fileReference:null);
var A;
if(D&&C){var B=this.resolveReference(C,G);
if(B){A=new CQ.form.Slideshow.Slide({referencedFileInfo:B,title:F,slideIndex:E,isPersistent:true,isDeleted:false})
}}else{A=new CQ.form.Slideshow.Slide({referencedFileInfo:null,title:null,slideIndex:E,isPersistent:false,isDeleted:false})
}this.slides.push(A);
return A
},processRecord:function(G,M){if(this.fireEvent("beforeloadcontent",this,G,M)!==false){this.dataPath=M;
this.slides.length=0;
this.headPanel.enableFormElements();
this.footPanel.enableFormElements();
CQ.form.Slideshow.superclass.processPath.call(this,M);
var H=this.fileReferencePrefix.replace("./","");
var J=H.indexOf("$");
var D=H.length;
var C=H;
var B=null;
var L=(J>=0);
if(J==0){C=null;
B=H.substring(1,D)
}else{if(J>0){if(J<(D-1)){C=H.substring(0,J);
B=H.substring(J+1,D)
}else{C=H.substring(0,J);
B=null
}}}var F=G.data;
for(var K in F){if(L){var I=true;
var E;
var A=K.length;
if(C!=null){if(K.indexOf(C)==0){E=C.length
}else{I=false
}}if((B!=null)&&I){A=K.indexOf(B,E);
if(A>E){if((A+B.length)<K.length){I=false
}}else{I=false
}}if(I){this.createSlide(G.get(K),K.substring(E,A),M)
}}else{if(K==C){this.createSlide(G.get(K),1,M)
}}}this.editedSlide=this.getFirstSlide();
if(!this.editedSlide){this.addNewSlide()
}this.showSlide(this.editedSlide);
this.buildComboBoxContent();
this.fireEvent("loadcontent",this,G,M)
}},saveChanges:function(){if(this.editedSlide){var A=this.footPanel.getTitle();
this.editedSlide.referencedFileInfo=this.referencedFileInfo;
this.editedSlide.title=(A?A:null);
this.headPanel.updateSlide(this.editedSlide)
}},buildComboBoxContent:function(){var C=[];
for(var B=0;
B<this.slides.length;
B++){var A=this.slides[B];
if(!A.isDeleted){C.push({value:A,text:A.createDisplayText()})
}}this.headPanel.setInitialComboBoxContent(C);
this.headPanel.select(this.editedSlide)
},showSlide:function(A){this.referencedFileInfo=A.referencedFileInfo;
this.footPanel.setTitle(A.title);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var B=this.imageToolDefs.length;
for(var C=0;
C<B;
C++){this.imageToolDefs[C].onImageUploaded(this.originalRefImage)
}this.updateView()
}.createDelegate(this);
this.originalRefImage.load()
}else{this.originalRefImage=null;
this.updateView()
}},onSlideChanged:function(A){this.saveChanges();
this.editedSlide=A;
if(this.editedSlide){this.showSlide(this.editedSlide)
}},onAddButton:function(){this.addNewSlide();
this.buildComboBoxContent()
},onRemoveButton:function(){if(this.editedSlide){this.removeSlide()
}this.buildComboBoxContent()
}});
CQ.Ext.reg("slideshow",CQ.form.Slideshow);
CQ.form.Slideshow.Slide=CQ.Ext.extend(CQ.Ext.emptyFn,{referencedFileInfo:null,slideIndex:0,isPersistent:false,isDeleted:false,constructor:function(A){var B={referencedFileInfo:null,isPersistent:false,isDeleted:false,slideIndex:-1};
CQ.Ext.apply(this,A,B)
},createDisplayText:function(){if(this.title){return this.title
}else{if(this.referencedFileInfo){return this.referencedFileInfo.dataPath
}else{return CQ.I18n.getMessage("New slide")
}}},createTransferFields:function(D){var A=[];
var F="./"+D.replace("$",this.slideIndex);
if(!this.isDeleted){var C=F+"/fileReference";
var E=F+"/jcr:title";
if(this.referencedFileInfo){A.push(new CQ.Ext.form.Hidden({name:C,value:this.referencedFileInfo.dataPath}))
}else{A.push(new CQ.Ext.form.Hidden({name:C,value:""}))
}if(this.title){A.push(new CQ.Ext.form.Hidden({name:E,value:this.title}))
}else{A.push(new CQ.Ext.form.Hidden({name:E,value:""}))
}}else{if(this.isPersistent){var B=F+CQ.Sling.DELETE_SUFFIX;
if(this.referencedFileInfo){A.push(new CQ.Ext.form.Hidden({name:B,value:"true"}))
}}}return A
}});
CQ.form.Slideshow.SlidesPanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){var C=this;
var B=new CQ.Ext.Button({itemId:"addButton",xtype:"button",text:"Add",afterRender:function(){CQ.Ext.Button.prototype.afterRender.call(this);
if(C._width){C.adjustSelectorWidth(C._width)
}},handler:function(){if(C.onAddButton){C.onAddButton()
}}});
var D=new CQ.Ext.Button({itemId:"removeButton",xtype:"button",text:"Remove",afterRender:function(){CQ.Ext.Button.prototype.afterRender.call(this);
if(C._width){C.adjustSelectorWidth(C._width)
}},handler:function(){if(C.onRemoveButton){C.onRemoveButton()
}}});
A=A||{};
var E={layout:"table",layoutConfig:{columns:3},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"slideSelector",xtype:"panel",layout:"fit",border:false,height:30,hideBorders:true,items:[{itemId:"selector",xtype:"selection",type:"select",listeners:{selectionchanged:{fn:function(F,G){if(this.onSlideChanged){this.onSlideChanged(G)
}},scope:this}}}]},B,D],listeners:{bodyresize:{fn:function(G,F,H){this.adjustSelectorWidth(F)
},scope:this}}};
CQ.Util.applyDefaults(A,E);
CQ.form.Slideshow.SlidesPanel.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.Slideshow.SlidesPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.SlidesPanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustSelectorWidth:function(E){if(E){var B=this.items.get("slideSelector");
var D=this.items.get("addButton");
var F=this.items.get("removeButton");
if(D.rendered&&F.rendered){var C=E-D.getEl().getWidth()-F.getEl().getWidth();
B.setSize(C,30);
var A=B.items.get("selector");
A.setSize(C,D.getEl().getHeight())
}else{this._width=E
}}},setInitialComboBoxContent:function(B){var A=this.items.get("slideSelector").items.get("selector");
A.setOptions(B)
},select:function(B){var A=this.items.get("slideSelector").items.get("selector");
A.suspendEvents();
if(B){A.setValue(B)
}else{A.setValue(null)
}A.resumeEvents()
},updateSlide:function(B){if(B){var A=this.items.get("slideSelector").items.get("selector");
var C=A.comboBox.store;
var F=C.getTotalCount();
for(var E=0;
E<F;
E++){var D=C.getAt(E);
if(D.get("value")==B){D.set("text",B.createDisplayText())
}}C.commitChanges()
}},disableFormElements:function(){var A=this.items.get("slideSelector").items.get("selector");
A.disable()
},enableFormElements:function(){var A=this.items.get("slideSelector").items.get("selector");
A.enable()
}});
CQ.form.Slideshow.TitlePanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){A=A||{};
var B={layout:"table",layoutConfig:{columns:2},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"titleLabel",xtype:"label",text:CQ.I18n.getMessage("Title")},{itemId:"titlePanel",xtype:"panel",layout:"fit",border:false,hideBorders:true,items:[{itemId:"title",xtype:"textfield"}]}],listeners:{bodyresize:{fn:function(D,C,E){this.adjustTitleWidth(C)
},scope:this}}};
CQ.Util.applyDefaults(A,B);
CQ.form.Slideshow.TitlePanel.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.Slideshow.SlidesPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.TitlePanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustTitleWidth:function(A){if(A){var B=this.items.get("titlePanel");
var C=this.items.get("titleLabel");
if(C.rendered){var D=A-C.getEl().getWidth();
B.setSize(D,30)
}else{this._width=A
}}},setTitle:function(C){var B=this.items.get("titlePanel");
var A=B.items.get("title");
A.setValue(C?C:"")
},getTitle:function(){var B=this.items.get("titlePanel");
var A=B.items.get("title");
return A.getValue()
},disableFormElements:function(){var B=this.items.get("titlePanel");
var A=B.items.get("title");
A.disable()
},enableFormElements:function(){var B=this.items.get("titlePanel");
var A=B.items.get("title");
A.enable()
}});
CQ.form.MVT=CQ.Ext.extend(CQ.form.Slideshow,{constructor:function(A){A=A||{};
var B={footPanel:new CQ.form.MVT.BiasPanel({})};
CQ.Util.applyDefaults(A,B);
CQ.form.MVT.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.MVT.superclass.initComponent.call(this)
},createSlide:function(E,F,H){var G=(E?E["jcr:title"]:null);
var D=(E?E.fileReference:null);
var C=(E?E.bias:null);
var A;
if(E&&D){var B=this.resolveReference(D,H);
if(B){A=new CQ.form.MVT.Banner({referencedFileInfo:B,title:G,bias:C,slideIndex:F,isPersistent:true,isDeleted:false})
}}else{A=new CQ.form.MVT.Banner({referencedFileInfo:null,title:null,bias:null,slideIndex:F,isPersistent:false,isDeleted:false})
}this.slides.push(A);
return A
},saveChanges:function(){if(this.editedSlide){var A=this.footPanel.getBias();
this.editedSlide.referencedFileInfo=this.referencedFileInfo;
this.editedSlide.bias=(A?A:null);
this.headPanel.updateSlide(this.editedSlide)
}},showSlide:function(A){this.footPanel.setBias(A.bias);
CQ.form.MVT.superclass.showSlide.call(this,A)
}});
CQ.Ext.reg("mvt",CQ.form.MVT);
CQ.form.MVT.Banner=CQ.Ext.extend(CQ.form.Slideshow.Slide,{constructor:function(A){CQ.form.MVT.Banner.superclass.constructor.call(this,A)
},createDisplayText:function(){if(this.title){return this.title
}else{if(this.referencedFileInfo){return this.referencedFileInfo.dataPath
}else{return CQ.I18n.getMessage("New Banner")
}}},createTransferFields:function(E){var A=[];
var G="./"+E.replace("$",this.slideIndex);
if(!this.isDeleted){var D=G+"/fileReference";
var F=G+"/jcr:title";
var B=G+"/bias";
if(this.referencedFileInfo){A.push(new CQ.Ext.form.Hidden({name:D,value:this.referencedFileInfo.dataPath}))
}else{A.push(new CQ.Ext.form.Hidden({name:D,value:""}))
}if(this.title){A.push(new CQ.Ext.form.Hidden({name:F,value:this.title}))
}else{A.push(new CQ.Ext.form.Hidden({name:F,value:""}))
}if(this.bias){A.push(new CQ.Ext.form.Hidden({name:B,value:this.bias}))
}else{A.push(new CQ.Ext.form.Hidden({name:B,value:""}))
}}else{if(this.isPersistent){var C=G+CQ.Sling.DELETE_SUFFIX;
if(this.referencedFileInfo){A.push(new CQ.Ext.form.Hidden({name:C,value:"true"}))
}}}return A
}});
CQ.form.MVT.BiasPanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(A){A=A||{};
var B={layout:"table",layoutConfig:{columns:2},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"biasLabel",xtype:"label",text:CQ.I18n.getMessage("Bias")},{itemId:"BiasPanel",xtype:"panel",layout:"fit",border:false,hideBorders:true,items:[{itemId:"bias",xtype:"numberfield",allowNegative:false}]}],listeners:{bodyresize:{fn:function(D,C,E){this.adjustBiasWidth(C)
},scope:this}}};
CQ.Util.applyDefaults(A,B);
CQ.form.MVT.BiasPanel.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.MVT.BiasPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.MVT.BiasPanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustBiasWidth:function(B){if(B){var C=this.items.get("BiasPanel");
var D=this.items.get("biasLabel");
if(D.rendered){var A=B-D.getEl().getWidth();
C.setSize(A,30)
}else{this._width=B
}}},setBias:function(A){var C=this.items.get("BiasPanel");
var B=C.items.get("bias");
B.setValue(A?A:"")
},getBias:function(){var B=this.items.get("BiasPanel");
var A=B.items.get("bias");
return A.getValue()
},disableFormElements:function(){var B=this.items.get("BiasPanel");
var A=B.items.get("bias");
A.disable()
},enableFormElements:function(){var B=this.items.get("BiasPanel");
var A=B.items.get("bias");
A.enable()
}});
CQ.form.RichText=CQ.Ext.extend(CQ.Ext.form.Field,{validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:CQ.Ext.emptyFn,iframePad:3,hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},externalStyleSheets:null,requiredCssPath:null,allowBlank:true,adjustEditorToToolbarHeight:false,requiredStyleSheets:null,requiredLinkedCss:null,actionMode:"wrap",savedDropTargets:null,dataPath:null,editorKernel:null,isDroppingAllowed:false,focusOnInitialize:false,constructor:function(B){var A=CQ.form.rte.Common;
var C={name:"text",ddAccept:"image/;application/pdf",height:CQ.themes.RichText.DEFAULT_HEIGHT,requiredCssPath:CQ.themes.RichText.DEFAULT_REQCSS_PATH,adjustEditorToToolbarHeight:true};
this.requiredStyleSheets=null;
this.requiredLinkedCss={iframeDefault:"RichText.iFrame.css"};
CQ.Util.applyDefaults(B,C);
this.editorKernel=new CQ.form.rte.IFrameKernel(B);
CQ.form.RichText.superclass.constructor.call(this,B);
A.removeJcrData(this.externalStyleSheets);
A.removeJcrData(this.requiredLinkedCss);
this.isDroppingAllowed=true;
this.focusOnInitialize=false;
if(this.height){this.editorHeight=this.height
}},processRecord:function(A,C){this.editorKernel.setContentPath(C);
if(this.fireEvent("beforeloadcontent",this,A,C)!==false){var B=A.get(this.getName());
if(B==undefined&&this.defaultValue!=null){if(this.isApplyDefault(A,C)){this.setValue(this.defaultValue)
}}else{this.setValue(B?B:"")
}this.fireEvent("loadcontent",this,A,C)
}},validateValue:function(A){if(A.length<1||A===CQ.Ext.form.TextField.prototype.emptyText){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(CQ.Ext.form.TextField.prototype.blankText);
return false
}}if(typeof this.validator=="function"){var B=this.validator(A);
if(B!==true){this.markInvalid(B);
return false
}}if(this.regex&&!this.regex.test(A)){this.markInvalid(CQ.Ext.form.TextField.prototype.regexText);
return false
}return true
},markInvalid:function(B){if(!this.rendered||this.preventMark){return 
}B=B||this.invalidText;
var A=this.iframeWrap.mask();
A.addClass(this.invalidClass);
A.dom.qtip=B;
A.dom.qclass="x-form-invalid-tip";
A.on("click",function(){this.clearInvalid();
this.focus()
},this);
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,B)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}if(this.iframeWrap){this.iframeWrap.unmask()
}this.fireEvent("valid",this)
},initComponent:function(){this.addEvents("initialize","activate","beforesync","beforepush","sync","push","editmodechange")
},afterRender:function(){CQ.form.RichText.superclass.afterRender.call(this);
if(this.editorHeight){this.setHeight(this.editorHeight)
}this.initializeDragAndDrop()
},onRender:function(D,A){CQ.form.RichText.superclass.onRender.call(this,D,A);
this.el.dom.style.border="0 none";
this.el.dom.setAttribute("tabIndex",-1);
this.el.addClass("x-hidden");
if(CQ.Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")
}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",cn:{cls:"x-html-editor-tb"}});
this.createToolbar(this);
var F=document.createElement("iframe");
F.name=CQ.Ext.id();
F.frameBorder="0";
F.src=(CQ.Ext.SSL_SECURE_URL||"javascript:;");
this.wrap.dom.appendChild(F);
this.iframe=F;
var E=CQ.Ext.get(F);
this.iframeWrap=E.wrap();
var C=!E.isVisible(true);
if(CQ.Ext.isIE){F.contentWindow.document.designMode="on";
this.doc=F.contentWindow.document;
this.win=F.contentWindow
}else{this.doc=(F.contentDocument||window.frames[F.name].document);
this.win=window.frames[F.name];
this.doc.designMode="on"
}this.doc.open();
this.doc.write(this.getDocMarkup());
this.doc.close();
var H=function(){if(E.isVisible(true)){if(this.doc.body||(this.doc.readyState=="complete")){CQ.Ext.TaskMgr.stop(B);
this.initEditor.defer(10,this)
}}};
var B={run:H,interval:(C?100:10),scope:this};
if(!C){B.duration=10000
}CQ.Ext.TaskMgr.start(B);
if(!this.width){this.setSize(this.el.getSize())
}E.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var G=this.findParentByType("dialog");
if(G){G.on("show",function(J){var I=CQ.Ext.get(this.iframe);
if(I){I.show()
}},this);
G.on("hide",function(J){var I=CQ.Ext.get(this.iframe);
if(I){I.hide()
}},this);
G.on("beforesubmit",function(I){if(this.initialized){this.syncValue()
}},this)
}},onResize:function(J,F){CQ.form.RichText.superclass.onResize.apply(this,arguments);
if(this.el&&this.iframe){var E=this.wrap.getHeight();
var C;
if(typeof (J)=="number"){var A=J-this.wrap.getFrameWidth("lr");
this.el.setWidth(this.adjustWidth("textarea",A));
if(!isNaN(A)&&(A>0)){this.iframe.style.width=A+"px"
}}else{if((typeof (J)=="string")&&CQ.form.rte.Common.strEndsWith(J,"%")){this.iframe.style.width="100%";
J=this.wrap.getWidth()
}}var H=this.editorKernel.getToolbarHeight();
var D=this.editorKernel.tb;
if(D){var G=D.length;
for(C=0;
C<G;
C++){D[C].onResize(J,D[C].el.getHeight())
}}var B=this.editorKernel.getToolbarHeight();
if((typeof F=="number")||((H!=B)&&this.adjustEditorToToolbarHeight)){if(!F){F=E-this.wrap.getFrameWidth("tb")
}var I=F-this.wrap.getFrameWidth("tb")-B;
this.el.setHeight(this.adjustWidth("textarea",I));
if(!isNaN(I)&&(I>0)){this.iframe.style.height=I+"px";
if(this.doc){this.getEditorBody().style.height=(I-(this.iframePad*2))+"px"
}}}}},createEditContext:function(){if(this.initialized){return new CQ.form.rte.EditContext(this.iframe,this.getWin(),this.getDoc(),this.getEditorBody())
}return new CQ.form.rte.EditContext()
},addStyleSheets:function(){var k=this.doc.getElementsByTagName("head")[0];
if(this.externalStyleSheets){for(var j in this.externalStyleSheets){if(this.externalStyleSheets.hasOwnProperty(j)){var B=this.externalStyleSheets[j];
var C=this.doc.createElement("link");
C.type="text/css";
C.rel="stylesheet";
C.href=CQ.HTTP.externalize(B);
C.media="screen";
k.appendChild(C)
}}}var c=[];
if(this.requiredStyleSheets){var d=this.requiredStyleSheets.length;
for(var a=0;
a<d;
a++){c.push(this.requiredStyleSheets[a])
}}for(var A in this.editorKernel.registeredPlugins){var F=this.editorKernel.registeredPlugins[A];
var J=F.reportStyles();
if(J!=null){var X=J.length;
for(var T=0;
T<X;
T++){var S=J[T];
var O=S.styles;
var V=O.length;
for(var U=0;
U<V;
U++){var P=O[U].cssName;
if(!CQ.form.rte.Common.arrayContains(P)){c.push(P)
}}}}}var H=c.length;
var L=document.styleSheets;
var N=L.length;
var b,K,W,R,I,Q,Y,Z,E,G;
if(CQ.Ext.isIE){var D=this.doc.createStyleSheet();
for(G=0;
G<H;
G++){b=c[G];
for(K=0;
K<N;
K++){W=L[K];
R=W.rules;
I=R.length;
Q=null;
for(Y=0;
Y<I;
Y++){Z=R[Y];
E=Z.selectorText;
if(E=="."+b){D.addRule("."+E,Z.style.cssText);
break
}}}}}else{var M=this.doc.createElement("style");
M.type="text/css";
var g="";
for(G=0;
G<H;
G++){b=c[G];
for(K=0;
K<N;
K++){W=L[K];
R=W.cssRules;
I=R.length;
Q=null;
for(Y=0;
Y<I;
Y++){Z=R[Y];
if(Z.type){if(Z.type==CSSRule.STYLE_RULE){E=Z.selectorText;
if(E==("."+b)){Q=Z;
break
}}}}if(Q){g+=Q.cssText;
break
}}}M.appendChild(this.doc.createTextNode(g));
k.appendChild(M)
}},getDocMarkup:function(){var C="<html><head>";
if(this.requiredLinkedCss){for(var B in this.requiredLinkedCss){if(this.requiredLinkedCss.hasOwnProperty(B)){var A=this.requiredCssPath+"/"+this.requiredLinkedCss[B];
C+='<link rel="stylesheet" type="text/css" href="'+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(A))+'">'
}}}C+='</head><body id="CQrte" spellcheck="false">'+this.editorKernel.getEmptyLinePlaceholderMarkup()+"</body></html>";
return C
},getEditorBody:function(){return this.doc.body||this.doc.documentElement
},getDoc:function(){return CQ.Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)
},getWin:function(){return CQ.Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]
},adjustSize:CQ.Ext.BoxComponent.prototype.adjustSize,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},initEvents:function(){this.originalValue=this.getValue()
},deferFocus:function(){this.focus.defer(10,this)
},adjustWidth:function(A,B){A=A.toLowerCase();
if(typeof B=="number"&&!CQ.Ext.isSafari){if(CQ.Ext.isIE&&(A=="input"||A=="textarea")){if(A=="textarea"&&CQ.Ext.isStrict){return B-2
}}else{if(CQ.Ext.isOpera&&CQ.Ext.isStrict){if(A=="textarea"){return B-2
}}}}return B
},initEditor:function(){var B=this.getEditorBody();
var A=this.el.getStyles("font-size","font-family","background-image","background-repeat");
A["background-attachment"]="fixed";
B.bgProperties="fixed";
CQ.Ext.DomHelper.applyStyles(B,A);
if(this.doc){try{CQ.Ext.EventManager.removeAll(this.doc)
}catch(C){}}this.doc=this.getDoc();
this.addStyleSheets();
this.editorKernel.initializeEditContext(this.iframe,this.win,this.doc,this.getEditorBody());
this.editorKernel.initializeEventHandling();
this.editorKernel.addUIListener("updatestate",this.updateToolbar,this);
this.editorKernel.addUIListener("preventdrop",this.preventDrop,this);
this.editorKernel.addUIListener("reactivatedrop",this.reactivateDrop,this);
this.editorKernel.addUIListener("enablesourceedit",function(){this.toggleSourceEdit(true)
}.createDelegate(this),this);
this.editorKernel.addUIListener("disablesourceedit",function(){this.toggleSourceEdit(false)
}.createDelegate(this),this);
this.initialized=true;
this.fireEvent("initialize",this);
this.doc.editorInitialized=true;
this.pushValue();
if(this.focusOnInitialize){this.deferFocus();
this.focusOnInitialize=false
}},onEditorEvent:function(A){},onFirstFocus:function(){this.activated=true;
this.fireEvent("activate",this)
},focus:function(B,A){if(this.rendered){if(!this.sourceEditMode){if(this.initialized){this.editorKernel.focus()
}else{this.focusOnInitialize=true
}}else{this.el.focus()
}}else{this.focusOnInitialize=true
}},blur:function(){if(this.rendered){if(!this.sourceEditMode){if(this.initialized){this.editorKernel.blurFocus()
}else{this.focusOnInitialize=false
}}else{this.el.blur()
}}else{this.focusOnInitialize=false
}},onDestroy:function(){if(this.monitorTask){CQ.Ext.TaskMgr.stop(this.monitorTask)
}if(this.rendered){this.editorKernel.destroyToolbar();
this.iframeWrap.innerHTML="";
this.iframeWrap.remove();
this.wrap.dom.innerHTML="";
this.wrap.remove()
}},syncValue:function(){if(this.initialized){var A=this.editorKernel.getProcessedHtml();
if(this.fireEvent("beforesync",this,A)!==false){this.el.dom.value=A;
this.fireEvent("sync",this,A)
}}},getRawValue:function(){if(this.sourceEditMode){this.pushValue()
}this.syncValue();
return CQ.form.RichText.superclass.getRawValue.call(this)
},getValue:function(){return this.getRawValue()
},pushValue:function(){if(this.initialized){var A=this.el.dom.value;
if(this.fireEvent("beforepush",this,A)!==false){if(!CQ.Ext.isGecko){this.editorKernel.setUnprocessedHtml(A)
}else{this.getEditorBody().innerHTML="";
var B=this.doc.designMode;
this.doc.designMode="off";
this.editorKernel.setUnprocessedHtml(A);
this.doc.designMode=B;
if(this.doc.designMode=="on"){this.editorKernel.initializeGeckoSpecific.defer(10,this.editorKernel)
}}this.fireEvent("push",this,A)
}}},setValue:function(A){this.value=A;
if(this.rendered){this.el.dom.value=(A===null||A===undefined?"":A)
}this.pushValue();
if(this.rendered){this.validate()
}(function(){if(this.initialized){this.editorKernel.initializeCaret()
}this.editorKernel.execCmd("initializeundo")
}).defer(1,this)
},enable:function(){this.doc.designMode="on";
this.enableDropping();
this.el.dom.disabled=false;
CQ.form.RichText.superclass.enable.call(this);
this.editorKernel.enable()
},disable:function(){this.editorKernel.disable();
this.disableDropping();
this.el.dom.disabled=true;
this.doc.designMode="off";
CQ.form.RichText.superclass.disable.call(this)
},createToolbar:function(){this.editorKernel.createToolbar({renderToDom:this.wrap.dom.firstChild});
this.editorKernel.disableToolbar()
},updateToolbar:function(){if(!this.activated){this.onFirstFocus();
return 
}this.editorKernel.updateToolbar()
},toggleSourceEdit:function(A){if(A===undefined){A=!this.sourceEditMode
}this.sourceEditMode=A===true;
var C=this.editorKernel.getToolbarItem("sourceedit");
if(C.pressed!==this.sourceEditMode){C.toggle(this.sourceEditMode);
return 
}if(this.sourceEditMode){this.editorKernel.disableFocusHandling();
this.editorKernel.notifyBlur();
this.editorKernel.disableToolbar(["sourceedit"]);
this.disableDropping();
this.syncValue();
this.iframe.className="x-hidden";
this.el.removeClass("x-hidden");
this.el.dom.removeAttribute("tabIndex");
this.el.focus()
}else{this.editorKernel.enableFocusHandling();
if(this.initialized&&!this.disabled){this.editorKernel.enableToolbar()
}if(!this.disabled){this.enableDropping()
}this.pushValue();
this.iframe.className="";
this.el.addClass("x-hidden");
this.el.dom.setAttribute("tabIndex",-1);
this.deferFocus()
}var B=this.lastSize;
if(B){delete this.lastSize;
this.setSize(B)
}this.fireEvent("editmodechange",this,this.sourceEditMode)
},enableDropping:function(){this.isDroppingAllowed=true
},disableDropping:function(){this.isDroppingAllowed=false
},getToplevel:function(){var A=this.findParentByType("dialog");
if(!A){A=this.findParentByType(CQ.Ext.form.FormPanel)
}return A
},initializeDragAndDrop:function(){if(!this.ddGroups){this.ddGroups=[CQ.wcm.EditBase.DD_GROUP_PAGE,CQ.wcm.EditBase.DD_GROUP_ASSET]
}if(typeof (this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var E=this;
var F=new CQ.wcm.EditBase.DropTarget(this.wrap,{notifyDrop:function(J,G,I){if(J&&J.clearAnimations){J.clearAnimations(this)
}if(J.isDropAllowed(this)){var H=E.handleDrop(I);
if(H){G.stopEvent()
}return H
}}});
var C=this.getToplevel();
if(C){C.on("activate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F);
C.on("deactivate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F)
}for(var B=0;
B<this.ddGroups.length;
B++){F.addToGroup(this.ddGroups[B])
}F.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var A=this.ddAccept;
if(A){if(!CQ.Ext.isArray(A)){var D=new RegExp("[ ;]+","g");
A=A.split(D)
}F.ddAccept=A
}this.dropTargets=[F]
},preventDrop:function(){this.savedDropTargets=this.dropTargets;
this.dropTargets=null
},reactivateDrop:function(){this.dropTargets=this.savedDropTargets
},handleDrop:function(E){var B=CQ.form.rte.Selection;
var C=CQ.form.rte.Common;
if(E.records&&E.single){var F=E.records[0];
var H=CQ.HTTP.encodePath(F.get("path"));
var A=F.get("mimeType");
var D=(A=="");
var I=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(I&&B.isSelection(I)){if(D){H=H+CQ.HTTP.EXTENSION_HTML
}this.editorKernel.relayCmd("modifylink",{url:H})
}else{if(C.strStartsWith(A,"image/")){var G={path:H};
this.editorKernel.relayCmd("insertimg",G)
}}return true
}return false
},isDropAllowedForObject:function(E){var C=CQ.form.rte.Selection;
var B=CQ.form.rte.Common;
if(E.records&&E.single&&this.isDroppingAllowed){var A=E.records[0];
var F=A.get("mimeType");
var D=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(D&&C.isSelection(D)){return true
}if(!D||!C.isSelection(D)){if(B.strStartsWith(F,"image/")){return true
}}}return false
}});
CQ.Ext.reg("richtext",CQ.form.RichText);
CQ.form.rte.EditContext=CQ.Ext.extend(CQ.Ext.emptyFn,{iFrame:null,win:null,doc:null,root:null,constructor:function(A,D,C,B){this.iFrame=A;
this.win=D;
this.doc=C;
this.root=B
},createElement:function(A){return(this.doc!=null?this.doc.createElement(A):null)
},createTextNode:function(A){return(this.doc!=null?this.doc.createTextNode(A):null)
},isInitialized:function(){return(this.win!=null)&&(this.doc!=null)&&(this.root!=null)
}});
CQ.form.rte.EditorKernel=CQ.Ext.extend(CQ.Ext.emptyFn,{removeSingleParagraphContainer:false,singleParagraphContainerReplacement:null,linkInternalize:null,htmlRules:null,preProcessor:null,postProcessor:null,registeredCommands:null,registeredPlugins:null,editContext:null,internalListeners:null,uiListeners:null,tb:null,contextMenuBuilder:null,contextMenu:null,contextMenuSavedRange:null,registeredHandlers:null,isEventingDisabled:false,isTemporaryBlur:false,isFocusHandlingDisabled:false,hasFocus:false,isEnabled:false,focusGainActions:null,constructor:function(C){C=C||{};
CQ.Util.applyDefaults(C,{linkInternalize:[{tag:"a",attribute:"href"},{tag:"img",attribute:"src"}]});
this.registeredCommands=CQ.form.rte.commands.CommandRegistry.createRegisteredCommands();
this.registeredPlugins=CQ.form.rte.plugins.PluginRegistry.createRegisteredPlugins(this);
CQ.form.rte.Compatibility.moveDeprecatedPluginConfig(C);
CQ.form.rte.Compatibility.moveDeprecatedHtmlRules(C);
CQ.form.rte.Compatibility.configurePlugins(C,this);
delete C.rtePlugins;
if(C.htmlRules){this.htmlRules=new CQ.form.rte.HtmlRules(C.htmlRules);
delete C.htmlRules
}else{this.htmlRules=new CQ.form.rte.HtmlRules()
}this.linkInternalize=C.linkInternalize;
delete C.linkInternalize;
var B={};
if(this.tagReplace){for(var A in this.tagReplace){var D=this.tagReplace[A];
B[A]={rename:D}
}}this.preProcessor=new CQ.form.rte.DomCleanup({tagsToRemove:["font"]});
this.postProcessor=new CQ.form.rte.DomCleanup({tagsToRemove:["font"]});
this.contextMenuBuilder=new CQ.form.rte.ui.ContextMenuBuilder(this);
this.registeredHandlers=[];
this.isEnabled=true;
this.focusGainActions={}
},getEditContext:function(){if(this.editContext==null){this.editContext=new CQ.form.rte.EditContext()
}return this.editContext
},getHtmlRules:function(){return this.htmlRules
},getContentPath:function(){return null
},getFocusDom:function(A){return null
},focus:function(A){},blurFocus:function(A){},calculateWindowPosition:function(A){return[0,0]
},calculateContextMenuPosition:function(A){return[0,0]
},deferFocus:function(A){(function(){this.focus();
if(A&&(typeof (A)=="function")){A()
}}).defer(10,this)
},disableEventHandling:function(){this.isEventingDisabled=true
},reenableEventHandling:function(){this.isEventingDisabled=false
},enableFocusHandling:function(){this.isFocusHandlingDisabled=false
},disableFocusHandling:function(){this.isFocusHandlingDisabled=true
},initializeGeckoSpecific:function(){if(CQ.Ext.isGecko&&this.isEnabled){var A=this.getEditContext();
if(A.isInitialized()){try{A.doc.execCmd("useCSS",true)
}catch(B){}try{A.doc.execCommand("styleWithCSS",false,false)
}catch(B){}try{A.doc.execCommand("enableInlineTableEditing",false,false)
}catch(B){}}}},initializeCaret:function(B){if(this.hasFocus){var A=this.getEditContext();
CQ.form.rte.Selection.resetSelection(A,"start")
}else{if(B){this.focusGainActions.initializeCaret=true
}}},registerHandler:function(E,A,D,C,B){CQ.Ext.EventManager.on(E,A,D,C,B);
this.registeredHandlers.push({obj:E,eventName:A,handler:D,scope:C})
},registerHandlers:function(F,C,E,B){for(var A in C){if(C.hasOwnProperty(A)){var D=C[A];
this.registerHandler(F,A,D,E,B)
}}},unregisterHandlers:function(){var C=this.registeredHandlers.length;
for(var A=0;
A<C;
A++){var B=this.registeredHandlers[A];
CQ.Ext.EventManager.un(B.obj,B.eventName,B.handler,B.scope)
}this.registeredHandlers.length=0
},initializeEventHandling:function(){var A=this.getEditContext();
if(A.isInitialized()&&this.isEnabled){var B=A.doc;
if(CQ.Ext.isIE){this.registerHandlers(B,{selectionchange:function(C){this.onEditorEvent(C)
},keyup:function(C){this.onEditorEvent(C);
if(this.isEventingDisabled){return 
}this.firePluginEvent("keyup",{extEvent:C},true)
},mouseup:function(C){if(this.isEventingDisabled){return 
}this.firePluginEvent("mouseup",{extEvent:C},true)
}},this,{buffer:100})
}else{this.registerHandlers(B,{keyup:function(C){this.onEditorEvent(C);
if(this.isEventingDisabled){return 
}this.firePluginEvent("keyup",{extEvent:C},true)
},mouseup:function(C){this.onEditorEvent(C);
if(this.isEventingDisabled){return 
}this.firePluginEvent("mouseup",{extEvent:C},true)
}},this,{buffer:100})
}this.registerHandlers(B,{keydown:function(C){if(this.isEventingDisabled){return 
}this.firePluginEvent("keydown",{extEvent:C},true)
},mousedown:function(C){if(this.isEventingDisabled){return 
}this.firePluginEvent("mousedown",{extEvent:C},true)
}},this,{buffer:100});
if(CQ.Ext.isGecko){this.registerHandler(B,"keypress",this.applyCommand,this)
}this.registerHandlers(B,{keydown:function(D){if(this.isEventingDisabled){return 
}var C={extEvent:D,cancelKey:false};
this.firePluginEvent("beforekeydown",C,false);
if(!C.cancelKey){this.firePluginEvent("keydown",{extEvent:D},false)
}if(C.cancelKey){D.stopEvent();
this.deferFocus()
}},keyup:function(D){if(this.isEventingDisabled){return 
}var C={extEvent:D,cancelKey:false};
this.firePluginEvent("beforekeyup",C,false);
if(!C.cancelKey){this.firePluginEvent("keyup",{extEvent:D},false)
}if(C.cancelKey){D.stopEvent();
this.deferFocus()
}},mousedown:function(C){if(this.isEventingDisabled){return 
}this.firePluginEvent("mousedown",{extEvent:C},false)
},mouseup:function(C){if(this.isEventingDisabled){return 
}this.firePluginEvent("mouseup",{extEvent:C},false)
}},this);
this.registerHandlers(this.getFocusDom(A),{focus:function(C){this.onFocus(C)
},blur:function(C){this.onBlur(C)
}},this);
this.initializeGeckoSpecific();
this.registerHandler(A.root,"contextmenu",function(C){if(this.isEventingDisabled){return false
}this.isEventingDisabled=true;
C.preventDefault();
if(!this.handleContextMenu(C)){this.isEventingDisabled=false
}return false
},this)
}},suspendEventHandling:function(){this.unregisterHandlers()
},onFocus:function(D){if(!this.hasFocus){if(CQ.Ext.isIE){var C=this.getEditContext();
var E=C.win;
var A=CQ.form.rte.Selection.getLeadRange(C);
var B;
if(A.item){B=A.item(0).ownerDocument.parentWindow
}else{B=A.parentElement().ownerDocument.parentWindow
}var F=(B==E);
if(!F){return 
}}this.isEventingDisabled=false;
this.hasFocus=true;
if(!this.isFocusHandlingDisabled){this.enableToolbar();
this.updateToolbar()
}this.onEditorEvent(D);
if(this.focusGainActions.initializeCaret){this.initializeCaret(false);
this.focusGainActions.initializeCaret=false
}}},onBlur:function(A){if(this.hasFocus){this.isEventingDisabled=true;
this.isTemporaryBlur=false;
this.hasFocus=false;
if(!this.isFocusHandlingDisabled){(function(){if(this.isEventingDisabled&&!this.isTemporaryBlur){this.disableToolbar()
}}).defer(100,this)
}}},notifyBlur:function(){if(this.hasFocus){this.onBlur()
}},onEditorEvent:function(B){var A=false;
if(CQ.Ext.isGecko){A=(B.type=="mouseup")&&(B.button==2)
}else{if(CQ.Ext.isIE){A=(B.type=="selectionchange")
}}if(!A){if(this.contextMenu&&this.contextMenu.isVisible()){this.contextMenu.hide();
this.isEventingDisabled=false
}}if(this.isEventingDisabled){return 
}this.fireUIEvent("updatestate")
},getEmptyLinePlaceholderMarkup:function(){if(CQ.Ext.isGecko){return"<p><br></p>"
}return"<p></p>"
},setUnprocessedHtml:function(B){if(B.length<1){var C=this.execContentInterception("emptyContent",null);
if(C!=null){B=C
}else{B=this.getEmptyLinePlaceholderMarkup()
}}var A=this.getEditContext();
this.htmlRules.serializer.deserialize(A,B,A.root,this.htmlRules.docType);
CQ.form.rte.WhitespaceProcessor.process(A,A.root);
this.preProcessor.preprocess(this,A.root);
this.execContentInterception("postprocessDom",{editContext:A})
},getProcessedHtml:function(){var B=this.getEditContext();
var A=B.root.cloneNode(true);
this.execContentInterception("cleanDom",{editContext:this.getEditContext(),root:A});
this.postProcessor.postprocess(this,A);
return this.htmlRules.serializer.serialize(B,A,this.htmlRules.docType)
},preprocessSourceEdit:function(){var A=this.getEditContext();
return this.htmlRules.serializer.serialize(A,A.root,this.htmlRules.docType)
},postprocessSourceEdit:function(A){return A
},getCustomCommand:function(D){var C=this.registeredCommands[D];
if(C){return C
}for(var B in this.registeredCommands){var A=this.registeredCommands[B];
if(A.isCommand(D)){return A
}}return null
},relayCmd:function(B,A){if(!this.isEnabled){return 
}(function(){var D=this.getEditContext();
var F=CQ.form.rte.Selection;
if(D.isInitialized()){this.focus(D)
}try{var E;
if(D.isInitialized()){E=(CQ.Ext.isIE?null:F.getPreferredScrollOffset(D))
}var C=this.execCmd(B,A,D);
if(CQ.Ext.isGecko&&C&&D.isInitialized()){if(C.geckoEnsureCaretVisibility){F.ensureCaretVisibility(D,E)
}if(C.bookmark){F.selectBookmark(D,C.bookmark)
}}}catch(G){if(G.message=="Cannot paste."){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Paste"),CQ.I18n.getMessage("Could not paste due to security restrictions of the browser.<br>Please use Ctrl+V to paste directly."),this.deferFocus,this)
}else{if(G.message=="Cannot copy."){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Copy"),CQ.I18n.getMessage("Could not copy due to security restrictions of the browser.<br>Please use Ctrl+C to copy directly."),this.deferFocus,this)
}else{if(G.message=="Cannot cut."){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Cut"),CQ.I18n.getMessage("Could not cut due to security restrictions of the browser.<br>Please use Ctrl+X to cut directly."),this.deferFocus,this)
}else{if(G.message=="Could not insert html due to IE limitations."){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not insert text due to internal Internet Explorer limitations. Please try to select a smaller text fragment and try again."),this.deferFocus,this)
}else{throw G
}}}}}this.fireUIEvent("updatestate")
}).defer(10,this)
},execCmd:function(F,K,A){var B=CQ.form.rte.Selection;
var L=CQ.form.rte.DomProcessor;
var D=CQ.form.rte.commands.Command;
var C=CQ.form.rte.Common;
if(!this.isEnabled){return null
}if(!A){A=this.getEditContext()
}var E=this.getCustomCommand(F);
if(!A.isInitialized()&&!E){return null
}if(!A.isInitialized()){if(E.requiresInitializedComponent(F)){return null
}}if(this.initialized){this.firePluginEvent("beforecommandexecuted",{cmd:F,cmdValue:K,customCommand:E},false)
}var I=null;
if(E){var M=E.getProcessingOptions();
var G={editContext:A,command:F,value:K,component:this};
if(A.isInitialized()){if((M&D.PO_SELECTION)>0){G.selection=this.createQualifiedSelection(A);
if(G.selection&&B.shouldNormalizePSel(A,G.selection)){B.normalizeProcessingSelection(A,G.selection)
}}if((M&D.PO_BOOKMARK)>0){if(G.selection){G.bookmark=B.bookmarkFromProcessingSelection(A,G.selection)
}else{G.bookmark=B.createSelectionBookmark(A)
}}if((M&D.PO_NODELIST)>0){if(!G.selection){G.selection=this.createQualifiedSelection(A)
}G.nodeList=L.createNodeList(A,G.selection)
}}var J=E.execute(G);
if(A.isInitialized()){var H=G.bookmark;
if(H&&J&&J.selOffset){if(J.selOffset.start){H.startPos+=J.selOffset.start
}if(J.selOffset.collapse){H.charCnt=0
}else{if(J.selOffset.cnt){H.charCnt+=J.selOffset.cnt
}}}if(H){B.selectBookmark(A,H)
}}if(J&&J.calleeRet){I=J.calleeRet
}}else{A.doc.execCommand(F,false,K===undefined?null:K);
if(CQ.Ext.isGecko&&C.strStartsWith(F,"insert")&&C.strEndsWith(F,"list")){L.ensureBlockContent(A,"p",null,true,false)
}}if(A.isInitialized()){this.firePluginEvent("commandexecuted",{cmd:F,cmdValue:K,customCommand:E},false)
}return I
},queryState:function(D,A){if(!this.isEnabled){return false
}var B=this.getEditContext();
if(!B.isInitialized){return false
}var C=this.getCustomCommand(D);
if(!C){return B.doc.queryCommandState(D)
}if(!A){A=this.analyzeSelection()
}if(!A){return false
}return C.queryState(A,D)
},applyCommand:function(B){if(B.ctrlKey){var C=B.getCharCode(),A;
if(C>0){C=String.fromCharCode(C);
switch(C){case"b":A="bold";
break;
case"i":A="italic";
break;
case"u":A="underline";
break
}if(A){this.focus();
this.execCmd(A);
this.deferFocus();
B.preventDefault()
}}}},requestSourceEdit:function(A){this.isTemporaryBlur=true;
this.fireUIEvent((A?"enable":"disable")+"sourceedit")
},enable:function(){this.isEnabled=true;
this.initializeEventHandling();
if(this.hasFocus){this.updateToolbar()
}},disable:function(){this.suspendEventHandling();
this.disableToolbar(["sourceedit"]);
this.isEnabled=false
},createQualifiedSelection:function(B){var C=CQ.form.rte.Selection.createProcessingSelection(B);
if(!C){return null
}for(var A in this.registeredPlugins){if(this.registeredPlugins.hasOwnProperty(A)){var D=this.registeredPlugins[A];
D.manipulateSelection(C)
}}return C
},createQualifiedRangeBookmark:function(B){var C=CQ.form.rte.Selection.createRangeBookmark(B);
for(var A in this.registeredPlugins){if(this.registeredPlugins.hasOwnProperty(A)){var D=this.registeredPlugins[A];
D.saveRangeBookmark(C)
}}return C
},selectQualifiedRangeBookmark:function(B,C){CQ.form.rte.Selection.selectRangeBookmark(B,C);
for(var A in this.registeredPlugins){if(this.registeredPlugins.hasOwnProperty(A)){var D=this.registeredPlugins[A];
D.restoreRangeBookmark(C)
}}},analyzeSelection:function(C){var E=CQ.form.rte.Selection;
var K=CQ.form.rte.DomProcessor;
if(!C){C=this.getEditContext()
}var I=false;
var B=[];
var D=[];
var A={};
var H=[];
var J=this.createQualifiedSelection(C);
if(!J){return null
}I=E.isSelection(J);
if(E.shouldNormalizePSel(C,J)){E.normalizeProcessingSelection(C,J)
}var F=K.createNodeList(C,J);
F.getAnchors(C,B,true);
F.getNamedAnchors(C,D,true);
if(I){F.getStyles(C,A,true)
}else{var G=J.startNode;
K.getStyles(C,A,G)
}var L=F.commonAncestor;
while(L){if(L==C.root){break
}H.push(L);
L=L.parentNode
}var N=E.getSelectedDom(J);
var M=(A.styles?A.styles:[]);
return{selection:J,selectedDom:N,nodeList:F,isSelection:I,anchorCount:B.length,anchors:B,namedAnchorCount:D.length,namedAnchors:D,styleCount:M.length,styles:M,isContinuousStyle:A.isContinuousStyle,consistentFormatting:H,containerList:K.createContainerList(C,J),auxRoots:K.getAuxRoots(C,J),editContext:C}
},addPluginListener:function(F,H,J,E,D,I){if(I==null){I=1000
}if(!this.internalListeners){this.internalListeners={}
}if(!this.internalListeners[F]){this.internalListeners[F]=[]
}var G=this.internalListeners[F];
var A=G.length;
var K={fn:J?H.createDelegate(J):H,plugin:E,deferred:D,priority:I};
for(var B=0;
B<A;
B++){var C=G[B];
if(C.priority>I){G.splice(B,0,K);
return 
}}G.push(K)
},removePluginListener:function(B,E){if(!this.internalListeners||!this.internalListeners[B]){return 
}var D=this.internalListeners[B];
var C=D.length;
for(var A=C-1;
A>=0;
A--){if(D[A].plugin==E){D.splice(A,1)
}}},firePluginEvent:function(B,F,E){if(!this.internalListeners||!this.internalListeners[B]){return 
}F=F||{};
F.name=B;
F.editContext=this.getEditContext();
var C=this.internalListeners[B].length;
for(var A=0;
A<C;
A++){var D=this.internalListeners[B][A];
if(D&&D.fn){if(D.deferred==E){D.fn(F)
}}}},execContentInterception:function(E,A){for(var B in this.registeredPlugins){if(this.registeredPlugins.hasOwnProperty(B)){var C=this.registeredPlugins[B];
var D=C.interceptContent(E,A);
if(D!=null){return D
}}}return null
},addUIListener:function(A,C,B){if(!this.uiListeners){this.uiListeners={}
}if(!this.uiListeners[A]){this.uiListeners[A]=[]
}this.uiListeners[A].push({fn:B?C.createDelegate(B):C})
},removeUIListener:function(A){if(!this.uiListeners||!this.uiListeners[A]){return 
}delete this.uiListeners[A]
},fireUIEvent:function(B,E){if(!this.uiListeners||!this.uiListeners[B]){return 
}E=E||{};
E.name=B;
E.editContext=this.getEditContext();
var C=this.uiListeners[B].length;
for(var A=0;
A<C;
A++){var D=this.uiListeners[B][A];
if(D&&D.fn){D.fn(E)
}}},getToolbarHeight:function(){if(this.tb==null){return 0
}var A=0;
for(var B=0;
B<this.tb.length;
B++){A+=this.tb[B].el.getHeight()
}return A
},getToolbarItem:function(C){var B=this.tb.length;
for(var D=0;
D<B;
D++){var A=this.tb[D].items.get(C);
if(A){return A
}}return null
},createToolbar:function(C){var B=this.createToolbarBuilder();
for(var A in this.registeredPlugins){var D=this.registeredPlugins[A];
D.initializeUI(B)
}this.tb=B.createToolbar(C)
},createToolbarBuilder:function(){return null
},updateToolbar:function(){if(!this.isEnabled){return 
}var B=this.analyzeSelection();
if(!B){return 
}for(var A in this.registeredPlugins){var C=this.registeredPlugins[A];
C.updateState(B)
}if(!this.contextMenu||!this.contextMenu.isVisible()){CQ.Ext.menu.MenuMgr.hideAll()
}},enableToolbar:function(){var A=this.tb.length;
for(var B=0;
B<A;
B++){this.tb[B].items.each(function(C){C.enable()
})
}},disableToolbar:function(A){var B=this.tb.length;
for(var C=0;
C<B;
C++){this.tb[C].items.each(function(D){if((A==null)||!CQ.form.rte.Common.arrayContains(A,D.itemId)){D.disable()
}})
}},destroyToolbar:function(){var A=this.tb.length;
for(var B=0;
B<A;
B++){this.tb[B].items.each(function(C){if(C.menu){C.menu.removeAll();
if(C.menu.el){C.menu.el.destroy()
}}C.destroy()
})
}},handleContextMenu:function(F){var E=CQ.form.rte.DomProcessor;
this.contextMenuBuilder.clear();
var C=this.getEditContext();
var D=this.createQualifiedSelection(C);
if(!D){return false
}var B=E.createNodeList(C,D);
var A={selection:D,nodeList:B};
for(var H in this.registeredPlugins){if(this.registeredPlugins.hasOwnProperty(H)){this.registeredPlugins[H].handleContextMenu(this.contextMenuBuilder,A,C)
}}this.contextMenu=this.contextMenuBuilder.build(A,C);
if(this.contextMenu){this.contextMenuSavedRange=this.createQualifiedRangeBookmark(C);
var G=this.calculateContextMenuPosition(F);
this.contextMenu.showAt([G[0],G[1]]);
return true
}return false
}});
CQ.form.rte.IFrameKernel=CQ.Ext.extend(CQ.form.rte.EditorKernel,{contentPath:null,constructor:function(A){CQ.form.rte.IFrameKernel.superclass.constructor.call(this,A)
},initializeEditContext:function(A,D,C,B){this.editContext=new CQ.form.rte.EditContext(A,D,C,B)
},getContentPath:function(){return this.contentPath
},getFocusDom:function(A){if(!A){A=this.getEditContext()
}return A.win
},focus:function(A){if(!A){A=this.getEditContext()
}if(A.win){A.win.focus()
}},blurFocus:function(A){if(!A){A=this.getEditContext()
}if(A.win){A.win.blur()
}},calculateWindowPosition:function(B){var A=null;
switch(B){default:A=this.getEditorPosition();
break
}return A||[0,0]
},calculateContextMenuPosition:function(D){var E=this.getEditContext();
var B=this.getEditorPosition();
var H=[0,0];
if(CQ.Ext.isGecko){H=[E.root.scrollLeft,E.root.scrollTop]
}else{if(CQ.Ext.isIE){var C=CQ.WCM.getContentWindow()||CQ.WCM.getTopWindow();
var F=C.document;
var A=F.body;
H=[F.documentElement.scrollLeft||A.scrollLeft,F.documentElement.scrollTop||A.scrollTop]
}}var G=D.getPoint();
return[B[0]+G.x-H[0],B[1]+G.y-H[1]]
},createToolbarBuilder:function(){return new CQ.form.rte.ui.IFrameToolbarBuilder()
},setContentPath:function(A){this.contentPath=A
},getEditorPosition:function(){var A=this.getEditContext();
if(!A.iFrame){return null
}return CQ.Ext.get(A.iFrame).getXY()
}});
CQ.form.rte.DivKernel=CQ.Ext.extend(CQ.form.rte.EditorKernel,{contentPath:null,constructor:function(A){CQ.form.rte.DivKernel.superclass.constructor.call(this,A)
},initializeEditContext:function(C,B,A){this.editContext=new CQ.form.rte.EditContext(null,C,B,A)
},getContentPath:function(){return this.contentPath
},getFocusDom:function(A){if(!A){A=this.getEditContext()
}return A.root
},focus:function(A){if(!A){A=this.getEditContext()
}if(A.root){A.root.focus()
}},blurFocus:function(A){if(!A){A=this.getEditContext()
}if(A.root){A.root.blur()
}},calculateWindowPosition:function(D){var B=this.getEditContext();
var A=null;
var C=B.doc.documentElement.scrollTop||B.doc.body.scrollTop;
switch(D){default:A=[0,C];
break
}return A||[0,0]
},calculateContextMenuPosition:function(A){var B=A.getPoint();
return[B.x,B.y]
},createToolbarBuilder:function(){return new CQ.form.rte.ui.GlobalToolbarBuilder()
},setContentPath:function(A){this.contentPath=A
}});
CQ.form.rte.Common=function(){var C=true;
var B=function(F,K,E,P){var H=CQ.form.rte.Common;
if(K.nodeType==3){var S=H.getNodeCharacterCnt(K);
var G=E.charPos+S;
if((P>=E.charPos)&&(P<G)){E.node={dom:K,start:E.charPos,offset:P-E.charPos,nodeBefore:E.nodeBefore};
return 
}else{if(P==G){E.nodeBefore=K;
E.startBefore=E.charPos
}}E.charPos+=S
}else{if(K.nodeType==1){if(H.isOneCharacterNode(K)){if(E.charPos==P){E.node={isNodeSelection:true,startOfElement:true,dom:K};
return 
}E.charPos++
}else{if(H.isTag(K,H.EDITBLOCK_UNREGNEST_TAGS)){if((H.getChildIndex(K)==0)&&H.isFirstNestedList(F,K.parentNode)){var R=K;
do{R=H.getParentNode(F,R);
if(R&&H.isTag(R,H.EDITBLOCK_UNREGNEST_TAGS)){if(E.charPos==P){var Q=E.nodeBefore;
var N=H.getNodeCharacterCnt(Q);
var I=Q.parentNode;
E.node={dom:Q,offset:N,parentDom:I,isUnregularNestedIssue:true,nestedItemDom:K};
return 
}E.charPos++;
break
}}while(R)
}}var J=E.charPos;
var O=K.childNodes.length;
for(var M=0;
M<O;
M++){B(F,K.childNodes[M],E,P);
if(E.node){if(!E.node.parentDom){E.node.parentDom=K;
E.node.parentStart=J;
E.node.parentOffset=P-J
}return 
}}if(H.isTag(K,H.EDITBLOCK_TAGS)){var D=true;
var L=null;
if(H.isTag(K,H.EDITBLOCK_NESTED_TAGS)){L=H.EDITBLOCK_NESTED_TAGS
}else{if(H.isTag(K,H.EDITBLOCK_UNREGNEST_TAGS)){L=H.EDITBLOCK_UNREGNEST_TAGS
}}if(L!=null){D=!H.isLastChildDeep(K,L)
}if(D){if(E.charPos==P){E.node={isNodeSelection:true,startOfElement:false,dom:K};
return 
}E.charPos++
}}}}}};
var A=function(E,G,H,L){var F=CQ.form.rte.Common;
if(F.isTag(L,F.EDITBLOCK_UNREGNEST_TAGS)){if((F.getChildIndex(L)==0)&&F.isFirstNestedList(E,L.parentNode)){var M=L;
do{M=F.getParentNode(E,M);
if(M&&F.isTag(M,F.EDITBLOCK_UNREGNEST_TAGS)){H++;
break
}}while(M)
}}if(L==G){return{isFound:true,charPos:H}
}if(L.nodeType==3){H+=F.getNodeCharacterCnt(L);
return{isFound:false,charPos:H}
}if(L.nodeType==1){if(F.isOneCharacterNode(L)){H++
}else{var K=L.childNodes.length;
for(var J=0;
J<K;
J++){var I=A(E,G,H,L.childNodes[J]);
if(I.isFound){return I
}H=I.charPos
}if(F.isTag(L,F.EDITBLOCK_TAGS)){var D=true;
if(F.isTag(L,F.EDITBLOCK_NESTED_TAGS)){D=!F.isLastElementOfNestingLevel(E,L)
}else{if(F.isTag(L,F.EDITBLOCK_UNREGNEST_TAGS)){D=!F.isLastChildDeep(L,F.EDITBLOCK_UNREGNEST_TAGS)
}}if(D){H++
}}}return{isFound:false,charPos:H}
}return{isFound:false,charPos:-1}
};
return{isRootNode:function(D,E){return(D.root==E)
},isTag:function(H,D){if(!H||(H.nodeType!=1)){return false
}var G=H.tagName.toLowerCase();
if(!CQ.Ext.isArray(D)){return(G==D.toLowerCase())
}var E=D.length;
for(var F=0;
F<E;
F++){if(G==D[F].toLowerCase()){return true
}}return false
},getNamespace:function(F){if(F&&F.nodeType==1){if(CQ.Ext.isIE){if(F.scopeName!="HTML"){return F.scopeName.toLowerCase()
}}else{var D=F.tagName;
var E=D.indexOf(":");
if(E>0){return D.substring(0,E).toLowerCase()
}}}return null
},insertBefore:function(E,F,D){if(D!=null){E.insertBefore(F,D)
}else{E.appendChild(F)
}},hasAttributes:function(G,F){if(!G||(G.nodeType!=1)){return false
}for(var D in F){if(F.hasOwnProperty(D)){if((D=="_class")||(D=="className")){D="class"
}var E=CQ.form.rte.Common.getAttribute(G,D);
if(E!=F[D]){return false
}}}return true
},isAttribDefined:function(F,E){var D=CQ.form.rte.Common.getAttribute(F,E,true);
return(D!=null)
},getAttribute:function(H,F,E){if(!H){return null
}var G=F.toLowerCase();
var D;
if((G=="style")&&CQ.Ext.isIE){D=H.style.cssText
}else{D=H.getAttribute(CQ.form.rte.Common.getIEAttributeName(F))
}if(E&&((D!=null)&&(D.length==0))){D=null
}return D
},setAttribute:function(G,E,D){var F=E.toLowerCase();
if((F=="style")&&CQ.Ext.isIE){G.style.cssText=D;
return 
}E=CQ.form.rte.Common.getIEAttributeName(E);
D=G.setAttribute(E,D)
},removeAttribute:function(E,D){if(CQ.Ext.isIE){if(D=="style"){E.style.cssText=null;
return 
}}E.removeAttribute(CQ.form.rte.Common.getIEAttributeName(D))
},copyAttribute:function(G,F,E){var D=G[E];
if(D!=null){F[E]=D
}},copyAttributes:function(P,O,E){var F=CQ.form.rte.Common;
var M,L,J,G;
if(CQ.Ext.isIE6||CQ.Ext.isIE7){var I=F.getIEAttributeNames(P,true);
L=I.length;
for(M=0;
M<L;
M++){G=I[M];
if((E==null)||!F.arrayContains(E,G)){var K;
var H=G.toLowerCase();
if(H=="style"){K=P.style.cssText
}else{if(H=="class"){K=P.getAttribute("className");
G="className"
}else{K=P.getAttribute(G)
}}if(K!=null){if(H=="style"){O.style.cssText=K
}else{O.setAttribute(G,K)
}}}}return 
}var D=P.attributes;
L=D.length;
for(M=0;
M<L;
M++){J=D[M];
G=J.name;
G=(CQ.Ext.isIE8?G.toLowerCase():G);
if((E==null)||!F.arrayContains(E,G)){var N=J.value;
if(CQ.Ext.isIE8){if((G=="colspan")||(G=="rowspan")){if(N=="1"){N=null
}}}if(N!=null){O.setAttribute(G,J.value)
}}}},compareAttributes:function(N,M){var I=CQ.form.rte.Common;
var G,L,J;
var E=N.attributes;
var O=M.attributes;
var D=E.length;
for(var H=0;
H<D;
H++){G=E[H].name;
L=I.getAttribute(N,G,true);
if(L!=null){J=I.getAttribute(M,G,true);
if(J!=L){return false
}}}var K=O.length;
for(var F=0;
F<K;
F++){G=O[F].name;
L=I.getAttribute(M,G,true);
if(L!=null){J=I.getAttribute(N,G,true);
if(J!=L){return false
}}}return true
},getAttributeNames:function(H,L,D){if(CQ.Ext.isIE){return CQ.form.rte.Common.getIEAttributeNames(H,L,D)
}var I=[];
var J=H.attributes.length;
for(var K=0;
K<J;
K++){var F=H.attributes.item(K).nodeName;
var G=F.toLowerCase();
var E=false;
if(D){E=D(H,F,G)
}if(!E){I.push(L?F:G)
}}return I
},getTags:function(H,F,E){if(!E){E=[]
}var D=CQ.form.rte.Common;
if(D.isTag(H,F)){E.push(H)
}if(H.nodeType==1){var G=H.childNodes.length;
for(var I=0;
I<G;
I++){D.getTags(H.childNodes[I],F,E)
}}return E
},containsTag:function(G,E){var D=CQ.form.rte.Common;
if(D.isTag(G,E)){return true
}if(G.nodeType==1){var F=G.childNodes.length;
for(var H=0;
H<F;
H++){if(D.containsTag(G.childNodes[H],E)){return true
}}}return false
},equals:function(F,E){var D=CQ.form.rte.Common;
if(F.nodeType!=E.nodeType){return false
}if(F.nodeType==3){return(F.nodeValue==E.nodeValue)
}if(F.tagName.toLowerCase()!=E.tagName.toLowerCase()){return false
}return D.compareAttributes(F,E)
},addTextNode:function(D,F,L){var K=D.nodeValue;
var J=K.length;
var G=F.childNodes.length;
if(G==0){F.appendChild(D);
return{dom:D,startPos:0,charCnt:J}
}var E=L;
if(E&&(E.nodeType!=3)){E=null
}var I;
if(L){I=L.previousSibling
}else{I=F.lastChild
}if(I&&(I.nodeType!=3)){I=null
}var H=(I?I.nodeValue.length:0);
if(E&&I){I.nodeValue+=K+E.nodeValue;
D=I;
F.removeChild(E)
}else{if(E){E.nodeValue=K+E.nodeValue;
D=E
}else{if(I){I.nodeValue+=K;
D=I
}else{if(L){F.insertBefore(D,L)
}else{F.appendChild(D)
}}}}return{dom:D,startPos:H,charCnt:J}
},getNodeText:function(E){if(E.nodeType!=3){return""
}var D=E.nodeValue;
if(D){D=D.replace(/[\n\t\r]/g,"")
}return D
},isOneCharacterNode:function(H){if(!H||(H.nodeType==3)){return false
}var D=CQ.form.rte.Common;
var G=D.ONE_CHARACTER_NODES;
for(var E=0;
E<G.length;
E++){var F=D.matchesTagDef(H,G[E]);
if(F){return true
}}return false
},isCharacterNode:function(D){if(!D){return false
}return(D.nodeType==3)||CQ.form.rte.Common.isOneCharacterNode(D)
},isEditableNode:function(E){if(!E){return false
}var D=CQ.form.rte.Common;
return D.isCharacterNode(E)||D.isEmptyEditingBlock(E,true)
},containsCharacterNode:function(G){var D=CQ.form.rte.Common;
if(D.isCharacterNode(G)){return true
}if(G.nodeType!=1){return false
}var E=G.childNodes;
var F=E.length;
for(var H=0;
H<F;
H++){if(D.containsCharacterNode(E[H])){return true
}}return false
},getCharacterNodes:function(G,I){var D=CQ.form.rte.Common;
if(!I){I=[]
}if(D.isCharacterNode(G)){I.push(G)
}if(G.nodeType==1){var E=G.childNodes;
var F=E.length;
for(var H=0;
H<F;
H++){D.getCharacterNodes(E[H],I)
}}return I
},isEmptyEditingBlock:function(F,E){var D=CQ.form.rte.Common;
if(F.nodeType==3){return false
}if(!D.isTag(F,D.EDITBLOCK_TAGS)){return false
}if(!E){return(F.childNodes.length==0)
}return !D.containsCharacterNode(F)
},getNodeCharacterCnt:function(F){var D=CQ.form.rte.Common;
if(F.nodeType==1){if(D.isOneCharacterNode(F)){return 1
}return 0
}var E=CQ.form.rte.Common.getNodeText(F);
if(E){return E.length
}return 0
},getNodeTextLength:function(H){var E=CQ.form.rte.Common;
if(H.nodeType==3){return E.getNodeCharacterCnt(H)
}else{if(H.nodeType==1){var D=E.getNodeCharacterCnt(H);
var G=H.childNodes.length;
for(var I=0;
I<G;
I++){var F=H.childNodes[I];
D+=E.getNodeTextLength(F)
}return D
}}return 0
},getNodeAtPosition:function(D,G){var F={node:null,charPos:0,nodeBefore:null};
B(D,D.root,F,G);
var E=F.node;
if(!E){if(!F.nodeBefore){return null
}E={dom:null,nodeBefore:F.nodeBefore}
}return E
},getCharacterOffsetForNode:function(D,E){return A(D,E,0,D.root).charPos
},getPreviousNode:function(D,F){if(F.previousSibling){F=F.previousSibling;
while(true){var E=F.childNodes.length;
if(E==0){return F
}F=F.childNodes[E-1]
}}return CQ.form.rte.Common.getParentNode(D,F)
},getPreviousTextNode:function(E,F,G){var D=CQ.form.rte.Common;
if(G&&D.isTag(F,G)){return null
}do{F=D.getPreviousNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&(F.nodeType!=3));
return F
},getPreviousCharacterNode:function(E,F,G){var D=CQ.form.rte.Common;
if(G&&D.isTag(F,G)){return null
}do{F=D.getPreviousNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&(D.getNodeCharacterCnt(F)==0));
return F
},getPreviousEditableNode:function(E,F,G){var D=CQ.form.rte.Common;
if(!F){return null
}if(G&&D.isTag(F,G)){return null
}do{F=D.getPreviousNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&!D.isEditableNode(F));
return F
},getNextNode:function(D,E){if(E.childNodes.length>0){return E.childNodes[0]
}if(E.nextSibling){return E.nextSibling
}while(true){E=CQ.form.rte.Common.getParentNode(D,E);
if(!E){return null
}if(E.nextSibling){return E.nextSibling
}}},getNextTextNode:function(E,F,G){var D=CQ.form.rte.Common;
do{F=D.getNextNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&(F.nodeType!=3));
return F
},getNextCharacterNode:function(E,F,G){var D=CQ.form.rte.Common;
do{F=D.getNextNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&(D.getNodeCharacterCnt(F)==0));
return F
},getNextEditableNode:function(E,F,G){var D=CQ.form.rte.Common;
if(!F){return null
}do{F=D.getNextNode(E,F);
if(G&&D.isTag(F,G)){F=null;
break
}}while(F&&!D.isEditableNode(F));
return F
},isAncestor:function(D,F,E){do{E=CQ.form.rte.Common.getParentNode(D,E);
if(E){if(E==F){return true
}}}while(E);
return false
},isLastChildDeep:function(H,F){var E=CQ.form.rte.Common;
var D=H;
do{if(D.nodeType!=1){return false
}var G=D.childNodes;
if(G.length==0){return false
}D=G[G.length-1];
if(E.isTag(D,F)){return true
}}while(true)
},isLastElementOfNestingLevel:function(H,I){var F=CQ.form.rte.Common;
while(!F.isTag(I,F.EDITBLOCK_NESTED_TAGS)&&!F.isTag(I,F.EDITBLOCK_UNREGNEST_TAGS)){I=F.getParent(H,I);
if(!I){return false
}}var G=F.getParentNode(H,I);
if(!G){return false
}var E=G.childNodes.length-1;
if(F.getChildIndex(I)!=E){return false
}if(!F.containsTagInPath(H,G,F.EDITBLOCK_UNREGNEST_TAGS)&&!F.containsTagInPath(H,G,F.EDITBLOCK_NESTED_TAGS)){return false
}if(F.isTag(I,["td","th"])){var D=F.getParentNode(H,G);
if(!D){return false
}E=D.childNodes.length-1;
return(F.getChildIndex(G)==E)
}if(F.isTag(I,"li")){var J=I.parentNode;
return F.isLastNestedList(H,J)
}return true
},getChildIndex:function(E){if(!E.parentNode){return -1
}var D=E.parentNode.childNodes.length;
for(var F=0;
F<D;
F++){if(E.parentNode.childNodes[F]==E){return F
}}return -1
},getLastChild:function(F,G){var D=CQ.form.rte.Common;
if(F.nodeType==3){return F
}var E=F.childNodes.length;
if(E==0){return(G?F:null)
}return D.getLastChild(F.childNodes[E-1],true)
},getFirstChild:function(F,G){var D=CQ.form.rte.Common;
if(F.nodeType==3){return F
}var E=F.childNodes.length;
if(E==0){return(G?F:null)
}return D.getFirstChild(F.childNodes[0],true)
},hasTextChild:function(E,D){return(CQ.form.rte.Common.getFirstTextChild(E,D)!=null)
},getFirstTextChild:function(H,D,F){var E=CQ.form.rte.Common;
if(F){if(D){if(E.getNodeCharacterCnt(H)>0){return H
}}else{if(H.nodeType==3){return H
}}}var G=H.childNodes.length;
for(var J=0;
J<G;
J++){var I=E.getFirstTextChild(H.childNodes[J],D,true);
if(I){return I
}}return null
},getLastTextChild:function(H,D,F){var E=CQ.form.rte.Common;
if(F){if(D){if(E.getNodeCharacterCnt(H)>0){return H
}}else{if(H.nodeType==3){return H
}}}var G=H.childNodes.length;
for(var J=G-1;
J>=0;
J--){var I=E.getLastTextChild(H.childNodes[J],D,true);
if(I){return I
}}return null
},childNodesAsArray:function(E){var G=[];
if(E.nodeType==1){var D=E.childNodes.length;
for(var F=0;
F<D;
F++){G.push(E.childNodes[F])
}}return G
},getParentNode:function(D,E){if(E==D.root){return null
}return E.parentNode
},getBlockNode:function(E,F){var D=CQ.form.rte.Common;
while(F){if(D.getParentNode(E,F.parentNode)==null){return F
}F=F.parentNode
}return null
},isBlockNode:function(D,E){return(E&&E.parentNode&&CQ.form.rte.Common.isRootNode(D,E.parentNode))
},getLastBlockNode:function(D,F){while(!CQ.form.rte.Common.isRootNode(D,F)){F=F.parentNode
}var E=D.root.childNodes;
if(E.length==0){return null
}return E[E.length-1]
},hasContent:function(H){if(H.nodeType==3){return true
}var E=H.childNodes.length;
if(E==0){return false
}for(var I=0;
I<E;
I++){var D=H.childNodes[I];
if(D.nodeType==3){var G=D.nodeValue;
G=G.replace(/[\n\t\r \u00A0]/g,"");
if(G.length>0){return true
}}else{var F=CQ.form.rte.Common.hasContent(D);
if(F){return true
}}}return false
},getTagInPath:function(F,H,E,G){var D=CQ.form.rte.Common;
while(H){if(H.nodeType==1){if(H==F.root){return null
}if(D.isTag(H,E)){if(!G||D.hasAttributes(H,G)){return H
}}}H=D.getParentNode(F,H)
}return null
},containsTagInPath:function(E,G,D,F){return(CQ.form.rte.Common.getTagInPath(E,G,D,F)!=null)
},matchesTagDefs:function(H,D){var E=CQ.form.rte.Common;
if(!CQ.Ext.isArray(D)){return E.matchesTagDef(H,D)
}var G=D.length;
for(var F=0;
F<G;
F++){if(CQ.form.rte.Common.matchesTagDef(H,D[F])){return true
}}return false
},matchesTagDef:function(J,H){if(!CQ.form.rte.Common.isTag(J,H.tagName)){return false
}var I,E,G;
if(H.attribsDefined){E=H.attribsDefined.length;
for(I=0;
I<E;
I++){G=H.attribsDefined[I];
if(!J.getAttribute(G)){return false
}}}if(H.attribsUndefined){E=H.attribsUndefined.length;
for(I=0;
I<E;
I++){G=H.attribsUndefined[I];
if(J.getAttribute(G)){return false
}}}if(H.attribValues){var F=H.attribValues;
for(var D in F){if(F.hasOwnProperty(D)){G=J.getAttribute(D);
if(!G){return false
}if(G!=F[D]){return false
}}}}if(H.empty){if(J.childNodes.length>0){return false
}}return true
},getListLevel:function(E,G){var D=CQ.form.rte.Common;
var F=0;
while(G){G=D.getParentNode(E,G);
if(G&&(D.isTag(G,"ul")||D.isTag(G,"ol"))){F++
}}return F
},isFirstNestedList:function(G,D){var E=CQ.form.rte.Common;
var F=E.getTagInPath(G,D,"li");
if(!F){return false
}var I=F.childNodes.length;
for(var J=0;
J<I;
J++){var H=F.childNodes[J];
if(H==D){return true
}if(E.isTag(H,E.LIST_TAGS)){return false
}}return false
},isLastNestedList:function(G,D){var E=CQ.form.rte.Common;
var F=E.getTagInPath(G,D,"li");
if(!F){return false
}var I=F.childNodes.length;
for(var J=I-1;
J>=0;
J--){var H=F.childNodes[J];
if(H==D){return true
}if(E.isTag(H,E.LIST_TAGS)){return false
}}return false
},getChildNodesByType:function(J,G,I,H,N){var F=CQ.form.rte.Common;
N=N||[];
var E=J.childNodes;
var M=E.length;
for(var K=0;
K<M;
K++){var D=E[K];
if(F.isTag(D,G)){N.push(D)
}if(I&&(D.nodeType==1)){var L=H&&F.isTag(D,H);
if(!L){F.getChildNodesByType(D,G,I,H,N)
}}}return N
},getConsistentStyle:function(D,H,E,I){var K=H.length;
var L;
for(var F=0;
F<K;
F++){var G=H[F];
var J=CQ.form.rte.Common.getStyleProp(D,G,E);
J=(J?J:I);
if(F==0){L=J
}else{if(J!=L){return null
}}}return L
},insertNode:function(H,G,I){var F=CQ.form.rte.Common;
if(G.nodeType==1){if(!I){G.parentNode.insertBefore(H,G)
}else{if(I>=G.childNodes.length){G.parentNode.append(H)
}else{var D=G.childNodes[I];
G.parentNode.insertBefore(H,D)
}}return 
}if(I==0){G.parentNode.insertBefore(H,G)
}else{if(I>=F.getNodeCharacterCnt(G)){G.parentNode.insertBefore(H,G.nextSibling)
}else{var K=G.nodeValue;
G.nodeValue=K.substring(0,I);
var E=G.cloneNode(false);
E.nodeValue=K.substring(I,K.length);
var J=G.nextSibling;
var L=G.parentNode;
L.insertBefore(H,J);
L.insertBefore(E,J)
}}},replaceNode:function(D,G,F){var E=D.childNodes;
if(!F){F=G
}while(E.length>0){var H=E[0];
D.removeChild(H);
F.appendChild(H)
}D.parentNode.replaceChild(G,D)
},moveChildren:function(E,L,M,F){var G=CQ.form.rte.Common;
if(M==null){M=0
}var K=E.childNodes.length;
var H=0;
for(var I=K-1;
I>=M;
I--){var J=E.childNodes[I];
E.removeChild(J);
if(!F){G.insertBefore(L,J,L.firstChild)
}else{if(H==0){L.appendChild(J)
}else{var D=L.childNodes[L.childNodes.length-H];
G.insertBefore(L,J,D)
}H++
}}},removeAllChildren:function(D){if(D.nodeType!=1){return 
}while(D.childNodes.length>0){D.removeChild(D.childNodes[0])
}},removeNodesWithoutContent:function(D,F){while(F&&!CQ.form.rte.Common.isRootNode(D,F)){if(F.childNodes.length>0){break
}var E=F.parentNode;
E.removeChild(F);
F=E
}},getStyleProp:function(E,F,D){if(F==E.root){return null
}while(F){if(F.nodeType==1){if(F.style&&F.style[D]){return F.style[D]
}}F=CQ.form.rte.Common.getParentNode(E,F)
}return null
},parseCSS:function(E){if(E.nodeType!=1){return[]
}var D=CQ.form.rte.Common.getAttribute(E,"class");
if(!D){return[]
}return D.split(" ")
},hasCSS:function(G,E){if(G.nodeType!=1){return false
}var D=CQ.form.rte.Common.parseCSS(G);
var F=D.length;
for(var H=0;
H<F;
H++){if(D[H]==E){return true
}}return false
},addClass:function(G,E){var D=CQ.form.rte.Common;
if(!D.hasCSS(G,E)){var F=D.getAttribute(G,"class");
if(F){F+=" "+E
}else{F=E
}D.setAttribute(G,"class",F)
}},removeClass:function(J,H){var E=CQ.form.rte.Common;
var I=E.parseCSS(J);
var G="";
var D=false;
for(var F=0;
F<I.length;
F++){if(I[F]==H){D=true
}else{if(G.length>0){G+=" "
}G+=I[F]
}}if(D){if(G){E.setAttribute(J,"class",G)
}else{E.removeAllClasses(J)
}}},removeAllClasses:function(D){CQ.form.rte.Common.removeAttribute(D,"class")
},getIEAttributeName:function(E){if(CQ.Ext.isIE){var F=E.toLowerCase();
if((F=="class")&&(CQ.Ext.isIE6||CQ.Ext.isIE7)){return"className"
}var D=CQ.form.rte.Common.IE_ATTRIB_NAMES[F];
if(D!=null){E=D
}}return E
},getIEAttributeNames:function(H,N,D){var E=[];
var K=H.outerHTML;
var M=K.indexOf(">");
K=K.substring(0,M+1);
var L=CQ.form.rte.HtmlProcessor.parseTag(K);
var I=L.attributes;
for(var G in I){var F=false;
if(D){F=D(H,J.originalName,G)
}if(!F){if(N){var J=I[G];
E.push(J.originalName)
}else{E.push(G)
}}}return E
},removeJcrData:function(E){for(var D in E){if(CQ.form.rte.Common.strStartsWith(D,"jcr:")){delete E[D]
}else{if(D=="xtype"){delete E[D]
}}}},arrayContains:function(F,D,E){return(CQ.form.rte.Common.arrayIndex(F,D,E)>=0)
},arrayAdd:function(G,D){var E=D.length;
for(var F=0;
F<E;
F++){G.push(D[F])
}},arrayIndex:function(G,D,F){for(var E=0;
E<G.length;
E++){if(!F){if(G[E]==D){return E
}}else{if(F(G[E],D)){return E
}}}return -1
},arrayCopy:function(D){var G=[];
var F=D.length;
for(var E=0;
E<F;
E++){G.push(D[E])
}return G
},toArray:function(H,E,G){if(!H){return null
}if(CQ.Ext.isArray(H)){return H
}if(typeof (H)=="object"){var I=[];
for(var D in H){if(H.hasOwnProperty(D)){if(!E||!G){I.push(H[D])
}else{var F={};
F[E]=D;
F[G]=H[D];
I.push(F)
}}}return I
}return[H]
},objectMerge:function(H,G){for(var E in G){if(G.hasOwnProperty(E)){var F=G[E];
if(typeof (F)=="object"){var D=CQ.Util.copyObject(F);
if(H[E]){CQ.Util.applyDefaults(H[E],D)
}else{H[E]=D
}}else{H[E]=F
}}}},strStartsWith:function(F,E){var D=E.length;
if(F.length>=D){return(F.substring(0,D)==E)
}return false
},strEndsWith:function(G,F){var E=G.length;
var D=F.length;
if(E>=D){return(G.substring(E-D,E)==F)
}return false
},isCaretMovement:function(E){var D=E.getKey();
return(D==E.UP)||(D==E.DOWN)||(D==E.LEFT)||(D==E.RIGHT)||(D==E.PAGE_UP)||(D==E.PAGE_DOWN)||(D==E.HOME)||(D==E.END)
},createIndexPath:function(E,F){var D=CQ.form.rte.Common.getParentNode(E,F);
if(!D){return[]
}var H=CQ.form.rte.Common.getChildIndex(F);
var G=CQ.form.rte.Common.createIndexPath(E,D);
G.push(H);
return G
},compareIndexPaths:function(H,F){var G=H.length;
var E=F.length;
var D=0;
while(true){if(D>=G){if(D>=E){return 0
}return 1
}if(D>=E){return -1
}if(H[D]<F[D]){return 1
}if(H[D]>F[D]){return -1
}D++
}},getOuterHTML:function(E,F){if(CQ.Ext.isIE){return F.outerHTML
}var D=E.createElement("span");
D.appendChild(F.cloneNode(true));
return D.innerHTML
},dumpNode:function(D,F,G){var H=(F?F:"");
if(D){var E=CQ.form.rte.Common.getChildIndex(D);
if(D.nodeType==1){H+=D.tagName
}else{if(D.nodeType==3){H+='"'+D.nodeValue+'"'
}else{if(D.nodeType==8){H+="(comment) "+D.nodeValue
}else{H+="(nodeType #"+D.nodeType+")"
}}}H+=" (parentNode.childNodes["+E+"])"
}else{H+="[No node]"
}if(G){H+=G
}return H
},dumpNodeRecursively:function(F,D){if(!D){D=0
}var G="";
for(var I=0;
I<D;
I++){G+="   "
}G+=CQ.form.rte.Common.dumpNode(F)+"\n";
if(F&&(F.nodeType==1)){var E=F.childNodes.length;
for(var H=0;
H<E;
H++){G+=CQ.form.rte.Common.dumpNodeRecursively(F.childNodes[H],D+1)
}}return G
},dumpObject:function(H,G,F){var E=CQ.form.rte.Common;
var I="";
if(!G){G=0
}var J="";
for(var L=0;
L<G;
L++){J+=" "
}if(!H){return J+"---"
}if(H.hasOwnProperty){for(var D in H){if(H.hasOwnProperty(D)){var K=H[D];
I+=J+D+":";
if((K===null)||(K===undefined)){I+=" [undefined]\n"
}else{if(typeof (K)=="object"){if(K.nodeType&&(K.tagName||K.nodeValue)){if(F){I+="\n"+E.dumpNodeRecursively(K,G+2)
}else{I+=E.dumpNode(K)+"\n"
}}else{I+="\n"+E.dumpObject(K,G+2)
}}else{I+=" "+K+"\n"
}}}}}else{if(H.nodeType){if(F){I+=E.dumpNodeRecursively(H,G)
}else{I+=J+E.dumpNode(H)+"\n"
}}else{I+=J+"[native object]\n"
}}return I
},ieLog:function(G,I){if(!C){return 
}var H=document.getElementById("cqRTEdebug");
if(!H&&I){var E=window.document;
var D=E.body.clientWidth-310;
H=E.createElement("div");
H.id="cqRTEdebug";
H.style.width="300px";
H.style.height="300px";
H.style.position="absolute";
H.style.top="10px";
H.style.left=D+"px";
H.style.zIndex=10000;
H.style.overflowY="scroll";
H.style.border="1px solid";
H.style.fontFamily="sans-serif";
H.style.fontSize="12px";
H.style.backgroundColor="#ffffff";
E.body.appendChild(H)
}if(H){if(!G){G=""
}G=CQ.Ext.util.Format.htmlEncode(G);
var F=true;
if((G.length>0)&&(G.charAt(G.length-1)=="\n")){F=false
}G=G.replace(/\n/g,"<br>");
G=G.replace(/ /g,"&nbsp;");
H.innerHTML=H.innerHTML+G+(F?"<br>":"")
}},setLogEnabled:function(D){C=D;
if(C){CQ.form.rte.Common.ieLog(null,true)
}},ONE_CHARACTER_NODES:[{tagName:"a",attribsDefined:["name"],attribsUndefined:["href"]},{tagName:"img"},{tagName:"br"}],BLOCK_TAGS:["p","h1","h2","h3","h4","h5","h6","div","ol","ul","pre","table","address","blockquote","center","dl","fieldset","form","hr","marquee","noscript","script"],EDITBLOCK_TAGS:["p","h1","h2","h3","h4","h5","h6","div","li","pre","td","th","address","blockquote","center"],EDITBLOCK_NESTED_TAGS:["td","th"],EDITBLOCK_UNREGNEST_TAGS:["li"],HREF_ATTRIB:"_rte_href",SRC_ATTRIB:"_rte_src",TABLE_CELLS:["td","th"],LIST_TAGS:["ul","ol"],IE_ATTRIB_NAMES:{cellpadding:"cellPadding",cellspacing:"cellSpacing",valign:"vAlign",bgcolor:"bgColor"},FILTER_GECKO_TEMPORARY_ATTRIBS:function(G,E,F){var D=CQ.form.rte.Common;
return D.strStartsWith(F,"_moz")||(D.isTag(G,"br")&&(F=="type"))
}}
}();
CQ.form.rte.HtmlProcessor=function(){return{replace:function(text,startPos,endPosIncl,replacement){var preStr="";
if(startPos>0){preStr=text.substring(0,startPos)
}var postStr="";
if((endPosIncl+1)<text.length){postStr=text.substring(endPosIncl+1,text.length)
}return preStr+replacement+postStr
},isBlockTag:function(tagName){var tags=CQ.form.rte.Common.BLOCK_TAGS;
var tagNameLC=tagName.toLowerCase();
var tagCnt=tags.length;
for(var tagIndex=0;
tagIndex<tagCnt;
tagIndex++){if(tags[tagIndex]==tagNameLC){return true
}}return false
},skipWhitespace:function(str,pos){while((pos<str.length)&&(str.charCodeAt(pos)<=32)){pos++
}if(pos>=str.length){return -1
}return pos
},stripSurroundingWhitespace:function(text,excludeSpace){var spaceIndex=0;
var lastValidChar=(excludeSpace?31:32);
while(spaceIndex<text.length){if(text.charCodeAt(spaceIndex)>lastValidChar){break
}spaceIndex++
}if(spaceIndex<text.length){text=text.substring(spaceIndex,text.length)
}else{text=""
}spaceIndex=text.length;
while(spaceIndex>0){spaceIndex--;
if(text.charCodeAt(spaceIndex)>=lastValidChar){break
}}if(spaceIndex>=0){text=text.substring(0,spaceIndex+1)
}else{text=""
}return text
},parseTag:function(tagStr){tagStr=tagStr.replace(/\r\n/g," ");
tagStr=tagStr.replace(/[\r\n\t]/g," ");
var tagDef={tagName:null,attributes:{}};
if(tagStr.length<3){return tagDef
}var firstChar=CQ.form.rte.HtmlProcessor.skipWhitespace(tagStr,0);
if(firstChar<0){return tagDef
}if(tagStr.charAt(firstChar)!="<"){return tagDef
}var closingBrace=tagStr.lastIndexOf(">");
if(closingBrace<=firstChar){return tagDef
}if(closingBrace>0){if(tagStr.charAt(closingBrace-1)=="/"){closingBrace--;
tagDef.isShortTag=true
}}var tagEnd=tagStr.indexOf(" ",firstChar);
if(tagEnd<0){tagDef.tagName=tagStr.substring(firstChar+1,closingBrace).toLowerCase();
return tagDef
}tagDef.tagName=tagStr.substring(firstChar+1,tagEnd).toLowerCase();
var processPos=tagEnd;
while(true){if(processPos>=closingBrace){return tagDef
}processPos=CQ.form.rte.HtmlProcessor.skipWhitespace(tagStr,processPos);
if(processPos<0){return tagDef
}var attribSepPos=tagStr.indexOf("=",processPos);
if(attribSepPos<0){return tagDef
}var originalAttributeName=tagStr.substring(processPos,attribSepPos);
var attributeName=originalAttributeName.toLowerCase();
var spacePos=tagStr.indexOf(" ",attribSepPos+1);
var quotChar='"';
var quotPos=tagStr.indexOf('"',attribSepPos+1);
var aposPos=tagStr.indexOf("'",attribSepPos+1);
var attributeValue;
var valueStartIndex=-1;
var valueCharCnt=-1;
var isQuotedValue=true;
if(quotPos>closingBrace){quotPos=-1
}if(aposPos>closingBrace){aposPos=-1
}if(spacePos>closingBrace){spacePos=-1
}if(aposPos>=0){if((aposPos<quotPos)||(quotPos<0)){quotPos=aposPos;
quotChar="'"
}}if((quotPos>=0)&&((quotPos<spacePos)||(spacePos<0))){var endQuotPos=tagStr.indexOf(quotChar,quotPos+1);
if(endQuotPos<0){return tagDef
}attributeValue=tagStr.substring(quotPos+1,endQuotPos);
valueStartIndex=quotPos+1;
valueCharCnt=(endQuotPos-(quotPos+1));
processPos=endQuotPos+1
}else{var lastCharPos=(spacePos>=0?spacePos:closingBrace);
attributeValue=tagStr.substring(attribSepPos+1,lastCharPos);
isQuotedValue=false;
valueStartIndex=attribSepPos+1;
valueCharCnt=(lastCharPos-(attribSepPos+1));
processPos=lastCharPos+1
}tagDef.attributes[attributeName]={name:attributeName,originalName:originalAttributeName,value:attributeValue,pos:valueStartIndex,cnt:valueCharCnt,quoted:isQuotedValue}
}},parseStyleDef:function(styleStr){styleStr=CQ.Ext.util.Format.htmlDecode(styleStr);
var processPos=0;
var styleDef={};
while(true){processPos=CQ.form.rte.HtmlProcessor.skipWhitespace(styleStr,processPos);
if(processPos<0){return styleDef
}var sepPos=styleStr.indexOf(":",processPos+1);
var styleName=styleStr.substring(processPos,sepPos);
styleName=CQ.form.rte.HtmlProcessor.stripSurroundingWhitespace(styleName);
if(styleName.length==0){return styleDef
}var defEndPos=styleStr.indexOf(";",sepPos+1);
if(defEndPos<0){defEndPos=styleStr.length
}var styleCode=styleStr.substring(sepPos+1,defEndPos);
styleCode=CQ.form.rte.HtmlProcessor.stripSurroundingWhitespace(styleCode);
styleDef[styleName]=styleCode;
processPos=defEndPos+1
}},handleHtmlText:function(htmlStr,callback,startPos,endPos){var noReplacementRet={html:htmlStr,delta:0};
if(!callback.onHtmlText){return noReplacementRet
}if(endPos<=startPos){return noReplacementRet
}var text=htmlStr.substring(startPos,endPos);
var replaceStr=callback.onHtmlText(text);
if(replaceStr==null){return noReplacementRet
}var delta=replaceStr.length-(endPos-startPos);
htmlStr=CQ.form.rte.HtmlProcessor.replace(htmlStr,startPos,endPos-1,replaceStr);
return{html:htmlStr,delta:delta}
},getProcessingTagEndPos:function(htmlStr,dataPos){var strLen=htmlStr.length;
var charAtPos=htmlStr.charAt(dataPos);
if(charAtPos=="!"){if(strLen>dataPos+3){if(htmlStr.substring(dataPos,dataPos+3)=="!--"){return htmlStr.indexOf("-->",dataPos+3)+2
}}return htmlStr.indexOf(">",dataPos+1)
}return htmlStr.indexOf(">",dataPos)
},parseHtml:function(htmlStr,callback){var hpr=CQ.form.rte.HtmlProcessor;
var processingPos=0;
var textPos=0;
var textHandlerResult;
while((processingPos>=0)&&(processingPos<htmlStr.length)){var tagStartPos=htmlStr.indexOf("<",processingPos);
if(tagStartPos>=0){var dataPos=hpr.skipWhitespace(htmlStr,tagStartPos+1);
var firstCharOfTag=htmlStr.charAt(dataPos);
var tagName,tagEndPos,replaceStr;
if((firstCharOfTag=="?")||(firstCharOfTag=="!")){processingPos=hpr.getProcessingTagEndPos(htmlStr,dataPos);
if(processingPos>0){textHandlerResult=hpr.handleHtmlText(htmlStr,callback,textPos,tagStartPos);
htmlStr=textHandlerResult.html;
tagStartPos+=textHandlerResult.delta;
dataPos+=textHandlerResult.delta;
processingPos+=textHandlerResult.delta;
if(callback.onProcessingTag){var pTag=htmlStr.substring(tagStartPos,processingPos+1);
replaceStr=callback.onProcessingTag(pTag);
if(replaceStr!=null){htmlStr=hpr.replace(htmlStr,tagStartPos,processingPos,replaceStr);
processingPos+=replaceStr.length-pTag.length+1
}}else{processingPos++
}textPos=processingPos
}}else{if(firstCharOfTag=="/"){tagEndPos=htmlStr.indexOf(">",dataPos+1);
if(tagEndPos>0){textHandlerResult=hpr.handleHtmlText(htmlStr,callback,textPos,tagStartPos);
htmlStr=textHandlerResult.html;
tagStartPos+=textHandlerResult.delta;
dataPos+=textHandlerResult.delta;
tagEndPos+=textHandlerResult.delta;
tagName=htmlStr.substring(dataPos+1,tagEndPos);
tagName=hpr.stripSurroundingWhitespace(tagName);
if(callback.onTagEnd){var endTagLen=tagEndPos-tagStartPos+1;
replaceStr=callback.onTagEnd(tagName.toLowerCase(),false,tagStartPos,endTagLen);
if(replaceStr!=null){htmlStr=hpr.replace(htmlStr,tagStartPos,tagEndPos,replaceStr);
tagEndPos+=replaceStr.length-endTagLen
}}}else{tagEndPos=dataPos
}processingPos=tagEndPos+1;
textPos=processingPos
}else{tagEndPos=htmlStr.indexOf(">",tagStartPos);
if(tagEndPos>0){var includesClosingTag=false;
if(htmlStr.charAt(tagEndPos-1)=="/"){includesClosingTag=true
}textHandlerResult=hpr.handleHtmlText(htmlStr,callback,textPos,tagStartPos);
htmlStr=textHandlerResult.html;
tagStartPos+=textHandlerResult.delta;
dataPos+=textHandlerResult.delta;
tagEndPos+=textHandlerResult.delta;
var tag=htmlStr.substring(tagStartPos,tagEndPos+1);
var tagDef=hpr.parseTag(tag);
tagName=tagDef.tagName;
if(tagName&&callback.onTagStart){replaceStr=callback.onTagStart(tagName,tagDef.attributes,includesClosingTag,tagStartPos,tag.length,tagStartPos,tag.length);
if(replaceStr!=null){htmlStr=hpr.replace(htmlStr,tagStartPos,tagEndPos,replaceStr);
tagEndPos+=replaceStr.length-tag.length
}}if(tagName&&includesClosingTag&&callback.onTagEnd){replaceStr=callback.onTagEnd(tagName,includesClosingTag,tagStartPos,tag.length);
if(replaceStr!=null){htmlStr=hpr.replace(htmlStr,tagEndPos+1,tagEndPos,replaceStr);
tagEndPos+=replaceStr.length
}}}else{tagEndPos=dataPos
}processingPos=tagEndPos+1;
textPos=processingPos
}}}else{textHandlerResult=hpr.handleHtmlText(htmlStr,callback,processingPos,htmlStr.length);
htmlStr=textHandlerResult.html;
processingPos=-1
}}return htmlStr
},hasEqualAttributes:function(attribs,cmpAttribs){var attribCnt=0;
for(var attribToCheck in attribs){if(attribs.hasOwnProperty(attribToCheck)){if(!cmpAttribs.hasOwnProperty(attribToCheck)){return false
}if(attribs[attribToCheck].value!=cmpAttribs[attribToCheck].value){return false
}attribCnt++
}}for(attribToCheck in cmpAttribs){if(cmpAttribs.hasOwnProperty(attribToCheck)){attribCnt--;
if(attribCnt<0){return false
}}}return(attribCnt==0)
},parseStyleTag:function(tagStr){var tagReplacement=null;
var tagDef=CQ.form.rte.HtmlProcessor.parseTag(tagStr);
var styleDef=tagDef.attributes.style;
if(styleDef){styleDef=styleDef.value;
var styleDefs=CQ.form.rte.HtmlProcessor.parseStyleDef(styleDef);
if(styleDefs["font-weight"]=="bold"){if(!tagReplacement){tagReplacement=new Array()
}tagReplacement.push("b")
}if(styleDefs["font-style"]=="italic"){if(!tagReplacement){tagReplacement=new Array()
}tagReplacement.push("i")
}}return tagReplacement
},executeTagReplace:function(value,tagReplace){if(tagReplace){for(var srcTag in tagReplace){if(tagReplace.hasOwnProperty(srcTag)){var destTag=tagReplace[srcTag];
if(srcTag&&destTag){var srcStartTag="<"+srcTag+">";
var srcEndTag="<\\/"+srcTag+">";
var destStartTag="<"+destTag+">";
var destEndTag="</"+destTag+">";
var expStart=eval("/"+srcStartTag+"/gi");
var expEnd=eval("/"+srcEndTag+"/gi");
value=value.replace(expStart,destStartTag);
value=value.replace(expEnd,destEndTag)
}}}}return value
},executeStyleReplace:function(value){var tag,tagEndPos,tagsToReplace,replaceText;
var replacePos=0;
var spanEndTags=new Array();
while(replacePos>=0){var valueLC=value.toLowerCase();
tag=null;
var closingTagPos=valueLC.indexOf("</span>",replacePos);
var wholeTagPos=valueLC.indexOf("<span>",replacePos);
replacePos=valueLC.indexOf("<span ",replacePos);
if((wholeTagPos>=0)&&((wholeTagPos<replacePos)||(replacePos<0))){replacePos=wholeTagPos
}while((closingTagPos>=0)&&((closingTagPos<replacePos)||(replacePos<0))){tagsToReplace=spanEndTags.pop();
var replaceCnt=tagsToReplace.length;
if((replaceCnt>0)&&(tagsToReplace[0]!="span")){replaceText="";
for(var replaceIndex=replaceCnt-1;
replaceIndex>=0;
replaceIndex--){replaceText+="</"+tagsToReplace[replaceIndex]+">"
}value=CQ.form.rte.HtmlProcessor.replace(value,closingTagPos,closingTagPos+6,replaceText);
closingTagPos+=replaceText.length;
replacePos+=replaceText.length-7
}else{closingTagPos+=7
}valueLC=value.toLowerCase();
closingTagPos=valueLC.indexOf("</span>",closingTagPos)
}if(replacePos>=0){tagEndPos=valueLC.indexOf(">",replacePos);
if(tagEndPos>replacePos){tag=value.substring(replacePos,tagEndPos+1)
}}if(tag){tagsToReplace=CQ.form.rte.HtmlProcessor.parseStyleTag(tag);
if(tagsToReplace){replaceText="";
var tagCnt=tagsToReplace.length;
var closingTagInfo=new Array();
for(var tagIndex=0;
tagIndex<tagCnt;
tagIndex++){var tagToReplace=tagsToReplace[tagIndex];
closingTagInfo.push(tagToReplace);
replaceText+="<"+tagToReplace+">"
}value=CQ.form.rte.HtmlProcessor.replace(value,replacePos,tagEndPos,replaceText);
replacePos+=replaceText.length;
spanEndTags.push(closingTagInfo)
}else{replacePos+=tag.length;
spanEndTags.push(["span"])
}}}return value
},executeInternalizeLinks:function(value,linkInternalize){var valueLC=value.toLowerCase();
var replacePos,tagEndPos;
var tagCnt=linkInternalize.length;
for(var tagIndex=0;
tagIndex<tagCnt;
tagIndex++){var tag=linkInternalize[tagIndex];
var tagName=tag.tag;
var attribute=tag.attribute;
replacePos=0;
while((replacePos>=0)&&(replacePos<value.length)){replacePos=valueLC.indexOf("<"+tagName+" ",replacePos);
if(replacePos>=0){var tagStr=null;
tagEndPos=valueLC.indexOf(">",replacePos+1);
if(tagEndPos>replacePos){tagStr=value.substring(replacePos,tagEndPos+1)
}if(tagStr){var tagDef=CQ.form.rte.HtmlProcessor.parseTag(tagStr);
if(tagDef){var attribDef=tagDef.attributes[attribute];
if(attribDef){var attribValue=attribDef.value;
var attribPos=attribDef.pos;
var attribCharCnt=attribDef.cnt;
var isQuoted=attribDef.quoted;
var url=CQ.form.rte.HtmlRules.Links.removePrefixForInternalLinks(attribValue);
if(url!=attribValue){if(!isQuoted){url='"'+url+'"'
}value=CQ.form.rte.HtmlProcessor.replace(value,replacePos+attribPos,replacePos+attribPos+attribCharCnt-1,url);
valueLC=value.toLowerCase();
replacePos+=tagStr.length+(url.length-attribValue.length)
}else{replacePos+=tagStr.length
}}else{replacePos+=tagStr.length
}}else{replacePos+=tagStr.length
}}else{replacePos+=tagName.length+2
}}}}return value
},createTag:function(tagName,attribs,isClosingTag,isShortTag,normalizeTag){if(isClosingTag&&isShortTag){return""
}var tag="<";
if(isClosingTag){tag+="/"
}tag+=(normalizeTag?tagName.toLowerCase():tagName);
if(attribs&&!isClosingTag){tag+=CQ.form.rte.HtmlProcessor.createAttributes(attribs,normalizeTag)
}if(isShortTag){tag+=" /"
}tag+=">";
return tag
},createAttributes:function(attribs,normalizeTag){var strRep="";
if(!attribs){return strRep
}for(var attribName in attribs){if(attribs.hasOwnProperty(attribName)){if(attribName!="classname"){var attribDef=attribs[attribName];
if(attribDef){strRep+=" "+(normalizeTag?attribName.toLowerCase():attribName)+"=";
var value=attribDef.value;
var isQuoted=attribDef.quoted;
if(!isQuoted){isQuoted=(value.indexOf(" ")>=0)
}if(isQuoted||normalizeTag){strRep+='"'
}strRep+=value;
if(isQuoted||normalizeTag){strRep+='"'
}}}}}return strRep
}}
}();
CQ.form.rte.HtmlProcessor.StripTags=CQ.Ext.extend(CQ.Ext.emptyFn,{ignoreContent:false,strip:function(A){return CQ.form.rte.HtmlProcessor.parseHtml(A,this)
},onTagStart:function(A){if((A=="style")||(A=="script")){this.ignoreContent=true
}if(A=="br"){return"\n"
}return""
},onTagEnd:function(A){if((A=="style")||(A=="script")){this.ignoreContent=false
}if(A=="tr"){return"\n"
}if(A=="p"){return"\n\n"
}if(A.match(/h[1-6]/)){return"\n\n"
}if(A=="li"){return"\n\n"
}return""
},onHtmlText:function(B){if(this.ignoreContent){return""
}var A=B.replace(/[\n\r]/g," ");
return(A!=B?A:null)
},onProcessingTag:function(A){return""
}});
CQ.form.rte.DomProcessor=function(){var A=CQ.form.rte.Common;
return{getTagType:function(F){var E=CQ.form.rte.DomProcessor;
var B=(F instanceof String?F:F.tagName).toLowerCase();
var C=E.STRUCTURE;
var D=E.TYPE_TABLE;
if(D.hasOwnProperty(B)){C=D[B];
if(typeof (C)!="string"){C=C.type
}}return C
},resolveTagType:function(F){var E=CQ.form.rte.DomProcessor;
var B=(F instanceof String?F:F.tagName).toLowerCase();
var C=E.STRUCTURE;
var D=E.TYPE_TABLE;
if(D.hasOwnProperty(B)){C=D[B];
if(typeof (C)!="string"){if(C.type==E.DYNAMIC){if(C.getDynamicType){C=C.getDynamicType(F)
}else{C=E.STRUCTURE
}}else{C=C.type
}}}return C
},createNodeList:function(C,D){var B=new CQ.form.rte.NodeList();
if(D.cellSelection&&D.cellSelection.cells){B.createFromDomNodes(C,D.cellSelection.cells)
}else{B.createFromDocument(C,D)
}return B
},getCommonAncestor:function(C,E,D){if((E==null)||(D==null)){return null
}if(A.isAncestor(C,E,D)){return E.parentNode
}if(A.isAncestor(C,D,E)){return D.parentNode
}while(E){var B=D;
while(B){if(B==E){return E
}B=A.getParentNode(C,B)
}E=A.getParentNode(C,E)
}return null
},splitTextNode:function(C,D,I){if(D.nodeType!=3){throw new Error("splitTextNode() may only operate on text nodes.")
}if(!CQ.Ext.isArray(I)){I=[I]
}I.sort(function(O,N){return O-N
});
var J=[];
var G=0;
var E=D.nodeValue;
var M=I.length;
var F=D.parentNode;
var H,B;
for(var L=0;
L<M;
L++){var K=I[L];
H=E.substring(G,K);
B=C.createTextNode(H);
J.push(B);
F.insertBefore(B,D);
G=K
}H=E.substring(G,E.length);
B=C.createTextNode(H);
J.push(B);
F.insertBefore(B,D);
F.removeChild(D);
return J
},createNode:function(E,D,I){var F=E.createElement(D);
if(I){var H=!!F.setAttribute;
for(var C in I){if(I.hasOwnProperty(C)){var G=I[C];
if(H){var B=CQ.Ext.isIE6||CQ.Ext.isIE7;
if(!B&&(C=="className")){C="class"
}if(B&&(C=="class")){C="className"
}if(CQ.Ext.isIE&&(C=="style")){F.style.cssText=G
}else{F.setAttribute(C,G)
}}else{F[C]=G
}}}}return F
},insertAsParent:function(E,G,D,H){var F=CQ.form.rte.DomProcessor;
var C=F.createNode(E,D,H);
var B=G.parentNode;
B.insertBefore(C,G);
B.removeChild(G);
C.appendChild(G);
return C
},removeWithoutChildren:function(B){var C=B.parentNode;
while(B.childNodes.length>0){var D=B.childNodes[0];
B.removeChild(D);
C.insertBefore(D,B)
}C.removeChild(B)
},restructureAsChild:function(E,F,D,G,C){var J=CQ.form.rte.DomProcessor;
var H=J.createNode(E,G,C);
F.insertBefore(H,D[0]);
var K=D.length;
for(var I=0;
I<K;
I++){var B=D[I];
F.removeChild(B);
H.appendChild(B)
}return H
},browserizePlaceholders:function(B,D){var H=CQ.form.rte.DomProcessor;
if(A.isTag(D,A.EDITBLOCK_TAGS)){var J=A.getCharacterNodes(D);
if(J.length==1){var E=J[0];
if((E.nodeType==3)&&(E.nodeValue==H.NBSP)){var I=E.parentNode;
I.removeChild(E);
if(CQ.Ext.isIE){H.fixEmptyEditingBlockIE(B,D)
}else{if(CQ.Ext.isGecko){var G=H.createEmptyLinePlaceholder(B,false);
I.appendChild(G)
}}}}}if(D.nodeType==1){var C=D.childNodes;
for(var F=0;
F<C.length;
F++){H.browserizePlaceholders(B,C[F])
}}},isPlaceholderObject:function(C){if(CQ.Ext.isIE){return((C.nodeType==3)&&(C.nodeValue==CQ.form.rte.DomProcessor.NBSP))
}if(CQ.Ext.isGecko){var B=A.isTag(C,"br");
if(!B&&A.isTag(C.parentNode,["td","th"])){B=((C.nodeType==3)&&(C.nodeValue==CQ.form.rte.DomProcessor.NBSP))
}return B
}return false
},getEmptyLinePlaceholder:function(B){if(B.nodeType!=1){return null
}if(B.childNodes.length!=1){return null
}var C=B.childNodes[0];
if(CQ.form.rte.DomProcessor.isPlaceholderObject(C)){return C
}return null
},isEmptyLinePlaceholder:function(B){return(CQ.form.rte.DomProcessor.getEmptyLinePlaceholder(B)!=null)
},createEmptyLinePlaceholder:function(C,F,D){var E;
if(CQ.Ext.isGecko){E=C.createElement("br");
E.setAttribute("_moz_dirty","");
E.setAttribute("type","_moz")
}if(F){var B=C.createElement(D||"p");
if(E){B.appendChild(E)
}E=B
}return E
},ensureEmptyLinePlaceholders:function(C,E){if(E.nodeType==1){var D=CQ.form.rte.DomProcessor;
var F=CQ.form.rte.Selection;
if(D.getTagType(E)==D.CONTAINER){var B=A.getFirstTextChild(E,true);
if(B==null){var I=D.getEmptyLinePlaceholder(E);
if(!I){I=D.createEmptyLinePlaceholder(C,false);
if(I){var H=A.getFirstChild(E);
if(H==null){H=E
}else{while(F.isNoInsertNode(H)){H=H.parentNode;
if(H==E){break
}}}H.appendChild(I)
}}}else{if(D.isPlaceholderObject(B)){var G=A.getFirstChild(E);
if(!F.isNoInsertNode(G)){if(G!=B){B.parentNode.removeChild(B);
G.appendChild(B)
}}}}}}},isEmptyLineBlock:function(C){var B=CQ.form.rte.DomProcessor;
var F=B.isEmptyLinePlaceholder(C);
if(!F){var E=A.getCharacterNodes(C);
if(E.length==0){F=true
}else{if(E.length==1){var D=A.getNodeText(E[0]);
F=(D==B.NBSP)
}}}return F
},fixEmptyEditingBlockIE:function(D,C){if(CQ.Ext.isIE&&A.isEmptyEditingBlock(C,true)){if(A.isTag(C,A.TABLE_CELLS)){return 
}var F=CQ.form.rte.Selection;
var E=CQ.form.rte.DomProcessor;
var G=D.createTextNode(E.NBSP);
C.appendChild(G);
var H=D.createElement("span");
C.appendChild(H);
H.appendChild(D.createTextNode(E.NBSP));
var B=F.getLeadRange(D);
B.moveToElementText(H);
B.pasteHTML("");
C.removeChild(G)
}},getEmptyLine:function(B,D){var F=CQ.form.rte.DomProcessor;
var E=F.getEditBlock(B,D.startNode);
if(!E){return null
}if(D.endNode){var C=F.getEditBlock(B,D.endNode);
if(E!=C){return null
}}return(F.isEmptyLineBlock(E)?E:null)
},isEmptyLine:function(B,C){return(CQ.form.rte.DomProcessor.getEmptyLine(B,C)!=null)
},adjustTables:function(C){var J=C.root;
var F=J.childNodes;
var G;
for(G=0;
G<F.length;
G++){var E=F[G];
if(A.isTag(E,"p")){if(E.childNodes.length==1){var B=E.childNodes[0];
if(A.isTag(B,"table")){J.insertBefore(B,E);
J.removeChild(E);
E=B
}}}if(A.isTag(E,"table")){var H=A.getChildNodesByType(E,"thead");
if(H.length==1){H=H[0];
var K=A.getChildNodesByType(E,"tbody");
if(K.length==0){K.push(C.createElement("tbody"))
}K=K[0];
var D=null;
if(K.childNodes.length>0){D=K.childNodes[0]
}for(G=H.childNodes.length-1;
G>=0;
G--){var I=H.childNodes[G];
H.removeChild(I);
K.insertBefore(I,D)
}E.removeChild(H)
}}}},removeNonTableBlocks:function(D){var B=D.root;
var E=B.childNodes;
for(var C=E.length-1;
C>=0;
C--){if(!A.isTag(E[C],"table")){B.removeChild(E[C])
}}},hasSimilarParent:function(B,E){var D=CQ.form.rte.DomProcessor;
if(!E||(E.nodeType!=1)){return false
}var C=A.getParentNode(B,E);
while(C){if(D.getTagType(C)==D.CONTAINER){return false
}if(C.nodeType==1){if(A.equals(E,C)){return true
}}C=A.getParentNode(B,C)
}return false
},removeDuplicateStructures:function(F,E,C){var H=CQ.form.rte.DomProcessor;
var G=E;
while(G){var D=false;
if(G.nodeType==1){if((H.getTagType(G)!=H.CONTAINER)&&H.hasSimilarParent(F,G)){var B=A.getNextNode(F,G);
if(G==E){E=B
}if(G==C){C=B
}H.removeWithoutChildren(G);
G=B;
D=true
}}if(!D){if(G==C){break
}G=A.getNextNode(F,G)
}}return{startNode:E,endNode:C}
},joinIdenticalStructures:function(C,E,F){var K=CQ.form.rte.DomProcessor;
if(E.nodeType==1){E=A.getFirstTextChild(E)||E
}var D=(F?A.getPreviousTextNode(C,E):A.getNextTextNode(C,E));
if(!E||!D){return 
}var J=A.getParentNode(C,E);
var H=A.getParentNode(C,D);
var I=true;
var G=false;
while(K.getTagType(J)==K.STRUCTURE){if(!A.equals(J,H)){I=false;
break
}G=true;
J=A.getParentNode(C,J);
H=A.getParentNode(C,H);
if((J==null)||(H==null)){I=(J==H);
break
}}if(I){I=(J==H)
}if(I&&G){var B=E.parentNode;
var M=D.parentNode;
while(true){var L=M.parentNode;
if(F){A.moveChildren(M,B,0,false)
}else{A.moveChildren(M,B,0,true)
}A.removeNodesWithoutContent(C,M);
M=L;
B=B.parentNode;
if(K.getTagType(B)==K.CONTAINER){break
}}}},splitToParent:function(K,E,G){var D=CQ.form.rte.Selection;
var N=D.isNoInsertNode(E)&&(G==null);
var O,H,M;
var B=[];
var F;
while(true){if(!E){return null
}if(N){F=A.getChildIndex(E);
var C=E.parentNode.childNodes;
for(;
F<C.length;
F++){M=C[F];
B.push(M)
}E=E.parentNode;
N=false
}H=E.parentNode;
if(E.nodeType==3){if(G==0){B.push(E)
}else{if(G<A.getNodeCharacterCnt(E)){var J=E.nodeValue;
E.nodeValue=J.substring(0,G);
O=E.cloneNode(false);
O.nodeValue=J.substring(G,J.length);
B.push(O)
}}}else{O=E.cloneNode(false);
var L=B.length;
for(var I=0;
I<L;
I++){M=B[I];
if(M.parentNode){M.parentNode.removeChild(M)
}O.appendChild(B[I])
}B.length=0;
B.push(O)
}if(E!=K){F=A.getChildIndex(E)+1;
while(F<H.childNodes.length){M=H.childNodes[F];
H.removeChild(M);
B.push(M)
}}else{if(E.nextSibling){H.insertBefore(O,E.nextSibling)
}else{H.appendChild(O)
}return O
}E=H
}},removeUnwantedEmptyTags:function(C,D){if(A.matchesTagDefs(C,D)){if(!A.hasTextChild(C,true)){C.parentNode.removeChild(C);
return 
}}if(C.nodeType==1){var B=C.childNodes.length;
for(var E=B-1;
E>=0;
E--){CQ.form.rte.DomProcessor.removeUnwantedEmptyTags(C.childNodes[E],D)
}}},insertParagraph:function(C,D,F){var K=CQ.form.rte.DomProcessor;
var H;
if(A.isOneCharacterNode(D)&&(F==0)){F=A.getChildIndex(D);
D=A.getParentNode(D)
}if((D.nodeType==1)&&!A.isOneCharacterNode(D)&&((F==null)||(F==D.childNodes.length))){if(F==null){F=D.childNodes.length
}var J=false;
if(A.isRootNode(C,D)){H=D.childNodes[F-1].cloneNode(false);
D.appendChild(H);
D=D.childNodes[F-1];
J=true
}else{H=D.cloneNode(false);
D.parentNode.insertBefore(H,D.nextSibling)
}var G=null;
var L=A.getLastTextChild(D);
L=L?L:A.getLastChild(D);
L=L?L:D;
while(L!=D){if(L.nodeType==1){var M=L.cloneNode(false);
if(G!=null){M.appendChild(G)
}G=M
}L=A.getParentNode(C,L)
}if(G!=null){H.appendChild(G)
}K.ensureEmptyLinePlaceholders(C,H);
K.fixEmptyEditingBlockIE(C,H)
}else{var B=K.getScopedBlockNode(C,D);
if(!B){throw new Error("Inserting paragraph outside an existing format scope")
}var E=B.dom;
if(B.isAuxiliaryRoot){var I=C.createElement("p");
A.moveChildren(E,I);
E.appendChild(I);
E=I
}H=K.splitToParent(E,D,F);
K.removeUnwantedEmptyTags(H,K.EMPTYTEXT_EXCLUSIONS);
K.ensureEmptyLinePlaceholders(C,H);
K.ensureEmptyLinePlaceholders(C,E);
K.fixEmptyEditingBlockIE(C,H);
K.fixEmptyEditingBlockIE(C,E)
}return H
},isBlockStart:function(B,G,F){var C=CQ.form.rte.DomProcessor;
var E=C.getScopedBlockNode(B,G);
if(!E){return false
}E=E.dom;
if(G.nodeType==3){if(F>0){return false
}return(A.getFirstTextChild(E)==G)
}if(F!=null){if(F>0){return false
}}var D=E;
while((D.nodeType==1)&&(D.childNodes.length>0)){if(D.childNodes[0]==G){return true
}D=D.childNodes[0]
}return false
},isBlockEnd:function(B,G,F){var C=CQ.form.rte.DomProcessor;
var E=C.getScopedBlockNode(B,G);
if(!E){return false
}E=E.dom;
if(G.nodeType==3){if(F<G.nodeValue.length){return false
}return(A.getLastTextChild(E)==G)
}if(F!=null){if(F<G.childNodes.length-1){return false
}}var D=E;
while((D.nodeType==1)&&(D.childNodes.length>0)){if(D.childNodes[D.childNodes.length-1]==G){return true
}D=D.childNodes[D.childNodes.length-1]
}return false
},getContainerNode:function(B,D){var C=CQ.form.rte.DomProcessor;
while(D){if(D.nodeType==1){if(!A.isTag(D,C.AUXILIARY_ROOT_TAGS)){if(C.getTagType(D)==C.CONTAINER){return D
}}}D=A.getParentNode(B,D)
}return null
},getEditBlock:function(B,C){return A.getTagInPath(B,C,A.EDITBLOCK_TAGS)
},getEditBlocks:function(E,B){var D=CQ.form.rte.DomProcessor;
if(B===undefined){B=[]
}var C=E.childNodes.length;
for(var G=0;
G<C;
G++){var F=E.childNodes[G];
if(!A.isTag(F,D.AUXILIARY_ROOT_TAGS)){if(A.isTag(F,A.EDITBLOCK_TAGS)){B.push(F)
}D.getEditBlocks(F,B)
}}return B
},hasEditBlocks:function(D){var C=CQ.form.rte.DomProcessor;
var B=D.childNodes.length;
for(var F=0;
F<B;
F++){var E=D.childNodes[F];
if(!A.isTag(E,C.AUXILIARY_ROOT_TAGS)){if(A.isTag(E,A.EDITBLOCK_TAGS)||C.hasEditBlocks(E)){return true
}}}return false
},getAuxRootNode:function(B,C){while(C){if(A.isRootNode(B,C)){return C
}if(A.isTag(C,CQ.form.rte.DomProcessor.AUXILIARY_ROOT_TAGS)){return C
}C=A.getParentNode(B,C)
}return B.root
},getLastContainerNode:function(B,E){var D=CQ.form.rte.DomProcessor;
var C=A.getLastChild(E);
while(C&&(C!=E)){if(C.nodeType==1){if(D.getTagType(C)==D.CONTAINER){if(!A.isTag(C,D.AUXILIARY_ROOT_TAGS)){return C
}}}C=A.getPreviousNode(B,C)
}return null
},getSiblingContainerNode:function(B,F,E,C){var D=CQ.form.rte.DomProcessor;
while(F){if(F==E){return null
}if(F.nodeType==1){if(D.getTagType(F)==D.CONTAINER){if(!A.isTag(F,D.AUXILIARY_ROOT_TAGS)){return F
}}}F=C(B,F)
}return null
},getFormatTagInPath:function(D,F,B){while(F){if(F.nodeType==1){if(A.isRootNode(D,F)){return null
}var C=F.tagName.toLowerCase();
for(var E in B){var G=B[E];
if(G.tag&&(G.tag==C)){return F
}}}F=F.parentNode
}return null
},createContainerList:function(E,F){var I=CQ.form.rte.Selection;
var H=CQ.form.rte.DomProcessor;
F=I.adaptToInclusiveEndNode(E,F);
var C=F.startNode;
var B=F.endNode;
var G;
if(!F.isEOT){G=H.getContainerNode(E,C)
}else{G=H.getLastContainerNode(E,C)
}if(!G&&B&&(B!=C)){G=H.getSiblingContainerNode(E,C,B,A.getNextNode)
}if(!G){return[]
}if(!B){return[G]
}B=H.getContainerNode(E,B);
if(!B){B=H.getLastContainerNode(E,F.endNode)
}if(!B){B=H.getSiblingContainerNode(E,F.endNode,C,A.getPreviousNode)
}if(!B){return[G]
}var D=[];
while(G){if(G.nodeType==1){if(!A.isTag(G,H.AUXILIARY_ROOT_TAGS)){if(H.getTagType(G)==H.CONTAINER){D.push(G)
}}}if(G==B){break
}G=A.getNextNode(E,G)
}return D
},createBlockList:function(E,F){var H=CQ.form.rte.Selection;
F=H.adaptToInclusiveEndNode(E,F);
var C=F.startNode;
var B=F.endNode;
var G;
if(!F.isEOT){G=A.getBlockNode(E,C)
}else{G=A.getLastBlockNode(E,C)
}if(!G){return[]
}if(!B){return[G]
}B=A.getBlockNode(E,B);
if(!B){return[G]
}var D=[];
while(G){if(G.nodeType==1){if(A.isBlockNode(E,G)){D.push(G)
}}if(G==B){break
}G=A.getNextNode(E,G)
}return D
},hasContainerChildNodes:function(D){var C=CQ.form.rte.DomProcessor;
var B=D.childNodes.length;
for(var F=0;
F<B;
F++){var E=D.childNodes[F];
if(E.nodeType==1){if(C.getTagType(E)==C.CONTAINER){return true
}}}return false
},getAuxRoots:function(B,I){var C=CQ.form.rte.Selection;
var H=CQ.form.rte.DomProcessor;
var F=[];
if(I.cellSelection){var J=I.cellSelection.cells;
if(J&&(J.length>0)){for(var G=0;
G<J.length;
G++){F.push(J[G])
}return F
}}I=C.adaptToInclusiveEndNode(B,I);
var D=I.startNode;
var E=I.endNode;
while(D){if(D.nodeType==1){if(H.getTagType(D)==H.CONTAINER){if(A.isTag(D,H.AUXILIARY_ROOT_TAGS)){F.push(D)
}break
}}D=A.getParentNode(B,D)
}if(!D){D=A.getTagInPath(B,I.startNode,A.BLOCK_TAGS);
if(!D){return F
}}if(E&&(E!=D)){D=A.getNextNode(B,D);
while(D){if(D.nodeType==1){if(A.isTag(D,H.AUXILIARY_ROOT_TAGS)){if(!H.hasContainerChildNodes(D)){F.push(D)
}}}if(D==E){break
}D=A.getNextNode(B,D)
}}return F
},changeContainerTag:function(B,G,I,C){var H=CQ.form.rte.DomProcessor;
var D=G.length;
for(var E=0;
E<D;
E++){var F=G[E];
var J=I.cloneNode(I);
A.replaceNode(F,J);
if(C){H.ensureEmptyLinePlaceholders(B,J)
}H.fixEmptyEditingBlockIE(B,J)
}},getStyles:function(C,B,E){var D=B.styles;
if(!D){D=[];
B.styles=D
}while(!A.isRootNode(C,E)){if(A.isTag(E,"span")){if(E.className){D.push({dom:E,className:E.className})
}}E=A.getParentNode(C,E)
}B.isContinuousStyle=(D.length==1)
},getScopedBlockNode:function(B,D){var C=CQ.form.rte.DomProcessor;
while(D){if(A.isTag(D,A.BLOCK_TAGS)){return{dom:D,isAuxiliaryRoot:false}
}if(A.isTag(D,C.AUXILIARY_ROOT_TAGS)){return{dom:D,isAuxiliaryRoot:true}
}if(A.isRootNode(B,D.parentNode)){return{dom:D,isAuxiliaryRoot:false}
}D=A.getParentNode(B,D)
}return null
},ensureBlockContent:function(D,G,C,O,N){var F=CQ.form.rte.Common;
var Q=CQ.form.rte.DomProcessor;
var E=CQ.form.rte.Selection;
var J=null;
var R=null;
var M=D.root;
var P=null;
var B=M.childNodes;
for(var H=B.length-1;
H>=0;
H--){var I=B[H];
var L=F.isTag(I,"br");
var K=F.isTag(I,F.BLOCK_TAGS);
if((I.nodeType==3)||(L&&!O)||(!L&&!K)){if((J==null)&&N){J=E.createSelectionBookmark(D)
}if(!R){R=Q.createNode(D,G,C);
M.insertBefore(R,P);
P=R
}M.removeChild(I);
R.insertBefore(I,R.firstChild)
}else{if(L){if((J==null)&&N){J=E.createSelectionBookmark(D)
}R=null;
M.removeChild(I)
}else{if(I.nodeType==1){P=I;
R=null
}}}}return J
},insertText:function(C,D,F,L){var I=C.root;
var B,E;
if(D.nodeType==1){if(F==null){E=D;
D=A.getFirstTextChild(D);
if(!D){var H=false;
B=A.getFirstChild(E);
if(!B){if(A.isBlockNode(C,E)){B=E;
H=true
}else{B=E
}}D=C.createTextNode("");
if(H){B.appendChild(D)
}else{B.parentNode.insertBefore(D,B)
}}F=0
}else{var G=D.childNodes.length;
if(G>0){if(F>=G){D=A.getLastChild(D);
if(D.nodeType==3){F=A.getNodeCharacterCnt(D)
}else{var K=D.parentNode;
D=C.createTextNode("");
K.appendChild(D);
F=0
}}else{D=D.childNodes[F];
if(D.nodeType==1){D=A.getPreviousTextNode(C,D);
if(!D){B=A.getFirstChild(I);
D=C.createTextNode("");
B.parentNode.insertBefore(D,B)
}}F=A.getNodeCharacterCnt(D)
}}else{D=A.getPreviousTextNode(C,D);
if(!D){B=A.getFirstChild(I);
D=C.createTextNode("");
B.parentNode.insertBefore(D,B)
}F=A.getNodeCharacterCnt(D)
}}}var J=D.nodeValue;
if(J.length<=F){J+=L
}else{if(F==0){J=L+J
}else{J=J.substring(0,F)+L+J.substring(F,J.length)
}}D.nodeValue=J;
return{node:D,offset:F+L.length}
},removeTagsFromHierarchy:function(F,H){var E=CQ.form.rte.DomProcessor;
var B=CQ.form.rte.Common;
var D=F.childNodes.length;
for(var G=D-1;
G>=0;
G--){var C=F.childNodes[G];
E.removeTagsFromHierarchy(C,H)
}if(F.nodeType==1){if(B.matchesTagDefs(F,H)){E.removeWithoutChildren(F)
}}},saveChildNodes:function(E){var B=[];
var D=E.childNodes;
for(var C=0;
C<D.length;
C++){var G=D[C];
var F={dom:G};
B.push(F);
if(G.nodeType==1){F.children=CQ.form.rte.DomProcessor.saveChildNodes(G)
}else{F.text=G.nodeValue
}}return B
},restoreChildNodes:function(F,B){while(F.childNodes.length>0){F.removeChild(F.childNodes[0])
}for(var D=0;
D<B.length;
D++){var G=B[D];
var E=G.dom;
if(G.text!==undefined){E.nodeValue=G.text
}var C=G.children;
F.appendChild(E);
if(C){CQ.form.rte.DomProcessor.restoreChildNodes(E,C)
}}},insertElement:function(E,H,D,G){var F=D.parentNode;
if(D.nodeType==3){if(G==0){F.insertBefore(H,D)
}else{if(G>=A.getNodeCharacterCnt(D)){F.insertBefore(H,D.nextSibling)
}else{var B=CQ.form.rte.DomProcessor.splitTextNode(E,D,G);
F.insertBefore(H,B[1])
}}return 
}if(A.isOneCharacterNode(H)){if(G==null){A.insertBefore(F,H,D)
}else{A.insertBefore(F,H,D.nextSibling)
}}else{var C=D.childNodes;
if((G!=null)&&(G<C.length)){D.insertBefore(H,C[G])
}else{D.appendChild(H)
}}},createMarker:function(C,D,E){var B=C.createElement("span");
CQ.form.rte.DomProcessor.insertElement(C,B,D,E);
return B
},removeMarker:function(E,D){var C=D.previousSibling;
var B=D.nextSibling;
A.removeNodesWithoutContent(E,D);
if(C&&B){if((C.nodeType==3)&&(B.nodeType==3)){C.nodeValue+=B.nodeValue;
B.parentNode.removeChild(B)
}}},correctGeckoCopyBugs:function(C,D){var E=D.innerHTML;
var G=E.toLowerCase();
if(A.strStartsWith(G,"<tr>")||A.strStartsWith(G,"<tr ")){D.innerHTML="<table>"+E+"</table>"
}var J=A.getChildNodesByType(D,"tr",true);
var F=J.length;
for(var B=F-1;
B>=0;
B--){var I=J[B];
var H=A.getChildNodesByType(I,"tr",false);
if(H.length>0){CQ.form.rte.DomProcessor.removeWithoutChildren(I)
}}},TEXT_NODE:"text",DOM_NODE:"dom",CONTAINER:"container",STRUCTURE:"structure",DYNAMIC:"dynamic",IGNORE:"ignore",AUXILIARY_ROOT_TAGS:["td","th"],NBSP_CODE:160,NBSP:String.fromCharCode(160),EMPTYTEXT_EXCLUSIONS:[{tagName:"a",attribsDefined:["href"],attribsUndefined:["name"]}]}
}();
CQ.form.rte.DomProcessor.TYPE_TABLE={h1:CQ.form.rte.DomProcessor.CONTAINER,h2:CQ.form.rte.DomProcessor.CONTAINER,h3:CQ.form.rte.DomProcessor.CONTAINER,h4:CQ.form.rte.DomProcessor.CONTAINER,h5:CQ.form.rte.DomProcessor.CONTAINER,h6:CQ.form.rte.DomProcessor.CONTAINER,p:CQ.form.rte.DomProcessor.CONTAINER,div:CQ.form.rte.DomProcessor.CONTAINER,li:CQ.form.rte.DomProcessor.CONTAINER,ul:CQ.form.rte.DomProcessor.IGNORE,ol:CQ.form.rte.DomProcessor.IGNORE,table:CQ.form.rte.DomProcessor.IGNORE,tbody:CQ.form.rte.DomProcessor.IGNORE,thead:CQ.form.rte.DomProcessor.IGNORE,tfoot:CQ.form.rte.DomProcessor.IGNORE,tr:CQ.form.rte.DomProcessor.IGNORE,td:CQ.form.rte.DomProcessor.CONTAINER,th:CQ.form.rte.DomProcessor.CONTAINER,address:CQ.form.rte.DomProcessor.CONTAINER,blockquote:CQ.form.rte.DomProcessor.CONTAINER,pre:CQ.form.rte.DomProcessor.CONTAINER};
CQ.form.rte.WhitespaceProcessor=function(){var A=CQ.form.rte.Common;
var B=CQ.form.rte.DomProcessor;
return{normalizeWhitespace:function(G,F,C){var D=CQ.form.rte.WhitespaceProcessor;
G=G.replace(D.WHITESPACE_REGEX," ");
G=G.replace(D.MULTISPACE_REGEX," ");
var E;
if(F){E=0;
while((E<G.length)&&(G.charAt(E)==" ")){E++
}if(E<G.length){G=G.substring(E,G.length)
}else{G=""
}}if(C){E=G.length-1;
while((E>=0)&&(G.charAt(E)==" ")){E--
}if(E>=0){G=G.substring(0,E+1)
}else{G=""
}}return G
},handleTextBlock:function(L,D,J,G,K,E){var M=CQ.form.rte.WhitespaceProcessor;
var H=D.length;
var F=(J==0)&&E;
if(!F&&E){if(A.isTag(D[J-1],"br")){F=true
}}var I=(G==(H-1))&&E;
if(!I&&E){if(A.isTag(D[G+1],"br")){I=true
}}L=M.normalizeWhitespace(L,F,I);
D[J].nodeValue=L;
if(L.length==0){K.push(D[J])
}for(var C=J+1;
C<=G;
C++){K.push(D[C])
}},handleNoTextStructure:function(C,G,I){var K=CQ.form.rte.WhitespaceProcessor;
var E=G.childNodes;
var H=E.length;
for(var J=H-1;
J>=0;
J--){var D=E[J];
if(D.nodeType==3){G.removeChild(D)
}else{var F=A.isTag(D,A.EDITBLOCK_TAGS);
K.processStructure(C,D,F,I)
}}},cleanTextNodes:function(D,H,G,I){var N=CQ.form.rte.WhitespaceProcessor;
var F=H.childNodes;
var L="";
var M=0;
var K=[];
for(var J=0;
J<F.length;
J++){var E=F[J];
if(E.nodeType==3){L+=E.nodeValue;
if(J==(F.length-1)){N.handleTextBlock(L,F,M,J,K,G)
}}else{if(M<J){N.handleTextBlock(L,F,M,J-1,K,G)
}M=J+1;
L="";
N.processStructure(D,E,A.isTag(E,A.EDITBLOCK_TAGS),I)
}}for(var C=0;
C<K.length;
C++){H.removeChild(K[C])
}},normalizeSuperStructural:function(D,H){var P=CQ.form.rte.WhitespaceProcessor;
var F=H.childNodes;
var I=F.length;
var M=[];
var E;
for(var K=1;
K<I;
K++){E=F[K];
var O=F[K-1];
var J=A.getFirstTextChild(E,false,true);
var G=A.getLastTextChild(O,false,true);
if(J&&G){var N=J.nodeValue;
var L=G.nodeValue;
if(A.strStartsWith(N," ")&&A.strEndsWith(L," ")){if((E.nodeType==3)&&(O.nodeType==1)){L=P.normalizeWhitespace(L,false,true);
G.nodeValue=L;
if(L.length==0){M.push(G)
}}else{N=P.normalizeWhitespace(N,true,false);
J.nodeValue=N;
if(N.length==0){M.push(J)
}}}}}for(var C=0;
C<M.length;
C++){E=M[C];
E.parentNode.removeChild(E)
}},handleTextNodesBetweenBlocks:function(D,H){var O=CQ.form.rte.WhitespaceProcessor;
var F=H.childNodes;
var I=F.length;
for(var K=I-1;
K>=0;
K--){var E=F[K];
if(E.nodeType==3){var M=E.nodeValue;
var J=M.replace(O.WHITESPACEONLY_REGEX,"");
var N=false;
var L=false;
var G=E.previousSibling;
if(G){N=A.isTag(G,A.BLOCK_TAGS)||A.isTag(G,A.EDITBLOCK_TAGS)
}var C=E.nextSibling;
if(C){L=A.isTag(C,A.BLOCK_TAGS)||A.isTag(C,A.EDITBLOCK_TAGS)
}if(N||L){if(J.length==0){H.removeChild(E)
}else{M=O.normalizeWhitespace(M,N,L);
if(M.length>0){E.nodeValue=M
}else{H.removeChild(E)
}}}}}},removeUnsupportedNodes:function(D,L,N){if(!N){return 
}var H=L.childNodes;
var M=H.length;
var J=N.length;
for(var O=M-1;
O>=0;
O--){var G=H[O];
for(var C=0;
C<J;
C++){var P=N[C];
var F=false;
if((P.tagName!=null)&&A.isTag(G,P.tagName)){F=true
}else{if((P.namespace!=null)){var K=A.getNamespace(G);
if(K!=null){var R=P.namespace;
if(!CQ.Ext.isArray(R)){R=[R]
}var E=R.length;
for(var I=0;
I<E;
I++){var Q=R[I];
if((Q=="*")||(K==Q)){F=true;
break
}}}}else{if((P.nodeType!=null)&&(G.nodeType==P.nodeType)){F=true
}else{if((P.fn!=null)&&(P.fn(G))){F=true
}}}}if(F){if(!P.keepChildren){L.removeChild(G)
}else{var S=G.childNodes.length;
B.removeWithoutChildren(G);
if(S>0){O+=S
}}break
}}}},processStructure:function(E,G,F,C){var D=CQ.form.rte.WhitespaceProcessor;
if(A.isTag(G,D.AS_IS_TAGS)){return 
}D.removeUnsupportedNodes(E,G,C);
if(A.isTag(G,D.NO_TEXT_TAGS)){D.handleNoTextStructure(E,G,C);
return 
}D.cleanTextNodes(E,G,F,C);
D.normalizeSuperStructural(E,G);
D.handleTextNodesBetweenBlocks(E,G)
},process:function(F,H,C,D){var E=CQ.form.rte.WhitespaceProcessor;
if(!D){if(C!=null){C=A.arrayCopy(C);
A.arrayAdd(C,E.DEFAULT_REMOVAL_RULES)
}else{C=E.DEFAULT_REMOVAL_RULES
}}if(A.isTag(H,A.EDITBLOCK_TAGS)){E.processStructure(F,H,true,C)
}else{if(!A.isTag(H,E.AS_IS_TAGS)){if(H.nodeType==1){E.processStructure(F,H,true,C)
}else{if(H.nodeType==3){var G=H.nodeValue;
H.nodeValue=E.normalizeWhitespace(G,true,true)
}else{H.parentNode.removeChild(H)
}}}}},AS_IS_TAGS:["pre"],NO_TEXT_TAGS:["table","tbody","thead","tr","ul","ol"],WHITESPACE_REGEX:/[ \n\r\t]/g,MULTISPACE_REGEX:/ {2,}/g,WHITESPACEONLY_REGEX:/ /g,DEFAULT_REMOVAL_RULES:[{nodeType:8},{nodeType:7},{tagName:["meta","link","style","script"],keepChildren:false},{namespace:["st1"],keepChildren:true},{namespace:["*"]}]}
}();
CQ.form.rte.NodeList=CQ.Ext.extend(CQ.Ext.emptyFn,{nodes:null,commonAncestor:null,nodesChanged:null,removeExistingStructuresOnSurround:false,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{removeExistingStructuresOnSurround:true});
CQ.Ext.apply(this,A);
this.nodes=[];
this.nodesChanged=[]
},addChildNode:function(A,C,B){A.parentNode=null;
A.nodeList=C;
if(!B||(B>=this.nodes.length)){this.nodes.push(A)
}else{this.nodes.splice(B,0,A)
}},removeChildNode:function(B){var A=this.getTopLevelNodeIndex(B);
if(A<0){return -1
}this.nodes.splice(A,1);
return A
},createTextNode:function(H,E,C,B){var D=CQ.form.rte.Common.getNodeCharacterCnt(H);
if(D>0){var G=0;
var A=D;
if(E!=null){G=E;
A-=E
}if(C!=null){A-=(D-C)
}if((G+A)>D){A=D-G
}var F=new CQ.form.rte.DomProcessor.TextNode(H,G,A);
if(!B){this.addChildNode(F,this)
}else{B.addChildNode(F,this)
}}},createStructuralNode:function(C,A){var B=new CQ.form.rte.DomProcessor.StructuralNode(C);
if(!A){this.addChildNode(B,this)
}else{A.addChildNode(B,this)
}return B
},createAncestors:function(C,F,L,N){var D=CQ.form.rte.Common;
var J=D.isOneCharacterNode(F)&&(L==0);
var E=!J;
var M=[];
if(F==this.commonAncestor){if(E){M.push(F)
}}else{do{if(E){M.push(F)
}else{E=true
}F=D.getParentNode(C,F)
}while(F&&(F!=this.commonAncestor))
}var I=null;
var K=M.length;
var G=null;
for(var B=K-1;
B>=0;
B--){var H;
if(B==(K-1)){for(H=0;
H<this.nodes.length;
H++){if(this.nodes[H].dom==M[B]){G=this.nodes[H];
break
}}}else{if(G){var A=null;
for(H=0;
H<G.childNodes.length;
H++){if(G.childNodes[H].dom==M[B]){A=G.childNodes[H];
break
}}G=A
}}if(!G){if(M[B].nodeType==1){I=this.createStructuralNode(M[B],I)
}else{if(M[B].nodeType==3){this.createTextNode(M[B],L,N,I)
}}}else{I=G
}}return{parentNode:I,isInitialNodeSkipped:J}
},createList:function(A,L){var D=CQ.form.rte.Common;
var C=L.startNode;
var H=L.endNode;
if(H==null){H=C
}var J=L.startOffset;
var M=null;
var I=L.startNode;
if(I.nodeType==3){if(C==H){if(L.endOffset!=null){M=L.endOffset+1
}else{M=L.startOffset
}}}var E=this.createAncestors(A,I,J,M);
var G=E.parentNode;
if(C==H){return 
}var F=E.isInitialNodeSkipped;
var K=true;
while(true){var B=I.childNodes;
if(B.length>0){I=I.firstChild
}else{if(!(F&&K)){if((I.nodeType==1)&&G){G=G.parentNode
}}if(I.nextSibling){I=I.nextSibling
}else{while(true){I=D.getParentNode(A,I);
G=G.parentNode;
if(!I){break
}if(I.nextSibling){I=I.nextSibling;
break
}}}}K=false;
J=null;
M=null;
if(I==H){if(H.nodeType==3){M=L.endOffset+1
}}if(I.nodeType==1){G=this.createStructuralNode(I,G)
}else{if(I.nodeType==3){this.createTextNode(I,J,M,G)
}}if(I==H){break
}}},createFromDocument:function(B,C){var D=CQ.form.rte.DomProcessor;
var E=CQ.form.rte.Selection;
C={startNode:C.startNode,startOffset:C.startOffset,endNode:C.endNode,endOffset:C.endOffset,isEOT:C.isEOT};
if(E.shouldNormalizePSelForNodeList(B,C)){E.normalizeProcessingSelection(B,C)
}if(C.isEOT){var A=B.root.childNodes;
this.commonAncestor=A[A.length-1];
this.nodes.length=0;
return C
}C=E.adaptToInclusiveEndNode(B,C);
this.nodes.length=0;
if((C.startNode==C.endNode)||(C.endNode==null)){this.commonAncestor=C.startNode.parentNode
}else{this.commonAncestor=D.getCommonAncestor(B,C.startNode,C.endNode)
}if(!this.commonAncestor){throw new Error("No common ancestor found, cannot continue.")
}this.createList(B,C);
return C
},createDomChildren:function(E,A){var C=E.childNodes;
for(var B=0;
B<C.length;
B++){var F=C[B];
if(F.nodeType==1){var D=this.createStructuralNode(F,A);
this.createDomChildren(F,D)
}else{if(F.nodeType==3){this.createTextNode(F,null,null,A)
}}}},createFromDomNodes:function(D,A){var E=CQ.form.rte.DomProcessor;
this.commonAncestor=A[0];
var B=A.length;
for(var C=1;
C<B;
C++){if(!CQ.form.rte.Common.isAncestor(D,this.commonAncestor,A[C])){this.commonAncestor=E.getCommonAncestor(D,this.commonAncestor,A[C])
}}if(!this.commonAncestor){throw new Error("No common ancestor found, cannot continue.")
}for(C=0;
C<B;
C++){var G=A[C];
var F=this.createAncestors(D,G,null,null);
this.createDomChildren(G,F.parentNode)
}},removeEmptySideStructures:function(){var C=CQ.form.rte.Common;
if(this.nodes.length>0){var B=this.nodes[0];
if(B.isEmptySideStructure()){this.nodes.splice(0,1)
}if(this.nodes.length>0){var G=this.nodes.length-1;
B=this.nodes[G];
if(B.isEmptySideStructure()){this.nodes.splice(G,1)
}}while(this.nodes.length==1){var F=this.nodes[0];
if(!C.isCharacterNode(F.dom)){this.commonAncestor=F.dom;
this.nodes.length=0;
if(F.childNodes){var D=F.childNodes.length;
for(var E=0;
E<D;
E++){var A=F.childNodes[E];
A.parentNode=null;
this.nodes.push(A)
}}}else{break
}}}},hasContainers:function(){var B=this.nodes.length;
for(var C=0;
C<B;
C++){var A=this.nodes[C];
if(A.hasContainers()){return true
}}return false
},isAligned:function(C){if(!C){C=function(E){return E.isAligned()
}
}var B=this.nodes.length;
for(var D=0;
D<B;
D++){var A=this.nodes[D];
if(!C(A)){return false
}}return true
},getEditBlocksByAuxRoots:function(B,I){var D=CQ.form.rte.Common;
var K=CQ.form.rte.DomProcessor;
var L=this.nodes.length;
var J,M;
var H=[];
var G=null;
for(var F=0;
F<L;
F++){this.nodes[F].execRecursively(function(O){var P=O.dom;
if(D.isTag(P,K.AUXILIARY_ROOT_TAGS)){M=[];
H.push(M);
M.push(P);
G=P
}else{if(D.isTag(P,D.EDITBLOCK_TAGS)){var N=K.getAuxRootNode(B,P);
if(N!=G){M=[];
H.push(M);
G=N
}M.push(P)
}}})
}if((H.length==0)&&I){var C=this.commonAncestor;
while(C){if(D.isTag(C,D.EDITBLOCK_TAGS)){H.push([C]);
break
}C=D.getParentNode(B,C)
}}for(J=H.length-1;
J>=0;
J--){var A=H[J];
var E=A.length;
if(E==0){H.splice(J,1)
}else{if(D.isTag(A[0],K.AUXILIARY_ROOT_TAGS)){if(E>1){A.splice(0,1)
}else{if(K.hasEditBlocks(A[0])){H.splice(J,1)
}}}}}return H
},normalize:function(){var D=[];
var C=this.nodes.length;
for(var E=0;
E<C;
E++){this.nodes[E].normalize(this,D)
}var A=D.length;
for(var B=0;
B<A;
B++){this.remove(D[B])
}},createTopLevelDomNodes:function(){var A=[];
var B=this.nodes.length;
for(var C=0;
C<B;
C++){A.push(this.nodes[C].dom)
}return A
},getTopLevelNodeIndex:function(C){var B=this.nodes.length;
for(var D=0;
D<B;
D++){var A=this.nodes[D];
if(A==C){return D
}}return -1
},surround:function(C,U,J){var A=CQ.form.rte.DomProcessor;
var F=CQ.form.rte.Common;
var M=CQ.form.rte.Selection;
this.removeEmptySideStructures();
this.nodesChanged.length=0;
var Q,N;
var I=[];
this.normalize();
var P=true;
if(this.isAligned()&&!this.hasContainers()){var O=A.restructureAsChild(C,this.commonAncestor,this.createTopLevelDomNodes(),U,J);
var E=this.nodes;
this.nodes=[];
var H=this.createStructuralNode(O,null);
this.nodes.push(H);
Q=E.length;
for(N=0;
N<Q;
N++){H.addChildNode(E[N],this)
}this.nodesChanged.push(O);
P=false;
I.push(O)
}if(P){Q=this.nodes.length;
var G=null;
for(N=0;
N<Q;
N++){var L=this.nodes[N];
G=L.surround(C,G,U,J,I)
}}if(this.nodesChanged.length>0){var S=this.nodesChanged[0];
var K=this.nodesChanged[this.nodesChanged.length-1];
if(S==K){K=F.getLastChild(S)
}var T=A.removeDuplicateStructures(C,S,K);
A.joinIdenticalStructures(C,T.startNode,true);
A.joinIdenticalStructures(C,T.endNode,false);
if(P){if(T.cellSelection&&T.cellSelection.cells){this.createFromDomNodes(C,T.cellSelection.cells)
}else{var B=function(W,V){var X=null;
if(F.isOneCharacterNode(W)){X=(V?null:0)
}else{if(W.nodeType==3){X=(V?0:W.nodeValue.length)
}else{if(W.nodeType==1){var Y=F.getFirstTextChild(W,true);
if(Y){W=Y;
X=(V?M.getFirstSelectionOffset(Y):M.getLastSelectionOffset(Y))
}}}}return{node:W,offset:X}
};
var D=B(T.startNode,true);
T.startNode=D.node;
T.startOffset=D.offset;
var R=B(T.endNode,false);
T.endNode=R.node;
T.endOffset=R.offset;
this.createFromDocument(C,T)
}}}return I
},removeUnnecessaryLinebreaks:function(B,M){var C;
var J=CQ.form.rte.DomProcessor;
var D=CQ.form.rte.Common;
if(M){var F=this.commonAncestor;
while(F){if(F.nodeType==1){if(D.isRootNode(B,F)){break
}if(J.getTagType(F)==J.CONTAINER){C=F;
break
}}F=D.getParentNode(B,F)
}}var K=this.nodes.length;
var L=[];
for(var E=0;
E<K;
E++){var G=this.nodes[E];
if(G.nodeType==J.DOM_NODE){G.getUnnecessaryLinebreaks(C,L)
}}var N=L.length;
for(var A=0;
A<N;
A++){var H=L[A];
var I=H.parentNode;
I=(I?I:this);
J.removeWithoutChildren(H.dom);
I.removeChildNode(H)
}},getByDomRec:function(C,D){if(C.dom==D){return C
}if(C.childNodes){var B=C.childNodes.length;
for(var E=0;
E<B;
E++){var A=this.getByDomRec(C.childNodes[E],D);
if(A){return A
}}}return null
},getByDom:function(E,D){var C=this.nodes.length;
for(var F=0;
F<C;
F++){var A=this.nodes[F];
if(A.dom==E){return A
}if(D){var B=this.getByDomRec(A,E);
if(B){return B
}}}return null
},contains:function(B,A){return(this.getByDom(B,A)!=null)
},isolateNode:function(B,C,G){var A=CQ.form.rte.Common;
var D=A.getChildIndex(B);
var H=B.parentNode;
var I,F;
for(F=0;
F<D;
F++){I=H.childNodes[0];
H.removeChild(I);
C.appendChild(I)
}var E=H.childNodes.length;
for(F=E-1;
F>=1;
F--){I=H.childNodes[F];
H.removeChild(I);
G.insertBefore(I,G.firstChild)
}},handleAlignment:function(E,B){var G=CQ.form.rte.DomProcessor;
var A=B[1];
var D=B[2];
var F=this.nodes.length;
for(var H=0;
H<F;
H++){var C=this.nodes[H];
if(C.nodeType==G.TEXT_NODE){C.split(E,A,D)
}}},removeNodesByTag:function(E,Q,D,O){var M=CQ.form.rte.DomProcessor;
var F=CQ.form.rte.Common;
this.normalize();
var L,K;
var N=null;
if(O){var G=this.commonAncestor;
var P=[];
var J,I,C,B;
while(G){var A=F.getParentNode(E,G);
if(G.nodeType==1){if(M.getTagType(G)==M.CONTAINER){break
}if(F.isTag(G,Q)&&(!D||F.hasAttributes(G,D))){N=G.parentNode;
C=G.cloneNode(false);
N.insertBefore(C,G);
B=G.cloneNode(false);
N.insertBefore(B,G.nextSibling);
N=G;
while(P.length>0){N=P.pop();
this.isolateNode(N,C,B);
J=N.cloneNode(false);
C.appendChild(J);
C=J;
I=N.cloneNode(false);
B.insertBefore(I,B.firstChild);
B=I
}this.handleAlignment(E,[N,C,B]);
F.removeNodesWithoutContent(E,C);
F.removeNodesWithoutContent(E,B);
M.removeWithoutChildren(G);
break
}P.push(G)
}G=A
}}K=this.nodes.length;
for(L=K-1;
L>=0;
L--){var H=this.nodes[L];
if(H.nodeType==M.DOM_NODE){H.removeNodesByTag(E,Q,D,this)
}}},remove:function(E){var C=this.getTopLevelNodeIndex(E);
if(C<0){E.parentNode.removeChild(E);
return 
}if(!E.isInvalidatedByNormalization){CQ.form.rte.DomProcessor.removeWithoutChildren(E.dom)
}this.nodes.splice(C,1);
if(E.childNodes){var B=E.childNodes;
var D=B.length;
for(var F=0;
F<D;
F++){var A=B[F];
A.parentNode=this;
this.nodes.splice(C+F,0,A)
}}},getAnchors:function(C,A,B){var D=CQ.form.rte.Common;
if(B){var F=this.commonAncestor;
while(F){if(F.nodeType==1){if(D.isRootNode(C,F)){break
}var I=F.tagName.toLowerCase();
if(I=="a"){if(F.href){var G={dom:F,href:F[D.HREF_ATTRIB]||F.getAttribute("href")};
if(F.className){G.cssClass=F.className
}if(F.target){G.target=F.target
}A.push(G)
}}}F=D.getParentNode(C,F)
}}var J=this.nodes.length;
for(var E=0;
E<J;
E++){var H=this.nodes[E];
if(H.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){H.getAnchors(A)
}}},getNamedAnchors:function(B,C,A){var D=CQ.form.rte.Common;
if(A){var F=this.commonAncestor;
while(F){if(F.nodeType==1){if(D.isRootNode(B,F)){break
}var H=F.tagName.toLowerCase();
if(H=="a"){if(F.name){C.push({dom:F,name:F.name})
}}}F=D.getParentNode(B,F)
}}var I=this.nodes.length;
for(var E=0;
E<I;
E++){var G=this.nodes[E];
if(G.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){G.getNamedAnchors(C)
}}},getStyles:function(C,A,B){var D=CQ.form.rte.Common;
var M=A.styles;
if(!M){M=[];
A.styles=M
}var N=false;
if(B){var F=this.commonAncestor;
while(F){if(F.nodeType==1){if(D.isRootNode(C,F)){break
}var H=F.tagName.toLowerCase();
if(H=="span"){if(F.className){N=true;
M.push({dom:F,className:F.className})
}}}F=D.getParentNode(C,F)
}}var I=null;
var L=false;
var K=this.nodes.length;
for(var E=0;
E<K;
E++){var G=this.nodes[E];
if(G.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){var J=G.getStyles(M);
I=CQ.form.rte.NodeList.calcNewContState(I,J)
}else{L=true
}}if(I==null){I="unstyled"
}A.isContinuousStyle=(N&&(I=="unstyled"))||(!N&&(I=="single")&&!L)
},containsTag:function(C){C=C.toLowerCase();
var B=this.nodes.length;
for(var D=0;
D<B;
D++){var A=this.nodes[D];
if(A.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){if(A.containsTag(C)){return true
}}}return false
},executeMatcherOnDom:function(H,E){var C=CQ.form.rte.Common;
var D=false;
var B=E.length;
for(var G=0;
G<B;
G++){var F=E[G];
if(F.extMatcher){var A=F.extMatcher(H);
if(A.isMatching){D=true;
break
}}else{if(F.matcher){if(F.matcher(H)){D=true;
break
}}else{if(C.matchesTagDef(H,F)){D=true;
break
}}}}return D
},getTags:function(B,D,A,G){var H=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var J=[];
var I=this.nodes.length;
for(var E=0;
E<I;
E++){if(this.nodes[E].nodeType==H.DOM_NODE){this.nodes[E].getTags(D,J)
}}if(G&&(J.length>0)){if(this.executeMatcherOnDom(this.commonAncestor,D)){J.splice(0,0,{nodeType:null,isAncestor:true,dom:this.commonAncestor})
}return J
}if(A){var F=this.commonAncestor;
while(F){if(this.executeMatcherOnDom(F,D)){J.splice(0,0,{nodeType:null,isAncestor:true,dom:F});
if(G){return J
}}F=C.getParentNode(B,F)
}}return J
},hasContent:function(){var A=this.nodes.length;
for(var B=0;
B<A;
B++){if(this.nodes[B].nodeType==CQ.form.rte.DomProcessor.TEXT_NODE){return true
}else{if(this.nodes[B].hasContent()){return true
}}}return false
},hasCharacterNodes:function(){var A=this.nodes.length;
for(var B=0;
B<A;
B++){if(this.nodes[B].hasCharacterNodes()){return true
}}return false
},getFirstNode:function(){if(this.nodes.length==0){return null
}var A=this.nodes[0];
while(A.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){if(!A.childNodes||(A.childNodes.length==0)){break
}A=A.childNodes[0]
}return A
},getLastNode:function(){var A=this.nodes.length;
if(A==0){return null
}var C=this.nodes[A-1];
while(C.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){if(!C.childNodes){break
}var B=C.childNodes.length;
if(B==0){break
}C=C.childNodes[B-1]
}return C
},createDump:function(){var B=this.nodes.length;
var D="---";
if(this.commonAncestor.nodeType==1){D=this.commonAncestor.tagName
}else{D=this.commonAncestor.nodeValue
}var C="Common ancestor: "+D+"\n";
C+="Nodes in list: "+B+"\n";
for(var E=0;
E<B;
E++){var A=this.nodes[E];
C+=A.createDump()+"\n"
}return C
}});
CQ.form.rte.DomProcessor.TextNode=CQ.Ext.extend(CQ.Ext.emptyFn,{nodeType:CQ.form.rte.DomProcessor.TEXT_NODE,nodeList:null,parentNode:null,dom:null,startPos:0,charCnt:0,nodeLength:0,isInvalidatedByNormalization:false,constructor:function(C,B,A){this.dom=C;
this.startPos=B;
this.charCnt=A;
this.nodeLength=CQ.form.rte.Common.getNodeCharacterCnt(C)
},execRecursively:function(A){A(this)
},isStartAligned:function(){return(this.startPos==0)
},isEndAligned:function(){return((this.startPos+this.charCnt)==this.nodeLength)
},isAligned:function(){return this.isStartAligned()&&this.isEndAligned()
},hasContainers:function(){return false
},getActualTextContent:function(){var A=this.dom.nodeValue;
if(this.startPos>=this.nodeLength){return""
}return A.substring(this.startPos,this.startPos+this.charCnt)
},hasCharacterNodes:function(){return true
},isEmptySideStructure:function(){return(this.charCnt==0)
},normalize:function(C,E){if(this.isInvalidatedByNormalization){return 
}var D;
while(true){var B=this.dom.previousSibling;
if(!B||(B.nodeType!=3)){break
}this.dom.nodeValue=B.nodeValue+this.dom.nodeValue;
this.startPos+=B.nodeValue.length;
D=C.getByDom(B,true);
if(D){if(this.startPos!=0){throw new Error("Trying to mormalize something that can't be normalized.")
}this.startPos-=D.charCnt;
this.charCnt+=D.charCnt;
D.isInvalidatedByNormalization=true;
E.push(D)
}B.parentNode.removeChild(B);
this.nodeLength=this.dom.nodeValue.length
}while(true){var A=this.dom.nextSibling;
if(!A||(A.nodeType!=3)){break
}this.dom.nodeValue+=A.nodeValue;
D=C.getByDom(A,true);
if(D){if((this.startPos+this.charCnt)<this.nodeLength){throw new Error("Trying to mormalize something that can't be normalized.")
}this.charCnt+=D.charCnt;
D.isInvalidatedByNormalization=true;
E.push(D)
}A.parentNode.removeChild(A);
this.nodeLength=this.dom.nodeValue.length
}},surround:function(F,G,E,C){var D=this.dom;
var B=0;
var H=[];
if(!this.isStartAligned()){H.push(this.startPos);
B=1
}if(!this.isEndAligned()){H.push(this.startPos+this.charCnt)
}if(H.length>0){var A=CQ.form.rte.DomProcessor.splitTextNode(F,this.dom,H);
D=A[B]
}if(G!=null){D.parentNode.removeChild(D);
G.appendChild(D)
}else{G=CQ.form.rte.DomProcessor.insertAsParent(F,D,E,C);
this.nodeList.nodesChanged.push(G)
}this.dom=D;
this.nodeList.nodesChanged.push(D);
return G
},createNewTextNode:function(A){return A.createTextNode(this.getActualTextContent())
},split:function(B,D,E){var A=CQ.form.rte.Common;
var C=this.dom.nodeValue;
if(!this.isAligned()){this.dom.nodeValue=C.substring(this.startPos,this.startPos+this.charCnt);
var F;
if(!this.isStartAligned()){F=B.createTextNode(C.substring(0,this.startPos));
A.addTextNode(F,D)
}if(!this.isEndAligned()){F=B.createTextNode(C.substring(this.startPos+this.charCnt,C.length));
A.addTextNode(F,E)
}this.startPos=0;
this.charCnt=this.dom.nodeValue.length
}},createDump:function(){var B;
var A=this.dom.nodeValue;
if(this.charCnt==0){if(this.startPos<(A.length-1)){B="("+A.substring(this.startPos,this.startPos+1)+")"
}else{B="(behind text)"
}}else{B=A.substring(this.startPos,this.startPos+this.charCnt)
}B=B.replace(/ /g,"*");
return"Text node (s:"+this.startPos+"/l:"+this.charCnt+"/tl:"+this.nodeLength+"): "+B
}});
CQ.form.rte.NodeList.calcNewContState=function(B,A){if(B==null){B=A
}else{if((B=="unstyled")||(B=="single")){if((A=="single")||(A=="multiple")){B="multiple"
}else{if(B=="single"&&(B=="unstyled")){B="multiple"
}}}else{if(A=="multiple"){B="multiple"
}}}return B
};
CQ.form.rte.DomProcessor.StructuralNode=CQ.Ext.extend(CQ.Ext.emptyFn,{nodeType:CQ.form.rte.DomProcessor.DOM_NODE,parentNode:null,tagName:null,dom:null,nodeList:null,type:null,childNodes:null,isInvalidatedByNormalization:false,constructor:function(A){this.dom=A;
this.tagName=A.tagName.toLowerCase();
this.type=CQ.form.rte.DomProcessor.getTagType(A)
},execRecursively:function(A){var C=A(this);
if(this.childNodes&&(C!==true)){var B=this.childNodes.length;
for(var D=0;
D<B;
D++){this.childNodes[D].execRecursively(A)
}}},addChildNode:function(A,C,B){if(!this.childNodes){this.childNodes=[]
}A.parentNode=this;
A.nodeList=C;
if(!B||(B>=this.childNodes.length)){this.childNodes.push(A)
}else{this.childNodes.splice(B,0,A)
}},removeChildNode:function(A){var B=this.getChildIndex(A);
if(B<0){return -1
}this.childNodes.splice(B,1);
if(this.childNodes.length==0){this.childNodes=null
}return B
},getActualParent:function(){return(this.parentNode?this.parent:this.nodeList)
},isStartAligned:function(){if(this.childNodes==null){return true
}var C=this.childNodes.length;
for(var D=0;
D<C;
D++){var B=this.childNodes[D];
var A=B.isStartAligned();
if(!A){return false
}}return true
},isEndAligned:function(){if(this.childNodes==null){return true
}var C=this.childNodes.length;
for(var D=0;
D<C;
D++){var B=this.childNodes[D];
var A=B.isEndAligned();
if(!A){return false
}}return true
},isAligned:function(){if(this.childNodes==null){return true
}var C=this.childNodes.length;
for(var D=0;
D<C;
D++){var B=this.childNodes[D];
var A=B.isAligned();
if(!A){return false
}}return true
},hasContainers:function(E){var C=CQ.form.rte.DomProcessor;
var A;
if(this.type==C.DYNAMIC){A=true;
if(C.TYPE_TABLE.hasOwnProperty(this.tagName)){var D=C.TYPE_TABLE[this.tagName];
if(D&&D.getDynamicType){A=(D.getDynamicType(this.dom)==C.CONTAINER)
}}}else{A=(this.type==C.CONTAINER)
}if((E!==true)&&A){return true
}if(this.childNodes!=null){var B=this.childNodes.length;
for(var F=0;
F<B;
F++){if(this.childNodes[F].hasContainers()){return true
}}}return false
},containsTag:function(B){if(this.tagName==B){return true
}if(this.childNodes){var C=this.childNodes.length;
for(var D=0;
D<C;
D++){var A=this.childNodes[D];
if(A.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){if(A.containsTag(B)){return true
}}}}return false
},getTags:function(E,K){var I=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var D=E.length;
var A=false;
for(var B=0;
B<D;
B++){var G=E[B];
if(G.extMatcher){var J=G.extMatcher(this.dom);
if(J.isMatching){K.push(this);
A=J.preventRecursionIfMatching;
break
}if(J.preventRecursion===true){A=true
}}else{if(G.matcher){if(G.matcher(this.dom)){K.push(this);
break
}}else{if(C.matchesTagDef(this.dom,G)){K.push(this);
break
}}}}if(this.childNodes&&!A){var H=this.childNodes.length;
for(var F=0;
F<H;
F++){if(this.childNodes[F].nodeType==I.DOM_NODE){this.childNodes[F].getTags(E,K)
}}}return K
},normalize:function(A,C){if(this.childNodes){var B=this.childNodes.length;
for(var D=0;
D<B;
D++){this.childNodes[D].normalize(A,C)
}}},hasContent:function(){if(!this.childNodes){return false
}var B=this.childNodes.length;
for(var C=0;
C<B;
C++){var A=this.childNodes[C];
if(A.nodeType==CQ.form.rte.DomProcessor.TEXT_NODE){return true
}else{if(A.hasContent()){return true
}}}return false
},hasCharacterNodes:function(){var A=CQ.form.rte.Common;
if(A.isCharacterNode(this.dom)){return true
}if(this.childNodes!=null){var B=this.childNodes.length;
for(var C=0;
C<B;
C++){if(this.childNodes[C].hasCharacterNodes()){return true
}}}},isEmptySideStructure:function(C){var A=CQ.form.rte.Common;
if(!C){if(A.isCharacterNode(this.dom)){return false
}if(A.isEmptyEditingBlock(this.dom)){return false
}}if(this.childNodes!=null){var B=this.childNodes.length;
for(var D=0;
D<B;
D++){if(!this.childNodes[D].isEmptySideStructure()){return false
}}}return true
},getAnchors:function(D){if((this.tagName=="a")&&!this.isEmptySideStructure(true)){if(this.dom.href){var A={dom:this.dom,href:this.dom[CQ.form.rte.Common.HREF_ATTRIB]||this.dom.getAttribute("href")};
if(this.dom.target){A.target=this.dom.target
}D.push(A)
}}if(this.childNodes!=null){var C=this.childNodes.length;
for(var E=0;
E<C;
E++){var B=this.childNodes[E];
if(B.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){B.getAnchors(D)
}}}},getNamedAnchors:function(C){if(this.tagName=="a"){if(this.dom.name){C.push({dom:this.dom,name:this.dom.name})
}}if(this.childNodes!=null){var B=this.childNodes.length;
for(var D=0;
D<B;
D++){var A=this.childNodes[D];
if(A.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){A.getNamedAnchors(C)
}}}},getStyles:function(G){var D="unstyled";
if(this.tagName=="span"){if(this.dom.className){G.push({dom:this.dom,className:this.dom.className});
D="single"
}}if(this.childNodes!=null){var C=false;
var E=null;
var F=this.childNodes.length;
for(var H=0;
H<F;
H++){var B=this.childNodes[H];
if(B.nodeType==CQ.form.rte.DomProcessor.DOM_NODE){var A=B.getStyles(G);
E=CQ.form.rte.NodeList.calcNewContState(E,A)
}else{C=true
}}if(E==null){E="unstyled"
}if(D=="unstyled"){if(E!="unstyled"){D=(C?"multiple":E)
}}else{D=(E=="unstyled"?D:"multiple")
}}return D
},createChildDomNodes:function(){var A=[];
if(this.childNodes==null){return A
}var B=this.childNodes.length;
for(var C=0;
C<B;
C++){A.push(this.childNodes[C].dom)
}return A
},addChangedNodes:function(A){this.nodeList.nodesChanged.push(A);
if(A.nodeType==1){var B=A.childNodes.length;
for(var C=0;
C<B;
C++){this.addChangedNodes(A.childNodes[C])
}}},surroundStructure:function(D,H,I,B,F,E){var G=CQ.form.rte.DomProcessor;
var A=true;
if(E&&E.isApplicable){A=E.isApplicable(this.dom,I,B)
}if(!A){return null
}if(this.isAligned()){if(H!=null){this.dom.parentNode.removeChild(this.dom);
H.appendChild(this.dom);
this.nodeList.nodesChanged.push(this.dom)
}else{H=G.insertAsParent(D,this.dom,I,B);
F.push(H);
this.nodeList.nodesChanged.push(H);
this.nodeList.nodesChanged.push(this.dom)
}}else{var C;
if(!this.isStartAligned()){C=this.processLeftSubtree(D);
H=G.createNode(D,I,B);
F.push(H);
H.appendChild(C);
this.dom.parentNode.insertBefore(H,this.dom.nextSibling);
this.addChangedNodes(H)
}if(!this.isEndAligned()){C=this.processRightSubtree(D);
H.appendChild(C);
this.addChangedNodes(C)
}}return H
},surroundContainer:function(C,K,M,B,I,D){var J=CQ.form.rte.DomProcessor;
var A=true;
if(D&&D.isApplicable){A=D.isApplicable(this.dom,M,B)
}if(!A){return null
}if(this.childNodes==null){return K
}if(this.isAligned()){if(!this.hasContainers(true)){var L=this.createChildDomNodes();
var F=J.restructureAsChild(C,this.dom,L,M,B);
I.push(F);
this.addChangedNodes(F)
}else{if(this.childNodes!=null){var H=this.childNodes.length;
for(var E=0;
E<H;
E++){var G=this.childNodes[E];
G.surround(C,K,M,B,I)
}}}}else{K=J.createNode(C,M,B);
I.push(K);
if(!this.isStartAligned()){this.processLeftContainerSubtree(C,K,true);
this.dom.appendChild(K)
}if(!this.isEndAligned()){this.processRightContainerSubtree(C,K,true);
this.dom.insertBefore(K,this.dom.firstChild)
}this.addChangedNodes(K)
}return null
},surround:function(C,L,N,A,J){var K=CQ.form.rte.DomProcessor;
switch(this.type){case K.STRUCTURE:L=this.surroundStructure(C,L,N,A,J);
break;
case K.CONTAINER:L=this.surroundContainer(C,L,N,A,J);
break;
case K.DYNAMIC:var E=null;
var I=this.tagName;
var M=K.TYPE_TABLE;
if(M.hasOwnProperty(I)){var G=M[I];
if(typeof (G)=="object"){E=G
}}var B=true;
if(E&&E.getDynamicType){B=(E.getDynamicType(this.dom)==K.CONTAINER)
}if(B){L=this.surroundContainer(C,L,N,A,J,E)
}else{L=this.surroundStructure(C,L,N,A,J,E)
}break;
case K.IGNORE:if(this.childNodes){var H=this.childNodes.length;
for(var F=0;
F<H;
F++){var D=this.childNodes[F];
if(D.nodeType==K.DOM_NODE){L=D.surround(C,L,N,A,J)
}}}break
}return L
},processLeftSubtree:function(B,H){var L=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var M=this.dom.cloneNode(false);
if(!H){H=M
}else{H.appendChild(M)
}if(this.childNodes==null){return H
}var J=this.childNodes.length;
for(var G=0;
G<J;
G++){var I=this.childNodes[G];
var F=I.nodeType;
if(F==L.DOM_NODE){I.processLeftSubtree(B,M)
}else{if(F==L.TEXT_NODE){var K=I.dom;
if(I.isAligned()){var D=K.parentNode;
D.removeChild(K);
C.removeNodesWithoutContent(B,D);
C.addTextNode(K,M)
}else{M.appendChild(I.createNewTextNode(B));
var A=K.parentNode;
A.removeChild(K);
if(I.startPos>0){var E=K.nodeValue.substring(0,I.startPos);
C.addTextNode(B.createTextNode(E),A)
}else{C.removeNodesWithoutContent(B,A)
}}}}}return H
},processRightSubtree:function(B,I){var M=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var N=this.dom.cloneNode(false);
if(!I){I=N
}else{I.appendChild(N)
}if(this.childNodes==null){return I
}var K=this.childNodes.length;
for(var H=0;
H<K;
H++){var J=this.childNodes[H];
var G=J.nodeType;
if(G==M.DOM_NODE){J.processRightSubtree(B,N)
}else{if(G==M.TEXT_NODE){var L=J.dom;
if(J.isAligned()){var D=L.parentNode;
D.removeChild(L);
C.removeNodesWithoutContent(B,D);
C.addTextNode(L,N)
}else{N.appendChild(J.createNewTextNode(B));
var A=L.parentNode;
A.removeChild(L);
var E=J.startPos+J.charCnt;
if(E<J.nodeLength){var F=L.nodeValue.substring(E,J.nodeLength);
C.addTextNode(B.createTextNode(F),A)
}else{C.removeNodesWithoutContent(B,A)
}}}}}return I
},processLeftContainerSubtree:function(B,J,F){var N=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var E;
if(!F){if(this.isAligned()){this.dom.parentNode.removeChild(this.dom);
J.appendChild(this.dom);
return 
}E=this.dom.cloneNode(false);
J.appendChild(E)
}else{E=J
}var L=this.childNodes.length;
for(var I=0;
I<L;
I++){var K=this.childNodes[I];
var H=K.nodeType;
if(H==N.DOM_NODE){K.processLeftContainerSubtree(B,E)
}else{if(H==N.TEXT_NODE){var M=K.dom;
if(K.isAligned()){var D=M.parentNode;
D.removeChild(M);
C.removeNodesWithoutContent(B,D);
C.addTextNode(M,E)
}else{E.appendChild(K.createNewTextNode(B));
var A=M.parentNode;
A.removeChild(M);
if(K.startPos>0){var G=M.nodeValue.substring(0,K.startPos);
C.addTextNode(B.createTextNode(G),A)
}else{C.removeNodesWithoutContent(B,A)
}}}}}},processRightContainerSubtree:function(B,K,G){var O=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var E;
if(!G){if(this.isAligned()){this.dom.parentNode.removeChild(this.dom);
K.appendChild(this.dom);
return 
}E=this.dom.cloneNode(false);
K.appendChild(E)
}else{E=K
}var M=this.childNodes.length;
for(var J=0;
J<M;
J++){var L=this.childNodes[J];
var I=L.nodeType;
if(I==O.DOM_NODE){L.processRightContainerSubtree(B,E)
}else{if(I==O.TEXT_NODE){var N=L.dom;
if(L.isAligned()){var D=N.parentNode;
D.removeChild(N);
C.removeNodesWithoutContent(B,D);
C.addTextNode(N,E)
}else{E.appendChild(L.createNewTextNode(B));
var A=N.parentNode;
A.removeChild(N);
var F=L.startPos+L.charCnt;
if(F<L.nodeLength){var H=N.nodeValue.substring(F,L.nodeLength);
C.addTextNode(B.createTextNode(H),A,A.firstChild)
}else{C.removeNodesWithoutContent(B,A)
}}}}}},matches:function(A,C){var B=CQ.form.rte.Common;
if(B.isTag(this.dom,A)){if(!C||B.hasAttributes(C)){return true
}}return false
},removeNodesByTag:function(B,I,A,D){var H=CQ.form.rte.DomProcessor;
if(this.childNodes){var F=this.childNodes.length;
for(var G=F-1;
G>=0;
G--){var E=this.childNodes[G];
if(E.nodeType==H.DOM_NODE){E.removeNodesByTag(B,I,A,D)
}}}if(this.matches(I,A)){var C;
if(!this.isStartAligned()){if(this.type==H.STRUCTURE){C=this.processLeftSubtree(B);
if(C){this.dom.parentNode.insertBefore(C,this.dom.nextSibling);
this.dom=C
}}}if(!this.isEndAligned()){if(this.type==H.STRUCTURE){C=this.processRightSubtree(B);
if(C){this.dom.parentNode.insertBefore(C,this.dom);
this.dom=C
}}}D.remove(this)
}},getUnnecessaryLinebreaks:function(B,A){var F=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
if(this.tagName=="br"){if(B){if(C.getLastChild(B)==this.dom){A.push(this)
}}}else{if(this.type==F.CONTAINER){B=this.dom
}}if(this.childNodes){var E=this.childNodes.length;
for(var G=0;
G<E;
G++){var D=this.childNodes[G];
if(D.nodeType==F.DOM_NODE){D.getUnnecessaryLinebreaks(B,A)
}}}},getChildIndex:function(C){if(!this.childNodes){return -1
}var B=this.childNodes.length;
for(var D=0;
D<B;
D++){var A=this.childNodes[D];
if(A==C){return D
}}return -1
},removeChild:function(D){var F,E;
if(this.childNodes){var C=this.getChildIndex(D);
if(C>=0){if(!D.isInvalidatedByNormalization){CQ.form.rte.DomProcessor.removeWithoutChildren(D.dom)
}this.childNodes.splice(C,1);
if(D.childNodes){var B=D.childNodes;
E=B.length;
for(F=0;
F<E;
F++){var A=B[F];
A.parentNode=this;
this.childNodes.splice(C+F,0,A)
}}}}},createDump:function(A){if(!this.childNodes){return"DOM node; tag name: "+this.tagName
}else{var B="";
if(A){for(var C=0;
C<A;
C++){B+="   "
}}else{A=0
}var F="DOM node; tag name: "+this.tagName;
B+="   ";
var D=this.childNodes.length;
for(var G=0;
G<D;
G++){var E=this.childNodes[G];
F+="\n"+B+E.createDump(A+1)
}return F
}}});
CQ.form.rte.Selection=function(){var C=CQ.form.rte.Common;
var H=function(J,L){var K=L.node;
var M=L.offset;
if(K&&(M==0)){var I=K.previousSibling;
if(I&&(I.nodeType==1)){if(C.getNodeCharacterCnt(I)==0){if(C.isTag(I,"a")&&C.isAttribDefined(I,"href")){return 
}K=C.getPreviousCharacterNode(J,K);
if(K){L.node=K;
L.offset=(K.nodeType==3?K.nodeValue.length:0)
}}}else{if(!I&&(M==0)){K=C.getPreviousCharacterNode(J,K,C.EDITBLOCK_TAGS);
if(K){L.node=K;
L.offset=(K.nodeType==3?K.nodeValue.length:0)
}}}}};
var G=function(I,J){if((J.node.nodeType==1)&&(J.offset==null)){J.offset=C.getChildIndex(J.node);
J.node=C.getParentNode(I,J.node)
}else{if((J.offset==0)&&C.isTag(J.node,"a")&&C.isAttribDefined(J.node,"name")){J.offset=C.getChildIndex(J.node)+1;
J.node=C.getParentNode(I,J.node)
}}};
var B=function(I,M){var L=M.node;
var J=0;
var K=0;
while(L){L=C.getNextNode(I,L);
if(!L){break
}if(C.isTag(L,"a")&&C.isAttribDefined(L,"name")){K++
}J+=C.getNodeCharacterCnt(L);
if(J>M.offset){break
}}M.offset+=K
};
var A=function(I){return C.isTag(I,"a")&&C.isAttribDefined(I,"name")
};
var E=function(J,K){while(K){if(C.isTag(K,["td","th"])){return true
}var I=K.parentNode;
if(C.getChildIndex(K)!=(I.childNodes.length-1)){return false
}K=C.getParentNode(J,K)
}return false
};
var D=function(J,M,O){var K=CQ.form.rte.Selection;
if(M==null){return null
}var P=false;
if((M.nodeType==1)&&!C.isOneCharacterNode(M)){var L=M.childNodes;
var Q=L.length;
var I,N,S,R;
if((O!=null)&&(O<Q)){I=C.getFirstTextChild(L[O],true);
if(I){M=I;
O=K.getFirstSelectionOffset(I)
}else{S=C.getFirstChild(M);
if(S){M=S;
O=null
}}}else{N=C.getLastTextChild(M,true);
if(N){M=N;
O=K.getLastSelectionOffset(N)
}else{R=C.getLastChild(M);
if(R){M=R;
O=null
}else{P=C.isEmptyEditingBlock(M)
}}}return{node:M,offset:O,isEmptyBlock:P}
}return null
};
var F={getScrollOffsets:function(I){return{scrollTop:I.root.scrollTop,scrollLeft:I.root.scrollLeft}
},setScrollOffsets:function(I,J){if((J.scrollTop!==undefined)&&(J.scrollLeft!==undefined)){I.root.scrollTop=J.scrollTop;
I.root.scrollLeft=J.scrollLeft
}},hasWhitespaceOnly:function(M){var K=" \n\r\t";
if(CQ.Ext.isGecko){K+=String.fromCharCode(160)
}var J=M.length;
for(var L=0;
L<J;
L++){var I=M.charAt(L);
if(K.indexOf(I)<0){return false
}}return true
},bookmarkFromProcessingSelection:function(L,M){var I=CQ.form.rte.Common;
M={startNode:M.startNode,startOffset:M.startOffset,endNode:M.endNode,endOffset:M.endOffset};
CQ.form.rte.Selection.normalizeProcessingSelection(L,M);
var K=I.getCharacterOffsetForNode(L,M.startNode);
if(I.isOneCharacterNode(M.startNode)){if((M.startOffset!=null)&&(M.startOffset===0)){K++
}}else{if(M.startOffset){K+=M.startOffset
}}var J=K;
if(M.endNode){J=I.getCharacterOffsetForNode(L,M.endNode);
if(I.isOneCharacterNode(M.endNode)){if((M.endOffset!=null)&&(M.endOffset===0)){J++
}}else{if(M.endOffset){J+=M.endOffset
}}}return{startPos:K,charCnt:(J-K),object:null,insertObject:null}
},compareBookmarks:function(J,I){if(J==null){return(I==null)
}if(I==null){return false
}return(J.startPos==I.startPos)&&(J.charCnt==I.charCnt)&&(J.object==I.object)&&(J.insertObject==I.insertObject)
},isLineDelimiter:function(M){if(M.nodeType!=1){return false
}var L=CQ.form.rte.Selection.LINE_DELIMITING_TAGS;
var J=L.length;
var I=M.tagName.toLowerCase();
for(var K=0;
K<J;
K++){if(L[K]==I){return true
}}return false
},getLineDelimiter:function(I,J){while(J){if(J.nodeType==1){if(CQ.form.rte.Selection.isLineDelimiter(J)){return J
}}J=C.getParentNode(I,J)
}return null
},adaptToInclusiveEndNode:function(J,R){var K=CQ.form.rte.Selection;
var N={startNode:R.startNode,startOffset:R.startOffset};
if(C.isRootNode(J,R.startNode)&&(R.startOffset==R.startNode.childNodes.length)){N.isEOT=true;
return N
}var O=R.endNode;
var Q=R.endOffset;
if(O){var I=function(){var S=C.getPreviousCharacterNode(J,O);
if(S){O=S;
Q=K.getLastSelectionOffset(S)
}};
if(C.isOneCharacterNode(O)){if(Q==0){Q=null
}else{I()
}}else{if(O.nodeType==1){var L;
if((Q==undefined)||(O.childNodes.length==Q)){L=C.getLastTextChild(O,true);
if(L){O=L;
Q=K.getLastSelectionOffset(O)
}else{I()
}}else{O=O.childNodes[Q];
Q=null;
L=C.getPreviousTextNode(J,O);
if(L){O=L;
Q=K.getLastSelectionOffset(L)
}}}else{if(O.nodeType==3){if(Q>0){Q--
}else{I();
var P=(C.getNextCharacterNode(J,O,C.EDITBLOCK_TAGS)==null);
if(!P){if(C.isOneCharacterNode(O)){Q=null
}else{Q--
}}}}}}var M=R.endNode;
if(M!=O){M=C.getPreviousNode(J,M);
while(M&&(M!=O)){if(C.isEmptyEditingBlock(M)){if((R.startNode==M)&&(R.startOffset==null)){O=null
}else{O=M;
Q=null
}break
}M=C.getPreviousNode(J,M)
}}if(O!=null){N.endNode=O;
N.endOffset=Q
}}return N
},expandToLineBorders:function(J,S){var K=CQ.form.rte.Selection.isLineDelimiter;
var N=CQ.form.rte.Selection.getLineDelimiter;
var I,M;
var L=S.startNode;
var P=S.endNode;
if(P==null){P=L
}var R=N(J,L);
if(R==null){var T=L;
while(T){do{I=T;
T=C.getPreviousNode(J,T);
if(!T){break
}if(C.isRootNode(J,T)){T=null;
break
}if(N(J,T)!=null){T=null;
break
}}while(T.nodeType==3);
if(!T){R=I;
break
}M=T.tagName.toLowerCase();
if(M=="br"){R=I;
break
}}}var O=N(J,P);
if(O==null){if((P.nodeType==1)&&(P.tagName.toLowerCase()=="br")){O=P
}else{var Q=P;
while(Q){do{I=Q;
Q=C.getNextNode(J,Q);
if(!Q){break
}if(C.isRootNode(J,Q)){Q=null;
break
}}while(Q.nodeType==3);
if(!Q||K(Q)){O=I;
break
}M=Q.tagName.toLowerCase();
if(M=="br"){O=Q;
break
}}}}if(K(R)){if(R.childNodes.length>0){R=R.childNodes[0]
}}if(K(O)){if(O.childNodes.length>0){O=C.getLastChild(O)
}}return{startNode:R,startOffset:(R.nodeType==3?0:null),endNode:O,endOffset:(O&&O.nodeType==3?C.getNodeCharacterCnt(O):null)}
},isNoInsertNode:function(K){if(K.nodeType==3){return false
}var L=CQ.form.rte.Selection.NO_INSERT_TAGS;
for(var I=0;
I<L.length;
I++){var J=C.matchesTagDef(K,L[I]);
if(J){return true
}}return false
},isSelection:function(I){return(I.endNode!=null)||(I.cellSelection!=null)
},getSelectedDom:function(I){var J=null;
if((I.startNode&&(I.startOffset==null))&&!I.endNode){J=I.startNode
}return J
},getFirstSelectionOffset:function(I){return(I.nodeType==3?0:null)
},getLastSelectionOffset:function(I){if(I.nodeType==3){return I.nodeValue.length
}if(C.isOneCharacterNode(I)){return 0
}return null
},shouldNormalizePSelForNodeList:function(J,K){if(CQ.form.rte.Selection.isSelection(K)){return true
}var I=K.startNode;
if(C.isOneCharacterNode(I)&&(K.startOffset==0)){return true
}if(I.nodeType==1){return true
}return false
},shouldNormalizePSel:function(J,K){if(CQ.form.rte.Selection.isSelection(K)){return true
}var I=K.startNode;
if((I.nodeType==1)&&!C.isOneCharacterNode(I)){return true
}return false
},normalizeProcessingSelection:function(J,T){var K=CQ.form.rte.Selection;
var L=T.startNode;
var Q=T.startOffset;
var N=T.endNode;
var R=T.endOffset;
if(L){var I=D(J,L,Q);
if(I!=null){L=I.node;
Q=I.offset
}var O=D(J,N,R);
if(O!=null){N=O.node;
R=O.offset
}if(C.isCharacterNode(L)){var P=false;
var M=false;
if(C.isOneCharacterNode(L)){P=(Q==0)
}else{P=(Q>=L.nodeValue.length);
M=(L==N)&&(Q==R)
}if(P){var S=C.getNextCharacterNode(J,L,C.EDITBLOCK_TAGS);
if(S){L=S;
Q=K.getFirstSelectionOffset(S);
if(!M){M=(L==N)&&(Q==R)
}if(M){N=null;
R=null
}}}}T.startNode=L;
T.startOffset=Q;
T.endNode=N;
T.endOffset=R
}},LINE_DELIMITING_TAGS:["p","li","h1","h2","h3","h4","h5","h6"],NO_INSERT_TAGS:[{tagName:"a",attribsDefined:["name"],attribsUndefined:["href"]},{tagName:"img"},{tagName:"span",empty:true}],SELECTION_INCLUSION_TAGS:[{tagName:"a",attribsDefined:["name"],attribsUndefined:["href"]}]};
return CQ.Ext.apply(F,CQ.Ext.isIE?{getRangePosition:function(I,M){M.collapse(true);
var J=M.parentElement();
var N=J.childNodes.length;
var K=C.getCharacterOffsetForNode(I,J);
if(C.isTag(J,"a")&&C.isAttribDefined(J,"name")){return K+1
}var U=M.duplicate();
U.moveToElementText(J);
U.collapse(true);
U.setEndPoint("StartToEnd",M);
var R=0;
var P=0;
for(var L=0;
L<N;
L++){var Q=J.childNodes[L];
if(Q.nodeType==1){var S=U.duplicate();
S.moveToElementText(Q);
S.collapse(false);
var O=(S.compareEndPoints("StartToStart",M));
if(O<=0){R=L+1;
U.setEndPoint("StartToStart",S);
K+=P;
if(O<0){K+=C.getNodeTextLength(Q);
P=0
}else{K+=C.getNodeTextLength(Q);
break
}}else{break
}}else{P+=C.getNodeTextLength(Q)
}}var T=U.text.replace(/[\n\t\r]/g,"");
K+=T.length;
return K
},setRangePosition:function(J,L,S){var K=CQ.form.rte.Selection;
var P=J.doc.selection.createRange();
var R=C.getNodeAtPosition(J,L);
if(R==null){P.moveToElementText(J.root);
P.collapse(false);
return P
}if(R.isNodeSelection){if(R.startOfElement||C.isEmptyEditingBlock(R.dom,true)){K.setNodeToRange(J,P,R.dom,true)
}else{P.moveToElementText(R.dom);
P.collapse(false);
var T=P.parentElement();
var M=P.duplicate();
if(K.isNoInsertNode(T)){P.move("character",-1);
P.move("character",1)
}else{if(!E(J,T)&&M.move("character",1)==1){P.move("character",-1)
}}}return P
}var O=R.parentDom;
var I=R.parentOffset;
if(!O){var U=R.nodeBefore;
if(U){if(U.nodeType==3){P.moveToElementText(U.parentNode)
}else{P.moveToElementText(U)
}}else{P.moveToElementText(J.root)
}P.collapse(false);
return P
}var N=R.isUnregularNestedIssue;
var Q;
if(N){Q=R.nestedItemDom
}R={node:O,offset:I};
B(J,R);
K.setNodeToRange(J,P,R.node,true);
if(N){P.moveToElementText(Q);
P.collapse(true);
if(S){P.move("character",-2);
P.moveEnd("character",1)
}return P
}if(R.offset>0){P.move("character",R.offset)
}return P
},getSelection:function(I){return I.doc.selection
},getLeadRange:function(I){return I.doc.selection.createRange()
},getCaretPos:function(J){var I=J.doc.selection.createRange();
return CQ.form.rte.Selection.getRangePosition(J,I)
},setCaretPos:function(J,K){var I=CQ.form.rte.Selection.setRangePosition(J,K);
if(I){I.select()
}},createRange:function(I){return I.doc.selection.createRange()
},selectRange:function(J,I){I.select()
},createRangeBookmark:function(I){return{single:true,bookmark:I.doc.selection.createRange()}
},selectRangeBookmark:function(I,J){if(J&&J.single&&J.bookmark){J.bookmark.select()
}},getRangeTextContent:function(J,I){return I.text
},createSelectionBookmark:function(J){var L=CQ.form.rte.Selection;
var N=J.doc.selection.createRange();
var Q=null;
var I=null;
var P,K;
if(N.item){Q=N.item(0);
P=C.getCharacterOffsetForNode(J,Q);
K=P
}else{var R=N.duplicate();
R.collapse(true);
P=L.getRangePosition(J,R);
var M=N.duplicate();
M.collapse(false);
K=L.getRangePosition(J,M);
if(P==K){var O=N.parentElement();
if(O){if(O.childNodes.length==0){I=O;
if(L.isNoInsertNode(I)){I=null
}}}}}return CQ.Ext.apply({startPos:P,charCnt:(K-P),object:Q,insertObject:I},L.getScrollOffsets(J))
},selectBookmark:function(L,M){var O=CQ.form.rte.Selection;
var I=null;
var J=false;
if(M.object){I=M.object;
J=true
}else{if(M.insertObject){I=M.insertObject
}}var K;
if(I){try{if(J){K=L.root.createControlRange();
K.addElement(I)
}else{K=L.doc.selection.createRange();
K.moveToElementText(I);
K.collapse(true)
}}catch(P){if(M.startPos){I=undefined
}}}if(!I){K=O.setRangePosition(L,M.startPos);
if(M.charCnt>0){var N=O.setRangePosition(L,M.startPos+M.charCnt,true);
K.setEndPoint("EndToEnd",N)
}}if(K){K.select()
}O.setScrollOffsets(L,M)
},trimRangeWhitespace:function(M,K){var O=CQ.form.rte.Selection;
var J,I;
if(K.item){return K
}J=K.duplicate();
J.collapse(true);
var N=0;
while(true){I=J.duplicate();
I.moveEnd("character",N+1);
if(!O.hasWhitespaceOnly(I.text)){break
}N++
}J=K.duplicate();
J.collapse(false);
var L=0;
while(true){I=J.duplicate();
I.moveStart("character",-(L+1));
if(!O.hasWhitespaceOnly(I.text)){break
}L++
}I=K.duplicate();
if(N>0){I.moveStart("character",N)
}if(L>0){I.moveEnd("character",-L)
}if(I.text.length>0){K=I
}return K
},getRangeNodeAndOffset:function(AB,S,X,O){var P=CQ.form.rte.Common;
var j=CQ.form.rte.Selection;
var o;
var T=S.parentElement();
var N=(P.isRootNode(AB,T)?T:null);
if(j.isNoInsertNode(T)){var w=P.getTagInPath(AB,T,P.EDITBLOCK_TAGS);
var y=false;
T=P.getNextCharacterNode(AB,T);
if(!T){T=w;
y=true
}o=j.getFirstSelectionOffset(T);
var r=P.getTagInPath(AB,T,P.EDITBLOCK_TAGS);
if(!y&&(r!=w)){T=w;
o=null
}return{dom:T,offset:o}
}var g=S.duplicate();
g.moveEnd("character",1);
var t=g.duplicate();
t.collapse(false);
var m=t.parentElement();
var Q=S.duplicate();
var k=S.parentElement();
Q.moveToElementText(k);
Q.collapse(true);
if(Q.move("character",1)==1){Q.move("character",-1)
}var I=null;
var Y=null;
var x=k.childNodes.length;
var M=false;
for(var W=0;
W<x;
W++){var AA=k.childNodes[W];
if(AA.nodeType==1){var d=Q.duplicate();
Q.moveToElementText(AA);
var n=Q.duplicate();
Q.collapse(true);
n.collapse(false);
if(Q.compareEndPoints("StartToStart",g)==0){I=AA;
M=true;
break
}else{if(n.compareEndPoints("EndToEnd",g)==0){var v=Q.parentElement();
if(P.isTag(AA,"img")&&A(v)){var z=P.getPreviousCharacterNode(AB,AA,P.EDITBLOCK_TAGS);
if(z!=v){M=true
}}I=AA;
var a=P.getLastTextChild(I,true);
if(a){I=a;
Y=j.getLastSelectionOffset(I)
}break
}else{if(m==AA){if(P.isTag(m,"table")&&N){I=N;
Y=P.getChildIndex(m)
}else{I=AA
}break
}}}var J=P.hasTextChild(AA);
if(P.isOneCharacterNode(AA)||J){Q.moveToElementText(AA);
Q.collapse(false)
}else{d.move("character",2);
Q=d
}}}if(!I){var Z=S.duplicate();
Z.moveToElementText(T);
Z.collapse(true);
Z.setEndPoint("StartToEnd",S);
var L=0;
for(W=0;
W<x;
W++){var K=k.childNodes[W];
if(K.nodeType==1){var b=Z.duplicate();
b.moveToElementText(K);
b.collapse(false);
var u=(b.compareEndPoints("StartToStart",S));
if(u<0){L=W+1;
Z.setEndPoint("StartToStart",b)
}else{break
}}}var c=Z.text.replace(/[\n\t\r]/g,"");
var V=c.length;
var U=0;
for(W=L;
W<x;
W++){K=k.childNodes[W];
var q=P.getNodeTextLength(K);
if((U+q)>V){I=K;
Y=V-U;
break
}U+=q
}}if(I&&(I.nodeType==1)&&!P.isRootNode(AB,I)){if(!P.isOneCharacterNode(I)){var AC=P.getFirstTextChild(I);
if(AC){I=AC;
Y=0
}}else{if(P.isTag(I,"img")){if(!M){Y=0
}}}}if(!I){if(N){I=N;
Y=N.childNodes.length
}else{I=P.getLastTextChild(T,true);
if(I){if(X&&O&&((I.nodeType==3)||P.isTag(I,"br"))){var R=P.getNextCharacterNode(AB,I,P.EDITBLOCK_TAGS);
if(R){I=R;
Y=j.getFirstSelectionOffset(I)
}else{Y=P.getNodeTextLength(I)
}}else{Y=j.getLastSelectionOffset(I)
}}else{I=T
}}}return{dom:I,offset:Y}
},createProcessingSelection:function(J){var K=CQ.form.rte.Selection;
var N=J.doc.selection.createRange();
if(N.item){return{startNode:N.item(0)}
}var P=N.duplicate();
P.collapse(true);
var M=N.duplicate();
M.collapse(false);
var I;
var O={dom:null,offset:null};
if(P.compareEndPoints("StartToStart",M)==0){I=K.getRangeNodeAndOffset(J,P,false)
}else{I=K.getRangeNodeAndOffset(J,P,true,true);
O=K.getRangeNodeAndOffset(J,M,true,false);
if(C.isEmptyEditingBlock(O.dom)){var L=C.getNextNode(J,O.dom);
while(L){var Q=C.isEmptyEditingBlock(L)||C.isCharacterNode(L);
if(Q){break
}L=C.getNextNode(J,L)
}if(!L){O.offset=C.getChildIndex(O.dom);
O.dom=C.getParentNode(J,O.dom)
}else{O.dom=L;
O.offset=K.getFirstSelectionOffset(L)
}}}if((I.dom==O.dom)&&(I.offset==O.offset)){O.dom=null;
O.offset=null
}if(!C.isAncestor(J,J.root,I.dom)){return null
}return{startNode:I.dom,startOffset:I.offset,endNode:O.dom,endOffset:O.offset}
},setNodeToRange:function(L,I,O,M){if(O.nodeType==3){throw new Error("Cannot select text node")
}try{I.moveToElementText(O);
var K=I.parentElement();
if(M){if(A(K)){I.collapse(true);
I.move("character",-1);
if(A(I.parentElement())){if(I.move("character",2)==2){I.move("character",-1)
}if(A(I.parentElement())){I.move("character",-1)
}}else{K=I.parentElement();
if((O!=K)&&!C.isAncestor(L,O,K)){if(!A(O)){I.moveToElementText(O);
I.collapse(true)
}}}}else{I.collapse(true);
var J=C.getPreviousCharacterNode(L,O);
if(C.isTag(O,C.EDITBLOCK_TAGS)&&C.isTag(J,"a")&&C.isAttribDefined(J,"name")){if(I.move("character","-1")==-1){if(I.move("character","2")==2){if(C.getNextNode(L,O)!=null){I.move("character","-1")
}}}}else{if(!C.isEmptyEditingBlock(O,true)){if(I.move("character",1)==1){I.move("character",-1)
}}}}}}catch(N){}},selectNode:function(J,L,K){if(L.nodeType==3){throw new Error("Selecting a text node is not supported.")
}var I=J.doc.selection.createRange();
CQ.form.rte.Selection.setNodeToRange(J,I,L,K);
I.select()
},resetSelection:function(K,O){var M=CQ.form.rte.Selection;
var I=K.doc.selection.createRange();
var J=K.root;
if(O=="all"){I.moveToElementText(J)
}else{if(O=="start"){var P=C.getNextEditableNode(K,K.root);
if(P){J=P.parentNode
}M.setNodeToRange(K,I,J,true)
}else{if(O=="end"){var N=null;
var L=C.getLastChild(K.root);
if(L){if(C.isEditableNode(L)){N=L
}else{N=C.getPreviousEditableNode(K,K.root)
}if(N){J=N.parentNode
}}M.setNodeToRange(K,I,J,false);
I.collapse(false)
}}}I.select()
},flushSelection:function(I,J){},isCollapsed:function(I){if(I.item){return false
}var K=I.duplicate();
K.collapse(true);
var J=I.duplicate();
J.collapse(false);
return K.isEqual(J)
}}:{getNodeCharacters:function(J){var I=J.nodeValue;
if(I){return I
}return""
},getCharPosition:function(K,M,O){var L=0;
var N,I;
if((M.nodeType==1)&&!C.isOneCharacterNode(M)){if(!C.isRootNode(K,M)){L=C.getCharacterOffsetForNode(K,M)
}for(var P=0;
P<O;
P++){var J=M.childNodes[P];
L+=C.getNodeCharacterCnt(J);
N=K.doc.createTreeWalker(J,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null,false);
while(true){I=N.nextNode();
if(I==null){break
}L+=C.getNodeCharacterCnt(I);
if(C.isTag(I,C.EDITBLOCK_TAGS)){L++
}}if(C.isTag(J,C.EDITBLOCK_TAGS)){L++
}}return L
}if(M.nodeType==1){if(O==0){O=1
}}return C.getCharacterOffsetForNode(K,M)+O
},calcNodeAndOffsetForPosition:function(L,P,V,b,j){var a=CQ.form.rte.Selection;
if(!b){b=L.root;
j=0
}var J,Q;
if(!C.isRootNode(L,b)){var Z=C.getNodeCharacterCnt(b);
var X=false;
if(C.isTag(b,C.EDITBLOCK_UNREGNEST_TAGS)){if((C.getChildIndex(b)==0)&&C.isFirstNestedList(L,b.parentNode)){var I=b;
do{I=C.getParentNode(L,I);
if(I&&C.isTag(I,C.EDITBLOCK_UNREGNEST_TAGS)){Z++;
X=true;
break
}}while(I)
}}J=(Z>0)&&(V?(P<=(j+Z)):(P<(j+Z)));
if((P>=j)&&J){if(X){Q=null;
var O=C.getPreviousCharacterNode(L,b);
if(O){b=O;
Q=a.getLastSelectionOffset(b)
}return{node:b,offset:Q}
}Q=P-j;
if(b.nodeType==1){Q=(Q==0?null:0);
if(C.isTag(b,"br")&&(Q==0)&&V){var d=C.getNextCharacterNode(L,b);
if(d){b=d;
Q=a.getFirstSelectionOffset(b)
}}}return{node:b,offset:Q}
}j+=Z
}var N=b.childNodes.length;
for(var g=0;
g<N;
g++){var S=b.childNodes[g];
var k=CQ.form.rte.Selection.calcNodeAndOffsetForPosition(L,P,V,S,j);
if(typeof (k)=="object"){return k
}j=k;
if(C.isTag(S,C.EDITBLOCK_TAGS)){if(P==j){var R=C.getLastTextChild(S,true);
if(R){Q=a.getLastSelectionOffset(R);
return{node:R,offset:Q}
}return{node:S,offset:null}
}var M=true;
if(C.isTag(S,C.EDITBLOCK_UNREGNEST_TAGS)){var U=C.getParentNode(L,S);
var T=C.getChildIndex(S);
var W=(T==(U.childNodes.length-1));
var K=C.containsTagInPath(L,U,C.EDITBLOCK_UNREGNEST_TAGS);
M=!(W&&K&&C.isLastNestedList(L,U))
}else{if(C.isTag(S,C.EDITBLOCK_NESTED_TAGS)){M=!C.isLastElementOfNestingLevel(L,S)
}}if(M){j++
}}}if(C.isRootNode(L,b)){var Y=C.getLastChild(b);
Q=a.getLastSelectionOffset(Y);
return{node:Y,offset:Q}
}return j
},getSelectionObject:function(I){if(I.anchorNode!=I.focusNode){return null
}if(Math.abs(I.anchorOffset-I.focusOffset)!=1){return null
}var K=(I.anchorOffset<I.focusOffset?I.anchorOffset:I.focusOffset);
var J=I.anchorNode.childNodes[K];
if(!J){return null
}if(J.nodeType==3){return null
}if(C.isTag(J,["td","th"])){return null
}return J
},getTableSelection:function(L){var N={cells:[],otherContent:false};
var M=L.win.getSelection();
for(var K=0;
K<M.rangeCount;
K++){var J=M.getRangeAt(K);
var I=null;
if(J.startContainer==J.endContainer){I=J.startContainer;
if(C.isTag(I,"tr")){if(J.startOffset==(J.endOffset-1)){I=I.childNodes[J.startOffset]
}else{I=null
}}else{if(!C.isTag(J.startContainer,["th","td"])){I=null
}}}if(I){N.cells.push(I)
}else{N.otherContent=true
}}return((N.cells.length>0)?N:null)
},getSelection:function(I){return I.win.getSelection()
},getLeadRange:function(I){return I.win.getSelection().getRangeAt(0)
},getCaretPos:function(I){var J=I.win.getSelection();
if((J.anchorNode!=J.focusNode)||(J.anchorOffset!=J.focusOffset)){return -1
}return CQ.form.rte.Selection.getCharPosition(I,J.anchorNode,J.anchorOffset)
},setCaretPos:function(K,M){if(M<0){M=0
}var L=K.win.getSelection();
var J=K.doc.createRange();
var I=CQ.form.rte.Selection.calcNodeAndOffsetForPosition(K,M);
H(K,I);
G(K,I);
J.setStart(I.node,I.offset);
J.setEnd(I.node,I.offset);
L.removeAllRanges();
L.addRange(J)
},createRange:function(I){return I.doc.createRange()
},selectRange:function(J,I){var K=J.win.getSelection();
K.removeAllRanges();
K.addRange(I)
},createRangeBookmark:function(J){var K=J.win.getSelection();
if(K.rangeCount==1){return{single:true,bookmark:K.getRangeAt(0)}
}else{var I=[];
for(var L=0;
L<K.rangeCount;
L++){I.push(K.getRangeAt(L))
}return{single:false,bookmark:I}
}},selectRangeBookmark:function(J,L){if(L&&L.bookmark){var K=J.win.getSelection();
K.removeAllRanges();
if(L.single){K.addRange(L.bookmark)
}else{var I=L.bookmark;
for(var M=0;
M<I.length;
M++){K.addRange(I[M])
}}}},getRangeTextContent:function(L,K){var N=K.cloneContents();
var J=L.doc.createTreeWalker(N,NodeFilter.SHOW_TEXT,null,false);
var M="";
while(true){var I=J.nextNode();
if(I==null){break
}M+=CQ.form.rte.Selection.getNodeCharacters(I)
}return M
},createSelectionBookmark:function(K){var M=CQ.form.rte.Selection;
var T=K.win.getSelection();
var S=CQ.form.rte.Selection.getSelectionObject(T);
var J=null;
var X=null;
var R,L,O;
var W=T.rangeCount;
if(W==1){R=M.getCharPosition(K,T.anchorNode,T.anchorOffset);
L=M.getCharPosition(K,T.focusNode,T.focusOffset)
}else{if(W>1){X=[];
for(var I=0;
I<W;
I++){O=T.getRangeAt(I);
var U=O.startContainer;
if(C.isTag(U,"tr")){X.push(U.childNodes[O.startOffset])
}var V=M.getCharPosition(K,O.startContainer,O.startOffset);
if((I==0)||(V<R)){R=V;
L=V
}}}}if(L<R){var N=L;
L=R;
R=N
}if((R==L)&&!X){O=T.getRangeAt(0);
var P=O.commonAncestorContainer;
if(P.nodeType==1){var Q=P.childNodes.length;
if((Q==0)||((Q==1)&&C.isTag(P.childNodes[0],"br"))){J=P;
if(CQ.form.rte.Selection.isNoInsertNode(J)){J=null
}}}}return CQ.Ext.apply({startPos:R,charCnt:L-R,object:S,insertObject:J,cells:X},CQ.form.rte.Selection.getScrollOffsets(K))
},selectBookmark:function(K,S){var L=CQ.form.rte.Selection;
var W=K.doc;
var V=null;
var P,X;
var Y=S.cells;
if(Y){X=K.win.getSelection();
X.removeAllRanges();
var J=false;
var O=Y.length;
for(var U=0;
U<O;
U++){var T=Y[U];
if(T&&T.ownerDocument==W){P=W.createRange();
var I=T.parentNode;
var N=C.getChildIndex(T);
try{P.setStart(I,N);
P.setEnd(I,N+1);
X.addRange(P);
J=true
}catch(R){}}}if(J){return 
}}if(S.object){V=S.object
}else{if(S.insertObject){V=S.insertObject
}}P=W.createRange();
if(V){try{P.selectNode(V);
P.collapse(true)
}catch(R){if(S.startPos!=null){V=undefined
}}}if(!V){var M=L.calcNodeAndOffsetForPosition(K,S.startPos);
var Q=M;
if(S.charCnt>0){Q=L.calcNodeAndOffsetForPosition(K,S.startPos+S.charCnt,true)
}H(K,M);
G(K,M);
if(S.charCnt>0){G(K,Q)
}P.setStart(M.node,M.offset);
P.setEnd(Q.node,Q.offset)
}X=K.win.getSelection();
X.removeAllRanges();
X.addRange(P)
},trimRangeWhitespace:function(J,O){var K=CQ.form.rte.Selection;
var R=K.getRangeTextContent(J,O);
var T=0;
var S=1;
var L;
while(S<R.length){L=R.substring(0,S++);
if(!K.hasWhitespaceOnly(L)){break
}T++
}var N=0;
S=R.length;
while(S>0){L=R.substring(--S,R.length);
if(!K.hasWhitespaceOnly(L)){break
}N++
}if((R.length-T-N)>0){if(T>0){var Q=K.getCharPosition(J,O.startContainer,O.startOffset);
Q+=T;
var M=K.calcNodeAndOffsetForPosition(J,Q);
O.setStart(M.node,M.offset)
}if(N>0){var I=K.getCharPosition(J,O.endContainer,O.endOffset);
I-=N;
var P=K.calcNodeAndOffsetForPosition(J,I);
O.setEnd(P.node,P.offset)
}}return O
},createProcessingSelection:function(I){var K,T,Q,U;
var X=I.win.getSelection();
var J=CQ.form.rte.Selection;
var M=null;
var W=false;
if((X.focusNode==X.anchorNode)&&(C.isTag(X.focusNode,"tr"))){W=true
}if((X.rangeCount>1)||W){M=J.getTableSelection(I);
var P=X.getRangeAt(0);
K=P.startContainer;
T=null;
if(K.nodeType==1){K=K.childNodes[P.startOffset]
}else{T=P.startOffset
}P=X.getRangeAt(X.rangeCount-1);
U=null;
Q=P.endContainer;
if(Q.nodeType==1){if(P.endOffset<Q.childNodes.length){Q=C.getPreviousNode(I,Q.childNodes[P.endOffset])
}else{Q=C.getLastChild(Q)
}if(Q.nodeType==3){U=C.getNodeCharacterCnt(Q)
}}else{U=P.endOffset
}return{startNode:K,startOffset:T,endNode:Q,endOffset:U,isDiscontinuousSelection:true,cellSelection:M}
}var S=J.getSelectionObject(X);
if(S){return{startNode:S}
}K=X.anchorNode;
T=X.anchorOffset;
Q=X.focusNode;
U=X.focusOffset;
var N=(K==Q)&&(T==U);
var R;
if(!C.isOneCharacterNode(K)&&(K.nodeType==1)){R=K.childNodes.length;
if(R==0){T=null
}else{if(T<R){K=K.childNodes[T];
T=null
}else{K=C.getLastChild(K);
if(K.nodeType==3){T=C.getNodeCharacterCnt(K)
}else{if(C.isOneCharacterNode(K)){T=0
}else{T=null
}}}}}if(N){return{startNode:K,startOffset:T,cellSelection:M}
}if(!C.isOneCharacterNode(Q)&&(Q.nodeType==1)){R=Q.childNodes.length;
if(R==0){U=null
}else{if(U<R){Q=Q.childNodes[U];
U=(Q.nodeType==1?null:0)
}else{Q=C.getLastChild(Q);
if(Q.nodeType==3){U=C.getNodeCharacterCnt(Q)
}else{if(C.isOneCharacterNode(Q)){U=0
}else{U=null
}}}}}var V=false;
if(K==Q){V=(U<T)
}else{var Y=C.createIndexPath(I,K);
var O=C.createIndexPath(I,Q);
V=(C.compareIndexPaths(Y,O)<0)
}if(V){var L=Q;
Q=K;
K=L;
L=U;
U=T;
T=L
}return{startNode:K,startOffset:T,endNode:Q,endOffset:U,cellSelection:M}
},selectNode:function(J,N,L){if(N.nodeType==3){throw new Error("Selecting a text node is not supported.")
}var K=J.win.getSelection();
var I=J.doc.createRange();
if(L){var M=C.getFirstTextChild(N);
if(M){I.setStart(M,0);
I.setEnd(M,0)
}else{if((N.childNodes.length==1)&&(N.childNodes[0].nodeType==1)){I.selectNode(N.childNodes[0]);
I.collapse(true)
}else{I.selectNode(N);
I.collapse(true)
}}}else{I.selectNode(N)
}K.removeAllRanges();
K.addRange(I)
},getPreferredScrollOffset:function(I){return I.root.scrollTop
},ensureCaretVisibility:function(L,K){var N=CQ.form.rte.Selection;
var S=N.getLeadRange(L).cloneRange();
if(S.startContainer.nodeType==1){var Q=S.startContainer.childNodes[S.startOffset];
if(C.isTag(Q,["td","th"])){S.selectNodeContents(Q)
}}if(L.iFrame){var P=L.createElement("span");
S.insertNode(P);
var V=P.offsetTop;
var T=P;
while(T.offsetParent){T=T.offsetParent;
V+=T.offsetTop
}var X=P.clientHeight;
var M=L.root.scrollTop;
var R=L.iFrame.clientHeight;
var J=M+R;
var I=V+X;
var U=L.root.scrollHeight;
if((U-I)<8){I=U
}if(K!=null){var O=K-R;
if((V>=K)&&(I<O)){L.root.scrollTop=K
}else{if(V<K){L.root.scrollTop=V
}else{L.root.scrollTop=I-R
}}}else{if(I>J){L.root.scrollTop=I-R
}}var W=P.parentNode;
W.removeChild(P);
W.normalize()
}},flushSelection:function(I,K){var J=I.win.getSelection();
var N;
if(K){N=[];
var M=J.rangeCount;
for(var L=0;
L<M;
L++){N.push(J.getRangeAt(L))
}}J.selectAllChildren(I.root);
J.collapseToStart();
if(K){J.removeAllRanges();
for(L=0;
L<M;
L++){J.addRange(N[L])
}}},resetSelection:function(J,N){var K=J.win.getSelection();
var I=J.root;
if(N=="all"){K.selectAllChildren(I)
}else{if(N=="start"){var O=C.getNextEditableNode(J,J.root);
if(O){I=O.parentNode
}K.selectAllChildren(I);
K.collapseToStart()
}else{if(N=="end"){var M=null;
var L=C.getLastChild(J.root);
if(L){if(C.isEditableNode(L)){M=L
}else{M=C.getPreviousEditableNode(J,J.root)
}if(M){I=M.parentNode
}}K.selectAllChildren(I);
K.collapseToEnd()
}}}}})
}();
CQ.form.rte.UndoManager=CQ.Ext.extend(CQ.Ext.emptyFn,{undoHistory:null,maxUndoSteps:0,activeUndoStep:0,constructor:function(A){this.undoHistory=[];
this.maxUndoSteps=A;
this.activeUndoStep=0
},addStep:function(A){var B;
if(this.activeUndoStep>0){B=this.undoHistory[this.activeUndoStep-1];
if(B.hasEqualSnapshot(A)){return false
}}this.clearRedoHistory();
this.undoHistory.push(A);
if(this.undoHistory.length>this.maxUndoSteps){var C=this.undoHistory.length-this.maxUndoSteps;
this.undoHistory.splice(0,C);
this.activeUndoStep-=C
}this.activeUndoStep++;
return true
},canUndo:function(){return(this.activeUndoStep>1)
},canRedo:function(){return(this.activeUndoStep<this.undoHistory.length)
},undo:function(A){if(this.addStep(new CQ.form.rte.UndoManager.Step(A))){}if(this.canUndo()){this.activeUndoStep--;
this.undoHistory[this.activeUndoStep-1].set(A)
}},redo:function(A){if(this.addStep(new CQ.form.rte.UndoManager.Step(A))){}if(this.canRedo()){this.undoHistory[this.activeUndoStep].set(A);
this.activeUndoStep++
}},initialize:function(A){this.undoHistory.length=0;
this.activeUndoStep=0;
this.addStep(new CQ.form.rte.UndoManager.Step(A))
},clearRedoHistory:function(){var A=this.undoHistory.length-this.activeUndoStep;
if(A>0){this.undoHistory.splice(this.activeUndoStep,A)
}},createShortDump:function(){var A=this.undoHistory.length;
return"Undo history ("+A+" steps; active step: #"+this.activeUndoStep+"; maximum steps: "+this.maxUndoSteps+")"
},createDump:function(){var C=this.undoHistory.length;
var B=this.createShortDump()+":\n";
for(var A=0;
A<C;
A++){B+="#"+A+": "+this.undoHistory[A].createDump()
}return B
}});
CQ.form.rte.UndoManager.Step=CQ.Ext.extend(CQ.Ext.emptyFn,{htmlSnapshot:null,bookmark:null,constructor:function(A,B){var C=CQ.form.rte.Selection;
this.bookmark=(B?B:C.createSelectionBookmark(A));
this.htmlSnapshot=A.root.innerHTML
},set:function(A){A.root.innerHTML=this.htmlSnapshot;
CQ.form.rte.Selection.selectBookmark(A,this.bookmark)
},hasEqualSnapshot:function(A){return this.htmlSnapshot==A.htmlSnapshot
},equals:function(B){var A=CQ.form.rte.Selection;
if(this.htmlSnapshot!=B.htmlSnapshot){return false
}return A.compareBookmarks(this.bookmark,B.bookmark)
},createDump:function(){var A="\n";
A+="Bookmark:\n"+this.bookmark.toSource();
A+="\nHTML-Snapshot:\n"+this.htmlSnapshot;
A+="\n\n";
return A
}});
CQ.form.rte.TableMatrix=CQ.Ext.extend(CQ.Ext.emptyFn,{matrix:null,rows:null,fullMatrix:null,tableDom:null,getPreviousRowCellDef:function(E,D){while(E>0){E--;
var C=this.matrix[E][D];
if(C!=null){return{row:E,col:D,cell:C}
}var B=D-1;
while(B>=0){var A=this.matrix[E][B];
if(A){if((B+A.colSpan)>D){return{row:E,col:B,cell:A}
}break
}B--
}}return null
},createTableMatrix:function(F){var C=CQ.form.rte.Common;
this.tableDom=F;
this.matrix=[];
this.fullMatrix=null;
this.rows=C.getChildNodesByType(F,"tr",true,"table");
for(var A=0;
A<this.rows.length;
A++){var D=[];
this.matrix.push(D);
var M=C.getChildNodesByType(this.rows[A],["th","td"],false);
var L=0;
for(var J=0;
J<M.length;
J++){var K=M[J];
var H=(K.colSpan?K.colSpan:1);
var I=(K.rowSpan?K.rowSpan:1);
while(true){var G=this.getPreviousRowCellDef(A,L);
if(G){var B=G.row;
var E=G.cell.rowSpan;
if((B+E)<=A){D[L]={col:L,row:A,colSpan:H,rowSpan:I,cellDom:K};
L+=H;
break
}}else{D[L]={col:L,row:A,colSpan:H,rowSpan:I,cellDom:K};
L+=H;
break
}L++
}}}},createFullMatrix:function(){if(this.matrix==null){throw new Error("No basic matrix calculated; use createTableMatrix() before.")
}this.fullMatrix=[];
for(var C=0;
C<this.matrix.length;
C++){for(var B=0;
B<this.matrix[C].length;
B++){if(this.matrix[C][B]!=null){var A=this.matrix[C][B];
for(var F=0;
F<A.colSpan;
F++){for(var D=0;
D<A.rowSpan;
D++){var E;
if(this.fullMatrix[D+C]){E=this.fullMatrix[D+C]
}else{E=[];
this.fullMatrix[D+C]=E
}E[F+B]={isOrigin:(F==0)&&(D==0),cellRef:A}
}}}}}},getTableSize:function(){if(this.matrix==null){throw new Error("No basic matrix calculated; use createTableMatrix() before.")
}var A=this.rows.length;
var B=0;
for(var C=0;
C<this.matrix[0].length;
C++){if(this.matrix[0][C]){B+=this.matrix[0][C].colSpan
}}return{cols:B,rows:A}
},getCellForCoords:function(B,C){if(this.fullMatrix==null){this.createFullMatrix()
}if(C>=this.fullMatrix.length){return null
}var A=this.fullMatrix[C];
if(B>=A.length){return null
}return A[B].cellRef
},getCellDef:function(B){if(this.matrix==null){throw new Error("No basic matrix calculated; use createTableMatrix() before.")
}for(var C=0;
C<this.matrix.length;
C++){for(var D=0;
D<this.matrix[C].length;
D++){var A=this.matrix[C][D];
if(A&&(A.cellDom==B)){return A
}}}return null
},getCellInfo:function(B){if(this.matrix==null){throw new Error("No basic matrix calculated; use createTableMatrix() before.")
}for(var C=0;
C<this.matrix.length;
C++){for(var F=0;
F<this.matrix[C].length;
F++){var A=this.matrix[C][F];
if(A&&(A.cellDom==B)){var E=C+A.rowSpan;
var D=F+A.colSpan;
return{isFirstCol:(F==0),isFirstRow:(C==0),isLastCol:(D>=this.matrix[C].length),isLastRow:(E>=this.matrix.length),cellDef:A}
}}}return null
},createSelection:function(D){if(!CQ.Ext.isArray(D)){D=[D]
}var C=new CQ.form.rte.CellSelection(this);
for(var B=0;
B<D.length;
B++){var A=this.getCellDef(D[B]);
if(!A){throw new Error("Invalid cell")
}C.addCell(A)
}C.process();
return C
},getRowDom:function(A){return this.rows[A]
},getColumn:function(C){var B=CQ.form.rte.Common;
if(this.fullMatrix==null){this.createFullMatrix()
}var D=[];
for(var E=0;
E<this.fullMatrix.length;
E++){var F=this.fullMatrix[E];
if(F){var A=F[C];
if(A&&!B.arrayContains(D,A.cellRef)){D.push(A.cellRef)
}}}return D
},getRow:function(F){var B=CQ.form.rte.Common;
if(this.fullMatrix==null){this.createFullMatrix()
}var E=[];
var C=this.fullMatrix[F];
if(C){for(var D=0;
D<C.length;
D++){var A=C[D];
if(A&&!B.arrayContains(E,A.cellRef)){E.push(A.cellRef)
}}}return E
},getRowCellForCoords:function(A,D){if(this.matrix==null){throw new Error("No basic matrix calculated; use createTableMatrix() before.")
}var B=this.matrix[D];
if(!B){return null
}for(var C=A;
C<B.length;
C++){if(B[C]!=null){return B[C]
}}return null
},getFollowUpCell:function(B,E){if(this.fullMatrix==null){this.createFullMatrix()
}var C=this.fullMatrix[E];
if(!C){return null
}var A=C[B];
if(!A){return null
}A=A.cellRef;
for(var D=B+1;
D<C.length;
D++){if(C[D]&&(C[D].cellRef!=A)){return C[D].cellRef
}}return null
},extendBy:function(D,K,P){var M=CQ.form.rte.TableMatrix;
var B,F,G,E,J,A;
var O=this.getTableSize();
var L=this.rows[this.rows.length-1].parentNode;
for(A=0;
A<P;
A++){var C=D.createElement("tr");
var N=this.rows.length;
this.rows.push(C);
L.appendChild(C);
G=[];
this.matrix.push(G);
E=null;
if(this.fullMatrix){E=[];
this.fullMatrix.push(E)
}for(J=0;
J<O.cols;
J++){B=M.createEmptyCell(D);
C.appendChild(B);
F={col:J,row:N,colSpan:1,rowSpan:1,cellDom:B};
G.push(F);
if(E){E.push({isOrigin:true,cellRef:F})
}}}var H=this.matrix.length;
for(A=0;
A<H;
A++){G=this.matrix[A];
E=(this.fullMatrix?this.fullMatrix[A]:null);
var I=this.rows[A];
for(J=0;
J<K;
J++){B=M.createEmptyCell(D,I.lastChild);
I.appendChild(B);
F={col:J+O.cols,row:N,colSpan:1,rowSpan:1,cellDom:B};
G[J+O.cols]=F;
if(E){E[J+O.cols]={isOrigin:true,cellRef:F}
}}}},mergeToSingleCell:function(D,j,A,Q,O){var E=CQ.form.rte.TableMatrix;
var F=CQ.form.rte.Common;
if(!this.fullMatrix){this.createFullMatrix()
}var Y=j+Q;
var R=A+O;
var Z=Y-1;
var S=R-1;
var N=this.matrix[A][j];
if(!N){throw new Error("Invalid table structure.")
}var X=this.fullMatrix[A][Z];
if(!X.isOrigin){var T=X.cellRef;
if((T.row<A)&&((T.col+T.colSpan)>Y)){throw new Error("Invalid table structure.")
}}var a=this.fullMatrix[S][j];
if(!a.isOrigin){var g=a.cellRef;
if((g.col<j)&&((g.row+g.rowSpan)>R)){throw new Error("Invalid table structure.")
}}var M=this.fullMatrix[S][Z];
if(!M.isOrigin){var b=M.cellRef;
if(((b.col+b.colSpan)>Y)&&(b.row+b.rowSpan>R)){throw new Error("Invalid table structure.")
}}for(var U=0;
U<O;
U++){var L=U+A;
var P=this.fullMatrix[L];
for(var d=0;
d<Q;
d++){var H=d+j;
var C=P[H];
var k=C.cellRef;
var G=k.cellDom;
var K=false;
if(!C.isOrigin){if((d==0)&&(k.col<H)){G.colSpan=k.col+k.colSpan-H
}if((U==0)&&(k.row<L)){G.rowSpan=k.row+k.rowSpan-L
}}else{K=(d!=0)||(U!=0);
if((k.col+k.colSpan)>Y){K=false;
G.colSpan=k.col+k.colSpan-Y;
F.removeAllChildren(G);
E.addCellPlaceholder(D,G)
}if((k.row+k.rowSpan)>R){K=false;
var I=k.row+k.rowSpan-R;
var B=k.rowSpan-I;
G.rowSpan=I;
G.parentNode.removeChild(G);
F.removeAllChildren(G);
E.addCellPlaceholder(D,G);
var W=this.getFollowUpCell(H,L+B);
var J=this.rows[L+B];
if(W){J.insertBefore(G,W.cellDom)
}else{J.appendChild(G)
}}}if(K){G.parentNode.removeChild(G)
}}}var V=N.cellDom;
V.colSpan=Q;
V.rowSpan=O;
return V
}});
CQ.form.rte.TableMatrix.createEmptyCell=function(C,A){var B="td";
if(typeof (A)=="string"){B=A
}else{if(A){B=A.tagName
}}var D=C.createElement(B);
var E=CQ.form.rte.DomProcessor.createEmptyLinePlaceholder(C,false);
if(E){D.appendChild(E)
}return D
};
CQ.form.rte.TableMatrix.addCellPlaceholder=function(B,A){A.appendChild(B.createTextNode(CQ.form.rte.DomProcessor.NBSP))
};
CQ.form.rte.TableMatrix.createEmptyCellMarkup=function(){if(CQ.Ext.isIE){return"<td></td>"
}return'<td><br _moz_dirty="" type="_moz"></td>'
};
CQ.form.rte.ListUtils=function(){var A=CQ.form.rte.Common;
var B=CQ.form.rte.DomProcessor;
return{postprocessSelectedItems:function(G){var K=G.length;
for(var E=K-1;
E>=0;
E--){var F=G[E];
if(!F.isAncestor){var C=true;
var D=F.childNodes;
if(D){var H=D.length;
for(var I=0;
I<H;
I++){var J=D[I].dom;
if(!A.isTag(J,A.LIST_TAGS)){C=false;
break
}}}if(C){G.splice(E,1)
}}}},createList:function(D,M,R){var C=CQ.form.rte.ListUtils;
if((M.length==1)&&A.isTag(M[0],A.TABLE_CELLS)){var K=D.createElement("div");
A.moveChildren(M[0],K);
M[0].appendChild(K);
M[0]=K
}var O=M.length;
for(var T=0;
T<O;
T++){if(A.isTag(M[T],"li")){var H=M[T].parentNode;
M[T]=H;
for(var I=0;
I<T;
I++){if(M[I]==H){M[T]=null;
break
}}}}var P=D.createElement(R);
O=M.length;
for(T=0;
T<O;
T++){var Q=M[T];
if(Q){var E=A.isTag(Q,B.AUXILIARY_ROOT_TAGS);
if(!E){if(P.childNodes.length==0){Q.parentNode.insertBefore(P,Q)
}if(!A.isTag(Q,A.LIST_TAGS)){var L=D.createElement("li");
P.appendChild(L);
A.moveChildren(Q,L,0,true);
Q.parentNode.removeChild(Q)
}else{A.moveChildren(Q,P,0,true);
Q.parentNode.removeChild(Q)
}}else{var F=[];
var J=Q.childNodes.length;
for(var S=0;
S<J;
S++){var U=Q.childNodes[S];
if(A.isTag(U,A.EDITBLOCK_TAGS)){F.push(U)
}else{if(A.isTag(A.BLOCK_TAGS)){}}}if(F.length==0){F.push(Q)
}C.createList(D,F,R);
P=D.createElement(R)
}}}var G=P.previousSibling;
if(G&&A.isTag(G,R)){A.moveChildren(P,G,0,true);
P.parentNode.removeChild(P);
P=G
}var N=P.nextSibling;
if(N&&A.isTag(N,R)){A.moveChildren(N,P,0,true);
N.parentNode.removeChild(N)
}},convertListItem:function(E,I,F,D){var C=A.getChildIndex(I);
var J=I.parentNode;
var H=J.childNodes.length;
var K=B.createNode(E,F,D);
A.moveChildren(I,K);
J.removeChild(I);
if(C==0){J.parentNode.insertBefore(K,J)
}else{if(C==(H-1)){J.parentNode.insertBefore(K,J.nextSibling)
}else{var G=J.cloneNode(false);
A.moveChildren(J,G,C);
J.parentNode.insertBefore(G,J.nextSibling);
J.parentNode.insertBefore(K,G)
}}return K
},getItemForDom:function(C,D){while(D){if(A.isTag(D,"li")){return D
}D=A.getParentNode(C,D)
}return null
},getListForItem:function(E,D){D=CQ.form.rte.ListUtils.getItemForDom(E,D);
var C=(D?A.getParentNode(E,D):null);
if(C&&!A.isTag(C,A.LIST_TAGS)){C=null
}return C
},getTopListForItem:function(D,E){var C=null;
while(E){if(A.isTag(E,A.LIST_TAGS)){C=E
}E=A.getParentNode(D,E)
}return C
},getNestingLevel:function(D,E){var C=-1;
while(E){if(A.isTag(E,A.LIST_TAGS)){C++
}E=A.getParentNode(D,E)
}return C
},isTopLevelList:function(C,D){return(CQ.form.rte.ListUtils.getNestingLevel(C,D)==0)
},isFirstListItem:function(E,G){var D=CQ.form.rte.ListUtils;
var F=D.getTopListForItem(E,G);
if(F==null){return false
}var C=D.getItemForDom(E,G);
return(F.childNodes.length>0)&&(F.childNodes[0]==C)
},isLastListItem:function(E,H){var D=CQ.form.rte.ListUtils;
var F=D.getTopListForItem(E,H);
var G=A.getLastChild(F);
if(G==null){return false
}var C=A.getTagInPath(E,G,"li");
return(C==H)
},moveItemContent:function(E,D){while(E.childNodes.length>0){var C=E.childNodes[0];
E.removeChild(C);
D.appendChild(C)
}},hasItemContent:function(D){var E=D.childNodes.length;
for(var F=0;
F<E;
F++){var C=D.childNodes[F];
if(!A.isTag(C,A.LIST_TAGS)){return true
}}return false
},isListEmpty:function(D,C){if(C.childNodes.length==0){return true
}var G=C.childNodes.length;
for(var F=0;
F<G;
F++){var J=C.childNodes[F];
if(A.isTag(J,"li")){var H=J.childNodes.length;
for(var I=0;
I<H;
I++){var E=J.childNodes[I];
if(A.isTag(E,A.LIST_TAGS)){var K=CQ.form.rte.ListUtils.isListEmpty(D,E);
if(!K){return false
}}else{return false
}}}}return true
},isItemEmpty:function(E,G){var D=CQ.form.rte.ListUtils;
G=D.getItemForDom(E,G);
var F=G.childNodes.length;
for(var H=0;
H<F;
H++){var C=G.childNodes[H];
if(A.isTag(C,A.LIST_TAGS)){if(!D.isListEmpty(E,C)){return false
}}else{return false
}}return true
},cleanUpList:function(D,C){var J=CQ.form.rte.ListUtils;
var F=C.childNodes.length;
for(var E=F-1;
E>=0;
E--){var K=C.childNodes[E];
var H=K.childNodes.length;
for(var I=H-1;
I>=0;
I--){var G=K.childNodes[I];
if(A.isTag(G,A.LIST_TAGS)){J.cleanUpList(D,G)
}}if(J.isItemEmpty(D,K)){C.removeChild(K)
}}if(J.isListEmpty(D,C)){C.parentNode.removeChild(C)
}},isSameType:function(D,C){if(D&&C){if(A.isTag(D,A.LIST_TAGS)){return(D.tagName.toLowerCase()==C.tagName.toLowerCase())
}}return false
},getNestedLists:function(D){var C=[];
var F=D.childNodes.length;
for(var G=0;
G<F;
G++){var E=D.childNodes[G];
if(A.isTag(E,A.LIST_TAGS)){C.push(E)
}}return C
},unlistItems:function(AH,S,g){var E=CQ.form.rte.ListUtils;
var R=S.length;
if(R==0){return 
}var C=S[0];
var r=S[R-1];
var J=E.getTopListForItem(AH,C.parentNode);
var F=E.isFirstListItem(AH,C);
var L=E.isLastListItem(AH,r);
var y=null;
var n=J;
for(var AC=0;
AC<R;
AC++){var W=AH.createElement("p");
var b=S[AC];
var z=b.childNodes.length;
for(var AE=z-1;
AE>=0;
AE--){var T=b.childNodes[AE];
if(!A.isTag(T,A.LIST_TAGS)){b.removeChild(T);
A.insertBefore(W,T,W.firstChild)
}}if(F){A.insertBefore(J.parentNode,W,J);
y=J
}else{A.insertBefore(J.parentNode,W,n.nextSibling);
n=W
}}var q=r.parentNode;
var x=A.getChildIndex(q);
var w=[];
if(E.getNestingLevel(AH,q)>0){var K=q.parentNode;
for(var AA=x+1;
AA<K.childNodes.length;
AA++){w.push(K.childNodes[AA])
}}if(!L&&!F){var t=null;
var Y=false;
while(q){var a=q.cloneNode(false);
var o=AH.createElement("li");
if(t==null){t=o;
if(r.childNodes.length==0){Y=true
}else{E.moveItemContent(r,t)
}}a.appendChild(o);
if(y){o.appendChild(y)
}y=a;
q=A.getParentNode(AH,q);
if(A.isTag(q,"li")){q=q.parentNode
}else{q=null
}}var AD=t.parentNode;
for(AA=0;
AA<w.length;
AA++){var u=w[AA];
u.parentNode.removeChild(u);
A.insertBefore(AD.parentNode,u,AD.nextSibling);
AD=u
}A.insertBefore(W.parentNode,y,W.nextSibling);
var G=r;
var H=t;
while(G){var P=A.getChildIndex(G);
var AI=G.parentNode;
var AG=H.parentNode;
for(AE=AI.childNodes.length-1;
AE>P;
AE--){var X=AI.childNodes[AE];
AI.removeChild(X);
n=(AG.childNodes.length>1?AG.childNodes[1]:null);
A.insertBefore(AG,X,n)
}if((H==t)&&Y){AG.removeChild(H)
}G=A.getParentNode(AH,AI);
if(!A.isTag(G,"li")){G=null
}H=A.getParentNode(AH,AG)
}}E.cleanUpList(AH,J);
if((y!=null)&&(y!=J)){E.cleanUpList(AH,y)
}if(!L&&(y!=null)){var I=A.getFirstChild(y);
I=A.getTagInPath(AH,I,"li");
if(I){if(E.isTopLevelList(AH,I)&&E.isItemEmpty(AH,I)){I.parentNode.removeChild(I)
}else{if(g){while(I){if(!E.hasItemContent(I)){A.insertBefore(I,AH.createTextNode(B.NBSP),I.firstChild)
}I=A.getParentNode(AH,I);
while(I&&!A.isTag(I,"li")){I=A.getParentNode(AH,I)
}}}else{var Q=[y];
n=y;
var AF=E.getListForItem(AH,I);
var O=E.getItemForDom(AH,AF);
if(O==null){return 
}var k,AB,M,j;
var U=E.getNestedLists(O);
while(n){var v=U.length;
var V=U[0];
var N=E.getNestingLevel(AH,V);
if(N==0){break
}var Z=E.getNestingLevel(AH,n);
var D=E.getListForItem(AH,V);
if(N==Z){M=(A.isTag(n,"li")?n.parentNode:n);
for(AB=0;
AB<v;
AB++){k=U[AB];
j=false;
if(AB==(v-1)){if(E.isSameType(k,M)){j=true
}}if(j){A.moveChildren(k,M,0,true)
}else{k.parentNode.removeChild(k);
A.insertBefore(M.parentNode,k,M.nextSibling);
M=k
}}break
}else{var d=U[v-1];
r=d.childNodes[d.childNodes.length-1];
if(A.isTag(n,"li")){for(AB=0;
AB<v;
AB++){k=U[AB];
k.parentNode.removeChild(k);
n.appendChild(k)
}}else{M=n;
for(AB=0;
AB<v;
AB++){k=U[AB];
j=false;
if(AB==(v-1)){if(E.isSameType(k,M)){j=true
}}if(j){A.moveChildren(k,M)
}else{k.parentNode.removeChild(k);
A.insertBefore(M.parentNode,k,M);
Q.push(k)
}}}n=r
}if(E.getNestingLevel(AH,D)==0){U=[D]
}else{U=E.getNestedLists(E.getItemForDom(AH,D))
}}for(AB=0;
AB<Q.length;
AB++){E.cleanUpList(AH,Q[AB])
}}}}}}}
}();
CQ.form.rte.ListRepresentation=CQ.Ext.extend(CQ.Ext.emptyFn,{parentList:null,listDom:null,items:null,isCorrectHierarchy:false,constructor:function(A,B){this.parentList=A;
this.items=[];
this.isCorrectHierarchy=B!==false
},fromList:function(B){var D=CQ.form.rte.Common;
this.items.length=0;
this.listDom=B;
var C=B.childNodes;
var F=C.length;
var A=null;
for(var G=0;
G<F;
G++){var E=C[G];
if(D.isTag(E,D.LIST_TAGS)){if(A==null){A=new CQ.form.rte.ListRepresentation.Item(this,this.listDom);
this.items.push(A)
}var H=new CQ.form.rte.ListRepresentation(this,false);
H.fromList(E);
A.addSubList(H)
}else{if(D.isTag(E,"li")){var I=new CQ.form.rte.ListRepresentation.Item(this,E);
this.items.push(I);
I.detectSubLists();
A=I
}}}},fromItem:function(C,B){var A=CQ.form.rte.ListUtils.getTopListForItem(C,B);
if(A==null){throw new Error("Could not detect list node.")
}this.fromList(A)
},getItemByDom:function(B){var D=this.items.length;
for(var A=0;
A<D;
A++){var C=this.items[A].getItemByDom(B);
if(C!=null){return C
}}return null
},getItemIndex:function(A){return CQ.form.rte.Common.arrayIndex(this.items,A)
},removeItem:function(C){var A=CQ.form.rte.Common;
var B=A.arrayIndex(this.items,C);
if(B>=0){this.items.splice(B,1)
}},insertItemAfter:function(B,A){if(A==null){this.items.splice(0,0,B);
return 
}var C=this.getItemIndex(A);
if(C<0){throw new Error("Invalid insert item; reference must be in 'this' list.")
}this.items.splice(C+1,0,B)
},removeSubList:function(B){var G=this.items.length;
var D=false;
for(var E=0;
(E<G)&&!D;
E++){var A=this.items[E].subLists;
var F=A.length;
for(var C=0;
C<F;
C++){if(A[C]==B){A.splice(C,1);
D=true;
break
}else{D=A[C].removeSubList(B);
if(D){break
}}}}return D
},indent:function(B,A){var C=this.getItemByDom(A);
if(C==null){throw new Error("Could not determine item to indent.")
}C.indent(B)
},outdent:function(B,I){var C=CQ.form.rte.Common;
var F=I.length;
for(var E=0;
E<F;
E++){var J=this.getItemByDom(I[E]);
if(J==null){throw new Error("Could not determine item to outdent.")
}var D=J.outdent(B);
for(var G=0;
G<D.length;
G++){var H=D[G].itemDom;
var A=C.arrayIndex(I,H);
if(A>E){I.splice(A,1);
F--
}}}},ensureHierarchy:function(B){var D=this.items.length;
for(var A=0;
A<D;
A++){var C=this.items[A];
C.ensureHierarchy(B)
}},flatten:function(B,C){if(C==null){C=CQ.form.rte.ListUtils.getTopListForItem(B,this.listDom)
}var E=this.items.length;
for(var A=0;
A<E;
A++){var D=this.items[A];
D.flatten(B,C)
}this.listDom.parentNode.removeChild(this.listDom)
},createDump:function(A){if(A==null){A=0
}var C;
var B="";
for(C=0;
C<A;
C++){B+="   "
}var D=B+"List, type "+this.listDom.tagName+"; "+(this.isCorrectHierarchy?"correct hierarchy":"invalid hierarchy")+"\n";
D+=B+" parent: "+(this.parentList?"yes":"no")+"\n";
for(C=0;
C<this.items.length;
C++){D+=B+" Item #"+(C+1)+":\n";
D+=this.items[C].createDump(A+1)
}return D
}});
CQ.form.rte.ListRepresentation.Item=CQ.Ext.extend(CQ.Ext.emptyFn,{list:null,itemDom:null,subLists:null,constructor:function(B,A){this.list=B;
this.itemDom=A;
this.subLists=[]
},addSubList:function(A){this.subLists.push(A)
},detectSubLists:function(E){var B=CQ.form.rte.Common;
if(!E){E=this.itemDom
}if(B.isTag(E,B.LIST_TAGS)){var A=new CQ.form.rte.ListRepresentation(this.list,true);
A.fromList(E);
this.subLists.push(A)
}else{if(E.nodeType==1){var C=E.childNodes.length;
for(var D=0;
D<C;
D++){this.detectSubLists(E.childNodes[D])
}}}},getItemByDom:function(D){if(this.itemDom==D){return this
}var B=this.subLists.length;
for(var A=0;
A<B;
A++){var C=this.subLists[A].getItemByDom(D);
if(C!=null){return C
}}return null
},getPreviousItem:function(){var A=this.list.items;
var D=A.length;
for(var B=0;
B<D;
B++){var C=A[B];
if(C==this){if(B>0){return A[B-1]
}return null
}}return null
},flattenChildNodes:function(){var A=this.subLists.length;
var H=this.itemDom.parentNode;
var F=this.itemDom.nextSibling;
for(var B=0;
B<A;
B++){var G=this.subLists[B];
var E=G.items;
for(var D=0;
D<E.length;
D++){var I=E[D];
this.list.insertItemAfter(I,this);
I.list=this.list;
var C=I.itemDom.parentNode;
C.removeChild(I.itemDom);
if(C.childNodes.length==0){C.parentNode.removeChild(C)
}if(F){H.insertBefore(I.itemDom,F)
}else{H.appendChild(I.itemDom)
}}}this.subLists.length=0
},indent:function(D){var B=this.getPreviousItem();
if(B==null){return 
}var C=B.subLists.length;
var F=this.list.getItemIndex(this);
this.list.items.splice(F,1);
if(C>0){var A=B.subLists[C-1];
this.itemDom.parentNode.removeChild(this.itemDom);
A.listDom.appendChild(this.itemDom);
A.items.push(this);
this.list=A;
this.flattenChildNodes();
return 
}var E=D.createElement(this.list.listDom.tagName);
B.itemDom.appendChild(E);
this.itemDom.parentNode.removeChild(this.itemDom);
E.appendChild(this.itemDom);
var G=new CQ.form.rte.ListRepresentation(B.list,true);
B.addSubList(G);
G.listDom=E;
G.items.push(this);
this.list=G;
this.flattenChildNodes()
},outdent:function(H){var M=CQ.form.rte.Common;
var G=CQ.form.rte.ListUtils;
var F,T,P,Y,W;
var Q=[];
var d=M.getListLevel(H,this.itemDom);
if(d==1){F=this.subLists.length;
if(F>0){var U=this.itemDom.nextSibling;
var N;
var E;
if(U){N=U.parentNode;
E=U
}else{W=this.list.listDom;
N=H.createElement(W.tagName);
M.insertBefore(W.parentNode,N,W.nextSibling);
E=null
}for(T=0;
T<F;
T++){var I=this.subLists[T].items;
P=I.length;
if(P>0){Y=I[0].itemDom;
Q.push(I[0]);
M.insertBefore(N,Y,E);
var C=I[0].list.listDom;
if(P==1){C.parentNode.removeChild(C)
}else{Y.appendChild(C)
}}}}var L=G.convertListItem(H,this.itemDom,"p");
W=this.list.listDom;
if(W.childNodes.length==0){W.parentNode.removeChild(W)
}if(L.nextSibling&&M.isTag(L.nextSibling,M.LIST_TAGS)){this.list.fromList(L.nextSibling)
}}else{W=this.list.listDom;
var K=W.parentNode;
var R=this.list.parentList.getItemByDom(K);
var a=R.list.getItemIndex(R)+1;
var J=K.nextSibling;
var B=K.parentNode;
this.itemDom.parentNode.removeChild(this.itemDom);
if(J){B.insertBefore(this.itemDom,J)
}else{B.appendChild(this.itemDom)
}var b=this.list.getItemIndex(this);
var O=[];
for(var V=b+1;
V<this.list.items.length;
V++){O.push(this.list.items[V])
}this.list.removeItem(this);
if(this.list.items.length==0){W.parentNode.removeChild(W);
this.list.parentList.removeSubList(this.list)
}this.list=this.list.parentList;
if(a<this.list.items.length){this.list.items.splice(a,0,this)
}else{this.list.items.push(this)
}F=this.subLists.length;
if(F>0){for(T=0;
T<F;
T++){var S=this.subLists[T];
P=S.items.length;
if(P>0){Q.push(S.items[0])
}if(P>1){var D=[];
for(var Z=1;
Z<P;
Z++){D.push(S.items[Z])
}for(Z=0;
Z<(P-1);
Z++){D[Z].indent(H)
}}}}if(O.length>0){var c=null;
var X=null;
if(this.subLists.length==0){c=H.createElement(this.list.listDom.tagName);
this.itemDom.appendChild(c);
X=new CQ.form.rte.ListRepresentation(this.list,true);
X.listDom=c;
this.subLists.push(X)
}else{X=this.subLists[this.subLists.length-1];
c=X.listDom
}for(V=0;
V<O.length;
V++){Y=O[V];
var A=Y.itemDom;
B=A.parentNode;
B.removeChild(A);
Y.list.removeItem(Y);
if(B.childNodes.length==0){B.parentNode.removeChild(B);
Y.list.parentList.removeSubList(Y.list)
}Y.list=X;
c.appendChild(A);
X.items.push(Y)
}}}return Q
},ensureHierarchy:function(D){var B=CQ.form.rte.Common;
var G=CQ.form.rte.DomProcessor;
var F=this.subLists.length;
for(var A=0;
A<F;
A++){var H=this.subLists[A];
if(!H.isCorrectHierarchy){var E=this.itemDom;
if(B.isTag(E,B.LIST_TAGS)){E=D.createElement("li");
E.appendChild(D.createTextNode(G.NBSP));
this.itemDom.appendChild(E);
this.itemDom=E
}var C=H.listDom;
C.parentNode.removeChild(C);
E.appendChild(C);
H.isCorrectHierarchy=true
}H.ensureHierarchy(D)
}},flatten:function(B,A){var C=CQ.form.rte.Common;
var F=B.createElement("p");
A.parentNode.insertBefore(F,A);
var E=this.itemDom.childNodes.length;
for(var G=E-1;
G>=0;
G--){var H=this.itemDom.childNodes[G];
if(!C.isTag(H,["ol","ul"])){H.parentNode.removeChild(H);
F.insertBefore(H,F.firstChild)
}}var I=this.subLists.length;
for(var D=0;
D<I;
D++){this.subLists[D].flatten(B,A)
}this.subLists.length=0;
this.itemDom.parentNode.removeChild(this.itemDom)
},flattenToParent:function(D){var F=CQ.form.rte.Common;
var B=this.list.listDom;
var C=CQ.form.rte.DomProcessor.getAuxRootNode(D,B);
if(C==B.parentNode){this.outdent(D);
return 
}this.flattenChildNodes();
var H;
var G=null;
var A=null;
if(this.itemDom.previousSibling){G=this.itemDom.previousSibling;
while(true){H=G.childNodes.length;
if(H==0){break
}if(!F.isTag(G.childNodes[H-1],F.LIST_TAGS)){break
}G=G.childNodes[H-1].lastChild
}}else{G=F.getParentNode(D,B);
A=B
}G.insertBefore(D.createElement("br"),A);
var E=this.itemDom.childNodes;
H=E.length;
for(var I=H-1;
I>=0;
I--){var J=E[I];
J.parentNode.removeChild(J);
G.insertBefore(J,A);
A=J
}B.removeChild(this.itemDom);
if(B.childNodes.length==0){this.list.parentList.removeSubList(this.list);
B.parentNode.removeChild(B)
}this.list.removeItem(this);
this.list=null
},createDump:function(A){var D=CQ.form.rte.Common;
if(A==null){A=0
}var E;
var C="";
for(E=0;
E<A;
E++){C+="   "
}var F=D.dumpNodeRecursively(this.itemDom,A);
for(var B=0;
B<this.subLists.length;
B++){F+=C+" Sub list #"+(B+1)+":\n";
F+=this.subLists[B].createDump(A+1)
}return F
}});
CQ.form.rte.CellSelection=CQ.Ext.extend(CQ.Ext.emptyFn,{tableMatrix:null,cells:null,selectionProps:null,constructor:function(A){this.cells=[];
this.tableMatrix=A
},addCell:function(A){this.cells.push(A)
},expand:function(O,N){if(this.selectionProps==null){this.process()
}if(this.selectionProps==null){return 
}if(this.tableMatrix.fullMatrix==null){this.tableMatrix.createFullMatrix()
}var L=CQ.form.rte.Common;
var Z=[];
var E=this.selectionProps.minCol;
var I=this.selectionProps.minRow;
var M=this.selectionProps.maxColExcl;
var P=this.selectionProps.maxRowExcl;
var S,Y,W,G,B;
if(O>0){for(S=0;
S<this.selectionProps.rows;
S++){for(G=0;
G<O;
G++){B=this.tableMatrix.fullMatrix[I+S][M+G];
if(B){B=B.cellRef;
if(!L.arrayContains(Z,B)){Z.push(B)
}}}}}if(N>0){for(Y=0;
Y<this.selectionProps.cols;
Y++){for(W=0;
W<N;
W++){B=this.tableMatrix.fullMatrix[P+W][E+Y];
if(B){B=B.cellRef;
if(!L.arrayContains(Z,B)){Z.push(B)
}}}}}var D=E;
var H=I;
var U=M+O;
var V=P+N;
var a=D;
var A=H;
var Q=U;
var R=V;
var X=false;
while(!X){var K=Z.length;
for(Y=0;
Y<K;
Y++){var C=Z[Y];
var F=C.col+C.colSpan;
var J=C.row+C.rowSpan;
if(C.col<a){a=C.col
}if(F>Q){Q=F
}if(C.row<A){A=C.row
}if(J>R){R=J
}}if((a!=D)||(A!=H)||(Q!=U)||(R!=V)){for(S=A;
S<R;
S++){for(Y=a;
Y<Q;
Y++){var T=this.tableMatrix.matrix[S][Y];
if(T){if(!L.arrayContains(T)){Z.push(T)
}}}}H=A;
D=a;
V=R;
U=Q
}else{X=true
}}for(Y=0;
Y<Z.length;
Y++){this.cells.push(Z[Y])
}this.process()
},process:function(){if(!this.cells||(this.cells.length==0)){return 
}var B={row:-1,col:-1};
var J={row:-1,col:-1};
var D=null;
var A=0;
for(var H=0;
H<this.cells.length;
H++){var F=this.cells[H];
if((F.col<B.col)||(B.col<0)){B.col=F.col
}if((F.row<B.row)||(B.row<0)){B.row=F.row
}var E=F.col+F.colSpan;
var G=F.row+F.rowSpan;
if(E>J.col){J.col=E
}if(G>J.row){J.row=G
}if((F.col==B.col)&&(F.row==B.row)){D=F
}A+=F.colSpan*F.rowSpan
}var I=J.col-B.col;
var K=J.row-B.row;
var C=I*K;
this.selectionProps={minRow:B.row,minCol:B.col,maxRowExcl:J.row,maxColExcl:J.col,cols:I,rows:K,isRect:(C==A),anchorCell:D}
}});
CQ.form.rte.SearchableDocument=CQ.Ext.extend(CQ.Ext.emptyFn,{plainText:null,plainTextLC:null,refs:null,findPos:0,currentSearch:0,config:null,createInternally:function(E){var A=CQ.form.rte.Common;
if(E.nodeType==3){var D=A.getNodeText(E);
if(D){this.refs.push({textPos:this.plainText.length,charCnt:D.length,nodeRef:E});
this.plainText+=D
}}else{if(E.nodeType==1){var F=(A.isTag(E,CQ.form.rte.SearchableDocument.WHITESPACE_TAGS)||A.isTag(E,A.EDITBLOCK_TAGS))&&(!A.strEndsWith(this.plainText," "));
if((this.plainText.length>0)&&F){this.refs.push({textPos:this.plainText.length,charCnt:1,nodeRef:E});
this.plainText+=" "
}var C=E.childNodes;
for(var B=0;
B<C.length;
B++){this.createInternally(C[B])
}}}},create:function(A){this.plainText="";
this.refs=[];
this.createInternally(A);
this.plainTextLC=this.plainText.toLowerCase()
},getRefForPosition:function(B){for(var C=0;
C<this.refs.length;
C++){var A=this.refs[C];
if((A.textPos>=B)&&((A.textPos+A.charCnt)<B)){return A
}}return null
},createMatch:function(D,B){var A=[];
var H=D+B-1;
var C=this.refs.length;
for(var E=0;
E<C;
E++){var F=this.refs[E];
var G=F.textPos+F.charCnt-1;
if(((F.textPos>=D)&&(F.textPos<=H))||((G>=D)&&(G<=H))||((F.textPos>=D)&&(G<=H))||((F.textPos<=D)&&(G>=H))){A.push({matchPos:D,matchChars:B,nodePos:F.textPos,nodeCharCnt:F.charCnt,node:F.nodeRef})
}else{if(A.length>0){return A
}}}return A
},getRefForNode:function(B){for(var A=0;
A<this.refs.length;
A++){if(this.refs[A].nodeRef==B){return this.refs[A]
}}return null
},find:function(B,A){this.config=A;
this.currentSearch=B;
this.findPos=A.startPos||0;
return this.findNext()
},findNext:function(){var A=(this.config.ignoreCase?this.plainTextLC:this.plainText);
var C=(this.config.ignoreCase?this.currentSearch.toLowerCase():this.currentSearch);
var B=A.indexOf(C,this.findPos);
if(B<0){this.findPos=0;
return null
}this.findPos=B+C.length;
return this.createMatch(B,C.length)
},adjustToReplace:function(A){this.findPos+=A.length-this.currentSearch.length
},createDump:function(){var A="Searchable text:\n"+this.plainText+"\n\n";
A+="References:\n"+CQ.form.rte.Common.dumpObject(this.refs);
return A
}});
CQ.form.rte.SearchableDocument.WHITESPACE_TAGS=["br","img"];
CQ.form.rte.Compatibility=function(){var A=CQ.form.rte.Common;
return{moveDeprecatedPluginConfig:function(C){var B=CQ.form.rte.Compatibility;
B.correctConfigOption(C,"defaultPasteMode","rtePlugins.edit.defaultPasteMode");
B.correctConfigOption(C,"stripHtmlTags","rtePlugins.edit.stripHtmlTags");
B.correctConfigOption(C,"tabSize","rtePlugins.keys.tabSize");
B.correctConfigOption(C,"trimLinkSelection","rtePlugins.links.trimLinkSelection");
B.correctConfigOption(C,"anchordialogConfig","rtePlugins.links.anchorDialogConfig");
B.correctConfigOption(C,"indentSize","rtePlugins.lists.indentSize");
B.correctConfigOption(C,"specialCharsConfig","rtePlugins.misctools.specialCharsConfig");
B.correctConfigOption(C,"formats","rtePlugins.paraformat.formats");
B.correctConfigOption(C,"cssStyles","rtePlugins.styles.styles");
B.correctConfigOption(C,"editMode","rtePlugins.table.editMode");
B.correctConfigOption(C,"rtePlugins.table.tablePropConfig.tableStyles","rtePlugins.table.tableStyles");
var E=B.getConfigValue(C,"rtePlugins.table.tableStyles");
if(E){E=B.convertToArray(E,"cssName","text");
B.changeDeprecatedPropertyName(E,"className","cssName");
B.setConfigValue(C,"rtePlugins.table.tableStyles",E)
}B.correctConfigOption(C,"rtePlugins.table.tablePropConfig.defaultValues","rtePlugins.table.defaultValues");
B.correctConfigOption(C,"rtePlugins.table.cellPropConfig.cellStyles","rtePlugins.table.cellStyles");
var D=B.getConfigValue(C,"rtePlugins.table.cellStyles");
if(D){D=B.convertToArray(D,"cssName","text");
B.changeDeprecatedPropertyName(D,"className","cssName");
B.setConfigValue(C,"rtePlugins.table.cellStyles",D)
}},moveDeprecatedHtmlRules:function(D){var C=CQ.form.rte.Compatibility;
var B=C.createFilteredConfig(D,"linkbrowseConfig",["cssInternal","cssExternal","protocols","defaultProtocol","targetConfig"],true);
var F=B[0];
if(F!=null){C.setConfigValue(D,"htmlRules.links",new CQ.form.rte.HtmlRules.Links(F))
}var E=B[1];
if(E!=null){C.setConfigValue(D,"rtePlugins.links.linkDialogConfig",E)
}C.correctConfigOption(D,"removeSingleParagraphContainer","htmlRules.blockHandling.removeSingleParagraphContainer");
C.correctConfigOption(D,"singleParagraphContainerReplacement","htmlRules.blockHandling.singleParagraphContainerReplacement")
},createFilteredConfig:function(B,J,H,F){var I=CQ.form.rte.Compatibility;
var D=I.getConfigValue(B,J);
if(D==null){return[null,null]
}if(H==null){return[D,null]
}if(F){I.filterJcrLeftovers(D)
}var G={};
var C=null;
for(var E in D){if(A.arrayContains(H,E)){G[E]=D[E]
}else{if(C==null){C={}
}C[E]=D[E]
}}return[G,C]
},filterJcrLeftovers:function(B){if(B["jcr:primaryType"]){delete B["jcr:primaryType"]
}if(B.xtype&&(B.xtype=="nt:unstructured")){delete B.xtype
}},correctConfigOption:function(C,F,E){var B=CQ.form.rte.Compatibility;
var D=B.getConfigValue(C,F);
if(D!=null){B.setConfigValue(C,E,D);
B.removeConfigValue(C,F)
}},getConfigValue:function(B,F){var E=B;
var D=F.split(".");
for(var C=0;
C<D.length;
C++){E=E[D[C]];
if(E==null){return null
}}return E
},setConfigValue:function(B,I,D){var H=B;
var G=I.split(".");
var C=G.length;
if(C==0){return 
}for(var F=0;
F<(C-1);
F++){var E=H;
H=H[G[F]];
if(H==null){H={};
E[G[F]]=H
}}H[G[C-1]]=D
},removeConfigValue:function(B,G){var F=B;
var E=G.split(".");
var C=E.length;
if(C==0){return 
}for(var D=0;
D<(C-1);
D++){F=F[E[D]];
if(F==null){return 
}}delete F[E[C-1]]
},configurePlugins:function(E,B){var M=function(R,P){var N=false;
var Q=null;
if(R=="format"){N=E.enableFormat;
Q=E.formatButtons
}else{if(R=="alignments"){N=E.enableAlignments;
Q=E.alignmentButtons
}else{if(R=="lists"){N=E.enableLists;
Q=E.listButtons
}else{if(R=="links"){N=E.enableLinks;
Q=E.linkButtons
}else{if(R=="edit"){N=E.enableEditTools;
Q=E.editToolButtons
}}}}}var O=(N===undefined?undefined:false);
if(N){if(Q){O=!!Q[P]
}else{O=true
}}return O
};
var F=function(N,P){var O=N;
switch(N){case"format":break;
case"justify":O="alignments";
P=P.substring(7,P.length);
break;
case"lists":break;
case"subsuperscript":return E.enableSubSuperScript;
case"links":if(P=="modifylink"){P="createlink"
}break;
case"paraformat":return E.enableParagraphFormat;
case"styles":return E.enableStyle;
case"misctools":if(P=="sourceedit"){return E.enableSourceEdit
}if(P=="specialchars"){return E.enableSpecialChars
}break
}return M(O,P)
};
var J=E.rtePlugins;
for(var G in B.registeredPlugins){var H=B.registeredPlugins[G];
var D={};
var C=H.getFeatures();
var L=C.length;
for(var I=0;
I<L;
I++){var K=F(G,C[I]);
if(K!==undefined){if(!D.features){D.features=[]
}if(K){D.features.push(C[I])
}}}if(J&&J[G]){CQ.Ext.apply(D,J[G])
}H.notifyPluginConfig(D)
}},convertToArray:function(G,B,D){if(!G){return null
}A.removeJcrData(G);
if(CQ.Ext.isArray(G)){return G
}var H=[];
var E;
for(var C in G){if(G.hasOwnProperty(C)){var F=G[C];
if(typeof (F)=="object"){if(F[B]&&F[D]){H.push(F)
}else{E={};
E[B]=C;
E[D]=F;
H.push(E)
}}else{E={};
E[B]=C;
E[D]=F;
H.push(E)
}}}return H
},changeDeprecatedPropertyName:function(G,C,B){if(G==null){return 
}var F=G.length;
for(var D=0;
D<F;
D++){var E=G[D];
if(E.hasOwnProperty(C)){if(!E.hasOwnProperty(B)){E[B]=E[C];
delete E[C]
}}}}}
}();
CQ.form.rte.HtmlRules=CQ.Ext.extend(CQ.Ext.emptyFn,{links:null,serializer:null,docType:null,blockHandling:null,constructor:function(B){B=B||{};
var A=CQ.form.rte.HtmlRules;
this.links=new A.Links(B.links);
this.serializer=new A.Serializer(B.serializer);
this.docType=new A.DocType(B.docType);
this.blockHandling=new A.BlockHandling(B.blockHandling);
delete B.links;
delete B.serializer;
delete B.docType;
delete B.blockHandling;
CQ.Ext.apply(this,B)
}});
CQ.form.rte.HtmlRules.Links=CQ.Ext.extend(CQ.Ext.emptyFn,{cssMode:null,cssInternal:null,cssExternal:null,protocols:null,defaultProtocol:null,targetConfig:null,ensureInternalLinkExt:false,constructor:function(A){A=A||{};
var B={cssMode:"auto",protocols:["http://","https://","ftp://","mailto:"],targetConfig:{mode:"blank"},ensureInternalLinkExt:true};
CQ.Util.applyDefaults(A,B);
CQ.Ext.apply(this,A)
},getProtocol:function(A){if(this.protocols){var B=this.protocols.length;
for(var C=0;
C<B;
C++){var D=this.protocols[C];
if(CQ.form.rte.Common.strStartsWith(A,D)){return D
}}}return null
},hasProtocol:function(A){return CQ.form.rte.HtmlRules.Links.hasProtocol(A)
},isInternalLink:function(A){return CQ.form.rte.HtmlRules.Links.isInternalLink(A)
},validateHref:function(A){var B=this.getProtocol(A);
if(B){return true
}if(A.length>0){if(A.charAt(0)=="/"){return true
}if(A.charAt(0)=="#"){return true
}}if(this.hasProtocol(A)){return false
}return true
},applyToObject:function(H){var D=CQ.form.rte.Common;
var K=(H.nodeType&&(H.nodeType==1));
var C;
if(K){C=CQ.form.rte.HtmlRules.Links.getLinkHref(H)
}else{C=H.href
}var J=this.cssMode;
if(J=="auto"){if((this.cssInternal!=null)||(this.cssExternal!=null)){J="replace"
}else{J="keep"
}}if(J=="remove"){if(K){D.removeAttribute(H,"class")
}else{H.cssClass=null
}}else{if(J=="replace"){var M=null;
if(this.cssInternal&&this.isInternalLink(C)){M=this.cssInternal
}if(this.cssExternal&&!this.isInternalLink(C)){M=this.cssExternal
}if(K){if(M!=null){D.setAttribute(H,"class",M)
}else{D.removeAttribute(H,"class")
}}else{H.cssClass=M
}}}if(this.targetConfig){switch(this.targetConfig.mode){case"none":if(K){D.removeAttribute(H,"target")
}else{H.target=null
}break;
case"auto":var I=(this.isInternalLink(C)?this.targetConfig.targetInternal:this.targetConfig.targetExternal);
if(K){if(I!=null){D.setAttribute(H,"target",I)
}else{D.removeAttribute(H,"target")
}}else{H.target=I
}break
}}if(this.isInternalLink(C)){var B=C.indexOf("#");
if(B==0){return 
}if(this.ensureInternalLinkExt){var G="";
if(B>0){G=C.substring(B,C.length);
C=C.substring(0,B)
}var E=C.lastIndexOf(".");
var F=C.lastIndexOf("/");
var A=(F==(C.length-1));
if(((E<=0)||(E<F))&&!A){H.href=C+CQ.HTTP.EXTENSION_HTML+G
}}}else{if((this.getProtocol(C)==null)&&!this.hasProtocol(C)){var L=this.defaultProtocol||"http://";
H.href=L+C
}}}});
CQ.form.rte.HtmlRules.Links.hasProtocol=function(A){return/^[A-Za-z][A-Za-z\d+\-.]*:(\/\/)?([^\d]|[\d]+@|$)/.test(A)
};
CQ.form.rte.HtmlRules.Links.isInternalLink=function(A){return(A.charAt(0)=="/")||(A.charAt(0)=="#")
};
CQ.form.rte.HtmlRules.Links.getLinkHref=function(C){var B=CQ.form.rte.Common;
var A;
if(B.isAttribDefined(C,B.HREF_ATTRIB)){A=B.getAttribute(C,B.HREF_ATTRIB)
}else{A=B.getAttribute(C,"href");
if(A){A=CQ.form.rte.HtmlRules.Links.removePrefixForInternalLinks(A)
}}return A
};
CQ.form.rte.HtmlRules.Links.removePrefixForInternalLinks=function(C){var G=location.href;
var D=CQ.HTTP.getSchemeAndAuthority(G)+"/";
var B=D.length;
if(C.length>B){if(C.substring(0,B)==D){var E=false;
var A=false;
if(C.length>G.length){if(C.substring(0,G.length)==G){var F=C.charAt(G.length);
switch(F){case"?":A=true;
E=true;
break;
case"#":E=true;
break
}}}if(E&&!A){C=C.substring(G.length,C.length)
}else{C=C.substring(B-1,C.length)
}}}return C
};
CQ.form.rte.HtmlRules.Serializer=CQ.Ext.extend(CQ.Ext.emptyFn,{mode:null,config:null,serializer:null,deserializer:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{mode:"auto",config:null,serializer:null,deserializer:null});
CQ.Ext.apply(this,A)
},serialize:function(A,B,C){if(this.serializer==null){switch(this.mode){case"auto":if(C.baseType=="html"){this.serializer=new CQ.form.rte.HtmlSerializer(this.config)
}else{if(C.baseType=="xhtml"){this.serializer=new CQ.form.rte.XhtmlSerializer(this.config)
}}break;
case"customized":throw new Error("Using 'customized' serialization, but no custonized serializing object configured (use 'serializer' config option)");
break;
default:throw new Error("Invalid serialization mode: '"+this.mode+"'");
break
}}return this.serializer.serialize(A,B)
},deserialize:function(B,A,C,D){if(this.deserializer==null){switch(this.mode){case"auto":if(D.baseType=="html"){this.deserializer=new CQ.form.rte.HtmlDeserializer(this.config)
}else{if(D.baseType=="xhtml"){this.deserializer=new CQ.form.rte.XhtmlDeserializer(this.config)
}}break;
case"customized":throw new Error("Using 'customized' serialization, but no custonized deserializing object configured (use 'deserializer' config option)");
break;
default:throw new Error("Invalid serialization mode: '"+this.mode+"'");
break
}}return this.deserializer.deserialize(B,A,C)
}});
CQ.form.rte.HtmlRules.DocType=CQ.Ext.extend(CQ.Ext.emptyFn,{baseType:null,version:null,typeConfig:null,tagBlacklist:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{baseType:"html",version:"4.0",typeConfig:{useSemanticMarkup:false,semanticMarkupMap:{b:"strong",i:"em"}}});
CQ.Ext.apply(this,A);
if((this.baseType!="html")&&(this.baseType!="xhtml")){throw new Error("Invalid doctype; must be 'html' or 'xhtml'")
}this.tagBlackList=[];
if(this.baseType=="html"){if(this.version!="4.0"){throw new Error("Invalid version; must be '4.0' for doctype 'html'.")
}}if(this.baseType=="xhtml"){if(this.version!="1.0"){throw new Error("Invalid version; must be '1.0' for doctype 'xhtml'.")
}if(this.typeConfig.isXhtmlStrict){this.tagBlackList.push("u")
}}},isAllowed:function(A){return !CQ.form.rte.Common.arrayContains(this.tagBlackList,A.toLowerCase())
},convertToPhysicalStyle:function(C){var B=this.typeConfig.semanticMarkupMap;
if(!B){return null
}C=C.toLowerCase();
for(var A in B){if(B.hasOwnProperty(A)){if(B[A]==C){return A
}}}return null
},convertToSemanticMarkup:function(A){if(!this.typeConfig.semanticMarkupMap){return null
}A=A.toLowerCase();
if(this.typeConfig.semanticMarkupMap.hasOwnProperty(A)){return this.typeConfig.semanticMarkupMap[A]
}return null
},adjustToDocType:function(A){if(this.typeConfig.useSemanticMarkup){var B=this.convertToSemanticMarkup(A);
if(B!=null){return(this.isAllowed(B)?B:"")
}}if(!this.isAllowed(A)){return""
}return null
},adjustToRaw:function(A){return this.convertToPhysicalStyle(A)
}});
CQ.form.rte.HtmlRules.BlockHandling=CQ.Ext.extend(CQ.Ext.emptyFn,{defaultEditBlockType:null,removeSingleParagraphContainer:false,singleParagraphContainerReplacement:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{defaultEditBlockType:"p",removeSingleParagraphContainer:false,singleParagraphContainerReplacement:"div"});
CQ.Ext.apply(this,A)
}});
CQ.form.rte.Serializer=CQ.Ext.extend(CQ.Ext.emptyFn,{serialize:function(A,B){return""
}});
CQ.form.rte.HtmlSerializer=CQ.Ext.extend(CQ.form.rte.Serializer,{context:null,deepestChildAddHtml:null,nonClosingTags:null,tagCase:null,attribNameCase:null,styleAttribNameCase:null,idAttribMode:null,beautifier:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{nonClosingTags:CQ.form.rte.HtmlSerializer.NON_CLOSING_TAGS,tagCase:"lower",attribNameCase:"lower",styleAttribNameCase:"lower",idAttribMode:"remove",beautifier:CQ.form.rte.HtmlSerializer.defaultBeautifier});
CQ.Ext.apply(this,A)
},getAttribValue:function(B,A){return CQ.Ext.isIE?B.getAttribute(A,2):B.getAttribute(A)
},handleGeckoEmptyBlocks:function(D){var A=CQ.form.rte.Common;
if(CQ.Ext.isGecko&&A.isTag(D,"br")){var B=A.getTagInPath(this.context,D,A.EDITBLOCK_TAGS);
if(B){var C=A.getCharacterNodes(B);
if(C.length==1){return"&nbsp;"
}}}return null
},ignoreElement:function(D){var A=CQ.form.rte.Common;
var C=false;
if(D.nodeType==1){if(CQ.Ext.isGecko&&A.hasAttributes(D,{type:"_moz"})){var B=A.getTagInPath(this.context,D,A.EDITBLOCK_TAGS);
if(B&&(A.getCharacterNodes(B).length>1)){C=true
}}}return C
},ignoreAttribute:function(C){var A=CQ.form.rte.Common;
var B=C.nodeName.toLowerCase();
if((B=="id")&&(this.idAttribMode=="remove")){return true
}if(A.arrayContains(CQ.form.rte.HtmlSerializer.HELPER_ATTRIBUTES,B)){return true
}return false
},adjustCase:function(B,A){switch(A){case"upper":B=B.toUpperCase();
break;
case"lower":B=B.toLowerCase();
break
}return B
},createTagStr:function(A){return this.adjustCase(A.tagName,this.tagCase)
},serializeAttribute:function(B,E){B=this.adjustCase(B,this.attribNameCase);
if((B.toLowerCase()=="style")&&(this.styleAttribNameCase!="keep")){var D=CQ.form.rte.HtmlProcessor.parseStyleDef(E);
E="";
for(var C in D){if(D.hasOwnProperty(C)){if(E.length>0){E+=" "
}var A=D[C];
C=this.adjustCase(C,this.styleAttribNameCase);
E+=C+": "+A+";"
}}}if((E==null)||(E.length==0)){return""
}return B+'="'+CQ.Ext.util.Format.htmlEncode(E)+'"'
},serializeAttributes:function(F){var B=CQ.form.rte.Common;
var Q=(CQ.Ext.isGecko?B.FILTER_GECKO_TEMPORARY_ATTRIBS:null);
var A=B.getAttributeNames(F,true,Q);
var O=A.length;
var K="";
var D=true;
for(var P=0;
P<O;
P++){var G=F.attributes.getNamedItem(A[P]);
if(!this.ignoreAttribute(G)){var M=G.nodeName;
var L=M.toLowerCase();
var I=this.getAttribValue(F,M);
if(!I){if(L=="style"){I=F.style.cssText
}else{if(L=="class"){I=F.className
}}}var C=F.tagName.toLowerCase();
var J=CQ.form.rte.HtmlSerializer.HELPER_ATTRIB_MAPPINGS[C];
if(J){for(var E=0;
E<J.length;
E+=2){var H=J[E];
if(L==H){I=this.getAttribValue(F,J[E+1]);
break
}}}var N=this.serializeAttribute(M,I);
if(N.length>0){if(!D){K+=" "
}else{D=false
}K+=N
}}}return K
},serializeTextNode:function(B){var A=CQ.Ext.util.Format.htmlEncode(B.nodeValue);
return A.replace(/\u00A0/g,"&nbsp;")
},serializeNodeEnter:function(E){var A=CQ.form.rte.Common;
if(E.nodeType==3){return this.serializeTextNode(E)
}if(this.ignoreElement(E)){return""
}var C=this.handleGeckoEmptyBlocks(E);
if(C!=null){return C
}var B="<"+this.createTagStr(E);
var D=this.serializeAttributes(E);
if(D.length>0){B+=" "+D
}B+=">";
if(CQ.Ext.isIE&&A.isEmptyEditingBlock(E,true)){this.deepestChildAddHtml="&nbsp;"
}if(this.deepestChildAddHtml!=null){if(E.childNodes.length==0){B+=this.deepestChildAddHtml;
this.deepestChildAddHtml=null
}}return B
},serializeNodeLeave:function(B){if((B.nodeType==3)||this.ignoreElement(B)){return""
}var A="";
if(!CQ.form.rte.Common.isTag(B,this.nonClosingTags)){A="</"+this.createTagStr(B)+">"
}return A
},serializeSubTree:function(F){var D=this.beautifier(this.context,F,true);
var B="";
var A=this.serializeNodeEnter(F);
if(D){if(D.before){B=D.before
}B+=A;
if(D.after){B+=D.after
}}else{B=A
}var C=F.childNodes.length;
for(var G=0;
G<C;
G++){B+=this.serializeSubTree(F.childNodes[G])
}A=this.serializeNodeLeave(F);
var E=this.beautifier(this.context,F,false);
if(E){if(E.before){B+=E.before
}B+=A;
if(E.after){B+=E.after
}}else{B+=A
}return B
},serialize:function(B,D){this.context=B;
this.deepestChildAddHtml=null;
var A="";
var C=D.childNodes.length;
for(var E=0;
E<C;
E++){A+=this.serializeSubTree(D.childNodes[E])
}return A
}});
CQ.form.rte.HtmlSerializer.NON_CLOSING_TAGS=["br","hr","img","area","input","col"];
CQ.form.rte.HtmlSerializer.HELPER_ATTRIBUTES=[CQ.form.rte.Common.HREF_ATTRIB,CQ.form.rte.Common.SRC_ATTRIB];
CQ.form.rte.HtmlSerializer.HELPER_ATTRIB_MAPPINGS={a:["href",CQ.form.rte.Common.HREF_ATTRIB],img:["src",CQ.form.rte.Common.SRC_ATTRIB]};
CQ.form.rte.HtmlSerializer.defaultBeautifier=function(C,F,D){var A=CQ.form.rte.Common;
if(A.isTag(F,A.BLOCK_TAGS)){if(D){if(!A.isTag(F,A.EDITBLOCK_TAGS)){return{before:null,after:"\n"}
}}else{return{before:null,after:"\n"}
}return null
}if(A.isTag(F,A.EDITBLOCK_TAGS)){if(!D){return{before:null,after:"\n"}
}return null
}if(A.isTag(F,"br")){if(!D){if(CQ.Ext.isGecko){var B=A.getTagInPath(C,F,A.EDITBLOCK_TAGS);
if(B){var E=A.getCharacterNodes(B);
if(E.length==1){return null
}}}return{before:null,after:"\n"}
}}return null
};
CQ.form.rte.XhtmlSerializer=CQ.Ext.extend(CQ.form.rte.HtmlSerializer,{useShortTags:false,constructor:function(A){A=A||{};
delete A.tagCase;
delete A.attribNameCase;
delete A.nonClosingTags;
CQ.Util.applyDefaults(A,{tagCase:"lower",attribNameCase:"lower",useShortTags:false,nonClosingTags:[]});
CQ.form.rte.XhtmlSerializer.superclass.constructor.call(this,A)
},serializeNodeEnter:function(E){var A=CQ.form.rte.Common;
if(this.ignoreElement(E)){return""
}if(E.nodeType==1){var C=this.handleGeckoEmptyBlocks(E);
if(C!=null){return C
}if(this.useShortTags&&(E.childNodes.length==0)){if(!(CQ.Ext.isIE&&A.isTag(E,A.EDITBLOCK_TAGS))){var B="<"+this.createTagStr(E);
var D=this.serializeAttributes(E);
if(D.length>0){B+=" "+D
}if(this.deepestChildAddHtml!=null){B+=">"+this.deepestChildAddHtml;
B+="</"+this.createTagStr(E)+">"
}else{B+=" />"
}return B
}}}return CQ.form.rte.XhtmlSerializer.superclass.serializeNodeEnter.call(this,E)
},serializeNodeLeave:function(B){var A=CQ.form.rte.Common;
if(this.ignoreElement(B)){return""
}if(B.nodeType==1){if(this.handleGeckoEmptyBlocks(B)!=null){return""
}if(!(CQ.Ext.isIE&&A.isTag(B,A.EDITBLOCK_TAGS))){if(this.useShortTags&&(B.childNodes.length==0)){return""
}}}return CQ.form.rte.XhtmlSerializer.superclass.serializeNodeLeave.call(this,B)
}});
CQ.form.rte.Deserializer=CQ.Ext.extend(CQ.Ext.emptyFn,{deserialize:function(B,A,C){}});
CQ.form.rte.HtmlDeserializer=CQ.Ext.extend(CQ.form.rte.Deserializer,{duplicateReferences:function(B){var E=CQ.form.rte.HtmlDeserializer.DUPLICATE_RULES;
var A=E.length;
for(var C=0;
C<A;
C++){var D=E[C];
B=B.replace(D[0],D[1])
}return B
},deserialize:function(B,A,C){A=this.duplicateReferences(A);
C.innerHTML=A
}});
CQ.form.rte.HtmlDeserializer.DUPLICATE_RULES=[[/(<a[^>]*?href=")([^"]*?)(")(.*?>)/gi,"$1$2$3 "+CQ.form.rte.Common.HREF_ATTRIB+'="$2"$4'],[/(<img[^>]*?src=")([^"]*?)(")(.*?>)/gi,"$1$2$3 "+CQ.form.rte.Common.SRC_ATTRIB+'="$2"$4']];
CQ.form.rte.XhtmlDeserializer=CQ.Ext.extend(CQ.form.rte.HtmlDeserializer,{constructor:function(){CQ.form.rte.XhtmlDeserializer.superclass.constructor.apply(this,arguments);
var B=CQ.form.rte.HtmlSerializer.NON_CLOSING_TAGS;
var A="<\\/(";
for(var C=0;
C<B.length;
C++){if(C>0){A+="|"
}A+=B[C]
}A+=")>";
this.regExp=new RegExp(A,"gi")
},expandShortTags:function(C){var A=CQ.form.rte.XhtmlDeserializer;
var B=C.replace(A.EXPAND_SHORT_XHTML,A.XHTML_EXPANSION_REPLACEMENT);
return B.replace(this.regExp,"")
},deserialize:function(A,C,B){C=this.expandShortTags(C);
C=this.duplicateReferences(C);
B.innerHTML=C
}});
CQ.form.rte.XhtmlDeserializer.EXPAND_SHORT_XHTML=/<([^/][^\n\r\t >]*)([^>]*)(\/>)/gi;
CQ.form.rte.XhtmlDeserializer.XHTML_EXPANSION_REPLACEMENT="<$1$2></$1>";
CQ.form.rte.DomCleanup=CQ.Ext.extend(CQ.Ext.emptyFn,{tagsToRemove:null,pasteRules:null,editorKernel:null,context:null,htmlRules:null,processingMode:null,elementsToRemove:null,elementsToChange:null,constructor:function(A){CQ.Ext.apply(this,A)
},markForRemoval:function(A){if(!CQ.form.rte.Common.arrayContains(this.elementsToRemove,A)){this.elementsToRemove.push(A)
}},isPreProcessing:function(){var A=CQ.form.rte.DomCleanup;
return(this.processingMode==A.PASTE_PREPARE)||(this.processingMode==A.PRE)
},flattenNestedStructure:function(I,L,K){var E=CQ.form.rte.Common;
var B=null;
var D=I.parentNode;
var A=I.nextSibling;
var J=this.pasteRules.fallbackBlockTag||"p";
var O=E.getTags(I,L);
var N=O.length;
for(var F=0;
F<N;
F++){var G=O[F];
var H=this.context.createElement(J);
if(B==null){B=H
}E.insertBefore(D,H,A);
var C=G.childNodes;
while(C.length>0){var M=C[0];
if(!E.isTag(M,K)){H.appendChild(M)
}}}I.parentNode.removeChild(I);
return B
},isValidElement:function(D){var A=CQ.form.rte.Common;
var B=D.tagName.toLowerCase();
var C=A.getNamespace(D);
if(C!=null){return false
}if(this.tagsToRemove){if(A.arrayContains(this.tagsToRemove,B)){return false
}}if(A.isTag(D,"span")&&A.isAttribDefined(D,"_rtetemp")){return false
}return true
},applyHtmlRules:function(F){var D=CQ.form.rte.Common;
if(this.isPreProcessing()){var E=F.tagName.toLowerCase();
var B=(this.isPreProcessing()?this.htmlRules.docType.adjustToRaw(E):this.htmlRules.docType.adjustToDocType(E));
var A;
if(B!=null){A=this.context.createElement(B);
this.elementsToChange.push({domToChange:F,changedDom:A});
return false
}if(D.isTag(F,"a")){var C=D.getAttribute(F,"href");
if(C){if(this.htmlRules.links.validateHref(C)){this.htmlRules.links.applyToObject(F);
return false
}else{this.markForRemoval(F);
return true
}}}}return false
},handleAlignment:function(D){var B=CQ.form.rte.Common;
var C=["p","div"];
if(B.isTag(D,C)){if(this.isPreProcessing()){var A=B.getAttribute(D,"align",true);
if(A){B.removeAttribute(D,"align");
D.style.textAlign=A
}}}},handleAnchor:function(F){var C=CQ.form.rte.Common;
var D=CQ.form.rte.DomCleanup;
if(C.isTag(F,"a")){var I=C.getAttribute(F,"name",true);
var H=CQ.form.rte.HtmlRules.Links.getLinkHref(F);
if(I){if(this.isPreProcessing()){C.addClass(F,CQ.themes.RichText.ANCHOR_CLASS);
var B=F.childNodes;
var E=F.parentNode;
var A=F.nextSibling;
while(B.length>0){C.insertBefore(E,B[0],A)
}}else{if(this.processingMode==D.POST){C.removeClass(F,CQ.themes.RichText.ANCHOR_CLASS)
}}}if(H){if(this.processingMode==D.PASTE_PREPARE){var G=C.getAttribute(F,C.HREF_ATTRIB);
if(!G){C.setAttribute(F,C.HREF_ATTRIB,H)
}}}}},handleImage:function(D){var A=CQ.form.rte.Common;
var E=CQ.form.rte.DomCleanup;
if(this.processingMode==E.PASTE_PREPARE){if(A.isTag(D,"img")){var C=A.getAttribute(D,"src",true);
if(C){var B=A.getAttribute(D,CQ.form.rte.Common.SRC_ATTRIB);
if(!B){A.setAttribute(D,CQ.form.rte.Common.SRC_ATTRIB,C)
}}}}},handleTable:function(E){var A=CQ.form.rte.Common;
var F=CQ.form.rte.DomCleanup;
if(A.isTag(E,"table")){var D=A.getAttribute(E,"border",true);
var C=false;
if(D){try{C=(parseInt(D)>0)
}catch(B){}}if(!C){if(this.isPreProcessing()){A.addClass(E,CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}else{if(this.processingMode==F.POST){A.removeClass(E,CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}}}}},handleList:function(D){var A=CQ.form.rte.Common;
var C=CQ.form.rte.ListUtils;
if(A.isTag(D,A.LIST_TAGS)){if(C.isTopLevelList(this.context,D)){var B=new CQ.form.rte.ListRepresentation();
B.fromItem(this.context,D);
B.ensureHierarchy(this.context)
}}},handleSpanStyles:function(F){var B=CQ.form.rte.Common;
if(this.isPreProcessing()){if(B.isTag(F,"span")){var A,C;
if(F.style.fontWeight=="bold"){A=this.context.createElement("b");
C={domToChange:F,changedDom:A}
}if(F.style.fontStyle=="italic"){var D=this.context.createElement("i");
if(A){A.appendChild(D);
C.childDom=D
}else{A=D;
C={domToChange:F,changedDom:A}
}}if(F.style.textDecoration=="underline"){var E=this.context.createElement("u");
if(A){if(C.childDom){C.childDom.appendChild(E)
}else{A.appendChild(E)
}C.childDom=E
}else{A=E;
C={domToChange:F,changedDom:A}
}}if(C){this.elementsToChange.push(C)
}}}},handleSpecificTags:function(A){this.handleAlignment(A);
this.handleAnchor(A);
this.handleImage(A);
this.handleTable(A);
this.handleSpanStyles(A);
this.handleList(A)
},handleEmptyContent:function(D){var A=CQ.form.rte.Common;
var C=CQ.form.rte.DomProcessor;
var F=CQ.form.rte.DomCleanup;
if(this.processingMode==F.PRE){if(D.childNodes.length==0){var E=C.createEmptyLinePlaceholder(this.context,true,this.htmlRules.blockHandling.defaultEditBlockType);
D.appendChild(E)
}}else{if(this.processingMode==F.POST){if(D.childNodes.length==1){var B=D.childNodes[0];
if(A.isTag(B,A.EDITBLOCK_TAGS)){if(C.isEmptyLineBlock(B)){D.removeChild(B)
}}}}}},handleContainerRules:function(F){var A=CQ.form.rte.Common;
var I=CQ.form.rte.DomProcessor;
var B=CQ.form.rte.DomCleanup;
var E=this.htmlRules.blockHandling;
var H=E.defaultEditBlockType;
var C=E.singleParagraphContainerReplacement;
if(this.processingMode==B.PRE){I.ensureBlockContent(this.context,H,null,false,false);
I.adjustTables(this.context);
I.browserizePlaceholders(this.context,this.context.root)
}else{if(this.processingMode==B.POST){if(E.removeSingleParagraphContainer){var D=F.childNodes.length;
if(D==1){var J=F.childNodes[0];
if(A.isTag(J,H)){var L=J.style;
var G=A.getAttribute(J,"class",true);
if(G||L.textAlign||L.marginLeft){if(H!=C){var K=this.context.createElement(C);
if(G){A.setAttribute(K,"class",G)
}if(L.textAlign){K.style.textAlign=L.textAlign
}if(L.marginLeft){K.style.marginLeft=L.marginLeft
}A.replaceNode(J,K)
}}else{I.removeWithoutChildren(J)
}}}}}}},checkAllowedForPaste:function(G){var E=CQ.form.rte.Common;
var D=true;
var C=["br"];
var F={b:"bold",i:"italic",u:"underline",a:"anchor",img:"image",sub:"subscript",sup:"superscript"};
var B=null;
if(this.pasteRules.allowBasics){var A=G.tagName.toLowerCase();
if(F.hasOwnProperty(A)){B=F[A]
}}if(this.pasteRules.table){if((this.pasteRules.table.allow)||(this.pasteRules.table.ignoreMode=="paragraph")){C.push("table");
C.push("tbody");
C.push("tr");
C.push("td");
C.push("th")
}}if(this.pasteRules.list){if((this.pasteRules.list.allow)||(this.pasteRules.list.ignoreMode=="paragraph")){C.push("ul");
C.push("ol");
C.push("li")
}}if(B!=null){D=(this.pasteRules.allowBasics[B]!==true)
}else{if(E.isTag(G,C)){D=false
}else{if(E.isTag(G,E.BLOCK_TAGS)){D=false
}}}if(D){this.elementsToRemove.push(G);
return null
}return G
},handleTablesOnPaste:function(C){var A=CQ.form.rte.Common;
var B=this.pasteRules.table;
if(B.allow){return C
}if(B.ignoreMode=="remove"){A.removeAllChildren(C);
this.markForRemoval(C);
return C
}return this.flattenNestedStructure(C,A.TABLE_CELLS,"table")
},handleListsOnPaste:function(C){var A=CQ.form.rte.Common;
var B=this.pasteRules.list;
if(B.allow){return C
}if(B.ignoreMode=="remove"){A.removeAllChildren(C);
this.markForRemoval(C);
return C
}return this.flattenNestedStructure(C,"li",A.LIST_TAGS)
},handleBlockTagsOnPaste:function(F){var C=CQ.form.rte.Common;
if(C.isTag(F,C.BLOCK_TAGS)){var B=F.tagName.toLowerCase();
if(C.isTag(F,"table")&&this.pasteRules.table){return this.handleTablesOnPaste(F)
}if(C.isTag(F,C.LIST_TAGS)&&this.pasteRules.list){return this.handleListsOnPaste(F)
}var D=true;
if(this.pasteRules.allowBlockTags){D=!C.arrayContains(this.pasteRules.allowBlockTags,B)
}if(D){var E=this.pasteRules.fallbackBlockTag||"p";
var A=this.context.createElement(E);
this.elementsToChange.push({domToChange:F,changedDom:A})
}}},handleCssClassesOnPaste:function(G){var D=CQ.form.rte.Common;
var F=(this.pasteRules.cssMode||"remove");
var E=D.parseCSS(G);
if(E&&(E.length>0)){switch(F){case"remove":D.removeAttribute(G,"class");
break;
case"whitelist":var C=this.pasteRules.allowedCssNames||[];
var A=E.length;
for(var H=0;
H<A;
H++){var B=E[H];
if(!D.arrayContains(C,B)){D.removeClass(G,B)
}}break
}}},manageRegEx:function(regex){if(typeof (regex)=="string"){regex=eval(regex)
}return regex
},handleSecurity:function(D){var A=CQ.form.rte.Common;
if(A.isTag(D,"a")){var C=A.getAttribute(D,"href",true);
if(C&&this.pasteRules.linkRemoveRegEx){var B=this.manageRegEx(this.pasteRules.linkRemoveRegEx);
if(B){if(C.search(B)>=0){this.markForRemoval(D);
return null
}}}}return D
},handleAttributes:function(G){var B=CQ.form.rte.Common;
var A=B.getAttributeNames(G);
var F=null;
var H=null;
var C=G.tagName.toLowerCase();
if(this.pasteRules.allowedAttributes){F=this.pasteRules.allowedAttributes["*"];
H=this.pasteRules.allowedAttributes[C]
}var I=A.length;
for(var J=0;
J<I;
J++){var E=A[J];
var D=false;
if(F&&B.arrayContains(F,E)){D=true
}if(H&&B.arrayContains(H,E)){D=true
}if(!D){B.removeAttribute(G,E)
}}},handlePasteProcessing:function(B){var C=CQ.form.rte.DomCleanup;
var A=B;
if((this.mode=C.PASTE_PREPARE)&&(this.pasteRules!=null)){B=this.checkAllowedForPaste(B);
if(B){B=this.handleSecurity(B)
}if(B){this.handleBlockTagsOnPaste(B);
this.handleCssClassesOnPaste(B);
this.handleAttributes(B)
}}return B||A
},traverse:function(D,B){if(!B&&(D.nodeType==1)){if(!this.isValidElement(D)){this.markForRemoval(D)
}else{D=this.handlePasteProcessing(D);
var A=false;
if(this.htmlRules){A=this.applyHtmlRules(D)
}if(!A){this.handleSpecificTags(D)
}}}var C=D.childNodes;
for(var E=0;
E<C.length;
E++){this.traverse(C[E],false)
}},removeElements:function(){var C=CQ.form.rte.DomProcessor;
var A=this.elementsToRemove.length;
for(var B=0;
B<A;
B++){C.removeWithoutChildren(this.elementsToRemove[B])
}this.elementsToRemove.length=0
},replaceElements:function(){var B=CQ.form.rte.Common;
var F=this.elementsToChange.length;
for(var D=0;
D<F;
D++){var C=this.elementsToChange[D];
var A=C.domToChange;
B.replaceNode(A,C.changedDom,C.childDom);
for(var E=0;
E<this.elementsToRemove.length;
E++){if(this.elementsToRemove[E]==A){this.elementsToRemove.splice(E,1);
break
}}}},execute:function(B,A){this.editorKernel=B;
this.context=B.getEditContext();
this.htmlRules=B.getHtmlRules();
if(this.elementsToRemove!=null){this.elementsToRemove.length=0
}else{this.elementsToRemove=[]
}if(this.elementsToChange!=null){this.elementsToChange.length=0
}else{this.elementsToChange=[]
}this.traverse(A,true);
this.replaceElements();
this.removeElements();
this.handleContainerRules(A);
this.handleEmptyContent(A)
},preprocess:function(B,A){this.processingMode=CQ.form.rte.DomCleanup.PRE;
this.execute(B,A)
},postprocess:function(B,A){this.processingMode=CQ.form.rte.DomCleanup.POST;
this.execute(B,A)
},prepareHtmlPaste:function(C,B,A){this.processingMode=CQ.form.rte.DomCleanup.PASTE_PREPARE;
this.pasteRules=A;
this.execute(C,B)
}});
CQ.form.rte.DomCleanup.PRE=0;
CQ.form.rte.DomCleanup.POST=1;
CQ.form.rte.DomCleanup.PASTE_PREPARE=2;
CQ.form.rte.commands.Command=CQ.Ext.extend(CQ.Ext.emptyFn,{isCommand:function(A){return false
},isUndoable:function(A){return true
},requiresInitializedComponent:function(A){return true
},getProcessingOptions:function(){return CQ.form.rte.commands.Command.PO_NONE
},execute:function(A){},queryState:function(A,B){return false
}});
CQ.form.rte.commands.Command.PO_NONE=0;
CQ.form.rte.commands.Command.PO_SELECTION=1;
CQ.form.rte.commands.Command.PO_BOOKMARK=2;
CQ.form.rte.commands.Command.PO_NODELIST=4;
CQ.form.rte.commands.CommandRegistry=function(){var A={};
return{register:function(C,B){A[C]=B
},createRegisteredCommands:function(){var C={};
for(var B in A){if(A.hasOwnProperty(B)){C[B]=new A[B]()
}}return C
}}
}();
CQ.form.rte.commands.SurroundBase=CQ.Ext.extend(CQ.form.rte.commands.Command,{tagName:null,attributes:null,constructor:function(B,A){this.tagName=B;
this.attributes=A
},containsTag:function(D,C){var A=CQ.form.rte.Common;
for(var B in D){var E=D[B];
if(A.isTag(E,C)){return true
}}return false
},isCommand:function(A){return(A.toLowerCase()==this.tagName.toLowerCase())
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK|A.PO_NODELIST
},execute:function(E){var A=CQ.form.rte.Common;
var B=E.nodeList;
var C=E.editContext;
var D=A.containsTagInPath(C,B.commonAncestor,this.tagName);
if(!D){B.surround(E.editContext,this.tagName,this.attributes)
}else{B.removeNodesByTag(E.editContext,this.tagName,null,true)
}},queryState:function(A,C){var B=A.consistentFormatting;
return this.containsTag(B,this.tagName)
}});
CQ.form.rte.commands.DefaultFormatting=CQ.Ext.extend(CQ.form.rte.commands.Command,{containsTag:function(D,C){var A=CQ.form.rte.Common;
for(var B in D){var E=D[B];
if(A.isTag(E,C)){return true
}}return false
},getTagNameForCommand:function(C){var B=C.toLowerCase();
var A=null;
switch(B){case"bold":A="b";
break;
case"italic":A="i";
break;
case"underline":A="u";
break;
case"subscript":A="sub";
break;
case"superscript":A="sup";
break
}return A
},isCommand:function(B){var A=B.toLowerCase();
return(A=="bold")||(A=="italic")||(A=="underline")||(A=="subscript")||(A=="superscript")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK|A.PO_NODELIST
},execute:function(H){var B=CQ.form.rte.Common;
var C=H.nodeList;
var G=H.selection;
var E=H.editContext;
if(!CQ.form.rte.Selection.isSelection(G)){H.editContext.doc.execCommand(H.command,false,null);
return 
}var D=this.getTagNameForCommand(H.command);
var A=H.value;
var F=(B.getTagInPath(E,G.startNode,D)!=null);
if(!F){C.surround(H.editContext,D,A)
}else{C.removeNodesByTag(H.editContext,D,A,true)
}},queryState:function(B,F){var A=CQ.form.rte.Common;
if(!B.isSelection){return B.editContext.doc.queryCommandState(F)
}var D=B.editContext;
var C=this.getTagNameForCommand(F);
var E=B.selection;
return(A.getTagInPath(D,E.startNode,C)!=null)
}});
CQ.form.rte.commands.CommandRegistry.register("defaultfmt",CQ.form.rte.commands.DefaultFormatting);
CQ.form.rte.commands.Anchor=CQ.Ext.extend(CQ.form.rte.commands.Command,{addAnchorToDom:function(E){var D=CQ.form.rte.Common;
var K=CQ.form.rte.DomProcessor;
var F=E.nodeList;
var B=E.value;
var C=E.editContext;
var A=[];
F.getNamedAnchors(C,A,false);
if(A.length>0){for(var I=0;
I<A.length;
I++){this.applyAnchorProperties(A[I].dom,B)
}}else{var H={name:B,className:CQ.themes.RichText.ANCHOR_CLASS};
var J=E.selection;
var G=K.createNode(E.editContext,"a",H);
D.insertNode(G,J.startNode,J.startOffset)
}},applyAnchorProperties:function(B,A){B.name=A;
B.className=CQ.themes.RichText.ANCHOR_CLASS
},removeAnchorFromDom:function(F){var E=CQ.form.rte.DomProcessor;
var C=F.editContext;
var A=F.nodeList;
var D=[];
A.getNamedAnchors(editContext,D,true);
for(var B=0;
B<D.length;
B++){E.removeWithoutChildren(D[B].dom)
}},isCommand:function(B){var A=B.toLowerCase();
return(A=="anchor")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION|A.PO_NODELIST
},execute:function(A){if(A.value){this.addAnchorToDom(A)
}else{this.removeAnchorFromDom(A)
}},queryState:function(A,B){return(A.namedAnchorCount>0)
}});
CQ.form.rte.commands.CommandRegistry.register("anchor",CQ.form.rte.commands.Anchor);
CQ.form.rte.commands.CutCopy=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(B){var A=B.toLowerCase();
return(A=="cut")||(A=="copy")
},execute:function(A){var D=A.command;
var C=A.editContext.doc;
try{C.execCommand(D,false,null)
}catch(B){throw new Error("Cannot "+D+".")
}}});
CQ.form.rte.commands.CommandRegistry.register("cutcopy",CQ.form.rte.commands.CutCopy);
CQ.form.rte.commands.Format=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(A){return(A.toLowerCase()=="format")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION
},execute:function(D){var H=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var F;
var I=D.selection;
var B=D.editContext;
var G=H.createContainerList(B,I);
if(G.length==0){var E=D.nodeList;
if(!E){E=H.createNodeList(B,I)
}var A=C.getTagInPath(B,E.commonAncestor,H.AUXILIARY_ROOT_TAGS);
if(A){F=H.createNode(D.editContext,D.value.tag);
C.moveChildren(A,F);
A.appendChild(F)
}}else{F=H.createNode(D.editContext,D.value.tag);
H.changeContainerTag(D.editContext,G,F,true)
}},queryState:function(A,B){return false
}});
CQ.form.rte.commands.CommandRegistry.register("format",CQ.form.rte.commands.Format);
CQ.form.rte.commands.Indent=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(A){return(A.toLowerCase()=="indent")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK|A.PO_NODELIST
},execute:function(C){var K={selOffset:{collapse:true}};
var G=CQ.form.rte.Common;
var B=CQ.form.rte.DomProcessor;
var S=C.selection;
var Q=C.nodeList;
var D=C.editContext;
var R=CQ.form.rte.commands.Indent.TAGEXCL;
var P=Q.getTags(D,[{matcher:function(U){if(G.isTag(U,G.BLOCK_TAGS)&&!G.isTag(U,R)){return true
}return G.isTag(U,"li")
}}],true,true);
var F=B.getAuxRoots(D,S);
var I=F.length;
for(var J=0;
J<I;
J++){var T=F[J];
var A=D.createElement("p");
G.moveChildren(T,A);
T.appendChild(A);
P.push({dom:A})
}var O=P.length;
for(var N=0;
N<O;
N++){var E=P[N];
var M=E.dom;
if(G.isTag(M,G.BLOCK_TAGS)){var L=0;
if(M.style.marginLeft){L=parseInt(M.style.marginLeft)
}L+=C.value||CQ.form.rte.commands.Indent.DEFAULT_INDENT_SIZE;
M.style.marginLeft=L+"px"
}else{var H=new CQ.form.rte.ListRepresentation();
H.fromItem(D,M);
H.ensureHierarchy(D);
H.indent(D,M)
}}return K
},queryState:function(C,F){var B=CQ.form.rte.Common;
var D=C.editContext;
var A=CQ.form.rte.commands.Indent.TAGEXCL;
var E=C.nodeList.getTags(D,[{matcher:function(G){if(B.isTag(G,B.BLOCK_TAGS)&&!B.isTag(G,A)){return !!G.style.marginLeft
}return B.isTag(G,"li")
}}],true,true);
return(E.length>0)
}});
CQ.form.rte.commands.Indent.TAGEXCL=["ul","ol","table"];
CQ.form.rte.commands.Indent.DEFAULT_INDENT_SIZE=40;
CQ.form.rte.commands.CommandRegistry.register("indent",CQ.form.rte.commands.Indent);
CQ.form.rte.commands.InsertHtml=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(A){return(A.toLowerCase()=="inserthtml")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION
},execute:function(C){var B=C.value;
if(B&&(B.length>0)){if(CQ.Ext.isIE){try{var A=C.editContext.doc.selection.createRange();
A.pasteHTML(B)
}catch(D){throw new Error("Could not insert html due to IE limitations.")
}}else{if(CQ.Ext.isGecko){C.editContext.doc.execCommand("inserthtml",false,B)
}}}},queryState:function(A,B){return false
}});
CQ.form.rte.commands.CommandRegistry.register("inserthtml",CQ.form.rte.commands.InsertHtml);
CQ.form.rte.commands.Justify=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(B){var A=CQ.form.rte.Common;
return A.strStartsWith(B.toLowerCase(),"justify")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK
},alignTableCells:function(A,C,F){var B=CQ.form.rte.Common;
var I=C.cells;
var E=I.length;
for(var G=0;
G<E;
G++){var H=I[G];
var D=B.getStyleProp(A,H.parentNode,"textAlign");
D=(D?D:"left");
if(D!=F){H.style.textAlign=F
}else{H.style.textAlign=""
}}},execute:function(D){var A=CQ.form.rte.DomProcessor;
var H=CQ.form.rte.Common;
var S=D.selection;
var P=D.command;
var F=D.editContext;
var I=P.substring(7,P.length);
if(S.cellSelection){this.alignTableCells(F,S.cellSelection,I)
}else{var C;
var L=A.createContainerList(F,S);
var R=H.getConsistentStyle(F,L,"textAlign","left");
var B=(R!=null);
var O=L.length;
for(var E=0;
E<O;
E++){var Q=L[E];
C=H.getStyleProp(F,Q.parentNode,"textAlign");
C=(C?C:"left");
var J=(C==I);
if(B){if(J){Q.style.textAlign=""
}else{Q.style.textAlign=I
}}else{Q.style.textAlign=(J?"":I)
}}var G=A.getAuxRoots(F,S);
var N=G.length;
for(var M=0;
M<N;
M++){var K=G[M];
if(H.isTag(K,["td","th"])){C=H.getStyleProp(F,K.parentNode,"textAlign");
C=(C?C:"left");
if(I!=C){K.style.textAlign=I
}else{K.style.textAlign=""
}}}}},queryState:function(J,E){var C=CQ.form.rte.Common;
var B=J.editContext;
var H=C.arrayCopy(J.containerList);
var F=J.auxRoots;
var D=F.length;
for(var A=0;
A<D;
A++){var I=F[A];
if(C.isTag(I,["td","th"])){H.push(I)
}}var G=E.substring(7,E.length);
var K=C.getConsistentStyle(B,H,"textAlign","left");
return(G==K)
}});
CQ.form.rte.commands.CommandRegistry.register("justify",CQ.form.rte.commands.Justify);
CQ.form.rte.commands.Link=CQ.Ext.extend(CQ.form.rte.commands.Command,{addLinkToDom:function(D){var B=D.editContext;
var F=D.nodeList;
var A=D.value.url;
var E=D.value.css;
var K=D.value.target;
var G=D.value.attributes||{};
var N=[];
F.getAnchors(B,N,true);
if(N.length>0){for(var H=0;
H<N.length;
H++){this.applyLinkProperties(N[H].dom,A,E,K,G)
}}else{var C=CQ.form.rte.Selection;
var L=CQ.form.rte.DomProcessor;
if(D.value.trimLinkSelection===true){var I=C.getLeadRange(B);
I=C.trimRangeWhitespace(B,I);
C.selectRange(B,I);
F=L.createNodeList(B,C.createProcessingSelection(B))
}var O=B.createElement("span");
O.innerHTML='<a href="'+A+'"></a>';
G.href=O.childNodes[0].href;
G[CQ.form.rte.Common.HREF_ATTRIB]=A;
if(E){G.className=E
}if(K){G.target=K
}else{delete G.target
}for(var M in G){if(G.hasOwnProperty(M)){var J=G[M];
if((J==null)||(J.length==0)||(J==CQ.form.rte.commands.Link.REMOVE_ATTRIBUTE)){delete G[M]
}}}F.surround(B,"a",G)
}},applyLinkProperties:function(H,C,D,F,G){var B=CQ.form.rte.Common;
H.href=C;
H.setAttribute(CQ.form.rte.Common.HREF_ATTRIB,C);
if(F){B.setAttribute(H,"target",F)
}else{B.removeAttribute(H,"target")
}if(D){B.setAttribute(H,"class",D)
}else{B.removeAttribute(H,"class")
}for(var E in G){if(G.hasOwnProperty(E)){var A=G[E];
if(A&&(A.length>0)&&(A!=CQ.form.rte.commands.Link.REMOVE_ATTRIBUTE)){B.setAttribute(H,E,A)
}else{B.removeAttribute(H,E)
}}}},removeLinkFromDom:function(F){var E=CQ.form.rte.DomProcessor;
var D=F.editContext;
var B=F.nodeList;
var A=[];
B.getAnchors(D,A,true);
for(var C=0;
C<A.length;
C++){E.removeWithoutChildren(A[C].dom)
}},isCommand:function(B){var A=B.toLowerCase();
return(A=="modifylink")||(A=="unlink")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION|A.PO_NODELIST
},execute:function(A){switch(A.command.toLowerCase()){case"modifylink":this.addLinkToDom(A);
break;
case"unlink":this.removeLinkFromDom(A);
break
}},queryState:function(A,B){return(A.anchorCount>0)
}});
CQ.form.rte.commands.Link.REMOVE_ATTRIBUTE=new Object();
CQ.form.rte.commands.CommandRegistry.register("link",CQ.form.rte.commands.Link);
CQ.form.rte.commands.List=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(B){var A=B.toLowerCase();
return(A=="insertorderedlist")||(A=="insertunorderedlist")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK|A.PO_NODELIST
},getListItems:function(B){var A=B.editContext;
return B.nodeList.getTags(A,[{extMatcher:function(C){return{isMatching:CQ.form.rte.Common.isTag(C,"li"),preventRecursionIfMatching:true}
}}],true,true)
},getAllListItems:function(D){var A=CQ.form.rte.Common;
var B=D.editContext;
var C=D.nodeList.getTags(B,[{matcher:function(E){return CQ.form.rte.Common.isTag(E,"li")
}}],true,true);
CQ.form.rte.ListUtils.postprocessSelectedItems(C);
return C
},getDefiningListDom:function(D,C){var B=CQ.form.rte.Common;
var E=C.getFirstNode();
if(E==null){return null
}var A=E.dom;
while(A){if(B.isTag(A,B.LIST_TAGS)){return A
}A=B.getParentNode(D,A)
}return null
},splitToTopLevelLists:function(E,F){var B=E.editContext;
var C=[];
var I=[];
var H=F.length;
for(var G=0;
G<H;
G++){var J=F[G];
var A=CQ.form.rte.ListUtils.getTopListForItem(B,J.dom);
var D=CQ.form.rte.Common.arrayIndex(I,A);
if(D<0){I.push(A);
C.push([J])
}else{C[D].push(J)
}}return C
},changeItemsListType:function(F,G,O){var D=CQ.form.rte.Common;
var B=F.editContext;
var M=G.length;
for(var L=0;
L<M;
L++){var P=G[L].dom;
var N=P.parentNode;
if(!D.isTag(N,O)){var H=N.previousSibling;
var A=N.nextSibling;
var J=(D.getChildIndex(P)==0);
var K=(D.getChildIndex(P)==(N.childNodes.length-1));
if(J&&H&&D.isTag(H,O)){N.removeChild(P);
H.appendChild(P);
if(N.childNodes.length==0){N.parentNode.removeChild(N)
}}else{if(K&&A&&D.isTag(A,O)){N.removeChild(P);
D.insertBefore(A,P,A.firstChild);
if(N.childNodes.length==0){N.parentNode.removeChild(N)
}}else{var C=B.createElement(O);
if(P==N.firstChild){D.insertBefore(N.parentNode,C,N)
}else{if(P==N.lastChild){D.insertBefore(N.parentNode,C,N.nextSibling)
}else{var I=N.cloneNode(false);
D.insertBefore(N.parentNode,I,N);
D.insertBefore(N.parentNode,C,N);
while(N.childNodes[0]!=P){var E=N.childNodes[0];
N.removeChild(E);
I.appendChild(E)
}}}N.removeChild(P);
C.appendChild(P);
if(N.childNodes.length==0){N.parentNode.removeChild(N)
}}}}}},createListFromSelection:function(G,E){var C=G.nodeList;
var D=G.editContext;
var B=C.getEditBlocksByAuxRoots(D,true);
var F=B.length;
for(var A=0;
A<F;
A++){CQ.form.rte.ListUtils.createList(D,B[A],E)
}},unlistItems:function(E,D,A){if(!D){D=this.getAllListItems(E)
}var C=E.editContext;
var G=D.length;
var F=[];
for(var B=0;
B<G;
B++){F.push(D[B].dom)
}CQ.form.rte.ListUtils.unlistItems(C,F,A)
},execute:function(C){var B=CQ.form.rte.Common;
var A=C.editContext;
var F=C.nodeList;
var H=C.command;
var J=C.value;
var I=null;
switch(H.toLowerCase()){case"insertorderedlist":I="ol";
break;
case"insertunorderedlist":I="ul";
break
}if(I){var E;
var L=this.getDefiningListDom(A,F);
if(L==null){this.createListFromSelection(C,I)
}else{if(!B.isTag(L,I)){E=this.getListItems(C);
this.changeItemsListType(C,E,I)
}else{E=this.getAllListItems(C);
if(E.length>0){var G=this.splitToTopLevelLists(C,E);
var K=G.length;
for(var D=0;
D<K;
D++){E=G[D];
this.unlistItems(C,E,J===true)
}}}}}},queryState:function(C,F){var A=CQ.form.rte.Common;
var E=C.editContext;
var B=C.nodeList;
var D;
switch(F.toLowerCase()){case"insertorderedlist":D="ol";
break;
case"insertunorderedlist":D="ul";
break
}var G=this.getDefiningListDom(E,B);
return((G!=null)&&A.isTag(G,D))
}});
CQ.form.rte.commands.List.NO_LIST_AVAILABLE=new Object();
CQ.form.rte.commands.CommandRegistry.register("list",CQ.form.rte.commands.List);
CQ.form.rte.commands.Outdent=CQ.Ext.extend(CQ.form.rte.commands.Command,{isCommand:function(A){return(A.toLowerCase()=="outdent")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_SELECTION|A.PO_BOOKMARK|A.PO_NODELIST
},execute:function(A){var G={selOffset:{start:0,collapse:true}};
var D=CQ.form.rte.Common;
var P=A.nodeList;
var B=A.editContext;
var R=CQ.form.rte.commands.Indent.TAGEXCL;
var O=P.getTags(B,[{matcher:function(S){if(D.isTag(S,D.BLOCK_TAGS)&&!D.isTag(S,R)){return !!S.style.marginLeft
}return D.isTag(S,"li")
}}],true,true);
CQ.form.rte.ListUtils.postprocessSelectedItems(O);
var N=O.length;
var Q=[];
var J=[];
for(var M=0;
M<N;
M++){var C=O[M];
var L=C.dom;
if(D.isTag(L,D.BLOCK_TAGS)){var K=0;
if(L.style.marginLeft){K=parseInt(L.style.marginLeft);
K-=A.value||CQ.form.rte.commands.Indent.DEFAULT_INDENT_SIZE;
if(K<=0){L.style.marginLeft=null
}else{L.style.marginLeft=K+"px"
}}}else{var H=CQ.form.rte.ListUtils.getTopListForItem(B,L);
var E=D.arrayIndex(Q,H);
if(E<0){Q.push(H);
J.push([L])
}else{J[E].push(L)
}}}for(var I=0;
I<Q.length;
I++){var F=new CQ.form.rte.ListRepresentation();
F.fromList(Q[I]);
F.ensureHierarchy(B);
F.outdent(B,J[I])
}return G
}});
CQ.form.rte.commands.CommandRegistry.register("outdent",CQ.form.rte.commands.Outdent);
CQ.form.rte.commands.Paste=CQ.Ext.extend(CQ.form.rte.commands.Command,{domPreProcessor:null,constructor:function(){var A=CQ.form.rte.HtmlProcessor;
this.domPreProcessor=new CQ.form.rte.DomCleanup({tagsToRemove:["font"]})
},pasteAsPlainText:function(C){var G=CQ.form.rte.HtmlProcessor;
var A=CQ.form.rte.DomProcessor;
var T=CQ.form.rte.Selection;
var H=CQ.form.rte.Common;
var N=C.value.html;
var P=C.value.text;
var D=C.editContext;
var Q;
if(P){Q=P
}else{Q=(new G.StripTags()).strip(N);
Q=G.stripSurroundingWhitespace(Q,true);
if(C.value.stripHtmlTags){Q=CQ.Ext.util.Format.htmlDecode(Q);
Q=CQ.Ext.util.Format.stripTags(Q)
}}var E=Q.split("\n\n");
var L=E.length;
var S=T.createProcessingSelection(D);
var I=S.startNode;
var V=S.startOffset;
if(H.isRootNode(D,I)){I=this.ensureMinimumContent();
V=null
}for(var K=0;
K<L;
K++){if(K>0){I=A.insertParagraph(D,I,V);
V=null
}var B=E[K].split("\n");
var J=B.length;
for(var R=0;
R<J;
R++){var M=B[R];
if(R>0){var F=D.createElement("br");
if(V==0){I.parentNode.insertBefore(F,I)
}else{if(V>=H.getNodeCharacterCnt(I)){I.parentNode.insertBefore(F,I.nextSibling);
I=H.getNextNode(D,F);
if(!I){var U=D.root.childNodes;
I=U[U.length-1];
V=I.childNodes.length
}else{if(I.nodeType==3){V=0
}else{V=null
}}}else{I=A.splitTextNode(D,I,V)[1];
I.parentNode.insertBefore(F,I);
V=0
}}}var O=A.insertText(D,I,V,M);
I=O.node;
V=O.offset
}}return{startNode:I,startOffset:V}
},cleanUpDom:function(B,F,E,C){var A=CQ.form.rte.Common;
var D=[{fn:function(H){if(H.nodeType!=1){return false
}if(A.isTag(H,"img")){var G=H.src;
if(H[A.SRC_ATTRIB]){G=H[A.SRC_ATTRIB]
}if(!G||A.strStartsWith(G,"file://")){return true
}}return false
},keepChildren:false},{tagName:["font"],keepChildren:true}];
CQ.form.rte.WhitespaceProcessor.process(B,E,D,false);
this.domPreProcessor.prepareHtmlPaste(F,E,C)
},pasteTableToTable:function(E){var K=CQ.form.rte.Common;
var F=E.editContext;
var T;
var n=E.value.dom;
var b=K.getTags(n,"table");
if(b.length!=1){this.insertHtml(E);
return 
}var O=F.root.innerHTML;
var o=E.selection;
var k=E.nodeList;
var U=K.getTagInPath(F,k.commonAncestor,"table");
var C=new CQ.form.rte.TableMatrix();
C.createTableMatrix(b[0]);
C.createFullMatrix();
var Y=new CQ.form.rte.TableMatrix();
Y.createTableMatrix(U);
var L=null;
var J=null;
var X,j,R,H,D,A;
if(o.cellSelection){J=o.cellSelection.cells;
if(J&&(J.length==1)){L=J[0]
}}else{if(k.nodes&&(k.nodes.length==1)){var a=k.nodes[0].dom;
if(K.isTag(a,K.TABLE_CELLS)&&(a.childNodes.length==0)){L=a
}}if(L==null){L=K.getTagInPath(F,k.commonAncestor,K.TABLE_CELLS)
}}if(L){var B=Y.getCellDef(L);
var d=C.getTableSize();
var S=Y.getTableSize();
var I=B.col;
var N=B.row;
var Q=(I+d.cols)-S.cols;
var P=(N+d.rows)-S.rows;
Q=(Q>=0?Q:0);
P=(P>=0?P:0);
Y.extendBy(F,Q,P);
var m=null;
try{m=Y.mergeToSingleCell(F,I,N,d.cols,d.rows)
}catch(g){F.root.innerHTML=O;
if(g.message=="Invalid table structure."){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Paste"),CQ.I18n.getMessage("You are trying to paste table data into an existing table.<br>As this operation would result in invalid HTML, it has been cancelled.<br>Please try to simplify the table's structure and try again."));
return 
}throw g
}Y.createTableMatrix(U);
Y.createFullMatrix();
m.parentNode.removeChild(m);
for(X=0;
X<d.rows;
X++){for(j=0;
j<d.cols;
j++){R=C.fullMatrix[X][j];
if(R.isOrigin){H=Y.getFollowUpCell(j+I,X+N);
D=(H?H.cellDom:null);
A=Y.getRowDom(X+N);
var M=R.cellRef.cellDom;
var V=F.createElement("span");
V.innerHTML="<table><tr><td></td></tr></table>";
var W=CQ.Ext.DomQuery.selectNode("td:first",V);
var Z=W.parentNode;
K.replaceNode(W,M);
T=Z.innerHTML;
if(!T){T="<td>"+(CQ.Ext.isIE?"&nbsp;":"<br>")+"</td>"
}if(CQ.Ext.isIE){K.removeAllChildren(V);
V.innerHTML="<table><tr>"+T+"</tr></table>";
Z=CQ.Ext.DomQuery.selectNode("tr:first",V)
}else{Z.innerHTML=T
}A.insertBefore(Z.childNodes[0],D)
}}}}else{if(J){var G=Y.createSelection(o.cellSelection.cells);
if(!G.selectionProps.isRect){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Paste"),CQ.I18n.getMessage("You are trying to paste table data into an non-rectangular cell selection.<br>Please choose a rectangular cell selection and try again."));
return 
}try{m=Y.mergeToSingleCell(F,G.selectionProps.minCol,G.selectionProps.minRow,G.selectionProps.cols,G.selectionProps.rows)
}catch(g){F.root.innerHTML=O;
if(g.message=="Invalid table structure."){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Paste"),CQ.I18n.getMessage("You are trying to paste table data into an existing table.<br>As this operation would result in invalid HTML, it has been cancelled.<br>Please try to simplify the table's structure and try again."));
return 
}throw g
}K.removeAllChildren(m);
m.innerHTML=n.innerHTML
}}},preprocessDiv:function(E){var B=CQ.form.rte.Common;
var F,C,D;
C=E.childNodes.length;
for(F=C-1;
F>=0;
F--){D=E.childNodes[F];
if(B.isTag(D,"div")){this.preprocessDiv(D)
}}var A=false;
C=E.childNodes.length;
for(F=C-1;
F>=0;
F--){D=E.childNodes[F];
if(B.isTag(D,B.BLOCK_TAGS)){if(!B.hasTextChild(D)){E.removeChild(D)
}else{A=true
}}}if(A){C=E.childNodes.length;
for(F=C-1;
F>=0;
F--){D=E.childNodes[F];
E.removeChild(D);
if(E.nextSibling){E.parentNode.insertBefore(D,E.nextSibling)
}else{E.parentNode.appendChild(D)
}}E.parentNode.removeChild(E)
}else{if(!B.hasTextChild(E,true)){E.parentNode.removeChild(E)
}}},insertInExistingNode:function(F,J,C){var H=CQ.form.rte.Common;
var A=CQ.form.rte.DomProcessor;
var P=CQ.form.rte.Selection;
var I=J.startNode;
var T=J.startOffset;
if(T==P.getLastSelectionOffset(I)){var B=I;
while(B){B=H.getTagInPath(F,B,"a");
if(B&&H.isAttribDefined(B,"href")){var E=H.getNextNode(F,B);
var U=null;
if(E!=null){U=H.getNextCharacterNode(F,E,H.EDITBLOCK_TAGS)
}if(U){I=U;
T=P.getFirstSelectionOffset(U)
}else{I=B.parentNode;
T=null
}break
}}}var S,D;
if(I.nodeType==3){if(T==0){S=false;
D=false
}else{if(T==H.getNodeCharacterCnt(I)){S=true;
D=false
}else{var K=A.splitTextNode(F,I,T);
I=K[K.length-1];
S=false;
D=false
}}}else{if(H.isOneCharacterNode(I)){S=(T==0);
D=false
}else{if(I.nodeType==1){if((T==undefined)||(T==I.childNodes.length)){S=false;
D=true
}else{I=I[T];
S=false;
D=true
}}}}var N=H.childNodesAsArray(C);
var M=N.length;
for(var R=0;
R<M;
R++){var G=N[R];
C.removeChild(G);
if(D){I.appendChild(G)
}else{if(S){H.insertBefore(I.parentNode,G,I.nextSibling);
I=G
}else{H.insertBefore(I.parentNode,G,I)
}}}var O=N[M-1];
var Q=H.getLastChild(O);
if(Q!=null){O=Q
}var L=A.removeDuplicateStructures(F,N[0],O);
return{startNode:L.endNode,startOffset:CQ.form.rte.Selection.getLastSelectionOffset(L.endNode)}
},insertAsSingleLine:function(E,A,B){var C=CQ.form.rte.Common;
var F=CQ.form.rte.DomProcessor;
var D=F.getEmptyLine(E,A);
if(D!=null){C.removeAllChildren(D);
C.moveChildren(B,D);
return{startNode:D,startOffset:undefined}
}return this.insertInExistingNode(E,A,B)
},ensureBlockStructure:function(B,F){var E=CQ.form.rte.Common;
var D=F.childNodes;
var H=D.length;
for(var I=H-1;
I>=0;
I--){var G=D[I];
if(!E.isTag(G,E.BLOCK_TAGS)){var C=B.createElement("p");
var A=G.nextSibling;
F.removeChild(G);
C.appendChild(G);
while(I>0){I--;
var J=D[I];
if(E.isTag(J,E.BLOCK_TAGS)){I++;
break
}F.removeChild(J);
C.insertBefore(J,C.firstChild)
}E.insertBefore(F,C,A);
G=C
}}},preprocessPastedDom:function(A,F,I){var D=CQ.form.rte.Common;
var B=A.getEditContext();
var E=F.childNodes.length;
var C=F.childNodes;
for(var G=E-1;
G>=0;
G--){var H=C[G];
if(D.isTag(H,D.BLOCK_TAGS)){if(D.isTag(H,"div")){this.preprocessDiv(H)
}}}this.ensureBlockStructure(B,F)
},splitExistingNode:function(B,G,H){var E=CQ.form.rte.Common;
var K=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Selection;
var F=null;
var D=false;
var I=E.getTagInPath(B,G,E.EDITBLOCK_TAGS);
if(!I){throw new Error("No edit block found. Cannot split node.")
}var J=E.getFirstChild(I);
if(J==G){if(H==C.getFirstSelectionOffset(G)){return{insertPoint:I,insertBehind:false}
}}var A=E.getLastChild(I);
if(A==G){if(H==C.getLastSelectionOffset(G)){return{insertPoint:I,insertBehind:true}
}}if(E.isOneCharacterNode(G)){if(H==0){G=E.getNextNode(B,G);
H=null
}}F=K.splitToParent(I,G,H);
D=false;
return{insertPoint:F,insertBehind:D}
},insertHtml:function(K){var X=CQ.form.rte.DomProcessor;
var U=CQ.form.rte.Selection;
var F=CQ.form.rte.Common;
var M=CQ.form.rte.commands.Paste.ATOMIC_PROCESSING_BLOCKS;
var u=K.editContext;
var W=K.value.dom;
var I=U.createProcessingSelection(u);
if(I.cellSelection&&I.cellSelection.cells){if(I.cellSelection.cells.length>0){var m=I.cellSelection.cells[0];
var B=null;
var G=F.getFirstTextChild(m,true);
if(G){m=G;
B=U.getFirstSelectionOffset(G)
}I.startNode=m;
I.startOffset=B;
I.endNode=null;
I.endOffset=null
}}var q,C,r;
var a=false;
var D=false;
this.preprocessPastedDom(K.component,W,K.value.pasteRules);
var N=W.childNodes;
var j=N.length;
if(j==0){return null
}var n=I.startNode;
var J=F.getTagInPath(u,n,["ul","ol"]);
if(j==1){if(F.isTag(N[0],["ul","ol"])){if(J){W=N[0];
N=W.childNodes;
j=N.length
}}}if(J){var P=u.createElement("li");
for(r=j-1;
r>=0;
r--){var E=N[r];
if(F.isTag(E,["ul","ol"])){var O=E.childNodes;
while(O.length>0){var R=O[0];
W.insertBefore(R,E)
}W.removeChild(E)
}else{if(!F.isTag(E,"li")){X.changeContainerTag(u,[E],P,false)
}}}j=N.length
}if(j==1){q=F.isTag(N[0],M);
if(!q){return this.insertAsSingleLine(u,I,N[0])
}}var g=F.getTagInPath(u,n,["td","th"]);
if(g!=null){this.ensureBlockStructure(u,g)
}N=F.childNodesAsArray(W);
var o=X.getEmptyLine(u,I);
var L=(o!=null)&&!F.isTag(o,["td","th"]);
var S=false;
if(L){C=o;
a=false;
S=true
}if((o!=null)&&!L){F.removeAllChildren(o);
C=o;
D=true;
S=true
}var Y=null;
for(r=0;
r<j;
r++){var d=N[r];
q=F.isTag(d,M)||S;
var b=(r==(j-1));
var H,A,Q,t;
var Z=false;
if((r==0)&&!q){H=this.insertInExistingNode(u,I,d);
Q=H.startNode;
t=H.startOffset;
A=this.splitExistingNode(u,Q,t);
C=A.insertPoint;
a=A.insertBehind
}else{if((r==0)&&q){if(!D){A=this.splitExistingNode(u,I.startNode,I.startOffset);
C=A.insertPoint;
a=A.insertBehind
}Z=true
}else{if(b&&!q&&!L){if(a){if(C.nextSibling){Q=F.getFirstTextChild(C.nextSibling,true)
}else{Q=null;
Z=true
}}else{Q=F.getFirstTextChild(C,true)
}if(Q!=null){t=U.getFirstSelectionOffset(Q);
H={startNode:Q,startOffset:t};
H=this.insertInExistingNode(u,H,d);
Y=H
}}else{Z=true
}}}if(Z){if(a){F.insertBefore(C.parentNode,d,C.nextSibling);
C=d
}else{if(D){C.appendChild(d)
}else{F.insertBefore(C.parentNode,d,C)
}}if(CQ.Ext.isIE){X.fixEmptyEditingBlockIE(u,d)
}else{if(CQ.Ext.isGecko){var V=F.getCharacterNodes(d);
if(V==0){var T=X.createEmptyLinePlaceholder(u,false);
if(T){var k=F.getFirstChild(d);
if(k==null){k=d
}k.appendChild(T)
}}}}if(b){Y={startNode:d,startOffset:null}
}}}if(L){o.parentNode.removeChild(o)
}return Y
},pasteAsWordHtml:function(D){var B=CQ.form.rte.Selection;
var C=CQ.form.rte.Common;
var A=D.editContext;
var G=D.value.dom;
this.cleanUpDom(A,D.component,G,D.value.pasteRules);
var K;
var F=C.containsTag(G,"table");
var E=D.nodeList;
var J=C.containsTagInPath(A,E.commonAncestor,"table");
if(J&&F){try{this.pasteTableToTable(D)
}catch(I){if(I.message!="Invalid paste structure."){throw I
}}}else{K=this.insertHtml(D)
}var H;
if(K){H=B.bookmarkFromProcessingSelection(A,K)
}else{H=B.createSelectionBookmark(A)
}D.bookmark=H
},isCommand:function(A){if(A.toLowerCase()=="paste"){return true
}},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK
},execute:function(E){var H=CQ.form.rte.Common;
var N=CQ.form.rte.Selection;
var A=CQ.form.rte.DomProcessor;
var J=CQ.form.rte.commands.Paste;
var F=E.editContext;
var M=E.value;
var K=M.mode;
var D=M.pasteRange;
if(K==J.MODE_BROWSER){try{F.doc.execCommand("paste",false,null)
}catch(O){throw new Error("Cannot paste.")
}return 
}try{E.component.selectQualifiedRangeBookmark(F,D);
var R=N.getSelection(F);
var B=(CQ.Ext.isIE?N.isCollapsed(D.bookmark):R.isCollapsed)&&!D.cells;
if(!B){var L=E.component.createQualifiedSelection(F);
var G=(L.cellSelection?L.cellSelection.cells:undefined);
if(!G||G.length==0){F.doc.execCommand("delete",false,null)
}else{for(var P=0;
P<G.length;
P++){var C=G[P];
H.removeAllChildren(C);
A.ensureEmptyLinePlaceholders(F,C)
}}}E.selection=E.component.createQualifiedSelection(F);
E.nodeList=A.createNodeList(F,E.selection);
var Q;
switch(K){case J.MODE_PLAINTEXT:Q=this.pasteAsPlainText(E);
break;
case J.MODE_WORDHTML:Q=this.pasteAsWordHtml(E);
break;
default:throw new Error("Invalid paste mode: "+K);
break
}var I=E.bookmark;
if(Q){I=N.bookmarkFromProcessingSelection(F,Q)
}E.bookmark=I;
return{calleeRet:{bookmark:I,geckoEnsureCaretVisibility:true}}
}catch(O){try{console.log(O)
}catch(O){}}return{calleeRet:{bookmark:E.bookmark,geckoEnsureCaretVisibility:true}}
}});
CQ.form.rte.commands.Paste.MODE_BROWSER="browser";
CQ.form.rte.commands.Paste.MODE_PLAINTEXT="plaintext";
CQ.form.rte.commands.Paste.MODE_WORDHTML="wordhtml";
CQ.form.rte.commands.Paste.ATOMIC_PROCESSING_BLOCKS=["table","ul","ol"];
CQ.form.rte.commands.CommandRegistry.register("paste",CQ.form.rte.commands.Paste);
CQ.form.rte.commands.Style=CQ.Ext.extend(CQ.form.rte.commands.Command,{addStyle:function(H){var G=CQ.form.rte.Selection;
var B=CQ.form.rte.Common;
var D=H.value;
var E=H.selection;
var F=G.getSelectedDom(E);
var A=CQ.form.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS;
if(F&&B.isTag(F,A)){B.removeAllClasses(F);
B.addClass(F,D);
return 
}var C=H.nodeList;
if(C){C.surround(H.editContext,"span",{className:D})
}},removeStyle:function(B){var E=CQ.form.rte.Common;
var A=CQ.form.rte.DomProcessor;
var P=CQ.form.rte.Selection;
var U=B.selection;
var C=B.editContext;
var S=B.value;
var D,N,J;
var H=P.getSelectedDom(U);
var O=CQ.form.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS;
if(H&&E.isTag(H,O)){if(S&&!S.styles){E.removeClass(H,S)
}else{if(S&&S.styles){N=S.styles.length;
for(J=0;
J<N;
J++){D=S.styles[J];
if((typeof (D)=="object")&&D.cssName){D=D.cssName
}if(E.hasCSS(H,D)){E.removeClass(H,D)
}}}else{E.removeAllClasses(H)
}}return 
}var T=B.nodeList;
var Q=T.getTags(C,[{matcher:function(V){return E.isTag(V,"span")
}}],true);
var G=[];
var M=Q.length;
for(var K=0;
K<M;
K++){var F=Q[K].dom;
if(S&&!S.styles){if(E.hasCSS(F,S)){G.push(F)
}}else{if(S&&S.styles){N=S.styles.length;
for(J=0;
J<N;
J++){D=S.styles[J].cssName;
if(E.hasCSS(F,D)){G.push(F);
break
}}}else{if(F.className){G.push(F)
}}}}var R=G.length;
for(var L=0;
L<R;
L++){var I=G[L];
A.removeWithoutChildren(I)
}},isCommand:function(B){var A=B.toLowerCase();
return(A=="applystyle")||(A=="removestyle")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION|A.PO_NODELIST
},execute:function(A){switch(A.command.toLowerCase()){case"applystyle":this.addStyle(A);
break;
case"removestyle":this.removeStyle(A);
break
}},queryState:function(A,B){return false
}});
CQ.form.rte.commands.CommandRegistry.register("style",CQ.form.rte.commands.Style);
CQ.form.rte.commands.Table=CQ.Ext.extend(CQ.form.rte.commands.Command,{getTable:function(C){var A=CQ.form.rte.Common;
var B=C.editContext;
return A.getTagInPath(B,C.nodeList.commonAncestor,"table")
},createEmptyCell:function(B,A){return CQ.form.rte.TableMatrix.createEmptyCell(B.editContext,A)
},transferConfigToTable:function(F,B){var A=CQ.form.rte.Common;
var D=CQ.form.rte.commands.Table.CONFIG_NONE;
if(B.cellpadding){A.setAttribute(F,"cellpadding",B.cellpadding)
}else{A.removeAttribute(F,"cellpadding")
}if(B.cellspacing){A.setAttribute(F,"cellspacing",B.cellspacing)
}else{A.removeAttribute(F,"cellspacing")
}if(B.border){F.border=B.border;
if(B.border==0){A.addClass(F,CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}else{A.removeClass(F,CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}}else{A.removeAttribute(F,"border");
A.addClass(F,CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}if(B.width){A.setAttribute(F,"width",B.width)
}else{A.removeAttribute(F,"width")
}if(B.height){A.setAttribute(F,"height",B.height)
}else{A.removeAttribute(F,"height")
}var E=A.parseCSS(F);
for(var C=0;
C<E.length;
C++){if(E[C]!=CQ.themes.RichText.TABLE_NOBORDER_CLASS){A.removeClass(F,E[C])
}}if(B.tableStyle&&(B.tableStyle!=D)){A.addClass(F,B.tableStyle)
}},createTable:function(K){var A=CQ.form.rte.DomProcessor;
var V=CQ.form.rte.Selection;
var M=CQ.form.rte.Common;
var L=K.editContext;
var b=K.selection;
var N=b.startNode;
var Z=b.startOffset;
var c=A.getScopedBlockNode(L,N);
if(!c){return 
}var G=c.isAuxiliaryRoot;
c=c.dom;
var H=false;
var Y=null;
if(A.isEmptyLineBlock(c)&&!G){Y=c;
N=c
}else{if(M.isTag(c,M.TABLE_CELLS)){N=c;
H=true;
M.removeAllChildren(N)
}else{if(A.isBlockStart(L,N,Z)){N=c
}else{if(A.isBlockEnd(L,N,Z)){N=c.nextSibling
}else{N=A.insertParagraph(L,N,Z);
if(!N){return 
}}}}}var a=K.value;
var S;
var Q=null;
var D=null;
if(a.html){D=L.createElement("span");
D.innerHTML=a.html;
S=D
}else{Q=L.createElement("table");
S=Q
}if(!H){N.parentNode.insertBefore(S,N)
}else{N.appendChild(S)
}if(Y){Y.parentNode.removeChild(Y)
}if(a.html){var P=CQ.Ext.DomQuery.select("table",D);
for(var U=0;
U<P.length;
U++){if(P[U].border==0){M.addClass(P[U],CQ.themes.RichText.TABLE_NOBORDER_CLASS)
}}A.removeWithoutChildren(D);
return 
}var F=a.header;
var R=(F.indexOf("top")>=0);
var T=(F.indexOf("left")>=0);
this.transferConfigToTable(Q,a);
var B=L.createElement("tbody");
Q.appendChild(B);
var J=null;
for(var X=0;
X<a.rows;
X++){var C=L.createElement("tr");
B.appendChild(C);
for(var W=0;
W<a.columns;
W++){var I="td";
if(((X==0)&&R)||((W==0)&&T)){I="th"
}var E=L.createElement(I);
if(!J){J=E
}C.appendChild(E);
var O=A.createEmptyLinePlaceholder(L);
if(O){E.appendChild(O)
}}}K.bookmark=V.bookmarkFromProcessingSelection(L,{startNode:J,startOffset:0})
},modifyTable:function(D){var C=CQ.form.rte.Selection;
var B=this.getTable(D);
var A=D.value;
if(B&&A){this.transferConfigToTable(B,A)
}if(CQ.Ext.isGecko){C.flushSelection(D.editContext)
}else{D.bookmark=null
}},removeTable:function(D){var B=CQ.form.rte.Selection;
var C=CQ.form.rte.Common;
var H=CQ.form.rte.DomProcessor;
var A=D.editContext;
var I=this.getTable(D);
if(I){var G=B.bookmarkFromProcessingSelection(A,{startNode:I,startOffset:0});
var E=I.parentNode;
E.removeChild(I);
var F=C.getTagInPath(A,E,["td","th"]);
if(F){H.ensureEmptyLinePlaceholders(A,F)
}if((E==A.root)&&(E.childNodes.length==0)){A.root.appendChild(H.createEmptyLinePlaceholder(A,true))
}B.flushSelection(A);
D.bookmark=G
}},getTableBody:function(D){var A=CQ.form.rte.Common;
var B=this.getTable(D);
var C=A.getChildNodesByType(B,"tr",true);
if(C.length>0){B=C[0].parentNode
}return B
},getSelectedRows:function(C){var A=CQ.form.rte.Common;
var B=C.editContext;
return C.nodeList.getTags(B,[{matcher:function(D){return A.isTag(D,"tr")
}}],true,true)
},getEntireRowForCell:function(B,I){var F=this.getTable(B);
var C=new CQ.form.rte.TableMatrix();
C.createTableMatrix(F);
var D=C.getCellDef(I);
var E=D.row;
var A=[];
if(D){var J=C.getRow(E);
if(J){for(var H=0;
H<J.length;
H++){var G=J[H];
if(G.row==E){A.push(G.cellDom)
}}}}return A
},getEntireColumnForCell:function(A,J){var F=this.getTable(A);
var D=new CQ.form.rte.TableMatrix();
D.createTableMatrix(F);
var E=D.getCellDef(J);
var I=E.col;
var B=[];
if(E){var C=D.getColumn(I);
if(C){for(var H=0;
H<C.length;
H++){var G=C[H];
if(G.col==I){B.push(G.cellDom)
}}}}return B
},insertRow:function(D,F,Q){var P=CQ.form.rte.Selection;
var E=D.editContext;
var L=this.getSelectedRows(D);
if(L.length==1){if(!Q){Q="default"
}var G=this.getSelectedCells(D);
var J=this.getTable(D);
var O=new CQ.form.rte.TableMatrix();
O.createTableMatrix(J);
var R=O.getCellDef(G[0].dom);
var C=(F?R.row:R.row+R.rowSpan-1);
var M=O.getRow(C);
var I=E.createElement("tr");
var K=O.getRowDom(C);
var A=(F?K:K.nextSibling);
K.parentNode.insertBefore(I,A);
var U;
for(var S=0;
S<M.length;
S++){var B=M[S];
var H=B.cellDom;
var N=this.createEmptyCell(D,H);
if(H.colSpan>1){N.colSpan=H.colSpan
}if(Q=="default"){if(B==R){U=N
}}else{if(Q=="firstCell"){if(S==0){U=N
}}}if(B.rowSpan==1){I.appendChild(N)
}else{var T=(F?(B.row!=R.row):((B.row+B.rowSpan-1)>C));
if(!T){I.appendChild(N)
}else{if(Q=="default"){if(B==R){U=H
}}else{if(Q=="firstCell"){if(S==0){U=H
}}}H.rowSpan++
}}}P.flushSelection(E);
if(U){D.bookmark=P.bookmarkFromProcessingSelection(E,{startNode:U,startOffset:null})
}else{D.bookmark=null
}}},removeRow:function(B){var N=CQ.form.rte.Selection;
var A=CQ.form.rte.DomProcessor;
var C=B.editContext;
var P=this.getTable(B);
var I=this.getSelectedRows(B);
if(I.length==1){var J=new CQ.form.rte.TableMatrix();
J.createTableMatrix(P);
var O=J.getTableSize();
if(O.rows==1){this.removeTable(B);
return 
}var D=this.getSelectedCells(B);
var R=J.getCellDef(D[0].dom);
var M=J.getRow(R.row);
var S;
if(R.rowSpan>1){S=R.cellDom
}else{if(R.row<(O.rows-1)){S=J.getCellForCoords(R.col,R.row+1)
}else{S=J.getCellForCoords(R.col,R.row-1)
}if(S){S=S.cellDom
}else{S=P
}}var E;
for(var Q=0;
Q<M.length;
Q++){var G=M[Q];
E=G.cellDom;
if(G.rowSpan==1){E.parentNode.removeChild(E)
}else{if(G.row==R.row){while(E.childNodes.length>0){E.removeChild(E.childNodes[0])
}E.appendChild(C.createTextNode(A.NBSP));
E.parentNode.removeChild(E);
var L=J.getRowCellForCoords(Q,R.row+1);
var K=(L?L.cellDom:null);
var H=(K?K.parentNode:J.getRowDom(R.row+1));
H.insertBefore(E,K)
}E.rowSpan--
}}var F=I[0].dom;
F.parentNode.removeChild(F);
N.flushSelection(C);
if(S){B.bookmark=N.bookmarkFromProcessingSelection(C,{startNode:S,startOffset:null})
}else{B.bookmark=null
}}},getSelectedCells:function(F){var C=F.editContext;
var D=F.selection.cellSelection;
if(D){var E=[];
for(var H=0;
H<D.cells.length;
H++){E.push({dom:D.cells[H]})
}return E
}var B=F.nodeList;
var A=CQ.form.rte.Common;
var G=false;
return B.getTags(C,[{matcher:function(I){if(G){return false
}if(A.isTag(I,["td","th"])){G=true;
return true
}return false
}}],true,true)
},insertCol:function(F,L){var D=CQ.form.rte.Selection;
var C=F.editContext;
var P=this.getSelectedCells(F);
if(P.length==1){var K=this.getTable(F);
var I=new CQ.form.rte.TableMatrix();
I.createTableMatrix(K);
var E=I.getCellDef(P[0].dom);
var N=(L?E.col:E.col+E.colSpan-1);
var Q=I.getColumn(N);
var H;
for(var B=0;
B<Q.length;
B++){var O=Q[B];
var M=O.cellDom;
var J=this.createEmptyCell(F,M);
if(M.rowSpan>1){J.rowSpan=M.rowSpan
}var A=(L?M:M.nextSibling);
if(O==E){H=J
}if(O.colSpan==1){M.parentNode.insertBefore(J,A)
}else{var G=(L?(O.col!=E.col):((O.col+O.colSpan-1)>N));
if(!G){M.parentNode.insertBefore(J,A)
}else{if(O==E){H=M
}M.colSpan++
}}}D.flushSelection(C);
if(H){F.bookmark=D.bookmarkFromProcessingSelection(C,{startNode:H,startOffset:null})
}else{F.bookmark=null
}}},removeCol:function(E){var C=CQ.form.rte.Selection;
var K=CQ.form.rte.DomProcessor;
var B=E.editContext;
var M=this.getTable(E);
var N=this.getSelectedCells(E);
if(N.length==1){var G=new CQ.form.rte.TableMatrix();
G.createTableMatrix(M);
var J=G.getTableSize();
if(J.cols==1){this.removeTable(E);
return 
}var H=G.getCellDef(N[0].dom);
var D=G.getColumn(H.col);
var F;
if(H.colSpan>1){F=H.cellDom
}else{F=G.getFollowUpCell(H.col,H.row);
if(!F&&(H.col>0)){F=G.getCellForCoords(H.col-1,H.row)
}if(F){F=F.cellDom
}else{F=M
}}var I;
for(var A=0;
A<D.length;
A++){var L=D[A];
I=L.cellDom;
if(L.colSpan==1){I.parentNode.removeChild(I)
}else{if(L.col==H.col){while(I.childNodes.length>0){I.removeChild(I.childNodes[0])
}I.appendChild(B.createTextNode(K.NBSP))
}I.colSpan--
}}C.flushSelection(B);
if(F){E.bookmark=C.bookmarkFromProcessingSelection(B,{startNode:F,startOffset:null})
}else{E.bookmark=null
}}},transferConfigToCell:function(D,F,C){var B=CQ.form.rte.Common;
var E=CQ.form.rte.commands.Table.CONFIG_NONE;
if(C.cellType&&(C.cellType!=E)){if(!B.isTag(F,C.cellType)){var A=D.createElement(C.cellType);
B.copyAttributes(F,A);
B.replaceNode(F,A);
F=A
}}if(C.width){B.setAttribute(F,"width",C.width)
}else{B.removeAttribute(F,"width",C.height)
}if(C.height){B.setAttribute(F,"height",C.height)
}else{B.removeAttribute(F,"height")
}if(C.align){if(C.align!=E){F.style.textAlign=C.align
}else{F.style.textAlign=""
}}if(C.valign){if(C.valign!=E){B.setAttribute(F,"valign",C.valign)
}else{B.removeAttribute(F,"valign")
}}if(CQ.Ext.isIE){F.removeAttribute("className")
}else{F.removeAttribute("class")
}if(C.cellStyle&&(C.cellStyle!=E)){B.addClass(F,C.cellStyle)
}},modifyCell:function(H){var G=CQ.form.rte.Selection;
var D=H.editContext;
var A=this.getSelectedCells(H);
if(A.length!=1){return 
}A=A[0].dom;
var B=H.value;
if(A&&B){var F=B._applyTo;
var E;
switch(F){case"cell":E=[A];
break;
case"row":E=this.getEntireRowForCell(H,A);
break;
case"column":E=this.getEntireColumnForCell(H,A);
break
}for(var C=0;
C<E.length;
C++){this.transferConfigToCell(D,E[C],B)
}}if(CQ.Ext.isGecko){G.flushSelection(D)
}else{H.bookmark=null
}},mergeCells:function(D){var C=CQ.form.rte.Selection;
var A=D.editContext;
var K=D.value.selectionProps;
var F=(K?K.anchorCell:null);
if(F){var L=F.cellDom;
var G=K.cols;
var J=K.rows;
var M=D.value.cells;
var N=[];
for(var I=0;
I<M.length;
I++){var H=M[I].cellDom;
if(H!=L){N.push(A.createTextNode(" "));
var B=H.childNodes;
for(var E=0;
E<B.length;
E++){N.push(B[E])
}H.parentNode.removeChild(H)
}}if(G>1){L.setAttribute("colSpan",G)
}else{L.removeAttribute("colSpan")
}if(J>1){L.setAttribute("rowSpan",J)
}else{L.removeAttribute("rowSpan")
}for(E=0;
E<N.length;
E++){L.appendChild(N[E])
}C.flushSelection(A);
D.bookmark=C.bookmarkFromProcessingSelection(A,{startNode:L,startOffset:null})
}},splitCellHorizontally:function(D){var B=CQ.form.rte.Selection;
var A=D.editContext;
var K=this.getTable(D);
var L=this.getSelectedCells(D);
if(K&&L.length==1){var J=L[0].dom;
var G=this.createEmptyCell(D);
if(J.rowSpan&&J.rowSpan>1){G.rowSpan=J.rowSpan
}if(J.colSpan&&J.colSpan>1){J.colSpan=J.colSpan-1;
J.parentNode.insertBefore(G,J.nextSibling)
}else{var E=new CQ.form.rte.TableMatrix();
E.createTableMatrix(K);
E.createFullMatrix();
var F=E.getCellDef(J);
var C=E.getColumn(F.col);
J.parentNode.insertBefore(G,J.nextSibling);
for(var I=0;
I<C.length;
I++){if(C[I]!=F){var H=C[I].cellDom.colSpan;
H=H||1;
C[I].cellDom.colSpan=++H
}}}B.flushSelection(A);
D.bookmark=B.bookmarkFromProcessingSelection(A,{startNode:G,startOffset:null})
}},splitCellVertically:function(B){var N=CQ.form.rte.Selection;
var C=B.editContext;
var P=this.getTable(B);
var F=this.getSelectedCells(B);
if(P&&F.length==1){var A=F[0].dom;
var I=this.createEmptyCell(B);
if(A.colSpan&&A.colSpan>1){I.colSpan=A.colSpan
}var K=new CQ.form.rte.TableMatrix();
K.createTableMatrix(P);
K.createFullMatrix();
var R=K.getCellDef(A);
if(A.rowSpan&&A.rowSpan>1){var J=R.row+R.rowSpan-1;
var M=K.getRowCellForCoords(R.col+1,J);
var L=(M?M.cellDom:null);
var H=(L?L.parentNode:K.getRowDom(J));
H.insertBefore(I,L);
A.rowSpan=A.rowSpan-1
}else{var G=K.getRow(R.row);
var O=A.parentNode;
var D=C.createElement("tr");
D.appendChild(I);
O.parentNode.insertBefore(D,O.nextSibling);
for(var Q=0;
Q<G.length;
Q++){if(G[Q]!=R){var E=G[Q].cellDom.rowSpan;
E=E||1;
G[Q].cellDom.rowSpan=++E
}}}N.flushSelection(C);
B.bookmark=N.bookmarkFromProcessingSelection(C,{startNode:I,startOffset:null})
}},ensureParagraph:function(D,I){var J=CQ.form.rte.DomProcessor;
var C=CQ.form.rte.Common;
var B=CQ.form.rte.Selection;
var A=D.editContext;
var F=null;
var G=this.getTable(D);
if(!G){return 
}var E=G.parentNode;
if(!C.isRootNode(A,E)){return 
}if(I){F=G
}else{F=G.nextSibling
}var H=J.createEmptyLinePlaceholder(A,true);
E.insertBefore(H,F);
J.fixEmptyEditingBlockIE(A,H);
B.flushSelection(A);
D.bookmark=B.bookmarkFromProcessingSelection(A,{startNode:H,startOffset:0})
},isCommand:function(C){var A=CQ.form.rte.Common;
var B=C.toLowerCase();
return A.strEndsWith(B,"table")||A.strEndsWith(B,"column")||A.strEndsWith(B,"row")||A.strEndsWith(B,"cell")||A.strEndsWith(B,"cells")||B=="ensureparagraph"
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION|A.PO_NODELIST
},execute:function(C){var B=undefined;
var A;
switch(C.command.toLowerCase()){case"createtable":this.createTable(C);
break;
case"modifytable":this.modifyTable(C);
break;
case"removetable":this.removeTable(C);
break;
case"insertrow":var D="default";
if(typeof (C.value)=="string"){A=C.value
}else{A=C.value.position;
D=C.value.caret
}this.insertRow(C,!A||(A=="before"),D);
B={calleeRet:{geckoEnsureCaretVisibility:true}};
break;
case"removerow":this.removeRow(C);
break;
case"insertcolumn":A=C.value;
this.insertCol(C,!A||(A=="before"));
break;
case"removecolumn":this.removeCol(C);
break;
case"modifycell":this.modifyCell(C);
break;
case"mergecells":this.mergeCells(C);
break;
case"splitcell":if(C.value=="horizontal"){this.splitCellHorizontally(C)
}else{if(C.value=="vertical"){this.splitCellVertically(C)
}}break;
case"ensureparagraph":A=C.value;
this.ensureParagraph(C,!A||(A=="before"));
B={calleeRet:{geckoEnsureCaretVisibility:true}};
break
}return B
},queryState:function(B,D){var A=CQ.form.rte.Common;
var C=B.editContext;
if(D=="table"){return A.getTagInPath(C,B.nodeList.commonAncestor,"table")
}else{if(D=="modifycell"){return CQ.form.rte.commands.Table.getCellFromNodeList(C,B.nodeList)
}}return false
}});
CQ.form.rte.commands.Table.getCellFromSelection=function(C,E){var B=CQ.form.rte.Common;
if(E.cellSelection&&E.cellSelection.cells){if(E.cellSelection.cells.length==1){return E.cellSelection.cells[0]
}return null
}var A=B.getTagInPath(C,E.startNode,B.TABLE_CELLS);
if(A&&E.endNode){var D=B.getTagInPath(C,E.endNode,B.TABLE_CELLS);
if(D!=A){A=null
}}return A
};
CQ.form.rte.commands.Table.getCellFromNodeList=function(D,C){var B=CQ.form.rte.Common;
var A=B.getTagInPath(D,C.commonAncestor,B.TABLE_CELLS);
if(A==null){if(C.nodes.length==1){var E=C.nodes[0].dom;
if(B.isTag(E,B.TABLE_CELLS)){A=E
}}}return A
};
CQ.form.rte.commands.Table.CONFIG_NONE=new Object();
CQ.form.rte.commands.CommandRegistry.register("table",CQ.form.rte.commands.Table);
CQ.form.rte.commands.Image=CQ.Ext.extend(CQ.form.rte.commands.Command,{createImage:function(F){var E=F.value;
var B=null;
if(E.path){B=CQ.HTTP.externalize(E.path)
}var G=(E.alt?E.alt:"");
var D=(E.width?E.width:null);
var A=(E.height?E.height:null);
if(B){var C='<img src="'+B+'" alt="'+G+'"';
C+=" "+CQ.form.rte.Common.SRC_ATTRIB+'="'+B+'"';
if(D){C+=' width="'+D+'"'
}if(A){C+=' height="'+A+'"'
}C+=">";
F.component.execCmd("inserthtml",C)
}},applyProperties:function(H){var D=H.value;
var A=CQ.form.rte.Common;
var C=H.selection;
if(C.startNode&&(C.startOffset==undefined)&&!C.endNode){var F=C.startNode;
if(!A.isTag(F,"img")){return 
}var E="style.";
for(var G in D){if(D.hasOwnProperty(G)){if(A.strStartsWith(G,E)){var B=G.substring(E.length,G.length);
if(B=="float"){if(CQ.Ext.isIE){B="styleFloat"
}else{B="cssFloat"
}}F.style[B]=D[G]
}else{F.setAttribute(G,D[G])
}}}if(CQ.Ext.isGecko){CQ.form.rte.Selection.flushSelection(H.editContext)
}}},isCommand:function(A){return(A.toLowerCase()=="insertimg")
},getProcessingOptions:function(){var A=CQ.form.rte.commands.Command;
return A.PO_BOOKMARK|A.PO_SELECTION
},execute:function(A){switch(A.command.toLowerCase()){case"insertimg":this.createImage(A);
break;
case"image":this.applyProperties(A);
break
}},queryState:function(B,E){var A=CQ.form.rte.Common;
if(E.toLowerCase()=="image"){var C=B.selection;
if(C.startNode&&(C.startOffset==undefined)&&!C.endNode){var D=C.startNode;
return A.isTag(D,"img")
}}return false
}});
CQ.form.rte.commands.CommandRegistry.register("image",CQ.form.rte.commands.Image);
CQ.form.rte.commands.UndoRedo=CQ.Ext.extend(CQ.form.rte.commands.Command,{undoManager:null,constructor:function(){this.undoManager=new CQ.form.rte.UndoManager(50)
},isCommand:function(B){var A=B.toLowerCase();
return(A=="undo")||(A=="redo")||(A=="undoconfig")||(A=="initializeundo")||(A=="addundostep")||(A=="clearredohistory")
},isUndoable:function(A){return false
},requiresInitializedComponent:function(A){return(A!="undoconfig")
},getProcessingOptions:function(){return CQ.form.rte.commands.Command.PO_NONE
},execute:function(C){var B=C.command.toLowerCase();
var A=C.editContext;
switch(B){case"undo":this.undoManager.undo(A);
break;
case"redo":this.undoManager.redo(A);
break;
case"undoconfig":if(C.value.maxUndoSteps!=undefined){this.undoManager.maxUndoSteps=C.value.maxUndoSteps
}break;
case"initializeundo":this.undoManager.initialize(A);
break;
case"addundostep":this.undoManager.addStep(new CQ.form.rte.UndoManager.Step(A));
break;
case"clearredohistory":this.undoManager.clearRedoHistory();
break
}},queryState:function(A,D){var B=D.toLowerCase();
var C=false;
switch(B){case"undo":C=this.undoManager.canUndo();
break;
case"redo":C=this.undoManager.canRedo();
break
}return C
}});
CQ.form.rte.commands.CommandRegistry.register("undoredo",CQ.form.rte.commands.UndoRedo);
CQ.form.rte.ui.ToolbarBuilder=CQ.Ext.extend(CQ.Ext.emptyFn,{groups:null,constructor:function(){this.groups=[]
},insertInArray:function(E,C){var B=C.sort;
var D=E.length;
for(var A=0;
A<D;
A++){if(E[A].sort&&E[A].sort>B){E.splice(A,0,C);
return 
}}E.push(C)
},getGroupById:function(C){var A=this.groups.length;
for(var B=0;
B<A;
B++){if(this.groups[B].id==C){return this.groups[B]
}}},addElement:function(D,A,C,B){var E=this.getGroupById(D);
if(!E){E={id:D,sort:A,elements:[]};
this.insertInArray(this.groups,E)
}this.insertInArray(E.elements,{sort:B,def:C})
},createToolbar:function(B,A){return null
}});
CQ.form.rte.ui.ToolbarBuilder.MAIN_TOOLBAR=0;
CQ.form.rte.ui.ToolbarBuilder.STYLE_TOOLBAR=1;
CQ.form.rte.ui.IFrameToolbarBuilder=CQ.Ext.extend(CQ.form.rte.ui.ToolbarBuilder,{createToolbar:function(N){var E=new CQ.WrappingToolbar({renderTo:N.renderToDom});
E.el.on("click",function(O){O.preventDefault()
});
var L=[E];
var D=this.groups.length;
var A=[];
for(var K=0;
K<D;
K++){var J=this.groups[K].elements;
var B=J.length;
for(var C=0;
C<B;
C++){var F=J[C].def;
var H=F.getToolbar();
var I=null;
if(H<L.length){I=L[H]
}if(!I){I=new CQ.WrappingToolbar({renderTo:N.renderToDom});
L[H]=I
}if((C==0)&&A[H]){I.add("-")
}else{A[H]=true
}F.addToToolbar(I)
}}var G=L.length;
for(var M=0;
M<G;
M++){if(L[M]){L[M].doLayout()
}}return L
}});
CQ.form.rte.ui.GlobalToolbarBuilder=CQ.Ext.extend(CQ.form.rte.ui.ToolbarBuilder,{createToolbar:function(N){var G=[];
var J=[];
var E=this.groups.length;
var A=false;
for(var M=0;
M<E;
M++){var L=this.groups[M].elements;
var C=L.length;
for(var D=0;
D<C;
D++){var F=L[D].def;
if((D==0)&&A){G.push("-");
A=false
}var I=F.createToolbarDef();
if(I!=null){G.push(I);
J.push(F);
A=true
}}}var K=new (CQ.WCM.getTopWindow()).CQ.Ext.Toolbar({items:G,cls:"x-html-editor-tb"});
CQ.WCM.loadToolbar(K);
var H=J.length;
for(var B=0;
B<H;
B++){J[B].notifyToolbar(K)
}return K
}});
CQ.form.rte.ui.TbElement=CQ.Ext.extend(CQ.Ext.emptyFn,{id:null,plugin:null,toggle:null,tooltip:null,toolbar:null,constructor:function(F,C,A,E,B,D){this.id=F;
this.plugin=C;
this.toggle=A;
this.css=(B?B:"x-edit-"+F);
this.cmdDef=D;
if(E&&CQ.Ext.QuickTips&&CQ.Ext.QuickTips.isEnabled()){this.tooltip=E;
this.tooltip.cls="x-html-editor-tip"
}else{this.tooltip=null
}},getToolbar:function(){return CQ.form.rte.ui.ToolbarBuilder.MAIN_TOOLBAR
},addToToolbar:function(A){this.notifyToolbar(A);
A.add(this.createToolbarDef())
},createToolbarDef:function(){return{itemId:this.id,cls:"x-btn-icon",iconCls:this.css,enableToggle:(this.toggle!==false),scope:this,handler:function(){var C=this.plugin.editorKernel.getEditContext();
var B=(this.cmdDef?this.cmdDef.cmd:this.id);
var D=(this.cmdDef?this.cmdDef.cmdValue:undefined);
var A={editContext:C};
this.plugin.execute(B,D,A)
},clickEvent:"mousedown",tooltip:this.tooltip,tabIndex:-1}
},notifyToolbar:function(A){this.toolbar=A
},getExtUI:function(){return this.toolbar.items.map[this.id]
}});
CQ.form.rte.ui.TbParaFormatter=CQ.Ext.extend(CQ.form.rte.ui.TbElement,{formatSelector:null,formats:null,constructor:function(D,B,C,A){CQ.form.rte.ui.TbParaFormatter.superclass.constructor.call(this,D,B,false,C);
this.formats=A
},createFormatOptions:function(){var C="";
if(this.formats){var B=this.formats.length;
for(var A=0;
A<B;
A++){var D=this.formats[A].description;
C+='<option value="'+this.formats[A].tag+'">'+D+"</option>"
}}return C
},getToolbar:function(){return CQ.form.rte.ui.ToolbarBuilder.STYLE_TOOLBAR
},addToToolbar:function(B){if(CQ.Ext.isIE){var A=document.createElement("span");
A.innerHTML='<select class="x-font-select">'+this.createFormatOptions()+"</span>";
this.formatSelector=CQ.Ext.get(A.childNodes[0])
}else{this.formatSelector=CQ.Ext.get(CQ.Ext.DomHelper.createDom({tag:"select",cls:"x-font-select",html:this.createFormatOptions()}))
}this.formatSelector.on("change",function(){var C=this.formatSelector.dom.value;
if(C.length>0){this.plugin.execute(this.id)
}},this);
this.formatSelector.on("focus",function(){this.plugin.editorKernel.isTemporaryBlur=true
},this);
this.formatSelector.setHeight(20);
B.add(CQ.I18n.getMessage("Format")," ",this.formatSelector.dom)
},createToolbarDef:function(){return null
},getSelectedFormat:function(){var A=this.formatSelector.dom.value;
if(A.length>0){return A
}return null
},getExtUI:function(){return this.formatSelector
}});
CQ.form.rte.ui.TbStyleSelector=CQ.Ext.extend(CQ.form.rte.ui.TbElement,{styleSelector:null,styles:null,toolbar:null,constructor:function(D,B,C,A){CQ.form.rte.ui.TbStyleSelector.superclass.constructor.call(this,D,B,false,C);
this.styles=A
},createStyleOptions:function(){var D='<option value="">[None]</option>';
if(this.styles){var A=this.styles.length;
for(var C=0;
C<A;
C++){var F=this.styles[C];
var B=F.cssName;
var E=F.text;
D+='<option value="'+B+'" class="'+B+'">'+E+"</option>"
}}return D
},getToolbar:function(){return CQ.form.rte.ui.ToolbarBuilder.STYLE_TOOLBAR
},addToToolbar:function(C){this.toolbar=C;
if(CQ.Ext.isIE){var A=document.createElement("span");
A.innerHTML='<select class="x-font-select">'+this.createStyleOptions()+"</span>";
this.styleSelector=CQ.Ext.get(A.childNodes[0])
}else{this.styleSelector=CQ.Ext.get(CQ.Ext.DomHelper.createDom({tag:"select",cls:"x-font-select",html:this.createStyleOptions()}))
}this.styleSelector.on("change",function(){var D=this.styleSelector.dom.value;
if(D.length>0){this.plugin.execute(this.id)
}},this);
this.styleSelector.on("focus",function(){this.plugin.editorKernel.isTemporaryBlur=true
},this);
this.styleSelector.setHeight(19);
var B={itemId:this.id+"_remove",cls:"x-btn-icon",iconCls:"x-edit-removestyle",enableToggle:(this.toggle!==false),scope:this,handler:function(){this.plugin.execute(this.id+"_remove")
},clickEvent:"mousedown",tabIndex:-1};
C.add(CQ.I18n.getMessage("Style")," ",this.styleSelector.dom,B)
},createToolbarDef:function(){return null
},getSelectedStyle:function(){var A=this.styleSelector.dom.value;
if(A.length>0){return A
}return null
},getExtUI:function(){return this.styleSelector
},getRemoveButtonUI:function(){return this.toolbar.items.map[this.id+"_remove"]
}});
CQ.form.rte.ui.ContextMenuBuilder=CQ.Ext.extend(CQ.Ext.emptyFn,{items:null,menu:null,constructor:function(A){this.items=[];
this.editorKernel=A;
this.menu=new CQ.Ext.menu.Menu()
},addItem:function(A){this.items.push(A)
},clear:function(){this.items.length=0
},build:function(A,C){this.menu.removeAll();
var E=this.items.length;
if(E==0){return null
}for(var B=0;
B<E;
B++){var D=this.items[B];
D.build(this.menu,this.editorKernel,C,A)
}return this.menu
}});
CQ.form.rte.ui.CmItem=CQ.Ext.extend(CQ.Ext.emptyFn,{text:null,iconCls:null,handlerFn:null,selectionContext:null,editContext:null,defaultHandlerFn:null,subItems:null,constructor:function(A){this.subItems=[];
if(A.subItems){var C=A.subItems.length;
for(var B=0;
B<C;
B++){this.subItems.push(new CQ.form.rte.ui.CmItem(A.subItems[B]))
}delete A.subItems
}this.defaultHandlerFn=function(){var D={selectionContext:this.selectionContext,editContext:this.editContext};
if(this.editorKernel.contextMenuSavedRange){D.savedRange=this.editorKernel.contextMenuSavedRange
}this.editorKernel.focus();
this.editorKernel.isEventingDisabled=false;
if(this.plugin&&this.cmd){this.plugin.execute(this.cmd,this.cmdValue,D)
}}.createDelegate(this);
CQ.Ext.apply(this,A)
},build:function(F,G,D,A){this.editorKernel=G;
this.selectionContext=A;
this.editContext=D;
var E=this.subItems.length;
var B=null;
if(E>0){B=new CQ.Ext.menu.Menu()
}F.addItem(new CQ.Ext.menu.Item({text:this.text,menu:B,iconCls:this.iconCls,handler:this.handlerFn?this.handlerFn:this.defaultHandlerFn,disabled:this.disabled===true}));
for(var C=0;
C<E;
C++){this.subItems[C].build(B,G,D,A)
}}});
CQ.form.rte.ui.CmSeparator=CQ.Ext.extend(CQ.Ext.emptyFn,{build:function(A){A.addItem(new CQ.Ext.menu.Separator())
}});
CQ.form.rte.ui.DialogHelper=CQ.Ext.extend(CQ.Ext.emptyFn,{configVersion:null,defaultDialog:null,additionalFields:null,disabledDefaultFields:null,dialogProperties:null,dialogProcessed:null,customDialog:null,editorKernel:null,constructor:function(A,B){if(!A.configVersion){A={configVersion:1,customDialog:A}
}this.editorKernel=B;
CQ.Ext.apply(this,A)
},instantiateDialog:function(A){A.dialogHelper=this;
if(A.xtype){return CQ.Ext.ComponentMgr.create(A)
}if(A._constructor){var B=A._constructor;
delete A._constructor;
return CQ.Ext.ComponentMgr.create(A,B)
}if(A["jcr:primaryType"]&&(A["jcr:primaryType"]!="nt:unstructured")){return CQ.WCM.getDialog(A)
}throw new Error("Invalid customDialog definition; missing xtype or jcr:primaryType")
},createCustomDialog:function(){return this.instantiateDialog(this.customDialog)
},addAdditionalItems:function(I){var A=[];
if(this.additionalFields){var C=this.additionalFields.length;
for(var F=0;
F<C;
F++){var B=this.additionalFields[F];
if(B.item&&B.item.name){var G=false;
if(B.insertBefore){var E=I.length;
for(var D=0;
D<E;
D++){var H=I[D];
if(H.name==B.insertBefore){I.splice(D,0,B.item);
G=true;
break
}}}if(!G){I.push(B.item)
}if(B.validator){B.item.validator=B.validator;
B.item.evaluateValidatorsFirst=true
}A.push({name:B.item.name,fromModel:B.fromModel,toModel:B.toModel})
}}}return A
},removeDisabledItems:function(C){var A=CQ.form.rte.Common;
if(this.disabledDefaultFields){var E=C.length;
for(var B=E-1;
B>=0;
B--){var D=C[B];
if(A.arrayContains(this.disabledDefaultFields,D.name)){C.splice(B,1)
}}}},createExtensibleDialog:function(){var A=CQ.form.rte.Common;
if(!this.defaultDialog){throw new Error("Invalid dialogConfig; missing property defaultDialog")
}if(this.defaultDialog.dialogClass){var B=CQ.Util.copyObject(this.defaultDialog.dialogClass);
if(this.defaultDialog.dialogProperties){A.objectMerge(B,this.defaultDialog.dialogProperties)
}if(this.dialogProperties){A.objectMerge(B,this.dialogProperties)
}if(this.parameters){B.parameters=this.parameters
}return this.instantiateDialog(B)
}else{if(this.defaultDialog.items){return null
}else{throw new Error("Invalid dialogConfig; missing property defaultDialog.items or defaultDialog.dialogClass.")
}}},create:function(){if(this.customDialog){this.dialogProcessed=this.createCustomDialog();
return this.dialogProcessed
}this.dialogProcessed=this.createExtensibleDialog();
return this.dialogProcessed
},calculateInitialPosition:function(A){if(this.dialogProcessed){this.dialogProcessed.setPosition(this.editorKernel.calculateWindowPosition(A))
}}});
CQ.form.rte.ui.BaseWindow=CQ.Ext.extend(CQ.Ext.Window,{dialogHelper:null,parameters:null,objToEdit:null,applyFn:null,dialogItems:null,form:null,additionalFields:null,constructor:function(B){B=B||{};
if(!B.dialogItems){throw new Error("No dialogItems specified.")
}var C=B.dialogItems;
delete B.dialogItems;
this.dialogHelper=B.dialogHelper;
delete B.dialogHelper;
this.dialogHelper.removeDisabledItems(C);
this.additionalFields=this.dialogHelper.addAdditionalItems(C);
var A=this;
var D={renderTo:CQ.Util.ROOT_ID,modal:true,layout:"fit",stateful:false,items:[{xtype:"panel",layout:"fit",bodyStyle:"overflow: auto;",stateful:false,items:[{border:false,xtype:"form",stateful:false,items:C,afterRender:function(){CQ.Ext.form.FormPanel.prototype.afterRender.call(this);
this.body.addClass("cq-rte-basewindow");
A.dialogItems=this.items;
A.form=this.getForm()
}}]}],buttons:[{itemId:"okButton",name:"okButton",text:CQ.I18n.getMessage("OK"),handler:this.apply,disabled:false,scope:this},{itemId:"cancelButton",name:"cancelButton",text:CQ.I18n.getMessage("Cancel"),handler:this.cancel,disabled:false,scope:this}],listeners:{show:function(){this.dialogHelper.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.dialogHelper.editorKernel.fireUIEvent("dialoghide")
},scope:this}};
CQ.Util.applyDefaults(B,D);
CQ.form.rte.ui.BaseWindow.superclass.constructor.call(this,B)
},initializeEdit:function(C,B,A){this.editorKernel=C;
this.editContext=this.editorKernel.getEditContext();
this.objToEdit=B;
this.applyFn=A;
this.fromModel()
},apply:function(){if(this.validate()){this.toModel(this.objToEdit);
this.hide();
if(this.applyFn){this.applyFn(this.editContext,this.objToEdit)
}}},cancel:function(){this.hide()
},preprocessModel:function(){},dlgFromModel:function(){},fromModel:function(){this.preprocessModel();
var A=this.additionalFields.length;
for(var B=0;
B<A;
B++){var D=this.additionalFields[B];
if(D.fromModel){var C=this.getFieldByName(D.name);
if(C){D.fromModel(this.objToEdit,C)
}}}this.dlgFromModel()
},validate:function(){return this.form.isValid()
},dlgToModel:function(){},toModel:function(){this.dlgToModel();
var A=this.additionalFields.length;
for(var B=0;
B<A;
B++){var D=this.additionalFields[B];
if(D.toModel){var C=this.getFieldByName(D.name);
if(C){D.toModel(this.objToEdit,C)
}}}this.postprocessModel()
},postprocessModel:function(){},getFieldByName:function(B){var A=null;
this.dialogItems.each(function(C){if(C.isFormField){if(C.getName()==B){A=C;
return false
}}return true
});
return A
},getParameter:function(A){if(this.parameters&&this.parameters[A]){return this.parameters[A]
}return null
},show:function(C,A,B){CQ.form.rte.ui.BaseWindow.superclass.show.call(this,C,A,B);
(function(){this.toFront();
this.focus()
}).defer(10,this)
}});
CQ.form.rte.plugins.Plugin=CQ.Ext.extend(CQ.Ext.emptyFn,{features:null,editorKernel:null,config:null,isFeatureEnabled:function(B){if(!this.config||!this.config.features){return false
}if(this.config.features==="*"){return true
}var C=this.config.features.length;
for(var D=0;
D<C;
D++){var A=this.config.features[D];
if(A==B){return true
}}return false
},constructor:function(A){this.editorKernel=A
},getFeatures:function(){return[]
},reportStyles:function(){return null
},notifyPluginConfig:function(A){this.config=A
},initializeUI:function(A){},execute:function(A,B,C){},updateState:function(A){},handleContextMenu:function(B,C,A){},manipulateSelection:function(A){},saveRangeBookmark:function(A){},restoreRangeBookmark:function(A){},interceptContent:function(B,A){return null
},getTooltip:function(A){return(this.config.tooltips?this.config.tooltips[A]:null)
}});
CQ.form.rte.plugins.Plugin.SORT_TABLE_TABLEMODE=0;
CQ.form.rte.plugins.Plugin.SORT_EDIT=110;
CQ.form.rte.plugins.Plugin.SORT_UNDO=120;
CQ.form.rte.plugins.Plugin.SORT_FORMAT=130;
CQ.form.rte.plugins.Plugin.SORT_JUSTIFY=140;
CQ.form.rte.plugins.Plugin.SORT_LINKS=150;
CQ.form.rte.plugins.Plugin.SORT_LISTS=160;
CQ.form.rte.plugins.Plugin.SORT_IMAGE=170;
CQ.form.rte.plugins.Plugin.SORT_TABLE=180;
CQ.form.rte.plugins.Plugin.SORT_STYLES=350;
CQ.form.rte.plugins.Plugin.SORT_PARAFORMAT=360;
CQ.form.rte.plugins.Plugin.SORT_SPELLCHECK=370;
CQ.form.rte.plugins.Plugin.SORT_MISC=1000;
CQ.form.rte.plugins.PluginRegistry=function(){var A={};
return{register:function(C,B){A[C]=B
},createRegisteredPlugins:function(D){var C={};
for(var B in A){if(A.hasOwnProperty(B)){C[B]=new A[B](D)
}}return C
}}
}();
CQ.form.rte.plugins.KeyPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{constructor:function(A){CQ.form.rte.plugins.EditToolsPlugin.superclass.constructor.call(this,A);
A.addPluginListener("beforekeydown",this.handleKeyDown,this,this,false);
A.addPluginListener("keyup",this.handleKeyUp,this,this,false)
},handleKeyDown:function(V){if(V.cancelKey){return 
}var F=V.editContext;
var W=V.extEvent;
var B=CQ.form.rte.DomProcessor;
var U=CQ.form.rte.Selection;
var I=CQ.form.rte.Common;
var a=W.getKey();
var H=false;
var b;
if(a==W.TAB){var S="";
var R=this.config.tabSize;
for(var M=0;
M<R;
M++){S+="&nbsp;"
}if(!CQ.Ext.isSafari){this.editorKernel.execCmd("InsertHTML",S)
}else{this.editorKernel.execCmd("InsertText","\t")
}V.cancelKey=true
}this.mustEnsureBlocks=false;
if((a==W.ENTER)&&!H){if(!W.shiftKey){var O=false;
try{b=this.editorKernel.createQualifiedSelection(F);
if(U.isSelection(b)){this.editorKernel.execCmd("Delete",null);
this.ensureMinimumContent(F)
}b=this.editorKernel.createQualifiedSelection(F);
var T=b.startNode;
var Y=B.getContainerNode(F,T);
if(I.isTag(Y,["ul","ol","li"])){O=true
}if(!O){var K=b.startOffset;
var D=B.insertParagraph(F,T,K);
var A;
if(CQ.Ext.isGecko){A=I.getFirstChild(D);
if(!A){A=D
}else{if(A.nodeType==3){A=A.parentNode
}}}else{A=D
}U.selectNode(F,A,true);
if(CQ.Ext.isGecko&&F.iFrame){var C=F.root.scrollTop;
var N=F.iFrame.clientHeight;
var J=D.offsetTop;
var G=D.clientHeight;
var P=C+N;
var Z=J+G;
if(Z>P){F.root.scrollTop=Z-N
}}V.cancelKey=true
}}catch(W){O=true
}if(O){if(CQ.Ext.isGecko){this.mustEnsureBlocks=true
}}}}this.auxRootParaNodeCnt=0;
if(((a==W.BACKSPACE)||(a==W.DELETE))&&!V.cancelKey){if(!b){b=this.editorKernel.createQualifiedSelection(F)
}if(CQ.Ext.isIE){var Q=B.getEmptyLine(F,b);
if((Q!=null)&&!I.isTag(Q,I.TABLE_CELLS)){var L=U.getCaretPos(F);
Q.parentNode.removeChild(Q);
if((a==W.BACKSPACE)&&(L>0)){L--;
U.setCaretPos(F,L)
}V.cancelKey=true
}}var X=B.createNodeList(F,b);
var E=I.getTagInPath(F,X.commonAncestor,B.AUXILIARY_ROOT_TAGS);
if(E){this.auxRootParaNodeCnt=I.getChildNodesByType(E,"p").length
}}this.preventAutoLinks=(!V.cancelKey&&CQ.Ext.isIE)
},handleKeyUp:function(N){var M=CQ.form.rte.Selection;
var E=CQ.form.rte.Common;
var B=CQ.form.rte.DomProcessor;
var C=N.editContext;
var K;
var O=N.extEvent;
if(this.preventAutoLinks){this.handleIEAutoLinks(C);
this.preventAutoLinks=false
}this.ensureMinimumContent(C);
if(this.mustEnsureBlocks){var R=M.getSelection(C);
if(R.focusNode&&(R.focusNode.nodeType==1)){K=R.focusNode.childNodes[R.focusOffset];
if(E.isRootNode(C,K.parentNode)&&E.isTag(K,"br")){var A=B.insertAsParent(C,K,"p",null);
M.selectNode(C,A,true)
}}}var Q=O.getKey();
if((Q==O.BACKSPACE)||(Q==O.DELETE)){if(CQ.Ext.isIE){try{var J=M.getLeadRange(C);
var I=J.duplicate();
if(J.move("character",1)==1){M.selectRange(C,J)
}else{if(J.move("character",-1)==-1){M.selectRange(C,J)
}}M.selectRange(C,I)
}catch(O){}}R=this.editorKernel.createQualifiedSelection(C);
if(R&&!M.isSelection(R)){K=R.startNode;
var D=B.getScopedBlockNode(C,K);
if(D){if(!D.isAuxiliaryRoot){var P=D.dom.parentNode;
if(E.isTag(P,B.AUXILIARY_ROOT_TAGS)){var L=E.getChildNodesByType(P,"p");
var H=L.length;
if((H==1)&&(H<this.auxRootParaNodeCnt)){var G=L[0];
if(!G.style.textAlign&&!G.style.marginLeft){var F;
if(CQ.Ext.isIE){F=M.createSelectionBookmark(C)
}B.removeWithoutChildren(G);
if(CQ.Ext.isIE){M.selectBookmark(C,F)
}}}}}}}}},ensureMinimumContent:function(D){var F=CQ.form.rte.DomProcessor;
var B=CQ.form.rte.Common;
var G=CQ.form.rte.Selection;
var C=null;
if(D.root.childNodes.length==1){var A=D.root.childNodes[0];
if(B.isTag(A,"br")){D.root.removeChild(A)
}if(B.isTag(A,"p")){F.ensureEmptyLinePlaceholders(D,A)
}}var E=F.ensureBlockContent(D,"p",null,false,true);
if(E){G.selectBookmark(D,E)
}if(D.root.childNodes.length==0){C=D.createElement("p");
D.root.appendChild(C);
F.ensureEmptyLinePlaceholders(D,C);
G.selectNode(D,C,true)
}return C
},handleIEAutoLinks:function(C){var E=C.root.getElementsByTagName("A");
var D=E.length;
for(var A=D-1;
A>=0;
A--){var B=E[A];
if(B.href&&!B[CQ.form.rte.Common.HREF_ATTRIB]){CQ.form.rte.DomProcessor.removeWithoutChildren(B)
}}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{tabSize:4});
this.config=A
}});
CQ.form.rte.plugins.PluginRegistry.register("keys",CQ.form.rte.plugins.KeyPlugin);
CQ.form.rte.plugins.SimpleFormatPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{commands:null,commandsUI:null,groupDef:null,getFeatures:function(){return this.commands
},constructor:function(D,C,B,A){CQ.form.rte.plugins.SimpleFormatPlugin.superclass.constructor.call(this,D);
this.groupDef={id:C,sort:B};
this.commands=A
},initializeUI:function(B){this.commandsUI=[];
var C=this.commands.length;
for(var D=0;
D<C;
D++){var E=this.commands[D];
if(this.isFeatureEnabled(E)){var A=new CQ.form.rte.ui.TbElement(E,this,true,this.getTooltip(E));
this.commandsUI.push(A);
B.addElement(this.groupDef.id,this.groupDef.sort,A,(D+1)*10)
}}},execute:function(A){this.editorKernel.relayCmd(A)
},updateState:function(A){var C=this.commandsUI.length;
for(var D=0;
D<C;
D++){var E=this.commandsUI[D];
var B=E.getExtUI();
B.toggle(this.editorKernel.queryState(E.id,A))
}}});
CQ.form.rte.plugins.EditToolsPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{isPasteOperation:false,pasteRange:null,clipboard:null,geckoPreferredScrollingOffset:null,cutUI:null,copyUI:null,pasteDefaultUI:null,pastePlainTextUI:null,pasteAsWordUI:null,pasteDefaultDialog:null,pastePlainTextDialog:null,pasteWordHtmlDialog:null,constructor:function(A){CQ.form.rte.plugins.EditToolsPlugin.superclass.constructor.call(this,A);
A.addPluginListener("beforekeydown",this.handleKeyDown,this,this,false)
},handleKeyDown:function(C){if(C.cancelKey){return 
}var B=C.extEvent.getKey();
if(this.config.defaultPasteMode!="browser"){var A=false;
if(CQ.Ext.isMac){A=(C.extEvent.metaKey&&(C.extEvent.charCode==118))||(C.extEvent.ctrlKey&&(B==86))
}else{A=(C.extEvent.ctrlKey&&(B==86))||(C.extEvent.shiftKey&&(B==45))
}if(A){this.beforePaste(C.editContext)
}}},createRazorConfig:function(){var com=CQ.form.rte.Common;
var availTags={bold:"b",italic:"i",underline:"u",anchor:"a",image:"img",subscript:"sub",superscript:"sup"};
var razorConfig={};
if(this.config.htmlPasteRules){razorConfig.supportedTags=["br"];
var formats=this.config.htmlPasteRules.allowBasics;
if(formats){for(var key in formats){if(formats[key]===true){if(availTags.hasOwnProperty(key)){razorConfig.supportedTags.push(availTags[key])
}}}}var blockTags=this.config.htmlPasteRules.allowBlockTags;
if(blockTags){blockTags=CQ.form.rte.Common.toArray(blockTags);
var tagCnt=blockTags.length;
for(var t=0;
t<tagCnt;
t++){razorConfig.supportedTags.push(blockTags[t])
}}if(this.config.htmlPasteRules.fallbackBlockTag){razorConfig.blockTagReplacement=this.config.htmlPasteRules.fallbackBlockTag
}function addSupportedTag(tagName){if(!com.arrayContains(razorConfig.supportedTags,tagName)){razorConfig.supportedTags.push(tagName)
}}if(this.config.htmlPasteRules.table){var table=this.config.htmlPasteRules.table;
if(table.allow){addSupportedTag("table");
addSupportedTag("tr");
addSupportedTag("td");
addSupportedTag("th")
}else{if(table.ignoreMode){razorConfig.tableIgnoreMode=table.ignoreMode
}}}if(this.config.htmlPasteRules.list){var list=this.config.htmlPasteRules.list;
if(list.allow){addSupportedTag("ul");
addSupportedTag("ol");
addSupportedTag("li")
}else{if(list.ignoreMode){razorConfig.listIgnoreMode=list.ignoreMode
}}}if(this.config.htmlPasteRules.cssMode){razorConfig.cssMode=this.config.htmlPasteRules.cssMode
}if(this.config.htmlPasteRules.allowedCssNames){razorConfig.allowedCssNames=this.config.htmlPasteRules.allowedCssNames
}if(this.config.htmlPasteRules.linkRemoveRegEx!=null){razorConfig.linkRemoveRegEx=eval(this.config.htmlPasteRules.linkRemoveRegEx)
}if(this.config.htmlPasteRules.removeHandlers!=null){razorConfig.removeHandlers=this.config.htmlPasteRules.removeHandlers
}if(this.config.htmlPasteRules.handlersToRemove){razorConfig.handlersToRemove=this.config.htmlPasteRules.handlersToRemove
}var linkRules=this.editorKernel.htmlRules.links;
if(linkRules){razorConfig.linkRules=linkRules
}}return razorConfig
},beforePaste:function(B){if(this.isPasteOperation){return 
}this.isPasteOperation=true;
this.pasteRange=this.editorKernel.createQualifiedRangeBookmark(B);
this.clipboard=B.createElement("div");
this.clipboard.style.position="absolute";
this.clipboard.style.left="-1000px";
this.clipboard.style.top="-1000px";
B.root.appendChild(this.clipboard);
this.clipboard.appendChild(B.createElement("br"));
var D;
if(CQ.Ext.isIE){D=B.doc.selection.createRange();
var A=D.boundingWidth;
D.moveToElementText(this.clipboard);
D.select()
}else{this.geckoPreferredScrollingOffset=CQ.form.rte.Selection.getPreferredScrollOffset(B);
D=B.doc.createRange();
D.selectNodeContents(this.clipboard);
var C=B.win.getSelection();
C.removeAllRanges();
C.addRange(D)
}this.afterPaste.defer(1,this,[B])
},afterPaste:function(B){var D=CQ.form.rte.Selection;
CQ.form.rte.DomProcessor.correctGeckoCopyBugs(B,this.clipboard);
var C=this.clipboard.innerHTML;
this.clipboard.parentNode.removeChild(this.clipboard);
var A=this.editorKernel.execCmd("paste",{html:C,dom:this.clipboard,mode:this.config.defaultPasteMode,pasteRange:this.pasteRange,stripHtmlTags:this.config.stripHtmlTags,razorConfig:this.createRazorConfig(),htmlRules:this.editorKernel.htmlRules,pasteRules:this.config.htmlPasteRules});
if(CQ.Ext.isGecko&&A.geckoEnsureCaretVisibility){if(B.iFrame){D.ensureCaretVisibility(B,B.iframe,this.geckoPreferredScrollingOffset)
}}if(CQ.Ext.isGecko&&A.bookmark){D.selectBookmark(B,A.bookmark)
}this.clipboard=null;
this.pasteRange=null;
this.isPasteOperation=false;
this.geckoPreferredScrollingOffset=null
},createPasteDialog:function(D,C,B){var E=this.editorKernel;
var A=new CQ.form.rte.plugins.PasteDialog({type:D,editContext:C,pasteFn:B.createDelegate(this),cancelFn:function(){this.pasteRange=null
}.createDelegate(this),listeners:{show:function(){E.fireUIEvent("dialogshow")
},hide:function(){E.fireUIEvent("dialoghide")
}}});
A.setPosition(this.editorKernel.calculateWindowPosition("default"));
return A
},showPasteDialog:function(A){A.setValue("");
A.show();
window.setTimeout(function(){A.toFront();
A.focus()
},10)
},pasteDefault:function(C){var A=CQ.form.rte.commands.Paste;
var D=this.config.defaultPasteMode;
var B;
switch(D){case A.MODE_BROWSER:this.editorKernel.relayCmd("paste",{mode:D});
return ;
case A.MODE_WORDHTML:B="iframe";
break;
case A.MODE_PLAINTEXT:B="plaintext";
break;
default:throw new Error("Invalid default paste mode: '"+D+"'.")
}if(!this.pasteDefaultDialog){this.pasteDefaultDialog=this.createPasteDialog("iframe",C,this.execPasteDefault)
}this.showPasteDialog(this.pasteDefaultDialog)
},execPasteDefault:function(A,C,B,D){if(B){this.execPasteWordHtml(C,B,D)
}else{this.execPastePlainText(C)
}},pastePlainText:function(A){if(!this.pastePlainTextDialog){this.pastePlainTextDialog=this.createPasteDialog("plaintext",A,this.execPastePlainText)
}this.showPasteDialog(this.pastePlainTextDialog)
},execPastePlainText:function(B,C){var A=CQ.form.rte.commands.Paste;
this.editorKernel.relayCmd("paste",{mode:A.MODE_PLAINTEXT,text:C,pasteRange:this.pasteRange,stripHtmlTags:this.config.stripHtmlTags});
this.pasteRange=null
},pasteWordHtml:function(A){if(!this.pasteWordHtmlDialog){this.pasteWordHtmlDialog=this.createPasteDialog("iframe",A,this.execPasteWordHtml)
}this.showPasteDialog(this.pasteWordHtmlDialog)
},execPasteWordHtml:function(B,D,C,E){var A=CQ.form.rte.commands.Paste;
this.editorKernel.relayCmd("paste",{mode:A.MODE_WORDHTML,html:D,dom:E,pasteRange:this.pasteRange,razorConfig:this.createRazorConfig(),htmlRules:this.editorKernel.htmlRules});
this.pasteRange=null
},getFeatures:function(){return["cut","copy","paste-default","paste-plaintext","paste-wordhtml"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("cut")){this.cutUI=new C.TbElement("cut",this,false,this.getTooltip("cut"));
A.addElement("edit",B.Plugin.SORT_EDIT,this.cutUI,10)
}if(this.isFeatureEnabled("copy")){this.copyUI=new C.TbElement("copy",this,false,this.getTooltip("copy"));
A.addElement("edit",B.Plugin.SORT_EDIT,this.copyUI,10)
}if(this.isFeatureEnabled("paste-default")){this.pasteDefaultUI=new C.TbElement("paste-default",this,false,this.getTooltip("paste-default"));
A.addElement("edit",B.Plugin.SORT_EDIT,this.pasteDefaultUI,30)
}if(this.isFeatureEnabled("paste-plaintext")){this.pastePlainTextUI=new C.TbElement("paste-plaintext",this,false,this.getTooltip("paste-plaintext"));
A.addElement("edit",B.Plugin.SORT_EDIT,this.pastePlainTextUI,40)
}if(this.isFeatureEnabled("paste-wordhtml")){this.pasteAsWordUI=new C.TbElement("paste-wordhtml",this,false,this.getTooltip("paste-wordhtml"));
A.addElement("edit",B.Plugin.SORT_EDIT,this.pasteAsWordUI,50)
}},notifyPluginConfig:function(B){B=B||{};
var A=false;
if(B.htmlPasteRules){A=(B.htmlPasteRules.linkRemoveRegEx==="")
}CQ.Util.applyDefaults(B,{defaultPasteMode:"wordhtml",stripHtmlTags:true,htmlPasteRules:{allowBasics:{bold:true,italic:true,underline:true,anchor:true,image:true,subscript:true,superscript:true},allowBlockTags:["p","h1","h2","h3","h4","h5","h6"],allowedAttributes:{"*":["class"],table:["width","height","cellspacing","cellpadding","border"],td:["width","height","colspan","rowspan","valign"],a:["href","name","title","alt"],img:["src","title","alt","width","height"]},list:{allow:true},table:{allow:true},linkRemoveRegEx:null},tooltips:{cut:{title:CQ.I18n.getMessage("Cut (Ctrl+X)"),text:CQ.I18n.getMessage("Cuts the currently selected text and puts it in to the clipboard.")},copy:{title:CQ.I18n.getMessage("Copy (Ctrl+C)"),text:CQ.I18n.getMessage("Copies the currently selected text to the clipboard.")},"paste-default":{title:CQ.I18n.getMessage("Paste (Ctrl+V)"),text:CQ.I18n.getMessage("Pastes the clipboard content with the default paste method.")},"paste-plaintext":{title:CQ.I18n.getMessage("Paste as text"),text:CQ.I18n.getMessage("Pastes the clipboard content as plain text.")},"paste-wordhtml":{title:CQ.I18n.getMessage("Paste from Word"),text:CQ.I18n.getMessage("Pastes the clipboard content from Word, applying some cleanup.")}}});
this.config=B;
if(A){delete this.config.htmlPasteRules.linkRemoveRegEx
}if(B.htmlPasteRules.table.allowed!==undefined){this.config.htmlPasteRules.table.allow=this.config.htmlPasteRules.table.allowed;
delete this.config.htmlPasteRules.table.allowed
}},execute:function(E,D,B){var A=B.editContext;
this.pasteRange=this.editorKernel.createQualifiedRangeBookmark(A);
var C=E.toLowerCase();
switch(C){case"cut":case"copy":this.editorKernel.relayCmd(C);
break;
case"paste-default":this.pasteDefault(A);
break;
case"paste-plaintext":this.pastePlainText(A);
break;
case"paste-wordhtml":this.pasteWordHtml(A);
break
}},updateState:function(A){if(this.cutUI){this.cutUI.getExtUI().setDisabled(!A.isSelection)
}if(this.copyUI){this.copyUI.getExtUI().setDisabled(!A.isSelection)
}}});
CQ.form.rte.plugins.PluginRegistry.register("edit",CQ.form.rte.plugins.EditToolsPlugin);
CQ.form.rte.plugins.PasteDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(B){if(!B){B={}
}var A;
if(B.type=="iframe"){A=new CQ.form.rte.plugins.PasteDialog.IFrame({itemId:"pasteArea",region:"center",stateful:false})
}else{A={xtype:"textarea",itemId:"pasteArea",region:"center",stateful:false}
}var C={renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Paste"),stateful:false,minWidth:300,minHeight:200,width:300,height:200,plain:true,layout:"border",items:[{xtype:"label",margins:"4 4 4 4",html:CQ.I18n.getMessage('Please use the field below to paste with Ctrl+V, then hit "OK".'),region:"north",minSize:25,maxSize:50,bodyBorder:false,hideBorders:true,border:false,cls:null,stateful:false},A],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){var E=this.items.get("pasteArea");
var F=(this.type=="iframe");
var G=E.getValue();
var H=null;
if(F){var D=E.getDom();
H=this.editContext.createElement("div");
H.innerHTML=D.innerHTML
}this.hide();
if(this.pasteFn){this.pasteFn(this.editContext,G,F,H)
}},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],modal:true};
CQ.Util.applyDefaults(B,C);
CQ.form.rte.plugins.PasteDialog.superclass.constructor.call(this,B)
},setValue:function(B){var A=this.items.get("pasteArea");
A.setValue(B)
},focus:function(){var A=this.items.get("pasteArea");
A.focus(false,10)
}});
CQ.form.rte.plugins.PasteDialog.IFrame=CQ.Ext.extend(CQ.Ext.Panel,{autoEl:"div",onRender:function(A,B){CQ.form.rte.plugins.PasteDialog.IFrame.superclass.onRender.call(this,A,B);
this.iframe=document.createElement("iframe");
this.iframe.name=CQ.Ext.id();
this.iframe.frameBorder="0";
this.iframe.src=CQ.Ext.isIE?CQ.Ext.SSL_SECURE_URL:"javascript:;";
this.body.dom.appendChild(this.iframe);
this.win=CQ.Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name];
this.win.document.open();
this.win.document.write('<html><head><style type="text/css">body{border:0;margin:0;padding:3px;cursor:text;font-family:sans-serif;font-size:11px}</style></head><body></body></html>');
this.win.document.close()
},focus:function(){this.win.document.designMode="on";
window.setTimeout(function(){this.win.focus()
}.createDelegate(this),10)
},getValue:function(){if(!this.rendered){return""
}return this.win.document.body.innerHTML
},getDom:function(){if(!this.rendered){return null
}return this.win.document.body
},setValue:function(A){if(!this.rendered){return 
}if(CQ.Ext.isGecko){this.win.document.designMode="off"
}this.win.document.body.innerHTML=A;
if(CQ.Ext.isGecko){this.win.document.designMode="on"
}},onResize:function(A,B){CQ.form.rte.plugins.PasteDialog.IFrame.superclass.onResize.call(this,A,B);
if(CQ.Ext.isArray(A)){B=A[1];
A=A[0]
}if(this.iframe&&A&&B){this.iframe.width=A;
this.iframe.height=B
}}});
CQ.form.rte.plugins.FindReplacePlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{findUI:null,replaceUI:null,findDialog:null,replaceDialog:null,currentSearchDef:null,savedRange:null,constructor:function(A){CQ.form.rte.plugins.FindReplacePlugin.superclass.constructor.call(this,A)
},find:function(B){if(CQ.Ext.isIE){this.savedRange=B.doc.selection.createRange()
}var C=this.editorKernel;
if(!this.findDialog||this.findDialog.isDestroyed){var A={editContext:B,title:CQ.I18n.getMessage("Find"),isReplace:false,findFn:this.execFind.createDelegate(this),cancelFn:this.execCancel.createDelegate(this),listeners:{show:function(){C.fireUIEvent("dialogshow")
},hide:function(){C.fireUIEvent("dialoghide")
}}};
this.findDialog=new CQ.form.rte.plugins.FindReplaceDialog(A);
this.findDialog.setPosition(this.editorKernel.calculateWindowPosition("left"))
}this.findDialog.setMode(true,false);
this.findDialog.show();
window.setTimeout(function(){this.findDialog.toFront();
this.findDialog.focus()
}.createDelegate(this),10)
},execFind:function(E,F,W){if(CQ.Ext.isIE&&this.savedRange){this.savedRange.select()
}var D=F.findText;
var V=F.matchCase;
if(this.currentSearchDef&&((this.currentSearchDef.findText!=D)||(this.currentSearchDef.matchCase!=V))){this.currentSearchDef=null
}var K,c;
var G=CQ.form.rte.Common;
var S=CQ.form.rte.Selection;
var A=CQ.form.rte.DomProcessor;
if(!this.currentSearchDef){c=S.createProcessingSelection(E);
var b=c.startNode;
var U=c.startOffset;
if(G.getNodeCharacterCnt(b)==0){b=G.getFirstTextChild(b,true);
if(!b){b=G.getNextCharacterNode(E,c.startNode)
}if(b){U=(b.nodeType==1?null:0)
}else{U=null
}}var Y=new CQ.form.rte.SearchableDocument();
Y.create(E.root);
var a={ignoreCase:!V};
this.currentSearchDef={findText:D,matchCase:V,doc:Y};
var R=Y.getRefForNode(b);
if(R){R=R.textPos+U;
a.startPos=R
}K=Y.find(D,a)
}else{K=this.currentSearchDef.doc.findNext()
}if(!K){W.setMode(false,false);
CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Find/Replace"),CQ.I18n.getMessage("No more occurences of '{0}' found in document.<br>Search will be continued from the top.",[D]));
this.currentSearchDef.doc.create(E.root)
}if(K&&(K.length>0)){W.setMode(false,true);
var H=K[0];
var Z=K[K.length-1];
c={startNode:H.node,startOffset:H.matchPos-H.nodePos,endNode:Z.node,endOffset:(Z.matchPos-Z.nodePos)+Z.matchChars};
if(CQ.Ext.isIE){this.editorKernel.focus(E)
}var J=S.bookmarkFromProcessingSelection(E,c);
S.selectBookmark(E,J);
if(CQ.Ext.isIE){this.savedRange=E.doc.selection.createRange()
}if(CQ.Ext.isGecko&&E.iFrame){var O=S.getLeadRange(E);
var L=O.commonAncestorContainer;
while(L.nodeType==3){L=L.parentNode
}var X=A.saveChildNodes(L);
var T=E.createElement("span");
O.surroundContents(T);
var P=T.offsetTop;
var N=T.offsetParent;
while(N){P+=N.offsetTop;
N=N.offsetParent
}var I=P+T.offsetHeight;
var B=E.root.scrollTop;
var M=E.iFrame.clientHeight;
var Q=B+M;
if(I<B){E.root.scrollTop=P
}else{if(I>Q){var C=E.root.scrollHeight;
if((C-I)<8){I=C
}if(I>Q){E.root.scrollTop=I-M
}}}A.removeWithoutChildren(T);
L.normalize();
A.restoreChildNodes(L,X);
S.selectBookmark(E,J)
}}},replace:function(B){if(CQ.Ext.isIE){this.savedRange=B.doc.selection.createRange()
}var C=this.editorKernel;
if(!this.replaceDialog||this.replaceDialog.isDestroyed){var A={editContext:B,isReplace:true,findFn:this.execFind.createDelegate(this),replaceFn:this.execReplace.createDelegate(this),cancelFn:this.execCancel.createDelegate(this),listeners:{show:function(){C.fireUIEvent("dialogshow")
},hide:function(){C.fireUIEvent("dialoghide")
}}};
this.replaceDialog=new CQ.form.rte.plugins.FindReplaceDialog(A);
this.replaceDialog.setPosition(this.editorKernel.calculateWindowPosition("left"))
}this.replaceDialog.setMode(true,false);
this.replaceDialog.show();
window.setTimeout(function(){this.replaceDialog.toFront();
this.replaceDialog.focus()
}.createDelegate(this),10)
},execReplace:function(C,N,L){if(CQ.Ext.isIE){this.savedRange.select()
}var D=CQ.form.rte.Selection;
if(N.replaceAll){this.editorKernel.focus(C);
var F=new CQ.form.rte.SearchableDocument();
F.create(C.root);
var E={ignoreCase:!N.matchCase};
var B=0;
var H=F.find(N.findText,E);
while(H){var A=H[0];
var I=H[H.length-1];
var M={startNode:A.node,startOffset:A.matchPos-A.nodePos,endNode:I.node,endOffset:(I.matchPos-I.nodePos)+I.matchChars};
var K=D.bookmarkFromProcessingSelection(C,M);
D.selectBookmark(C,K);
this.editorKernel.execCmd("inserthtml",N.replaceText);
F.adjustToReplace(N.replaceText);
B++;
F.create(C.root);
H=F.findNext()
}L.hide();
if(B>0){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Replace all"),CQ.I18n.getMessage("Text '{0}' has been replaced {1} times.",[N.findText,B]),this.editorKernel.focus,this.editorKernel)
}else{CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Replace all"),CQ.I18n.getMessage("Text '{0}' not found."),this.editorKernel.focus,this.editorKernel)
}this.editorKernel.focus(C)
}else{var G=false;
try{this.editorKernel.focus(C);
this.editorKernel.execCmd("inserthtml",CQ.Ext.util.Format.htmlEncode(N.replaceText));
this.currentSearchDef.doc.adjustToReplace(N.replaceText);
this.currentSearchDef.doc.create(C.root)
}catch(J){if(J.message=="Could not insert html due to IE limitations."){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Replace"),CQ.I18n.getMessage("Could not replace due to limited functionality in Internet Explorer."));
G=true
}else{throw J
}this.editorKernel.focus(C)
}this.editorKernel.updateToolbar();
if(!G){if(CQ.Ext.isIE){this.savedRange=null
}this.execFind(C,N,L)
}else{if(CQ.Ext.isIE){this.savedRange.select()
}L.setMode(false,false)
}}},execCancel:function(){this.currentSearchDef=null
},getFeatures:function(){return["find","replace"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("find")){this.findUI=new C.TbElement("find",this,false,this.getTooltip("find"));
A.addElement("findreplace",B.Plugin.SORT_EDIT+5,this.findUI,100)
}if(this.isFeatureEnabled("replace")){this.replaceUI=new C.TbElement("replace",this,false,this.getTooltip("replace"));
A.addElement("findreplace",B.Plugin.SORT_EDIT+5,this.replaceUI,110)
}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{tooltips:{find:{title:CQ.I18n.getMessage("Find"),text:CQ.I18n.getMessage("Finds a text fragment in the text being edited.")},replace:{title:CQ.I18n.getMessage("Replace"),text:CQ.I18n.getMessage("Replaces a text fragment with another fragment.")}}});
this.config=A
},execute:function(C,B,A){switch(C){case"find":this.find(A.editContext);
break;
case"replace":this.replace(A.editContext);
break
}},updateState:function(A){}});
CQ.form.rte.plugins.PluginRegistry.register("findreplace",CQ.form.rte.plugins.FindReplacePlugin);
CQ.form.rte.plugins.FindReplaceDialog=CQ.Ext.extend(CQ.Ext.Window,{editContext:null,isReplace:false,canReplace:false,findText:null,findNextText:null,findFn:null,replaceFn:null,constructor:function(B){var A=this;
var C=[];
var D=[];
var E={title:CQ.I18n.getMessage("Find/Replace"),isReplace:false,replaceFn:null,findFn:null,findText:CQ.I18n.getMessage("Find"),findNextText:CQ.I18n.getMessage("Find next")};
CQ.Util.applyDefaults(B,E);
CQ.Ext.apply(this,B);
C.push({itemId:"findText",name:"findText",xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Find"),value:"",enableKeyEvents:true,listeners:{keyup:{fn:this.adjustButtonState,scope:this}},anchor:CQ.themes.Dialog.ANCHOR});
if(this.isReplace){C.push({itemId:"replaceText",name:"replaceText",xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Replace with"),value:"",enableKeyEvents:true,anchor:CQ.themes.Dialog.ANCHOR})
}C.push({itemId:"matchCase",name:"matchCase",xtype:"checkbox",boxLabel:"Match case",value:false});
D.push({itemId:"find",name:"find",text:this.findText,handler:function(){this.applyDialog(this.findFn,null)
},disabled:true,scope:this});
if(this.isReplace){D.push({itemId:"replace",name:"replace",text:CQ.I18n.getMessage("Replace"),handler:function(){this.applyDialog(this.replaceFn,{replaceAll:false})
},disabled:true,scope:this});
D.push({itemId:"replaceAll",name:"replaceAll",text:CQ.I18n.getMessage("Replace all"),handler:function(){this.applyDialog(this.replaceFn,{replaceAll:true})
},disabled:true,scope:this})
}D.push({text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this});
CQ.form.rte.plugins.FindReplaceDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:this.title,stateful:false,minWidth:350,minHeight:170,width:350,height:170,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"findReplaceForm",stateful:false,items:C,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
A.findItems=this.items;
this.body.addClass("cq-rte-findreplacedialog")
}}]}],buttons:D,modal:true})
},applyDialog:function(B,A){A=A||{};
if(B){A.findText=this.findItems.get("findText").getValue();
A.matchCase=this.findItems.get("matchCase").getValue();
if(this.isReplace){A.replaceText=this.findItems.get("replaceText").getValue()
}B(this.editContext,A,this)
}},adjustButtonState:function(){var B=this.findItems.get("findText").getValue();
var A=(B.length>0);
if(this.isReplace){this.buttons[0].setDisabled(!A);
this.buttons[1].setDisabled(!(A&this.canReplace));
this.buttons[2].setDisabled(!A)
}else{this.buttons[0].setDisabled(!A)
}},setMode:function(B,A){this.canReplace=A;
if(B){this.buttons[0].setText(this.findText)
}else{this.buttons[0].setText(this.findNextText)
}if(this.isReplace){this.buttons[1].setDisabled(!A)
}}});
CQ.form.rte.plugins.FormatPlugin=CQ.Ext.extend(CQ.form.rte.plugins.SimpleFormatPlugin,{constructor:function(B){var A=CQ.form.rte.plugins;
A.FormatPlugin.superclass.constructor.call(this,B,"format",A.Plugin.SORT_FORMAT,["bold","italic","underline"])
},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{features:"*",tooltips:{bold:{title:CQ.I18n.getMessage("Bold (Ctrl+B)"),text:CQ.I18n.getMessage("Make the selected text bold.")},italic:{title:CQ.I18n.getMessage("Italic (Ctrl+I)"),text:CQ.I18n.getMessage("Make the selected text italic.")},underline:{title:CQ.I18n.getMessage("Underline (Ctrl+U)"),text:CQ.I18n.getMessage("Underline the selected text.")}}});
this.config=A
}});
CQ.form.rte.plugins.PluginRegistry.register("format",CQ.form.rte.plugins.FormatPlugin);
CQ.form.rte.plugins.JustifyPlugin=CQ.Ext.extend(CQ.form.rte.plugins.SimpleFormatPlugin,{constructor:function(B){var A=CQ.form.rte.plugins;
A.JustifyPlugin.superclass.constructor.call(this,B,"justify",A.Plugin.SORT_JUSTIFY,["justifyleft","justifycenter","justifyright"])
},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{features:"*",tooltips:{justifyleft:{title:CQ.I18n.getMessage("Align Text Left"),text:CQ.I18n.getMessage("Align text to the left.")},justifycenter:{title:CQ.I18n.getMessage("Center Text"),text:CQ.I18n.getMessage("Center text in the editor.")},justifyright:{title:CQ.I18n.getMessage("Align Text Right"),text:CQ.I18n.getMessage("Align text to the right.")}}});
this.config=A
}});
CQ.form.rte.plugins.PluginRegistry.register("justify",CQ.form.rte.plugins.JustifyPlugin);
CQ.form.rte.plugins.LinkPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{linkDialog:null,anchorDialog:null,linkUI:null,removeLinkUI:null,anchorUI:null,constructor:function(A){CQ.form.rte.plugins.LinkPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["modifylink","unlink","anchor"]
},modifyLink:function(C){var D=CQ.form.rte.Common;
if(!this.linkDialog||this.linkDialog.isDestroyed){var B=this.editorKernel.htmlRules.links;
var L={configVersion:1,defaultDialog:{dialogClass:{xtype:"rtelinkdialog"}},parameters:{linkRules:B,editorKernel:this.editorKernel}};
if(this.config.linkDialogConfig){var I=this.config.linkDialogConfig;
if(I.linkAttributes){D.removeJcrData(I.linkAttributes);
var N=D.toArray(I.linkAttributes);
L.additionalFields=[];
var K=N.length;
for(var M=0;
M<K;
M++){var H=N[M];
var E=H.attribute;
var F={item:{name:E,xtype:H.xtype,fieldLabel:H.fieldLabel},fromModel:function(R,Q){if(Q.xtype=="hidden"){return 
}var P=Q.getName();
var O=D.getAttribute(R.dom,P);
if(O){Q.setValue(O)
}else{Q.setValue("")
}},toModel:function(R,Q){var O=Q.getName();
if(!R.attributes){R.attributes={}
}var P=Q.getValue();
if(P&&(P.length>0)){R.attributes[O]=P
}else{R.attributes[O]=CQ.form.rte.commands.Link.REMOVE_ATTRIBUTE
}}};
delete H.attribute;
delete H.xtype;
delete H.fieldLabel;
CQ.Util.applyDefaults(F.item,H);
L.additionalFields.push(F)
}delete I.linkAttributes
}L.dialogProperties=I
}if(B.targetConfig){if(B.targetConfig.mode!="blank"){L.disabledDefaultFields=["targetBlank"]
}if(B.targetConfig.mode=="manual"){if(!L.additionalFields){L.additionalFields={}
}L.additionalFields.push({item:{name:"target",xtype:"textfield",anchor:CQ.themes.Dialog.ANCHOR,fieldLabel:CQ.I18n.getMessage("Anchor")},fromModel:function(P,O){if(P.dom&&P.dom.target){O.setValue(P.dom.target)
}},toModel:function(Q,P){if(!Q.attributes){Q.attributes={}
}var O=P.getValue();
if(O&&(O.length>0)){Q.attributes.target=O
}else{Q.attributes.target=null
}}})
}}CQ.Util.applyDefaults(L,this.config.linkDialogConfig||{});
var A=new CQ.form.rte.ui.DialogHelper(L,this.editorKernel);
this.linkDialog=A.create();
A.calculateInitialPosition()
}var G=null;
var J=this.editorKernel.analyzeSelection();
if(J.anchorCount==1){G=J.anchors[0]
}G=G||{};
this.linkDialog.initializeEdit(this.editorKernel,G,this.applyLink.createDelegate(this));
if(CQ.Ext.isIE){this.savedRange=C.doc.selection.createRange()
}this.linkDialog.show()
},applyLink:function(C){var D=this.linkDialog.objToEdit;
if(D){var B=D.href;
var A=D.cssClass;
var E=D.target;
if(CQ.Ext.isIE){this.savedRange.select()
}this.editorKernel.relayCmd("modifylink",{url:B,css:A,target:E,trimLinkSelection:this.config.trimLinkSelection,attributes:D.attributes})
}},modifyAnchor:function(D){if(!this.anchorDialog||this.anchorDialog.isDestroyed){var F=this.editorKernel;
var A={title:CQ.I18n.getMessage("Anchor"),modal:true,value:"test",width:400,height:200,ok:function(){var G=this.anchorDialog.getName();
var H=null;
if(G){H=G
}this.anchorDialog.hide();
if(CQ.Ext.isIE){this.savedRange.select()
}this.editorKernel.relayCmd("anchor",H)
}.createDelegate(this),listeners:{show:function(){F.fireUIEvent("dialogshow")
},hide:function(){F.fireUIEvent("dialoghide")
}}};
var C=this.config.anchorDialogConfig||{};
C["jcr:primaryType"]="cq:RTEAnchorDialog";
C.xtype="rteanchordialog";
CQ.Util.applyDefaults(C,A);
this.anchorDialog=CQ.WCM.getDialog(C);
var E=this.editorKernel.calculateWindowPosition("default");
this.anchorDialog.setPosition(E)
}else{this.anchorDialog.resetValues()
}this.anchorDialog.editContext=D;
var B=this.editorKernel.analyzeSelection();
if(B.namedAnchorCount==1){this.anchorDialog.setAnchor(B.namedAnchors[0])
}if(CQ.Ext.isIE){this.savedRange=D.doc.selection.createRange()
}this.anchorDialog.show();
window.setTimeout(function(){this.anchorDialog.toFront()
}.createDelegate(this),10)
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("modifylink")){this.linkUI=new C.TbElement("modifylink",this,false,this.getTooltip("modifylink"));
A.addElement("links",B.Plugin.SORT_LINKS,this.linkUI,10)
}if(this.isFeatureEnabled("unlink")){this.removeLinkUI=new C.TbElement("unlink",this,false,this.getTooltip("unlink"));
A.addElement("links",B.Plugin.SORT_LINKS,this.removeLinkUI,20)
}if(this.isFeatureEnabled("anchor")){this.anchorUI=new C.TbElement("anchor",this,true,this.getTooltip("anchor"));
A.addElement("links",B.Plugin.SORT_LINKS,this.anchorUI,30)
}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{features:"*",trimLinkSelection:true,linkDialogConfig:{targetConfig:{mode:"manual"}},anchorDialogConfig:{},tooltips:{modifylink:{title:CQ.I18n.getMessage("Hyperlink"),text:CQ.I18n.getMessage("Create or modify a hyperlink.")},unlink:{title:CQ.I18n.getMessage("Unlink"),text:CQ.I18n.getMessage("Remove an existing hyperlink from the selected text.")},anchor:{title:CQ.I18n.getMessage("Anchor"),text:CQ.I18n.getMessage("Add or edit an anchor.")}}});
this.config=A
},execute:function(C,B,A){if(C=="modifylink"){this.modifyLink(A.editContext)
}else{if(C=="anchor"){this.modifyAnchor(A.editContext)
}else{this.editorKernel.relayCmd(C)
}}},updateState:function(G){var B=G.anchorCount==1;
var E=G.anchorCount==0;
var F=G.selectedDom;
var D=false;
if(F){D=CQ.form.rte.Common.isTag(F,CQ.form.rte.plugins.LinkPlugin.LINKABLE_OBJECTS)
}var A=B||((G.isSelection||D)&&E);
if(this.linkUI){this.linkUI.getExtUI().setDisabled(!A)
}if(this.removeLinkUI){this.removeLinkUI.getExtUI().setDisabled(!B)
}if(this.anchorUI){var C=(G.namedAnchorCount==1);
this.anchorUI.getExtUI().toggle(C)
}}});
CQ.form.rte.plugins.LinkPlugin.LINKABLE_OBJECTS=["img"];
CQ.form.rte.plugins.PluginRegistry.register("links",CQ.form.rte.plugins.LinkPlugin);
CQ.form.rte.plugins.LinkDialog=CQ.Ext.extend(CQ.form.rte.ui.BaseWindow,{constructor:function(A){A=A||{};
var B={title:CQ.I18n.getMessage("Hyperlink"),modal:true,width:400,height:160,dialogItems:[{itemId:"href",name:"href",parBrowse:true,anchor:CQ.themes.Dialog.ANCHOR,fieldLabel:CQ.I18n.getMessage("Link to"),xtype:"pathfield",ddGroups:[CQ.wcm.EditBase.DD_GROUP_PAGE,CQ.wcm.EditBase.DD_GROUP_ASSET],fieldDescription:CQ.I18n.getMessage("Drop files or pages from the Content Finder"),listeners:{dialogselect:{fn:this.selectAnchor,scope:this},render:this.initHrefDragAndDrop},validator:this.validateLink.createDelegate(this),validationEvent:"keyup"},{itemId:"targetBlank",name:"targetBlank",xtype:"checkbox",boxLabel:CQ.I18n.getMessage("Open in new window"),value:"targetBlank"}]};
CQ.Util.applyDefaults(A,B);
CQ.form.rte.plugins.LinkDialog.superclass.constructor.call(this,A)
},selectAnchor:function(C,B,A){B=CQ.HTTP.encodePath(B);
if(A&&(A.length>0)){B+=".html#"+A
}C.setValue(B)
},initHrefDragAndDrop:function(){if(this.ddGroups){if(typeof (this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var D=this;
var C=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(I,G,H){if(I&&I.clearAnimations){I.clearAnimations(this)
}if(I.isDropAllowed(this)){if(H.records&&H.single){var F=H.records[0];
var J=F.get("path");
D.setValue(CQ.HTTP.encodePath(J));
G.stopEvent();
return true
}return false
}}});
var B=this.findParentByType(CQ.form.rte.plugins.LinkDialog);
B.on("activate",function(G){if(G&&G.el&&this.highlight){var F=parseInt(G.el.getStyle("z-index"),10);
if(!isNaN(F)){this.highlight.zIndex=F+1
}}},C);
B.on("deactivate",function(G){if(G&&G.el&&this.highlight){var F=parseInt(G.el.getStyle("z-index"),10);
if(!isNaN(F)){this.highlight.zIndex=F+1
}}},C);
var E=B.getParameter("editorKernel");
B.on("show",function(){E.fireUIEvent("preventdrop");
CQ.WCM.registerDropTargetComponent(D)
},C);
B.on("hide",function(){CQ.WCM.unregisterDropTargetComponent(D);
E.fireUIEvent("reactivatedrop")
},C);
for(var A=0;
A<this.ddGroups.length;
A++){C.addToGroup(this.ddGroups[A])
}C.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
this.dropTargets=[C]
}},preprocessModel:function(){if(this.objToEdit&&this.objToEdit.dom){this.objToEdit.href=CQ.form.rte.HtmlRules.Links.getLinkHref(this.objToEdit.dom)
}},dlgFromModel:function(){var E=this.getFieldByName("href");
if(E){var C="";
if(this.objToEdit){var A=this.objToEdit.href;
if(A){C=A
}}E.setValue(C)
}var B=this.getFieldByName("targetBlank");
if(B){var D=(this.objToEdit&&this.objToEdit.target?this.objToEdit.target.toLowerCase():null);
B.setValue(D=="_blank")
}},dlgToModel:function(){var C=this.getFieldByName("href");
if(C){if(this.objToEdit){var A=C.getValue();
if(A){this.objToEdit.href=A
}}}var B=this.getFieldByName("targetBlank");
if(B){if(B.getValue()){this.objToEdit.target="_blank"
}else{this.objToEdit.target=null
}}},postprocessModel:function(){var A=this.parameters.linkRules;
if(A){A.applyToObject(this.objToEdit)
}},validateLink:function(){var A=this.getFieldByName("href");
if(!A){return false
}A=A.getValue();
var B=this.getParameter("linkRules");
if(!B){return(A.length>0)
}return B.validateHref(A)
}});
CQ.Ext.reg("rtelinkdialog",CQ.form.rte.plugins.LinkDialog);
CQ.form.rte.plugins.AnchorDialog=CQ.Ext.extend(CQ.Dialog,{constructor:function(B){if(!B){B=new Object()
}var A=[{xtype:"textfield",name:"name",fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage("Leave empty to remove anchor."),anchor:CQ.themes.Dialog.ANCHOR}];
CQ.Util.applyDefaults(B,{title:CQ.I18n.getMessage("Anchor"),items:[{xtype:"panel",layout:"fit",items:[{xtype:"panel",layout:"form",cls:"cq-rte-anchordialog",border:false,items:A}]}]});
CQ.form.rte.plugins.AnchorDialog.superclass.constructor.call(this,B)
},getContainer:function(){return this.getComponent(0).getComponent(0)
},getName:function(){var D=null;
var C=this.getContainer();
var B=C.getComponent(0);
var A=B.getValue();
if(A.length>0){D=A
}return A
},resetValues:function(){var B=this.getContainer();
var A=B.getComponent(0);
A.setValue("")
},setAnchor:function(D){var C=this.getContainer();
var B=C.getComponent(0);
var A=D.dom.name;
if(A){B.setValue(A)
}}});
CQ.Ext.reg("rteanchordialog",CQ.form.rte.plugins.AnchorDialog);
CQ.form.rte.plugins.ListPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{orderedListUI:null,unorderedListUI:null,indentUI:null,outdentUI:null,constructor:function(A){CQ.form.rte.plugins.ListPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["ordered","unordered","indent","outdent"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("unordered")){this.unorderedListUI=new C.TbElement("insertunorderedlist",this,true,this.getTooltip("insertunorderedlist"));
A.addElement("lists",B.Plugin.SORT_LISTS,this.unorderedListUI,10)
}if(this.isFeatureEnabled("ordered")){this.orderedListUI=new C.TbElement("insertorderedlist",this,true,this.getTooltip("insertorderedlist"));
A.addElement("lists",B.Plugin.SORT_LISTS,this.orderedListUI,20)
}if(this.isFeatureEnabled("indent")){this.indentUI=new C.TbElement("indent",this,false,this.getTooltip("indent"));
A.addElement("lists",B.Plugin.SORT_LISTS,this.indentUI,40)
}if(this.isFeatureEnabled("outdent")){this.outdentUI=new C.TbElement("outdent",this,false,this.getTooltip("outdent"));
A.addElement("lists",B.Plugin.SORT_LISTS,this.outdentUI,30)
}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{features:"*",indentSize:40,keepStructureOnUnlist:false,tooltips:{insertunorderedlist:{title:CQ.I18n.getMessage("Bullet List"),text:CQ.I18n.getMessage("Start a bulleted list.")},insertorderedlist:{title:CQ.I18n.getMessage("Numbered List"),text:CQ.I18n.getMessage("Start a numbered list.")},indent:{title:CQ.I18n.getMessage("Indent"),text:CQ.I18n.getMessage("Indents the selected paragraph(s) or list item(s).")},outdent:{title:CQ.I18n.getMessage("Outdent"),text:CQ.I18n.getMessage("Outdents the current paragraph(s) or list item(s).")}}});
this.config=A
},execute:function(B){var A=undefined;
if((B=="indent")||(B=="outdent")){A=this.config.indentSize
}else{if(CQ.form.rte.Common.strStartsWith(B,"insert")){A=this.config.keepStructureOnUnlist
}}this.editorKernel.relayCmd(B,A)
},updateState:function(H){var B=H.editContext;
var A,L;
if(this.orderedListUI){A=this.editorKernel.queryState("insertorderedlist",H);
L=(A==null)||(A==CQ.form.rte.commands.List.NO_LIST_AVAILABLE);
this.orderedListUI.getExtUI().toggle((A===true)||(A==null));
this.orderedListUI.getExtUI().setDisabled(L)
}if(this.unorderedListUI){A=this.editorKernel.queryState("insertunorderedlist",H);
L=(A==null)||(A==CQ.form.rte.commands.List.NO_LIST_AVAILABLE);
this.unorderedListUI.getExtUI().toggle((A===true)||(A==null));
this.unorderedListUI.getExtUI().setDisabled(L)
}if(this.outdentUI){this.outdentUI.getExtUI().setDisabled(!this.editorKernel.queryState("indent",H))
}if(this.indentUI){var K=true;
var C=H.nodeList.getTags(B,[{matcher:function(M){return CQ.form.rte.Common.isTag(M,"li")
}}],true,true);
var G=C.length;
for(var F=0;
F<G;
F++){var I=C[F].dom;
if(!I.previousSibling){var D=I.parentNode.parentNode;
var E=false;
for(var J=0;
J<G;
J++){if(C[J].dom==D){E=true;
break
}}if(!E){K=false;
break
}}}this.indentUI.getExtUI().setDisabled(!K)
}}});
CQ.form.rte.plugins.PluginRegistry.register("lists",CQ.form.rte.plugins.ListPlugin);
CQ.form.rte.plugins.MiscToolsPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{specialCharsUI:null,sourceEditUI:null,specialCharsDialog:null,savedRange:null,constructor:function(A){CQ.form.rte.plugins.MiscToolsPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["specialchars","sourceedit"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("specialchars")){this.specialCharsUI=new C.TbElement("specialchars",this,false,this.getTooltip("specialchars"));
A.addElement("misc",B.Plugin.SORT_MISC,this.specialCharsUI,100)
}if(this.isFeatureEnabled("sourceedit")){this.sourceEditUI=new C.TbElement("sourceedit",this,true,this.getTooltip("sourceedit"));
A.addElement("misc",B.Plugin.SORT_MISC,this.sourceEditUI,110)
}},insertSpecialChars:function(C){if(!this.specialCharsDialog){var D=this.editorKernel;
var A={title:CQ.I18n.getMessage("Insert special character"),modal:true,width:450,height:300,buttons:CQ.Dialog.CANCEL,insertCharacter:function(E){this.insertCharacter(this.editContext,E)
}.createDelegate(this),listeners:{show:function(){D.fireUIEvent("dialogshow")
},hide:function(){D.fireUIEvent("dialoghide")
}}};
var B=this.config.specialCharsConfig||{};
B["jcr:primaryType"]="cq:RTESpecialCharsDialog";
B.xtype="rtespecialcharsdialog";
CQ.Util.applyDefaults(B,A);
this.specialCharsDialog=CQ.WCM.getDialog(B);
this.specialCharsDialog.editContext=C
}if(CQ.Ext.isIE){this.savedRange=C.doc.selection.createRange()
}this.specialCharsDialog.show();
window.setTimeout(function(){this.specialCharsDialog.toFront()
}.createDelegate(this),10)
},insertCharacter:function(A,B){if(CQ.Ext.isIE){this.savedRange.select()
}this.editorKernel.relayCmd("InsertHTML",B)
},notifyPluginConfig:function(A){A=A||{};
var B={specialCharsConfig:{tableCls:"cq-rte-scd-table",cellCls:"cq-rte-scd-cell",overCls:"cq-rte-scd-cell-over",magnifyCls:"cq-rte-scd-magnify",chars:{copyright:{entity:"&copy;"},registered:{entity:"&reg;"},trademark:{entity:"&trade;"}}},tooltips:{sourceedit:{title:CQ.I18n.getMessage("Source Edit"),text:CQ.I18n.getMessage("Switch to source editing mode.")},specialchars:{title:CQ.I18n.getMessage("Special characters"),text:CQ.I18n.getMessage("Insert a special character.")}}};
if(A.specialCharsConfig&&A.specialCharsConfig.chars){delete B.specialCharsConfig.chars
}CQ.Util.applyDefaults(A,B);
this.config=A
},execute:function(D,C,A){var B=A.editContext;
if(D=="specialchars"){this.insertSpecialChars(B)
}else{if((D=="sourceedit")&&this.sourceEditUI){this.editorKernel.requestSourceEdit.defer(1,this.editorKernel,[this.sourceEditUI.getExtUI().pressed])
}}},updateState:function(D){var C=D.editContext;
if(this.specialCharsUI!=null){var B=D.nodeList.getTags(C,[{tagName:["td","th"]}],false);
var A=(B.length>0);
this.specialCharsUI.getExtUI().setDisabled(A)
}}});
CQ.form.rte.plugins.PluginRegistry.register("misctools",CQ.form.rte.plugins.MiscToolsPlugin);
CQ.form.rte.plugins.SpecialCharsDialog=CQ.Ext.extend(CQ.Dialog,{editContext:null,charsInTable:null,backRef:null,constructor:function(A){var E=CQ.form.rte.plugins.SpecialCharsDialog.SPECIAL_CHARS_PER_ROW;
var K="<table";
if(A.tableCls){K+=' class="'+A.tableCls+'"'
}K+="><tr><td";
if(A.magnifyCls){K+=' class="'+A.magnifyCls+'"'
}K+=">&nbsp;</td></tr></table>";
var F="<table";
if(A.tableCls){F+=' class="'+A.tableCls+'"'
}F+=">";
this.chars=A.chars;
this.charsInTable=[];
var G=0;
for(var H in this.chars){if(this.chars.hasOwnProperty(H)){var D=this.chars[H];
var B;
if(D.entity){B=G%E;
if(B==0){F+="<tr>"
}F+="<td";
if(A.cellCls!=null){F+=' class="'+A.cellCls+'"'
}F+=">";
F+=D.entity;
F+="</td>";
this.charsInTable.push(D.entity);
if(B==(E-1)){F+="</tr>"
}G++
}else{if((D.rangeStart)&&(D.rangeEnd)){for(var J=D.rangeStart;
J<=D.rangeEnd;
J++){var C="&#"+J+";";
B=G%E;
if(B==0){F+="<tr>"
}F+="<td";
if(A.cellCls!=null){F+=' class="'+A.cellCls+'"'
}F+=">";
F+=C;
F+="</td>";
this.charsInTable.push(C);
if(B==(E-1)){F+="</tr>"
}G++
}}}}}B=G%E;
if(B>0){for(;
B<E;
B++){F+="<td>&nbsp;</td>"
}F+="</tr>"
}F+="</table>";
delete A.chars;
delete A.tableCls;
delete A.cellCls;
delete A.magnifyCls;
var I=this;
CQ.Util.applyDefaults(A,{title:CQ.I18n.getMessage("Insert special character"),items:[{xtype:"panel",layout:"border",items:[{xtype:"panel",region:"center",cls:"cq-rte-specialcharsdialog",border:false,html:F,autoScroll:true,afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
var R=this.body.dom.firstChild;
var S;
if(CQ.Ext.isIE){S=R.cells
}else{S=[];
var U=R.rows;
for(var L=0;
L<U.length;
L++){var T=U[L];
for(var P=0;
P<T.childNodes.length;
P++){if(T.childNodes[P].nodeType==1){S.push(T.childNodes[P])
}}}}var N=I.charsInTable.length;
for(var O=0;
O<N;
O++){var Q=S[O];
var M=CQ.Ext.get(Q);
Q.charToInsert=I.charsInTable[O];
CQ.Ext.EventManager.on(M,"click",function(){I.hide();
I.insertCharacter(this.charToInsert)
});
CQ.Ext.EventManager.on(M,"mouseover",function(){if(I.overCls){var V=CQ.Ext.get(this);
V.addClass(I.overCls)
}if(I.magnifierCell){I.magnifierCell.innerHTML=this.charToInsert
}});
CQ.Ext.EventManager.on(M,"mouseout",function(){if(I.overCls){var V=CQ.Ext.get(this);
V.removeClass(I.overCls)
}if(I.magnifierCell){I.magnifierCell.innerHTML="&nbsp;"
}})
}}},{xtype:"panel",region:"east",cls:"cq-rte-specialcharsdialog",width:70,border:false,html:K,afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
var L=this.body.dom.firstChild;
var M=L.rows[0];
I.magnifierCell=M.childNodes[0]
}}]}]});
CQ.form.rte.plugins.SpecialCharsDialog.superclass.constructor.call(this,A)
}});
CQ.form.rte.plugins.SpecialCharsDialog.SPECIAL_CHARS_PER_ROW=16;
CQ.Ext.reg("rtespecialcharsdialog",CQ.form.rte.plugins.SpecialCharsDialog);
CQ.form.rte.plugins.ParagraphFormatPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{cachedFormats:null,formatUI:null,constructor:function(A){CQ.form.rte.plugins.ParagraphFormatPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["paraformat"]
},getFormatId:function(E){var B=E.tagName.toLowerCase();
var A=this.getFormats();
var D=A.length;
for(var C=0;
C<D;
C++){var F=A[C];
if(F.tag&&(F.tag==B)){return F.tag
}}return null
},getFormats:function(){var A=CQ.form.rte.Common;
if(this.cachedFormats==null){this.cachedFormats=this.config.formats||{};
A.removeJcrData(this.cachedFormats);
this.cachedFormats=A.toArray(this.cachedFormats,"tag","description")
}return this.cachedFormats
},getFormatById:function(A,D){var C=A.length;
for(var B=0;
B<C;
B++){if(A[B].tag==D){return A[B]
}}return null
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("paraformat")){this.formatUI=new C.TbParaFormatter("paraformat",this,null,this.getFormats());
A.addElement("paraformat",B.Plugin.SORT_PARAFORMAT,this.formatUI,10)
}},notifyPluginConfig:function(A){A=A||{};
var B={formats:[{tag:"p",description:CQ.I18n.getMessage("Paragraph")},{tag:"h1",description:CQ.I18n.getMessage("Heading 1")},{tag:"h2",description:CQ.I18n.getMessage("Heading 2")},{tag:"h3",description:CQ.I18n.getMessage("Heading 3")}]};
if(A.formats){delete B.formats
}CQ.Util.applyDefaults(A,B);
this.config=A
},execute:function(A){if(this.formatUI){var B=this.formatUI.getSelectedFormat();
if(B){this.editorKernel.relayCmd("format",this.getFormatById(this.getFormats(),B))
}}},updateState:function(J){if(!this.formatUI||!this.formatUI.getExtUI()){return 
}var G=CQ.form.rte.Common;
var A=CQ.form.rte.DomProcessor;
var D=null;
var S=J.nodeList;
var R=S.commonAncestor;
var C=false;
var I={};
var H=0;
var M=0;
var B=null;
while(R){if(R.nodeType==1){D=this.getFormatId(R);
if(D){I[D]=true;
C=true;
M++;
break
}else{if(G.isTag(R,A.AUXILIARY_ROOT_TAGS)){if(B==null){B=R
}}}}R=R.parentNode
}if(!C){var P=S.nodes.length;
for(var O=0;
O<P;
O++){R=S.nodes[O];
if(R.dom.nodeType==1){var Q=this.getFormatId(R.dom);
if(Q){if(!I[Q]){I[Q]=true;
M++
}if(D==null){D=Q
}}else{H++
}}else{H++
}}}var N=-1;
var L=this.formatUI.getExtUI().dom;
if((D!=null)&&(M==1)&&(H==0)){var E=L.options;
for(var K=0;
K<E.length;
K++){var F=E[K];
if(F.value==D){N=K;
break
}}}L.disabled=(H>0)&&(B==null);
L.selectedIndex=N
}});
CQ.form.rte.plugins.PluginRegistry.register("paraformat",CQ.form.rte.plugins.ParagraphFormatPlugin);
CQ.form.rte.plugins.StylesPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{cachedStyles:null,stylesUI:null,constructor:function(A){CQ.form.rte.plugins.StylesPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["styles"]
},reportStyles:function(){return[{type:"text",styles:this.getStyles()}]
},getStyles:function(){var A=CQ.form.rte.Common;
if(!this.cachedStyles){this.cachedStyles=this.config.styles||{};
A.removeJcrData(this.cachedStyles);
this.cachedStyles=A.toArray(this.cachedStyles,"cssName","text")
}return this.cachedStyles
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("styles")){this.stylesUI=new C.TbStyleSelector("styles",this,null,this.getStyles());
A.addElement("styles",B.Plugin.SORT_STYLES,this.stylesUI,10)
}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{styles:{}});
this.config=A
},execute:function(A){if(!this.stylesUI){return 
}var C=null;
var B=null;
switch(A.toLowerCase()){case"styles":C="applystyle";
B=this.stylesUI.getSelectedStyle();
break;
case"styles_remove":C="removestyle";
B={styles:this.getStyles()};
break
}if(C){this.editorKernel.relayCmd(C,B)
}},updateState:function(I){if(!this.stylesUI||!this.stylesUI.getExtUI()){return 
}var G=CQ.form.rte.Common;
var J=I.styles;
var Q=[];
var P,M;
var B=I.selectedDom;
if(B){if(!CQ.form.rte.Common.isTag(I.selectedDom,CQ.form.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS)){B=null
}}var O=this.stylesUI.getExtUI().dom;
var H=this.stylesUI.getRemoveButtonUI();
var S=this.getStyles();
var N=S.length;
if(B){for(M=0;
M<N;
M++){var F=S[M].cssName;
if(G.hasCSS(B,F)){Q.push({className:F})
}}}else{var C=J.length;
for(var R=0;
R<C;
R++){var A=J[R];
for(M=0;
M<N;
M++){if(S[M].cssName==A.className){Q.push(A);
break
}}}}if(Q.length==0){P=0
}else{if(Q.length>1){P=-1
}else{if(I.isContinuousStyle||B){var K=Q[0];
var D=O.options;
for(var L=0;
L<D.length;
L++){var E=D[L];
if(E.value==K.className){P=L;
break
}}}else{P=-1
}}}O.selectedIndex=P;
if(B!=null){O.disabled=false;
H.setDisabled(P==0)
}else{if(I.isSelection){O.disabled=!((P==0)&&this.getStyles());
H.disable(true)
}else{H.setDisabled(P==0);
O.disabled=true
}}}});
CQ.form.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS=["img"];
CQ.form.rte.plugins.PluginRegistry.register("styles",CQ.form.rte.plugins.StylesPlugin);
CQ.form.rte.plugins.SubSuperScriptPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{subscriptUI:null,superscriptUI:null,constructor:function(A){CQ.form.rte.plugins.SubSuperScriptPlugin.superclass.constructor.call(this,A)
},getFeatures:function(){return["subscript","superscript"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("subscript")){this.subscriptUI=new C.TbElement("subscript",this,true,this.getTooltip("subscript"));
A.addElement("format",B.Plugin.SORT_FORMAT,this.subscriptUI,100)
}if(this.isFeatureEnabled("superscript")){this.superscriptUI=new C.TbElement("superscript",this,true,this.getTooltip("superscript"));
A.addElement("format",B.Plugin.SORT_FORMAT,this.superscriptUI,110)
}},execute:function(A){this.editorKernel.relayCmd(A)
},updateState:function(B){var A=this.editorKernel.queryState("subscript",B);
var C=this.editorKernel.queryState("superscript",B);
if(this.subscriptUI!=null){this.subscriptUI.getExtUI().setDisabled(!B.isSelection);
this.subscriptUI.getExtUI().toggle(A)
}if(this.superscriptUI!=null){this.superscriptUI.getExtUI().setDisabled(!B.isSelection);
this.superscriptUI.getExtUI().toggle(C)
}},notifyPluginConfig:function(A){A=A||{};
var B={tooltips:{subscript:{title:CQ.I18n.getMessage("Subscript"),text:CQ.I18n.getMessage("Formats the selected text as subscript.")},superscript:{title:CQ.I18n.getMessage("Superscript"),text:CQ.I18n.getMessage("Formats the selected text as superscript.")}}};
CQ.Util.applyDefaults(A,B);
this.config=A
}});
CQ.form.rte.plugins.PluginRegistry.register("subsuperscript",CQ.form.rte.plugins.SubSuperScriptPlugin);
CQ.form.rte.plugins.TablePlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{tableUI:null,insertRowBeforeUI:null,insertRowAfterUI:null,removeRowUI:null,insertColBeforeUI:null,insertColAfterUI:null,removeColUI:null,tableSelection:null,constructor:function(A){CQ.form.rte.plugins.TablePlugin.superclass.constructor.call(this,A);
A.addPluginListener("mousedown",this.clearSelectionHandler,this,this,false);
A.addPluginListener("mouseup",this.addSelectionHandler,this,this,false);
A.addPluginListener("keydown",this.handleSelectionOnKey,this,this,false);
A.addPluginListener("commandexecuted",this.clearSelectionHandler,this,this,false);
A.addPluginListener("beforekeydown",this.handleTableKeys,this,this,false,250)
},isTableMode:function(){return(this.config.editMode==CQ.form.rte.plugins.TablePlugin.EDITMODE_TABLE)
},handleTableKeys:function(G){if(G.cancelKey){return 
}var D=CQ.form.rte.Common;
var C=CQ.form.rte.Selection;
var B=G.editContext;
var K=G.extEvent.getKey();
var J;
if(this.isTableMode()){if(CQ.Ext.isIE){J=this.editorKernel.createQualifiedSelection(B);
if(!J||D.isRootNode(B,J.startNode)){var N=D.getChildNodesByType(B.root,["th","td"],true,"table");
if(N.length>0){var E;
if(J&&(J.startOffset==0)){E=N[0]
}else{E=N[N.length-1]
}C.selectNode(B,E,true)
}G.cancelKey=true
}}}if((K==G.extEvent.TAB)&&!G.cancelKey){if(!J){J=this.editorKernel.createQualifiedSelection(B)
}if(!C.isSelection(J)){this.editorKernel.execCmd("addundostep");
var F=CQ.form.rte.commands.Table.getCellFromSelection(B,J);
if(F){var M;
var P=F.parentNode;
N=D.getChildNodesByType(P,D.TABLE_CELLS,false);
var H=D.arrayIndex(N,F)+1;
if(H<N.length){M=N[H]
}else{var L=P.parentNode;
var O=D.getChildNodesByType(L,"tr",false);
var I=D.arrayIndex(O,P)+1;
if(I<O.length){P=O[I];
N=D.getChildNodesByType(P,D.TABLE_CELLS,false);
M=N[0]
}}if(M==null){this.editorKernel.relayCmd("insertrow",{position:"after",caret:"firstCell"})
}if(M!=null){var A=(CQ.Ext.isIE?null:C.getPreferredScrollOffset(B));
C.selectNode(B,M,true);
if(CQ.Ext.isGecko&&B.iFrame){C.ensureCaretVisibility(B,B.iFrame,A)
}}G.cancelKey=true
}}}},handleSelectionOnKey:function(B){if(this.tableSelection){var A=B.extEvent.getKey();
if((A==B.extEvent.BACKSPACE)||(A==B.extEvent.DELETE)){this.clearSelectionContent(B.editContext)
}}this.clearSelectionHandler(B)
},addSelectionHandler:function(H){var B=CQ.form.rte.Common;
var G=CQ.form.rte.Selection;
var D=false;
var E=(H.name=="mouseup")&&(H.extEvent.button==0)&&H.extEvent.ctrlKey;
if(E&&CQ.Ext.isIE){var C=H.editContext;
var F=G.createProcessingSelection(C);
var A=CQ.form.rte.commands.Table.getCellFromSelection(C,F);
if(A){if(A){this.addCellToSelection(A);
H.extEvent.preventDefault()
}D=true
}}return D
},clearSelectionHandler:function(F){var B=CQ.form.rte.Common;
var A=F.editContext;
var D=(F.name=="mousedown")&&(F.extEvent.button==0)&&F.extEvent.ctrlKey;
if(this.tableSelection){var G=false;
if(F.name=="keydown"){if(F.extEvent.getKey()>=32){G=true
}}else{if(F.name=="mousedown"){G=!D&&(F.extEvent.button!=2)
}else{if(F.name=="commandexecuted"){switch(F.cmd){case"removetable":this.tableSelection=null;
break;
case"addundostep":break;
default:G=true;
break
}}}}if(G){this.removeTableSelection()
}}if(F.name=="commandexecuted"){if(CQ.Ext.isGecko){var E=false;
var I=F.editContext.win.getSelection();
if(I.rangeCount>1){E=true
}else{if(I.rangeCount==1){var H=I.getRangeAt(0);
var C=H.commonAncestorContainer;
if(C&&(B.getTagInPath(A,C,"table"))){E=true
}}}if(E){CQ.form.rte.Selection.flushSelection(F.editContext,true)
}}}},addTableSelection:function(C){var B=CQ.form.rte.Common;
if(this.tableSelection){this.removeTableSelection()
}var E=C.length;
for(var D=0;
D<E;
D++){var A=C[D];
B.addClass(A,CQ.themes.RichText.TABLESELECTION_CLASS)
}this.tableSelection=C
},addCellToSelection:function(B){var A=CQ.form.rte.Common;
if(!this.tableSelection){this.tableSelection=[]
}A.addClass(B,CQ.themes.RichText.TABLESELECTION_CLASS);
this.tableSelection.push(B)
},removeTableSelection:function(){var B=CQ.form.rte.Common;
var D=this.tableSelection.length;
for(var C=0;
C<D;
C++){var A=this.tableSelection[C];
B.removeClass(A,CQ.themes.RichText.TABLESELECTION_CLASS)
}this.tableSelection=null
},clearSelectionContent:function(C){var D=CQ.form.rte.DomProcessor;
var H=this.tableSelection.length;
for(var G=0;
G<H;
G++){var A=this.tableSelection[G];
var B=A.childNodes.length;
for(var F=B-1;
F>=0;
F--){A.removeChild(A.childNodes[0])
}var E=D.createEmptyLinePlaceholder(C,false);
if(E){A.appendChild()
}}},createOrEditTable:function(I,D){var B=I.editContext;
this.savedRange=I.savedRange;
this.editorKernel.selectQualifiedRangeBookmark(B,this.savedRange);
var H=this.editorKernel.queryState("table");
var F;
var C=null;
if(H&&!D){F={editContext:B,cmd:"modifytable",table:H}
}else{C=CQ.form.rte.Compatibility.getConfigValue(this.config,"defaultValues.tableTemplate");
if(!C){F={cmd:"createtable",table:null}
}}var A=this.editorKernel;
if(!C&&F){F.listeners={show:function(){A.fireUIEvent("dialogshow")
},hide:function(){A.fireUIEvent("dialoghide")
}}
}if(C){this.editorKernel.selectQualifiedRangeBookmark(B,this.savedRange);
this.editorKernel.relayCmd("createtable",{html:C})
}else{F.editContext=B;
F.pluginConfig=this.config;
F.execFn=this.execCreateOrEditTable.createDelegate(this);
var G=new CQ.form.rte.plugins.TablePropertiesDialog(F);
var E=this.editorKernel.calculateWindowPosition("default");
G.show();
G.setPosition(E);
window.setTimeout(function(){G.toFront();
G.focus()
}.createDelegate(this),10)
}},execCreateOrEditTable:function(C,B,A){this.editorKernel.selectQualifiedRangeBookmark(A,this.savedRange);
if(C&&B){this.editorKernel.relayCmd(C,B)
}},editCellProps:function(C){var E=C.editContext;
this.savedRange=C.savedRange;
this.editorKernel.selectQualifiedRangeBookmark(E,this.savedRange);
var A;
if(C&&C.selectionContext){var B=C.selectionContext;
A=CQ.form.rte.commands.Table.getCellFromNodeList(E,B.nodeList)
}else{A=this.editorKernel.queryState("modifycell")
}if(!A){return 
}var G=this.editorKernel;
var D=new CQ.form.rte.plugins.CellPropertiesDialog({editContext:E,pluginConfig:this.config,cell:A,execFn:this.execEditCellProps.createDelegate(this),listeners:{show:function(){G.fireUIEvent("dialogshow")
},hide:function(){G.fireUIEvent("dialoghide")
}}});
var F=this.editorKernel.calculateWindowPosition("default");
D.show();
D.setPosition(F);
window.setTimeout(function(){D.toFront();
D.focus()
},10)
},execEditCellProps:function(A,B){this.editorKernel.selectQualifiedRangeBookmark(B,this.savedRange);
if(A){this.editorKernel.relayCmd("modifyCell",A)
}},selectRow:function(E){var D=E.tableMatrix;
var A=E.cell;
var B=D.getCellDef(A);
var F=D.getRow(B.row);
var C=[];
for(var G=0;
G<F.length;
G++){C[G]=F[G].cellDom
}this.addTableSelection(C)
},selectColumn:function(F){var E=F.tableMatrix;
var A=F.cell;
var B=E.getCellDef(A);
var D=E.getColumn(B.col);
var C=[];
for(var G=0;
G<D.length;
G++){C[G]=D[G].cellDom
}this.addTableSelection(C)
},getFeatures:function(){return["table","removetable","insertrow","removerow","insertcolumn","removecolumn","cellprops","mergecells","splitcell","selectrow","selectcolumn"]
},reportStyles:function(){var A=CQ.form.rte.Compatibility;
var C=[];
var D=this.config.tableStyles;
if(D!=null){D=A.convertToArray(D,"cssName","text");
A.changeDeprecatedPropertyName(D,"className","cssName");
C.push({type:"table",styles:D})
}var B=this.config.cellStyles;
if(B!=null){B=A.convertToArray(B,"cssName","text");
A.changeDeprecatedPropertyName(B,"className","cssName");
C.push({type:"cell",styles:B})
}return(C.length>0?C:null)
},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{tableStyles:null,cellStyles:null,defaultValues:{cellspacing:"0",cellpadding:"1",border:"1",columns:"3",rows:"2",header:"none"},tablePropConfig:{basicDefs:true,basicStyling:true},cellPropConfig:{basicDefs:true},tooltips:{table:{title:CQ.I18n.getMessage("Table"),text:CQ.I18n.getMessage("Creates a new table or edits the properties of an existing table.")}}});
this.config=A
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(!this.isTableMode()){if(this.isFeatureEnabled("table")){this.tableUI=new C.TbElement("table",this,false,this.getTooltip("table"));
A.addElement("table",B.Plugin.SORT_TABLE,this.tableUI,10)
}}else{if(this.isFeatureEnabled("table")){this.tableUI=new C.TbElement("table",this,false,this.getTooltip("table"),"x-edit-table-properties");
A.addElement("table",B.Plugin.SORT_TABLE_TABLEMODE,this.tableUI,10)
}if(this.isFeatureEnabled("cellprops")){this.cellPropsUI=new C.TbElement("cellprops",this,false,null);
A.addElement("table",B.Plugin.SORT_TABLE_TABLEMODE,this.cellPropsUI,20)
}if(this.isFeatureEnabled("insertrow")){this.insertRowBeforeUI=new C.TbElement("insertrow-before",this,false,null,null,{cmd:"insertrow",cmdValue:"before"});
A.addElement("table.row",B.Plugin.SORT_TABLE_TABLEMODE+1,this.insertRowBeforeUI,10);
this.insertRowAfterUI=new C.TbElement("insertrow-after",this,false,null,null,{cmd:"insertrow",cmdValue:"after"});
A.addElement("table.row",B.Plugin.SORT_TABLE_TABLEMODE+1,this.insertRowAfterUI,20)
}if(this.isFeatureEnabled("removerow")){this.removeRowUI=new C.TbElement("removerow",this,false,null);
A.addElement("table.row",B.Plugin.SORT_TABLE_TABLEMODE+1,this.removeRowUI,30)
}if(this.isFeatureEnabled("insertcolumn")){this.insertColBeforeUI=new C.TbElement("insertcolumn-before",this,false,null,null,{cmd:"insertcolumn",cmdValue:"before"});
A.addElement("table.col",B.Plugin.SORT_TABLE_TABLEMODE+2,this.insertColBeforeUI,10);
this.insertColAfterUI=new C.TbElement("insertcolumn-after",this,false,null,null,{cmd:"insertcolumn",cmdValue:"after"});
A.addElement("table.col",B.Plugin.SORT_TABLE_TABLEMODE+2,this.insertColAfterUI,20)
}if(this.isFeatureEnabled("removecolumn")){this.removeColUI=new C.TbElement("removecolumn",this,false,null);
A.addElement("table.col",B.Plugin.SORT_TABLE_TABLEMODE+2,this.removeColUI,30)
}}},execute:function(A,E,B){var C=B.editContext;
if(!B.savedRange){B.savedRange=this.editorKernel.createQualifiedRangeBookmark(C)
}var D=A;
var F=A.indexOf(".",A);
if(F>0){D=A.substring(0,F);
E=A.substring(F+1,A.length)
}if(D=="table"){this.createOrEditTable(B,false)
}else{if(D=="createtable"){this.createOrEditTable(B,true)
}else{if(D=="cellprops"){this.editCellProps(B)
}else{if(D=="selectrow"){this.selectRow(E);
this.editorKernel.deferFocus()
}else{if(D=="selectcolumn"){this.selectColumn(E);
this.editorKernel.deferFocus()
}else{this.editorKernel.relayCmd(D,E)
}}}}}},updateState:function(G){if(this.isTableMode()){var B=G.editContext;
var C=CQ.form.rte.Common;
var D=G.nodeList;
var F=CQ.form.rte.commands.Table.getCellFromNodeList(B,D);
var A=(F!=null);
var H=C.getTagInPath(B,D.commonAncestor,"table");
if(H){var E=new CQ.form.rte.TableMatrix();
E.createTableMatrix(H);
var I=E.getTableSize();
this.removeRowUI.getExtUI().setDisabled((I.rows==1)||!A);
this.removeColUI.getExtUI().setDisabled((I.cols==1)||!A);
this.insertColBeforeUI.getExtUI().setDisabled(!A);
this.insertColAfterUI.getExtUI().setDisabled(!A);
this.insertRowBeforeUI.getExtUI().setDisabled(!A);
this.insertRowAfterUI.getExtUI().setDisabled(!A)
}}},handleContextMenu:function(I,J,C){var B=this.isTableMode();
var H=CQ.form.rte.Common;
var Q=CQ.form.rte.ui;
var W=J.nodeList;
var Y=J.selection;
var U=CQ.form.rte.commands.Table.getCellFromNodeList(C,W);
var F=(U!=null);
var L=H.getTagInPath(C,W.commonAncestor,"table");
var X=F||(L!=null);
var E=null;
var R;
var S=true;
var T=true;
if(X){R=new CQ.form.rte.TableMatrix();
R.createTableMatrix(L);
if(B){var P=R.getTableSize();
S=(P.cols>1);
T=(P.rows>1)
}}if(X&&!F){if(Y.cellSelection){E=R.createSelection(Y.cellSelection.cells)
}}var V=[];
if(F){if(this.isFeatureEnabled("cellprops")){V.push({text:CQ.I18n.getMessage("Cell properties"),plugin:this,cmd:"cellprops",iconCls:"rte-cellprops"})
}}if(E!=null){if(this.isFeatureEnabled("mergecells")){if(E.selectionProps.isRect){V.push({text:CQ.I18n.getMessage("Merge cells"),plugin:this,cmd:"mergecells",cmdValue:E,iconCls:"rte-cellmerge"})
}}}else{if(F){if(this.isFeatureEnabled("mergecells")){var K=R.getCellInfo(U);
if(!K.isLastCol){E=R.createSelection(U);
E.expand(1,0);
V.push({text:CQ.I18n.getMessage("Merge right"),plugin:this,cmd:"mergecells",cmdValue:E,iconCls:"rte-cellmerge"})
}if(!K.isLastRow){E=R.createSelection(U);
E.expand(0,1);
V.push({text:CQ.I18n.getMessage("Merge down"),plugin:this,cmd:"mergecells",cmdValue:E,iconCls:"rte-cellmerge"})
}}}}if(F){if(this.isFeatureEnabled("splitcell")){V.push({text:CQ.I18n.getMessage("Split cell horizontally"),plugin:this,cmd:"splitcell",cmdValue:"horizontal",iconCls:"rte-cellsplit-horizontal"});
V.push({text:CQ.I18n.getMessage("Split cell vertically"),plugin:this,cmd:"splitcell",cmdValue:"vertical",iconCls:"rte-cellsplit-vertical"})
}}if(V.length>0){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Cell"),subItems:V,iconCls:"rte-cell"}))
}if(F){var D=[];
if(this.isFeatureEnabled("insertcolumn")){D.push({text:CQ.I18n.getMessage("Insert before"),plugin:this,cmd:"insertcolumn",cmdValue:"before",iconCls:"rte-insertcolumn-before"});
D.push({text:CQ.I18n.getMessage("Insert after"),plugin:this,cmd:"insertcolumn",cmdValue:"after",iconCls:"rte-insertcolumn-after"})
}if(this.isFeatureEnabled("removecolumn")&&S){D.push({text:CQ.I18n.getMessage("Remove"),plugin:this,cmd:"removecolumn",iconCls:"rte-removecolumn"})
}if(D.length>0){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Column"),subItems:D,iconCls:"rte-column"}))
}}if(F){var G=[];
if(this.isFeatureEnabled("insertrow")){G.push({text:CQ.I18n.getMessage("Insert before"),plugin:this,cmd:"insertrow",cmdValue:"before",iconCls:"rte-insertrow-before"});
G.push({text:CQ.I18n.getMessage("Insert after"),plugin:this,cmd:"insertrow",cmdValue:"after",iconCls:"rte-insertrow-after"})
}if(this.isFeatureEnabled("removerow")&&T){G.push({text:CQ.I18n.getMessage("Remove"),plugin:this,cmd:"removerow",iconCls:"rte-removerow"})
}if(G.length>0){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Row"),subItems:G,iconCls:"rte-row"}))
}if(this.isFeatureEnabled("table")){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Table properties"),plugin:this,cmd:"table",iconCls:"rte-tableprops"}))
}if(this.isFeatureEnabled("removetable")&&!B){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Remove table"),plugin:this,cmd:"removetable",iconCls:"rte-removetable"}))
}if(this.isFeatureEnabled("table")){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Create nested table"),plugin:this,cmd:"createtable",iconCls:"rte-createtable"}))
}var M=false;
if(this.isFeatureEnabled("selectrow")&&F){if(!M){I.addItem(new Q.CmSeparator());
M=true
}I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Select entire row"),plugin:this,cmd:"selectrow",cmdValue:{tableMatrix:R,cell:U}}))
}if(this.isFeatureEnabled("selectcolumn")&&F){if(!M){I.addItem(new Q.CmSeparator());
M=true
}I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Select entire column"),plugin:this,cmd:"selectcolumn",cmdValue:{tableMatrix:R,cell:U}}))
}if(!B){var A=L.parentNode;
if(H.isRootNode(C,A)){var O=H.getChildIndex(L);
if((O==0)||H.isTag(A.childNodes[O-1],"table")){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Insert paragraph before table"),plugin:this,cmd:"ensureparagraph",cmdValue:"before"}))
}if((O==(A.childNodes.length-1))||H.isTag(A.childNodes[O+1],"table")){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Insert paragraph after table"),plugin:this,cmd:"ensureparagraph",cmdValue:"after"}))
}}}}var N=(Y.startNode.nodeType==1)&&!Y.endNode&&(Y.startOffset==null);
if(!X&&!N){if(this.isFeatureEnabled("table")&&!B){I.addItem(new Q.CmItem({text:CQ.I18n.getMessage("Create table"),plugin:this,cmd:"table",iconCls:"rte-createtable"}))
}}},manipulateSelection:function(A){if(this.tableSelection){A.cellSelection={cells:this.tableSelection,otherContent:false}
}},saveRangeBookmark:function(A){if(this.tableSelection){A.cells=this.tableSelection
}},restoreRangeBookmark:function(A){if(A.cells){this.addTableSelection(A.cells)
}},createEmptyTableHTML:function(){var E=this.config.defaultValues||{};
if(E.tableTemplate){return E.tableTemplate
}var B=E.columns||1;
var G=E.rows||1;
var A="<table";
for(var D in E){if(E.hasOwnProperty(D)){if((D!="columns")&&(D!="rows")&&(D!="header")){A+=" "+D+'="'+CQ.Ext.util.Format.htmlEncode(E[D])+'"'
}}}A+=">";
for(var C=0;
C<G;
C++){A+="<tr>";
for(var F=0;
F<B;
F++){A+=CQ.form.rte.TableMatrix.createEmptyCellMarkup()
}A+="</tr>"
}A+="</table>";
return A
},interceptContent:function(I,D){var B=CQ.form.rte.Common;
var H=CQ.form.rte.DomProcessor;
if(!this.isTableMode()){return null
}var A=(D?D.editContext:null);
if(I=="emptyContent"){return this.createEmptyTableHTML()
}else{if(I=="postprocessDom"){CQ.form.rte.DomProcessor.removeNonTableBlocks(A)
}else{if(I=="cleanDom"){if(this.tableSelection){this.removeTableSelection()
}var F=D.root;
var K=CQ.Ext.DomQuery.select("table:first",F);
if(K&&(K.length==1)){var E=true;
K=K[0];
var J=B.getChildNodesByType(K,["td","th"],true);
for(var G=0;
G<J.length;
G++){var C=J[G];
if(C.childNodes.length>0){if(!H.isEmptyLinePlaceholder(C)){E=false;
break
}}}if(E){K.parentNode.removeChild(K)
}}}}}return null
}});
CQ.form.rte.plugins.TablePlugin.EDITMODE_DEFAULT="default";
CQ.form.rte.plugins.TablePlugin.EDITMODE_TABLE="table";
CQ.form.rte.plugins.PluginRegistry.register("table",CQ.form.rte.plugins.TablePlugin);
CQ.form.rte.plugins.TablePropertiesDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(C){if(!C){C={}
}this.table=C.table;
this.cmd=C.cmd;
this.editContext=C.editContext;
var B=C.pluginConfig;
this.execFn=C.execFn;
this.cancelFn=C.cancelFn;
var F=C.listeners;
this.tableStyles=B.tableStyles;
this.defaultValues=B.defaultValues;
var G=B.tablePropConfig.basicDefs;
var D=B.tablePropConfig.basicStyling;
var H=[];
if(G){if(!this.table){H.push({itemId:"columns",name:"columns",allowBlank:false,xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Columns"),regex:/^[1-9][0-9]*$/});
H.push({itemId:"rows",name:"rows",allowBlank:false,xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Rows"),regex:/^[1-9][0-9]*$/});
H.push({itemId:"header",name:"header",xtype:"selection",type:"select",options:[{value:"none",text:CQ.I18n.getMessage("No header")},{value:"top",text:CQ.I18n.getMessage("First row")},{value:"left",text:CQ.I18n.getMessage("First column")},{value:"topleft",text:CQ.I18n.getMessage("First row and column")}],fieldLabel:CQ.I18n.getMessage("Header")})
}H.push({itemId:"width",name:"width",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Width"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
H.push({itemId:"height",name:"height",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Height"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/})
}if(D){H.push({itemId:"border",name:"border",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Border"),regex:/^[0-9][0-9]?$/});
H.push({itemId:"cellpadding",name:"cellpadding",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Cell padding"),regex:/^[0-9][0-9]?$/});
H.push({itemId:"cellspacing",name:"cellspacing",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Cell spacing"),regex:/^[0-9][0-9]?$/})
}if(this.tableStyles){var E=[{value:"---",text:CQ.I18n.getMessage("[None]")}];
var I=this.tableStyles.length;
for(var K=0;
K<I;
K++){var A=this.tableStyles[K];
E.push({value:A.cssName,text:A.text})
}H.push({itemId:"tableStyle",name:"tableStyle",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Style"),options:E})
}var J=this;
CQ.form.rte.plugins.TablePropertiesDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Table properties"),stateful:false,minWidth:300,minHeight:300,width:300,height:350,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"tablePropForm",stateful:false,items:H,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
J.propertyItems=this.items;
this.body.addClass("cq-rte-tablepropsdialog");
var L=J.calculateTableConfig();
if(L){this.items.each(function(M){var O=M.itemId;
var N=L[O];
if(N||M.isXType("selection")){if(N==null){N="---"
}M.setValue(N)
}return true
},this)
}}}]}],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){this.applyDialog()
},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:F,modal:true})
},calculateTableConfig:function(){var A=CQ.form.rte.Common;
var B;
if(this.table){B={};
this.propertyItems.each(function(J){var E=J.itemId;
if(E=="tableStyle"){var H=this.tableStyles.length;
var C=CQ.form.rte.Common.parseCSS(this.table);
var I=false;
for(var F=0;
(F<C.length)&&!I;
F++){for(var K=0;
K<H;
K++){var D=this.tableStyles[K];
if(D.cssName==C[F]){B[E]=C[F];
I=true;
break
}}}}else{if(J.styleAttrib){B[E]=this.table.style[J.styleAttrib]
}else{var G=J.domProp||E;
B[E]=A.getAttribute(this.table,G)
}}return true
},this)
}else{B=this.defaultValues
}return B
},createTableConfig:function(){var A={};
this.propertyItems.each(function(B){var D=B.itemId;
var C=B.getValue();
if(B.isXType("selection")){if(C=="---"){C=null
}}if(C){A[D]=C
}return true
},this);
return A
},applyDialog:function(){var A=this.findBy(function(C){return(C.getItemId()=="tablePropForm")
});
if(A&&A.length==1){A=A[0];
var B=A.getForm();
if(B.isValid()){this.hide();
this.execFn(this.cmd,this.createTableConfig(),this.editContext)
}}},focus:function(){CQ.form.rte.plugins.TablePropertiesDialog.superclass.focus.call(this);
this.propertyItems.each(function(A){if(A.isXType("textfield")){A.focus.defer(1);
return false
}return true
})
}});
CQ.form.rte.plugins.CellPropertiesDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(C){C=C||{};
var B=C.pluginConfig;
this.cell=C.cell;
this.editContext=C.editContext;
this.execFn=C.execFn;
this.cancelFn=C.cancelFn;
var E=C.listeners;
this.cellStyles=B.cellStyles;
var F=B.cellPropConfig.basicDefs;
var G=[];
if(F){G.push({itemId:"width",name:"width",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Width"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
G.push({itemId:"height",name:"height",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Height"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
G.push({itemId:"align",name:"align",styleAttrib:"textAlign",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Horizontal align"),options:[{value:"---",text:CQ.I18n.getMessage("[None]")},{value:"left",text:CQ.I18n.getMessage("Left")},{value:"center",text:CQ.I18n.getMessage("Center")},{value:"right",text:CQ.I18n.getMessage("Right")}]});
G.push({itemId:"valign",name:"valign",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Vertical align"),options:[{value:"---",text:CQ.I18n.getMessage("[None]")},{value:"top",text:CQ.I18n.getMessage("Top")},{value:"middle",text:CQ.I18n.getMessage("Middle")},{value:"bottom",text:CQ.I18n.getMessage("Bottom")},{value:"baseline",text:CQ.I18n.getMessage("Baseline")}]})
}if(this.cellStyles){var D=[{value:"---",text:CQ.I18n.getMessage("[None]")}];
var H=this.cellStyles.length;
for(var J=0;
J<H;
J++){var A=this.cellStyles[J];
D.push({value:A.cssName,text:A.text})
}G.push({itemId:"cellStyle",name:"cellStyle",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Style"),options:D})
}G.push({itemId:"cellType",name:"cellType",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Cell type"),options:[{text:CQ.I18n.getMessage("[Change to ...]"),value:"---"},{text:CQ.I18n.getMessage("Data"),value:"td"},{text:CQ.I18n.getMessage("Header"),value:"th"}]});
G.push({itemId:"_applyTo",name:"_applyTo",xtype:"selection",type:"radio",fieldLabel:CQ.I18n.getMessage("Apply to ..."),value:"cell",options:[{value:"cell",text:CQ.I18n.getMessage("Single cell")},{value:"row",text:CQ.I18n.getMessage("Entire row")},{value:"column",text:CQ.I18n.getMessage("Entire column")}],optionsConfig:{getResizeEl:function(){return this.wrap
}}});
var I=this;
CQ.form.rte.plugins.CellPropertiesDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Cell properties"),stateful:false,minWidth:300,minHeight:300,width:300,height:350,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"cellPropForm",stateful:false,items:G,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
I.propertyItems=this.items;
this.body.addClass("cq-rte-cellpropsdialog");
var K=I.calculateCellConfig();
if(K){this.items.each(function(M){var O=M.itemId;
var L=!O||(O.charAt(0)=="_");
if(!L){var N=K[O];
if(N||M.isXType("selection")){if(N==null){N="---"
}M.setValue(N)
}}return true
},this)
}}}]}],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){this.applyDialog()
},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:E,modal:true})
},calculateCellConfig:function(){var A=CQ.form.rte.Common;
var B={};
this.propertyItems.each(function(J){var E=J.itemId;
if(E=="cellStyle"){var H=this.cellStyles.length;
var C=CQ.form.rte.Common.parseCSS(this.cell);
var I=false;
for(var F=0;
(F<C.length)&&!I;
F++){for(var K=0;
K<H;
K++){var D=this.cellStyles[K];
if(D.cssName==C[F]){B[E]=C[F];
I=true;
break
}}}}else{if(J.styleAttrib){if(this.cell.style[J.styleAttrib]){B[E]=this.cell.style[J.styleAttrib]
}}else{var G=J.domProp||E;
if(A.isAttribDefined(this.cell,G)){B[E]=A.getAttribute(this.cell,G)
}}}return true
},this);
return B
},createCellConfig:function(){var A={};
this.propertyItems.each(function(B){var D=B.itemId;
var C=B.getValue();
if(B.isXType("selection")){if(C=="---"){C=CQ.form.rte.commands.Table.CONFIG_NONE
}}if(C){A[D]=C
}return true
},this);
return A
},applyDialog:function(){var A=this.findBy(function(C){return(C.getItemId()=="cellPropForm")
});
if(A&&A.length==1){A=A[0];
var B=A.getForm();
if(B.isValid()){this.hide();
this.execFn(this.createCellConfig(),this.editContext)
}}}});
CQ.form.rte.plugins.ImagePlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{constructor:function(B){var A=CQ.form.rte.plugins;
A.ImagePlugin.superclass.constructor.call(this,B)
},getFeatures:function(){return["image"]
},notifyPluginConfig:function(A){this.config=A
},initializeUI:function(A){},execute:function(A,B,C){if(A=="image"){this.editorKernel.relayCmd("image",B)
}},updateState:function(A){},handleContextMenu:function(C,E,B){var A;
var D=CQ.form.rte.ui;
if(this.isFeatureEnabled("image")){if(this.editorKernel.queryState("image")){A=[{text:CQ.I18n.getMessage("Left"),plugin:this,cmd:"image",cmdValue:{"style.float":"left"}},{text:CQ.I18n.getMessage("Right"),plugin:this,cmd:"image",cmdValue:{"style.float":"right"}},{text:CQ.I18n.getMessage("None"),plugin:this,cmd:"image",cmdValue:{"style.float":"none"}},{text:CQ.I18n.getMessage("No alignment"),plugin:this,cmd:"image",cmdValue:{"style.float":""}}];
C.addItem(new D.CmItem({text:CQ.I18n.getMessage("Image alignment"),subItems:A}))
}}}});
CQ.form.rte.plugins.PluginRegistry.register("image",CQ.form.rte.plugins.ImagePlugin);
CQ.form.rte.plugins.UndoRedoPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{undoUI:null,redoUI:null,maxUndoSteps:0,isDeleteSequence:false,isCaretMovement:false,constructor:function(A){CQ.form.rte.plugins.UndoRedoPlugin.superclass.constructor.call(this,A);
A.addPluginListener("mouseup",this.addUndoStep,this,this,false);
A.addPluginListener("beforekeydown",this.handleKeyDown,this,this,false);
A.addPluginListener("keyup",this.handleKeyUndo,this,this,false);
A.addPluginListener("beforecommandexecuted",this.handleCommand,this,this,false);
A.addPluginListener("commandexecuted",this.handleCommand,this,this,false)
},addUndoStep:function(){this.editorKernel.execCmd("addundostep")
},handleCommand:function(A){if(!A.customCommand||A.customCommand.isUndoable(A.cmd)){this.addUndoStep()
}},handleKeyDown:function(C){if(C.cancelKey){return 
}var A=CQ.form.rte.Common;
var B=C.extEvent.getKey();
var D=C.extEvent.ctrlKey&&(B==90);
var E=C.extEvent.ctrlKey&&(B==89);
if(D||E){C.cancelKey=true;
this.editorKernel.relayCmd(D?"undo":"redo")
}else{if(B==C.extEvent.SPACE){this.editorKernel.execCmd("addundostep")
}else{if((B==C.extEvent.BACKSPACE)||(B==C.extEvent.DELETE)){if(!this.isDeleteSequence){this.editorKernel.execCmd("addundostep");
this.isDeleteSequence=true
}}else{if(A.isCaretMovement(C.extEvent)){if(!this.isCaretMovement){this.editorKernel.execCmd("addundostep");
this.isCaretMovement=true
}}else{if(this.isDeleteSequence||this.isCaretMovement){if(this.isDeleteSequence){this.editorKernel.execCmd("addundostep")
}this.isDeleteSequence=false;
this.isCaretMovement=false
}if((B>32)&&(B!=224)){this.editorKernel.execCmd("clearredohistory")
}}}}}},handleKeyUndo:function(B){var A=B.extEvent.getKey();
if(A==B.extEvent.ENTER){this.editorKernel.execCmd("addundostep")
}},getFeatures:function(){return["undo","redo"]
},notifyPluginConfig:function(B){var C={maxUndoSteps:50,tooltips:{undo:{title:CQ.I18n.getMessage("Undo"),text:CQ.I18n.getMessage("Undo the last change.")},redo:{title:CQ.I18n.getMessage("Redo"),text:CQ.I18n.getMessage("Redo previously undone changes.")}}};
CQ.Util.applyDefaults(B,C);
this.config=B;
var A={maxUndoSteps:this.config.maxUndoSteps};
this.editorKernel.execCmd("undoconfig",A)
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("undo")){this.undoUI=new C.TbElement("undo",this,false,this.getTooltip("undo"));
A.addElement("undo",B.Plugin.SORT_UNDO,this.undoUI,100)
}if(this.isFeatureEnabled("redo")){this.redoUI=new C.TbElement("redo",this,false,this.getTooltip("redo"));
A.addElement("undo",B.Plugin.SORT_UNDO,this.redoUI,110)
}},execute:function(A,B,C){if(A=="undo"){this.editorKernel.relayCmd("undo",B)
}else{if(A=="redo"){this.editorKernel.relayCmd("redo",B)
}}},updateState:function(A){if(this.undoUI){this.undoUI.getExtUI().setDisabled(!this.editorKernel.queryState("undo",A))
}if(this.redoUI){this.redoUI.getExtUI().setDisabled(!this.editorKernel.queryState("redo",A))
}}});
CQ.form.rte.plugins.PluginRegistry.register("undo",CQ.form.rte.plugins.UndoRedoPlugin);
CQ.form.rte.plugins.SpellCheckerPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{checkTextUI:null,checkText:function(B){this.clearInvalidationMarks(B);
var A=B.root.innerHTML;
CQ.Ext.Ajax.request({method:this.config.method,url:CQ.HTTP.externalize(this.config.spellcheckerUrl),success:function(C){this.checkSuccess(B,C)
},failure:this.checkFailure,scope:this,params:{_charset_:"utf-8",mode:"text",html:"true",text:A,cp:this.editorKernel.getContentPath()}})
},checkSuccess:function(C,D){var H=true;
try{var A;
if(D&&(D.status==200)){A=CQ.Ext.util.JSON.decode(D.responseText);
H=false
}}catch(G){}if(H){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Spell checking"),CQ.I18n.getMessage("Spell checking failed."));
return 
}var M=false;
var I=A.words;
var L=I.length;
for(var K=0;
K<L;
K++){var B=I[K];
var N=B.result;
if(!N.isCorrect){var F=B.start;
var J=B.chars;
var E=N.suggestions;
this.markInvalidWord(C,F,J,E);
M=true
}}if(!M){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Spell checking"),CQ.I18n.getMessage("No spelling mistakes found."))
}},checkFailure:function(){this.checkTextUI.getExtUI().toggle(false);
CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Spell checking"),CQ.I18n.getMessage("Spell checking failed."))
},markInvalidWord:function(C,J,L,H){var D=CQ.form.rte.Common;
var N=CQ.form.rte.DomProcessor;
var A=D.getNodeAtPosition(C,J);
var I=D.getNodeAtPosition(C,J+L);
var G=I.dom;
var K=I.offset;
if((G.nodeType==1)&&(I.offset==null)){var P=G;
G=D.getLastTextChild(P);
if(!G){G=D.getPreviousTextNode(C,P)
}K=D.getNodeCharacterCnt(G)
}var E=N.createNodeList(C,{startNode:A.dom,startOffset:A.offset,endNode:G,endOffset:K});
var O=null;
if(H!=null){var M=H.length;
for(var Q=0;
Q<M;
Q++){var F=H[Q];
if(Q==0){O=F
}else{O+="|"+F
}}}var B={_rtetemp:"spchk"};
if(this.config.invalidStyle){B.style=this.config.invalidStyle
}if(this.config.invalidClass){B.className=this.config.invalidClass
}if(O!=null){B._rtespchksugg=O
}E.surround(C,"span",B)
},clearInvalidationMarks:function(A){var B=CQ.form.rte.DomProcessor;
B.removeTagsFromHierarchy(A.root,{tagName:"span",attribValues:{_rtetemp:"spchk"}})
},constructor:function(A){CQ.form.rte.plugins.SpellCheckerPlugin.superclass.constructor.call(this,A);
A.addPluginListener("keyup",this.handleOnKey,this,this,false)
},handleOnKey:function(F){var D=CQ.form.rte.Common;
var C=CQ.form.rte.Selection;
var H=CQ.form.rte.DomProcessor;
var B=F.editContext;
if(!D.isCaretMovement(F.extEvent)){var J=C.createProcessingSelection(B);
if(J&&!J.endNode){var A=false;
var G=C.bookmarkFromProcessingSelection(B,J);
var E=J.startNode;
while(E){var I=D.getParentNode(B,E);
if(D.isTag(E,"span")){if(E.getAttribute("_rtetemp")=="spchk"){H.removeWithoutChildren(E);
A=true
}}E=I
}if(A){C.selectBookmark(B,G)
}}}},notifyPluginConfig:function(A){A=A||{};
CQ.Util.applyDefaults(A,{invalidStyle:"background-color: #ffffaa;",invalidClass:null,method:"POST",spellcheckerUrl:"/bin/spellcheck",tooltips:{checktext:{title:CQ.I18n.getMessage("Check spelling"),text:CQ.I18n.getMessage("Checks the spelling of the entire text.")}}});
this.config=A
},getFeatures:function(){return["checktext"]
},initializeUI:function(A){var B=CQ.form.rte.plugins;
var C=CQ.form.rte.ui;
if(this.isFeatureEnabled("checktext")){this.checkTextUI=new C.TbElement("checktext",this,true,this.getTooltip("checktext"));
A.addElement("spellcheck",B.Plugin.SORT_LISTS,this.checkTextUI,10)
}},execute:function(D,C,A){var B=CQ.form.rte.DomProcessor;
switch(D){case"checktext":if(this.checkTextUI.getExtUI().pressed){this.checkText(A.editContext)
}else{this.clearInvalidationMarks(A.editContext)
}break;
case"replace":C.dom.innerHTML=C.replacement;
B.removeWithoutChildren(C.dom);
break
}},updateState:function(A){},handleContextMenu:function(H,G,B){var C=CQ.form.rte.Common;
var J=CQ.form.rte.ui;
var E=G.nodeList;
var A=C.getTagInPath(B,E.commonAncestor,"span",{_rtetemp:"spchk"});
if(A){var I=A.getAttribute("_rtespchksugg");
var F=[];
if(I){I=I.split("|");
var D=I.length;
for(var K=0;
K<D;
K++){F.push({text:I[K],plugin:this,cmd:"replace",cmdValue:{dom:A,replacement:I[K]}})
}}else{F.push({text:CQ.I18n.getMessage("No suggestions available."),disabled:true})
}H.addItem(new J.CmItem({text:CQ.I18n.getMessage("Spelling suggestions"),subItems:F}))
}}});
CQ.form.rte.plugins.PluginRegistry.register("spellcheck",CQ.form.rte.plugins.SpellCheckerPlugin);
CQ.form.OwnerDraw=CQ.Ext.extend(CQ.form.CompositeField,{html:"",htmlContent:null,url:null,hiddenField:null,htmlExp:"",processRecord:function(record,path){if(this.fireEvent("beforeloadcontent",this,record,path)!==false){if(this.getName()){var v=record.get(this.getName());
if(v==undefined&&this.defaultValue!=null){if(this.isApplyDefault(record,path)){this.setValue(this.defaultValue)
}}else{this.setValue(v)
}}if(this.url){var u=CQ.HTTP.addParameter(this.url,"path",CQ.Sling.getContentPath(this.name,path));
u=CQ.HTTP.addParameter(u,"id",this.id);
var resp=CQ.HTTP.get(u);
if(CQ.HTTP.isOk(resp)){this.getEl().update(resp.body)
}}else{if(this.htmlExp){try{var html=eval(this.htmlExp);
this.getEl().update(html)
}catch(e){}}}this.fireEvent("loadcontent",this,record,path)
}},afterRender:function(){if(!this.htmlExp){this.body.update(this.htmlContent)
}CQ.form.OwnerDraw.superclass.afterRender.call(this)
},setValue:function(A){if(this.hiddenField){this.hiddenField.setValue(A)
}},getValue:function(){return this.hiddenField?this.hiddenField.getValue():""
},getName:function(){return this.hiddenField?this.hiddenField.getName():""
},constructor:function(A){if(A.html&&A.html.indexOf("{[")!=-1){this.htmlExp=A.html.replace(/'/g,"\\'");
this.htmlExp=this.htmlExp.replace(/\{\[/g,"'+");
this.htmlExp=this.htmlExp.replace(/\]\}/g,"+'");
this.htmlExp="'"+this.htmlExp+"'"
}if(A.html){A.htmlContent=A.html;
delete A.html
}CQ.Ext.applyIf(A,{border:false});
if(A.name){this.hiddenField=new CQ.Ext.form.Hidden({name:A.name});
CQ.Ext.applyIf(A,{items:this.hiddenField})
}CQ.form.OwnerDraw.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("ownerdraw",CQ.form.OwnerDraw);
CQ.form.BrowseField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{content:null,browseDialog:null,onTriggerClick:function(){if(this.disabled){return 
}if(this.browseDialog==null){var A={"jcr:primaryType":"cq:BrowseDialog",id:this.id+"-dialog",ok:function(){if(this.browseField){if(this.browseField.formatHtmlLink){var B=this.browseField.getParagraphAnchor();
B=B==""?B:"#"+B;
this.browseField.setValue(this.getSelectedPath()+".html"+B)
}else{this.browseField.setValue(this.getSelectedPath())
}this.browseField.fireEvent("dialogselect",this)
}this.hide()
},parBrowse:this.parBrowse,treeRoot:this.treeRoot,treeLoader:this.treeLoader,listeners:{hide:function(){if(this.browseField){this.browseField.fireEvent("dialogclose");
this.browseField.fireEvent("browsedialog.closed")
}}}};
this.browseDialog=new CQ.Util.build(A);
this.browseDialog.browseField=this
}if(this.getValue()){this.browseDialog.loadContent(CQ.HTTP.getPath(this.getValue()))
}else{this.browseDialog.loadContent(CQ.WCM.getPagePath())
}this.browseDialog.show();
this.fireEvent("dialogopen");
this.fireEvent("browsedialog.opened")
},constructor:function(A){CQ.form.BrowseField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.BrowseField.superclass.initComponent.call(this);
this.addEvents("browsedialog.opened","dialogopen","dialogSelect","dialogselect","browsedialog.closed","dialogclose")
},getParagraphAnchor:function(){return this.browseDialog.getSelectedAnchor()
}});
CQ.Ext.reg("browsefield",CQ.form.BrowseField);
CQ.form.PathField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{lastValue:null,searchIntervalId:0,browseDialog:null,getParagraphAnchor:function(){return this.browseDialog.getSelectedAnchor()
},adjustNewValue:function(A,B){if(/^path:"/.test(A)){B='"'+B+'"'
}return B
},keyup:function(B,A){var E=this.getRawValue();
var D=A.getKey();
if(D==13){this.fireEvent("search",this,E)
}if(E==this.lastValue){return 
}this.lastValue=E;
var F=E;
if(/^\//.test(F)&&/\/$/.test(F)){if(F=="/"){F=this.rootPath?this.rootPath:"/"
}else{F=F.replace(/\/$/,"")
}this.loadStore(CQ.shared.HTTP.encodePath(F))
}else{if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
var C=this;
this.searchIntervalId=window.setTimeout(function(){C.fireEvent("search",C,E)
},this.searchDelay)
}}},loadStore:function(A){this.store.proxy.api.read.url=A+".pages.json";
this.store.reload()
},onTriggerClick:function(){if(this.disabled){return 
}if(this.browseDialog==null){function B(){var E=this.getSelectedPath();
var C=this.parBrowse?this.getSelectedAnchor():null;
var D;
if(C){D=CQ.Util.patchText(this.pathField.parLinkPattern,[E,C])
}else{D=CQ.Util.patchText(this.pathField.linkPattern,E)
}if(this.pathField.suffix){D+=this.pathField.suffix
}this.pathField.setValue(D);
this.pathField.fireEvent("dialogselect",this.pathField,E,C);
this.hide()
}var A=CQ.Util.applyDefaults(this.browseDialogCfg,{ok:B,parBrowse:this.parBrowse,treeRoot:this.treeRoot,treeLoader:this.treeLoader,listeners:{hide:function(){if(this.pathField){this.pathField.fireEvent("dialogclose")
}}},loadAndShowPath:function(G){this.path=G;
if(this.pathField.rootPath==""||this.pathField.rootPath=="/"){G="/"+G
}var E=this;
var F=this.treePanel;
function D(H){if(H.parentNode){H.ensureVisible()
}if(E.parBrowse){E.onSelectPage(H)
}}function C(I,H){var J=I.lastIndexOf(H);
if(J>=0){return I.substring(0,J)
}else{return I
}}F.selectPath(G,null,function(I,H){if(I&&H){D(H)
}else{G=C(G,"#");
F.selectPath(G,null,function(K,J){if(K&&J){D(J)
}else{G=C(G,".");
F.selectPath(G,null,function(M,L){if(M&&L){D(L)
}})
}})
}})
},pathField:this});
if(this.parBrowse){A.width=570
}this.browseDialog=new CQ.BrowseDialog(A)
}this.browseDialog.loadAndShowPath(this.getValue());
this.browseDialog.show();
this.fireEvent("dialogopen")
},constructor:function(A){if(typeof A.rootTitle==="undefined"){A.rootTitle=A.rootPath||CQ.I18n.getMessage("Websites")
}if(typeof A.rootPath==="undefined"){A.rootPath="/content"
}var C=A.rootPath;
if(C.charAt(0)==="/"){C=C.substring(1)
}if(typeof A.predicate==="undefined"){A.predicate="siteadmin"
}if(typeof A.showTitlesInTree==="undefined"){A.showTitlesInTree=true
}CQ.Util.applyDefaults(A,{linkPattern:A.parBrowse?"{0}.html":"{0}",parLinkPattern:"{0}.html#{1}",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div ext:qtip="{path}" class="x-combo-list-item">','<span class="cq-pathfield-completion-list-name">{label}</span>','<span class="cq-pathfield-completion-list-title">{title}</span>',"</div>","</tpl>"),displayField:"path",typeAhead:true,searchDelay:200,suffix:"",mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false,triggerClass:"x-form-search-trigger",treeRoot:{name:C,text:A.rootTitle},treeLoader:{dataUrl:CQ.shared.HTTP.getXhrHookedURL(CQ.Util.externalize("/bin/tree/ext.json")),baseParams:{predicate:A.predicate,_charset_:"utf-8"},createNode:function(D){if(!A.showTitlesInTree){D.text=D.name
}return CQ.Ext.tree.TreeLoader.prototype.createNode.call(this,D)
},getParams:function(D){var E=this.baseParams;
E.node=D.id;
return CQ.Ext.urlEncode(E)
}}});
if(!(A.store instanceof CQ.Ext.data.Store)){var B=CQ.Util.applyDefaults(A.store,{proxy:new CQ.Ext.data.HttpProxy({url:"/",method:"GET"}),baseParams:{predicate:A.predicate},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"pages",id:"path"},CQ.Ext.data.Record.create([{name:"label"},{name:"title",mapping:CQ.shared.XSS.getXSSPropertyName("title")},{name:"path"}]))});
A.store=new CQ.Ext.data.Store(B)
}this.store=A.store;
CQ.form.PathField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.form.PathField.superclass.initComponent.call(this);
this.addListener("keyup",this.keyup,this);
this.addEvents("search","dialogopen","dialogselect","dialogclose")
}});
CQ.Ext.reg("pathfield",CQ.form.PathField);
CQ.BrowseDialog=CQ.Ext.extend(CQ.Dialog,{treePanel:null,browseField:null,initComponent:function(){CQ.BrowseDialog.superclass.initComponent.call(this)
},loadContent:function(A){if(typeof A=="string"){this.path=A;
this.treePanel.selectPath(A,"name");
if(this.parBrowse){this.paraProxy.api.read.url=CQ.HTTP.externalize(A,true)+".paragraphs.json";
this.paraStore.reload()
}}},getSelectedPath:function(){try{return this.treePanel.getSelectionModel().getSelectedNode().getPath()
}catch(A){return""
}},getSelectedAnchor:function(){try{var A=this.data.getSelectedRecords()[0].get("path");
A=A.substring(A.indexOf("jcr:content")+"jcr:content".length+1);
return A.replace(/\//g,"_").replace(/:/g,"_")
}catch(B){return""
}},constructor:function(D){var E=CQ.Util.applyDefaults(D.treeRoot,{name:"content",text:CQ.I18n.getMessage("Site"),draggable:false,singleClickExpand:true,expanded:true});
var G=CQ.Util.applyDefaults(D.treeLoader,{dataUrl:CQ.HTTP.externalize("/bin/tree/ext.json"),requestMethod:"GET",baseParams:{predicate:"hierarchy",_charset_:"utf-8"},baseAttrs:{singleClickExpand:true},listeners:{beforeload:function(H,I){this.baseParams.path=I.getPath()
}}});
this.treePanel=new CQ.Ext.tree.TreePanel({region:"west",lines:CQ.themes.BrowseDialog.TREE_LINES,bodyBorder:CQ.themes.BrowseDialog.TREE_BORDER,bodyStyle:CQ.themes.BrowseDialog.TREE_STYLE,height:"100%",width:200,autoScroll:true,containerScroll:true,root:new CQ.Ext.tree.AsyncTreeNode(E),loader:new CQ.Ext.tree.TreeLoader(G),defaults:{draggable:false}});
var F=CQ.themes.BrowseDialog.WIDTH;
var C=this.treePanel;
if(D.parBrowse){this.treePanel.on("click",this.onSelectPage.createDelegate(this));
var A=new CQ.Ext.data.JsonReader({id:"path",root:"paragraphs",totalProperty:"count",fields:["path","html"]});
this.paraProxy=new CQ.Ext.data.HttpProxy({url:"/"});
this.paraStore=new CQ.Ext.data.Store({proxy:this.paraProxy,reader:A,autoLoad:false});
var B=new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-paragraphreference-paragraph">{html}</div>',"</tpl>");
this.data=new CQ.Ext.DataView({id:"cq-paragraphreference-data",region:"center",store:this.paraStore,tpl:B,itemSelector:"div.cq-paragraphreference-paragraph",selectedClass:"cq-paragraphreference-selected",singleSelect:true,style:{overflow:"auto"}});
F=550;
C=new CQ.Ext.Panel({border:false,layout:"border",items:[this.treePanel,this.data]})
}CQ.Util.applyDefaults(D,{title:CQ.I18n.getMessage("Select Path"),closable:true,width:F,height:CQ.themes.BrowseDialog.HEIGHT,minWidth:CQ.themes.BrowseDialog.MIN_WIDTH,minHeight:CQ.themes.BrowseDialog.MIN_HEIGHT,resizable:CQ.themes.BrowseDialog.RESIZABLE,resizeHandles:CQ.themes.BrowseDialog.RESIZE_HANDLES,autoHeight:false,autoWidth:false,cls:"cq-browsedialog",ok:function(){this.hide()
},buttons:CQ.Dialog.OKCANCEL,items:C});
CQ.BrowseDialog.superclass.constructor.call(this,D)
},onSelectPage:function(B,A){this.paraProxy.api.read.url=CQ.HTTP.externalize(B.getPath()+".paragraphs.json",true);
this.paraStore.reload()
}});
CQ.Ext.reg("browsedialog",CQ.BrowseDialog);
CQ.UploadDialog=CQ.Ext.extend(CQ.Dialog,{uploadPath:null,destinationPath:null,admin:null,useFlash:true,usePIN:false,fileNamePrefix:null,initComponent:function(){CQ.UploadDialog.superclass.initComponent.call(this)
},makeFileUploadField:function(B,A){return this.makeFileUploadField(B,A,false)
},makeFileUploadField:function(E,B,D){var C=this;
var A="";
if(E){A=E.id
}return{xtype:"fileuploadfield",hideLabel:true,name:A,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,placeHolder:E,removable:true,useFlash:B,usePIN:D,fileNamePrefix:C.fileNamePrefix,listeners:{fileselected:function(H,F){if(!H.valueUpdated){var I;
if(F.flash){I=H.ownerCt.add(C.makeFileUploadField(F.file,B,D))
}else{I=H.ownerCt.add(C.makeFileUploadField(null,B,D))
}H.ownerCt.doLayout();
try{H.findParentByType("form").getForm().items.add(I)
}catch(G){}}if(!F.flash){H.setValue(CQ.Ext.form.VTypes.makeName(F))
}},flashuploadstart:function(H,F){var G="file_"+new Date().valueOf();
C.form.flashUpload.setFilePostName(G);
H.moveSrc=C.uploadPath+"/"+G
},flashuploadsuccess:function(G,F){window.setTimeout(function(){var H=G.progressBar.getEl().parent("div[class*=x-form-item]");
H.fadeOut({easing:"easeOut",endOpacity:0,duration:0,concurrent:false,remove:true})
},10)
},flashuploaderror:function(H,G,F){if(C.uploadFailed){C.uploadFailed.push(H.getValue())
}},flashuploadcomplete:function(F){if(C.uploadFailed.length>0){C.failure()
}else{C.success()
}},fileremoved:function(F){}}}
},constructor:function(config){var dialog=this;
this.useFlash=config.useFlash!=undefined?config.useFlash:true;
this.usePIN=config.usePIN!=undefined?config.usePIN:false;
this.ts=new Date().getTime();
this.admin=config.admin;
CQ.Util.applyDefaults(config,{closable:true,resizable:true,autoHeight:false,autoWidth:false,cls:"cq-uploaddialog",okText:CQ.I18n.getMessage("Upload"),buttons:CQ.Dialog.OKCANCEL,title:CQ.I18n.getMessage("Upload Asset"),formUrl:CQ.HTTP.externalize(config.uploadPath),fileUpload:true,useFlash:this.useFlash,usePIN:this.usePIN,height:300,width:400,items:{xtype:"panel",items:[{xtype:"static",cls:"x-form-item-description",html:CQ.I18n.getMessage("Upload to")+": "+config.displayPath},dialog.makeFileUploadField(null,this.useFlash,this.usePIN)]},listeners:{beforesubmit:function(dialog){dialog.uploadFailed=[];
var uploadfields=dialog.findByType("fileuploadfield");
var parent=CQ.HTTP.eval(CQ.HTTP.noCaching(CQ.HTTP.encodePath(config.destinationPath)+".1.json"));
var conflicts=[];
for(var i=0;
i<uploadfields.length;
i++){var name=uploadfields[i].getValue();
if(parent[name]){conflicts.push(name)
}else{uploadfields[i].setName(uploadfields[i].getValue())
}}if(conflicts.length==0){var siteAdmin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(siteAdmin){siteAdmin.mask()
}return true
}var msg=conflicts.length==1?CQ.I18n.getMessage("An asset of the same name already exists in this location:"):CQ.I18n.getMessage("Assets of the same name already exist in this location:");
msg+="<br/><br/>";
for(var i=0;
i<conflicts.length;
i++){msg+=conflicts[i]+"<br/>"
}msg+="<br/><br/>";
msg+=conflicts.length==1?CQ.I18n.getMessage("Click 'Yes' to replace the asset or 'No' to adjust the name."):CQ.I18n.getMessage("Click 'Yes' to replace the assets or 'No' to adjust the names.");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Name Conflict"),msg,function(btnId){if(btnId=="yes"){for(var i=0;
i<conflicts.length;
i++){CQ.HTTP.post(config.destinationPath+"/"+CQ.HTTP.encodePath(conflicts[i]),null,{":operation":"delete"})
}dialog.ok()
}else{for(var u=0;
u<uploadfields.length;
u++){if(conflicts.indexOf(uploadfields[u].getValue())!=-1){uploadfields[u].markInvalid(CQ.I18n.getMessage("An asset of the same name already exists in this location."))
}}}});
return false
}},success:function(response){var moveParams={};
moveParams[CQ.Sling.CHARSET]="utf-8";
var uploadFields=dialog.findByType("fileuploadfield");
for(var i=0;
i<uploadFields.length;
i++){var filename=uploadFields[i].getValue();
if(!filename){continue
}var moveParam=dialog.destinationPath+"/"+filename+CQ.Sling.MOVE_SUFFIX;
moveParams[moveParam]=uploadFields[i].moveSrc?uploadFields[i].moveSrc:dialog.uploadPath+"/"+filename
}CQ.HTTP.post(dialog.uploadPath,null,moveParams,null,false);
window.setTimeout(function(){if(dialog.mask){dialog.mask.hide()
}dialog.hide();
var siteAdmin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(siteAdmin){siteAdmin.reloadPages()
}},1000)
},failure:function(){var title=CQ.I18n.getMessage("Error");
var msg=dialog.uploadFailed.length==1?CQ.I18n.getMessage("Failed to upload the following file:"):CQ.I18n.getMessage("Failed to upload the following files:");
msg+="<br/><br/>";
for(var i=0;
i<dialog.uploadFailed.length;
i++){msg+=dialog.uploadFailed[i]+"<br/>"
}CQ.Ext.Msg.show({title:title,msg:msg,icon:CQ.Ext.Msg.ERROR,buttons:CQ.Ext.Msg.OK,fn:function(){dialog.hide()
}})
}});
CQ.UploadDialog.superclass.constructor.call(this,config)
},ok:function(F){var B={};
B.usePIN=this.usePIN;
if(this.responseScope){B.scope=this.responseScope;
B.success=this.success?this.success:this.responseScope.success;
B.failure=this.failure?this.failure:this.responseScope.failure
}else{B.scope=this;
if(this.success){B.success=this.success
}if(this.failure){B.failure=this.failure
}}var J=this.findByType("fileuploadfield");
if(J.length<2){CQ.Ext.Msg.alert(CQ.I18n.getMessage("No File Selected"),CQ.I18n.getMessage("Click 'Browse...' to select a file to upload."));
return 
}if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}var E=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(E){E.mask()
}this.form.items.each(function(K){if(K.emptyText&&K.el.dom.value==K.emptyText){K.setRawValue("")
}});
var D=new CQ.form.UploadSubmitAction(this.form,B);
this.form.doAction(D);
try{F.disable()
}catch(H){}if(!this.form.flashUpload){var C=(J.length==2)?CQ.I18n.getMessage("Uploading file..."):CQ.I18n.getMessage("Uploading files...");
this.mask=new CQ.Ext.LoadMask(this.body,{msg:C});
this.mask.show()
}}else{var G=[];
this.form.items.each(function(K){if(!K.validate()){G.push(K)
}});
var I=G.length==1?CQ.I18n.getMessage("Invalid Name"):CQ.I18n.getMessage("Invalid Names");
var A=G.length==1?CQ.I18n.getMessage("There is a file with an invalid name. Please verify the marked field."):CQ.I18n.getMessage("There are files with invalid names. Please verify the marked fields.");
CQ.Ext.Msg.show({title:I,msg:A,buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(A){if(CQ.swfu){while(CQ.swfu.getStats().files_queued>0){CQ.swfu.cancelUpload(null,false)
}}if(this.mask){this.mask.hide()
}this.hide()
}}
}});
CQ.Ext.reg("uploaddialog",CQ.UploadDialog);
CQ.HomeLink=CQ.Ext.extend(CQ.Static,{linkText:null,tooltip:null,linkPath:null,constructor:function(A){CQ.Ext.applyIf(A,{cls:"cq-homelink",tooltip:CQ.I18n.getMessage("Back Home"),linkPath:"/welcome",linkText:"&nbsp;"});
CQ.Ext.apply(A,{html:'<a href="'+CQ.HTTP.externalize(A.linkPath)+'" title="'+A.tooltip+'">'+A.linkText+"</a>",listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),text:A.tooltip})
}}});
CQ.HomeLink.superclass.constructor.call(this,A)
}});
CQ.UserInfo=CQ.Ext.extend(CQ.Ext.Toolbar,{impersonated:false,constructor:function(A){A=CQ.Util.applyDefaults(A,{id:"cq-userinfo",menu:{items:[]},sudoables:{listWidth:150,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",stateful:false,width:150,minChars:0,editable:true,tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-impersonators-list">','<div class="cq-impersonators-list-entry">','{[CQ.shared.XSS.getXSSTablePropertyValue(values, "name") == "" ? values.id : CQ.shared.XSS.getXSSTablePropertyValue(values, "name")]}',"</div>","</div>","</tpl>"),itemSelector:"div.cq-impersonators-list"},passwordDialog:CQ.UserInfo.PASSWORD_DIALOG_CFG});
CQ.UserInfo.superclass.constructor.call(this,A)
},initComponent:function(){var C=this.initialConfig;
var D=CQ.User.getCurrentUser();
this.impersonated=D.isImpersonated();
if(!C.iconCls){C.iconCls=this.impersonated?"impersonateIcon":"userIcon";
if(CQ.Ext.isIE6){C.iconCls+="-ie6"
}}var E=new CQ.Ext.menu.Menu(C.menu);
if(this.impersonated){E.addMenuItem({iconCls:"revertIcon",cls:"cq-userinfo-revert",text:CQ.I18n.getMessage("Revert to self"),handler:this.revertHandler})
}else{E.addMenuItem({text:CQ.I18n.getMessage("Sign out"),cls:"cq-userinfo-logout",handler:this.logout});
E.addSeparator();
if(D.getUserID()!="admin"){E.addMenuItem({text:CQ.I18n.getMessage("Set Password"),cls:"cq-userinfo-pwd",handler:this.setPassword,scope:this})
}E.addMenuItem({text:CQ.I18n.getMessage("Notification Inbox"),cls:"cq-userinfo-inbox",handler:this.openNotificationInbox});
E.addMenuItem({text:CQ.I18n.getMessage("Properties"),cls:"cq-userinfo-props",handler:this.openUserProperties});
E.addSeparator();
E.addMenuItem({iconCls:"impersonateIcon",text:CQ.I18n.getMessage("Impersonate as:"),hideOnClick:false,style:{cursor:"default"},canActivate:false});
var A=C.sudoables;
A=CQ.Util.applyDefaults(A,{style:{cursor:"text"},cls:"cq-userinfo-impersonate",listeners:{expand:{fn:function(G){var F=E.getEl().getPositioning();
if(F&&G.list){G.list.setStyle("z-index",F["z-index"]+1)
}}},select:{fn:this.sudoHandler,scope:this}}});
if(!A.store){A.store=new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:D.getHome()+".sudoables.json",method:"GET"}),baseParams:{_charset_:"utf-8"},reader:new CQ.Ext.data.JsonReader({root:"authorizables",id:"id",fields:["name",CQ.shared.XSS.getXSSPropertyName("name"),"id"]})})
}var B=new CQ.Ext.Panel({border:false,cls:"impersonateMenu",items:[new CQ.Ext.form.ComboBox(A)]});
E.addItem(B)
}this.items=[{iconCls:C.iconCls,text:CQ.shared.Util.ellipsis(D.getUserName(true),120,true),menu:E}];
CQ.UserInfo.superclass.initComponent.call(this)
},setPassword:function(){var C=CQ.WCM.getDialog(this.initialConfig.passwordDialog);
if(!C){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("Dialog not available"));
return 
}C.setElId(CQ.Util.createId("cq-userinfo-passworddialog"));
var A=CQ.User.getCurrentUser();
if(!(A&&A.getHome())){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("User not available"));
return 
}var B=CQ.HTTP.externalize(A.getHome());
B=CQ.HTTP.noCaching(B);
var D=C.form;
D.on({beforeaction:{fn:function(E,F){if(F.type=="slingsubmit"||F.type=="submit"){E.url=B;
F.options.success=function(){try{A.login(E.findField("rep:password").getValue())
}catch(G){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("Could not set Password: "+G))
}}
}}}});
C.failure=function(){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("Could not set Password"))
};
C.show()
},sudoHandler:function(A,B){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Impersonation"),CQ.I18n.getMessage("Do you want to impersonate as {0}?",B.get(CQ.shared.XSS.getXSSPropertyName("name"))?B.get(CQ.shared.XSS.getXSSPropertyName("name")):B.id),function(D){if(D=="yes"){var C=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(C){C.mask()
}CQ.User.getCurrentUser().sudoAs(B.id)
}},this)
},revertHandler:function(){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Impersonation"),CQ.I18n.getMessage("Do you want to end impersonation to {0}?",CQ.User.getUserName(true)),function(B){if(B=="yes"){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){A.mask()
}CQ.User.getCurrentUser().revertSelf()
}},this)
},logout:function(){CQ.User.logout()
},openNotificationInbox:function(){CQ.Util.reload(window,CQ.HTTP.externalize("/libs/wcm/core/content/inbox.html"))
},openUserProperties:function(){var B=CQ.WCM.getDialog("/libs/cq/security/content/tools/userProperties.infinity.json");
B.loadContent("/libs/cq/security/preferences/proxy");
var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){B.on("beforesubmit",function(){A.mask()
})
}B.success=function(){CQ.Util.reload()
};
B.failure=function(){if(A){A.unmask()
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not set user properties."))
};
B.show()
}});
CQ.Ext.reg("userinfo",CQ.UserInfo);
CQ.UserInfo.PASSWORD_DIALOG_CFG={width:400,height:200,"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Set Password"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",password:{inputType:"password",fieldLabel:CQ.I18n.getMessage("Password"),name:"rep:password",cls:"cq-userinfo-password1",allowBlank:false,msgTarget:"under"},password2:{inputType:"password",fieldLabel:CQ.I18n.getMessage("Confirm Password"),name:"rep:password",cls:"cq-userinfo-password2",allowBlank:false,msgTarget:"under",validator:function(A){var B=this.ownerCt.items.get(0).getRawValue();
if(B==A){return true
}}}}},okText:CQ.I18n.getMessage("Set"),buttons:CQ.Dialog.OKCANCEL};
CQ.form.TableEdit=CQ.Ext.extend(CQ.form.CompositeField,{isFormField:true,hideLabel:true,useColPercentage:false,hiddenField:null,store:null,colModel:null,fields:[],columnArray:[],editorConfig:null,gridConfig:null,htmlEditor:null,editor:null,editorGrid:null,deleteRow:function(){var C=this.editorGrid;
var B=C.getSelectionModel();
var A=B.getSelectedCell();
if(A){CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Row"),CQ.I18n.getMessage("Are you sure you want to delete this row?"),function(D){if(D=="yes"){this.editorGrid.stopEditing();
this.editorGrid.store.remove(this.editorGrid.store.getAt(A[0]))
}},this)
}},deleteColumn:function(){var B=this.editorGrid.getSelectionModel();
var A=B.getSelectedCell();
if(A){this.editorGrid.stopEditing();
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Column"),CQ.I18n.getMessage("Are you sure you want to delete this column?"),function(H){var K=this.editorGrid.colModel.getColumnCount();
var I=this.editorGrid.store.getCount();
for(var F=0;
F<K;
F++){this.editorGrid.colModel.setEditor(F,null)
}for(var G=0;
G<I;
++G){var D=this.editorGrid.store.getAt(G);
for(var F=0;
F<K-1;
++F){var E=(F<A[1])?F:F+1;
var L=this.editorGrid.colModel.getDataIndex(F);
var C=this.editorGrid.colModel.getDataIndex(E);
D.set(L,D.get(C))
}}for(var F=0;
F<K-1;
F++){var E=(F<A[1])?F:F+1;
var J=this.editorGrid.colModel.getColumnWidth(E);
this.editorGrid.colModel.setColumnWidth(F,J)
}this.fields.pop();
this.columnArray.pop();
this.editorGrid.colModel.setConfig(this.columnArray);
for(var F=0;
F<K-1;
F++){this.editorGrid.colModel.setEditor(F,this.editor)
}},this)
}},addRows:function(F){this.editorGrid.stopEditing();
var E=new CQ.Ext.data.Record.create(this.fields);
var C=this.editorGrid.colModel.getColumnCount();
for(var B=0;
B<F;
++B){var D={};
for(var A=0;
A<C;
++A){D["tcol-"+A]=""
}this.editorGrid.store.add(new E(D))
}},addColumns:function(F){this.editorGrid.stopEditing();
var D=this.editorGrid.colModel.getColumnCount();
for(var B=0;
B<D;
B++){this.editorGrid.colModel.setEditor(B,null)
}for(var C=D;
C<D+F;
++C){var A="tcol-"+(C);
var E=String.fromCharCode(65+C/26)+String.fromCharCode(65+C%26);
this.fields.push({name:A,mapping:"td:nth("+(C+1)+")/@innerHTML"});
this.columnArray.push({header:E,dataIndex:A,width:CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH,tooltip:E,sortable:this.gridConfig.sortable})
}this.editorGrid.colModel.setConfig(this.columnArray);
this.editorGrid.store.each(function(G){G.set(A,"")
});
for(var B=0;
B<D+F;
B++){this.editorGrid.colModel.setEditor(B,this.editor)
}},getValue:function(){var M=this.editorGrid.colModel.getColumnCount();
var L=this.editorGrid.store.getCount();
var A=document.createElement("div");
var P=A.appendChild(document.createElement("table"));
var D=P.appendChild(document.createElement("colgroup"));
for(var G=0;
G<M;
++G){var B=D.appendChild(document.createElement("col"));
var N=this.editorGrid.colModel.getColumnWidth(G);
if(this.useColPercentage){B.width=this.convertWidthToPercentage(N)+"%"
}else{B.width=N
}}var F=P.appendChild(document.createElement("tbody"));
for(var Q=0;
Q<L;
++Q){var K=F.appendChild(document.createElement("tr"));
var I=this.editorGrid.store.getAt(Q);
for(var B=0;
B<M;
++B){if(!this.editorGrid.colModel.isHidden(B)){var E="td";
var C=K.appendChild(document.createElement(E));
var O=I.get(this.editorGrid.colModel.getDataIndex(B));
C.innerHTML=O?O:""
}}}var J=CQ.form.rte.HtmlProcessor;
var H=A.innerHTML;
H=J.executeInternalizeLinks(H,[{tag:"a",attribute:"href"}]);
H=this.htmlEditor.editorKernel.postProcessor.process(H);
return H
},initializeTable:function(F){var E=document.createElement("div");
if(!F){E.innerHTML="<table><colgroup><col></colgroup><tbody><tr><td></td></tr></tbody></table>"
}else{E.innerHTML=F
}E=CQ.Ext.get(E);
var H=E.query("col");
this.fields=[];
this.columnArray=[];
for(var B=0,D;
D=H[B];
++B){var A="tcol-"+B;
var G=String.fromCharCode(65+B/26)+String.fromCharCode(65+B%26);
this.fields.push({name:A,mapping:"td:nth("+(B+1)+")/@innerHTML"});
var C=D.width;
if(C){if(this.useColPercentage){C=this.convertPercentageToWidth(C)
}}else{C=CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH
}this.columnArray.push({header:G,dataIndex:A,width:parseInt(C),tooltip:D.title,sortable:this.gridConfig.sortable,editor:this.editor})
}this.editorGrid.store=new CQ.Ext.data.Store({reader:new CQ.Ext.data.XmlReader({record:"tr"},this.fields)});
this.editorGrid.store.loadData(E.dom);
this.editorGrid.colModel=new CQ.Ext.grid.ColumnModel(this.columnArray)
},clear:function(){if(this.htmlEditor){this.htmlEditor.setValue("")
}if(this.editorGrid){this.editorGrid.stopEditing();
this.editorGrid.store.removeAll()
}},processRecord:function(A,C){if(this.fireEvent("beforeloadcontent",this,A,C)!==false){var B=A.get(this.getName());
if(B==undefined&&this.defaultValue!=null){if(this.isApplyDefault(A,C)){this.setValue(this.defaultValue)
}}if(B!=null){this.clear();
this.initializeTable(B);
this.editorGrid.reconfigure(this.editorGrid.store,this.editorGrid.colModel);
this.hiddenField.setValue(this.getValue())
}this.fireEvent("loadcontent",this,A,C)
}},getColsTotalWidth:function(){if(this.editorGrid.colModel){return this.editorGrid.colModel.getTotalWidth()
}return CQ.form.TableEdit.DEFAULT_GRID_WIDTH
},convertWidthToPercentage:function(B){var A=0;
if(B>0){A=Math.round(100*B/this.getColsTotalWidth())
}return A
},convertPercentageToWidth:function(B){var A=B;
if(typeof B=="string"){if(B.charAt(B.length-1)=="%"){A=B.substring(0,B.length-1)
}}A=Math.round(A*this.getColsTotalWidth()/100);
return A
},getColDisplayWidth:function(A,C){var B=this.editorGrid.colModel.getColumnWidth(A);
if(C){B+=C
}if(this.useColPercentage){return this.convertWidthToPercentage(B)+"%"
}else{return B+"px"
}},pasteHTML:function(H,K,F){var O=document.createElement("div");
O.innerHTML=F;
O=CQ.Ext.get(O);
var P=O.query("tr");
if(!P||P.length==0){return false
}var I=CQ.Ext.get(P[0]).query("td");
if(!I||I.length==0){return false
}var Q=P.length;
var D=I.length;
var G=this.editorGrid.store.getCount();
var M=this.editorGrid.colModel.getColumnCount();
if(H+P.length>G){this.addRows((H+Q)-G)
}if(K+I.length>M){this.addColumns((K+D)-M)
}this.editorGrid.reconfigure(this.editorGrid.store,this.editorGrid.colModel);
var L;
for(var E=0;
E<Q;
++E){var B=this.editorGrid.store.getAt(E+H);
var N=CQ.Ext.get(P[E]).query("td");
for(var C=0,A=0;
C<I.length;
++C,++A){var J=this.editorGrid.colModel.getDataIndex(C+K);
L=N[A].innerHTML;
if(L!=null&&J){B.set(J,L)
}if(N[A].colSpan>1){C+=(N[A].colSpan-1)
}}}this.editor.setValue(L);
this.editorGrid.selModel.select(H+Q-1,K+D-1);
this.editorGrid.startEditing(H+Q-1,K+D-1);
return false
},editorSync:function(C,E){var B,H;
this.isSynced=true;
var A=this.editorGrid.selModel.getSelectedCell();
if(A){H=A[0];
B=A[1]
}else{H=0;
B=0
}if(E){var F=E.toLowerCase();
if(F.indexOf("<table")>=0){this.editorGrid.stopEditing();
return this.pasteHTML(H,B,E)
}if(A){var D=this.editorGrid.getColumnModel().getDataIndex(A[1]);
var G=this.editorGrid.store.getAt(A[0]);
G.set(D,E)
}}this.isSynced=false
},gridKeyHandler:function(A){},onResize:function(A,B){if(this.editor){this.editor.setSize(A,B)
}if(this.editorGrid.view){this.editorGrid.view.refresh()
}},onShow:function(A){this.editorGrid.enable();
this.htmlEditor.enable()
},onRender:function(B){CQ.form.TableEdit.superclass.onRender.call(this,B);
var A=this.findParentByType("dialog");
if(A){A.on("beforesubmit",function(C){this.htmlEditor.syncValue();
this.editorGrid.stopEditing();
this.hiddenField.setValue(this.getValue());
this.editorGrid.disable();
this.htmlEditor.disable()
},this);
A.on("show",function(C){if(this.editorGrid){this.editorGrid.enable()
}if(this.htmlEditor){this.htmlEditor.enable()
}if(this.editorGrid.view.splitone){this.editorGrid.view.splitone.enableTooltip=true;
this.editorGrid.view.splitone.showTooltip=this.showResizeTooltip;
this.editorGrid.view.splitone.hideTooltip=this.hideResizeTooltip
}},this)
}if(CQ.Ext.isIE){this.htmlEditor.on("render",this.htmlEditor.initEditor)
}return true
},fixFocusIssue:function(){var A=this;
CQ.Ext.apply(this.editorGrid.view,{focusCell:function(D,B,C){if(!A.isSynced){CQ.Ext.grid.GridView.prototype.focusCell.call(this,D,B,C)
}}})
},showResizeTooltip:function(A,D){var C=this.grid.findParentByType("tableedit");
var B=C.getColDisplayWidth(this.cellIndex);
this.tooltip=new CQ.Ext.ToolTip({target:this.grid.id,html:B,trackMouse:true,autoHide:false,visibilityMode:CQ.Ext.Element.DISPLAY,targetXY:[A,D],tableEdit:C,cellIndex:this.cellIndex});
this.tooltip.on("move",function(G,E,I){var F=Math.max(this.minX,E);
var H=F-this.startPos;
this.tooltip.body.dom.innerHTML=this.tooltip.tableEdit.getColDisplayWidth(this.tooltip.cellIndex,H)
},this);
this.tooltip.enable();
this.tooltip.show()
},hideResizeTooltip:function(A,B){this.tooltip.hide();
this.tooltip.disable();
this.tooltip.destroy()
},initComponent:function(){CQ.form.TableEdit.superclass.initComponent.call(this);
this.htmlEditor=new CQ.form.RichText(this.editorConfig);
this.editor=new CQ.Ext.grid.GridEditor(this.htmlEditor,{autoSize:null});
this.editorGrid=new CQ.Ext.grid.EditorGridPanel(this.gridConfig);
this.initializeTable(this.defaultValue);
this.add(this.htmlEditor);
this.add(this.editorGrid);
this.htmlEditor.on("beforesync",this.editorSync,this);
this.editorGrid.on("afteredit",function(A){this.hiddenField.setValue(this.getValue())
},this);
this.editorGrid.on("keypress",this.gridKeyHandler,this);
this.hiddenField=new CQ.Ext.form.Hidden({name:this.name});
this.add(this.hiddenField)
},constructor:function(A){var B=this;
var C={hideLabel:true,autoHeight:false,defaultValue:"",gridConfig:{xtype:"editorgrid",isFormField:false,height:158,sm:new CQ.Ext.grid.CellSelectionModel({handleMouseDown:function(){}}),afterRender:function(){CQ.Ext.grid.EditorGridPanel.prototype.afterRender.call(this);
B.fixFocusIssue()
},clicksToEdit:1,enableColumnMove:true,enableHdMenu:false,hideLabel:true,stateful:false,sortable:false,tbar:[{text:CQ.I18n.getMessage("Add Row"),handler:function(){this.addRows(1)
},scope:this},{text:CQ.I18n.getMessage("Add Column"),handler:function(){this.addColumns(1)
},scope:this},{text:CQ.I18n.getMessage("Delete Row"),handler:this.deleteRow,scope:this},{text:CQ.I18n.getMessage("Delete Column"),handler:this.deleteColumn,scope:this}]},editorConfig:{height:60,hideLabel:true,defaultPasteMode:"browser",removeSingleParagraphContainer:true,tabSize:1,name:""}};
CQ.Util.applyDefaults(A,C);
if(A.useColPercentage){CQ.Util.applyDefaults(A,{gridConfig:{viewConfig:{forceFit:true,autoFill:true}}})
}CQ.form.TableEdit.superclass.constructor.call(this,A)
}});
CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH=100;
CQ.form.TableEdit.DEFAULT_GRID_WIDTH=450;
CQ.Ext.reg("tableedit",CQ.form.TableEdit);
CQ.form.TableEdit2=CQ.Ext.extend(CQ.form.RichText,{useColPercentage:false,constructor:function(A){var B={useColPercentage:false,listeners:{loadcontent:{fn:this.onLoadContent,scope:this}},rtePlugins:{table:{features:"*",defaultValues:{width:"100%"},editMode:CQ.form.rte.plugins.TablePlugin.EDITMODE_TABLE}}};
CQ.Util.applyDefaults(A,B);
CQ.form.TableEdit2.superclass.constructor.call(this,A)
},onRender:function(C,A){CQ.form.TableEdit2.superclass.onRender.call(this,C,A);
var B=this.findParentByType("dialog");
if(B){var D=B.getField("./hasHeaders");
if(D){B.on("beforesubmit",function(){D.setValue("false")
})
}}},deleteRow:function(){this.relayCmd("removerow",null)
},deleteColumn:function(){this.relayCmd("removecolumn",null)
},addRows:function(C){var J=this.getTableDom(this.getEditorBody());
if(!J){return 
}var B=this.editorKernel.getEditContext();
var D=new CQ.form.rte.TableMatrix();
D.createTableMatrix(J);
var L=D.getTableSize();
var G=L.cols;
var E=CQ.Ext.DomQuery.select("tbody:first",J)[0];
for(var A=0;
A<C;
A++){var K=this.doc.createElement("tr");
for(var F=0;
F<G;
F++){var I=this.doc.createElement("td");
var H=CQ.form.rte.DomProcessor.createEmptyLinePlaceholder(B,false);
if(H){I.appendChild(H)
}K.appendChild(I)
}E.appendChild(K)
}},addColumns:function(C){var I=this.getTableDom(this.getEditorBody());
if(!I){return 
}var B=this.editorKernel.getEditContext();
var D=new CQ.form.rte.TableMatrix();
D.createTableMatrix(I);
var L=D.getTableSize();
var K=L.rows;
var E=CQ.Ext.DomQuery.select("tbody:first",I)[0];
for(var A=0;
A<K;
A++){var J=D.getRowDom(A);
for(var F=0;
F<C;
F++){var H=this.doc.createElement("td");
var G=CQ.form.rte.DomProcessor.createEmptyLinePlaceholder(B,false);
if(G){H.appendChild(G)
}J.appendChild(H)
}E.appendChild(J)
}},getTableDom:function(B){var A=CQ.Ext.DomQuery.select("table:first",B);
if(A.length==0){return null
}return A[0]
},processPercentagePerTable:function(N,D){var M=N.clientWidth;
var A=CQ.Ext.DomQuery.select("tr:first",N)[0];
var H=CQ.Ext.DomQuery.select("tr:first",D)[0];
var B=A.childNodes.length;
var F=[];
var L=0;
var Q;
for(Q=0;
Q<B;
Q++){var K=A.childNodes[Q].clientWidth;
var I=Math.round((K/M)*100);
L+=I;
F.push(I)
}var R=(100-L)/B;
var G=Math.floor(R);
var E=R-G;
var J=0;
for(Q=0;
Q<B;
Q++){var C=H.childNodes[Q];
var O=F[Q]+G;
var P=Math.floor(E+J)-Math.floor(J);
J+=E;
O+=P;
C.setAttribute("width",O+"%")
}},getHtmlPayload:function(D){if(!this.useColPercentage){return D.innerHTML
}var C=this.doc.createElement("span");
var B=this.getTableDom(D);
C.appendChild(B.cloneNode(true));
var A=CQ.Ext.DomQuery.select("table:first",C);
if(A.length==0){throw new Error("Internal error - table copy not found.")
}A=A[0];
this.processPercentagePerTable(B,A);
return C.innerHTML
},onLoadContent:function(H,G){var B=CQ.form.rte.Common;
var L=G.get("hasHeaders");
var M=false;
if(L){M=(L===true)||(L=="true")
}if(M){var N=this.getTableDom(this.getEditorBody());
var D=CQ.Ext.DomQuery.select("tbody tr:first",N);
if(D.length==1){var O=D[0].childNodes;
var F=O.length;
for(var I=0;
I<F;
I++){var K=O[I];
if(B.isTag(K,"td")){var C=this.doc.createElement("th");
var A=K.attributes;
for(var J=0;
J<A.length;
J++){var E=A[J];
C.setAttribute(E.name,E.value)
}B.replaceNode(K,C)
}}}}}});
CQ.Ext.reg("tableedit2",CQ.form.TableEdit2);
CQ.form.ParagraphReference=CQ.Ext.extend(CQ.Ext.form.TriggerField,{constructor:function(E){CQ.form.ParagraphReference.superclass.constructor.call(this,E);
var C=new CQ.Ext.tree.TreeLoader({url:CQ.HTTP.externalize("/content.ext.json"),requestMethod:"GET",baseParams:{predicate:"hierarchy",depth:0},baseAttrs:{iconCls:"page"}});
C.on("beforeload",function(G,H){this.url=CQ.HTTP.externalize(H.getPath()+".ext.json")
});
var D=new CQ.Ext.tree.AsyncTreeNode({name:"content",text:CQ.I18n.getMessage("Pages"),expanded:true,iconCls:"page"});
var B=new CQ.Ext.tree.TreePanel({id:"cq-paragraphreference-tree",xtype:"treepanel",region:"west",width:200,loader:C,root:D,autoScroll:true});
B.on("click",this.onSelectPage.createDelegate(this));
var A=new CQ.Ext.data.JsonReader({id:"path",root:"paragraphs",totalProperty:"count",fields:["path","html"]});
this.proxy=new CQ.Ext.data.HttpProxy({url:"/"});
this.store=new CQ.Ext.data.Store({proxy:this.proxy,reader:A,autoLoad:false});
var F=new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-paragraphreference-paragraph">{html}</div>',"</tpl>");
this.data=new CQ.Ext.DataView({id:"cq-paragraphreference-data",region:"center",store:this.store,tpl:F,itemSelector:"div.cq-paragraphreference-paragraph",selectedClass:"cq-paragraphreference-selected",singleSelect:true,style:{overflow:"auto"}});
this.data.on("selectionchange",this.onSelectionChange.createDelegate(this));
this.selectButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Select"),handler:this.onSelect.createDelegate(this)});
this.dialog=new CQ.Ext.Window({title:CQ.I18n.getMessage("Select paragraph"),layout:"border",modal:true,y:20,width:CQ.themes.Dialog.WIDTH,height:CQ.themes.Dialog.HEIGHT,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,closable:true,closeAction:"hide",stateful:false,items:[B,this.data],buttons:[this.selectButton,{text:CQ.I18n.getMessage("Cancel"),handler:this.onCancel.createDelegate(this)}]})
},onTriggerClick:function(){this.onSelectionChange();
this.dialog.show(this)
},onSelectPage:function(B,A){this.proxy.api.read.url=CQ.HTTP.externalize(B.getPath()+".paragraphs.json",true);
this.store.reload()
},onSelectionChange:function(){if(this.data.getSelectedRecords().length>0){this.selectButton.enable()
}else{this.selectButton.disable()
}},onSelect:function(){var A=this.data.getSelectedRecords();
if(A.length>0){this.setValue(A[0].get("path"))
}this.dialog.hide()
},onCancel:function(A){this.dialog.hide()
}});
CQ.form.ParagraphReference.onParagraphLoad=function(){};
CQ.Ext.reg("paragraphreference",CQ.form.ParagraphReference);
CQ.form.FormWrapper=CQ.Ext.extend(CQ.Ext.util.Observable,{formEl:null,submit:function(A){if(!A){if(this.fireEvent("beforesubmit",this,false)===false){return false
}}this.form.submit();
return true
},addHiddenField:function(A,C){if(this.formEl){var B=document.createElement("input");
B.type="hidden";
B.name=A;
B.value=C;
this.formEl.appendChild(B);
return B
}return null
},constructor:function(B){var A=this;
if(typeof B.form==="string"){B.form=document.forms[B.form]
}this.form=B.form;
if(this.form){this.formEl=CQ.Ext.get(this.form);
CQ.Ext.EventManager.addListener(this.form,"submit",function(C){C.stopEvent();
if(this.fireEvent("beforesubmit",this,true)===true){this.form.submit()
}else{return false
}},this)
}this.addEvents("beforesubmit")
}});
CQ.form.SearchField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{storeConfig:null,constructor:function(A){A=CQ.Util.applyDefaults(A,{width:300,pageSize:6,minChars:1,typeAhead:true,typeAheadDelay:100,validationEvent:false,validateOnBlur:false,displayField:"title",triggerClass:"x-form-search-trigger",emptyText:CQ.I18n.getMessage("Enter search query"),loadingText:CQ.I18n.getMessage("Searching..."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="search-item" qtip="{path}">','<div class="search-thumb"',' style="background-image:url({[CQ.HTTP.externalize(values.path,true)]}.thumb.48.48.png);"></div><div class="search-text-wrapper"><div class="search-title">{title}</div>','<div class="search-excerpt">{excerpt}</div>',"</div>",'<div class="search-separator"></div>',"</div>","</tpl>"),itemSelector:"div.search-item"});
var B=CQ.Util.applyDefaults(A.storeConfig,{proxy:new CQ.Ext.data.HttpProxy({url:A.url?A.url:"/content.search.json",method:"GET"}),baseParams:{_charset_:"utf-8"},reader:new CQ.Ext.data.JsonReader({id:"path",root:"hits",totalProperty:"results",fields:["name","path","excerpt","title"]})});
A.store=new CQ.Ext.data.Store(B);
CQ.form.SearchField.superclass.constructor.call(this,A)
},onSelect:function(A,B){if(this.fireEvent("beforeselect",this,A,B)!==false){this.collapse();
this.fireEvent("select",this,A,B)
}},onTypeAhead:function(){}});
CQ.Ext.reg("searchfield",CQ.form.SearchField);
CQ.form.Thumbnail=CQ.Ext.extend(CQ.form.CompositeField,{thumbnailWidth:140,thumbnailHeight:100,servlet:"thumb",extension:"png",disableImageEditing:true,imageExtensions:null,renditionsInitialTimeout:20000,renditionsTimeout:10000,processRecord:function(record,path){this.path=path;
this.update();
if(this.disableImageEditing){return 
}var p=path.toLowerCase();
var supported=false;
for(var i=0;
i<this.imageExtensions.length;
i++){var ext=this.imageExtensions[i];
if(p.lastIndexOf("."+ext)==path.length-ext.length-1){supported=true;
break
}}if(!supported){return 
}var thumbnail=this;
this.editButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Edit..."),cls:"cq-thumbnailfield-btn",scope:this,handler:function(){var res=CQ.HTTP.eval(path+"/jcr:content.1.json");
var name=res.currentOriginal?res.currentOriginal:"original";
var url=path+"/jcr:content/renditions/cq5dam.thumbnail.48.48.png/jcr:content.json";
url=CQ.HTTP.noCaching(url);
var tInfo=CQ.HTTP.eval(url);
try{var m=tInfo["jcr:lastModified"];
this.formerCk=new Date(m).getTime()
}catch(e){this.formerCk=new Date().getTime()
}var config=CQ.WCM.getDialogConfig({name:"./"+name,xtype:"smartimage",cropParameter:"./crop",rotateParameter:"./rotate",disableFlush:true});
config=CQ.Util.applyDefaults(config,{title:CQ.I18n.getMessage("Image Editor"),y:50,width:480,formUrl:path+".assetimage.html",success:function(){thumbnail.waitForRenditions(true)
}});
var dialog=CQ.Util.build(config,true);
dialog.loadContent(path+"/jcr:content/renditions");
dialog.show()
}});
this.add(this.editButton);
this.doLayout()
},update:function(){var A=CQ.HTTP.externalize(this.path,true)+"."+this.servlet+"."+this.thumbnailHeight+"."+this.thumbnailWidth+"."+this.extension;
A=CQ.HTTP.noCaching(A);
this.image.el.setStyle({"background-image":"url("+A+")"})
},setValue:function(A){},getValue:function(){return""
},getName:function(){return""
},waitForRenditions:function(initialCall,loadMask){var ae=this;
if(initialCall){var dialog=this.findParentByType("dialog");
loadMask=new CQ.Ext.LoadMask(dialog.body,{msg:CQ.I18n.getMessage("Processing renditions..."),removeMask:true});
loadMask.show();
this.renditionsTimeoutId=window.setTimeout(function(){ae.waitForRenditions(false,loadMask)
},this.renditionsInitialTimeout)
}else{var url=this.path+"/jcr:content/renditions/cq5dam.thumbnail.48.48.png/jcr:content.json";
url=CQ.HTTP.noCaching(url);
var tInfo=CQ.HTTP.eval(url);
var ck;
try{var m=tInfo["jcr:lastModified"];
ck=new Date(m).getTime()
}catch(e){ck=new Date().getTime()
}if(ck==this.formerCk){this.renditionsTimeoutId=window.setTimeout(function(){ae.waitForRenditions(false,loadMask)
},this.renditionsTimeout)
}else{loadMask.hide();
this.update(this.path)
}}},initComponent:function(){CQ.form.Thumbnail.superclass.initComponent.call(this);
this.image=new CQ.Ext.Panel({border:false,width:this.thumbnailWidth,height:this.thumbnailHeight,cls:"cq-thumbnailfield-thumbnail",bodyStyle:{background:"none"}});
this.add(this.image)
},constructor:function(A){CQ.Ext.applyIf(A,{cls:"cq-thumbnailfield",border:false,imageExtensions:["jpg","gif","png","jpeg"]});
CQ.form.Thumbnail.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("thumbnail",CQ.form.Thumbnail);
CQ.SearchField=CQ.form.SearchField;
CQ.html5=CQ.html5||{};
CQ.html5.Util=new function(){return{isUploadSupported:function(){var A=new XMLHttpRequest();
return !!(A&&("upload" in A)&&("onprogress" in A.upload))
}}
};
CQ.html5=CQ.html5||{};
CQ.html5.UploadDialog=CQ.Ext.extend(CQ.Dialog,{destinationPath:null,useHTML5:true,constructor:function(A){var B=this;
this.useHTML5=A.useHTML5!=undefined?A.useHTML5:true;
if(!CQ.html5.Util.isUploadSupported()){this.useHTML5=false
}CQ.Util.applyDefaults(A,{closable:true,resizable:true,autoHeight:false,autoWidth:false,cls:"cq-uploaddialog",okText:CQ.I18n.getMessage("Upload"),buttons:CQ.Dialog.OKCANCEL,title:CQ.I18n.getMessage("Upload Assets"),formUrl:CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(A.destinationPath)),fileUpload:true,height:300,width:400,useHTML5:this.useHTML5,items:{xtype:"panel",items:[{xtype:"static",cls:"x-form-item-description",html:CQ.I18n.getMessage("Upload to")+": "+A.displayPath},B.makeFileUploadField(this.useHTML5)]},listeners:{beforesubmit:B.onBeforeSubmit,filenamechanged:B.onFileNameChanged,fileremoved:B.onFileRemoved,fileselected:B.onFileSelected,fileuploaderror:B.onFileUploadError,fileuploadok:B.onFileUploadOk,queuechanged:B.onQueueChanged,queueprocessed:B.onQueueProcessed},success:function(){window.setTimeout(function(){B.hideAndReload()
},1000)
},failure:function(){if(B.canceled){B.hideAndReload();
B.canceled=false
}else{var E=CQ.I18n.getMessage("Error");
var D=B.uploadFailed.length==1?CQ.I18n.getMessage("Failed to upload the following file:"):CQ.I18n.getMessage("Failed to upload the following files:");
D+="<br/><br/>";
for(var C=0;
C<B.uploadFailed.length;
C++){D+=CQ.shared.XSS.getXSSValue(B.uploadFailed[C])+"<br/>"
}CQ.Ext.Msg.show({title:E,msg:D,icon:CQ.Ext.Msg.ERROR,buttons:CQ.Ext.Msg.OK,fn:function(){B.hideAndReload()
}})
}}});
CQ.html5.UploadDialog.superclass.constructor.call(this,A)
},initComponent:function(){this.queue=[];
this.addEvents("fileuploadok","fileuploaderror","queuechanged","queueprocessed");
CQ.html5.UploadDialog.superclass.initComponent.call(this)
},hideAndReload:function(){if(this.mask){this.mask.hide()
}this.hide();
var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){A.reloadPages()
}},addFile:function(D,C){var E=C.name?C.name:C;
if(!this.getQueueItemByFileName(E)){var B;
var A;
if(this.useHTML5){B=D.ownerCt.add(this.makeFileUploadField(this.useHTML5,C));
A={file:C,fileName:E,fileSize:C.size,uploadField:B}
}else{D.ownerCt.add(this.makeFileUploadField(this.useHTML5));
A={fileName:C,uploadField:D}
}this.queue.push(A);
this.fireEvent("queuechanged")
}else{if(!this.useHTML5){D.ownerCt.add(this.makeFileUploadField(this.useHTML5));
D.clearFile()
}}},getQueueIndex:function(B){var A=CQ.Ext.each(this.queue,function(C){return !(C.fileName===B)
});
return CQ.Ext.isDefined(A)?A:-1
},getQueueItem:function(A){return A>-1?this.queue[A]:null
},getQueueItemByFileName:function(A){return this.getQueueItem(this.getQueueIndex(A))
},makeFileUploadField:function(C,B){var A=this;
return{xtype:"html5fileuploadfield",hideLabel:true,name:name,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,removable:true,html5Upload:C,fileNamePrefix:A.fileNamePrefix,targetEl:A,file:B}
},onBeforeSubmit:function(dialog){dialog.uploadFailed=[];
var uploadfields=dialog.findByType("html5fileuploadfield");
var parent=CQ.HTTP.eval(CQ.HTTP.noCaching(CQ.HTTP.encodePath(dialog.destinationPath)+".1.json"));
var conflicts=[];
for(var i=0;
i<uploadfields.length;
i++){var name=uploadfields[i].getValue();
if(parent[name]){conflicts.push(name)
}else{uploadfields[i].setName(uploadfields[i].getValue().replace(/"/g,"%22"))
}}if(conflicts.length==0){var siteAdmin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(siteAdmin){siteAdmin.mask()
}return true
}var msg=conflicts.length==1?CQ.I18n.getMessage("An asset of the same name already exists in this location:"):CQ.I18n.getMessage("Assets of the same name already exist in this location:");
msg+="<br/><br/>";
for(i=0;
i<conflicts.length;
i++){msg+=CQ.shared.XSS.getXSSValue(conflicts[i])+"<br/>"
}msg+="<br/><br/>";
msg+=conflicts.length==1?CQ.I18n.getMessage("Click 'Yes' to replace the asset or 'No' to adjust the name."):CQ.I18n.getMessage("Click 'Yes' to replace the assets or 'No' to adjust the names.");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Name Conflict"),msg,function(btnId){if(btnId=="yes"){for(var i=0;
i<conflicts.length;
i++){CQ.HTTP.post(CQ.HTTP.encodePath(dialog.destinationPath+"/"+conflicts[i]),null,{":operation":"delete"})
}dialog.ok()
}else{for(var u=0;
u<uploadfields.length;
u++){if(conflicts.indexOf(uploadfields[u].getValue())!=-1){uploadfields[u].markInvalid(CQ.I18n.getMessage("An asset of the same name already exists in this location."))
}}}});
return false
},onFileNameChanged:function(D,C,A){var B=this.getQueueIndex(A);
if(B>-1){this.queue[B].fileName=C
}},onFileRemoved:function(B){var A=this.getQueueIndex(B);
if(A>-1){this.queue.splice(A,1);
this.fireEvent("queuechanged")
}},onFileSelected:function(B,C){if(this.useHTML5){for(var A=0;
A<C.length;
A++){this.addFile(B,C[A])
}}else{this.addFile(B,C)
}this.doLayout()
},html5UploadFile:function(B){B.uploadField.initProgressBar();
var D=new XMLHttpRequest();
D.onreadystatechange=this.onFileUploadLoad.createDelegate(this,[B,D],0);
D.upload.addEventListener("progress",this.onFileUploadProgress.createDelegate(this,[B],0),false);
D.upload.addEventListener("error",this.onFileUploadError.createDelegate(this,[B],0),false);
var A=B.file;
var E=B.fileName;
if(window.FormData){var C=new FormData();
C.append(E,A);
C.append(CQ.Sling.CHARSET,"utf-8");
D.open("POST",CQ.shared.HTTP.encodePath(this.destinationPath),true);
D.send(C)
}else{D.open("PUT",CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(this.destinationPath))+"/"+CQ.shared.HTTP.encodePath(E),true);
D.send(A)
}},html5UploadFiles:function(){var C=CQ.Ext.getCmp(this.okButtonConfig.id);
if(C){C.setDisabled(true)
}var A=this.findByType("html5fileuploadfield");
A[0].setDisabled(true);
for(var B=0;
B<this.queue.length;
B++){this.html5UploadFile(this.queue[B])
}},onFileUploadError:function(B,A){B.uploadField.handleUploadProgress(B.file,0,B.fileSize,A);
if(this.uploadFailed){this.uploadFailed.push(B.fileName)
}},onFileUploadLoad:function(B,A,C){if(A.readyState===4){if(CQ.HTTP.isOkStatus(A.status)){this.fireEvent("fileuploadok",B)
}else{this.fireEvent("fileuploaderror",B,A.responseText)
}this.queue.splice(this.getQueueIndex(B.fileName),1);
if(this.queue.length==0){this.fireEvent("queueprocessed")
}}},onFileUploadOk:function(A){A.uploadField.handleUploadComplete();
window.setTimeout(function(){var B=A.uploadField.progressBar.getEl().parent("div[class*=x-form-item]");
B.fadeOut({easing:"easeOut",endOpacity:0,duration:0,concurrent:false,remove:true})
},100)
},onFileUploadProgress:function(A,B){A.uploadField.handleUploadProgress(A.file,B.loaded,B.total)
},onQueueChanged:function(){CQ.Ext.getCmp(this.okButtonConfig.id).setDisabled(this.queue.length==0)
},onQueueProcessed:function(){if(this.uploadFailed.length>0){this.failure()
}else{this.success()
}},ok:function(G){var B={};
if(this.responseScope){B.scope=this.responseScope;
B.success=this.success?this.success:this.responseScope.success;
B.failure=this.failure?this.failure:this.responseScope.failure
}else{B.scope=this;
if(this.success){B.success=this.success
}if(this.failure){B.failure=this.failure
}}if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}var F=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(F){F.mask()
}if(this.useHTML5){this.html5UploadFiles()
}else{this.form.items.each(function(J){if(J.emptyText&&J.el.dom.value==J.emptyText){J.setRawValue("")
}});
var E=new CQ.form.UploadSubmitAction(this.form,B);
this.form.doAction(E);
var D=this.findByType("html5fileuploadfield");
var C=(D.length==2)?CQ.I18n.getMessage("Uploading file..."):CQ.I18n.getMessage("Uploading files...");
this.mask=new CQ.Ext.LoadMask(this.body,{msg:C});
this.mask.show()
}}else{var H=[];
this.form.items.each(function(J){if(!J.validate()){H.push(J)
}});
var I=H.length==1?CQ.I18n.getMessage("Invalid Name"):CQ.I18n.getMessage("Invalid Names");
var A=H.length==1?CQ.I18n.getMessage("There is a file with an invalid name. Please verify the marked field."):CQ.I18n.getMessage("There are files with invalid names. Please verify the marked fields.");
CQ.Ext.Msg.show({title:I,msg:A,buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},getOkConfig:function(){if(!this.okButtonConfig){this.okButtonConfig={id:CQ.Ext.id(),text:this.okText,cls:"cq-btn-ok",disabled:true,handler:this.ok}
}return this.okButtonConfig
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(A){if(this.mask){this.mask.hide()
}this.hide()
}}
}});
CQ.Ext.reg("html5uploaddialog",CQ.html5.UploadDialog);
CQ.html5.form=CQ.html5.form||{};
CQ.html5.form.FileUploadField=CQ.Ext.extend(CQ.Ext.form.TextField,{allowEnctypeSetting:true,autoSize:CQ.Ext.emptyFn,buttonOffset:3,buttonOnly:false,buttonText:null,fileInputStyle:null,file:null,html5Upload:true,mimeTypes:[],mimeTypesDescription:null,multiple:true,noDisplay:false,targetEl:null,constructor:function(A){var C=this;
if(A.mimeTypes){if(!CQ.Ext.isArray(A.mimeTypes)){var B=new RegExp("[ ;]+","g");
A.mimeTypes=A.mimeTypes.split(B)
}}CQ.Util.applyDefaults(A,{hideLabel:true,name:A.name,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,removable:true,listeners:{change:function(E,F,D){E.fireEvent("filenamechanged",E,F,D)
}}});
if(!CQ.html5.Util.isUploadSupported()){A.html5Upload=false
}CQ.html5.form.FileUploadField.superclass.constructor.call(this,A)
},initComponent:function(){CQ.html5.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("filenamechanged","fileremoved","fileselected");
if(this.targetEl){this.targetEl.relayEvents(this,["filenamechanged","fileremoved","fileselected"])
}},setName:function(A){if(A){this.fileInput.dom.setAttribute("name",A);
this.name=A
}},onRender:function(F,B){CQ.html5.form.FileUploadField.superclass.onRender.call(this,F,B);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap cq-fileupload-wrapper"});
this.el.addClass("x-form-file-text");
if(this.fileNameParameter){this.el.dom.setAttribute("name",this.fileNameParameter)
}else{this.el.dom.setAttribute("name","")
}var C=this.name||this.getId();
var E={id:this.getFileInputId(),name:C,cls:"x-form-file",tag:"input",type:"file",size:1};
if(this.html5Upload&&this.multiple){E.multiple=true
}this.fileInput=this.wrap.createChild(E);
if(!this.html5Upload){var H={name:C+"@TypeHint",tag:"input",type:"hidden",value:"nt:file"};
this.wrap.createChild(H)
}if(!this.buttonText){this.buttonText=CQ.I18n.getMessage("Browse...")
}var D=CQ.Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});
this.button=new CQ.Ext.Button(CQ.Ext.apply(D,{renderTo:this.wrap,cls:"x-form-file-btn"+(D.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth());
this.fileInput.addClass("x-form-file-button-only");
this.button.addClass("x-form-file-button-only")
}this.fileInput.setWidth((this.button.getEl().getComputedWidth()||55));
if(this.fileInputStyle){for(var A in this.fileInputStyle){try{this.fileInput.setStyle(A,this.fileInputStyle[A])
}catch(G){}}}if(this.file){this.setValue(this.getFileName());
this.switchToClearButton()
}else{this.fileInput.on("change",function(){if(this.html5Upload){var K=this.fileInput.dom.files;
this.uploadAllowed=this.checkHTML5UploadAllowed(K);
if(!this.uploadAllowed){return false
}this.fireEvent("fileselected",this,K)
}else{var I=this.fileInput.dom.value;
if(I.lastIndexOf("\\")!=-1){I=I.substring(I.lastIndexOf("\\")+1)
}this.setValue(I);
this.switchToClearButton();
if(this.allowEnctypeSetting){try{var J=this.findParentByType("form").getForm().el.dom;
J.enctype="multipart/form-data";
J.encoding="multipart/form-data"
}catch(L){}}this.fireEvent("fileselected",this,I)
}},this)
}if(this.noDisplay){this.setVisible(false);
this.button.setVisible(false)
}},checkHTML5UploadAllowed:function(D){var F=[];
for(var C=0;
C<D.length;
C++){var B=D[C];
var A;
for(A=0;
A<this.mimeTypes.length;
A++){var E=this.mimeTypes[A];
if(this.checkMimeTypeAllowed(B.type,E)||this.checkFileExtensionAllowed(B.name,E)){break
}}if(A>0&&A==this.mimeTypes.length){F.push(B.name)
}}return this.displayErrors(F)
},displayErrors:function(C){if(C.length==0){return true
}var B=C.length==1?CQ.I18n.getMessage("Selected file is not accepted:"):CQ.I18n.getMessage("Selected files are not accepted:");
B+="<br/><br/>";
for(var A=0;
A<C.length;
A++){B+=CQ.shared.XSS.getXSSValue(C[A])+"<br/>"
}if(this.mimeTypesDescription){B+="<br/>"+CQ.I18n.getMessage("Expecting: {0}",this.mimeTypesDescription)
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),B);
return false
},checkMimeTypeAllowed:function(E,C){var B=/(.+)\/(.+)/;
var D=C.match(B);
if(D){var A=E.match(B);
if(A[1].toLowerCase()===D[1].toLowerCase()){if(D[2]==="*"){return true
}return A[2].toLowerCase()===D[2].toLowerCase()
}}return false
},checkFileExtensionAllowed:function(E,C){var B=/(.+)\.(.+)$/;
var D=C.match(B);
if(D){var A=E.match(B);
if(D[1]==="*"||A[1].toLowerCase()===D[1].toLowerCase()){if(D[2]==="*"){return true
}return A[2].toLowerCase()===D[2].toLowerCase()
}}return false
},switchToClearButton:function(){if(this.removable){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this);
this.fileInput.applyStyles("z-index: -100")
}},clearFile:function(){var A=this.ownerCt;
this.fireEvent("fileremoved",this.getValue());
A.remove(this,true);
A.ownerCt.doLayout()
},destroy:function(){var A=this.getEl().dom.parentNode;
this.fileInput.remove();
this.button.destroy();
CQ.html5.form.FileUploadField.superclass.destroy.call(this);
A.parentNode.removeChild(A)
},getFileInputId:function(){return this.id+"-file"
},initProgressBar:function(){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
this.progressText=new CQ.Static({cls:"cq-fileuploadfield-progress-text"});
new CQ.Ext.Panel({renderTo:this.wrap.insertSibling({tag:"div",cls:"cq-fileupload-progress-wrapper"}),border:false,bodyStyle:"width: "+this.wrap.getWidth(true)+"px;",anchorTo:this.wrap,items:[this.progressBar,this.progressText]});
new CQ.Ext.Button({renderTo:this.progressBar.wrap,text:CQ.I18n.getMessage("Cancel")});
this.wrap.remove()
},getFileName:function(){if(this.file){return this.file.name?this.file.name:this.file
}return null
},handleUploadProgress:function(A,B,E){if(!this.progressBar){this.initProgressBar()
}var D=Math.round(100*B/E);
var C=CQ.I18n.getMessage("{0} of {1}",[CQ.Util.formatFileSize(B),CQ.Util.formatFileSize(E)],"file upload progress");
this.progressBar.updateProgress(D/100,CQ.shared.XSS.getXSSValue(A.name).replace("\\\\\\\\","\\"));
this.progressText.updateText(C)
},handleUploadComplete:function(){if(!this.progressBar){this.initProgressBar()
}this.progressBar.updateProgress(1);
this.progressText.updateText(CQ.I18n.getMessage("Complete",null,"adjective"))
},onResize:function(A,B){CQ.html5.form.FileUploadField.superclass.onResize.call(this,A,B);
this.wrap.setWidth(A);
if(!this.buttonOnly){var A=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(A)
}},preFocus:CQ.Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
},setDisabled:function(A){CQ.html5.form.FileUploadField.superclass.setDisabled.call(this,A);
this.button.setDisabled(A)
}});
CQ.Ext.reg("html5fileuploadfield",CQ.html5.form.FileUploadField);
CQ.html5.form.SmartFile=CQ.Ext.extend(CQ.form.CompositeField,{uploadUrl:null,iconResources:null,extensionToIcon:null,defaultIcon:null,useHTML5:true,mimeTypes:null,mimeTypesDescription:null,ddGroups:null,ddAccept:null,sizeLimit:0,fileLimit:0,invalidClass:null,fixedHeight:null,compWidth:0,compHeight:0,fileNameParameter:null,fileReferenceParameter:null,fileNameInputField:null,moveParameter:null,deleteFileParameter:null,deletePathParameter:null,lockIconCls:null,lockPanelCls:null,lockHintCls:null,cancelInheritanceText:null,revertInheritanceText:null,uploadText:null,uploadTextUpload:null,uploadTextReference:null,uploadTextFallback:null,uploadIconCls:null,uploadPanelCls:null,uploadHintCls:null,removeUploadPanelClsOnProgress:false,validateOnSubmitOnly:false,allowUpload:false,allowFileReference:false,allowFileNameEditing:false,transferFileName:false,noFileNameText:"",isUploaded:false,textEl:null,lockTextEl:null,uploadPanel:null,fileInfo:null,serverFileInstance:null,referencedFileInfo:null,renditionSuffix:null,fallbackRenditionSuffix:null,headPanel:null,footPanel:null,instanceId:0,constructor:function(A){this.instanceId=CQ.html5.form.SmartFile.ID_COUNTER++;
this.useHTML5=A.useHTML5!=undefined?A.useHTML5:true;
if(!CQ.html5.Util.isUploadSupported()){this.useHTML5=false
}A=A||{};
var B={hideBorders:true,border:false,anchor:CQ.themes.Dialog.ANCHOR,mimeTypes:"*.*",mimeTypesDescription:CQ.I18n.getMessage("All files"),ddAccept:"*",sizeLimit:0,fileLimit:100,stateful:false,allowBlank:true,validateOnSubmitOnly:false,invalidClass:"cq-smartfile-invalid",allowUpload:true,allowFileReference:true,allowFileNameEditing:true,transferFileName:true,noFileNameText:"???",uploadPanelCls:"cq-upload-border",uploadHintCls:"cq-upload-hint",removeUploadPanelClsOnProgress:true,lockIconCls:"cq-lock-placeholder",lockHintCls:"cq-lock-hint",lockPanelCls:"cq-lock-panel",uploadIconCls:"cq-file-placeholder",uploadTextUpload:CQ.I18n.getMessage("Click to upload"),uploadTextReference:CQ.I18n.getMessage("Drop an asset"),uploadTextFallback:CQ.I18n.getMessage("Upload file"),uploadText:CQ.I18n.getMessage("Drop an asset or click to upload"),cancelInheritanceText:CQ.I18n.getMessage("Click to cancel inheritance"),revertInheritanceText:CQ.I18n.getMessage("Click here to revert inheritance"),iconResources:CQ.themes.SmartFile.ICON_RESOURCES,extensionToIcon:CQ.themes.SmartFile.EXTENSION_TO_ICON,defaultIcon:CQ.themes.SmartFile.DEFAULT_ICON,renditionSuffix:CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH+CQ.html5.form.SmartFile.DAM_WEB_RENDITION_NAME,fallbackRenditionSuffix:CQ.html5.form.SmartFile.DAM_RENDITION_SUFFIX,height:120,listeners:{resize:this.onComponentResize,fileselected:this.onFileSelected},useHTML5:this.useHTML5};
if(A.allowFileReferenceOnly!==undefined){A.allowFileReference=!A.allowFileReferenceOnly;
delete A.allowFileReferenceOnly
}if(this.allowUploadOnly!==undefined){A.allowUpload=!A.allowUploadOnly;
delete A.allowUploadOnly
}if(!A.allowFileReference&&!A.allowUpload){A.allowFileReference=true
}A.autoScroll=false;
A.bodyStyle="padding: 0px; overflow: hidden;";
A.layout="border";
CQ.Util.applyDefaults(A,B);
if(A.height&&(A.height!="auto")){this.fixedHeight=A.height
}else{this.fixedHeight=null
}CQ.html5.form.SmartFile.superclass.constructor.call(this,A)
},initComponent:function(){CQ.html5.form.SmartFile.superclass.initComponent.call(this);
var B=this;
this.containerPanel=new CQ.Ext.Panel({region:"center",ctCls:CQ.DOM.encodeClass("smartfile-"+this.name),activeItem:0,autoScroll:false,bodyStyle:"padding: 0px; overflow: hidden;",layout:"card"});
this.add(this.containerPanel);
this.lockPanel=new CQ.Ext.Panel({itemId:"lock",cls:this.lockPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(E,F,D){if(typeof F=="object"){D=F.height;
F=F.width
}this._width=F;
this._height=D;
if(this.rendered){B.setTextElSize(B.lockTextEl,F,D)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(B.fixedHeight){var D=B.fixedHeight;
this.el.setHeight(D);
this.body.setHeight(D-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.lockPanel);
this.uploadPanel=new CQ.Ext.Panel({itemId:"upload",cls:this.uploadPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(E,F,D){if(typeof F=="object"){D=F.height;
F=F.width
}this._width=F;
this._height=D;
if(this.rendered){B.setTextElSize(B.textEl,F,D);
B.setProgressBarSize(F,D)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(B.fixedHeight){var D=B.fixedHeight;
this.el.setHeight(D);
this.body.setHeight(D-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.uploadPanel);
this.createFileNameEditingCapability();
this.processingPanel=this.createProcessingPanel();
this.containerPanel.add(this.processingPanel);
this.createHiddenInterfaceFields();
if(this.headPanel){this.headPanel.region="north";
this.add(this.headPanel)
}if(this.footPanel){this.footPanel.region="south";
this.add(this.footPanel)
}if(!this.useHTML5){var A={name:this.name,fieldLabel:this.uploadTextFallback,fileNameParameter:this.fileNameParameter,allowFileNameEditing:this.allowFileNameEditing,html5Upload:false,multiple:false,mimeTypes:this.mimeTypes,mimeTypesDescription:this.mimeTypesDescription,removable:false,targetEl:this};
if(this.fullTab){A.fieldLabel=this.uploadTextFallback
}this.fallbackFileField=new CQ.html5.form.FileUploadField(A);
var C={itemId:"fallback",layout:"form",defaults:{anchor:CQ.themes.Dialog.ANCHOR},hideMode:"offsets",border:false,items:this.fallbackFileField};
if(this.fullTab){C.bodyStyle=CQ.themes.Dialog.TAB_BODY_STYLE
}else{C.defaults.hideLabel=true
}this.fallbackPanel=new CQ.Ext.Panel(C);
this.containerPanel.add(this.fallbackPanel)
}},getToplevel:function(){var A=this.findParentByType("dialog");
if(!A){A=this.findParentByType(CQ.Ext.form.FormPanel)
}return A
},onRender:function(B,E){CQ.html5.form.SmartFile.superclass.onRender.call(this,B,E);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var A=this.findParentByType("dialog");
if(A){A.on("beforesubmit",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}else{var C=this.findParentByType(CQ.Ext.form.FormPanel);
if(C){var D=C.getForm();
D.on("beforeaction",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}}},afterRender:function(){CQ.html5.form.SmartFile.superclass.afterRender.call(this);
this.initializeDragAndDrop()
},onComponentResize:function(B,A){if(typeof B=="object"){A=B.height;
B=B.width
}this.compWidth=B;
this.compHeight=A
},switchPropertyInheritance:function(){},markInvalid:function(A){if(!this.rendered||this.preventMark){return 
}A=A||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.processingPanel.markInvalid(this.invalidClass);
this.uploadPanel.body.dom.qtip=A;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,A)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}this.uploadPanel.body.removeClass(this.invalidClass);
this.processingPanel.clearInvalid(this.invalidClass);
this.fireEvent("valid",this)
},validateOnStateChange:function(){if(!this.validateOnSubmitOnly){this.validate()
}this.validateLinkingFieldsOnStateChange()
},validateLinkingFieldsOnStateChange:function(){var D=this.getToplevel();
if(D){var B=CQ.Util.findFormFields(D);
if(B){for(var A in B){if(B.hasOwnProperty(A)){var F=B[A];
var E=F.length;
for(var G=0;
G<E;
G++){var C=F[G];
if(C.linkedComponent==this.name){C.validate()
}}}}}}},hasData:function(){return(this.fileInfo!=null)||(this.referencedFileInfo!=null)
},hasUploadedData:function(){return(this.fileInfo!=null)
},hasReferencedData:function(){return(this.referencedFileInfo!=null)
},createFileNameEditingCapability:function(){if(!this.allowFileNameEditing){this.fileNameField=new CQ.Ext.form.Hidden({disabled:!this.transferFileName})
}else{this.fileNameField=new CQ.Ext.form.TextField({autoHeight:false});
this.transferFileName=true
}this.containerPanel.add(this.fileNameField)
},createHiddenInterfaceFields:function(){this.fileReferenceField=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.fileReferenceField);
this.moveParameter=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.moveParameter);
this.deleteFileParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deleteFileParameter);
this.deletePathParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deletePathParameter);
this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},onBeforeSubmit:function(){return true
},getRawValue:function(){var A="";
if(this.fileInfo){A+='[instance:"'+this.fileInfo.dataPath+'" "'+this.fileInfo.mimeType+'" '+this.fileInfo.size+"]"
}if(this.referencedFileInfo){A+='[reference:"'+this.referencedFileInfo.dataPath+'" "'+this.referencedFileInfo.mimeType+'" '+this.referencedFileInfo.size+"]"
}if(this.fileNameInputField){A+='[fileName:"'+this.fileNameInputField.getValue()+'"]'
}return A
},createRefUrl:function(A){var C="";
for(var D in A.renditions){var E=CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH+D;
if(E==this.renditionSuffix){break
}if(E.indexOf(this.renditionSuffix)==0){C=D.substring(D.lastIndexOf("."));
break
}}var B=A.dataPath+this.renditionSuffix+C;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(B),true)
},createFallbackRefUrl:function(A){var B=A.dataPath+this.fallbackRenditionSuffix;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(B),true)
},getSuitableFileInfo:function(){if(this.referencedFileInfo!=null){return this.referencedFileInfo
}return this.fileInfo
},processPath:function(B,A){if(A){this.dataPath=B;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
this.validateOnStateChange();
this.syncFormElements();
this.updateView()
}},processRecord:function(A,E){if(this.fireEvent("beforeloadcontent",this,A,E)!==false){this.dataPath=E;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
var F;
if(this.fileNameParameter){F=A.get(this.fileNameParameter)
}if(this.fileReferenceParameter){var B=A.get(this.fileReferenceParameter);
if(B){this.referencedFileInfo=this.resolveReference(B,E);
if(F){this.referencedFileInfo.fileName=F
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo)
}}var D=A.get(this.name);
if(D){if(D["jcr:content"]){D=CQ.Sling.processBinaryData(D["jcr:content"])
}else{D=CQ.Sling.processBinaryData(D)
}if(D){var C=CQ.Sling.getContentPath(this.name,E);
this.fileInfo={fileName:F,dataPath:C,mimeType:D.type,size:D.size,url:CQ.HTTP.externalize(C,true)};
this.serverFileInstance=this.fileInfo
}}this.postProcessRecord(A,E);
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
this.fireEvent("loadcontent",this,A,E)
}},postProcessRecord:function(A,B){},resolveReference:function(fileRef,basePath){var refFileInfo=null;
var originalFileRef=fileRef;
try{if(fileRef.indexOf("/")==0){fileRef=fileRef+"/jcr:content.infinity";
var json=CQ.HTTP.eval(CQ.shared.HTTP.encodePath(fileRef)+CQ.HTTP.EXTENSION_JSON);
var refValue=CQ.Util.formatData(json);
if(refValue){refFileInfo=CQ.Sling.processBinaryData(refValue);
if(refFileInfo.renditions&&refFileInfo.renditions.original&&refFileInfo.renditions.original["jcr:content"]){refFileInfo.size=refFileInfo.renditions.original["jcr:content"][":jcr:data"];
refFileInfo.mimeType=refFileInfo.renditions.original["jcr:content"]["jcr:mimeType"]
}if(!refFileInfo.mimeType&&refFileInfo.metadata){refFileInfo.mimeType=refFileInfo.metadata["dc:format"]
}if(basePath){refFileInfo.dataPath=CQ.Sling.getContentPath(originalFileRef,basePath);
refFileInfo.url=CQ.HTTP.externalize(refFileInfo.dataPath)
}else{refFileInfo.dataPath=originalFileRef;
refFileInfo.url=originalFileRef
}}}else{refFileInfo={dataPath:fileRef,url:fileRef}
}}catch(e){CQ.Log.error("SmartFile#resolveReference: failed to resolve reference: "+e.message)
}return refFileInfo
},syncFormElements:function(){var F=this.name;
if(this.fileNameField){if(!this.fileNameParameter){this.fileNameParameter=F+CQ.html5.form.SmartFile.PARAM_FILENAME_SUFFIX
}if(this.useHTML5||this.containerPanel.layout.activeItem.itemId!="fallback"){this.fileNameField.getEl().dom.name=this.fileNameParameter;
if(this.fallbackFileField){this.fallbackFileField.getEl().dom.name=""
}}else{this.fileNameField.getEl().dom.name="";
this.fallbackFileField.getEl().dom.name=this.fileNameParameter
}}if(this.fileReferenceField){if(!this.fileReferenceParameter){this.fileReferenceParameter=F+CQ.html5.form.SmartFile.PARAM_REFERENCE_SUFFIX
}this.fileReferenceField.getEl().dom.name=this.fileReferenceParameter
}if(this.moveParameter){this.moveParameter.getEl().dom.name=F+CQ.Sling.MOVE_SUFFIX
}if(this.deleteFileParameter){this.deleteFileParameter.getEl().dom.name=F+CQ.Sling.DELETE_SUFFIX
}if(this.fileReferenceField){var C=(this.referencedFileInfo?this.referencedFileInfo.dataPath:"");
this.fileReferenceField.setValue(C);
this.fileReferenceField.enable()
}if(this.moveParameter){if(this.fileInfo&&this.isUploaded){this.moveParameter.setValue(this.fileInfo.dataPath);
this.moveParameter.enable()
}else{this.moveParameter.disable()
}}if(this.useHTML5&&this.deleteFileParameter){if(this.serverFileInstance&&!this.fileInfo){this.deleteFileParameter.enable()
}else{this.deleteFileParameter.disable()
}}var A=false;
var B;
var E=F.lastIndexOf("/");
if(E>0){var D=F.substring(0,E);
if(D!="."){A=true;
B=D
}}if(A){this.lastModifiedParameter.getEl().dom.name=B+"/jcr:lastModified";
this.lastModifiedByParameter.getEl().dom.name=B+"/jcr:lastModifiedBy";
this.lastModifiedParameter.enable();
this.lastModifiedByParameter.enable()
}else{this.lastModifiedParameter.getEl().dom.name=null;
this.lastModifiedByParameter.getEl().dom.name=null;
this.lastModifiedParameter.disable();
this.lastModifiedByParameter.disable()
}},flush:function(){if(this.referencedFileInfo){this.referencedFileInfo=null
}else{if(this.fileInfo){this.fileInfo=null
}}if((this.referencedFileInfo==null)&&(this.fileInfo==null)&&this.fileNameField){this.fileNameField.setValue("")
}this.validateOnStateChange();
if(!this.useHTML5){this.deleteFileParameter.enable();
this.fallbackFileField.fileInput.dom.name="";
this.fallbackFileField.setValue("")
}},createLockPanel:function(){this.isLockPanelCreated=true;
var C=this.lockPanel.body;
var F=this.lockPanel.items.getCount();
for(var B=F-1;
B>=0;
B--){this.remove(this.lockPanel.items.itemAt(B))
}var A;
if(this.lockIconCls){A='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.lockIconCls+'"><br>'
}else{A=""
}var D=this.cancelInheritanceText;
var E=A+D;
this.lockTextEl=C.createChild({tag:"div",html:E});
this.lockTextEl.addListener("click",function(){this.switchPropertyInheritance()
},this);
this.lockTextEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.lockPanel._width&&this.lockPanel._height){this.setTextElSize(this.lockTextEl,this.lockPanel._width,this.lockPanel._height)
}if(this.lockHintCls){this.lockTextEl.addClass(this.lockHintCls)
}},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var A=(this.fileInfo!=null)||(this.referencedFileInfo!=null);
this.updateViewBasics(A);
if(A){this.createProcessingPanelContents()
}}this.doLayout()
},updateViewBasics:function(A){if(!A){this.containerPanel.getLayout().setActiveItem("upload");
if(!this.isUploadPanelCreated){this.createUploadPanel()
}else{this.switchToUploadBase()
}if(this.uploadHintCls){this.body.addClass(this.uploadHintCls);
if(this.textEl){this.textEl.addClass(this.uploadHintCls)
}}}else{if(this.uploadHintCls){this.body.removeClass(this.uploadHintCls);
if(this.textEl){this.textEl.removeClass(this.uploadHintCls)
}}this.containerPanel.getLayout().setActiveItem("processing")
}},createProcessingPanel:function(){return new CQ.form.SmartFile.FileInfoDisplay({itemId:"processing",fileNameField:(this.allowFileNameEditing&&this.fileNameField?this.fileNameField:null),parentComponent:this})
},createProcessingPanelContents:function(){var D=this.getSuitableFileInfo();
var C=D.fileName;
var H=null;
if(C){var E=C.lastIndexOf(".");
if((E>=0)&&(E<(C.length-1))){H=C.substring(E+1,C.length).toLowerCase()
}}var F=this.defaultIcon;
if(H&&this.extensionToIcon[H]){F=this.extensionToIcon[H]
}var G=this.iconResources;
if(G.charAt(G.length-1)!="/"){G+="/"
}var A=CQ.HTTP.externalize(G+F);
var J=CQ.I18n.getMessage("unknown");
if(D.mimeType){J=D.mimeType
}var B=CQ.I18n.getMessage("unknown");
if(D.size){B=CQ.Util.formatFileSize(D.size)
}var I=CQ.I18n.getMessage("MIME type: {0}<br>Size: {1}",[J,B]);
if(this.referencedFileInfo){I+="<br>"+this.getRefText(this.referencedFileInfo.dataPath,C)
}if(!this.transferFileName){C=this.noFileNameText
}this.processingPanel.updateContent(C,I,A)
},getRefText:function(B,C){var A=CQ.User.getCurrentUser().hasPermissionOn("update",B);
var E=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.shared.HTTP.encodePath(B),true));
var D=CQ.I18n.getMessage("Referenced from:")+" ";
if(A){D+='<a href="'+E+'" target="_blank" title="'+CQ.I18n.getMessage("Click here to open referenced file")+'" style="cursor:pointer;">'
}D+=CQ.shared.XSS.getXSSValue(C?C:B);
if(A){D+="</a>"
}return D
},createRevertInheritanceHint:function(){var A=this.uploadPanel.body.createChild({tag:"div",cls:this.lockHintCls,html:this.revertInheritanceText});
A.addListener("click",function(){this.switchPropertyInheritance()
},this)
},createUploadPanel:function(){this.isUploadPanelCreated=true;
var D=this.uploadPanel.body;
var G=this.uploadPanel.items.getCount();
for(var C=G-1;
C>=0;
C--){this.remove(this.uploadPanel.items.itemAt(C))
}var B;
if(this.uploadIconCls){B='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.uploadIconCls+'"><br>'
}else{B=""
}var E=this.uploadText;
if(!this.allowUpload){E=this.uploadTextReference
}if(!this.allowFileReference){E=this.uploadTextUpload
}var F=B+E;
this.textEl=D.createChild({tag:"div",html:F});
if(this.delayedCreateRevertInheritanceHint&&!this.isLockHintCreated){this.createRevertInheritanceHint();
this.delayedCreateRevertInheritanceHint=false;
this.isLockHintCreated=true
}if(!this.useHTML5){this.textEl.addListener("click",function(){this.containerPanel.getLayout().setActiveItem("fallback");
this.fallbackFileField.fileInput.dom.name=this.name;
this.deleteFileParameter.disable()
},this)
}if(this.uploadHintCls){this.textEl.addClass(this.uploadHintCls)
}this.textEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setTextElSize(this.textEl,this.uploadPanel._width,this.uploadPanel._height)
}if(this.useHTML5){if(this.uploadHintCls){this.body.addClass(this.uploadHintCls)
}if(this.allowUpload){var A=this;
(function(){var H=A.uploadPanel._height?A.uploadPanel._height:A.ownerCt.getHeight();
if(A.textEl){H=A.textEl.getHeight()
}var J=A.uploadPanel._width?A.uploadPanel._width:A.ownerCt.getWidth();
A.uploadField=new CQ.html5.form.FileUploadField({name:this.name,html5Upload:true,multiple:false,mimeTypes:this.mimeTypes,mimeTypesDescription:this.mimeTypesDescription,noDisplay:true,targetEl:this,renderTo:A.uploadPanel.id,fileInputStyle:{"font-size":"1000px",position:"absolute",top:0,left:0,height:H+"px",width:J+"px"}});
var I=A.uploadField.el.parent();
I.setStyle("position","absolute");
I.setStyle("top","0");
I.setStyle("left","0");
I.setStyle("height",H+"px");
I.setStyle("width",J+"px")
}).call(this)
}}},switchToUploadProgress:function(){if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.removeClass(this.uploadPanelCls)
}var B=this.uploadPanel.body;
if(this.useHTML5){this.textEl.setVisible(false)
}if(!this.progressBar){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
var A="padding-left: 5px; padding-right: 5px; position: absolute; top: 0px; left: 0px;";
if(this.fixedHeight){A+=" height: "+this.fixedHeight+"px"
}this.progressBarDiv=B.createChild({tag:"div",style:A});
this.progressBarDiv.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setProgressBarSize(this.uploadPanel._width,this.uploadPanel._height)
}this.progressBar.render(this.progressBarDiv);
this.progressBar.updateProgress(0,CQ.I18n.getMessage("Uploading ..."))
}else{this.progressBarDiv.setVisible(true)
}},switchToUploadBase:function(){if(this.progressBarDiv){this.progressBarDiv.setVisible(false)
}if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.addClass(this.uploadPanelCls)
}this.textEl.setVisible(true)
},setTextElSize:function(B,C,A){if(B){if(!this.msgHeight){this.msgHeight=B.getHeight()
}var D=Math.round((A-this.msgHeight)/2);
if(D>0){B.setStyle("padding-top",D+"px")
}if(this.uploadField){if(this.textEl||this.lockTextEl){A=this.textEl&&this.textEl.getHeight()>0?this.textEl.getHeight():(this.lockTextEl&&this.lockTextEl.getHeight()>0?this.lockTextEl.getHeight():A)
}this.uploadField.fileInput.setStyle("height",A+"px");
this.uploadField.el.parent().setStyle("height",A+"px")
}}},setProgressBarSize:function(B,A){if(this.progressBarDiv){this.progressBarDiv.setSize(B,A)
}},flushFile:function(){this.flush();
this.syncFormElements();
this.updateView()
},initializeDragAndDrop:function(){if(this.allowFileReference&&this.ddGroups){if(typeof (this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var E=this;
var F=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(J,G,I){if(J&&J.clearAnimations){J.clearAnimations(this)
}if(J.isDropAllowed(this)){var H=E.handleDrop(I);
if(H){G.stopEvent()
}return H
}}});
var C=this.getToplevel();
if(C){C.on("activate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F);
C.on("deactivate",function(H){if(H&&H.el&&this.highlight){var G=parseInt(H.el.getStyle("z-index"),10);
if(!isNaN(G)){this.highlight.zIndex=G+1
}}},F)
}for(var B=0;
B<this.ddGroups.length;
B++){F.addToGroup(this.ddGroups[B])
}F.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var A=this.ddAccept;
if(A){if(!CQ.Ext.isArray(A)){var D=new RegExp("[ ;]+","g");
A=A.split(D)
}F.ddAccept=A
}this.dropTargets=[];
this.dropTargets.push(F)
}},handleDrop:function(A){if(this.handleDropBasics(A)){this.syncFormElements();
this.updateView();
return true
}return false
},handleDropBasics:function(C){if(C.records&&C.single){var A=C.records[0];
var B=A.get("path");
this.referencedFileInfo=this.resolveReference(B,this.dataPath);
var D=A.get("name");
if(D){this.referencedFileInfo.fileName=D
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo);
this.validateOnStateChange();
return true
}return false
},onFileSelected:function(D,E){if(this.useHTML5&&E.length>0){this.handleUploadStart();
var C=E[0];
var F=new XMLHttpRequest();
F.onreadystatechange=this.handleUploadLoad.createDelegate(this,[C,F],0);
F.upload.addEventListener("progress",this.handleUploadProgress.createDelegate(this,[C],0),false);
F.upload.addEventListener("error",this.handleUploadError.createDelegate(this,[C,F],0),false);
var B=this.uploadUrl;
var G;
var A;
if(window.FormData){G="POST";
A=new FormData();
A.append(this.name,C);
A.append(CQ.Sling.CHARSET,"utf-8")
}else{if(CQ.shared.String.endsWith(B,"/*")){this.tmpUrl=B=B.replace(/\/\*$/,"")+"/file_"+(new Date()).getTime()
}G="PUT";
A=C
}F.open(G,CQ.HTTP.externalize(CQ.HTTP.encodePath(B)),true);
F.send(A)
}return true
},onUploaded:function(){this.syncFormElements();
this.updateView();
return true
},formatTimeLeft:function(B){if(B>86399){B=Math.round(B/86400);
if(B==1){return CQ.I18n.getMessage("{0} day",[B])
}else{return CQ.I18n.getMessage("{0} days",[B])
}}else{if(B>3599){B=new String(B/3600);
var A=B.indexOf(".");
if(A>0){if(B.charAt(A+1)=="0"){B=B.substring(0,A)
}else{B=B.substring(0,A+2)
}}if(B==1){return CQ.I18n.getMessage("{0} hour",[B])
}else{return CQ.I18n.getMessage("{0} hours",[B])
}}else{if(B<=3600&&B>59){B=Math.round(B/60)+"";
if(B==1){return CQ.I18n.getMessage("{0} minute",[B])
}else{return CQ.I18n.getMessage("{0} minutes",[B])
}}else{if(B==1){return CQ.I18n.getMessage("{0} second",[B])
}else{return CQ.I18n.getMessage("{0} seconds",[B])
}}}}},estimateTimeLeft:function(A,B){var C=new Date().valueOf()-this.startTime;
var D=Math.round(C*(B-A)/A/1000);
return this.formatTimeLeft(D)
},handleDialogStart:function(){if(this.pendingFiles>0){this.pendingFiles=0
}},handleUploadLoad:function(A,B){if(B.readyState===4){this.uploadPanel.setVisible(false);
if(CQ.HTTP.isOkStatus(B.status)){this.handleUploadSuccess(A,B.responseText)
}else{this.handleUploadError(A,B)
}}},handleUploadStart:function(A){this.hasUploadErrors=false;
this.startTime=new Date().valueOf();
this.switchToUploadProgress();
this.uploadPanel.setVisible(true);
return true
},handleUploadProgress:function(B,A){var C=CQ.I18n.getMessage("{0} of {1} - {2}",[CQ.Util.formatFileSize(A.loaded),CQ.Util.formatFileSize(A.total),this.estimateTimeLeft(A.loaded,A.total)]);
this.progressBar.updateProgress(A.loaded/A.total,C)
},handleUploadSuccess:function(B,D){var A=false;
var G=this.fileInfo;
var C=CQ.HTTP.buildPostResponseFromHTML(D);
var F=window.FormData!==undefined;
if(F?CQ.HTTP.isOk(C):D===""){var I;
try{if(F){try{I=C.headers[CQ.HTTP.HEADER_PATH];
if(this.name=="./*"){I=I+"/"+B.name
}else{I=I+"/"+this.name
}}catch(E){CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: "+E.message)
}}else{I=this.tmpUrl?this.tmpUrl:this.uploadUrl
}try{this.fileInfo=this.resolveReference(I,this.dataPath);
this.fileInfo.fileName=B.name
}catch(E){this.fileInfo={fileName:B.name,dataPath:I,url:CQ.HTTP.externalize(I),size:B.size}
}this.isUploaded=true;
A=(this.onUploaded()!==false);
if(this.transferFileName&&this.fileNameField){this.fileNameField.setValue(this.fileInfo.fileName)
}else{this.fileNameField.setValue("")
}this.validateOnStateChange()
}catch(E){CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: "+E.message)
}}else{CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: response not ok")
}var H;
if(!A){this.fileInfo=G;
this.hasUploadErrors=true;
H=CQ.I18n.getMessage("Error uploading '{0}'",[B.name]);
this.notify(H,CQ.html5.form.SmartFile.STATUS_ERROR)
}},handleUploadError:function(A,C){this.hasUploadErrors=true;
var B=CQ.I18n.getMessage("Failed to upload '{0}': {1}",[CQ.shared.XSS.getXSSValue(A.name),C.responseText]);
this.notify(B,CQ.html5.form.SmartFile.STATUS_ERROR)
},handleUploadComplete:function(){this.startTime=0;
this.pendingFiles=0
},reset:function(){this.flush();
CQ.html5.form.SmartFile.superclass.reset.call(this)
},notify:function(B,A){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Upload"),B)
}});
CQ.html5.form.SmartFile.PARAM_FILENAME_SUFFIX="Name";
CQ.html5.form.SmartFile.PARAM_REFERENCE_SUFFIX="Reference";
CQ.html5.form.SmartFile.DAM_RENDITION_SUFFIX="/jcr:content/renditions/original";
CQ.html5.form.SmartFile.DAM_WEB_RENDITION_NAME="cq5dam.web.1280.1280";
CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH="/jcr:content/renditions/";
CQ.html5.form.SmartFile.STATUS_SUCCESS=0;
CQ.html5.form.SmartFile.STATUS_ERROR=1;
CQ.html5.form.SmartFile.STATUS_SUBMISSION=2;
CQ.html5.form.SmartFile.ID_COUNTER=0;
CQ.Ext.reg("html5smartfile",CQ.html5.form.SmartFile);
CQ.html5.form.SmartImage=CQ.Ext.extend(CQ.html5.form.SmartFile,{originalImage:null,processedImage:null,originalRefImage:null,processedRefImage:null,requestSuffix:null,imageToolDefs:null,mapParameter:null,cropParameter:null,rotateParameter:null,disableFlush:null,disableZoom:null,toolComponents:null,pathProvider:null,hideMainToolbar:false,imagesPending:0,disableInfo:false,infoTip:null,constructor:function(B){B=B||{};
var D={fullTab:true,mimeTypes:"*.jpg;*.jpeg;*.gif;*.png",mimeTypesDescription:CQ.I18n.getMessage("Images"),ddAccept:"image/",uploadPanelCls:null,removeUploadPanelClsOnProgress:false,allowFileNameEditing:false,transferFileName:false,uploadIconCls:"cq-image-placeholder",uploadTextReference:CQ.I18n.getMessage("Drop an image"),uploadTextFallback:CQ.I18n.getMessage("Upload image"),uploadText:CQ.I18n.getMessage("Drop an image or click to upload"),height:"auto",anchor:null,pathProvider:CQ.html5.form.SmartImage.defaultPathProvider,hideMainToolbar:false};
this.imageToolDefs=[];
if(B.mapParameter){this.imageToolDefs.push(new CQ.form.ImageMap(B.mapParameter));
delete B.mapParameter
}if(B.cropParameter){this.imageToolDefs.push(new CQ.form.ImageCrop(B.cropParameter));
delete B.cropParameter
}if(B.rotateParameter){this.imageToolDefs.push(new CQ.form.SmartImage.Tool.Rotate(B.rotateParameter));
delete B.rotateParameter
}CQ.Util.applyDefaults(B,D);
CQ.html5.form.SmartImage.superclass.constructor.call(this,B);
this.addEvents("beforeloadimage","loadimage","imagestate");
var A=this.imageToolDefs.length;
for(var C=0;
C<A;
C++){this.imageToolDefs[C].initialize(B)
}},initComponent:function(){CQ.html5.form.SmartImage.superclass.initComponent.call(this);
this.workingAreaContainer=new CQ.Ext.Panel({itemId:"workingArea",border:false,layout:"border"});
this.processingPanel.add(this.workingAreaContainer);
this.workingArea=new CQ.Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,listeners:{beforeadd:function(C,D){if(C._width&&C._height&&D.notifyResize){D.notifyResize.call(D,this._width,this._height)
}},bodyresize:function(D,F,C){if(typeof F=="object"){C=F.height;
F=F.width
}if(F&&C){D._width=F;
D._height=C;
var H=D.items.getCount();
for(var E=0;
E<H;
E++){var G=D.items.get(E);
if(G.notifyResize){G.notifyResize.call(G,F,C)
}}}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}});
this.workingAreaContainer.add(this.workingArea);
this.imagePanel=new CQ.form.SmartImage.ImagePanel({itemId:"imageview",listeners:{"smartimage.zoomchange":{fn:function(C){if(this.zoomSlider){this.suspendEvents();
this.zoomSlider.setValue(C*10);
this.resumeEvents()
}},scope:this},"smartimage.defaultview":{fn:this.disableTools,scope:this}}});
this.workingArea.add(this.imagePanel);
if(this.topPanel){this.topPanel.region="north";
this.workingAreaContainer.add(this.topPanel)
}var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].initComponent(this)
}this.on("loadimage",this.adjustUI,this)
},onRender:function(B,C){CQ.html5.form.SmartImage.superclass.onRender.call(this,B,C);
var A=this.getToplevel();
if(A){A.on("hide",function(){this.hideTools();
this.imagePanel.ignoreRotation=false;
this.toolSelector.disable();
this.imagePanel.disablePanelTemporaryily()
},this);
A.on("editlocked",function(D,E){if(this.savedDropTargets==null){this.savedDropTargets=this.dropTargets
}this.dropTargets=null
},this);
A.on("editunlocked",function(D,E){if(this.savedDropTargets!=null){this.dropTargets=this.savedDropTargets
}},this)
}},handleFieldLock:function(J,D,B,C){var F=this;
var I=this.getName();
var G=this.getBaseNodeName();
if(C.get(G)){var A=C.get(G);
var E=A["jcr:mixinTypes"];
if(E&&(E.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){D=false;
J="cq-dialog-unlocked"
}if(A[CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED]){D=false;
J="cq-dialog-unlocked"
}}F.editLock=D;
F.editLockDisabled=B;
this.setToolbarEnabled(!(D&&!B));
if(D&&!B){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}var H="";
if(B){H=CQ.Dialog.INHERITANCE_BROKEN
}else{H=D?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}if(!this.isUploadPanelCreated){this.delayedCreateRevertInheritanceHint=true
}else{if(!this.isLockHintCreated){this.createRevertInheritanceHint();
this.isLockHintCreated=true
}}if(!this.fieldEditLockBtn){F.fieldEditLockBtn=new CQ.Ext.Button({disabled:B,tooltip:H,cls:"cq-dialog-editlock cq-smartimage-editlock",iconCls:J,handler:function(){this.switchPropertyInheritance()
},scope:this});
this.toolSelector.add(this.fieldEditLockBtn)
}else{this.fieldEditLockBtn.setDisabled(B);
this.fieldEditLockBtn.setIconClass(J);
this.fieldEditLockBtn.setTooltip(J=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE)
}this.updateView()
},switchPropertyInheritance:function(){var A=this.findParentByType("dialog");
A.switchPropertyInheritance(this,null,function(C,B){this.editLock=B;
this.fieldEditLockBtn.setIconClass(C);
this.fieldEditLockBtn.setTooltip(C=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
if(B){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}else{this.dropTargets[0].unlock();
this.processingPanel.body.unmask()
}this.setToolbarEnabled(!B);
this.updateView()
})
},getFieldLockParameters:function(A){delete A.cmd;
A[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=this.editLock;
A[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN]=true;
return A
},getFieldLockTarget:function(A){return A+="/"+this.getBaseNodeName()
},getPropertyName:function(A){return A.substr(A.lastIndexOf("/")+1)
},getBaseNodeName:function(){var A=this.getName();
return A.replace(/^([^\/]*)\/([^\/]*)(.*)/,"$2")
},markInvalid:function(A){if(!this.rendered||this.preventMark){return 
}A=A||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.imagePanel.addCanvasClass(this.invalidClass);
this.uploadPanel.body.dom.qtip=A;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,A)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return 
}this.uploadPanel.body.removeClass(this.invalidClass);
this.imagePanel.removeCanvasClass(this.invalidClass);
this.fireEvent("valid",this)
},postProcessRecord:function(B,F){this.dataRecord=B;
if(this.originalImage!=null){this.fireEvent("statechange","originalremoved",true)
}this.originalImage=null;
if(this.processedImage!=null){this.fireEvent("statechange","processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage!=null){this.fireEvent("statechange","originalremoved",false)
}this.originalRefImage=null;
if(this.processedRefImage!=null){this.fireEvent("statechange","processedremoved",false)
}this.processedRefImage=null;
var E=null;
this.fireEvent("beforeloadimage",this);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image({dataPath:this.referencedFileInfo.dataPath,url:this.referencedFileInfo.url,fallbackUrl:this.referencedFileInfo.fallbackUrl});
this.notifyImageLoad(this.originalRefImage);
E=this.createProcessedImageConfig(this.referencedFileInfo.dataPath);
if(E){this.processedRefImage=new CQ.form.SmartImage.Image(E);
this.notifyImageLoad(this.processedRefImage)
}this.originalRefImage.load();
if(E){this.processedRefImage.load()
}}if(this.fileInfo){this.originalImage=new CQ.form.SmartImage.Image({dataPath:this.fileInfo.dataPath,url:this.fileInfo.url});
this.notifyImageLoad(this.originalImage);
E=this.createProcessedImageConfig(F);
if(E){this.processedImage=new CQ.form.SmartImage.Image(this.createProcessedImageConfig(F));
this.notifyImageLoad(this.processedImage)
}this.originalImage.load();
if(E){this.processedImage.load()
}}var A=this.imageToolDefs.length;
for(var D=0;
D<A;
D++){var C=this.imageToolDefs[D];
C.processRecord(B)
}},notifyImageLoad:function(A){if(!this.toolSelector.disabled&&!this.hideMainToolbar){this.toolSelector.disable()
}this.imagesPending++;
A.addToolLoadHandler(function(){this.imagesPending--;
if(this.imagesPending==0){this.fireEvent("loadimage",this)
}if(A==this.processedImage){this.fireEvent("imagestate",this,"processedavailable",true)
}else{if(A==this.processedRefImage){this.fireEvent("imagestate",this,"processedavailable",false)
}else{if(A==this.originalImage){this.fireEvent("imagestate",this,"originalavailable",true)
}else{if(A==this.originalRefImage){this.fireEvent("imagestate",this,"originalavailable",false)
}}}}}.createDelegate(this),true)
},createProcessedImageConfig:function(D){var E="";
if(D){var B=D.lastIndexOf(".");
var A=D.lastIndexOf("/");
if((B>0)&&(B>(A+1))){E=D.substring(B,D.length)
}}var C=this.pathProvider.call(this,this.dataPath,this.requestSuffix,E,this.dataRecord,this);
if(C==null){return null
}return{url:C}
},syncFormElements:function(){CQ.html5.form.SmartImage.superclass.syncFormElements.call(this);
var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){var C=this.imageToolDefs[B];
C.transferToField()
}},usesProcessedImage:function(){var A=this.getSuitableImage(false);
return(A==this.processedImage)||(A==this.processedRefImage)
},invalidateProcessedImages:function(){if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}},createProcessingPanel:function(){if(!this.hideMainToolbar){var A,C;
this.imageTools=[];
var B=[];
A=this.imageToolDefs.length;
for(C=0;
C<A;
C++){var D=this.imageToolDefs[C];
var E;
if(!D.isCommandTool){E=new CQ.Ext.Toolbar.Button({text:D.toolName,itemId:D.toolId,toolRef:D,iconCls:D.iconCls,actionHandler:this.toolClicked.createDelegate(this),enableToggle:true,toggleGroup:"imageTools",allowDepress:true,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}else{E=new CQ.Ext.Toolbar.Button({text:D.toolName,itemId:D.toolId,toolRef:D,iconCls:D.iconCls,actionHandler:this.commandToolClicked.createDelegate(this),enableToggle:false,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}D.buttonComponent=E;
this.imageTools.push(E);
D.createTransferField(this);
B.push(E)
}if(!this.disableFlush){B.push({xtype:"tbseparator"});
B.push({xtype:"tbbutton",text:CQ.I18n.getMessage("Clear"),iconCls:"cq-image-icon-clear",listeners:{click:{fn:this.flushImage,scope:this}}})
}if(!this.disableInfo){B.push({xtype:"tbseparator"});
B.push({itemId:"infoTool",xtype:"tbbutton",iconCls:"cq-image-icon-info",listeners:{click:{fn:this.showImageInfo,scope:this}}})
}B.push({xtype:"tbfill"});
if(!this.disableZoom){this.zoomSlider=new CQ.Ext.Slider({width:CQ.Ext.isIE7?150:200,minValue:0,maxValue:90,vertical:false,listeners:{change:{fn:function(F,G){this.imagePanel.setZoom(G/10)
},scope:this}}});
B.push(this.zoomSlider)
}}this.toolSelector=new CQ.Ext.Toolbar(B);
this.toolSelector.disable();
return new CQ.Ext.Panel({itemId:"processing",layout:"fit",border:false,bbar:(!this.hideMainToolbar?this.toolSelector:null),afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}})
},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var A=this.originalImage||this.originalRefImage||this.processedImage||this.processedRefImage;
this.updateViewBasics(A);
if(A){this.workingArea.getLayout().setActiveItem("imageview");
this.resetTools();
this.resetZoomSlider()
}this.updateImageInfoState()
}this.doLayout();
if(this.processedRefImage){this.imagePanel.updateImage(this.processedRefImage)
}else{if(this.originalRefImage){this.imagePanel.updateImage(this.originalRefImage)
}else{if(this.processedImage){this.imagePanel.updateImage(this.processedImage)
}else{if(this.originalImage){this.imagePanel.updateImage(this.originalImage)
}}}}},resetTools:function(){if(!this.hideMainToolbar){var A=this.imageTools.length;
for(var C=0;
C<A;
C++){var B=this.imageTools[C];
if(B.enableToggle){B.toggle(false)
}}}this.imagePanel.hideAllShapeSets(false)
},resetZoomSlider:function(){if(this.zoomSlider){this.zoomSlider.suspendEvents();
this.zoomSlider.setValue(0);
this.zoomSlider.resumeEvents()
}},getImagePanel:function(){return this.imagePanel
},adjustUI:function(){if(!this.hideMainToolbar){var A;
if(!this.disableInfo){A=this.toolSelector.items.get("infoTool");
var B=A.disabled
}if(!this.editLock||this.editLockDisabled){this.toolSelector.enable();
this.enableToolbar();
if(!this.disableInfo){A.setDisabled(B)
}}if(this.fieldEditLockBtn){this.fieldEditLockBtn.setDisabled(this.editLockDisabled)
}}},setToolbarEnabled:function(A){(A?this.enableToolbar():this.disableToolbar())
},disableToolbar:function(){this.toolSelector.items.each(function(A){if(A!=this.fieldEditLockBtn){A.setDisabled(true)
}},this)
},enableToolbar:function(){this.toolSelector.items.each(function(B){if(B!=this.fieldEditLockBtn){var A=(!this.editLock||this.editLockDisabled);
if(A&&B.toolRef){A=B.toolRef.isEnabled()
}B.setDisabled(!A)
}},this)
},onUploaded:function(){this.originalImage=new CQ.form.SmartImage.Image(this.fileInfo);
this.originalImage.loadHandler=function(){var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].onImageUploaded(this.originalImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalImage);
this.originalImage.load();
if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}return true
},toolClicked:function(E){var C;
var H=E.buttonComponent;
if(H.pressed){var G=false;
if(this.toolComponents==null){this.toolComponents={}
}if(!this.toolComponents[E.toolId]){this.toolComponents[E.toolId]={isVisible:false,toolRef:E};
G=true
}var D=this.toolComponents[E.toolId];
C=this.hideTools(E.toolId);
if(E.userInterface&&(!E.userInterface.rendered)){E.userInterface.render(CQ.Util.getRoot())
}if(C){C.onDeactivation()
}if(E.userInterface){E.userInterface.show();
D.isVisible=true;
if(!(E.userInterface.saveX&&E.userInterface.saveY)){var I=E.userInterface.getSize().height;
var F=this.getPosition();
var B=F[0];
var A=F[1]-(I+4);
if(B<0){B=0
}if(A<0){A=0
}E.userInterface.setPosition(B,A)
}else{E.userInterface.setPosition(E.userInterface.saveX,E.userInterface.saveY)
}}E.onActivation()
}else{C=this.hideTools();
if(C){C.onDeactivation()
}this.imagePanel.drawImage()
}},commandToolClicked:function(A){A.onCommand()
},hideTools:function(C){if(!this.hideMainToolbar){var D;
for(var B in this.toolComponents){var A=this.toolComponents[B];
if(B!=C){if(A.isVisible){A.toolRef.userInterface.hide();
A.isVisible=false;
D=A.toolRef
}}}}return D
},disableTools:function(){if(!this.hideMainToolbar){var D=this.hideTools();
if(D){D.onDeactivation()
}var A=this.imageTools.length;
for(var B=0;
B<A;
B++){var C=this.imageTools[B];
if(C.pressed){C.suspendEvents();
C.toggle(false);
C.resumeEvents()
}}}},updateImageInfoState:function(){if(!this.disableInfo&&!this.hideMainToolbar){var A=this.toolSelector.items.get("infoTool");
var B=(this.referencedFileInfo!=null);
(B?A.enable():A.disable())
}},showImageInfo:function(){if(this.infoTip!=null){var B=this.infoTip.hidden==false;
this.infoTip.hide();
if(B){return 
}}var C=function(){if(this.infoTip!=null){this.infoTip.hide();
this.infoTip=null
}};
var A=this.toolSelector.items.get("infoTool");
this.infoTip=new CQ.Ext.Tip({title:CQ.I18n.getMessage("Image info"),html:'<span class="cq-smartimage-refinfo">'+this.getRefText(this.referencedFileInfo.dataPath)+"</span>",maxWidth:500,autoHide:false,closable:true,listeners:{hide:function(){CQ.Ext.EventManager.un(document,"click",C,this)
},scope:this}});
CQ.Ext.EventManager.on.defer(10,this,[document,"click",C,this]);
this.infoTip.showBy(A.el,"tl-tr")
},flushImage:function(A){this.flush();
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage){this.originalRefImage=null;
this.fireEvent("imagestate",this,"originalremoved",false)
}else{if(this.originalImage){this.originalImage=null;
this.fireEvent("imagestate",this,"originalremoved",true)
}}if(A!==true){this.syncFormElements();
this.notifyToolsOnFlush();
this.hideTools();
this.updateView()
}},reset:function(){this.flushImage();
CQ.html5.form.SmartImage.superclass.reset.call(this)
},notifyToolsOnFlush:function(){var A=this.imageToolDefs.length;
for(var B=0;
B<A;
B++){this.imageToolDefs[B].onImageFlushed()
}},getSuitableImage:function(A){var B;
if(this.processedRefImage&&!A){B=this.processedRefImage
}else{if(this.originalRefImage){B=this.originalRefImage
}else{if(this.processedImage&&!A){B=this.processedImage
}else{if(this.originalImage){B=this.originalImage
}}}}return B
},handleDrop:function(A){if(this.handleDropBasics(A)){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var B=this.imageToolDefs.length;
for(var C=0;
C<B;
C++){this.imageToolDefs[C].onImageUploaded(this.originalRefImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalRefImage);
this.originalRefImage.load();
return true
}return false
}});
CQ.html5.form.SmartImage.defaultPathProvider=function(C,B,D,A){if(!B){return null
}return CQ.HTTP.externalize(C+B)
};
CQ.Ext.reg("html5smartimage",CQ.html5.form.SmartImage);
CQ.form.ComponentSelector=CQ.Ext.extend(CQ.form.CompositeField,{hiddenField:null,fieldSets:[],processRecord:function(C,M){if(this.fireEvent("beforeloadcontent",this,C,M)!==false){var L=C.get(this.getName());
if(L!=undefined){if(typeof (L)=="string"){L=[L]
}var K={};
for(var G in L){K[L[G]]=true
}for(var B=0;
B<this.fieldSets.length;
B++){var F=false;
var J=this.fieldSets[B].titleCheckbox.inputValue;
if(typeof (J)!="undefined"&&typeof (K[J])!="undefined"){this.fieldSets[B].titleCheckbox.setValue(true);
F=true
}var D=this.fieldSets[B].items&&this.fieldSets[B].items.items?this.fieldSets[B].items.items:null;
var I=false;
if(D){for(var E in D){var A=D[E].inputValue;
if(A!=undefined){if(F){D[E].setValue(true)
}else{if(K[A]!=undefined){D[E].setValue(true);
I=true
}}}}}if(I){this.fieldSets[B].expand()
}}}this.fireEvent("loadcontent",this,C,M)
}},constructor:function(B){CQ.Util.applyDefaults(B,{border:false,name:"./components",cls:"cq-compsel"});
CQ.form.ComponentSelector.superclass.constructor.call(this,B);
this.hiddenField=new CQ.Ext.form.Hidden({name:B.name+CQ.Sling.DELETE_SUFFIX,value:"true"});
this.add(this.hiddenField);
var A="NO GROUP DEFINED!";
var J="General";
var M=CQ.WCM.getComponentList(this.path);
var C={};
var O=[];
for(var F in M.allComponents){var L=M.allComponents[F];
if(typeof (L.group)==="undefined"||L.group==""){L.group=A
}if(L.group.indexOf(".")==0){continue
}if(typeof (C[L.group])==="undefined"){C[L.group]=[];
if(L.group!=A&&L.group!=J){O.push([L.group,CQ.I18n.getVarMessage(L.group)])
}}if(!L.title||L.title==F.substring(F.lastIndexOf("/")+1)){continue
}if(!L.icon){L.icon="/libs/cq/ui/widgets/themes/default/icons/16x16/components.png"
}var I="<div style='display:inline;padding:2px 0 2px 20px;background:transparent url("+CQ.HTTP.externalize(L.icon)+") 0 2px no-repeat;'";
if(L.description){I+=" ext:qtip='"+CQ.I18n.getVarMessage(L.description)+"'"
}I+=">";
C[L.group].push({title:CQ.I18n.getVarMessage(L.title),labelPre:I,labelPost:"</div>",inputValue:L.path,xtype:"checkbox",hideLabel:true,name:"./components",stateful:false})
}O.sort(function(P,G){if(P[1]>G[1]){return 1
}else{if(P[1]<G[1]){return -1
}else{return 0
}}});
var N=[[J,CQ.I18n.getVarMessage(J)]].concat(O).concat([[A,CQ.I18n.getVarMessage(A)]]);
for(var D=0;
D<N.length;
D++){var K=N[D][0];
var H=N[D][1];
if(C[K]&&C[K].length>0){var E=new CQ.Ext.form.FieldSet({title:H,groupName:K,collapsible:true,collapsed:true,items:C[K],autoHeight:"true",layout:"form",listeners:{render:function(){if(this.items){this.items.sort("ASC",function(W,V){if(W.title>V.title){return 1
}else{if(W.title<V.title){return -1
}else{return 0
}}});
var R=this.items.items.length;
for(var Q=0;
Q<R;
Q++){var U=this.items.items[Q].title;
if(Q!=R-1&&U==this.items.items[Q+1].title){while(true){var P=U;
try{var T=this.items.items[Q].inputValue.split("/");
T=T[2]=="cq"?T[3]:T[2];
T=T.length<=3?T.toUpperCase():T.charAt(0).toUpperCase()+T.slice(1);
P=U+' <span class="app">('+T+")</span>"
}catch(S){}this.items.items[Q].boxLabel=this.items.items[Q].labelPre+P+this.items.items[Q].labelPost;
if(U!=this.items.items[Q+1].title){break
}Q++;
if(Q==R){break
}}}else{this.items.items[Q].boxLabel=this.items.items[Q].labelPre+U+this.items.items[Q].labelPost
}}}var G=this;
this.titleCheckbox=new CQ.Ext.form.Checkbox({renderTo:this.header,name:"./components",inputValue:"group:"+this.groupName,boxLabel:this.title,listeners:{check:function(Y,X){for(var V=0;
V<G.items.length;
V++){var W=G.items.items[V];
if(X){W.disable()
}else{W.enable()
}}}}});
this.setTitle("")
}}});
this.add(E);
this.fieldSets.push(E)
}}}});
CQ.Ext.reg("componentselector",CQ.form.ComponentSelector);
CQ.wcm.Viewport=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(A){this.debug=A.debug;
var C={id:"cq-header",xtype:"container",region:"north",autoEl:"div",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar",items:[new CQ.Switcher({}),new CQ.UserInfo({})]}]};
var B={id:A.id+"-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[C].concat(A.items)};
A.layout="border";
A.renderTo="CQ";
A.items=[B];
CQ.wcm.Viewport.superclass.constructor.call(this,A)
},initComponent:function(){CQ.wcm.Viewport.superclass.initComponent.call(this)
}});
CQ.wcm.AdminBase={checkActions:function(){var A=this;
window.setTimeout(function(){for(var B=0;
B<A.checkedActions.length;
B++){var C=A.checkedActions[B];
if((C instanceof CQ.PrivilegedAction)&&C.target){C.setPath(C.target.call(A),C.forceCheck)
}}},1)
},formatActions:function(H,C){var G=[];
var B=false;
for(var A in H){if(typeof (H[A])!="object"){continue
}if(H[A].xtype=="separator"){if(this.isToolbarAction(H[A])){G.push(H[A].value)
}if(this.isContextMenuAction(H[A])){C.push(H[A].value)
}}else{var D=this.formatActionConfig(H[A],C);
if(this.isToolbarAction(D)){var E=false;
if(D.isDefaultAction&&!G.hasDefaultAction){G.hasDefaultAction=E=true
}G.push(this.createAction(D,E))
}if(this.isContextMenuAction(D)){var F=false;
if(D.isDefaultAction&&!C.hasDefaultAction){C.hasDefaultAction=F=true
}C.push(this.createAction(D,F,true))
}}}return G
},formatActionConfig:function(config,gridContextActions){if(!config.scope){config.scope=this
}if(typeof (config.handler)=="string"){config.handler=eval(config.handler)
}if(config.menu){var menuItems=this.formatActions(config.menu,gridContextActions);
config.menu=new CQ.Ext.menu.Menu({items:menuItems})
}return config
},createAction:function(config,isDefault,inContextMenu){var admin=this;
var action=new CQ.PrivilegedAction(config);
if(config.split&&config.menu&&!this.isContextMenuAction(config)){action.xtype="tbsplit";
var defaultAction=config.menu.items.find(function(item){if(item.isDefaultAction===true){item.addClass("x-menu-item-default");
return true
}else{return false
}});
if(defaultAction){var showMenu=function(){if(!this.menu){return 
}if(!this.menu.isVisible()){this.showMenu()
}};
action.setIconClass(defaultAction.initialConfig.iconCls);
action.setHandler(function(){if(!defaultAction.disabled){defaultAction.initialConfig.handler.call(admin)
}else{if(!this.menu){return 
}if(!this.menu.isVisible()){this.showMenu()
}}})
}else{action.setHandler(showMenu)
}}if(isDefault){action.isDefaultAction=true
}if(config.target){action.target=eval("("+config.target+")")
}if(config.forceCheck){action.forceCheck=config.forceCheck
}if(!config.menu){this.checkedActions.push(action)
}if(!action.xtype&&config.xtype){action.xtype=config.xtype
}return action
},isToolbarAction:function(A){return !A.context||A.context.indexOf(CQ.wcm.SiteAdmin.CONTEXT_TOOLBAR)>=0
},isContextMenuAction:function(A){return A.context&&A.context.indexOf(CQ.wcm.SiteAdmin.CONTEXT_CONTEXTMENU)>=0
}};
CQ.wcm.SiteAdmin=CQ.Ext.extend(CQ.Ext.Viewport,{copyClipboard:null,constructor:function(config){var admin=this;
this.title=config.title;
config=CQ.Util.applyDefaults(config,{id:"cq-siteadmin",search:{width:145,listWidth:260,listAlign:"tr-br",minChars:3,queryDelay:500},grid:{pages:{pathRegex:"(/.*)?",storeProxyPrefix:"",storeProxySuffix:".pages.json",storePredicate:"siteadmin",storeReaderTotalProperty:"results",storeReaderRoot:"pages",storeReaderId:"path",storeReaderFields:["index","title",CQ.shared.XSS.getXSSPropertyName("title"),"label","type","dialogPath","lastModifiedBy",CQ.shared.XSS.getXSSPropertyName("lastModifiedBy"),"lastModified","templateTitle","templateShortTitle","templatePath","replication",{name:"inWorkflow",type:"bool"},"workflows","scene7Status","lockedBy","monthlyHits","timeUntilValid","onTime","offTime","scheduledTasks",CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP,CQ.wcm.msm.MSM.PARAM_IS_IN_BLUEPRINT,CQ.wcm.msm.MSM.PARAM_IS_SOURCE],columns:[CQ.wcm.SiteAdmin.COLUMNS.numberer,CQ.wcm.SiteAdmin.COLUMNS.thumbnail,CQ.wcm.SiteAdmin.COLUMNS.title,CQ.wcm.SiteAdmin.COLUMNS.name,CQ.wcm.SiteAdmin.COLUMNS.published,CQ.wcm.SiteAdmin.COLUMNS.modified,CQ.wcm.SiteAdmin.COLUMNS.scene7Status,CQ.wcm.SiteAdmin.COLUMNS.status,CQ.wcm.SiteAdmin.COLUMNS.impressions,CQ.wcm.SiteAdmin.COLUMNS.template,CQ.wcm.SiteAdmin.COLUMNS.workflow,CQ.wcm.SiteAdmin.COLUMNS.locked,CQ.wcm.SiteAdmin.COLUMNS.liveCopyStatus],defaultSortable:true}}});
this.lastClickedRow=-1;
var gridCfgs={};
for(var name in config.grid){if(!config.grid[name].pathRegex){continue
}gridCfgs[name]=config.grid[name];
if(name!="pages"){gridCfgs[name]=CQ.Ext.applyIf(gridCfgs[name],config.grid.pages)
}if(gridCfgs[name].pageSize==undefined){gridCfgs[name].pageSize=CQ.themes.wcm.SiteAdmin.GRID_PAGE_SIZE
}if(gridCfgs[name].pageText==undefined){gridCfgs[name].pageText=CQ.themes.wcm.SiteAdmin.GRID_PAGE_TEXT
}gridCfgs[name].storeConfig=CQ.Util.applyDefaults(config.store,{autoLoad:false,remoteSort:true,listeners:gridCfgs[name].storeListeners,proxy:new CQ.Ext.data.HttpProxy({api:{read:{url:gridCfgs[name].storeProxyPrefix,method:"GET"}}}),reader:new CQ.Ext.data.JsonReader({totalProperty:gridCfgs[name].storeReaderTotalProperty,root:gridCfgs[name].storeReaderRoot,id:gridCfgs[name].storeReaderId,fields:gridCfgs[name].storeReaderFields}),baseParams:{start:0,limit:gridCfgs[name].pageSize,predicate:gridCfgs[name].storePredicate}});
gridCfgs[name].colModelColumns=new Array();
for(var i=0;
i<gridCfgs[name].columns.length;
i++){var c=gridCfgs[name].columns[i];
var pref=null;
if(typeof c=="string"){pref=c
}else{if(typeof c=="object"){if(c.usePredefined){pref=c.usePredefined
}if(c.editor){if(typeof c.editor=="string"){try{eval("c.editor = "+c.editor+";")
}catch(e){}}try{c.editor=c.editor.cloneConfig()
}catch(e){}}CQ.shared.XSS.updatePropertyName(c,"dataIndex")
}}if(pref&&CQ.wcm.SiteAdmin.COLUMNS[pref]){var prefCfg=CQ.Util.copyObject(CQ.wcm.SiteAdmin.COLUMNS[pref]);
for(var prop in c){if(prop=="usePredefined"){continue
}prefCfg[prop]=c[prop]
}gridCfgs[name].colModelColumns.push(prefCfg)
}else{gridCfgs[name].colModelColumns.push(c)
}}}this.debug=config.debug;
var id=config.id;
var body=CQ.Ext.getBody();
body.setStyle("margin","0");
if(CQ.Ext.isIE){body.dom.scroll="no"
}else{body.setStyle("overflow","hidden")
}this.actions=[];
this.checkedActions=[];
var gridContextActions=[];
this.actions.push({id:id+"-grid-refresh",iconCls:"cq-siteadmin-refresh",handler:this.reloadPages,scope:this,tooltip:{title:id=="cq-damadmin"?CQ.I18n.getMessage("Refresh Asset List"):CQ.I18n.getMessage("Refresh Page List"),text:id=="cq-damadmin"?CQ.I18n.getMessage("Refreshs the list of assets"):CQ.I18n.getMessage("Refreshs the list of pages"),autoHide:true}});
this.actions.push("-");
this.actions=this.actions.concat(this.formatActions(config.actions,gridContextActions));
this.actions.push("->");
config.search=CQ.Util.applyDefaults(config.search,{id:id+"-search",triggerClass:"x-form-search-trigger "+id+"-search-trigger",listeners:{select:function(combo,record,index){var parent=record.id.substring(0,record.id.lastIndexOf("/"));
admin.loadPath(parent,record.id)
}}});
if(typeof config.search.listeners.select!="function"){config.search.listeners.select=eval(config.search.listeners.select)
}var search=new CQ.form.SearchField(config.search);
this.actions.push(search);
var helpConfig=CQ.wcm.HelpBrowser.createHelpButton();
helpConfig.id=id+"-help";
this.actions.push(helpConfig);
var autoExpandMax=config.treeAutoExpandMax||CQ.TREE_AUTOEXPAND_MAX;
var treeLdrCfg=CQ.Util.applyDefaults(config.treeLoader,{requestMethod:"GET",dataUrl:"/bin/wcm/siteadmin/tree.json",baseParams:{ncc:autoExpandMax,_charset_:"utf-8"},baseAttrs:{autoExpandMax:autoExpandMax,singleClickExpand:true},listeners:{beforeload:function(loader,node){this.baseParams.path=node.getPath()
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(attr.type=="cq:Page"){attr.iconCls="page";
if(attr.isLiveCopy){attr.iconCls="livecopypage"
}}else{if(/.*[fF]older/.test(attr.type)){attr.iconCls="folder"
}else{if(attr.cls){attr.iconCls=attr.cls
}}}if(this.applyLoader!==false){attr.loader=this
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.type&&attr.type=="cq:Page"){if(attr.leaf){delete attr.leaf;
attr.children=[];
attr.expanded=true
}}var node;
if(attr.leaf){node=new CQ.Ext.tree.TreeNode(attr)
}else{node=new CQ.Ext.tree.AsyncTreeNode(attr);
node.on("move",function(tree,node,oldParent,newParent,index){if(newParent.attributes.children&&(newParent.attributes.children.length==0)){delete newParent.attributes.children
}})
}node.on("dblclick",function(node,evt){CQ.wcm.SiteAdmin.openPage.call(admin,node.getPath(),node.attributes.type,evt.shiftKey);
evt.stopEvent()
});
return node
}});
this.treeRootCfg=CQ.Util.applyDefaults(config.treeRoot,{name:"content",text:CQ.I18n.getMessage("Websites"),draggable:false,expanded:true,iconCls:"file"});
var anchor=CQ.HTTP.getAnchor(document.location.href);
if(anchor){var state=CQ.Ext.state.Manager.get(id+"-tree");
if(state){CQ.Ext.state.Manager.set(id+"-tree",state.width?{width:state.width}:{})
}}this.pagingToolbar=new CQ.Ext.PagingToolbar({pageSize:CQ.themes.wcm.SiteAdmin.GRID_PAGE_SIZE,store:null,displayInfo:true,displayMsg:"",emptyMsg:"",beforePageText:CQ.I18n.getMessage("Page"),afterPageText:CQ.I18n.getMessage("of {0}"),firstText:CQ.I18n.getMessage("First Page"),prevText:CQ.I18n.getMessage("Previous Page"),nextText:CQ.I18n.getMessage("Next Page"),lastText:CQ.I18n.getMessage("Last Page"),refreshText:CQ.I18n.getMessage("Refresh")});
var consolePanel={id:id+"-wrapper",cls:"cq-siteadmin-wrapper",xtype:"panel",layout:"border",border:false,items:[{xtype:"treepanel",id:id+"-tree",cls:"cq-siteadmin-tree",region:"west",margins:"5 0 5 5",width:CQ.themes.wcm.SiteAdmin.TREE_WIDTH,autoScroll:true,containerScroll:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,animate:true,split:true,stateful:true,enableDD:true,ddScroll:false,ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_TREE,loader:new CQ.Ext.tree.TreeLoader(treeLdrCfg),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootCfg),tbar:[{id:id+"-tree-refresh",iconCls:"cq-siteadmin-refresh",handler:function(){admin.mask();
CQ.Ext.getCmp(id+"-tree").getRootNode().reload();
admin.loadPath()
},tooltip:{title:CQ.I18n.getMessage("Refresh Page Tree"),text:CQ.I18n.getMessage("Refreshs the page tree"),autoHide:true}}],listeners:{beforemovenode:function(tree,node,oldParent,newParent,index){if(admin.liveCopyNode){return admin.performLiveCopy(tree,node,oldParent,newParent,index)
}else{if(admin.copyNode){return admin.performCopy(tree,node,oldParent,newParent,index)
}else{if(admin.performMoveOrReorder(tree,node,oldParent,newParent,index)){admin.performAfterMoveOrReorder(tree,node,oldParent,newParent,index)
}return false
}}},movenode:function(tree,node,oldParent,newParent,index){if(admin.copyNode||admin.liveCopyNode){admin.performAfterCopy(tree,node,oldParent,newParent,index)
}},beforenodedrop:function(dropEvent){var isCtrl=dropEvent.rawEvent.browserEvent.ctrlKey;
var isShift=dropEvent.rawEvent.browserEvent.shiftKey;
var isPage=false;
try{isPage=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree").getSelectionModel().getSelectedNode().attributes.type=="cq:Page"
}catch(e){}admin.copyNode=isCtrl&&(!isShift||!isPage);
admin.liveCopyNode=isCtrl&&isShift&&isPage
}}},{xtype:"editorgrid",id:id+"-grid",cls:"cq-siteadmin-grid",region:"center",stateful:true,enableDragDrop:true,ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_GRID,ddText:CQ.I18n.getMessage("Reordering..."),margins:"5 5 5 0",stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([]),sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:false}),clicksToEdit:1,viewConfig:new CQ.Ext.grid.GridView({forceFit:true}),store:new CQ.Ext.data.Store({}),tbar:this.actions,bbar:this.pagingToolbar,observe:function(){if(this.editing){return 
}if(this.inProgress&&this.inProgress.length){this.getStore().proxy.load(this.getStore().baseParams,this.getStore().reader,function(obj,grid,success){if(success){var store=grid.getStore();
for(var i=0;
i<obj.records.length;
i++){var newRec=obj.records[i];
if(newRec.id.indexOf("/var/dam")==0){continue
}var queueIndex=grid.inProgress.indexOf(newRec.id);
if(queueIndex<0){continue
}if(newRec.data.inProgress>0){continue
}var rec=store.getById(newRec.id);
if(!rec){var path=newRec.id.replace("/content/dam","/var/dam");
rec=store.getById(path)
}if(rec){var scroll=grid.getView().getScrollState();
rec.beginEdit();
rec.id=newRec.id;
rec.modified=newRec.data;
CQ.Ext.apply(rec.data,rec.modified);
rec.endEdit();
rec.commit();
grid.getView().restoreScroll(scroll);
if(newRec.data.inProgress<=0&&newRec.data.lastModified!=0&&rec.id.indexOf("/var/dam")!=0){grid.inProgress.splice(queueIndex,1)
}}else{}}}},this,this)
}},listeners:{rowcontextmenu:function(grid,index,e){if(e.altKey){return 
}var xy=e.getXY();
e.stopEvent();
var sm=grid.getSelectionModel();
if(!sm.hasSelection()){sm.selectRow(index)
}else{if(!sm.isSelected(index)){sm.selectRow(index)
}}if(!grid.contextMenu&&(gridContextActions.length>0)){grid.contextMenu=new CQ.Ext.menu.Menu({items:gridContextActions,listeners:{beforeshow:function(){var admin=CQ.Ext.getCmp(id);
admin.checkActions.call(admin);
if(!this.hasDefaultAction){this.items.find(function(item){if(item.isDefaultAction===true){item.addClass("x-menu-item-default");
this.hasDefaultAction=true;
return true
}else{return false
}})
}}}})
}grid.contextMenu.showAt(xy)
},rowdblclick:function(grid,rowIndex,evt){CQ.wcm.SiteAdmin.openPages.call(admin,evt.shiftKey)
},cellclick:function(grid,rowIndex,columnIndex,evt){var colModel=grid.getColumnModel();
var fieldName=colModel.getDataIndex(columnIndex);
if(CQ.wcm.SiteAdmin.COLUMNS.impressions.dataIndex===fieldName){var record=grid.getStore().getAt(rowIndex);
var path=record.id;
var dlg=CQ.WCM.getDialog({"jcr:primaryType":"cq:Panel",xtype:"statistics",cls:"cq-propsdialog-impressions",header:false,bodyStyle:{padding:"15px 15px"},width:350,height:300,screen:{autoEl:{src:CQ.HTTP.getContextPath()+"/libs/cq/ui/resources/0.gif"}}},"impressions");
dlg.loadContent(path+"/jcr:content");
dlg.setTitle(CQ.I18n.getMessage("Page impressions of ")+path);
dlg.show()
}},beforeedit:function(params){if(params.row!=admin.lastClickedRow){window.setTimeout(function(){admin.lastClickedRow=params.row
},600);
return false
}if(CQ.wcm.SiteAdmin.GRID_LISTENERS.beforeedit[params.field]!=undefined){return CQ.wcm.SiteAdmin.GRID_LISTENERS.beforeedit[params.field].call(this,params)
}return true
},afteredit:function(params){if(CQ.wcm.SiteAdmin.GRID_LISTENERS.afteredit[params.field]!=undefined){CQ.wcm.SiteAdmin.GRID_LISTENERS.afteredit[params.field].call(this,params)
}},validateedit:function(params){if(CQ.wcm.SiteAdmin.GRID_LISTENERS.validateedit[params.field]!=undefined){CQ.wcm.SiteAdmin.GRID_LISTENERS.validateedit[params.field].call(this,params)
}},beforestaterestore:function(grid,s){return grid.id!=grid.stateId
},staterestore:function(grid,s){grid.getView().refresh(true)
},render:function(grid){admin.hidePagingToolbar();
grid.getSelectionModel().on("selectionchange",function(sm){var sel=sm.getSelections();
for(var i=0;
i<sel.length;
i++){admin.typeCache[sel[i].id]=sel[i].get("type")
}admin.checkActions()
});
var grd=document.getElementById(id+"-grid");
var addEvent=grd.addEventListener;
if(!addEvent){addEvent=grd.attachEvent
}if(grd.addEventListener){try{grd.addEventListener("dragover",function(e){grid.isDragOver=true;
if(!grid.hasDragMask){if(CQ.User.getCurrentUser().hasPermissionOn("create",admin.getCurrentPath())){grid.el.mask(CQ.I18n.getMessage("Drop file(s) to create assets"),"x-mask-loading cq-mask-drop-ok");
grid.dropDenied=false
}else{grid.el.mask(CQ.I18n.getMessage("No permissions to create assets"),"x-mask-loading cq-mask-drop-no");
grid.dropDenied=true
}grid.hasDragMask=true
}if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}return false
},false);
grd.addEventListener("dragleave",function(e){if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}grid.isDragOver=false;
window.setTimeout(function(){if(!grid.isDragOver){grid.el.unmask();
grid.hasDragMask=false
}},1);
return false
},false);
grd.addEventListener("drop",function(e){if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}grid.el.unmask();
grid.hasDragMask=false;
if(grid.dropDenied){return false
}var dt=e.dataTransfer;
if(dt){var files=dt.files;
try{admin.html5UploadFiles(files)
}catch(f){}}return false
},false)
}catch(e){if(console){console.log(e)
}}}grid.getView().mainBody.setStyle("padding-bottom","22px");
try{var ddrow=new CQ.Ext.dd.DropZone(grid.getView().mainBody,{ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_GRID,copy:false,notifyDrop:function(dd,e,data){var sm=grid.getSelectionModel();
var rows=sm.getSelections();
var cindex=dd.getDragData(e).rowIndex;
var ds=grid.store;
if(!this.isDropAllowed(e)){return false
}var toReorder=[];
for(i=0;
i<rows.length;
i++){toReorder.push(rows[i].id)
}var message;
var targetId;
if(cindex!=undefined){var targetRow=ds.getAt(cindex);
var name=targetRow.id.substring(targetRow.id.lastIndexOf("/")+1);
try{var cm=grid.getColumnModel();
if(!cm.isHidden(cm.getIndexById("title"))){if(targetRow.data.type=="cq:Page"){name=targetRow.data.title?targetRow.data.title:name
}}}catch(e){}message=CQ.I18n.getMessage("Are you sure you want to place the selected item(s) before {0}?",'"'+CQ.shared.XSS.getXSSValue(name)+'"');
targetId=targetRow.id
}else{message=CQ.I18n.getMessage("Are you sure you want to place the selected item(s) at the bottom?");
targetId=""
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Reorder items"),message,function(btn){if(btn=="yes"){admin.mask();
for(var i=0;
i<toReorder.length;
i++){admin.performReorder(toReorder[i],targetId)
}grid.getStore().reload({callback:function(){admin.unmask()
}});
sm.selectRecords(rows)
}else{sm.selectRecords(rows)
}});
return true
},notifyOver:function(dd,e,data){return this.isDropAllowed(e)?this.dropAllowed:this.dropNotAllowed
},isDropAllowed:function(e){var t=CQ.Ext.lib.Event.getTarget(e);
var rowIndex=grid.getView().findRowIndex(t);
return grid.selectedIndices.indexOf(rowIndex)==-1
}})
}catch(e){}if(grid.getView().dragZone){grid.getView().dragZone.onBeforeDrag=function(e){var sortState=grid.getStore().getSortState();
if(!sortState||(sortState.field=="index"&&sortState.direction=="ASC")){var sels=grid.getSelectionModel().getSelections();
grid.selectedIndices=[];
for(var i=0;
i<sels.length;
i++){grid.selectedIndices.push(grid.getStore().indexOf(sels[i]))
}return true
}else{return false
}}
}CQ.Util.observeComponent(grid,10000)
}}}]};
var centerPanel;
if(config.tabTitle){consolePanel.title=config.tabTitle?config.tabTitle:CQ.I18n.getMessage("Console");
centerPanel={activeTab:0,region:"center",id:id+"-tabpanel",xtype:"tabpanel",cls:"cq-siteadmin-tabpanel",border:false,enableTabScroll:true,items:[consolePanel],listeners:{tabchange:function(panel,tab){if(tab.path){admin.tabPath=tab.path;
admin.setDocumentTitle(tab.path.substring(tab.path.lastIndexOf("/")+1));
CQ.Ext.History.add(tab.path,true)
}else{admin.tabPath="";
var title=admin.treePath?admin.treePath.substring(admin.treePath.lastIndexOf("/")+1):"";
admin.setDocumentTitle(title);
if(admin.treePath){CQ.Ext.History.add(admin.treePath,true)
}}}}}
}else{consolePanel.region="center";
centerPanel=consolePanel
}CQ.wcm.SiteAdmin.superclass.constructor.call(this,{id:id,layout:"border",renderTo:CQ.Util.ROOT_ID,gridConfig:gridCfgs,items:[{id:"cq-header",xtype:"container",cls:id+"-header",autoEl:"div",region:"north",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar",items:[new CQ.Switcher({}),new CQ.UserInfo({}),new CQ.HomeLink({})]}]},centerPanel]});
var tree=CQ.Ext.getCmp(id+"-tree");
tree.dropZone.onNodeOver=function(n,dd,e,data){var pt=this.getDropPoint(e,n,dd);
var node=n.node;
if(!this.expandProcId&&pt=="append"&&node.hasChildNodes()&&!n.node.isExpanded()){this.queueExpand(node)
}else{if(pt!="append"){this.cancelExpand()
}}var returnCls=this.dropNotAllowed;
if(this.isValidDropPoint(n,pt,dd,e,data)){if(pt){var el=n.ddel;
var cls;
if(pt=="above"){if(n.node.isFirst()){returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-above"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-between"
}cls="x-tree-drag-insert-above"
}else{if(pt=="below"){if(n.node.isLast()){returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-below"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-between"
}cls="x-tree-drag-insert-below"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-move";
cls="x-tree-drag-append"
}}if(this.lastInsertClass!=cls){CQ.Ext.fly(el).replaceClass(this.lastInsertClass,cls);
this.lastInsertClass=cls
}}}return returnCls
};
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var historyFrame=document.createElement("iframe");
historyFrame.id=CQ.Ext.History.iframeId;
historyFrame.src=CQ.Ext.SSL_SECURE_URL;
historyFrame.className="x-hidden";
historyFrame.frameBorder="0";
historyFrame.border="0";
new CQ.Ext.Element(historyFrame).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
CQ.Ext.History.on("change",function(token){var current=admin.getCurrentPath();
if(admin.id=="cq-damadmin"){var tree=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree");
var isTreeNode=false;
tree.selectPath(token,"name",function(success){if(success){isTreeNode=true
}});
var tabPanel=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(isTreeNode){tabPanel.setActiveTab(admin.id+"-wrapper")
}else{var id=CQ.DOM.encodeId(token);
var editor=CQ.Ext.getCmp(id);
if(editor){tabPanel.setActiveTab(editor)
}else{admin.loadPath(token);
tabPanel.setActiveTab(admin.id+"-wrapper")
}}}else{if(token!=current){admin.loadPath(token)
}}});
if(anchor){admin.loadPath(decodeURI(anchor))
}window.CQ_SiteAdmin_id=id;
CQ.Ext.EventManager.on(window,"blur",function(){window.setTimeout(function(){CQ.Ext.getCmp(id+"-grid").stopEditing(true)
},500)
});
this.typeCache={}
},initComponent:function(){CQ.wcm.SiteAdmin.superclass.initComponent.call(this);
var A=this;
CQ.Ext.getCmp(A.id+"-tree").getSelectionModel().on("selectionchange",function(B,C){if(C){var D=C.getPath();
A.loadPages(C);
CQ.Ext.History.add(D,true);
A.setDocumentTitle(C.text);
if(C.attributes&&C.attributes.type){A.typeCache[D]=C.attributes.type
}A.checkActions()
}})
},setDocumentTitle:function(B){var A=this.title;
if(B){A+=" | "+B
}document.title=A
},getType:function(path){if(!this.typeCache[path]){var info=CQ.HTTP.eval(path+".json");
if(info){this.typeCache[path]=info["jcr:primaryType"]
}}return this.typeCache[path]
},copySelectionToClipboard:function(){this.copyClipboard=new Array();
var B=this.getSelectedPages();
for(var A=0;
A<B.length;
A++){this.copyClipboard.push(B[A].id)
}this.checkActions()
},hasClipboardSelection:function(){return((this.copyClipboard!=null)&&(this.copyClipboard.length>0))
},pasteFromClipboard:function(C){this.mask();
var D=CQ.wcm.SiteAdmin.getTargetFromTree();
for(var B=0;
B<this.copyClipboard.length;
B++){var E="cmd=copyPage&_charset_=utf-8&srcPath="+encodeURIComponent(this.copyClipboard[B])+"&destParentPath="+encodeURIComponent(D)+"&before=";
if(C){E+="&shallow=true"
}var A=CQ.HTTP.post("/bin/wcmcommand?"+E)
}this.reloadCurrentTreeNode()
},performCopy:function(A,G,E,F,C){this.mask();
var H="cmd=copyPage&_charset_=utf-8&srcPath="+encodeURIComponent(G.getPath())+"&destParentPath="+encodeURIComponent(F.getPath());
if(F.childNodes[C]){H+="&before="+F.childNodes[C].getPath()
}else{H+="&before="
}var B=CQ.HTTP.post("/bin/wcmcommand?"+H);
var D=B.headers.Status&&B.headers.Status=="200";
if(!D){this.unmask()
}return D
},performLiveCopy:function(J,B,H,I,E){this.mask();
var F=CQ.WCM.getPage(I.getPath());
var A=CQ.HTTP.encodePath(B.getPath());
var D=CQ.HTTP.encodePath(I.getPath());
var G=null;
if(I.childNodes[E]){G=I.childNodes[E].getPath()
}var C=CQ.wcm.msm.MSM.Commands.createLiveCopy(A,D,G,null,false,null,function(){this.unmask()
},this);
return true
},performAfterCopy:function(B,F,D,E,C){var A=this;
window.setTimeout(function(){B.getLoader().load(D,function(){D.expand();
D.select()
});
CQ.Ext.getCmp(A.id+"-grid").getStore().reload()
},10)
},performAfterMoveOrReorder:function(B,F,D,E,C){var A=this;
window.setTimeout(function(){var N=D.getPath();
var K=E.getPath();
if(E.parentNode){var J=E.parentNode.getPath();
var G;
if(N.split("/").length>J.split("/").length&&N.indexOf(J)==0){G=[E.parentNode]
}else{if(J.indexOf(N)==0){G=[D]
}else{G=[E.parentNode,D]
}}var L=F.getPath();
var H=L.substring(L.lastIndexOf("/")+1);
var M=function(O){O.un("expand",M);
window.setTimeout(function(){A.loadPath(K+"/"+H)
},10)
};
G[0].on("expand",M);
for(var I=0;
I<G.length;
I++){G[I].reload()
}}else{E.getOwnerTree().getRootNode().reload();
A.loadPath(E.getPath())
}},10)
},performMoveOrReorder:function(O,C,K,M,H){this.mask();
var L=this;
var N=C.getPath().split("/");
var A=encodeURIComponent(N[N.length-1]);
var B=encodeURIComponent(C.getPath());
var J=encodeURIComponent(M.getPath());
var E="cmd=movePage&_charset_=utf-8&srcPath="+B+"&destPath="+J+"/"+A;
if(M.childNodes[H]){E+="&before="+encodeURIComponent(M.childNodes[H].getPath())
}else{E+="&before="
}var D=CQ.HTTP.post("/bin/wcmcommand?"+E);
var F="500";
if(D.headers.Status){F=D.headers.Status
}if(F=="200"){return true
}else{if(F=="412"){var G={path:B,dstName:A,dstParentPath:J};
var I=new CQ.wcm.HeavyMoveDialog(G);
I.on("beforesubmit",function(){L.mask()
});
I.success=function(){L.performAfterMoveOrReorder(O,C,K,M,H)
};
this.unmask();
I.show()
}else{this.unmask()
}}return false
},performReorder:function(F,E){if(F==E){return 
}if(E==undefined){E=""
}var H=encodeURIComponent(F);
var G="cmd=movePage&_charset_=utf-8&srcPath="+H+"&destPath="+H+"&before="+encodeURIComponent(E);
var C=CQ.HTTP.post("/bin/wcmcommand?"+G);
var A=this;
var D=function(){};
var B="500";
if(C.headers.Status){B=C.headers.Status
}if(B=="200"){return D
}return null
},getGridConfigId:function(A){if(!A){A="/"
}var B=this.initialConfig.gridConfig;
var C;
for(C in B){gridCfg=B[C];
if(new RegExp(B[C].pathRegex).test(A)){break
}}if(!C){C="pages"
}return C
},getGridConfig:function(A){var B=this.initialConfig.gridConfig;
var C=this.getGridConfigId(A);
if(C){return B[C]
}else{return null
}},reconfigureGrid:function(C,D){C.inProgress=[];
var A=this.getGridConfig(D);
if(!A){return C.getStore()
}if(!A.inited){A.store=new CQ.Ext.data.Store(A.storeConfig);
A.store.on("beforeload",function(){C.inProgress=[]
});
A.colModel=new CQ.Ext.grid.ColumnModel({columns:A.colModelColumns,defaults:{sortable:true}});
A.colModel.on("hiddenchange",function(F,G,H){C.saveState()
});
A.inited=true
}var B=A.storeProxyPrefix+CQ.shared.HTTP.encodePath(D)+A.storeProxySuffix;
A.store.proxy.api.read.url=B;
if(A.store.lastOptions){delete A.store.lastOptions
}this.pagingToolbar.bindStore(A.store);
this.pagingToolbar.pageSize=A.pageSize;
this.pagingToolbar.displayMsg=A.pageText;
if(A.pathRegex!=this.lastGridPathRegex){C.reconfigure(A.store,A.colModel);
var E=this.getGridConfigId(this.treePath);
C.stateId=C.id+"-"+E;
C.initState();
this.lastGridPathRegex=A.pathRegex;
A.store.removeAll()
}return A.store
},showPagingToolbar:function(){if(this.pagingToolbar.hidden){this.pagingToolbar.show();
this.pagingToolbar.ownerCt.doLayout()
}},hidePagingToolbar:function(){if(!this.pagingToolbar.hidden){this.pagingToolbar.hide();
this.pagingToolbar.ownerCt.doLayout()
}},checkPagingToolbar:function(A){if(A<=this.pagingToolbar.pageSize){this.hidePagingToolbar()
}else{this.showPagingToolbar()
}},loadS7Status:function(C,A){CQ.wcm.SiteAdmin.scene7PublishStatuses={length:0};
if(A==="sling:OrderedFolder"||A==="sling:Folder"){var B=CQ.HTTP.get(CQ.HTTP.encodePath(C)+".s7PublishStatus.json");
if(B&&B.responseText){CQ.wcm.SiteAdmin.scene7PublishStatuses=JSON.parse(B.responseText)
}}},reloadPages:function(){this.mask();
var A=CQ.Ext.getCmp(this.id+"-grid").getStore();
this.loadS7Status(this.treePath,this.nodeType);
A.reload({callback:function(){this.checkPagingToolbar(A.getTotalCount());
this.unmask()
},scope:this})
},loadPages:function(node,selectRecord){this.mask();
this.lastClickedRow=-1;
var path=node.getPath();
this.treePath=path;
this.treePathEncoded=CQ.HTTP.encodePath(path);
var grid=CQ.Ext.getCmp(this.id+"-grid");
var store=this.reconfigureGrid(grid,this.treePath);
var id=this.id;
var admin=this;
var nodeType="";
if(node.attributes&&node.attributes.type){nodeType=node.attributes.type
}this.nodeType=nodeType;
this.loadS7Status(path,nodeType);
store.reload({callback:function(records,options,success){if(id=="cq-damadmin"){var cookieValue="path="+encodeURIComponent(path)+"&p.limit=-1&mainasset=true&type=dam:Asset";
CQ.HTTP.setCookie("cq-mrss",cookieValue,"/bin")
}var recSelected=false;
if(selectRecord){var selModel=grid.getSelectionModel();
for(var i=0;
i<records.length;
i++){if(records[i].id==selectRecord){selModel.clearSelections();
selModel.selectRecords([records[i]]);
recSelected=true
}}if(id=="cq-damadmin"&&selModel.hasSelection()){CQ.wcm.SiteAdmin.openPages.call(admin)
}}admin.checkPagingToolbar(store.getTotalCount());
if(selectRecord&&!recSelected&&!admin.pagingToolbar.hidden){try{var sort=grid.getStore().sortInfo;
var url=store.proxy.api.read.url;
for(var param in store.baseParams){url=CQ.HTTP.addParameter(url,param,store.baseParams[param])
}if(sort){url=CQ.HTTP.addParameter(url,"sort",sort.field);
url=CQ.HTTP.addParameter(url,"dir",sort.direction)
}url=CQ.HTTP.addParameter(url,"index","true");
url=CQ.HTTP.addParameter(url,"path",selectRecord);
var index=CQ.HTTP.eval(url).index+1;
if(index>0){var selectRow=function(recs){grid.getSelectionModel().selectRecords([this.getById(selectRecord)]);
this.un("load",selectRecord)
};
grid.getStore().on("load",selectRow);
admin.pagingToolbar.changePage(index)
}}catch(e){}}admin.unmask()
}})
},loadPath:function(D,C){var B=this;
var E=function(H,F,G){if(H){this.loadPages(F,G);
F.expand()
}else{this.loadPath(this.treePath.substring(0,this.treePath.lastIndexOf("/")),this.treePath)
}};
var A=CQ.Ext.getCmp(this.id+"-tree");
if(!D&&!this.treePath){this.treePath=A.getRootNode().getPath();
A.selectPath(A.getRootNode().id,"id",function(G,F){E.call(B,G,F,C)
})
}else{if(D){this.treePath=D
}if(this.treePath==A.getRootNode().getPath()){A.selectPath(A.getRootNode().id,"id",function(G,F){E.call(B,G,F,C)
})
}else{A.selectPath(this.treePath,"name",function(G,F){E.call(B,G,F,C)
})
}}},reloadCurrentTreeNode:function(){var A=CQ.Ext.getCmp(this.id+"-tree");
var B;
try{B=A.getSelectionModel().getSelectedNode()
}catch(C){}if(B&&B!=A.getRootNode()){var D=B.getPath();
B.parentNode.reload(function(){A.selectPath(D,null,function(F,E){if(F){E.expand()
}})
})
}else{A.getRootNode().reload()
}CQ.Ext.getCmp(this.id+"-grid").getStore().reload();
this.unmask()
},getCurrentPath:function(){var A=CQ.Ext.getCmp(this.id+"-tree");
var B=A.getSelectionModel().getSelectedNode();
if(B!=null){return B.getPath()
}},getSelectedPages:function(){var A=this;
var C=CQ.Ext.getCmp(this.id+"-grid").getSelectionModel().getSelections();
if(C.length>0){return C
}else{if(this.treePath){var B=CQ.Ext.getCmp(this.id+"-tree").getSelectionModel().getSelectedNode();
return[{id:A.treePath,label:A.treePath.substring(A.treePath.lastIndexOf("/")+1),replication:B&&B.attributes?B.attributes.replication:null,title:B?B.text:null,type:null,_displayTitle_:true,get:function(D){return this[D]
}}]
}else{return[]
}}},mask:function(){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.id+"-wrapper",{msg:CQ.I18n.getMessage("Loading...")})
}this.loadMask.show()
},unmask:function(A){if(!this.loadMask){return 
}this.loadMask.hide()
},html5UploadFiles:function(C){var B=this;
var A=CQ.Ext.getCmp(this.id+"-tree");
var D;
try{D=A.getSelectionModel().getSelectedNode()
}catch(G){}if(!D){return 
}var F=D.getPath().replace("/content/dam","/var/dam");
var E={path:F,current:0,uploaded:0,totalSize:0,files:0,isFile:function(H){if(H.size==0){return false
}if(H.size<512&&H.type==""&&H.name.indexOf(".")<0){return false
}return true
},upload:function(J){this.files=[];
for(var I=0;
I<J.length;
I++){var H=J[I];
if(this.isFile(H)){this.totalSize+=H.fileSize;
this.files.push(H)
}else{CQ.Notification.notify(CQ.shared.XSS.getXSSValue(H.name),CQ.I18n.getMessage("It is not possible to upload folders"))
}}if(this.files.length==0){return 
}this.progress=new CQ.Ext.ProgressBar();
this.mainWin=new CQ.Ext.Window({width:400,title:"File Upload",layout:"anchor",renderTo:B.id+"-grid",closable:false,items:[this.progress]}).show();
this.uploadNext()
},finish:function(){this.mainWin.close();
this.mainWin.destroy();
B.reloadPages()
},uploadNext:function(){if(this.current>=this.files.length){this.progress.updateProgress(1);
if(F.indexOf("/var/dam")==0){new CQ.Ext.util.DelayedTask(this.finish,this).delay(1000)
}else{this.finish()
}return 
}var I=this.files[this.current++];
this.currentSize=I.fileSize;
this.progress.updateProgress(this.uploaded/this.totalSize);
var L="";
if(this.files.length>1){L=" ("+this.current+"/"+this.files.length+")"
}this.progress.updateText("Uploading "+I.fileName+L);
var H=this;
var J=new XMLHttpRequest();
J.upload.addEventListener("load",function(M){H.uploaded+=H.currentSize;
H.uploadNext()
},false);
J.upload.addEventListener("progress",function(M){H.progress.updateProgress((H.uploaded+M.loaded)/H.totalSize)
},false);
if(!CQ.Ext.form.VTypes.name(I.fileName)){CQ.Notification.notify(I.fileName,"<br>"+CQ.Ext.form.VTypes.nameText);
this.uploadNext();
return 
}J.fileName=I.fileName;
J.onreadystatechange=function(){if(this.readyState==4){if(!CQ.HTTP.isOkStatus(this.status)){CQ.Notification.notify(this.fileName,CQ.I18n.getMessage("Failed to upload asset"));
H.finish()
}}};
if(window.FormData){var K=new FormData();
K.append(I.fileName,I);
K.append("_charset_","utf-8");
J.open("POST",CQ.HTTP.externalize(CQ.HTTP.encodePath(F)),true);
J.send(K)
}else{J.open("PUT",CQ.HTTP.externalize(CQ.HTTP.encodePath(F+"/"+I.fileName)),true);
J.send(I)
}}};
E.upload(C)
}});
CQ.Ext.reg("siteadmin",CQ.wcm.SiteAdmin);
CQ.Ext.override(CQ.wcm.SiteAdmin,CQ.wcm.AdminBase);
CQ.wcm.SiteAdmin.scene7PublishStatuses={length:0};
CQ.wcm.SiteAdmin.formatDate=function(B){if(typeof B=="number"){B=new Date(B)
}var A=CQ.I18n.getMessage("d-M-Y H:i",null,"Date format for ExtJS SiteAdmin (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)");
return B.format(A)
};
CQ.wcm.SiteAdmin.getPostUploadUrl=function(B,C){var A=B;
if(B.match(/^\/content\/dam.*/)){A+=".createasset.html"
}else{if(C){A+="/"+C
}}return A
};
CQ.wcm.SiteAdmin.DD_GROUP_TREE="cq.siteadmin.tree";
CQ.wcm.SiteAdmin.DD_GROUP_GRID="cq.siteadmin.grid";
CQ.wcm.SiteAdmin.TEXT_EDITOR=new CQ.Ext.form.TextField({enableKeyEvents:true,listeners:{render:function(){window.CQ_TextEditor=this;
this.enterPressed=false
},keydown:function(B,A){this.enterPressed=(A.getKey()==A.ENTER)
}}});
CQ.wcm.SiteAdmin.GRID_LISTENERS={beforeedit:{title:function(D){var B=D.record.data.lockedBy;
var C=CQ.User.getUserID();
var A=B!=undefined&&B.length>0&&B!=C;
if(A){return false
}return this.inProgress.indexOf(D.record.id)==-1
}},afteredit:{title:function(A){if(window.CQ_TextEditor.enterPressed){if(A.originalValue==undefined){A.originalValue=""
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Change title"),CQ.I18n.getMessage("Are you sure you want to change the title from '{0}' to '{1}'?",[CQ.shared.XSS.getXSSValue(A.originalValue),CQ.shared.XSS.getXSSValue(A.value)]),function(D){if(D=="yes"){var C="./jcr:content/jcr:title";
if(A.record.get("type")=="dam:Asset"){C="./jcr:content/metadata/dc:title"
}var F={};
F._charset_="utf-8";
F["./jcr:content/jcr:primaryType"]="nt:unstructured";
F[C]=A.value;
var B=CQ.HTTP.post(A.record.id,null,F);
if(CQ.HTTP.isOk(B)){A.record.commit();
try{CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree").getSelectionModel().getSelectedNode().reload()
}catch(E){}}else{A.record.reject()
}}else{A.record.reject()
}},this)
}else{A.record.reject()
}},label:function(H){var G=H.record.id;
H.record.id=G.substring(0,G.lastIndexOf("/")+1)+H.value;
var A=CQ.Ext.getCmp(this.id+"-tree");
var B=A.getRootNode();
var E;
var F=G.split("/");
for(var D=1;
D<F.length;
D++){var C=F[D];
if(C==B.attributes.name){E=B
}else{E=E.findChild("name",C)
}}E.attributes.name=H.value
}},validateedit:{label:function(F){var H=F.record.id;
var E=F.value;
var A=H.substring(0,H.lastIndexOf("/")+1)+E;
var G="?cmd=movePage&_charset_=utf-8&srcPath="+H+"&destPath="+A;
var C=CQ.HTTP.post("/bin/wcmcommand"+G);
var B="500";
if(C.headers.Status){B=C.headers.Status
}if(B=="200"){return true
}else{if(B=="412"){var D={path:H,dstName:E};
new CQ.wcm.HeavyMoveDialog(D).show();
return false
}else{return false
}}}}};
CQ.wcm.SiteAdmin.COLUMNS={numberer:{id:"numberer",header:CQ.I18n.getMessage(""),width:23,menuDisabled:true,fixed:true,hideable:false,dataIndex:"index",renderer:function(B,C,A){if(B!=undefined){return B+1
}return""
}},title:{header:CQ.I18n.getMessage("Title"),id:"title",dataIndex:"title",editor:CQ.wcm.SiteAdmin.TEXT_EDITOR,renderer:function(C,A,B){return CQ.shared.XSS.xssPropertyRenderer(C,A,B,this)
}},name:{header:CQ.I18n.getMessage("Name"),id:"name",dataIndex:"label",width:80},template:{header:CQ.I18n.getMessage("Template"),id:"template",dataIndex:"templateTitle",renderer:function(B,D,A){var C=CQ.shared.XSS.getXSSRecordPropertyValue(A,"templateShortTitle");
if(C.length>0){return CQ.I18n.getVarMessage(C)
}else{return CQ.I18n.getVarMessage(B)
}}},published:{header:CQ.I18n.getMessage("Published"),id:"published",dataIndex:"replication",renderer:function(G,A,C){var E="";
var H="";
var D=C.data.replication;
var B="";
var I=CQ.I18n.getMessage("N/A");
var F=CQ.I18n.getMessage("N/A");
if(D&&D.published){H=CQ.wcm.SiteAdmin.formatDate(new Date(D.published));
H+=" ("+CQ.shared.XSS.getXSSTablePropertyValue(D,"publishedBy")+")";
if(D.numQueued){B=' ext:qtip="<nobr>';
if(D.action=="ACTIVATE"){E="status-pending-activation";
B+=CQ.I18n.getMessage("Activation pending. #{0} in Queue.",D.numQueued)
}else{E="status-pending-deactivation";
B+=CQ.I18n.getMessage("Deactivation pending. #{0} in Queue.",D.numQueued)
}B+='</nobr>"'
}else{if(D.action=="ACTIVATE"){if(!C.data.timeUntilValid){if(!C.data.offTime){E="status-activated"
}else{E="status-offtime"
}}else{if(C.data.timeUntilValid){if(C.data.offTime){E="status-onofftime"
}else{E="status-ontime"
}}else{E="status-deactivated"
}}}else{E="status-deactivated"
}}if(C.data.timeUntilValid&&(C.data.onTime||C.data.offTime)){B='ext:qtip="<nobr>';
if(C.data.onTime){I=CQ.wcm.SiteAdmin.formatDate(new Date(C.data.onTime));
B+="<b>"+CQ.I18n.getMessage("On Time")+":</b> "+I+"<br/>"
}if(C.data.offTime){F=CQ.wcm.SiteAdmin.formatDate(new Date(C.data.offTime));
B+="<b>"+CQ.I18n.getMessage("Off Time")+":</b> "+F+"<br/>"
}B+='</nobr>"'
}}else{E="status-none"
}return'<div class="status double '+E+'" '+B+"><span>"+H+"</span></div>"
}},modified:{header:CQ.I18n.getMessage("Modified"),id:"modified",dataIndex:"lastModified",renderer:function(C,H,B){var F=B.data.replication;
var A=B.data.lastModified;
var G="";
var D="";
if(A>0){G=CQ.wcm.SiteAdmin.formatDate(new Date(B.data.lastModified));
var E=CQ.shared.XSS.getXSSTablePropertyValue(B.data,"lastModifiedBy");
if(E&&E.length>0){G+=" ("+E+")"
}D="status-localmodified"
}if(F&&F.published){if(F.action=="ACTIVATE"){if(A>F.published){D="status-modified"
}}}if(!D){D="status-localmodified"
}return'<div class="status '+D+'">'+G+"</div>"
}},scene7Status:{header:CQ.I18n.getMessage("Scene7 Publish Status"),hidden:false,id:"scene7Status",data:"scene7Status",renderer:function(C,H,B){var D="";
for(var F=0;
F<CQ.wcm.SiteAdmin.scene7PublishStatuses.length;
F++){var E="";
if(CQ.wcm.SiteAdmin.scene7PublishStatuses[F]&&CQ.wcm.SiteAdmin.scene7PublishStatuses[F].scene7Status){E=CQ.wcm.SiteAdmin.scene7PublishStatuses[F].scene7Status
}if(CQ.wcm.SiteAdmin.scene7PublishStatuses[F].path===B.id){B.data.scene7Status=E;
B.json.scene7Status=E;
break
}}var A=B.data.scene7Status;
var G="";
if(A){G=' ext:qtip="<nobr>';
if(A=="UploadStart"){D="status-s7-pending";
G+=CQ.I18n.getMessage("Upload started")
}else{if(A=="UploadFailed"){D="status-s7-failed";
G+=CQ.I18n.getMessage("Upload failed")
}else{if(A=="PublishStart"){D="status-s7-pending";
G+=CQ.I18n.getMessage("Publish started")
}else{if(A=="PublishQueued"){D="status-s7-queued";
G+=CQ.I18n.getMessage("Publish queued")
}else{if(A=="PublishFailed"){D="status-s7-failed";
G+=CQ.I18n.getMessage("Publish failed")
}else{if(A=="PublishComplete"){D="status-s7-complete";
G+=CQ.I18n.getMessage("Publish complete")
}}}}}}G+='</nobr>"'
}else{D="status-s7-none"
}return'<div class="status double '+D+'" '+G+"></div>"
}},status:{header:CQ.I18n.getMessage("Status"),id:"status",dataIndex:"X",width:90,renderer:function(J,S,C){var L="";
var N=C.data.scheduledTasks;
if(N!=undefined&&N.length>0){var H="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Task")+"</th><th>"+CQ.I18n.getMessage("Scheduled")+"</th><th>"+CQ.I18n.getMessage("Version")+"</th></tr>";
N.sort(function U(W,V){if(W.scheduled<V.scheduled){return -1
}else{if(W.scheduled>V.scheduled){return 1
}}return 0
});
for(var K=0;
K<N.length;
K++){var G=(typeof (N[K].version)!="undefined")?N[K].version:"";
var A=(N[K].type=="activation")?"status status-scheduledtask-activation":"status status-scheduledtask-deactivation";
H+="<tr><td class='"+A+"'></td><td>"+CQ.wcm.SiteAdmin.formatDate(N[K].scheduled)+" ("+N[K].scheduledBy+")</td><td>"+G+"</td></tr>"
}H+="</table>";
L+='<span class="status status-scheduledtask" ext:qtip="'+H+'">&nbsp;</span>'
}var B=C.data.workflows;
if(B!=undefined&&B.length>0){var D="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Workflow")+"</th><th>"+CQ.I18n.getMessage("Step")+"</th></tr>";
for(var I=0;
I<B.length;
I++){var R="";
var P=B[I].workItems;
for(var Q=0;
Q<P.length;
Q++){R+=CQ.shared.Util.htmlEncode(P[Q].item);
if(P[Q].assignee){R+=" ("+CQ.shared.Util.htmlEncode(P[Q].assignee)+")"
}R+="<br/>"
}var M=B[I].suspended?"workflow-suspended":"";
D+="<tr class="+M+"><td>"+CQ.shared.Util.htmlEncode(B[I].model)+"</td><td>"+R+"</td></tr>"
}D+="</table>";
L+='<span class="status status-workflow" ext:qtip="'+D+'">&nbsp;</span>'
}var O=C.data.lockedBy;
if(O!=undefined&&C.data.lockedBy){var F="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Lock",null,"noun")+"</th></tr>";
F+="<tr><td>"+CQ.I18n.getMessage("Locked by {0}",O)+"</td></tr></table>";
L+='<span class="status status-locked" ext:qtip="'+F+'">&nbsp;</span>'
}if(C.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=undefined&&C.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]){var E=CQ.wcm.msm.MSM.getRelationStatus(C.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]);
E=E?E.replace(/.*title\=\"(.*)\"\ alt\=.*/,"$1"):"";
var T="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Live Copy")+"</th></tr>";
T+="<tr><td>"+E+"</td></tr></table>";
L+='<span class="status status-livecopy" ext:qtip="'+T+'">&nbsp;</span>'
}return L
}},impressions:{header:CQ.I18n.getMessage("Impressions"),id:"impressions",dataIndex:"monthlyHits",tooltip:CQ.I18n.getMessage("Page impressions last 30 days"),renderer:function(G,E,A,H,C,B){if(G>0){var F=G;
B.each(function(I){F=Math.max(F,I.get("monthlyHits"))
});
var D=Math.ceil(75*(G/F));
return'<div class="'+E.css+'monthly-hits" ext:qtip="'+CQ.I18n.getMessage("Show impressions chart")+'" style="width:'+D+'px">'+G+"</div>"
}else{return'<div class="'+E.css+'no-hits" ext:qtip="'+CQ.I18n.getMessage("Show impressions chart")+'">'+G+"</div>"
}}},workflow:{header:CQ.I18n.getMessage("In Workflow"),id:"workflow",dataIndex:"inWorkflow",hidden:true,renderer:function(B,C,A){return B?CQ.I18n.getMessage("Yes"):""
}},locked:{header:CQ.I18n.getMessage("Locked by"),id:"locked",hidden:true,dataIndex:"lockedBy"},liveCopyStatus:{header:CQ.I18n.getMessage("Live Copy"),id:"liveCopyStatus",hidden:true,dataIndex:"msm:liveRelationship",renderer:function(C,D,A){var B=A.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
return CQ.wcm.msm.MSM.getRelationStatus(B)
}},thumbnail:{header:'<span class="hidden">'+CQ.I18n.getMessage("Thumbnail")+"</span>",id:"thumbnail",width:60,menuDisabled:true,hideable:true,dataIndex:"X",sortable:false,hidden:true,renderer:function(L,R,C){var K=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-grid");
var M=C.id;
var N=/.*\:.*[F|f]older/.test(C.get("type"));
if(K.treePath.indexOf("/content/dam/")==0&&!N){if(M.indexOf("/var/dam")==0){M="/content/dam"+M.substring(8)
}var P=A.inProgress.indexOf(M);
var D=C.get("inProgress");
if(D||C.get("lastModified")==0||C.id.indexOf("/var/dam")==0){var Q=D<0?"/libs/cq/ui/widgets/themes/default/ext/window/icon-error.gif":"/libs/cq/ui/widgets/themes/default/icons/48x48/document_loading.gif";
var O='<img src="'+CQ.HTTP.externalize(Q)+'"';
var I="<nobr>"+CQ.I18n.getMessage("In Progress")+"</nobr>";
if(D<0){I="<b>"+CQ.I18n.getMessage("Failed to process asset")+"</b>";
if(C.get("inWorkflow")){var B=C.get("workflows");
if(B&&B.length>0){var H=B[0];
if(H.workItems&&H.workItems.length>0){var F=H.workItems[H.workItems.length-1];
if(F.failureMessage){I+="<br/>";
I+=F.failureMessage
}}}}}if(D){O+=' ext:qtip="'+I+'"';
var G=A.getStore().indexOf(C);
setTimeout(function(){var S=CQ.Ext.fly(A.getView().getRow(G));
if(D<0){S.addClass("status-error")
}else{}},1)
}O+=">";
return O
}}var J=C.get("ck");
var E=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(M))+".thumb.48.48"+(J?"."+J:"")+".png",true);
return'<img src="'+E+'">'
}},size:{header:CQ.I18n.getMessage("Size"),id:"size",width:60,dataIndex:"size",renderer:function(B,C,A){return B?CQ.Util.formatFileSize(B):""
}},width:{header:CQ.I18n.getMessage("Width"),id:"width",width:55,dataIndex:"width",renderer:function(B,C,A){return B?B:""
}},height:{header:CQ.I18n.getMessage("Height"),id:"height",width:50,dataIndex:"height",renderer:function(B,C,A){return B?B:""
}},mime:{header:CQ.I18n.getMessage("Kind"),id:"mime",hidden:true,dataIndex:"mime"}};
CQ.wcm.SiteAdmin.CONTEXT_TOOLBAR="toolbar";
CQ.wcm.SiteAdmin.CONTEXT_CONTEXTMENU="contextmenu";
CQ.wcm.SiteAdmin.createPage=function(){var B=this.getCurrentPath();
var C=CQ.wcm.Page.getCreatePageDialog(B);
var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
C.on("beforesubmit",function(){A.mask()
});
C.success=function(){A.reloadCurrentTreeNode()
};
C.failure=function(){A.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create page."))
};
C.show()
};
CQ.wcm.SiteAdmin.createSite=function(){var A=this;
var B=CQ.WCM.getDialog("","cq-siteadmin-csw",true);
if(!B){B=new CQ.wcm.CreateSiteWizard();
B.on("beforesubmit",function(){A.mask()
});
B.success=function(){A.reloadCurrentTreeNode()
};
B.failure=function(D,C){A.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create site: {0}",[C.result["Message"]]))
};
CQ.WCM.registerDialog("cq-siteadmin-csw",B)
}B.loadContent({dstPath:this.getCurrentPath()});
B.show()
};
CQ.wcm.SiteAdmin.createLiveCopy=function(){var B=this.getCurrentPath();
var C=CQ.WCM.getDialog(CQ.wcm.msm.MSM.Commands.getCreateLiveCopyDialogConfig(B));
var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
C.on("beforesubmit",function(){A.mask()
});
C.success=function(){A.reloadCurrentTreeNode()
};
C.failure=function(E,D){A.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create Live Copy: {0}",[D.result["Message"]]))
};
C.show()
};
CQ.wcm.SiteAdmin.internalDeletePage=function(B){this.mask();
var C=this.getSelectedPages();
var L=CQ.Ext.getCmp(this.id+"-tree");
var G=CQ.Ext.getCmp(this.id+"-grid");
var K=[];
var A=[];
for(var F=0;
F<C.length;
F++){var H=C[F];
K.push(H.id);
var J=H.id.split("/");
var D=L.getRootNode();
var I=D.getPath().split("/");
for(var E=I.length;
E<J.length;
E++){D=D.findChild("name",J[E])
}if(D){A.push(D)
}}CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:function(O,S,R){var N=CQ.HTTP.buildPostResponseFromHTML(R.responseText);
var M=N.headers[CQ.utils.HTTP.HEADER_STATUS];
if(M==200){for(var P=0;
P<C.length;
P++){G.getStore().remove(C[P])
}for(var P=0;
P<A.length;
P++){try{A[P].remove()
}catch(Q){}}this.unmask()
}else{if(M==412){this.unmask();
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Page"),msg:CQ.I18n.getMessage("One or more selected pages are referenced. Click 'yes' to proceed deleting the pages, click 'no' to review the references or 'cancel' to cancel the operation."),buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(T){if(T=="yes"){CQ.wcm.SiteAdmin.internalDeletePage.call(this,true)
}else{if(T=="no"){CQ.wcm.SiteAdmin.showReferences.call(this)
}}},scope:this})
}else{if(M==500){this.unmask();
CQ.Notification.notifyFromResponse(N)
}else{this.unmask()
}}}},params:{path:K,_charset_:"utf-8",cmd:"deletePage",force:B},scope:this})
};
CQ.wcm.SiteAdmin.deletePage=function(){var C=this.getSelectedPages();
var F=(C.length>1)?CQ.I18n.getMessage("You are going to delete the following pages: "):CQ.I18n.getMessage("You are going to delete the following page: ");
F+="<br/><br/>";
var A=7;
for(var B=0;
B<C.length;
B++){if(B==A){F+=CQ.I18n.getMessage("(and {0} more...)",[C.length-B],"pages to delete")+"<br/>";
break
}var D=CQ.shared.XSS.getXSSRecordPropertyValue(C[B],"title");
if(!D){D=C[B].get("label")
}F+=D+"<br/>"
}F+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var E=(C.length>1)?CQ.I18n.getMessage("Delete Pages"):CQ.I18n.getMessage("Delete Page");
CQ.Ext.Msg.show({title:E,msg:F,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(G){if(G=="yes"){CQ.wcm.SiteAdmin.internalDeletePage.call(this,false)
}},scope:this})
};
CQ.wcm.SiteAdmin.openPage=function(path,type,newWindow,selection){if(type=="dam:Asset"){if(window.CQ_SiteAdmin_id=="cq-damadmin"){CQ.wcm.DamAdmin.openAsset(path,selection)
}else{if(!CQ.User.getCurrentUser().hasPermissionOn("modify",path)){return 
}var admin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var config=CQ.WCM.getDialogConfig("/libs/wcm/core/content/tools/assetdialog");
if(!config.success){config.success=function(){admin.reloadPages()
}
}if(!config.failure){config.failure=function(){admin.unmask()
}
}var locker=selection.data.lockedBy;
var currentUserID=CQ.User.getUserID();
var locked=false;
if(locker.length>0&&locker!=currentUserID){locked=true
}if(locked){config.buttons=[new CQ.Ext.Button({text:"OK",disabled:true}),CQ.Dialog.CANCEL]
}var dialog=CQ.WCM.getDialog(config);
dialog.on("beforesubmit",function(){admin.mask()
});
dialog.loadContent(CQ.HTTP.encodePath(path));
if(locked){dialog.disableFields()
}dialog.show();
if(locked){var msg=CQ.I18n.getMessage("Locked");
var description=CQ.I18n.getMessage("This asset is currently locked by {0}",[locker]);
CQ.Notification.notify(msg,description,10)
}}}else{if(!/.*([fF]older)/.test(type)==0){var admin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
admin.loadPath(path)
}else{if(!/.*([fF]ile)/.test(type)||path.indexOf("/etc/packages")==0){var url=CQ.HTTP.externalize("/bin/wcmcommand")+"?cmd=open";
url+="&_charset_=utf-8";
url+="&path="+encodeURIComponent(path);
if(CQ.Ext.isIE){var jsonUrl=CQ.HTTP.addParameter(url,"jsonMode",true);
var r=CQ.HTTP.eval(jsonUrl);
url=r.Location
}if(CQ.wcm.SiteAdmin.multiWinMode==undefined){var wm=CQ.User.getCurrentUser().getPreference("winMode");
CQ.wcm.SiteAdmin.multiWinMode=(wm!="single")
}if(newWindow||CQ.wcm.SiteAdmin.multiWinMode){CQ.shared.Util.open(url)
}else{CQ.shared.Util.load(url)
}}}}};
CQ.wcm.SiteAdmin.openPages=function(D,A){if(typeof D=="object"&&A){D=A.shiftKey
}var C=this.getSelectedPages();
for(var B=0;
B<C.length;
B++){CQ.wcm.SiteAdmin.openPage(C[B].id,C[B].get("type"),D,C[B]);
D=true
}};
CQ.wcm.SiteAdmin.openFindReplaceDialog=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var B=CQ.wcm.SiteAdmin.getSingleTarget();
if(!B){return 
}var C=CQ.WCM.getDialog("/libs/wcm/core/content/tools/findreplacedialog");
C.on("beforesubmit",function(){A.mask()
});
C.success=function(){A.reloadCurrentTreeNode()
};
C.failure=function(){A.unmask()
};
C.loadContent(B);
C.show()
}};
CQ.wcm.SiteAdmin.openPropertiesDialog=function(M,H,A,D,L){var G=null;
var I=null;
if((H!=null)&&(H=="cq:Page")){if((A==null)||(A=="")){G="/libs/foundation/components/page/dialog.infinity.json"
}else{G=A+".infinity.json"
}I="Page Properties of {0}"
}else{if((H!=null)&&(H=="nt:file")){}else{if((H!=null)&&(/.*\:.*[F|f]older/.test(H))&&H!="nt:folder"){if((A==null)||(A=="")){var F=H.replace(":","/");
G="/libs/foundation/components/primary/"+F+"/dialog.overlay.infinity.json"
}else{G=A+".infinity.json"
}I="Folder Properties of {0}"
}}}if(null!=G){var C=CQ.WCM.getDialogConfig(G);
if(D){C.buttons=[new CQ.Ext.Button({text:"OK",disabled:true}),CQ.Dialog.CANCEL]
}var E=CQ.WCM.getDialog(C,"NEW");
E.fieldEditLockMode=true;
E.loadContent(M+"/jcr:content");
E.setTitle(CQ.I18n.getMessage(I,M));
E.setElId(CQ.Util.createId("cq-propsdialog"));
E.addHidden({"jcr:primaryType":"nt:unstructured"});
var K=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
E.on("beforesubmit",function(){K.mask()
});
E.success=function(){K.reloadCurrentTreeNode()
};
E.failure=function(){K.unmask()
};
if(D){E.disableFields()
}E.show();
if(D){var B=CQ.I18n.getMessage("Locked");
var J=CQ.I18n.getMessage("This page is currently locked by {0}",[L]);
CQ.Notification.notify(B,J,10)
}}};
CQ.wcm.SiteAdmin.openProperties=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var G=A.getSelectedPages();
for(var E=0;
E<G.length;
E++){var F=G[E];
var B=false;
var D=F.data.lockedBy;
var C=CQ.User.getUserID();
if(D!=undefined&&D.length>0&&D!=C){B=true
}CQ.wcm.SiteAdmin.openPropertiesDialog(G[E].id,G[E].get("type"),G[E].get("dialogPath"),B,D)
}}};
CQ.wcm.SiteAdmin.copyPages=function(){this.copySelectionToClipboard()
};
CQ.wcm.SiteAdmin.pastePages=function(A,B){this.pasteFromClipboard(B.shiftKey)
};
CQ.wcm.SiteAdmin.scene7PublishPages=function(){var selections=this.getSelectedPages();
var paths=[];
var admin=this;
for(var i=0;
i<selections.length;
i++){var selection=selections[i];
var pagePath=selection.id;
paths[i]=pagePath;
var url=CQ.HTTP.noCaching("/bin/workflow.json");
url=CQ.HTTP.addParameter(url,"isInWorkflow",pagePath);
url=CQ.HTTP.addParameter(url,"_charset_","UTF-8");
var response=CQ.HTTP.get(url);
var isInWorkflow=false;
if(CQ.HTTP.isOk(response)){var data=CQ.Util.eval(response);
isInWorkflow=data.status
}if(isInWorkflow){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("A selected page is already subject to a workflow!"));
return 
}}var wait=function(ms){var dt=new Date();
dt.setTime(dt.getTime()+ms);
while(new Date().getTime()<dt.getTime()){}};
var data={id:CQ.Util.createId("cq-s7publishdialog"),path:paths,basePath:this.getCurrentPath()};
var dialog=new CQ.wcm.Scene7PublishDialog(data);
dialog.addListener("beforesubmit",this.mask,this);
dialog.success=function(form){for(var i=0;
i<paths.length;
i++){var pagePath=paths[i];
wait(100);
var params={_charset_:"UTF-8",model:"/etc/workflow/models/scene7/jcr:content/model",payload:pagePath,payloadType:"JCR_PATH"};
CQ.HTTP.post("/etc/workflow/instances",function(options,success,response){if(!success){admin.unmask()
}else{admin.reloadPages()
}},params)
}};
var dialogFailure=dialog.failure;
dialog.failure=function(){if(dialogFailure!=null){dialogFailure()
}admin.unmask()
};
dialog.show()
};
CQ.wcm.SiteAdmin.movePage=function(){var D=this.getSelectedPages();
var A=this;
for(var C=0;
C<D.length;
C++){var F=D[C].get&&D[C].get("type")=="dam:Asset";
var G=D[C].get&&D[C].get("type")=="cq:Page";
var B=CQ.wcm.Page.getMovePageDialog(D[C].id,G);
B.addListener("beforesubmit",this.mask,this);
B.success=function(J){var L="";
var H=CQ.Ext.getCmp(A.id+"-tree");
var I=H?H.getRootNode():undefined;
try{L=J.findField("destParentPath").getValue()
}catch(K){L=I?I.getPath():""
}if(F){window.setTimeout(function(){if(I){I.reload()
}A.loadPath(L)
},200)
}else{if(I){I.reload()
}A.loadPath(L)
}A.unmask()
};
var E=B.failure;
B.failure=function(){if(E!=null){E()
}A.unmask()
};
B.show();
break
}};
CQ.wcm.SiteAdmin.showReferences=function(){var B=this.getSelectedPages();
var E=[];
for(var A=0;
A<B.length;
A++){E.push(B[A].id)
}var C={path:E};
var D=new CQ.wcm.ReferencesDialog(C);
D.on("pageopen",function(G,F){G.close();
CQ.wcm.SiteAdmin.openPage(F)
});
D.show()
};
CQ.wcm.SiteAdmin.activatePage=function(){var A=this;
var E=[];
var C=this.getSelectedPages();
for(var B=0;
B<C.length;
B++){E.push(C[B].id)
}if(CQ.wcm.SiteAdmin.noAsset()){var D={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:E,callback:function(F){A.mask();
CQ.wcm.SiteAdmin.internalActivatePage.call(A,F)
}};
new CQ.wcm.AssetReferenceSearchDialog(D)
}else{this.mask();
CQ.wcm.SiteAdmin.internalActivatePage.call(A,E)
}};
CQ.wcm.SiteAdmin.internalActivatePage=function(B,C){if(C==undefined){var A=this;
C=function(E,F,D){if(F){A.reloadPages()
}else{A.unmask()
}}
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/replicate.json"),C,{_charset_:"utf-8",path:B,cmd:"Activate"})
};
CQ.wcm.SiteAdmin.deactivatePage=function(){var B=this.getSelectedPages();
var D=CQ.I18n.getMessage("You are going to deactivate the following pages: ")+"<br/>";
for(var A=0;
A<B.length;
A++){D+=CQ.shared.XSS.getXSSValue(B[A].id)+"<br/>"
}D+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var C=(B.length>1)?CQ.I18n.getMessage("Deactivate Pages"):CQ.I18n.getMessage("Deactivate Page");
CQ.Ext.Msg.show({title:C,msg:D,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(E){if(E=="yes"){CQ.wcm.SiteAdmin.internalDeactivatePage.call(this,false)
}},scope:this})
};
CQ.wcm.SiteAdmin.internalDeactivatePage=function(){var A=this;
this.mask();
var D=[];
var C=this.getSelectedPages();
for(var B=0;
B<C.length;
B++){D.push(C[B].id)
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/replicate.json"),function(F,G,E){if(G){A.reloadPages()
}},{_charset_:"utf-8",path:D,cmd:"Deactivate"})
};
CQ.wcm.SiteAdmin.openRolloutDialog=function(D,C){var A=this;
var B=new CQ.wcm.msm.RolloutWizard({path:D,hideComponents:true});
B.show()
};
CQ.wcm.SiteAdmin.rolloutPage=function(){var A=this;
var C=this.getSelectedPages();
for(var B=0;
B<C.length;
++B){CQ.wcm.SiteAdmin.openRolloutDialog.call(A,C[B].id,C[B].get("type"))
}};
CQ.wcm.SiteAdmin.lock=function(D,A){A.mask();
var E=[];
var C=A.getSelectedPages();
for(var B=0;
B<C.length;
B++){E.push(C[B].id)
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/wcmcommand"),function(G,H,F){if(H){A.reloadPages()
}},{_charset_:"utf-8",path:E,cmd:D},A)
};
CQ.wcm.SiteAdmin.lockPage=function(){CQ.wcm.SiteAdmin.lock("lockPage",this)
};
CQ.wcm.SiteAdmin.unlockPage=function(){CQ.wcm.SiteAdmin.lock("unlockPage",this)
};
CQ.wcm.SiteAdmin.lockNode=function(){CQ.wcm.SiteAdmin.lock("lockNode",this)
};
CQ.wcm.SiteAdmin.unlockNode=function(){CQ.wcm.SiteAdmin.lock("unlockNode",this)
};
CQ.wcm.SiteAdmin.startWorkflow=function(){var admin=this;
var id=CQ.Util.createId("cq-workflowdialog");
var startWorkflowDialog={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Start Workflow"),id:id,formUrl:"/etc/workflow/instances",params:{_charset_:"utf-8",payloadType:"JCR_PATH"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",model:{xtype:"combo",name:"model",id:id+"-model",hiddenName:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflows"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows"},[{name:"wid"},{name:"label"},{name:CQ.shared.XSS.getXSSPropertyName("label")}])}),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}',"</div>","</tpl>")},comment:{"jcr:primaryType":"cq:TextArea",fieldLabel:CQ.I18n.getMessage("Comment"),name:"startComment",height:200},title:{xtype:"textfield",name:"workflowTitle",fieldLabel:CQ.I18n.getMessage("Workflow Title")}}},okText:CQ.I18n.getMessage("Start")};
var dialog=CQ.WCM.getDialog(startWorkflowDialog);
var selections=this.getSelectedPages();
for(var i=0;
i<selections.length;
i++){var selection=selections[i];
var pagePath=selection.id;
var url=CQ.HTTP.noCaching("/bin/workflow.json?isInWorkflow="+encodeURIComponent(pagePath));
var response=CQ.HTTP.get(url);
var isInWorkflow=false;
if(CQ.HTTP.isOk(response)){var data=CQ.Util.eval(response);
isInWorkflow=data.status
}if(!isInWorkflow){dialog.addHidden({payload:pagePath})
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Page is already subject to a workflow!"));
return 
}}dialog.on("beforesubmit",function(){admin.mask()
});
dialog.success=function(){admin.reloadPages()
};
dialog.failure=function(){admin.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not start workflow."))
};
dialog.show()
};
CQ.wcm.SiteAdmin.openLinkChecker=function(){CQ.Util.reload(window,CQ.HTTP.externalize("/etc/linkchecker.html"))
};
CQ.wcm.SiteAdmin.openLanguageCopy=function(){var A=this;
var B=new CQ.wcm.LanguageCopyDialog({path:this.getCurrentPath(),id:CQ.Util.createId("cq-languagecopydialog")});
B.on("beforesubmit",function(){A.mask()
});
B.success=function(){CQ.Ext.getCmp(A.id+"-tree").getSelectionModel().getSelectedNode().reload();
A.reloadPages()
};
B.failure=function(){A.unmask()
};
B.show()
};
CQ.wcm.SiteAdmin.openBlueprintEditor=function(){var A=this;
var B={xtype:"dialog",height:660,width:810,items:{xtype:"tabpanel",items:[{xtype:"blueprinteditor",masterPath:this.getCurrentPath(),path:"/etc/msm/msm1"}]},buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){}},CQ.Dialog.CANCEL]};
var C=CQ.WCM.getDialog(B);
C.success=function(){};
C.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not edit blueprint."))
};
C.show()
};
CQ.wcm.SiteAdmin.restoreVersion=function(){var A=this;
var B=CQ.WCM.getDialog("/libs/wcm/core/content/tools/restoreversiondialog","NEW");
B.setElId(CQ.Util.createId("cq-restoreversiondialog"));
B.loadContent(this.getCurrentPath(),true);
B.on("beforesubmit",function(){A.mask()
});
B.success=function(){CQ.Ext.getCmp(A.id+"-tree").getSelectionModel().getSelectedNode().reload();
A.reloadPages()
};
B.failure=function(){A.unmask()
};
B.show()
};
CQ.wcm.SiteAdmin.restoreTree=function(){var A=this;
var B=CQ.WCM.getDialog("/libs/wcm/core/content/tools/restoretreedialog");
B.setElId(CQ.Util.createId("cq-restoretreedialog"));
B.loadContent(this.getCurrentPath(),true);
B.on("beforesubmit",function(){A.mask()
});
B.success=function(){CQ.Ext.getCmp(A.id+"-tree").getSelectionModel().getSelectedNode().reload();
A.reloadPages()
};
B.failure=function(){A.unmask()
};
B.show()
};
CQ.wcm.SiteAdmin.createFolder=function(E,C,H){var A=CQ.Ext.getCmp(this.id+"-tree");
var D;
try{D=A.getSelectionModel().getSelectedNode()
}catch(F){}if(!D){return 
}if(!H){H="itemname"
}var G={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Create Folder"),id:CQ.Util.createId("cq-createfolderdialog"),height:240,params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",label:{fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage('The name that will appear in the URL, e.g. "myfolder"'),name:"label"},title:{fieldLabel:CQ.I18n.getMessage("Title"),fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldDescription:CQ.I18n.getMessage('A separate title for the navigation, e.g. "My Folder"'),name:"title"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("Create"),cls:"cq-btn-create",handler:function(){var L=this.getField("title").getValue();
var I=this.getField("label").getValue();
if(!I){I=L?L:CQ.I18n.getMessage("Folder").toLowerCase()
}if(!CQ.Ext.form.VTypes[H](I)){var J=this;
var K=CQ.Ext.form.VTypes[H+"Text"];
K+="<br/><br/>";
K+=CQ.I18n.getMessage("Click 'Yes' to have the name auto-corrected and continue, or 'No' to cancel and change the name.");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Invalid Name"),K,function(M){if(M=="yes"){CQ.wcm.SiteAdmin.internalCreateFolder(D,I,L,H);
J.hide()
}else{J.getField("label").markInvalid(CQ.Ext.form.VTypes[H+"Text"])
}})
}else{CQ.wcm.SiteAdmin.internalCreateFolder(D,I,L,H);
this.hide()
}}},cancel:CQ.Dialog.CANCEL}};
var B=CQ.WCM.getDialog(G);
B.show()
};
CQ.wcm.SiteAdmin.internalCreateFolder=function(E,C,H,G){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
A.mask();
if(G=="name"){C=CQ.Ext.form.VTypes.makeName(C)
}else{C=CQ.Ext.form.VTypes.makeItemname(C)
}var B=E.getPath();
var D=(/\/etc\/packages(\/.*)?/.test(B));
var F={"./jcr:primaryType":"sling:OrderedFolder","./jcr:content/jcr:primaryType":"nt:unstructured",_charset_:"utf-8"};
if(H){F["./jcr:content/jcr:title"]=H
}if(D){F={_charset_:"utf-8",name:C,cmd:"createFolder"};
if(H){F.title=H
}C=""
}CQ.HTTP.post(CQ.shared.HTTP.encodePath(B+"/"+C),function(K,M,J){if(M){var I=E.getOwnerTree();
if(E!=I.getRootNode()){var L=E.getPath();
E.parentNode.reload(function(){I.selectPath(L,null,function(O,N){if(O){N.expand()
}})
})
}else{I.getRootNode().reload();
CQ.Ext.getCmp(window.CQ_SiteAdmin_id).reloadPages()
}}else{A.unmask()
}},F)
};
CQ.wcm.SiteAdmin.uploadFiles=function(){var I=CQ.Ext.getCmp(this.id+"-tree");
var G=this;
var C;
try{C=I.getSelectionModel().getSelectedNode()
}catch(D){}if(!C){return 
}var H=C.getPath();
var E=H;
var A=40;
if(E.length>A){var B=H.indexOf("/",H.length-A);
E='<span qtip="'+CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSValue(H))+'">...'+CQ.shared.XSS.getXSSValue(H.substring(B!=-1?B:H.lastIndexOf("/")))+"</span>"
}else{E=CQ.shared.XSS.getXSSValue(E)
}var F=CQ.WCM.getDialogConfig("/libs/wcm/core/content/tools/uploaddialog");
F.displayPath=E,F.admin=G,F.destinationPath=H.replace("/content/dam","/var/dam"),F.uploadPath="/tmp/fileupload",CQ.WCM.getDialog(F).show()
};
CQ.wcm.SiteAdmin.createPackage=function(){var B=CQ.Ext.getCmp(this.id+"-tree");
var A=this;
var D;
try{D=B.getSelectionModel().getSelectedNode()
}catch(F){}if(!D){return 
}var E=D.getPath();
var H=E.substring(14);
var G={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("New Package"),formUrl:CQ.HTTP.externalize("/etc/packages"),params:{cmd:"create"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",name:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Package Name"),name:"packageName",allowBlank:false},group:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Group Name"),name:"groupName",value:H},version:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Version"),name:"packageVersion"}}}};
var C=CQ.WCM.getDialog(G);
C.failure=function(K,I){var J=I.result.Message;
if(J.indexOf("javax.jcr.AccessDeniedException")>=0){J=CQ.I18n.getMessage("Unable to create package: Insufficient access rights.")
}else{J=CQ.I18n.getVarMessage(J)
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),J)
};
C.success=function(M,J){var L=J.result.Path;
var I=L.lastIndexOf("/");
var K=L.substring(0,I);
if(D.getPath()==K){A.reloadPages()
}D.reload(function(){B.selectPath(K,null,function(O,N){if(O){N.expand()
}})
})
};
C.show()
};
CQ.wcm.SiteAdmin.download=function(){try{var D=this.getSelectedPages();
var F=[];
for(var C=0;
C<D.length;
C++){if(D[C].get("type")!="dam:Asset"){continue
}F.push(CQ.HTTP.encodePath(D[C].id))
}var A=F.length>1?"CQ5 "+new Date().format("d-M-Y H.i")+" ("+F.length+" assets).zip":F[0].substring(F[0].lastIndexOf("/")+1)+".zip";
var B=CQ.HTTP.externalize(F[0]+".assetdownload.zip/"+A);
if(F.length>1){B=CQ.HTTP.addParameter(B,"path",F)
}B=CQ.HTTP.addParameter(B,"_charset_","utf-8");
window.open(B,"AssetDownloadWindow")
}catch(E){}};
CQ.wcm.SiteAdmin.doSearch=function(){try{var A=CQ.Ext.getCmp(window.CQ_SiteAdminSearch_id);
if(A){A.performSearch()
}}catch(B){}};
CQ.wcm.SiteAdmin.canDoFolderOp=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var B=A.getType(this.path);
if(B&&(/.*\:.*[F|f]older/.test(B)||B=="nt:unstructured")){return true
}if(B=="cq/packaging/components/manager"){return true
}}return false
};
CQ.wcm.SiteAdmin.canUploadFile=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var B=A.getType(this.path);
if(B&&(/.*\:.*[F|f]older/.test(B)||B=="nt:unstructured")){return true
}}return false
};
CQ.wcm.SiteAdmin.canCreatePackage=function(){return this.path.indexOf("/etc/packages")==0
};
CQ.wcm.SiteAdmin.canDeleteReplicatedPage=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var D=A.getSelectedPages();
if(D.length>0){var B=CQ.User.getCurrentUser();
for(var C=0;
C<D.length;
C++){var E=D[C].id;
if(CQ.wcm.SiteAdmin.isReplicatedPage(D[C])&&!B.hasPermissionOn("replicate",E)){return false
}}return true
}}return false
};
CQ.wcm.SiteAdmin.isFolder=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var B=A.getType(this.path);
if(B&&/.*\:.*[F|f]older/.test(B)){return true
}}return false
};
CQ.wcm.SiteAdmin.noFolder=function(){return !CQ.wcm.SiteAdmin.canDoFolderOp.call(this)
};
CQ.wcm.SiteAdmin.hasAnySelection=function(){return CQ.wcm.SiteAdmin.hasListSelection()||CQ.wcm.SiteAdmin.hasTreeSelection()
};
CQ.wcm.SiteAdmin.hasSingleSelection=function(){var A=CQ.wcm.SiteAdmin.getActiveGrid();
if(A){var B=A.getSelectionModel().getSelections();
return B.length==1||(B.length==0&&CQ.wcm.SiteAdmin.hasTreeSelection())
}return false
};
CQ.wcm.SiteAdmin.hasListSelection=function(){var A=CQ.wcm.SiteAdmin.getActiveGrid();
if(A){var B=A.getSelectionModel().getSelections();
return B.length>0
}return false
};
CQ.wcm.SiteAdmin.hasSingleListSelection=function(){var A=CQ.wcm.SiteAdmin.getActiveGrid();
if(A){var B=A.getSelectionModel().getSelections();
return B.length==1
}return false
};
CQ.wcm.SiteAdmin.hasTreeSelection=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree");
if(A){var B=A.getSelectionModel().getSelectedNode();
return B!=null
}};
CQ.wcm.SiteAdmin.canPaste=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){return A.hasClipboardSelection()
}};
CQ.wcm.SiteAdmin.isAsset=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var C=A.getSelectedPages();
for(var B=0;
B<C.length;
B++){try{if(C[B].get("type")=="dam:Asset"){return true
}}catch(D){}}return false
}};
CQ.wcm.SiteAdmin.noAsset=function(){return !CQ.wcm.SiteAdmin.isAsset()
};
CQ.wcm.SiteAdmin.isPage=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var C=A.getSelectedPages();
for(var B=0;
B<C.length;
B++){try{if(C[B].get("type")=="cq:Page"){return true
}}catch(D){}}return false
}};
CQ.wcm.SiteAdmin.isReplicatedPage=function(A){if(A){var B=A.get("replication");
if(B&&B.published){return B.action=="ACTIVATE"
}}return false
};
CQ.wcm.SiteAdmin.isLiveCopySource=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var C=A.getSelectedPages();
for(var B=0;
B<C.length;
B++){try{if(C[B].get(CQ.wcm.msm.MSM.PARAM_IS_SOURCE)){return true
}}catch(D){}}return false
}};
CQ.wcm.SiteAdmin.getAnyTarget=function(){return CQ.wcm.SiteAdmin.getTargetFromList()||CQ.wcm.SiteAdmin.getTargetFromTree()
};
CQ.wcm.SiteAdmin.getSingleTarget=function(){if(CQ.wcm.SiteAdmin.hasListSelection()){if(!CQ.wcm.SiteAdmin.hasSingleListSelection()){return null
}else{return CQ.wcm.SiteAdmin.getTargetFromList()
}}else{return CQ.wcm.SiteAdmin.getTargetFromTree()
}};
CQ.wcm.SiteAdmin.getTargetFromList=function(){if(CQ.wcm.SiteAdmin.hasListSelection()){var A=CQ.wcm.SiteAdmin.getActiveGrid();
if(A){var B=A.getSelectionModel().getSelections();
return B[0].id
}}return null
};
CQ.wcm.SiteAdmin.getTargetFromTree=function(){if(CQ.wcm.SiteAdmin.hasTreeSelection()){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){return A.getCurrentPath()
}}return null
};
CQ.wcm.SiteAdmin.getParentPath=function(A){return A.substring(0,A.lastIndexOf("/"))
};
CQ.wcm.SiteAdmin.getActiveGrid=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-grid");
var C=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(C){var B=CQ.Ext.getCmp(C.getActiveTab().id+"-grid");
if(B){A=B
}}return A
};
CQ.wcm.SiteAdmin.checkFolder=function(B){var A=CQ.HTTP.get(B).status;
if(A=="404"){var C=CQ.wcm.SiteAdmin.getParentPath(B);
CQ.wcm.SiteAdmin.checkFolder(C);
var D={"./jcr:primaryType":"nt:folder"};
CQ.HTTP.post(B,undefined,D)
}};
CQ.wcm.SiteAdmin.scheduleForActivation=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var C={"jcr:primaryType":"cq:Dialog",height:240,title:CQ.I18n.getMessage("Activate Later"),id:CQ.Util.createId("cq-activate-later-dialog"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",absTime:{xtype:"datetime",fieldLabel:CQ.I18n.getMessage("Activation Date"),name:"absTime",defaultValue:"now"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("OK"),cls:"cq-btn-create",handler:function(){A.mask();
var I=this;
if(CQ.Ext.isIE){this.getField("absTime").onBlur()
}var G=this.getField("absTime").getValue();
var E=A.getSelectedPages();
var H=[];
for(var D=0;
D<E.length;
D++){H.push(E[D].id)
}if(CQ.wcm.SiteAdmin.noAsset()){var F={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:H,callback:function(J){CQ.wcm.SiteAdmin.internalScheduleForActivation.call(A,G,J);
I.hide()
}};
new CQ.wcm.AssetReferenceSearchDialog(F)
}else{CQ.wcm.SiteAdmin.internalScheduleForActivation.call(A,G,H);
this.hide()
}}},cancel:CQ.Dialog.CANCEL}};
var B=CQ.WCM.getDialog(C);
B.show()
};
CQ.wcm.SiteAdmin.internalScheduleForActivation=function(B,D){var A=this;
var C={model:"/etc/workflow/models/scheduled_activation/jcr:content/model",absoluteTime:B?B.getTime():new Date().getTime(),payload:D,payloadType:"JCR_PATH"};
CQ.HTTP.post("/etc/workflow/instances",function(F,G,E){if(!G){A.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not schedule page for activation."))
}else{A.reloadPages()
}},C)
};
CQ.wcm.SiteAdmin.scheduleForDeactivation=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var C={"jcr:primaryType":"cq:Dialog",height:240,title:CQ.I18n.getMessage("Deactivate Later"),id:CQ.Util.createId("cq-deactivate-later-dialog"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",absTime:{xtype:"datetime",fieldLabel:CQ.I18n.getMessage("Deactivation Date"),name:"absTime",defaultValue:"now"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("OK"),cls:"cq-btn-create",handler:function(){A.mask();
if(CQ.Ext.isIE){this.getField("absTime").onBlur()
}var D=this.getField("absTime").getValue();
var E={model:"/etc/workflow/models/scheduled_deactivation/jcr:content/model",absoluteTime:D.getTime(),payload:CQ.wcm.SiteAdmin.getTargetFromList(),payloadType:"JCR_PATH"};
CQ.HTTP.post("/etc/workflow/instances",function(G,H,F){if(!H){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not schedule page for deactivation."))
}else{A.reloadPages()
}},E);
this.hide()
}},cancel:CQ.Dialog.CANCEL}};
var B=CQ.WCM.getDialog(C);
B.show()
};
CQ.wcm.SiteAdmin.notLocked=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var F=A.getSelectedPages();
for(var D=0;
D<F.length;
D++){try{var E=F[D];
if(typeof (E.data)!=="undefined"&&E.data!=null){var C=E.data.lockedBy;
var B=CQ.User.getUserID();
if(C.length>0&&C!=B){return false
}}}catch(G){}}return true
}};
CQ.wcm.SiteAdmin.lockable=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var E=A.getSelectedPages();
for(var C=0;
C<E.length;
C++){try{var D=E[C];
if(typeof (D.data)!=="undefined"&&D.data!=null){var B=D.data.lockedBy;
if(B.length==0){return true
}}}catch(F){}}}return false
};
CQ.wcm.SiteAdmin.unlockable=function(){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(A){var F=A.getSelectedPages();
var C=CQ.User.getUserID();
for(var D=0;
D<F.length;
D++){try{var E=F[D];
if(typeof (E.data)!=="undefined"&&E.data!=null){var B=E.data.lockedBy;
if(B.length>0&&B==C){return true
}}}catch(G){}}}return false
};
CQ.wcm.DamAdmin={};
CQ.wcm.DamAdmin.openPages=function(){var C=this.getSelectedPages();
var A=CQ.HTTP.externalize("/bin/wcmcommand")+"?cmd=open";
A+="&_charset_=utf-8";
for(var B=0;
B<C.length;
B++){A=CQ.HTTP.addParameter(A,"path",C[B].id)
}CQ.shared.Util.open(A,null,"AssetEditorWindow")
};
CQ.wcm.DamAdmin.openAsset=function(path,record){var tabPanel=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(tabPanel){var id=CQ.DOM.encodeId(path);
var editor=CQ.Ext.getCmp(id);
var locked=false;
var locker=record.data.lockedBy;
var currentUserID=CQ.User.getUserID();
if(locker.length>0&&locker!=currentUserID){locked=true
}if(!editor){var title=record?record.get("title"):"";
var mime=record?record.get("mime"):"";
var suffix="";
if(mime){for(var i=0;
i<mime.length;
i++){var c=mime.charCodeAt(i);
if(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){suffix+=mime.charAt(i)
}else{suffix+="/"
}}}if(suffix!=""){suffix="/"+suffix+".json"
}var json=CQ.HTTP.eval("/libs/dam/content/asseteditors/asseteditor.overlay.infinity.json"+suffix);
if(!json.formItems){json.formItems=CQ.HTTP.eval("/libs/dam/content/asseteditors/formitems.overlay.infinity.json"+suffix)
}var config=CQ.Util.formatData(json);
config=CQ.utils.Util.applyDefaults(config,{xtype:"asseteditor",contentPath:"/jcr:content/metadata",assetInfo:{width:record?record.get("width"):0,height:record?record.get("height"):0,size:record?record.get("size"):0,lastModified:record?record.get("lastModified"):0,title:title?title:"",mime:mime?mime:""},readOnly:locked});
config.id=id;
config.path=path;
config.title=undefined;
editor=CQ.Util.build(config,true);
tabPanel.add(editor)
}tabPanel.setActiveTab(editor);
if(locked){var msg=CQ.I18n.getMessage("Locked");
var description=CQ.I18n.getMessage("This asset is currently locked by {0}",[locker]);
CQ.Notification.notify(msg,description,10)
}}};
CQ.wcm.DamAdmin.internalDeleteAsset=function(B){var C=this.getSelectedPages();
var L=CQ.Ext.getCmp(this.id+"-tree");
var G=CQ.Ext.getCmp(this.id+"-grid");
var K=[];
var A=[];
for(var F=0;
F<C.length;
F++){var H=C[F];
K.push(H.id);
var J=H.id.split("/");
var D=L.getRootNode();
var I=D.getPath().split("/");
for(var E=I.length;
E<J.length;
E++){D=D.findChild("name",J[E])
}if(D){A.push(D)
}}CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:function(V,T,U){var N=CQ.HTTP.buildPostResponseFromHTML(U.responseText);
var O=N.headers[CQ.utils.HTTP.HEADER_STATUS];
if(O==200){for(var P=0;
P<C.length;
P++){var M=CQ.DOM.encodeId(C[P].id);
var Q=CQ.Ext.getCmp(M);
if(Q){var S=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
S.remove(Q)
}G.getStore().remove(C[P])
}for(var P=0;
P<A.length;
P++){try{A[P].remove()
}catch(R){}}}else{if(O==412){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Asset"),msg:CQ.I18n.getMessage("One or more selected assets are referenced. Click 'yes' to proceed deleting the assets, click 'no' to review the references or 'cancel' to cancel the operation."),buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(W){if(W=="yes"){CQ.wcm.DamAdmin.internalDeleteAsset.call(this,true)
}else{if(W=="no"){CQ.wcm.SiteAdmin.showReferences.call(this)
}}},scope:this})
}}},params:{path:K,_charset_:"utf-8",cmd:"deletePage",force:B},scope:this})
};
CQ.wcm.DamAdmin.deleteAsset=function(){var D=this.getSelectedPages();
var F;
if(D.length==1&&D[0].get("type")!="dam:Asset"){F=CQ.I18n.getMessage("You are going to delete the following folder including all assets inside:")
}else{F=(D.length>1)?CQ.I18n.getMessage("You are going to delete the following assets:"):CQ.I18n.getMessage("You are going to delete the following asset:")
}F+="<br/><br/>";
var A=7;
for(var B=0;
B<D.length;
B++){if(B==A){F+=CQ.I18n.getMessage("(and {0} more...)",[D.length-B],"assets to delete")+"<br/>";
break
}var C=D[B].get("label");
F+=C+"<br/>"
}F+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var E=(D.length>1)?CQ.I18n.getMessage("Delete Assets"):CQ.I18n.getMessage("Delete Asset");
CQ.Ext.Msg.show({title:E,msg:F,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(G){if(G=="yes"){CQ.wcm.DamAdmin.internalDeleteAsset.call(this,false)
}},scope:this})
};
CQ.wcm.DamAdmin.createFolder=function(B,A){CQ.wcm.SiteAdmin.createFolder.call(this,B,A,"name")
};
CQ.wcm.EditBase={actions:null,editText:null,deleteText:null,insertText:null,copyText:null,pasteText:null,referenceText:null,params:{},dialog:null,element:null,path:null,insertBehavior:null,lastAction:null,dialogs:null,orderable:true,targetMode:null,componentPath:null,dropTarget:null,isDropTarget:null,componentDropTarget:null,elementDropTarget:null,subDropTargets:null,dragZoneClass:null,dropTargetClass:null,inlineEditing:null,inplaceEditing:null,isContained:null,isContainer:false,containerClass:null,IEScriptInsert:"&nbsp;",clsPath:null,cellSearchPath:null,cell:null,isInplaceEdited:false,inplaceEditor:null,isInplaceEditClickHandled:false,annotations:null,selectionHandlers:null,clipboardHandlers:null,constructor:function(){},constructorStart:function(A){this.actions=[];
this.dialogs={};
this.annotations={};
this.selectionHandlers=[];
this.clipboardHandlers=[];
this.initRefreshShortcuts();
this.initI18n(A);
this.params=A.params;
this.inheritConfig(A);
this.listenersChecker(A)
},constructorEnd:function(A){if(A.isContainer){this.updateComponentList()
}},initComponentEnd:function(){var A=CQ.WCM.getPageInfo(CQ.WCM.getPagePath());
if(A.annotations&&A.annotations.indexOf(this.path)!=-1){this.loadAnnotations()
}},loadAnnotations:function(){var editComponent=this;
var id=this.id;
CQ.HTTP.get(this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON,function(options,success,response){var data=CQ.HTTP.eval(response);
if(success){for(var name in data){if(name=="jcr:primaryType"){continue
}var a=data[name];
if(!a){return 
}editComponent.addAnnotation({text:a.text,lastModified:a["jcr:lastModified"],lastModifiedBy:a["jcr:lastModifiedBy"],offsetX:a.x,offsetY:a.y,width:a.w,height:a.h,minimized:a.minimized,color:a.color,sketches:a.sketches?a.sketches:{}},name)
}}})
},hasAnnotations:function(){for(var A in this.annotations){return true
}return false
},addAnnotation:function(C,B){if(!B){B=""
}var D=CQ.Util.createId();
C=CQ.Util.applyDefaults(C,{path:this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+"/"+B,editComponent:this,id:D});
var A=new CQ.wcm.Annotation(C);
this.annotations[D]=A;
A.show(B=="")
},removeAnnotation:function(A){this.annotations[A].destroy();
delete this.annotations[A]
},removeAnnotations:function(){for(var A in this.annotations){this.removeAnnotation(A)
}},showAnnotations:function(){for(var A in this.annotations){this.annotations[A].show()
}},hideAnnotations:function(){for(var A in this.annotations){this.annotations[A].hide()
}},alignAnnotations:function(){for(var B in this.annotations){var A=this.annotations[B];
A.align()
}},observeElementPosition:function(){var A=this.element.getXY();
if(!CQ.Util.isEqualPosition(A,this.formerXY,1)){if(!this.elementHidden){this.alignAnnotations()
}}this.formerXY=A
},getEditConfig:function(){var A=this;
return{text:this.editText,handler:function(){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.EDIT)
},listeners:{render:function(D){var E=this;
var C=CQ.WCM.getSelection();
if(C.getCount()>1&&C.contains(E)){D.disable()
}var B=function(){var F=CQ.WCM.getSelection();
if(F.getCount()>1&&F.contains(E)){D.disable()
}else{D.enable()
}};
CQ.WCM.onSelectionChange(B);
A.selectionHandlers.push(B)
}}}
},getDeleteConfig:function(){return{text:this.deleteText,handler:function(){this.removeParagraph()
}}
},getInsertConfig:function(){var A=this;
return{text:this.insertText,handler:function(B){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.INSERT)
},listeners:{render:function(D){var E=this;
var C=CQ.WCM.getSelection();
if(C.getCount()>1&&C.contains(E)){D.disable()
}var B=function(){var F=CQ.WCM.getSelection();
if(F.getCount()>1&&F.contains(E)){D.disable()
}else{D.enable()
}};
CQ.WCM.onSelectionChange(B);
A.selectionHandlers.push(B)
}}}
},removeSelectionListeners:function(){for(var A=0;
A<this.selectionHandlers.length;
A++){CQ.WCM.unSelectionChange(this.selectionHandlers[A])
}},removeClipboardListeners:function(){for(var A=0;
A<this.clipboardHandlers.length;
A++){CQ.WCM.unClipboardChange(this.clipboardHandlers[A])
}},getCopyMoveConfig:function(){return[{text:this.cutText,handler:function(){var A=CQ.WCM.getSelectedItems();
if(A.length==0){A.push(this)
}CQ.WCM.cut(A)
}},{text:this.copyText,handler:function(){var A=CQ.WCM.getSelectedItems();
if(A.length==0){A.push(this)
}CQ.WCM.copy(A)
}},this.getPasteConfig()]
},getPasteConfig:function(){var A=this;
return{text:this.pasteText,handler:function(){var B=CQ.WCM.paste();
while(B.length>0){var C=B.shift();
if(C.action!=CQ.WCM.ACTION_CUT){this.copyParagraph(C.path,C.resourceType,C.hasAnnotations)
}else{this.moveParagraph(C.path,C.resourceType,C.hasAnnotations)
}}},listeners:{render:function(D){var C=CQ.WCM.getClipboard();
if(!C.getCount()){D.disable()
}var B=function(){if(!C.getCount()){D.disable()
}else{D.enable()
}};
CQ.WCM.onClipboardChange(B);
A.clipboardHandlers.push(B)
}}}
},getAnnotateConfig:function(){return{text:this.annotateText,handler:function(){var A=this.getNewAnnotationOffset();
this.addAnnotation({path:this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+"/",editComponent:this,offsetX:A[0],offsetY:A[1]})
}}
},getEditDialog:function(){if(!this.dialogs[CQ.wcm.EditBase.EDIT]){if(this.dialog instanceof CQ.Dialog){this.dialogs[CQ.wcm.EditBase.EDIT]=this.dialog
}else{var A;
if(typeof this.dialog=="string"){A={url:this.dialog}
}else{A=this.dialog
}A.responseScope=this;
A.params=this.params;
A=CQ.WCM.getDialogConfig(A);
A=CQ.Util.applyDefaults(A,{title:CQ.I18n.getMessage("Edit Component"),params:{"./jcr:lastModified":"","./jcr:lastModifiedBy":""}});
if(this.enableLiveRelationship){A=CQ.Util.applyDefaults(A,{editLockMode:true,editLock:!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED],editLockDisabled:!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE],editLockDisabledTitle:CQ.I18n.getMessage("Inheritance is broken at the page or parent level")})
}if(this.element&&this.element.getWidth()>this.getInlineConfig().size&&!CQ.wcm.EditBase.isInlineDialogChildOpened(this.path)){A=CQ.Util.applyDefaults({closable:false,collapsible:false,draggable:false,header:false,hideCollapseTool:true,maximizable:false,modal:false,plain:true,resizeHandles:"s",shadow:false,shadowOffset:0,title:null,cls:this.getClsPath("cq-dialog")},A)
}this.dialogs[CQ.wcm.EditBase.EDIT]=CQ.WCM.getDialog(A,"editdialog-"+this.path)
}}this.lastAction=CQ.wcm.EditBase.ACTION_EDIT;
return this.dialogs[CQ.wcm.EditBase.EDIT]
},updateComponentList:function(){var B=CQ.utils.WCM.getComponentList(this.path);
var C=CQ.utils.WCM.getDesign(this.path);
var A=this.getCell();
var D=C.getStyleProperty(A,"components");
if(!D){D=[]
}this.fireEvent(CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST,A,D,B);
B.update(A,D)
},getInlineConfig:function(){var active=true;
var size=CQ.themes.wcm.EditBase.INLINE_MINIMUM_WIDTH;
if(this.inlineEditing){if(typeof this.inlineEditing=="string"){if(isNaN(this.inlineEditing)){if(typeof this.inlineEditing=="string"&&this.inlineEditing.indexOf("CQ.wcm.EditBase")==0){try{this.inlineEditing=eval(this.inlineEditing)
}catch(error){}}if(this.inlineEditing==CQ.wcm.EditBase.INLINE_MODE_NEVER){active=false;
size=Number.MAX_VALUE
}else{if(this.inlineEditing==CQ.wcm.EditBase.INLINE_MODE_FORCED){active=true;
size=0
}}}else{active=true;
size=parseInt(this.inlineEditing)
}}else{if(typeof this.inlineEditing=="number"){active=true;
size=this.inlineEditing
}}}return{active:active,size:size}
},getInsertDialog:function(){if(!this.dialogs[CQ.wcm.EditBase.INSERT]){var C=new CQ.Ext.Panel({border:false,autoScroll:true,layout:"accordion",cls:"cq-sidekick-buttons"});
var D={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Insert New Component"),items:C,width:CQ.themes.wcm.EditBase.INSERT_DIALOG_WIDTH,cls:"cq-insertdialog "+this.getClsPath("cq-insertdialog")};
this.dialogs[CQ.wcm.EditBase.INSERT]=CQ.WCM.getDialog(D,"insertdialog-"+this.path);
var B=this;
this.dialogs[CQ.wcm.EditBase.INSERT].ok=function(){B.submitInsertDialog()
};
this.dialogs[CQ.wcm.EditBase.INSERT].buttons[0].disable();
var A=CQ.WCM.getComponentList(this.path);
CQ.wcm.ComponentList.loadPanel(A,C,this)
}else{this.selectInsertComponent(null)
}this.lastAction=CQ.wcm.EditBase.ACTION_INSERT;
return this.dialogs[CQ.wcm.EditBase.INSERT]
},selectInsertComponent:function(A){if(A==null){var B=this.dialogs[CQ.wcm.EditBase.INSERT].findByType("dataview");
for(var C=0;
C<B.length;
C++){B[C].clearSelections()
}this.dialogs[CQ.wcm.EditBase.INSERT].buttons[0].disable();
this.insertComponentRecord=null
}else{this.insertComponentRecord=CQ.Util.copyObject(A);
this.dialogs[CQ.wcm.EditBase.INSERT].buttons[0].enable()
}},submitInsertDialog:function(){if(!this.insertDialogMask){this.insertDialogMask=new CQ.Ext.LoadMask(this.dialogs[CQ.wcm.EditBase.INSERT].getEl(),{msg:CQ.wcm.EditBase.INSERTING_PARAGRAPH})
}this.insertDialogMask.show();
var B=this;
var A=this.insertComponentRecord.data;
A.insertBehavior=this.insertBehavior;
window.setTimeout(function(){B.createParagraph(A);
B.dialogs[CQ.wcm.EditBase.INSERT].hide();
B.insertDialogMask.hide()
},1)
},getParent:function(B){var C=B&&B.path?B.path:this.path;
var A;
if(C.lastIndexOf("/")!=-1){A=C.substring(0,C.lastIndexOf("/"))
}if(A){return CQ.WCM.getEditable(A)
}else{return null
}},getParentPath:function(){var A;
if(this.path&&this.path.lastIndexOf("/")!=-1){A=this.path.substring(0,this.path.lastIndexOf("/"))
}return A
},getResourceType:function(){if(this.initialConfig&&this.initialConfig.params&&this.initialConfig.params["./sling:resourceType"]){return this.initialConfig.params["./sling:resourceType"]
}else{return""
}},getResourceSuperType:function(){if(this.initialConfig&&this.initialConfig.params&&this.initialConfig.params["./sling:resourceSuperType"]){return this.initialConfig.params["./sling:resourceSuperType"]
}else{return""
}},inheritConfig:function(A,B){if(!B){B=this.getParent(A)
}if(!B||!B.childConfig){return A
}return CQ.Ext.applyIf(A,B.childConfig)
},listenersChecker:function(config){if(config&&config.listeners){for(var event in config.listeners){var listener=config.listeners[event];
if(listener&&typeof listener=="string"){delete config.listeners[event];
if(this.REFRESH_SHORTCUTS[listener]){config.listeners[event]=this.REFRESH_SHORTCUTS[listener]
}else{try{eval("config.listeners[event] = "+listener)
}catch(err){}}}}}return config
},getDropTargets:function(){var A=[];
try{for(var B=0;
B<this.subDropTargets.length;
B++){A.push(this.subDropTargets[B])
}}catch(C){}if(this.elementDropTarget){A.push(this.elementDropTarget)
}if(this.componentDropTarget&&this.componentDropTarget!=this.elementDropTarget){A.push(this.componentDropTarget)
}return A
},insertBefore:function(B){if(this.isContained){var A=this.element.parent();
A.insertBefore(B)
}else{if(this.placeholder){this.placeholder.insertBefore(B)
}this.element.insertBefore(B)
}},refresh:function(D){if(this.deleted){if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var C=this;
this.element.hide({callback:function(){if(C.isContained){C.element.parent().remove()
}if(C.remove){C.remove()
}}});
CQ.Util.runComponentObservation();
return 
}if(!D){D=this.path+CQ.HTTP.EXTENSION_HTML
}D=CQ.HTTP.noCaching(D);
if(this.hideHighlight){CQ.wcm.EditRollover.preventNextHighlight=true;
this.hideHighlight()
}var B=CQ.HTTP.get(D);
if(CQ.HTTP.isOk(B)){var A=B.body;
CQ.utils.WCM.startMakeEditablesQueue();
this.replaceElement(A);
if(this.refreshComponent){this.refreshComponent()
}if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}CQ.utils.WCM.endMakeEditablesQueue();
CQ.Util.runComponentObservation()
}},replaceElement:function(F){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.remove()
}}this.removeSubDropTargets();
var D=false;
try{this.element.update(F,CQ.Ext.isIE)
}catch(E){D=true
}if(!CQ.Ext.isIE){CQ.DOM.executeScripts(this.element)
}this.buildSubDropTargets();
if(D){CQ.shared.Util.reload()
}this.element.show()
},failure:function(B,A){if(A.failureType=="client"){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Unknown Error"))
}else{CQ.Ext.Msg.alert(A.response.status,A.response.responseText)
}},success:function(G,A){var E=G.findField("oldCqCssClass");
var H=G.findField("./cq:cssClass");
if(this.lastAction==CQ.wcm.EditBase.ACTION_INSERT||this.path.substring(this.path.length-2)=="/*"){var F=G.findField("./sling:resourceType").getValue();
var B=A.result.Path;
if(F&&B){var D=CQ.WCM.getComponentConfig(F);
if(B&&D){var C=B+".html";
this.listenersChecker(D.config);
this.updateCqCssClass(E?E.getValue():"",H?H.getValue():"");
if(D.config&&D.config.listeners&&D.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT]){D.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT].call(this,B,D)
}else{this.refreshCreated(B,D)
}}else{this.refreshPage()
}}else{this.refreshPage()
}}else{this.updateCqCssClass(E?E.getValue():"",H?H.getValue():"");
this.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_EDIT,this)
}},updateCqCssClass:function(A,B){if(A==B){return 
}if(A){this.element.removeClass(A.split(" "))
}if(B){this.element.addClass(B.split(" "))
}},initI18n:function(A){this.editText=A.editText?A.editText:CQ.I18n.getMessage("Edit");
this.deleteText=A.deleteText?A.deleteText:CQ.I18n.getMessage("Delete");
this.insertText=A.insertText?A.insertText:CQ.I18n.getMessage("New...");
this.cutText=A.copyText?A.copyText:CQ.I18n.getMessage("Cut");
this.copyText=A.copyText?A.copyText:CQ.I18n.getMessage("Copy");
this.pasteText=A.pasteText?A.pasteText:CQ.I18n.getMessage("Paste");
this.referenceText=A.referenceText?A.referenceText:CQ.I18n.getMessage("Refer");
this.annotateText=A.annotateText?A.annotateText:CQ.I18n.getMessage("Annotate")
},applyConfigDefaults:function(config,defaults){config=CQ.Util.applyDefaults(config,defaults);
var container=config[config.container];
var ctrlDef=config[config.ctrlDef];
if(config.actions){var finalActionArray=[];
if(typeof config.actions=="string"){config.actions=[config.actions]
}container.items=[];
for(var i=0;
i<config.actions.length;
i++){var anActionConfig=config.actions[i];
var actionArray=[];
if(anActionConfig instanceof Array||CQ.Ext.isArray(anActionConfig)){actionArray=anActionConfig
}else{actionArray=[anActionConfig]
}for(var j=0;
j<actionArray.length;
j++){var currentAction=actionArray[j];
if(typeof currentAction=="string"&&currentAction.indexOf("CQ.wcm.EditBase")==0){try{currentAction=eval(currentAction)
}catch(error){}}finalActionArray.push(currentAction);
if(typeof currentAction=="string"){if(currentAction==CQ.wcm.EditBase.EDIT){var editButton=this.getEditConfig();
editButton=CQ.Util.applyDefaults(editButton,ctrlDef);
container.items.push(editButton)
}else{if(currentAction==CQ.wcm.EditBase.DELETE){var deleteButton=this.getDeleteConfig();
deleteButton=CQ.Util.applyDefaults(deleteButton,ctrlDef);
container.items.push(deleteButton)
}else{if(currentAction==CQ.wcm.EditBase.INSERT){var insertButton=this.getInsertConfig();
insertButton=CQ.Util.applyDefaults(insertButton,ctrlDef);
container.items.push(insertButton);
if(config.actions.indexOf(CQ.wcm.EditBase.COPYMOVE)==-1){var pasteButton=this.getPasteConfig();
pasteButton=CQ.Util.applyDefaults(pasteButton,ctrlDef);
container.items.push(pasteButton)
}}else{if(currentAction==CQ.wcm.EditBase.COPYMOVE){var cfg=this.getCopyMoveConfig();
container.items.push(CQ.Util.applyDefaults(cfg[0],ctrlDef));
container.items.push(CQ.Util.applyDefaults(cfg[1],ctrlDef));
container.items.push(CQ.Util.applyDefaults(cfg[2],ctrlDef))
}else{if(currentAction==CQ.wcm.EditBase.ANNOTATE){var annotateButton=this.getAnnotateConfig();
annotateButton=CQ.Util.applyDefaults(annotateButton,ctrlDef);
container.items.push(annotateButton)
}else{if(this.convertAction){var converted=this.convertAction(currentAction);
if(converted&&converted!=""){container.items.push(converted)
}}else{container.items.push(currentAction)
}}}}}}}else{var button=this.convertAction(currentAction);
if(button!=null){if(typeof button=="string"&&button!=""){container.items.push(button)
}else{if(typeof (button.handler)=="string"){try{button.handler=eval(button.handler);
button=CQ.Util.applyDefaults(button,ctrlDef);
container.items.push(button)
}catch(err){}}else{button=CQ.Util.applyDefaults(button,ctrlDef);
container.items.push(button)
}}}}}}delete config.actions;
config.actions=finalActionArray
}config.items=CQ.Util.applyDefaults(config.items,[container])
},showTarget:function(A){if(CQ.wcm.EditBase.hideTargetTimeout){window.clearTimeout(CQ.wcm.EditBase.hideTargetTimeout)
}if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){this.showTargetLine()
}else{this.showTargetGhost(A)
}},showTargetGhost:function(C){var F=this.element.getWidth();
var A=CQ.themes.wcm.EditBase.TARGETGHOST_HEIGHT;
if(C){A=C.getDragData().height
}if(A<1){A=CQ.themes.wcm.EditBase.TARGETGHOST_HEIGHT
}else{if(A>CQ.themes.wcm.EditBase.TARGETGHOST_MAXHEIGHT){A=CQ.themes.wcm.EditBase.TARGETGHOST_MAXHEIGHT
}}if(A<CQ.themes.wcm.EditBase.TARGETGHOST_MINHEIGHT){A=CQ.themes.wcm.EditBase.TARGETGHOST_MINHEIGHT
}var E="<div></div>";
var D=CQ.DOM.getBlockDefaultStyles();
var B=CQ.Util.applyDefaults({height:A+"px",width:F+"px"},D);
if(B.bottom){delete B.bottom
}if(!CQ.wcm.EditBase.TargetGhost.placeholder){if(this.isContained){CQ.wcm.EditBase.TargetGhost.placeholder=CQ.Ext.DomHelper.insertBefore(this.placeholder.parent(),E,true)
}else{CQ.wcm.EditBase.TargetGhost.placeholder=CQ.Ext.DomHelper.insertBefore(this.placeholder,E,true)
}CQ.wcm.EditBase.TargetGhost.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}else{if(this.isContained){CQ.wcm.EditBase.TargetGhost.placeholder.insertBefore(this.placeholder.parent())
}else{CQ.wcm.EditBase.TargetGhost.placeholder.insertBefore(this.placeholder)
}}CQ.wcm.EditBase.TargetGhost.placeholder.setStyle(B);
CQ.wcm.EditBase.TargetGhost.placeholder.addClass(["cq-editcomponent-placeholder","cq-editcomponent-ghost-placeholder"]);
CQ.wcm.EditBase.TargetGhost.placeholder.show();
CQ.wcm.EditBase.TargetGhost.render(CQ.Util.ROOT_ID);
CQ.wcm.EditBase.TargetGhost.el.setStyle("position","absolute");
CQ.wcm.EditBase.TargetGhost.el.anchorTo(CQ.wcm.EditBase.TargetGhost.placeholder,"tl",[0,0],false,null);
CQ.wcm.EditBase.TargetGhost.observe=function(){if(!this.hidden&&!CQ.Util.isEqualPosition(this.el.getXY(),this.placeholder.getXY(),0)){this.el.alignTo(this.placeholder,"tl-tl",[0,0])
}};
CQ.Util.observeComponent(CQ.wcm.EditBase.TargetGhost);
CQ.wcm.EditBase.TargetGhost.setWidth(F);
CQ.wcm.EditBase.TargetGhost.setHeight(A);
CQ.wcm.EditBase.TargetGhost.removeClass("cq-editcomponent-ghost-masking");
CQ.wcm.EditBase.TargetGhost.show();
CQ.Util.runComponentObservation()
},showTargetLine:function(){var B=0,A=0,C=0;
if(this.element&&this.element.isVisible()){B=this.element.getWidth();
A=this.element.getLeft();
C=this.element.getTop()
}if(this.placeholder){C=this.placeholder.getTop()
}C-=CQ.themes.wcm.EditBase.TARGETLINE_DISTANCE;
CQ.wcm.EditBase.TargetLine.setWidth(B);
CQ.wcm.EditBase.TargetLine.setPosition(A,C);
CQ.wcm.EditBase.TargetLine.render(CQ.Util.ROOT_ID);
CQ.wcm.EditBase.TargetLine.show()
},hideTarget:function(C){this.unmaskTarget();
var A=this;
var B=function(){if(A.targetMode&&A.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){A.hideTargetLine()
}else{A.hideTargetGhost()
}CQ.wcm.EditBase.hideTargetTimeout=null
};
if(C){CQ.wcm.EditBase.hideTargetTimeout=window.setTimeout(B,200)
}else{B.call(this)
}},maskTarget:function(A){if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){}else{this.maskTargetGhost(A)
}},unmaskTarget:function(){if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){}else{this.unmaskTargetGhost()
}},hideTargetLine:function(){CQ.wcm.EditBase.TargetLine.hide()
},hideTargetGhost:function(){CQ.wcm.EditBase.TargetGhost.hide();
if(CQ.wcm.EditBase.TargetGhost.placeholder){CQ.wcm.EditBase.TargetGhost.placeholder.hide()
}CQ.Util.cancelObservation(CQ.wcm.EditBase.TargetGhost);
CQ.Util.runComponentObservation()
},maskTargetGhost:function(A){if(CQ.wcm.EditBase.TargetGhost.el){CQ.wcm.EditBase.TargetGhost.addClass("cq-editcomponent-ghost-masking");
CQ.wcm.EditBase.TargetGhost.el.mask(A,"x-mask-loading")
}},unmaskTargetGhost:function(){if(CQ.wcm.EditBase.TargetGhost.el&&CQ.wcm.EditBase.TargetGhost.el.isMasked()){CQ.wcm.EditBase.TargetGhost.el.unmask()
}},isActionInsertOnly:function(){return(this.actions.length==1&&this.actions[0]==CQ.wcm.EditBase.INSERT)
},isActionInsert:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.INSERT)!=-1)
},isActionEdit:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.EDIT)!=-1)
},isActionDelete:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.DELETE)!=-1)
},isActionCopyMove:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.COPYMOVE)!=-1)
},isSameParent:function(A){if(A&&A.getParentPath){return(this.getParentPath()==A.getParentPath())
}return false
},equals:function(A){if(A){return(this.path==A.path)
}return false
},isInsertAllowed:function(C){if(this.isActionInsert()){var B=this.getParent();
if(B){var A=CQ.WCM.getComponentList();
return A.isAllowed(C,B.getCell())
}}return false
},buildSubDropTargets:function(){if(this.dropTarget){this.subDropTargets=new Array();
var G=0;
for(;
G<this.dropTarget.length;
G++){var A=this.dropTarget[G].id;
var E=this.dropTarget[G].accept;
var H=this.dropTarget[G].params;
if(E&&!CQ.Ext.isArray(E)){var B=new RegExp("[ ;]+","g");
E=E.split(B)
}var C=this.dropTarget[G].groups;
if(C){var D;
if(!CQ.Ext.isArray(C)){D=new Array();
D[0]=C
}else{D=C
}A=this.searchDropTargetInCSSClass(A);
if(A!=null){if(this.elementDropTarget){if(this.elementDropTarget.groups){for(var I in this.elementDropTarget.groups){if(D.indexOf(I)==-1){D.push(I)
}}}}if(D.length>0){this.subDropTargets[G]=this.dropTargetClass.getInstance(A,this,D,{propertyName:this.dropTarget[G].name});
if(E){this.subDropTargets[G].ddAccept=E
}if(H){this.subDropTargets[G].postParams=H
}}}else{if(this.elementDropTarget){var F=0;
for(;
F<D.length;
F++){this.elementDropTarget.addToGroup(D[F]);
this.componentDropTarget.addToGroup(D[F])
}if(!this.elementDropTarget.propertyName){this.elementDropTarget.propertyName=this.dropTarget[G].name
}if(!this.componentDropTarget.propertyName){this.componentDropTarget.propertyName=this.dropTarget[G].name
}if(E){this.elementDropTarget.ddAccept=E
}if(H){this.elementDropTarget.postParams=H
}}}}}}},searchDropTargetInCSSClass:function(B){if(this.element&&this.element.dom){var A=CQ.Ext.DomQuery.selectNode('*[class*="cq-dd-'+B+'"]',this.element.dom);
if(A){if(A.id){return A.id
}else{return CQ.Ext.id(A)
}}}return null
},resumeDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.unlock()
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.unlock()
}this.resumeSubDropTargets()
},suspendDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.lock()
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.lock()
}this.suspendSubDropTargets()
},resumeSubDropTargets:function(){if(this.subDropTargets){var A=0;
for(;
A<this.subDropTargets.length;
A++){this.subDropTargets[A].unlock()
}}},suspendSubDropTargets:function(){if(this.subDropTargets){var A=0;
for(;
A<this.subDropTargets.length;
A++){this.subDropTargets[A].lock()
}}},removeDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.lock();
CQ.Ext.destroy(this.componentDropTarget);
delete this.componentDropTarget
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.lock();
CQ.Ext.destroy(this.elementDropTarget);
CQ.Ext.destroy(this.componentDropTarget);
delete this.elementDropTarget;
delete this.componentDropTarget
}this.removeSubDropTargets()
},removeSubDropTargets:function(){if(this.subDropTargets){var A=0;
for(;
A<this.subDropTargets.length;
A++){this.subDropTargets[A].lock();
CQ.Ext.destroy(this.subDropTargets[A]);
this.subDropTargets.remove(A)
}}},isParentHighlighted:function(){if(CQ.wcm.EditRollover.currentlyHighlighted&&CQ.wcm.EditRollover.currentlyHighlighted.element){var B=CQ.wcm.EditRollover.currentlyHighlighted.element.dom;
var A=this.element.dom.parentNode;
while(A!=null){if(A==B){return true
}A=A.parentNode
}}return false
},isParentHighLighted:this.isParentHighlighted,getThumbnailPath:function(){if(this.componentPath){return this.componentPath+".png"
}else{var B=null;
if(this.dialog){if(typeof this.dialog=="string"){B=this.dialog
}else{B=this.dialog.url
}if(B){var A=B.lastIndexOf("/");
if(A!=-1){B=B.substring(0,B.lastIndexOf("/")+1)+"thumbnail.png"
}if(!CQ.HTTP.isOk(CQ.HTTP.get(B))){return""
}}}return B
}},getIconPath:function(){var B=null;
if(this.dialog){if(typeof this.dialog=="string"){B=this.dialog
}else{B=this.dialog.url
}if(B){var A=B.lastIndexOf("/");
if(A!=-1){B=B.substring(0,B.lastIndexOf("/")+1)+"icon.png"
}}}return B
},handleLiveRelationship:function(A){if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null&&this.liveStatus==null){if(!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]||this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED])){this.enableLiveRelationship=true;
this.liveStatusContainerMode=(A===true);
this.liveStatusLocked=!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED];
this.on(CQ.wcm.EditBase.EVENT_AFTER_MOVE,function(){var B=this.getParent();
if(B){if(B.liveStatusLocked){B.doSwitchLock()
}}},this)
}}},switchLock:function(A){CQ.Ext.Msg.confirm(this.liveStatusLocked?CQ.I18n.getMessage("Cancel inheritance"):CQ.I18n.getMessage("Revert inheritance"),this.liveStatusLocked?CQ.I18n.getMessage("Do you really want to cancel the inheritance?"):CQ.I18n.getMessage("Do you really want to revert the inheritance?"),function(B){if(B=="yes"){this.doSwitchLock(A)
}},this)
},doSwitchLock:function(B){var D={};
D[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=this.liveStatusLocked;
this.deepCancel=(this.deepCancel===true||this.deepCancel=="true");
D.deepCancel=this.deepCancel;
var E=CQ.utils.HTTP.post(this.path+".msm.conf",null,D,this);
if(CQ.utils.HTTP.isOk(E)){this.liveStatusLocked=!this.liveStatusLocked;
if(B&&B.setEditLock){B.setEditLock(this.liveStatusLocked,false,true)
}if(this.liveStatusLocked){if(this.getResourceType()=="wcm/msm/components/ghost"){if(E.headers&&E.headers.Message){var C=undefined;
if(E.headers.Message=="ghost#cleanedup"){C=CQ.I18n.getMessage("Source paragraph was not found. Paragraph was restored as it was before deletion and is now only available on local Live Copy page.")
}else{if(E.headers.Message=="ghost#deleted"){C=CQ.I18n.getMessage("Source paragraph was not found and no restore information was found. Paragraph has been deleted.")
}}if(C){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Orphaned, deleted paragaph"),C,function(){this.refreshPage()
},this)
}else{this.refreshPage()
}}}else{this.refreshPage()
}}else{var A=CQ.WCM.getNestedEditables(this.path);
if(this.deepCancel&&A.length>0){this.refreshPage()
}else{if(this.handleLiveStatus){this.handleLiveStatus();
if(B&&B.setEditLock){B.setEditLock(this.liveStatusLocked)
}}}}}},getClsPath:function(A){if(!this.clsPath){var B="jcr:content";
this.clsPath=this.path.substring(this.path.lastIndexOf(B)+B.length+1);
this.clsPath=CQ.DOM.encodeClass(this.clsPath,"")
}return A+"-"+this.clsPath
},getCell:function(){if(!this.cell&&this.cellSearchPath){this.cell=new CQ.wcm.Cell(this.cellSearchPath)
}return this.cell
},inplaceEditingOutOfAreaClick:function(){var B=window.CQ_inplaceEditComp;
var C=(window.CQ_inplaceEditDialog===true);
if(B&&!C){var A=B.isInplaceEditClickHandled;
if(A){B.isInplaceEditClickHandled=false;
return 
}B.finishInplaceEditing()
}},startInplaceEditing:function(){if(this.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,this)===false){return 
}var D=CQ.WCM.getContentFinder();
var F=(this.inplaceEditingConfig&&this.inplaceEditingConfig.active)&&(CQ.Ext.isIE||(CQ.Ext.isGecko&&!CQ.Ext.isGecko2));
if(F){var I=CQ.Util.getRoot();
var E=CQ.Ext.get(this.element);
var L=E.getXY();
var J=L[0];
var H=L[1];
var M=E.getSize();
var K=M.width;
var G=M.height;
var B=CQ.Ext.DomHelper.createDom({tag:"div",style:"position: absolute; left: "+J+"px; top: "+H+"px; width: "+K+"px; height: "+G+"px;"});
I.dom.appendChild(B);
var C=new CQ.Ext.LoadMask(CQ.Ext.get(B),{removeMask:true,rootDiv:B});
C.enable();
C.show();
if(this.inplaceEditor==null){var A=this.inplaceEditingConfig.editorType;
if(A!=null){this.inplaceEditor=CQ.ipe.InplaceEditing.create(A)
}if(this.inplaceEditor==null){this.handleInplaceEditingInitError(CQ.I18n.getMessage("There is no suitable editor registered for inline editing.<br>Please check your edit configuration."),C)
}this.inplaceEditor.loadEditorConfig(this.inplaceEditingConfig,{onSuccess:function(){this.inplaceEditor.init();
this.loadInplaceContentAsync(C)
},onFailure:function(){this.handleInplaceEditingInitError(null,C)
},scope:this})
}else{this.loadInplaceContentAsync(C)
}}},loadInplaceContentAsync:function(loadMask){var url=this.path+".0"+CQ.HTTP.EXTENSION_JSON;
CQ.HTTP.get(url,function(options,success,response){if(success){var prop=this.inplaceEditor.getProperty();
if(prop.indexOf("./")==0){prop=prop.substring(2)
}this.startInplaceEditorAsync(CQ.HTTP.eval(response)[prop]||"",loadMask)
}else{this.handleInplaceEditingInitError(CQ.I18n.getMessage("Could not load content from server."),loadMask)
}},this)
},startInplaceEditorAsync:function(B,A){if(A){A.hide();
A.rootDiv.parentNode.removeChild(A.rootDiv)
}if(this._startInplaceEditing){this._startInplaceEditing()
}this.isInplaceEdited=true;
window.CQ_inplaceEditComp=this;
this.inplaceEditor.start(this,this.element,B);
CQ.Ext.EventManager.on(document.body,"click",this.inplaceEditingOutOfAreaClick)
},handleInplaceEditingInitError:function(B,A){if(A){A.hide();
A.rootDiv.parentNode.removeChild(A.rootDiv)
}var C=((typeof (B)=="string")?B:CQ.I18n.getMessage("Could not load inplace editing configuration."));
CQ.Notification.notify(C)
},finishInplaceEditing:function(){if(this.isInplaceEdited){CQ.Ext.EventManager.un(document.body,"click",this.inplaceEditingOutOfAreaClick);
if(this._finishInplaceEditing){this._finishInplaceEditing()
}this.inplaceEditor.finish();
this.isInplaceEdited=false;
window.CQ_inplaceEditComp=null
}},cancelInplaceEditing:function(){if(this.isInplaceEdited){CQ.Ext.EventManager.un(document.body,"click",this.inplaceEditingOutOfAreaClick);
if(this._cancelInplaceEditing){this._cancelInplaceEditing()
}this.inplaceEditor.cancel();
this.isInplaceEdited=false;
window.CQ_inplaceEditComp=null
}},isInplaceEditingDropAllowed:function(A){if(this.inplaceEditor){return this.inplaceEditor.isDropAllowed(A)
}return false
},notifyInplaceEditingDrop:function(A){if(this.inplaceEditor){this.inplaceEditor.notifyDrop(A)
}},hideDialogListener:function(A){CQ.Util.cancelObservation(A);
CQ.wcm.EditBase.unRegisterInlineDialog(A);
this.showElement();
this.refreshComponent();
if(this.enableDrag){this.enableDrag()
}},hideDialogListenerToResumeDropTargets:function(A){this.resumeDropTargets()
},resizeDialogListener:function(C,B,A){this.getInlinePlaceholder().setHeight(A+this.getInlinePlaceholderInitialHeight()+CQ.themes.wcm.EditBase.INLINE_BOTTOM_PADDING)
}};
CQ.wcm.EditBase.INSERTING_PARAGRAPH=CQ.I18n.getMessage("Inserting paragraph...");
CQ.wcm.EditBase.INSERT_BEFORE="before";
CQ.wcm.EditBase.INSERT_AFTER="after";
CQ.wcm.EditBase.INSERT_LAST="";
CQ.wcm.EditBase.ACTION_EDIT="EDIT";
CQ.wcm.EditBase.ACTION_INSERT="INSERT";
CQ.wcm.EditBase.EDIT="EDIT";
CQ.wcm.EditBase.DELETE="DELETE";
CQ.wcm.EditBase.INSERT="INSERT";
CQ.wcm.EditBase.ANNOTATE="ANNOTATE";
CQ.wcm.EditBase.COPYMOVE="COPYMOVE";
CQ.wcm.EditBase.EDITDELETE=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.DELETE];
CQ.wcm.EditBase.EDITANNOTATE=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE];
CQ.wcm.EditBase.EDITANNOTATEDELETE=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.DELETE];
CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.COPYMOVE,CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITCOPYMOVEDELETEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.COPYMOVE,CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITANNOTATECOPYMOVEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.COPYMOVE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITCOPYMOVEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.COPYMOVE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITANNOTATEDELETEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITDELETEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.ANNOTATIONS="cq:annotations";
CQ.wcm.EditBase.EVENT_AFTER_INSERT="afterinsert";
CQ.wcm.EditBase.EVENT_BEFORE_MOVE="beforemove";
CQ.wcm.EditBase.EVENT_AFTER_MOVE="aftermove";
CQ.wcm.EditBase.EVENT_BEFORE_COPY="beforecopy";
CQ.wcm.EditBase.EVENT_AFTER_COPY="aftercopy";
CQ.wcm.EditBase.EVENT_BEFORE_EDIT="beforeedit";
CQ.wcm.EditBase.EVENT_AFTER_EDIT="afteredit";
CQ.wcm.EditBase.EVENT_BEFORE_DELETE="beforedelete";
CQ.wcm.EditBase.EVENT_AFTER_DELETE="afterdelete";
CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT="beforechildinsert";
CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT="afterchildinsert";
CQ.wcm.EditBase.EVENT_RENDER="render";
CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST="updatecomponentlist";
CQ.wcm.EditBase.EVENTS_LIST=[CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_RENDER,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST];
CQ.wcm.EditBase.INLINE_MODE_AUTO="auto";
CQ.wcm.EditBase.INLINE_MODE_NEVER="never";
CQ.wcm.EditBase.INLINE_MODE_FORCED="forced";
CQ.wcm.EditBase.REFERENCE_COMPONENT="foundation/components/reference";
CQ.wcm.EditBase.REFERENCE_COMPONENT_PATH_PROPERTY="./path";
CQ.wcm.EditBase.showDialog=function(F,D){if(!F){return 
}var C;
if(D&&D==CQ.wcm.EditBase.INSERT){C=F.getInsertDialog();
C.processPath(F.path)
}else{if(F.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,F)===false){return 
}C=F.getEditDialog();
C.loadContent(F.path);
if(F.enableLiveRelationship){var B=function(){F.switchLock(C)
};
C.on("beforeeditlocked",B);
C.on("beforeeditunlocked",B);
C.on("beforeshow",function(){C.editLock=this.liveStatusLocked
},F)
}if(C.hidden&&F.element&&F.element.getWidth()>F.getInlineConfig().size&&!CQ.wcm.EditBase.isInlineDialogChildOpened(F.path)){var A=F.getInlinePlaceholder();
if(A){var E=F.getInlinePlaceholderInitialHeight();
F.hideElement(true);
C.setWidth(A.getWidth());
C.anchorTo(A,"tl",[0,E],true);
C.on("resize",F.resizeDialogListener,F);
C.on("hide",F.hideDialogListener,F);
C.anchoredTo=F;
CQ.Util.observeComponent(C);
A.setHeight(C.getFrameHeight()+C.getInnerHeight()+A.getHeight()+CQ.themes.wcm.EditBase.INLINE_BOTTOM_PADDING);
if(F.disableDrag){F.disableDrag()
}CQ.wcm.EditBase.registerInlineDialog(C);
C.disableOverridePosition=true
}}}CQ.WCM.deselect();
C.show();
F.suspendDropTargets();
C.on("hide",F.hideDialogListenerToResumeDropTargets,F)
};
CQ.wcm.EditBase.buildTargetGhost=function(){return new CQ.Ext.Container({xtype:"box",autoEl:"div",cls:"cq-editcomponent-ghost",listeners:{render:function(){var B=this.getEl().dom;
if(B.addEventListener){var A=this;
B.addEventListener("dragenter",function(C){C.preventDefault();
C.stopPropagation();
if(A.currentTarget){return A.currentTarget.notifyHTML5DragEnter(C)
}},false);
B.addEventListener("dragleave",function(C){C.preventDefault();
C.stopPropagation();
var D=A.currentTarget;
if(D){A.lastTarget=D;
A.currentTarget=null;
A.isDragOver=false;
window.setTimeout(function(){if(!A.isDragOver){D.notifyHTML5DragLeave(C)
}},1);
return false
}},false);
B.addEventListener("dragover",function(C){A.isDragOver=true;
C.preventDefault();
C.stopPropagation();
if(A.currentTarget){return A.currentTarget.notifyHTML5DragOver(C)
}},false);
B.addEventListener("drop",function(C){C.preventDefault();
C.stopPropagation();
if(A.currentTarget){return A.currentTarget.notifyHTML5Drop(C)
}if(A.lastTarget){return A.lastTarget.notifyHTML5Drop(C)
}},false)
}}}})
};
CQ.wcm.EditBase.buildTargetLine=function(){var C=new CQ.Ext.Container({xtype:"box",autoEl:"div",cls:"cq-editcomponent-targetline"});
var A=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editcomponent-targetline-left"});
var B=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editcomponent-targetline-right"});
C.add(A);
C.add(B);
return C
};
CQ.wcm.EditBase.TargetLine=CQ.wcm.EditBase.buildTargetLine();
CQ.wcm.EditBase.TargetGhost=CQ.wcm.EditBase.buildTargetGhost();
CQ.wcm.EditBase.TARGET_MODE_LINE="line";
CQ.wcm.EditBase.TARGET_MODE_GHOST="ghost";
CQ.wcm.EditBase.openedInlineDialog=[];
CQ.wcm.EditBase.registerInlineDialog=function(A){if(CQ.wcm.EditBase.openedInlineDialog.indexOf(A)==-1){CQ.wcm.EditBase.openedInlineDialog.push(A)
}};
CQ.wcm.EditBase.unRegisterInlineDialog=function(A){CQ.wcm.EditBase.openedInlineDialog.remove(A)
};
CQ.wcm.EditBase.isInlineDialogChildOpened=function(C){var A=0;
for(;
A<CQ.wcm.EditBase.openedInlineDialog.length;
A++){var B=CQ.wcm.EditBase.openedInlineDialog[A].path;
if(B&&B.substring(0,C.length)==C){return true
}}return false
};
CQ.wcm.EditBase.DD_GROUP_COMPONENT="editcomponent";
CQ.wcm.EditBase.DD_GROUP_ASSET="media";
CQ.wcm.EditBase.DD_GROUP_PAGE="page";
CQ.wcm.EditBase.DD_GROUP_PARAGRAPH="paragraph";
CQ.wcm.EditBase.DD_GROUP_DEFAULT="default";
CQ.wcm.EditBase.DragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{editComponent:null,isDropCancelled:false,currentDropTarget:null,constructor:function(B,A){A=A||{};
var C=document.createElement("div");
CQ.Ext.apply(A,{ddel:C});
if(A.editComponent){this.editComponent=A.editComponent;
this.editComponent.on("destroy",function(){this.destroy()
},this)
}CQ.wcm.EditBase.DragZone.superclass.constructor.call(this,B,A)
},getDragData:function(G){if(!this._dragData){var B=CQ.WCM.getSelectedItems();
if(B.length>0&&!this.editComponent.selected){B=[]
}if(B.length==0){B.push(this.editComponent)
}var A=0;
var D=0;
for(var C=0;
C<B.length;
C++){var H=B[C];
var E=H.getEl();
if(H.element){E=H.element
}A+=E.getHeight();
if(E.getWidth()>D){D=E.getWidth()
}var F=E.getMargins("tb");
if(F&&!isNaN(F)){A+=F
}}if(A>CQ.themes.wcm.EditBase.DDPROXY_MAXHEIGHT){A=CQ.themes.wcm.EditBase.DDPROXY_MAXHEIGHT
}else{if(A<CQ.themes.wcm.EditBase.DDPROXY_MINHEIGHT){A=CQ.themes.wcm.EditBase.DDPROXY_MINHEIGHT
}}if(D>CQ.themes.wcm.EditBase.DDPROXY_MAXWIDTH){D=CQ.themes.wcm.EditBase.DDPROXY_MAXWIDTH
}else{if(D<CQ.themes.wcm.EditBase.DDPROXY_MINWIDTH){D=CQ.themes.wcm.EditBase.DDPROXY_MINWIDTH
}}this.ddel.className="cq-editcomponent-dragzone-proxy";
this.ddel.style.width=D+"px";
this.ddel.style.height=A+"px";
this.ddel.style.padding="5px";
this._dragData={ddel:this.ddel,items:B,width:D,height:A}
}return this._dragData
},clearDragData:function(){this._dragData=null
},handleOnESC:function(A){if(A.getKey()==A.ESC){this.showEditComponent();
this.isDropCancelled=true;
this.unregisterESCKeyPress();
this.clearDragData();
this.proxy.repair(this.getRepairXY(A,this.getDragData()),this.afterRepair,this);
if(this.currentDropTarget&&this.currentDropTarget.editComponent){this.currentDropTarget.editComponent.hideTarget()
}}},registerESCKeyPress:function(){if(CQ.Ext.isIE){CQ.Ext.EventManager.on(window.document,"keypress",this.handleOnESC,this)
}else{CQ.Ext.EventManager.on(window.document,"keypress",this.handleOnESC,this);
CQ.Ext.EventManager.on(CQ.WCM.getTopWindow().document,"keypress",this.handleOnESC,this)
}},unregisterESCKeyPress:function(){if(CQ.Ext.isIE){CQ.Ext.EventManager.un(window.document,"keypress",this.handleOnESC,this)
}else{CQ.Ext.EventManager.un(window.document,"keypress",this.handleOnESC,this);
CQ.Ext.EventManager.un(CQ.WCM.getTopWindow().document,"keypress",this.handleOnESC,this)
}},onInitDrag:function(A,B){CQ.wcm.EditBase.DragZone.superclass.onInitDrag.call(this,A,B);
this.isDropCancelled=false;
this.currentDropTarget=null;
this.registerESCKeyPress();
this.hideEditComponent()
},getRepairXY:function(B,A){if(!this.isDropCancelled){this.showEditComponent();
if(this.editComponent&&this.editComponent.element){return this.editComponent.element.getXY()
}else{return A.item.getXY()
}}return null
},notifyDropDT:function(A,G,E){var H=false;
this.currentDropTarget=null;
if(!this.isDropCancelled&&this.isDropAllowed(A)){var B=CQ.I18n.getMessage("Moving paragraph...");
if(I){B=CQ.I18n.getMessage("Copying paragraph...")
}A.editComponent.maskTarget(B);
this.unregisterESCKeyPress();
var I=G.ctrlKey;
var D=this.getDragData();
var E=[];
for(var F=0;
F<D.items.length;
F++){var C=D.items[F];
E.push(C)
}window.setTimeout(function(){for(var J=0;
J<E.length;
J++){var K=E[J];
if(I){A.editComponent.copyParagraph(K.path,K.getResourceType(),K.hasAnnotations())
}else{A.editComponent.moveParagraph(K.path,K.getResourceType(),K.hasAnnotations())
}A.editComponent.hideTarget();
K.showElement();
K.show()
}},1);
H=true
}this.clearDragData();
return H
},showEditComponent:function(){var B=this.getDragData();
for(var A=0;
A<B.items.length;
A++){var C=B.items[A];
C.showElement();
C.show()
}},hideEditComponent:function(){var B=this.getDragData();
for(var A=0;
A<B.items.length;
A++){var C=B.items[A];
C.hideElement();
C.hide()
}this.DDM.refreshCache(this.groups)
},notifyEnterDT:function(C,B,A){if(this.isDropAllowed(C)){this.currentDropTarget=C;
C.editComponent.showTarget(this)
}return""
},notifyOutDT:function(C,B,A){if(this.isDropAllowed(C)){this.currentDropTarget=null
}C.editComponent.hideTarget(true);
return""
},notifyOverDT:function(C,B,A){if(this.isDropAllowed(C)){this.currentDropTarget=C;
C.editComponent.showTarget(this);
return this.dropAllowed
}else{this.currentDropTarget=null;
C.editComponent.hideTarget();
return this.dropNotAllowed
}},isDropAllowed:function(A){return(!this.isDropCancelled&&CQ.Util.isIntersecting(this.groups,A.groups)&&A.editComponent&&this.editComponent&&!this.editComponent.equals(A.editComponent)&&A.editComponent.isInsertAllowed(this.editComponent.getResourceType()))
},clearGroups:function(){this.groups={}
},addToGroups:function(A){if(A instanceof Array){for(var B=0;
B<A.length;
B++){this.addToGroup(A[B])
}}else{for(var B in A){this.addToGroup(A[B])
}}}});
CQ.wcm.EditBase.DragZone.getInstance=function(D,E,B){var A=new CQ.wcm.EditBase.DragZone(D,{editComponent:E});
if(B){var C=0;
for(;
C<B.length;
C++){A.addToGroup(B[C])
}A.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return A
};
CQ.wcm.EditBase.DropTarget=CQ.Ext.extend(CQ.Ext.dd.DropTarget,{constructor:function(C,B){B=B||{};
if(B.editComponent){this.editComponent=B.editComponent;
this.editComponent.on("destroy",function(){this.destroy()
},this)
}CQ.wcm.EditBase.DropTarget.superclass.constructor.call(this,C,B);
this.highlight=new CQ.Highlight({element:this.el,cls:"cq-editbase-droptarget-highlight"});
if(this.editComponent&&window.addEventListener){var D=CQ.Ext.get(C).dom;
if(this.editComponent.emptyComponent){D=this.editComponent.emptyComponent.getEl().dom
}var A=this;
D.addEventListener("dragenter",function(E){return A.notifyHTML5DragEnter(E)
},false);
D.addEventListener("dragover",function(E){return A.notifyHTML5DragOver(E)
},false);
D.addEventListener("dragleave",function(E){return A.notifyHTML5DragLeave(E)
},false);
D.addEventListener("drop",function(E){return A.notifyHTML5Drop(E)
},false)
}},isCopyEvent:function(A){return true||A.dataTransfer.effectAllowed=="copy"
},notifyHTML5DragEnter:function(A){A.preventDefault();
A.stopPropagation();
if(this.isCopyEvent(A)){if(this.editComponent){CQ.wcm.EditBase.TargetGhost.currentTarget=this;
this.editComponent.showTarget()
}this.hideHighlight()
}else{if(CQ.wcm.EditBase.TargetGhost.currentTarget==this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.showHighlight()
}return false
},notifyHTML5DragOver:function(A){A.preventDefault();
A.stopPropagation();
if(this.isCopyEvent(A)){if(this.editComponent&&CQ.wcm.EditBase.TargetGhost.currentTarget!=this){CQ.wcm.EditBase.TargetGhost.currentTarget=this;
this.editComponent.showTarget()
}this.hideHighlight()
}else{if(CQ.wcm.EditBase.TargetGhost.currentTarget==this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.showHighlight()
}return false
},notifyHTML5DragLeave:function(A){A.preventDefault();
A.stopPropagation();
if(this.isDropping){return 
}if(CQ.wcm.EditBase.TargetGhost.currentTarget!=this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.hideHighlight();
return false
},notifyHTML5Drop:function(A){A.preventDefault();
A.stopPropagation();
if(this.editComponent){this.isDropping=true;
if(this.isCopyEvent(A)){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
this.editComponent.showTarget();
this.html5UploadFiles(A.dataTransfer.files,this.notifyFilesUploaded,this,CQ.wcm.EditBase.TargetGhost.getEl())
}else{this.flash();
this.html5UploadFiles(A.dataTransfer.files,this.notifyFilesUpdated,this,this.editComponent.getEl())
}CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}return false
},notifyFilesUploaded:function(A){var E=this.editComponent;
var D=CQ.I18n.getMessage("Inserting paragraph...");
E.maskTarget(D);
for(var B=0;
B<A.length;
B++){var C=A[B];
C.params={};
C.params[C.map.binaryProp]=C.path;
C.params[C.map.fileNameProp]=C.file.fileName
}window.setTimeout(function(){for(var F=0;
F<A.length;
F++){try{var H=A[F];
if(H.notAllowed){continue
}if(E.createParagraph(H.map.definition,H.params)==null){CQ.Notification.notify(H.file.fileName,CQ.I18n.getMessage("Failed to create paragraph with targeted component {0}{1}",["<br>",H.map.resourceType],"error message; name of the component that has been failed to insert"))
}}catch(G){}}},1);
E.hideTarget();
return false
},notifyFilesUpdated:function(A){var B=this.editComponent;
this.hideHighlight();
window.setTimeout(function(){try{B.updateParagraph("./file"+CQ.Sling.MOVE_SUFFIX,A[0].path,{})
}catch(C){CQ.Log.error(C)
}},1);
return false
},html5UploadFiles:function(C,E,A,B){var D={current:0,uploaded:0,totalSize:0,records:[],isFile:function(F){if(F.size==0){return false
}if(F.size<512&&F.type==""&&F.name.indexOf(".")<0){return false
}return true
},upload:function(J){this.records=[];
for(var H=0;
H<J.length;
H++){var G=J[H];
if(this.isFile(G)){this.totalSize+=G.fileSize;
this.records.push({file:G})
}else{CQ.Notification.notify(G.name,CQ.I18n.getMessage("It is not possible to upload folders"))
}}if(this.records.length==0){return 
}this.progress=new CQ.Ext.ProgressBar();
this.mainWin=new CQ.Ext.Window({width:400,title:"File Upload",layout:"anchor",pageX:B.getLeft(),pageY:B.getTop(),closable:false,items:[this.progress]}).show();
var F=this;
var I=new XMLHttpRequest();
I.upload.addEventListener("load",function(K){F.uploaded+=F.currentSize;
F.uploadNext()
},false);
I.upload.addEventListener("progress",function(K){F.progress.updateProgress((F.uploaded+K.loaded)/F.totalSize)
},false);
this.xhr=I;
this.uploadNext()
},finish:function(){this.mainWin.close();
this.mainWin.destroy();
delete this.mainWin;
delete this.progress;
E.call(A,this.records)
},uploadNext:function(){if(this.current>=this.records.length){this.progress.updateProgress(1);
this.finish();
return 
}var L=this.records[this.current++];
var H=L.file;
var K=null;
for(var G=0;
G<CQ.EDITBASE_DD_MIMEMAPPING.length;
G++){K=CQ.EDITBASE_DD_MIMEMAPPING[G];
if(H.type.match(K.mimeType)){break
}}if(!K.definition){K.definition=CQ.WCM.getComponentConfig(K.resourceType)
}L.map=K;
if(!A.editComponent.isInsertAllowed(L.map.definition.resourceType)){L.notAllowed=true;
CQ.Notification.notify(L.file.fileName,CQ.I18n.getMessage("Failed to create paragraph with targeted component {0}{1}",["<br>",L.map.resourceType],"error message; name of the component that has been failed to insert"));
if(this.current>=this.records.length){this.progress.updateProgress(1);
this.finish();
return 
}else{this.uploadNext()
}}this.currentSize=H.fileSize;
this.progress.updateProgress(this.uploaded/this.totalSize);
var J="";
if(this.records.length>1){J=" ("+this.current+"/"+this.records.length+")"
}this.progress.updateText("Uploading "+H.fileName+J);
var F="file"+(new Date).getTime();
L.path="/tmp/"+F;
if(window.FormData){var I=new FormData();
I.append(F,H);
this.xhr.open("POST","/tmp",true);
this.xhr.send(I)
}else{this.xhr.open("PUT",encodeURI(L.path),true);
this.xhr.send(H)
}}};
return D.upload(C)
},notifyDrop:function(A,D,C){var B;
if(A.notifyDropDT){B=A.notifyDropDT(this,D,C)
}else{B=CQ.wcm.EditBase.DropTarget.superclass.notifyDrop.call(this,A,D,C)
}D.stopEvent();
return B
},notifyEnter:function(A,C,B){if(A.notifyEnterDT){return A.notifyEnterDT(this,C,B)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyEnter.call(this,A,C,B)
}},notifyOut:function(A,C,B){if(A.notifyOutDT){return A.notifyOutDT(this,C,B)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyOut.call(this,A,C,B)
}},notifyOver:function(A,C,B){if(A.notifyOverDT){return A.notifyOverDT(this,C,B)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyOver.call(this,A,C,B)
}},showHighlight:function(){this.highlight.showFrame()
},hideHighlight:function(){this.highlight.hideFrame()
},flash:function(){this.highlight.flash()
},normalize:function(){this.el.stopFx();
this.el.fxQueue=[]
}});
CQ.wcm.EditBase.DropTarget.getInstance=function(D,F,A,B){B=B||{};
if(F){B.editComponent=F
}var E=new CQ.wcm.EditBase.DropTarget(D,B);
if(A){var C=0;
for(;
C<A.length;
C++){E.addToGroup(A[C])
}E.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return E
};
CQ.wcm.EditBase.referenceParagraph=function(C){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var A=CQ.WCM.getComponentConfig(CQ.wcm.EditBase.REFERENCE_COMPONENT);
var D={};
D[CQ.wcm.EditBase.REFERENCE_COMPONENT_PATH_PROPERTY]=C;
return this.createParagraph(A,D)
}catch(B){CQ.Ext.Msg.alert("",B)
}return null
};
CQ.wcm.EditBase.copyParagraph=function(G,D,F){var B=CQ.WCM.getEditable(G);
if(B&&B.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_COPY,B,this.path)===false){return null
}if(this.isInsertAllowed(D)){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var A=CQ.WCM.getComponentConfig(D);
var H={};
H["./"+CQ.Sling.COPY_SUFFIX]=G;
var C=this.createParagraph(A,H,false,F);
if(B){B.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_COPY,B,this.path,C)
}return C
}catch(E){CQ.Ext.Msg.alert("",E)
}}return null
};
CQ.wcm.EditBase.moveParagraph=function(L,A,K){var B=CQ.WCM.getEditable(L);
if(B&&B.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_MOVE,B,this.path)===false){return null
}if(this.isInsertAllowed(A)){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var C=CQ.WCM.getComponentConfig(A);
var E={};
var F=B!=null;
var J=F&&(B.getParent()==this.getParent());
if(F&&J){var D=this.path.substring(this.path.lastIndexOf("/")+1);
if(D=="*"){E[CQ.Sling.ORDER]="last"
}else{E[CQ.Sling.ORDER]="before "+D
}var H=CQ.utils.HTTP.post(L,null,E,this);
if(CQ.utils.HTTP.isOk(H)){if(B){B.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_MOVE,this.path)
}return L
}}else{E["./"+CQ.Sling.MOVE_SUFFIX]=L;
var G=this.createParagraph(C,E,F,K);
if(G&&F){B.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_MOVE,this.path,G);
return G
}}}catch(I){CQ.Ext.Msg.alert("",I)
}}return null
};
CQ.wcm.EditBase.createParagraph=function(B,R,A,O){var L=null;
try{L=B.virtual?B.virtualResourceType:B.resourceType
}catch(S){return null
}if(B.resourceType&&this.isInsertAllowed(L)){var T={};
if(B.config&&B.config.params){for(var N in B.config.params){T[N]=B.config.params[N]
}}T._charset_="utf-8";
T["./sling:resourceType"]=B.resourceType;
T["./jcr:lastModified"]="";
T["./jcr:lastModifiedBy"]="";
T["./jcr:created"]="";
T["./jcr:createdBy"]="";
var F=T["./sling:resourceType"];
if(F){T[":nameHint"]=F.substring(F.lastIndexOf("/")+1)
}var J=this.getParent();
var I=J?J.getResourceType():"";
if(I){T.parentResourceType=I
}if(R){for(var N in R){T[N]=R[N]
}}if(B&&B.templatePath){T["./"+CQ.utils.Sling.COPY_SUFFIX]=B.templatePath
}var P=this.path.substring(this.path.lastIndexOf("/")+1);
var C=this.getParentPath()+"/";
T[CQ.utils.Sling.ORDER]=CQ.wcm.EditBase.INSERT_LAST;
if(B.insertBehavior){T[CQ.utils.Sling.ORDER]=B.insertBehavior
}else{if(P!="*"){T[CQ.utils.Sling.ORDER]=CQ.wcm.EditBase.INSERT_BEFORE+" "+P
}}if(P!="*"&&(T[CQ.utils.Sling.ORDER]==CQ.wcm.EditBase.INSERT_BEFORE||T[CQ.utils.Sling.ORDER]==CQ.wcm.EditBase.INSERT_AFTER)){T[CQ.utils.Sling.ORDER]+=" "+P
}if(T[":nameHint"]){var E=CQ.utils.WCM.getPage(CQ.utils.WCM.getPagePath());
if(E&&(E.isLiveCopySource()||E.isLiveCopy())){var M=Math.floor(Math.random()*65535);
var G=M.toString(16);
T[":nameHint"]+="_"+G
}}var K=CQ.utils.HTTP.post(C,null,T,this);
if(CQ.utils.HTTP.isOk(K)&&K.headers){var D=K.headers.Path;
if(D&&!A&&J&&J.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,J,D)===false){return null
}if(T["./"+CQ.Sling.COPY_SUFFIX]){var Q=CQ.WCM.getEditable(T["./"+CQ.Sling.COPY_SUFFIX]);
if(!Q||Q.enableLiveRelationship){var H={};
H.removeLCMarkers="true";
CQ.utils.HTTP.post(D+".msm.conf",null,H,this)
}}if(D&&!A){this.listenersChecker(B.config);
if(B.config&&B.config.listeners&&B.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT]){B.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT].call(this,D,B)
}else{this.refreshCreated(D,B,O)
}if(J){J.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,J,D)
}}if(this.hideHighlight){CQ.wcm.EditRollover.preventNextHighlight=true
}return D
}}return null
};
CQ.wcm.EditBase.updateParagraph=function(E,J,G){var C={_charset_:"utf-8"};
if(E.indexOf("$")>=0){if(!CQ.Ext.isArray(J)){J=[J]
}for(var H=0;
H<J.length;
H++){var I=J[H];
var D=E.replace("$",H+1);
C[D]=I;
var F=D.lastIndexOf("/");
if(F!=-1){C[D.substring(0,F)+"/jcr:lastModified"]="";
C[D.substring(0,F)+"/jcr:lastModifiedBy"]=""
}}}else{C[E]=J;
var F=E.lastIndexOf("/");
if(F!=-1){C[E.substring(0,F)+"/jcr:lastModified"]="";
C[E.substring(0,F)+"/jcr:lastModifiedBy"]=""
}}if(G){for(var A in G){C[A]=G[A]
}}C["./jcr:lastModified"]="";
C["./jcr:lastModifiedBy"]="";
var B=this;
CQ.HTTP.post(this.path,function(L,M,K){if(M){B.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_EDIT,B)
}},C);
return true
};
CQ.wcm.EditBase.removeParagraph=function(){if(!CQ.WCM.getSelection().contains(this)){CQ.WCM.deselect()
}var items=[];
var checkUrl="/bin/wcm/references.json";
var sel=CQ.WCM.getSelectedItems();
if(sel.length==0&&this){sel.push(this)
}for(var s=0;
s<sel.length;
s++){if(sel[s].isActionDelete()){items.push(sel[s]);
checkUrl=CQ.HTTP.addParameter(checkUrl,"path",sel[s].path)
}}if(items.length>0){checkUrl=CQ.HTTP.noCaching(checkUrl);
var data=CQ.HTTP.eval(checkUrl);
var numRefs=0;
if(data&&data.pages){for(var i=0;
i<data.pages.length;
i++){try{numRefs+=data.pages[i].references.length
}catch(e){}}}var lockedLiveRelationship=false;
var enableLiveRelationship=false;
for(i=0;
i<items.length;
i++){if(items[i].enableLiveRelationship&&items[i].liveStatusLocked){lockedLiveRelationship=true;
enableLiveRelationship=true;
break
}}var msg=CQ.I18n.getMessage("Do you really want to delete the selected component(s)?");
if(lockedLiveRelationship){msg=CQ.I18n.getMessage("Do you really want to cancel inheritance and delete the selected component(s)?")
}if(numRefs>0){msg=CQ.I18n.getMessage("One or more of the selected components are referenced. Do you really want to delete them?");
if(lockedLiveRelationship){msg=CQ.I18n.getMessage("One or more of the selected components are referenced. Do you really want to cancel inheritance and delete them?")
}}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Component(s)"),msg,function(btnId){if(btnId=="yes"){for(var i=0;
i<items.length;
i++){CQ.wcm.EditBase.doRemoveParagraph(items[i])
}if(enableLiveRelationship){this.refreshPage()
}}},this)
}};
CQ.wcm.EditBase.doRemoveParagraph=function(C){if(C.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_DELETE,C)===false){return null
}CQ.WCM.deselect(C);
var B=C.path;
B=CQ.HTTP.addParameter(B,CQ.Sling.STATUS,CQ.Sling.STATUS_BROWSER);
if(C.enableLiveRelationship){B=CQ.HTTP.addParameter(B,"./initialSlingResourceType",C.getResourceType());
B=CQ.HTTP.addParameter(B,"./initialSlingResourceSuperType",C.getResourceSuperType());
B=CQ.HTTP.addParameter(B,"./sling:resourceType","wcm/msm/components/ghost");
B=CQ.HTTP.addParameter(B,"./sling:resourceSuperType","");
B=CQ.HTTP.addParameter(B,"./jcr:mixinTypes",CQ.wcm.msm.MSM.MIXIN_LIVE_RELATIONSHIP);
B=CQ.HTTP.addParameter(B,"./jcr:mixinTypes",CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED);
var A=CQ.shared.HTTP.post(B);
if(CQ.utils.HTTP.isOk(A)){C.deleted=true;
C.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_DELETE,C)
}}else{B=CQ.HTTP.addParameter(B,CQ.Sling.OPERATION,CQ.Sling.OPERATION_DELETE);
A=CQ.shared.HTTP.post(B);
if(CQ.utils.HTTP.isOk(A)){C.deleted=true;
C.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_DELETE,C)
}}};
CQ.wcm.EditBase.refreshCreated=function(J,E,K){if(J&&E&&E.resourceType){var G=CQ.HTTP.externalize(J+".html");
var A=CQ.HTTP.get(G);
if(CQ.HTTP.isOk(A)){if(this.hideHighlight){this.hideHighlight()
}if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}CQ.WCM.deselect();
if(!E.config){E.config={}
}var F=A.body;
var R="";
if(E.divAttributes){if(E.divAttributes["class"]){E.divAttributes["class"]="section "+E.divAttributes["class"]
}else{E.divAttributes["class"]="section"
}}else{E.divAttributes={};
E.divAttributes["class"]="section"
}var D="";
if(CQ.Ext.isIE&&F.toLowerCase().indexOf("<script")!=-1){D=this.IEScriptInsert
}if(E.config.isContained===true){var B=(E.containerClass?E.containerClass:"section");
R=D+"<div class='"+B+"'><div"
}else{R=D+"<div"
}if(E.divAttributes){for(var L in E.divAttributes){R+=" "+L+'="'+E.divAttributes[L]+'"'
}}R+=">";
F=R+F+"</div>";
if(E.config.isContained===false){F+="</div>"
}CQ.utils.WCM.startMakeEditablesQueue();
var O=this.placeholder?this.placeholder:this.element;
var C;
if(this.isContained){var P=CQ.Ext.DomHelper.insertBefore(O.parent(),F);
if(E.config.isContained===false){C=P.firstChild
}else{C=P
}}else{C=CQ.Ext.DomHelper.insertBefore(O,F)
}var H={path:J,type:E.resourceType,dialog:E.dialog,editConfig:CQ.Util.copyObject(E.config),element:C};
CQ.WCM.edit(H);
CQ.utils.WCM.endMakeEditablesQueue();
var M=CQ.utils.WCM.getEditable(H.path);
var Q=CQ.WCM.getNestedEditables(M.path);
if(Q.length>0){CQ.WCM.getPageInfo(CQ.WCM.getPagePath(),true)
}M.show();
if(K){M.loadAnnotations()
}if(CQ.Ext.isIE||CQ.Ext.isSafari){CQ.DOM.executeScripts(M.element)
}var I=M.element.dom.getElementsByTagName("img");
for(var N=0;
N<I.length;
N++){I[N].src=CQ.HTTP.noCaching(I[N].src)
}CQ.Util.runComponentObservation()
}}};
CQ.wcm.EditBase.refreshSelf=function(){this.refresh()
};
CQ.wcm.EditBase.refreshSelfMoved=function(D,B){var C=CQ.WCM.getEditable(D);
var A=C.placeholder?C.placeholder:C.element;
if(C.isContained){this.insertBefore(A.parent())
}else{this.insertBefore(A)
}if(B){CQ.WCM.unregisterEditable(this.path);
this.path=B;
CQ.WCM.getEditables()[B]=this
}CQ.Util.runComponentObservation()
};
CQ.wcm.EditBase.refreshParent=function(){try{var A=this.getParent();
if(A){this.getParent().refresh();
return 
}}catch(B){}CQ.wcm.EditBase.refreshPage()
};
CQ.wcm.EditBase.refreshPage=function(){CQ.Util.reload(CQ.WCM.getContentWindow())
};
CQ.wcm.EditBase.initRefreshShortcuts=function(){this.REFRESH_SHORTCUTS={REFRESH_PAGE:function(){this.refreshPage()
},REFRESH_SELF:function(){this.refreshSelf()
},REFRESH_PARENT:function(){this.refreshParent()
},REFRESH_SELFMOVED:function(A){this.refreshSelfMoved(A)
},REFRESH_INSERTED:function(B,A){this.refreshCreated(B,A)
}}
};
CQ.wcm.EditBar=CQ.Ext.extend(CQ.Ext.Panel,{placeholder:null,selectBox:null,annotationOffset:5,constructor:function(A){this.dragZoneClass=CQ.wcm.EditBase.DragZone;
this.dropTargetClass=CQ.wcm.EditBase.DropTarget;
this.constructorStart(A);
var B=this;
this.selectBox=new CQ.Ext.form.Checkbox({boxLabel:CQ.I18n.getMessage("{0} checkbox",["Edit bar"],"Label of edit bar checkbox"),hideLabel:true,listeners:{check:function(C,D){if(D){CQ.WCM.select(B,true)
}else{CQ.WCM.deselect(B,true)
}}}});
this.applyConfigDefaults(A,{renderTo:CQ.Util.ROOT_ID,element:null,path:"",actions:CQ.wcm.EditBase.EDITANNOTATE,childConfig:{actions:CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT},container:"toolbar",ctrlDef:"button",toolbar:{xtype:"toolbar"},button:{xtype:"button",scope:this},orderable:true,listeners:{afteredit:this.refreshSelf,afterdelete:this.refreshSelf,afterinsert:this.refreshCreated,aftermove:this.refreshSelfMoved},stateful:false,inlineEditing:CQ.wcm.EditBase.INLINE_MODE_AUTO,targetMode:CQ.wcm.EditBase.TARGET_MODE_GHOST,isDropTarget:true,isContained:false,containerClass:"section",cls:"cq-editbar",hideMode:"display"});
if(CQ.WCM.isEditMode()){A.toolbar.items.push("->");
A.toolbar.items.push(this.selectBox);
A.toolbar.items.push("&nbsp;")
}CQ.wcm.EditBar.superclass.constructor.call(this,A);
if(A.element){this.buildPlaceholderAndElement(A.element)
}this.constructorEnd(A)
},initComponent:function(){CQ.wcm.EditBar.superclass.initComponent.call(this);
this.addEvents(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT);
this.on("render",function(){if(this.isActionInsertOnly()){this.orderable=false
}if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null){if(this.isActionEdit()||this.isActionDelete()){this.handleLiveRelationship()
}}if(this.isActionInsertOnly()){var B=this.getParent();
if(B&&B.handleLiveRelationship){B.handleLiveRelationship(true)
}}if(this.orderable){this.dd=this.dragZoneClass.getInstance(this.el,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}var A=CQ.WCM.getSelection();
A.on("clear",this.handleSelectionClear,this)
});
this.setBoxLabel();
this.initComponentEnd()
},handleSelectionClear:function(){this.selectBox.setValue(false)
},handleMouseOver:function(A){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){if(!CQ.wcm.EditRollover.currentlyHighlighted){if(CQ.wcm.EditRollover.preventNextHighlight){CQ.wcm.EditRollover.preventNextHighlight=false
}else{}}else{if(this.isParentHighlighted()){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}else{if(CQ.wcm.EditRollover.currentlyHighlighted!==this){}}}}A.stopEvent()
},buildPlaceholderAndElement:function(E){if(E){this.element=CQ.Ext.get(E);
this.el.addClass(this.getClsPath("cq-element"))
}this.element.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.getEl().setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.isContained){this.element.parent().setVisibilityMode(CQ.Ext.Element.DISPLAY)
}if(this.placeholder){this.placeholder.remove()
}if(!this.hidden&&!this.disabled){this.element.linkedEditComponent=this;
var D=this.element.getWidth();
if(D==0){if(this.isContained){if(this.element.parent()){if(this.element.parent().parent()){D=this.element.parent().parent().getWidth()
}else{D=this.element.parent().getWidth()
}}}else{if(this.element.parent()){D=this.element.parent().getWidth()
}}}var C='<div class="'+this.getClsPath("cq-placeholder")+'"></div>';
var B=CQ.DOM.getBlockDefaultStyles();
this.placeholder=CQ.Ext.DomHelper.insertBefore(this.element,C,true);
var A=CQ.Util.applyDefaults({height:this.el.getHeight()+"px",width:D+"px"},B);
this.placeholder.setStyle(A);
this.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.placeholder.addClass(["cq-editcomponent-placeholder","cq-editbar-placeholder"]);
this.initialPlaceholderHeight=this.el.getHeight();
CQ.Util.observeComponent(this);
this.el.setStyle("position","absolute");
this.el.anchorTo(this.placeholder,"tl",null,false,null);
this.el.setStyle("width",D+"px");
if(this.isDropTarget===true&&this.isActionInsert()){this.componentDropTarget=this.dropTargetClass.getInstance(this.placeholder,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT]);
this.elementDropTarget=this.dropTargetClass.getInstance(this.element,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}this.element.on("mouseover",this.handleMouseOver,this);
this.buildSubDropTargets()
}},handleLiveStatus:function(){if(this.enableLiveRelationship){if(this.liveStatus){var A=this.liveStatusLocked?"cq-editbar-livestatus-right-lock":"cq-editbar-livestatus-right-unlock";
this.liveStatus.setIconClass(A)
}}},observeLiveStatus:function(){if(!this.liveStatusRendered&&this.enableLiveRelationship){if(this.isActionEdit()||this.isActionDelete()){var F=this.items.items[0];
if(F){var B=this;
var D=null;
var A="cq-editbar-livestatus-right-unlock";
var E=CQ.I18n.getMessage("Inheritance is broken at the page or parent level");
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){A=this.liveStatusLocked?"cq-editbar-livestatus-right-lock":"cq-editbar-livestatus-right-unlock";
D=function(){B.switchLock()
};
E=CQ.I18n.getMessage("Click to toggle Live Copy inheritance")
}var C=F.items.length;
if(F.items.length>2){C=F.items.length-2
}this.liveStatus=F.insertButton(C,{iconCls:A,handler:D,tooltip:E})
}this.liveStatusRendered=true
}}else{if(this.enableLiveRelationship){if(this.liveStatusLocked){this.suspendSubDropTargets()
}else{this.resumeSubDropTargets()
}}}},observe:function(){this.observeLiveStatus();
this.observeElementPosition();
if(!CQ.Util.isEqualPosition(this.el.getXY(),this.placeholder.getXY(),1)){this.el.alignTo(this.placeholder,"tl-tl")
}},getNewAnnotationOffset:function(){this.annotationOffset+=15;
return[this.annotationOffset,this.annotationOffset]
},show:function(D){this.placeholder.setVisible(true);
this.placeholder.show();
this.getEl().show();
CQ.WCM.showPlaceholders(this.element);
this.resumeDropTargets();
if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.show(true)
}}}this.showAnnotations();
return this
},hide:function(D){if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.hide()
}}}this.suspendDropTargets();
this.getEl().hide();
this.placeholder.setVisible(false);
CQ.WCM.hidePlaceholders(this.element);
this.hideAnnotations();
return this
},convertAction:function(A){if(A!=null){if(typeof A=="string"){var B=CQ.wcm.EditBar.ActionsConvertor[A];
if(B!=null){if(typeof B=="string"){if(B.length>0){return B
}else{return null
}}else{return B
}}}else{if(A.xtype){if(CQ.wcm.EditBar.MenuXTypesToTBActions[A.xtype]!=null){return this.convertAction(CQ.wcm.EditBar.MenuXTypesToTBActions[A.xtype])
}}else{if(A.handler||A.listeners){return A
}else{return CQ.Util.applyDefaults(A,{xtype:"tbtext"})
}}}}return A
},disableDrag:function(){if(this.dd){this.dd.lock()
}},enableDrag:function(){if(this.dd){this.dd.unlock()
}},hideElement:function(B,E){if(E!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var D=0;
D<A.length;
D++){var C=CQ.WCM.getEditable(A[D]);
if(C){C.hide(true);
C.hideElement(false,true)
}}}this.element.hide();
if(B!==true&&this.isContained){this.element.parent().hide(true)
}},showElement:function(D){if(this.isContained){this.element.parent().show()
}this.element.show();
if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.showElement(true);
B.show(true)
}}}},refreshComponent:function(){this.placeholder.setHeight(this.initialPlaceholderHeight);
this.placeholder.show()
},getInlinePlaceholder:function(){return this.placeholder
},getInlinePlaceholderInitialHeight:function(){return this.initialPlaceholderHeight
},remove:function(){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.remove()
}}this.removeDropTargets();
CQ.WCM.deselect(this);
this.removeSelectionListeners();
this.removeClipboardListeners();
CQ.WCM.unregisterDialog("editdialog-"+this.path);
CQ.WCM.unregisterEditable(this.path);
CQ.Util.cancelObservation(this);
this.clearListeners();
CQ.Ext.ComponentMgr.unregister(this);
if(this.placeholder){CQ.Ext.destroy(this.placeholder);
CQ.Ext.ComponentMgr.unregister(this.placeholder);
delete this.placeholder
}if(this.selectBox){CQ.Ext.destroy(this.selectBox);
CQ.Ext.ComponentMgr.unregister(this.selectBox);
delete this.selectBox
}this.removeAnnotations();
CQ.Ext.destroy(this.element);
CQ.Ext.ComponentMgr.unregister(this.element);
delete this.element;
this.el.removeAllListeners();
this.destroy();
this.purgeListeners()
},clearListeners:function(){var A=CQ.WCM.getSelection();
A.un("clear",this.handleSelectionClear,this);
this.element.un("mouseover",this.handleMouseOver,this)
},setBoxLabel:function(){var A="";
if(this.actions&&this.actions.length>0&&this.actions[0].xtype=="tbtext"&&this.actions[0].text!=""){A=this.actions[0].text.replace(/(?:<.*?>)/ig,"")+" "
}this.selectBox.boxLabel=CQ.I18n.getMessage("{0}edit bar checkbox",[A],"Label of edit bar checkbox")
}});
CQ.Ext.reg("editbar",CQ.wcm.EditBar);
CQ.Ext.override(CQ.wcm.EditBar,CQ.wcm.EditBase);
CQ.wcm.EditBar.ActionsConvertor=new Array;
CQ.wcm.EditBar.ActionsConvertor.separator={xtype:"tbseparator"};
CQ.wcm.EditBar.ActionsConvertor["-"]=CQ.wcm.EditBar.ActionsConvertor.separator;
CQ.wcm.EditBar.ActionsConvertor.spacer={xtype:"tbspacer"};
CQ.wcm.EditBar.ActionsConvertor[" "]=CQ.wcm.EditBar.ActionsConvertor.spacer;
CQ.wcm.EditBar.ActionsConvertor.fill={xtype:"tbfill"};
CQ.wcm.EditBar.ActionsConvertor["->"]=CQ.wcm.EditBar.ActionsConvertor.fill;
CQ.wcm.EditBar.MenuXTypesToTBActions=new Array;
CQ.wcm.EditRollover=CQ.Ext.extend(CQ.Ext.Component,{isEmpty:false,selected:false,editText:null,deleteText:null,insertText:null,emptyText:null,enableInsertOnlyText:true,enableHighLight:null,enableHighlight:null,enableContextMenu:null,enableEditOnDblClick:null,selectable:false,animateShow:null,animateHide:null,inactiveMode:null,highlight:null,elementPlaceholder:null,emptyComponent:null,contextMenuXY:null,constructor:function(A){if(A.enableHighLight){A.enableHighlight=A.enableHighLight;
delete A.enableHighLight
}this.dragZoneClass=CQ.wcm.EditRollover.DragZone;
this.dropTargetClass=CQ.wcm.EditRollover.DropTarget;
this.constructorStart(A);
this.applyConfigDefaults(A,{renderTo:CQ.Util.ROOT_ID,element:null,path:"",actions:CQ.wcm.EditBase.EDITANNOTATE,childConfig:{actions:CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT},container:"menu",ctrlDef:"menuitem",menu:{},menuitem:{},listeners:{afteredit:this.refreshSelf,afterdelete:this.refreshSelf,afterinsert:this.refreshCreated,aftermove:this.refreshSelfMoved},stateful:false,inlineEditing:CQ.wcm.EditBase.INLINE_MODE_AUTO,targetMode:CQ.wcm.EditBase.TARGET_MODE_GHOST,orderable:true,enableInsertOnlyText:true,isDropTarget:true,enableHighlight:true,enableContextMenu:true,enableEditOnDblClick:true,selectable:true,animateShow:true,animateHide:false,isContained:false,containerClass:"section"});
if(A.inactiveMode){A.isDropTarget=false;
A.orderable=false;
A.enableHighlight=false;
A.enableContextMenu=false;
A.enableEditOnDblClick=false;
A.selectable=false
}delete A.style;
CQ.wcm.EditRollover.superclass.constructor.call(this,A);
this.el=this.element=CQ.Ext.get(this.element);
this.el.addClass(this.getClsPath("cq-element"));
var B=this.element.first("iframe");
if(B){this.element.setHeight(this.element.getHeight()+B.getHeight())
}this.buildElement();
this.constructorEnd(A)
},initComponent:function(){CQ.wcm.EditRollover.superclass.initComponent.call(this);
this.addEvents(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT);
this.on("render",function(){CQ.Timing.stamp("Start rendering rollover","EditRollover#onRender",true);
if(this.isActionInsertOnly()){this.orderable=false
}this.highlight=new CQ.wcm.EditRollover.Highlight();
this.inplaceEditHighlight=new CQ.wcm.EditRollover.Highlight();
this.inplaceEditHighlight.addClass("cq-editrollover-inplaceediting");
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null){if(this.enableHighlight&&(this.isActionEdit()||this.isActionDelete())){this.handleLiveRelationship()
}}if(this.isActionInsertOnly()){var B=this.getParent();
if(B&&B.handleLiveRelationship){B.handleLiveRelationship(true)
}}var A=CQ.WCM.getSelection();
A.on("add",this.handleSelect,this);
A.on("remove",this.handleDeselect,this);
A.on("clear",this.handleSelectionClear,this);
CQ.Timing.stamp("Completed rendering rollover","EditRollover#onRender")
});
this.initComponentEnd()
},buildElement:function(){this.clearListeners();
if(this.emptyComponent){this.emptyComponent.hide()
}if(this.elementPlaceholder){this.elementPlaceholder.hide()
}if(this.placeholder){this.placeholder.hide()
}if(!this.hidden&&!this.disabled){var C='<div class="'+this.getClsPath("cq-placeholder")+'"></div>';
var B=CQ.DOM.getBlockDefaultStyles();
var D,A;
var E=this.element.getWidth();
this.element.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.isContained){this.element.parent().setVisibilityMode(CQ.Ext.Element.DISPLAY)
}this.elementHidden=false;
if(!this.placeholder){this.placeholder=CQ.Ext.DomHelper.insertBefore(this.element,C,true)
}if(CQ.Ext.isIE6){A=CQ.Util.applyDefaults({width:E+"px",height:"0px","line-height":"0px","font-size":"0px"},B)
}else{A=CQ.Util.applyDefaults({width:E+"px",height:"0"},B)
}this.placeholder.setStyle(A);
this.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.placeholder.show();
if(this.isActionInsertOnly()||this.isEmpty){D=(this.enableInsertOnlyText?CQ.themes.wcm.EditRollover.ELEMENT_MIN_HEIGHT:CQ.themes.wcm.EditRollover.ELEMENT_NO_TEXT_MIN_HEIGHT);
if(!this.elementPlaceholder){this.elementPlaceholder=this.element.insertHtml("beforeEnd",C,true)
}A=CQ.Util.applyDefaults({height:D+"px",width:E+"px"},B);
this.elementPlaceholder.setStyle(A);
this.elementPlaceholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var F=this.emptyText?this.emptyText:CQ.I18n.getMessage("Drag components or assets here");
if(!this.emptyComponent){this.emptyComponent=new CQ.Ext.Container({autoEl:"div",cls:"cq-editrollover-insert-container",hideMode:"visibility",renderTo:CQ.Util.ROOT_ID});
if(this.enableInsertOnlyText){this.emptyComponent.add(new CQ.Static({text:F,cls:"cq-editrollover-insert-message",tag:"span"}))
}this.emptyComponent.doLayout()
}else{if(this.enableInsertOnlyText){this.emptyComponent.items.items[0].text=F
}}this.emptyComponent.setWidth(E);
this.emptyComponent.setHeight(D);
this.emptyComponent.el.setStyle("position","absolute");
this.emptyComponent.el.anchorTo(this.elementPlaceholder,"tl",null,false,null);
if(this.enableContextMenu){this.emptyComponent.el.on("contextmenu",this.handleContextMenu,this)
}if(this.enableHighlight&&!((this.isActionInsertOnly()||this.isEmpty)&&!this.enableInsertOnlyText)){this.emptyComponent.el.on("mouseover",this.handleMouseOver,this)
}if(this.selectable){this.emptyComponent.el.on("click",this.handleClick,this)
}if(this.enableEditOnDblClick&&(this.isActionInsertOnly()||this.isActionEdit())){this.emptyComponent.el.on("dblclick",this.handleDblClick,this)
}this.elementPlaceholder.show();
this.emptyComponent.show()
}this.element.linkedEditComponent=this;
if(this.enableContextMenu){this.addElementEventListener(this.element.dom,"contextmenu",this.handleContextMenu,true,this)
}if(this.enableHighlight&&!((this.isActionInsertOnly()||this.isEmpty)&&!this.enableInsertOnlyText)){this.element.on("mouseover",this.handleMouseOver,this)
}if(this.selectable){this.element.on("click",this.handleClick,this)
}if(this.enableEditOnDblClick&&(this.isActionInsertOnly()||this.isActionEdit())){this.element.on("dblclick",this.handleDblClick,this)
}if(this.isDropTarget===true&&this.isActionInsert()){this.elementDropTarget=this.dropTargetClass.getInstance(this.element,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT]);
this.componentDropTarget=this.elementDropTarget
}this.buildSubDropTargets()
}CQ.Util.observeComponent(this)
},handleLiveStatus:function(){if(this.enableLiveRelationship&&this.liveStatus){if(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS)&&!this.hidden&&!this.disabled&&!this.elementHidden){this.liveStatus.showFrames(this,this.liveStatusLocked)
}else{this.liveStatus.hideFrames()
}}},observeLiveStatus:function(){if(this.enableLiveRelationship){if(this.liveStatusLocked){this.suspendSubDropTargets()
}else{this.resumeSubDropTargets()
}if(!this.liveStatusRendered){this.liveStatus=new CQ.wcm.EditRollover.LiveStatus(this.liveStatusContainerMode);
var A=this;
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){this.liveStatus.frameRight.on("render",function(){this.getEl().on("click",A.switchLock,A)
},this.liveStatus.frameRight)
}else{this.liveStatus.frameRight.on("render",function(){this.getEl().dom.title=CQ.I18n.getMessage("Inheritance is broken at the page or parent level")
},this.liveStatus.frameRight)
}this.liveStatusRendered=true
}this.handleLiveStatus()
}},observe:function(){var A,B;
this.observeLiveStatus();
this.observeElementPosition();
if(!this.hidden&&!this.disabled&&!this.elementHidden){if(this.elementPlaceholder&&this.elementPlaceholder.getHeight()==0){this.buildElement()
}else{if(this.isActionInsertOnly()||this.isEmpty){A=this.element.getWidth();
B=(this.enableInsertOnlyText?CQ.themes.wcm.EditRollover.ELEMENT_MIN_HEIGHT:CQ.themes.wcm.EditRollover.ELEMENT_NO_TEXT_MIN_HEIGHT);
if(this.elementPlaceholder){if(this.elementPlaceholder.getWidth()!=A){this.elementPlaceholder.setWidth(A)
}if(this.elementPlaceholder.getHeight()!=B){this.elementPlaceholder.setHeight(B)
}}if(this.emptyComponent){if(this.emptyComponent.el.getWidth()!=A){this.emptyComponent.setWidth(A)
}if(this.emptyComponent.el.getHeight()!=B){this.emptyComponent.setHeight(B)
}if(!CQ.Util.isEqualPosition(this.emptyComponent.el.getXY(),this.elementPlaceholder.getXY(),1)){this.emptyComponent.el.alignTo(this.elementPlaceholder,"tl-tl")
}}}else{if(this.emptyComponent){if(this.emptyComponent.el.getWidth()!=A){this.emptyComponent.setWidth(A)
}if(this.emptyComponent.el.getHeight()!=B){this.emptyComponent.setHeight(B)
}if(!CQ.Util.isEqualPosition(this.emptyComponent.el.getXY(),this.elementPlaceholder.getXY(),1)){this.emptyComponent.el.alignTo(this.elementPlaceholder,"tl-tl")
}}}}}},handleContextMenu:function(B){if(B.altKey){return 
}if(window.CQ_inplaceEditComp){return 
}CQ.WCM.select(this,B.shiftKey||B.ctrlKey,true);
var A=this.element.linkedEditComponent;
if(A&&A.menu){A.showHighlight();
if(!A.menuComponent){A.menuComponent=new CQ.Ext.menu.Menu({defaults:{scope:A},items:A.menu.items})
}this.contextMenuXY=B.getXY();
A.menuComponent.showAt(this.contextMenuXY);
B.stopEvent()
}},getNewAnnotationOffset:function(){return[this.contextMenuXY[0]-this.element.getXY()[0],this.contextMenuXY[1]-this.element.getXY()[1]]
},handleWindowResize:function(){this.hideHighlight()
},handleClick:function(C){if(window.CQ_inplaceEditComp){window.CQ_inplaceEditComp.isInplaceEditClickHandled=true;
if(window.CQ_inplaceEditComp==this){return 
}window.CQ_inplaceEditComp.finishInplaceEditing()
}if(CQ.wcm.EditRollover.currentlyHighlighted===this){this.asyncSingleClick=true;
var B=this.selected;
(function(){this.handleClickAsync(B)
}).defer(1,this);
var A=C.shiftKey||C.ctrlKey;
if(!this.isActionCopyMove()&&!this.isActionDelete()&&!this.isActionInsert()){if(A){CQ.DOM.clearDocumentSelection(CQ.WCM.getContentWindow())
}return 
}if(this.selected){if(A){CQ.WCM.deselect(this,true)
}else{CQ.WCM.select(this,false,true)
}}else{CQ.WCM.select(this,A,true)
}}},handleClickAsync:function(A){if(this.asyncSingleClick){if(A){if(!this.liveStatusLocked){this.startInplaceEditing()
}}}this.asyncSingleClick=false
},_startInplaceEditing:function(){this.inplaceEditor.addRepositionListener(function(){this.inplaceEditHighlight.showFrames(this)
}.createDelegate(this));
this.inplaceEditor.addResizeListener(function(){this.inplaceEditHighlight.adjustHighlightSize(this)
}.createDelegate(this));
this.inplaceEditHighlight.showFrames(this)
},_resetInplaceEditing:function(){this.inplaceEditor.removeAllResizeListeners();
this.inplaceEditHighlight.hideFrames(this)
},_finishInplaceEditing:function(){this._resetInplaceEditing()
},_cancelInplaceEditing:function(){this._resetInplaceEditing()
},handleDblClick:function(A){this.asyncSingleClick=false;
if(window.CQ_inplaceEditComp==this){return 
}if(this.isActionEdit()){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.EDIT)
}else{if(this.isActionInsert()){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.INSERT)
}}A.stopEvent()
},handleMouseOver:function(A){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){if(window.CQ_inplaceEditComp!=null){this.hideHighlight();
return 
}if(!CQ.wcm.EditRollover.currentlyHighlighted){if(CQ.wcm.EditRollover.preventNextHighlight){CQ.wcm.EditRollover.preventNextHighlight=false
}else{this.showHighlight()
}}else{if(this.isParentHighlighted()){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight();
this.showHighlight()
}else{if(CQ.wcm.EditRollover.currentlyHighlighted!==this){CQ.wcm.EditRollover.requestHighlight=this
}}}}A.stopEvent()
},handleDocumentMouseMove:function(E){if(this.element){var G=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var D=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var C=this.element.getRegion();
var B=E.getPageX();
var F=E.getPageY();
var A=new CQ.Ext.lib.Region(C.top-G-D,C.right+G+D,C.bottom+G+D,C.left-G-D);
if(!A.contains(new CQ.Ext.lib.Region(F,B,F,B))||this!==CQ.wcm.EditRollover.currentlyHighlighted){this.hideHighlight()
}A=null
}},handleDocumentScroll:function(A){this.hideHighlight()
},handleSelect:function(C,D){if(D!=this){return 
}if(!this.selected){this.selected=true;
this.highlight.addClass("cq-editrollover-selected");
this.highlight.showFrames(this);
if(this.enableLiveRelationship&&!CQ.WCM.isShownLayer(CQ.WCM.LAYER_LCSTATUS)){var B=this.liveStatusLocked?"cq-editrollover-selected-livestatus-right-lock":"cq-editrollover-selected-livestatus-right-unlock";
B="cq-editrollover-selected-livestatus  "+B;
this.highlight.lock=new CQ.Ext.BoxComponent({autoEl:"div",cls:B,renderTo:CQ.Util.ROOT_ID});
this.highlight.lock.getEl().alignTo(this.highlight.frameRight.getEl(),"tl",[-20,4]);
this.highlight.lock.show();
var A=this;
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){this.highlight.lock.getEl().on("click",A.switchLock,A)
}else{this.highlight.lock.getEl().dom.title=CQ.I18n.getMessage("Inheritance is broken at the page or parent level")
}}}},handleDeselect:function(A){if(A!=this){return 
}if(this.selected){if(this.highlight.lock){this.highlight.lock.hide();
this.highlight.lock.getEl().remove();
this.highlight.lock=null
}this.highlight.hideFrames();
this.highlight.removeClass("cq-editrollover-selected");
this.selected=false
}},handleSelectionClear:function(){this.handleDeselect(this)
},showHighlight:function(){if(this.enableHighlight&&this.element){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){CQ.wcm.EditRollover.currentlyHighlighted=this;
this.element.un("mouseover",this.handleMouseOver,this);
this.addDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.addDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.onWindowResize(this.handleWindowResize,this);
this.highlight.showFrames(this)
}}},showHighLight:this.showHighlight,hideHighlight:function(){if(CQ.wcm.EditRollover.currentlyHighlighted===this){delete CQ.wcm.EditRollover.currentlyHighlighted
}this.removeDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.removeDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.removeResizeListener(this.handleWindowResize,this);
if(this.enableHighlight){this.element.un("mouseover",this.handleMouseOver,this);
this.element.on("mouseover",this.handleMouseOver,this)
}if(CQ.wcm.EditRollover.requestHighlight&&!CQ.Ext.dd.DragDropMgr.dragCurrent){CQ.wcm.EditRollover.currentlyHighlighted=CQ.wcm.EditRollover.requestHighlight;
CQ.wcm.EditRollover.currentlyHighlighted.showHighlight();
delete CQ.wcm.EditRollover.requestHighlight
}if(!this.selected&&this.highlight){this.highlight.hideFrames()
}},hideHighLight:this.hideHighlight,clearListeners:function(){if(CQ.wcm.EditRollover.currentlyHighlighted===this){delete CQ.wcm.EditRollover.currentlyHighlighted;
this.removeDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.removeDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.removeResizeListener(this.handleWindowResize,this)
}if(this.emptyComponent){this.emptyComponent.el.un("contextmenu",this.handleContextMenu,this);
this.emptyComponent.el.un("mouseover",this.handleMouseOver,this);
this.emptyComponent.el.un("click",this.handleClick,this)
}this.element.un("mouseover",this.handleMouseOver,this);
this.element.un("click",this.handleClick,this);
this.element.un("dblclick",this.handleDblClick,this);
this.removeElementEventListener(this.element.dom,"contextmenu",this.handleContextMenu,true,this)
},show:function(D){this.hidden=false;
this.hideHighlight();
if(this.liveStatus){this.liveStatus.showFrames()
}CQ.WCM.showPlaceholders(this.element);
this.buildElement();
if(this.isContained&&this.isActionInsertOnly()){this.element.parent().show()
}this.resumeDropTargets();
if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.show(true)
}}}this.showAnnotations();
return this
},hide:function(D){if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.hide()
}}}this.suspendDropTargets();
this.hidden=true;
if(this.liveStatus){this.liveStatus.hideFrames()
}if(this.element){this.hideHighlight();
if(this.isContained&&this.isActionInsertOnly()){this.element.parent().hide()
}CQ.WCM.hidePlaceholders(this.element);
this.buildElement()
}this.hideAnnotations();
return this
},convertAction:function(A){if(A!=null){if(typeof A=="string"){var B=CQ.wcm.EditRollover.ActionsConvertor[A];
if(B!=null){if(typeof B=="string"){if(B.length>0){return B
}else{return null
}}else{return B
}}else{return{text:A,disabled:true}
}}else{if(A.xtype){if(A.xtype=="tbtext"||A.xtype=="text"){delete A.xtype;
return CQ.Util.applyDefaults(A,{disabled:true})
}else{if(CQ.wcm.EditRollover.TBXTypesToMenuActions[A.xtype]!=null){return this.convertAction(CQ.wcm.EditRollover.TBXTypesToMenuActions[A.xtype])
}}}else{if(A.handler||A.listeners){return A
}else{return CQ.Util.applyDefaults(A,{disabled:true})
}}}}return A
},hideElement:function(B,E){if(E!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var D=0;
D<A.length;
D++){var C=CQ.WCM.getEditable(A[D]);
if(C){C.hide();
C.hideElement()
}}}this.elementHidden=true;
if(this.liveStatus){this.liveStatus.hideFrames()
}this.hideHighlight();
this.savedElementHeight=this.element.getHeight();
this.savedElementWidth=this.element.getWidth();
this.element.hide(this.animateHide);
if(B!==true&&this.isContained){this.element.parent().hide()
}if(this.emptyComponent){this.emptyComponent.hide()
}if(this.elementPlaceholder){this.elementPlaceholder.hide()
}},showElement:function(D){this.elementHidden=false;
if(this.emptyComponent){this.emptyComponent.show()
}if(this.elementPlaceholder){this.elementPlaceholder.show()
}if(this.isContained){this.element.parent().show()
}this.element.show(this.animateShow);
this.savedElementHeight=this.element.getHeight();
this.savedElementWidth=this.element.getWidth();
if(D!==true){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.showElement(true);
B.show(true)
}}}},refreshComponent:function(){this.placeholder.setHeight(0);
this.placeholder.show()
},getInlinePlaceholder:function(){return this.placeholder
},getInlinePlaceholderInitialHeight:function(){return 0
},remove:function(){var A=CQ.WCM.getNestedEditables(this.path);
for(var C=0;
C<A.length;
C++){var B=CQ.WCM.getEditable(A[C]);
if(B){B.remove()
}}this.removeDropTargets();
CQ.WCM.deselect(this);
var D=CQ.WCM.getSelection();
D.un("add",this.handleSelect,this);
D.un("remove",this.handleDeselect,this);
D.un("clear",this.handleSelectionClear,this);
this.removeSelectionListeners();
this.removeClipboardListeners();
CQ.WCM.unregisterDialog("editdialog-"+this.path);
CQ.WCM.unregisterEditable(this.path);
CQ.Util.cancelObservation(this);
if(this.liveStatus){this.liveStatus.hideFrames();
CQ.Ext.destroy(this.liveStatus);
CQ.Ext.ComponentMgr.unregister(this.liveStatus);
delete this.liveStatus
}if(this.placeholder){CQ.Ext.destroy(this.placeholder);
CQ.Ext.ComponentMgr.unregister(this.placeholder);
delete this.placeholder
}if(this.menuComponent){CQ.Ext.destroy(this.menuComponent);
CQ.Ext.ComponentMgr.unregister(this.menuComponent);
delete this.menuComponent
}if(this.highlight){this.highlight.hideFrames();
CQ.Ext.destroy(this.highlight);
CQ.Ext.ComponentMgr.unregister(this.highlight);
delete this.highlight
}if(this.inplaceEditHighlight){this.inplaceEditHighlight.hideFrames();
CQ.Ext.destroy(this.inplaceEditHighlight);
CQ.Ext.ComponentMgr.unregister(this.inplaceEditHighlight);
delete this.inplaceEditHighlight
}this.removeAnnotations();
this.clearListeners();
CQ.Ext.ComponentMgr.unregister(this);
if(this.emptyComponent){CQ.Ext.destroy(this.emptyComponent);
delete this.emptyComponent
}CQ.Ext.destroy(this.element);
CQ.Ext.ComponentMgr.unregister(this.element);
delete this.element;
this.destroy();
this.purgeListeners()
},addElementEventListener:function(D,B,G,A,E){if(D&&(D.tagName=="script"||D.tagName=="input"||D.tagName=="select"||D.tagName=="button"||D.tagName=="a")){return 
}var F=CQ.Ext.get(D);
if(F){F.addListener(B,G,E);
if(A){for(var C=0;
C<D.childNodes.length;
C++){this.addElementEventListener(D.childNodes.item(C),B,G,false,E)
}}}},removeElementEventListener:function(D,B,G,A,E){if(D&&(D.tagName=="script"||D.tagName=="input"||D.tagName=="select"||D.tagName=="button"||D.tagName=="a")){return 
}var F=CQ.Ext.get(D);
if(F){F.removeListener(B,G,E);
if(A){for(var C=0;
C<D.childNodes.length;
C++){this.removeElementEventListener(D.childNodes.item(C),B,G,false,E)
}}}},addDocumentEventListener:function(A,C,B){this.addElementEventListener(document,A,C,false,B)
},removeDocumentEventListener:function(A,C,B){this.removeElementEventListener(document,A,C,false,B)
}});
CQ.Ext.reg("editrollover",CQ.wcm.EditRollover);
CQ.Ext.override(CQ.wcm.EditRollover,CQ.wcm.EditBase);
CQ.wcm.EditRollover.ActionsConvertor=new Array;
CQ.wcm.EditRollover.ActionsConvertor.separator="-";
CQ.wcm.EditRollover.ActionsConvertor["-"]=CQ.wcm.EditRollover.ActionsConvertor.separator;
CQ.wcm.EditRollover.ActionsConvertor.spacer="";
CQ.wcm.EditRollover.ActionsConvertor[" "]=CQ.wcm.EditRollover.ActionsConvertor.spacer;
CQ.wcm.EditRollover.ActionsConvertor.fill="";
CQ.wcm.EditRollover.ActionsConvertor["->"]=CQ.wcm.EditRollover.ActionsConvertor.fill;
CQ.wcm.EditRollover.TBXTypesToMenuActions=new Array;
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbseparator="separator";
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbspacer="spacer";
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbfill="fill";
CQ.wcm.EditRollover.DragZone=CQ.Ext.extend(CQ.wcm.EditBase.DragZone,{hideEditComponent:function(){CQ.wcm.EditRollover.DragZone.superclass.hideEditComponent.call(this);
for(var A=0;
A<this.dragData.items.length;
A++){try{CQ.WCM.deselect(this.dragData.items[A]);
this.dragData.items[A].highlight.hideFrames()
}catch(B){}}}});
CQ.wcm.EditRollover.DragZone.getInstance=function(D,E,B){var A=new CQ.wcm.EditRollover.DragZone(D,{editComponent:E});
if(B){var C=0;
for(;
C<B.length;
C++){A.addToGroup(B[C])
}A.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return A
};
CQ.wcm.EditRollover.DropTarget=CQ.Ext.extend(CQ.wcm.EditBase.DropTarget,{notifyEnter:function(A,C,B){return CQ.wcm.EditRollover.DropTarget.superclass.notifyEnter.call(this,A,C,B)
},notifyOver:function(A,C,B){this.editComponent.highlight.hideFrames();
return CQ.wcm.EditRollover.DropTarget.superclass.notifyOver.call(this,A,C,B)
}});
CQ.wcm.EditRollover.DropTarget.getInstance=function(D,F,A,B){B=B||{};
if(F){B.editComponent=F
}var E=new CQ.wcm.EditRollover.DropTarget(D,B);
if(A){var C=0;
for(;
C<A.length;
C++){E.addToGroup(A[C])
}E.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return E
};
CQ.wcm.EditRollover.Highlight=CQ.Ext.extend(CQ.Ext.Component,{frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,constructor:function(){CQ.wcm.EditRollover.Highlight.superclass.constructor.call(this);
this.frameLeft=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-left"});
this.frameRight=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-right"});
this.frameBottom=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-bottom"});
this.frameTop=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-top"})
},adjustHighlightSize:function(C){var G=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var D=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var B=C.element.getWidth();
var A=C.element.getHeight();
var F=this.frameLeft.el.getLeft()+G+D;
var E=this.frameTop.el.getTop()+G+D;
this.frameTop.setWidth(B+2*G+2*D);
this.frameTop.setHeight(G);
this.frameBottom.setPosition(F-G-D,E+A+D);
this.frameBottom.setWidth(B+2*G+2*D);
this.frameBottom.setHeight(G);
this.frameLeft.setWidth(G);
this.frameLeft.setHeight(A+2*D);
this.frameRight.setPosition(F+B+D,E-D);
this.frameRight.setWidth(G);
this.frameRight.setHeight(A+2*D)
},showFrames:function(D){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(D){var B=D.element;
var H=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var E=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var C=B.getWidth();
var A=B.getHeight();
if(D.emptyComponent){A=D.emptyComponent.getEl().getHeight()
}var G=B.getLeft();
var F=B.getTop();
this.frameTop.setWidth(C+2*H+2*E);
this.frameTop.setHeight(H);
this.frameTop.setPosition(G-H-E,F-H-E);
this.frameBottom.setWidth(C+2*H+2*E);
this.frameBottom.setHeight(H);
this.frameBottom.setPosition(G-H-E,F+A+E);
this.frameLeft.setWidth(H);
this.frameLeft.setHeight(A+2*E);
this.frameLeft.setPosition(G-H-E,F-E);
this.frameRight.setWidth(H);
this.frameRight.setHeight(A+2*E);
this.frameRight.setPosition(G+C+E,F-E);
if(D.orderable){if(!this.frameTop.dd){this.frameTop.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameTop.getEl(),D,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameTop.dd.unlock();
this.frameTop.dd.clearGroups();
this.frameTop.dd.editComponent=D;
this.frameTop.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameBottom.dd){this.frameBottom.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameBottom.getEl(),D,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameBottom.dd.unlock();
this.frameBottom.dd.clearGroups();
this.frameBottom.dd.editComponent=D;
this.frameBottom.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameLeft.dd){this.frameLeft.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameLeft.getEl(),D,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameLeft.dd.unlock();
this.frameLeft.dd.clearGroups();
this.frameLeft.dd.editComponent=D;
this.frameLeft.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameRight.dd){this.frameRight.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameRight.getEl(),D,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameRight.dd.unlock();
this.frameRight.dd.clearGroups();
this.frameRight.dd.editComponent=D;
this.frameRight.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}}else{if(this.frameTop.dd){this.frameTop.dd.clearGroups();
delete this.frameTop.dd.editComponent;
this.frameTop.dd.lock()
}if(this.frameBottom.dd){this.frameBottom.dd.clearGroups();
delete this.frameBottom.dd.editComponent;
this.frameBottom.dd.lock()
}if(this.frameLeft.dd){this.frameLeft.dd.clearGroups();
delete this.frameLeft.dd.editComponent;
this.frameLeft.dd.lock()
}if(this.frameRight.dd){this.frameRight.dd.clearGroups();
delete this.frameRight.dd.editComponent;
this.frameRight.dd.lock()
}}this.frameLeft.show();
this.frameRight.show();
this.frameBottom.show();
this.frameTop.show()
}},hideFrames:function(){this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide()
},addClass:function(A){this.frameLeft.addClass(A);
this.frameRight.addClass(A);
this.frameBottom.addClass(A);
this.frameTop.addClass(A)
},removeClass:function(A){this.frameLeft.removeClass(A);
this.frameRight.removeClass(A);
this.frameBottom.removeClass(A);
this.frameTop.removeClass(A)
},on:function(A,C,B){this.frameLeft.on(A,C,B);
this.frameRight.on(A,C,B);
this.frameBottom.on(A,C,B);
this.frameTop.on(A,C,B)
},un:function(A,C,B){this.frameLeft.un(A,C,B);
this.frameRight.un(A,C,B);
this.frameBottom.un(A,C,B);
this.frameTop.un(A,C,B)
},destroy:function(){CQ.Ext.destroy(this.frameLeft);
CQ.Ext.destroy(this.frameRight);
CQ.Ext.destroy(this.frameBottom);
CQ.Ext.destroy(this.frameTop);
delete this.frameLeft;
delete this.frameRight;
delete this.frameBottom;
delete this.frameTop;
CQ.wcm.EditRollover.Highlight.superclass.destroy.call(this)
}});
CQ.wcm.EditRollover.HighLight=CQ.wcm.EditRollover.Highlight;
CQ.wcm.EditRollover.LiveStatus=CQ.Ext.extend(CQ.Ext.Component,{frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,containerMode:false,lockCls:"cq-editrollover-livestatus-lock",lockRightCls:"cq-editrollover-livestatus-right-lock",unlockCls:"cq-editrollover-livestatus-unlock",unlockRightCls:"cq-editrollover-livestatus-right-unlock",constructor:function(A){CQ.wcm.EditRollover.LiveStatus.superclass.constructor.call(this);
if(A){this.containerMode=true
}this.frameLeft=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-left"});
this.frameRight=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-right"});
this.frameBottom=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-bottom"});
this.frameTop=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-top"})
},showFrames:function(D,I){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(D){var F=D.element;
var H=1;
var B=2;
var E=10;
var A=F.getWidth();
var J=F.getHeight();
var C=F.getLeft();
var G=F.getTop();
if(this.containerMode){B+=4;
A+=14;
E=2
}this.frameTop.setWidth(A+2*H+2*B);
this.frameTop.setHeight(H);
this.frameTop.setPosition(C-H-B,G-H-B);
this.frameBottom.setWidth(A+2*H+2*B);
this.frameBottom.setHeight(H);
this.frameBottom.setPosition(C-H-B,G+J+B);
this.frameLeft.setWidth(H);
this.frameLeft.setHeight(J+2*B);
this.frameLeft.setPosition(C-H-B,G-B);
this.frameRight.setWidth(H);
this.frameRight.setHeight(J+2*B);
this.frameRight.setPosition(C+A-E-B-H-6,G-B);
if(I){this.displayLock()
}else{this.displayUnLock()
}this.frameLeft.show();
this.frameRight.show();
this.frameBottom.show();
this.frameTop.show()
}},displayLock:function(){this.frameRight.removeClass(this.unlockRightCls);
this.frameLeft.removeClass(this.unlockCls);
this.frameBottom.removeClass(this.unlockCls);
this.frameTop.removeClass(this.unlockCls);
this.frameRight.addClass(this.lockRightCls);
this.frameLeft.addClass(this.lockCls);
this.frameBottom.addClass(this.lockCls);
this.frameTop.addClass(this.lockCls)
},displayUnLock:function(){this.frameRight.removeClass(this.lockRightCls);
this.frameLeft.removeClass(this.lockCls);
this.frameBottom.removeClass(this.lockCls);
this.frameTop.removeClass(this.lockCls);
this.frameLeft.addClass(this.unlockCls);
this.frameRight.addClass(this.unlockRightCls);
this.frameBottom.addClass(this.unlockCls);
this.frameTop.addClass(this.unlockCls)
},hideFrames:function(){this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide()
},addClass:function(A){this.frameLeft.addClass(A);
this.frameRight.addClass(A);
this.frameBottom.addClass(A);
this.frameTop.addClass(A)
},removeClass:function(A){this.frameLeft.removeClass(A);
this.frameRight.removeClass(A);
this.frameBottom.removeClass(A);
this.frameTop.removeClass(A)
},on:function(A,C,B){this.frameLeft.on(A,C,B);
this.frameRight.on(A,C,B);
this.frameBottom.on(A,C,B);
this.frameTop.on(A,C,B)
},un:function(A,C,B){this.frameLeft.un(A,C,B);
this.frameRight.un(A,C,B);
this.frameBottom.un(A,C,B);
this.frameTop.un(A,C,B)
},destroy:function(){CQ.Ext.destroy(this.frameLeft);
CQ.Ext.destroy(this.frameRight);
CQ.Ext.destroy(this.frameBottom);
CQ.Ext.destroy(this.frameTop);
delete this.frameLeft;
delete this.frameRight;
delete this.frameBottom;
delete this.frameTop;
CQ.wcm.EditRollover.LiveStatus.superclass.destroy.call(this)
}});
CQ.wcm.InvisibleEditControl=CQ.Ext.extend(CQ.Ext.Component,{constructor:function(A){this.constructorStart(A);
this.constructorEnd(A);
CQ.wcm.InvisibleEditControl.superclass.constructor.call(this,A);
this.element=CQ.Ext.get(this.element)
}});
CQ.Ext.reg("editnocontrol",CQ.wcm.InvisibleEditControl);
CQ.Ext.override(CQ.wcm.InvisibleEditControl,CQ.wcm.EditBase);
CQ.wcm.NotificationInbox=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(C){this.debug=C.debug;
var A=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{header:CQ.I18n.getMessage("Modification"),dataIndex:"modification"},{header:CQ.I18n.getMessage("Path"),dataIndex:"path"},{header:CQ.I18n.getMessage("Date"),dataIndex:"date"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"},{header:CQ.I18n.getMessage("Read"),dataIndex:"isRead"}]);
A.defaultSortable=true;
var E=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var D=CQ.Util.applyDefaults(C.store,{autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/notification/inbox/messages.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"messages",id:"id",fields:["id","modification","path","date","user",{name:"isRead",type:"bool"},{name:"isUserMessage",type:"bool"}]})});
var B=new CQ.Ext.data.GroupingStore(D);
CQ.wcm.NotificationInbox.superclass.constructor.call(this,{id:"cq-notification-inbox",layout:"border",renderTo:"CQ",items:[{id:"cq-notification-inbox-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-header",xtype:"container",region:"north",autoEl:"div",cls:"cq-header-toolbar",items:[new CQ.HomeLink({})]},{xtype:"grid",id:"cq-notification-inbox-grid",region:"center",margins:"5 5 5 5",pageSize:25,loadMask:true,stripeRows:true,cm:A,sm:E,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Messages" : "Message"]})'}),bbar:new CQ.Ext.PagingToolbar({pageSize:25,store:B,displayInfo:true,displayMsg:CQ.I18n.getMessage("Displaying messages {0} - {1} of {2}"),emptyMsg:CQ.I18n.getMessage("No message to display")}),tbar:[{id:"cq-notification-inbox-read",text:CQ.I18n.getMessage("Approve"),handler:this.approveMessage,tooltip:{title:CQ.I18n.getMessage("Approve the message"),text:CQ.I18n.getMessage("Approves a message and marks it as read."),autoHide:true}},{id:"cq-notification-inbox-remove",text:CQ.I18n.getMessage("Delete"),handler:this.deleteMessage,tooltip:{title:CQ.I18n.getMessage("Delete the message"),text:CQ.I18n.getMessage("Deletes a message."),autoHide:true}},{id:"cq-notification-inbox-config",text:CQ.I18n.getMessage("Configure..."),handler:this.showConfigDialog,tooltip:{title:CQ.I18n.getMessage("Configure subscriptions"),text:CQ.I18n.getMessage("Opens the subscription configuration dialog."),autoHide:true}}],store:B}]}]})
},initComponent:function(){CQ.wcm.NotificationInbox.superclass.initComponent.call(this)
},reloadAll:function(){CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload()
},approveMessage:function(){var B=CQ.Ext.getCmp("cq-notification-inbox-grid");
var D=B.getSelectionModel().getSelections();
for(var A=0;
A<D.length;
A++){var C=D[A];
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcm/notification/inbox/action.json"),success:CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload(),failure:function(){CQ.Ext.Msg.alert("Error","Could not approve message: "+C.id)
},params:{path:C.id,cmd:"approve"}})
}B.getStore().reload()
},deleteMessage:function(){var B=CQ.Ext.getCmp("cq-notification-inbox-grid");
var D=B.getSelectionModel().getSelections();
for(var A=0;
A<D.length;
A++){var C=D[A];
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcm/notification/inbox/action.json"),success:CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload(),failure:function(){CQ.Ext.Msg.alert("Error","Could not remove message: "+C.id)
},params:{path:C.id,cmd:"delete"}})
}B.getStore().reload()
},showConfigDialog:function(){function B(M){if(M=="true"){return CQ.I18n.getMessage("Yes")
}return CQ.I18n.getMessage("No")
}function F(M){if(M=="true"){return CQ.I18n.getMessage("Allow")
}return CQ.I18n.getMessage("Deny")
}var J=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Path"),dataIndex:"path",editor:new CQ.Ext.form.TextField({allowBlank:false})},{header:CQ.I18n.getMessage("Exact?"),dataIndex:"exact",renderer:B,editor:new CQ.Ext.form.ComboBox({store:[["true",CQ.I18n.getMessage("Yes")],["false",CQ.I18n.getMessage("No")]],triggerAction:"all"})},{header:CQ.I18n.getMessage("Rule"),dataIndex:"allow",renderer:F,editor:new CQ.Ext.form.ComboBox({store:[["true",CQ.I18n.getMessage("Allow")],["false",CQ.I18n.getMessage("Deny")]],triggerAction:"all"})}]);
var H=new CQ.Ext.Action({cls:"cq-notification-subscriptions-add",text:CQ.I18n.getMessage("Add"),handler:function(){I.add(new CQ.Ext.data.Record({path:"",exact:"true",allow:"true"}))
},scope:this,tooltip:{title:CQ.I18n.getMessage("Add a subscription"),text:CQ.I18n.getMessage("Adds a new subscription."),autoHide:true}});
var D=new CQ.Ext.Action({cls:"cq-notification-subscriptions-remove",text:CQ.I18n.getMessage("Delete"),disabled:true,handler:function(){var N=CQ.Ext.getCmp("cq-notification-subscriptions-grid");
var P=N.getSelectionModel().getSelections();
for(var M=0;
M<P.length;
M++){var O=P[M];
N.getStore().remove(O)
}},tooltip:{title:CQ.I18n.getMessage("Delete the subscription"),text:CQ.I18n.getMessage("Deletes a subscription."),autoHide:true}});
var E=[H,D];
var C=new CQ.Ext.grid.RowSelectionModel({singleSelect:false,listeners:{selectionchange:function(M){if(M.hasSelection()){D.setDisabled(false)
}else{D.setDisabled(true)
}}}});
var L=[{value:"Activate",text:CQ.I18n.getMessage("Activated")},{value:"Deactivate",text:CQ.I18n.getMessage("Deactivated")},{value:"Delete",text:CQ.I18n.getMessage("Deleted (syndication)")},{value:"PageModified",text:CQ.I18n.getMessage("Modified")},{value:"PageCreated",text:CQ.I18n.getMessage("Created")},{value:"PageDeleted",text:CQ.I18n.getMessage("Deleted")},{value:"PageRolledOut",text:CQ.I18n.getMessage("Rolled out")}];
var A={autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/notification/config.json",method:"GET"}),baseParams:{start:0,limit:25},listeners:{load:function(P,N,O){var M=CQ.Ext.getCmp("inbox-channel-combo");
M.setValue(A.reader.jsonData.type);
var Q=CQ.Ext.getCmp("inbox-actions-selection");
Q.setValue(A.reader.jsonData.actions)
}},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"configs",fields:["path","exact","allow"]})};
var I=new CQ.Ext.data.GroupingStore(A);
var K={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Subscribe..."),buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){var M=CQ.Ext.getCmp("inbox-channel-combo");
var Q=CQ.Ext.getCmp("inbox-actions-selection");
var N=new Array(I.getCount());
for(var O=0;
O<I.getCount();
O++){var P=I.getAt(O);
N[O]=new Array(3);
N[O][0]=P.get("path");
N[O][1]=P.get("exact");
N[O][2]=P.get("allow")
}CQ.HTTP.post("/bin/wcm/notification/config.json",function(S,T,R){if(T){G.hide()
}},{type:M.getValue(),actions:Q.getValue(),configs:CQ.Ext.util.JSON.encode(N)})
}},CQ.Dialog.CANCEL],items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",channel:{xtype:"combo",fieldLabel:CQ.I18n.getMessage("Select Notification Channels"),editable:false,id:"inbox-channel-combo",triggerAction:"all",store:[["inbox",CQ.I18n.getMessage("Inbox")],["email",CQ.I18n.getMessage("Email")]]},actions:{xtype:"selection",type:"checkbox",fieldLabel:CQ.I18n.getMessage("Select actions to be notified"),editable:false,id:"inbox-actions-selection",options:L},sub1:{xtype:"label",text:CQ.I18n.getMessage("Define Packages")},subscriptions:{xtype:"editorgrid",id:"cq-notification-subscriptions-grid",region:"center",anchor:"-30 -100",margins:"5 5 5 5",loadMask:true,stripeRows:true,clicksToEdit:1,cm:J,sm:C,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),tbar:E,store:I,listeners:{rowcontextmenu:function(N,M,P){if(!this.contextMenu){this.contextMenu=new CQ.Ext.menu.Menu({items:E})
}var O=P.getXY();
this.contextMenu.showAt(O);
P.stopEvent()
}}}}}};
var G=CQ.WCM.getDialog(K,"cq.notification.inbox.dialog");
G.failure=function(){CQ.Ext.Msg.alert("Error","Could not save subscriptions.")
};
G.show()
}});
CQ.Ext.reg("notificationinbox",CQ.wcm.NotificationInbox);
CQ.wcm.OfflineImporter=CQ.Ext.extend(CQ.wcm.Viewport,{props:null,conn:new CQ.Ext.data.Connection(),data:null,constructor:function(A){this.debug=A.debug;
var B=new CQ.Ext.FormPanel({labelWidth:75,url:"/libs/wcm/offline/import",fileUpload:true,title:"Import",border:false,labelWidth:100,buttonAlign:"left",bodyStyle:{"background-color":"#DFE8F6",padding:"5px"},items:[{xtype:"fileuploadfield",fieldLabel:CQ.I18n.getMessage("Word Document"),fieldDescription:CQ.I18n.getMessage("Select the Word Document to import"),name:"document",anchor:"99%"},{xtype:"pathfield",anchor:"99%",selectOnFocus:true,allowBlank:false,name:"parent",fieldLabel:CQ.I18n.getMessage("Import into"),fieldDescription:CQ.I18n.getMessage("Select the location to import into")},{xtype:"hidden",name:"configPath",value:CQ.HTTP.getPath(window.location.pathname)}],buttons:[{text:"Import",handler:function(){var C={};
var D=new CQ.form.SlingSubmitAction(B.getForm(),C);
B.getForm().doAction(D)
}}]});
CQ.wcm.OfflineImporter.superclass.constructor.call(this,{id:"cq-offlineimporter",items:[{id:"cq-offlineimporter-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-offline-form",xtype:"container",region:"north",autoEl:"div",height:200,border:"false",items:[B]},{id:"cq-offlineimporter-property-grid",xtype:"propgrid",region:"center",border:true,title:"Offline Importer Configuration"}]}]});
CQ.Ext.getCmp("cq-offlineimporter-property-grid").showProperties(CQ.Ext.getCmp("cq-offlineimporter"))
},initComponent:function(){CQ.wcm.OfflineImporter.superclass.initComponent.call(this)
},getPropertyEditors:function(){var A={};
A["Page Template"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({editable:false,allowBlank:false,selectOnFocus:true,triggerAction:"all",valueField:"path",displayField:"title",store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath"]),baseParams:{_charset_:"utf-8"}}),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{thumbnailPath}">',"</tpl>",'<div class="template-title">{title}</div>','<div class="template-description">{description}</div>','<div style="clear:both"></div>',"</div>","</tpl>"),itemSelector:"div.template-item"}));
A["Text Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
A["Image Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
A["Text Image Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
return A
},getProperties:function(){if(this.data==null){var request=CQ.HTTP.get(CQ.HTTP.getPath(window.location.pathname)+".json");
this.data=CQ.Util.eval(request)
}var props=new Object();
props["Page Template"]=this.data.template;
props["Text Paragraph"]=this.data.text;
props["Image Paragraph"]=this.data.image;
props["Text Image Paragraph"]=this.data.textimage;
return props
},setProperties:function(A){this.props=A
},afterPropChange:function(){var B=this.props;
var A=new CQ.Ext.data.Connection();
A.request({scope:this,url:CQ.HTTP.getPath(window.location.pathname),params:{setconfig:"true",text:B["Text Paragraph"],image:B["Image Paragraph"],textimage:B["Text Image Paragraph"],template:B["Page Template"],type:"JSON",_charset_:"utf-8"},success:function(C,D){},failure:function(C,D){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not offline configuration!!"))
}})
}});
CQ.Ext.reg("offlineimporter",CQ.wcm.OfflineImporter);
CQ.wcm.SiteImporter=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(A){this.results=document.createElement("iframe");
this.results.id="results_cq-siteimporter";
this.results.name="results_cq-siteimporter";
this.results.height="100%";
this.results.width="100%";
this.results.onload=this.onResultsLoad;
var B=this;
CQ.wcm.SiteImporter.superclass.constructor.call(this,{id:"cq-siteimporter",layout:"border",renderTo:CQ.Util.getRoot(),items:[{id:"cq-siteimporter-wrapper",xtype:"panel",region:"center",layout:"border",border:false,items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north"},{xtype:"form",id:"cq-siteimporter-form",region:"center",fileUpload:true,standardSubmit:true,autoScroll:true,border:true,margins:"5 5 5 5",defaults:{anchor:"-54"},bodyStyle:"padding:10px",items:[{xtype:"textfield",fieldLabel:"Project Title",fieldDescription:"Title of the new project",name:"projectname",allowBlank:false},{xtype:"textfield",fieldLabel:"Site URL",fieldDescription:"URL of the original site",name:"original",allowBlank:false,vtype:"url"},{xtype:"fileuploadfield",fieldLabel:"Thumbnail",fieldDescription:"Select thumbnail image for the template",name:"preview"},{xtype:"selection",type:"checkbox",fieldLabel:"Overwrite",fieldDescription:"Overwrite existing resources. If not checked import will fail if resources exist already.",name:"overwrite"},{xtype:"textarea",fieldLabel:"Sitemap",fieldDescription:"Enter space indented sitemap for the sample content",name:"sitemap"},{xtype:"hidden",name:"_charset_",value:"utf-8"}],buttonAlign:"left",buttons:[{id:"cq-siteimporter-btn-import",text:"Import Site",handler:function(){var D=CQ.Ext.getCmp("cq-siteimporter-form").getForm();
if(D.isValid()){var C=CQ.Ext.getCmp("cq-siteimporter-btn-import");
C.setDisabled(true);
C=CQ.Ext.getCmp("cq-siteimporter-btn-extract");
C.setDisabled(true);
D.getEl().dom.action=CQ.HTTP.externalize(A.url);
D.getEl().dom.method="POST";
D.getEl().dom.target="results_cq-siteimporter";
D.submit()
}}},{id:"cq-siteimporter-btn-extract",text:"Insert Components",disabled:true,handler:function(){var C=CQ.Ext.getCmp("cq-siteimporter");
CQ.shared.Util.open(CQ.HTTP.externalize("/etc/importers/site/extractor.html#"+C.originalPath))
}},new CQ.Ext.ProgressBar({id:"cq-siteimporter-progress",width:400,hidden:true})]},{xtype:"panel",id:"cq-siteimporter-log",region:"south",title:"Import Log",margins:"-5 5 5 5",height:320,split:true,items:[new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"},listeners:{render:function(C){new CQ.Ext.Element(B.results).appendTo(C.getEl())
}}})],plugins:[{init:function(D){if(D.collapsible){var C=D.region;
if((C=="north")||(C=="south")){D.on("collapse",function(){var E=D.ownerCt;
if(E.layout[C].collapsedEl&&!D.collapsedTitleEl){D.collapsedTitleEl=E.layout[C].collapsedEl.createChild({tag:"span",cls:"x-panel-collapsed-text",html:D.title})
}},false,{single:true})
}}}}]}]}]})
},onResultsLoad:function(){var A=CQ.Ext.getCmp("cq-siteimporter-btn-import");
A.setDisabled(false);
var B=CQ.Ext.getCmp("cq-siteimporter");
if(this.contentWindow.success){B.originalPath=this.contentWindow.success;
A=CQ.Ext.getCmp("cq-siteimporter-btn-extract");
A.setDisabled(false)
}}});
CQ.Ext.reg("siteimporter",CQ.wcm.SiteImporter);
CQ.wcm.AuditLogDialog=CQ.Ext.extend(CQ.Dialog,{store:null,constructor:function(C){this.debug=C.debug;
var A=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Modification"),dataIndex:"type"},{header:CQ.I18n.getMessage("Date"),dataIndex:"date"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"}]);
var F=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var E={autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/audit/page.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"entries",fields:["type","date","user"]})};
this.store=new CQ.Ext.data.GroupingStore(E);
var D={xtype:"grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:A,sm:F,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),store:this.store};
var B=new CQ.Ext.Panel({layout:"border",width:500,minHeight:500,statefull:false,items:[D]});
dialog=this;
C.items=[B];
C.buttons=[{text:CQ.I18n.getMessage("OK"),handler:function(){dialog.hide()
}}];
CQ.wcm.AuditLogDialog.superclass.constructor.call(this,C)
},loadContent:function(A){this.setTitle(CQ.I18n.getMessage("AuditLog for")+" "+A);
this.store.baseParams.path=A;
this.store.reload()
},initComponent:function(){CQ.wcm.AuditLogDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("auditlogdialog",CQ.wcm.AuditLogDialog);
CQ.wcm.FindReplaceDialog=CQ.Ext.extend(CQ.Dialog,{selectedPaths:null,constructor:function(A){var C=this;
if(!A){A={}
}var E=new CQ.Ext.grid.CheckboxSelectionModel({listeners:{selectionchange:function(H){var G=H.getSelections();
C.selectedPaths=[];
for(var F=0;
F<G.length;
F++){C.selectedPaths.push(G[F].data.path)
}}}});
var D=function(H,G,F){if(F.data.deleted){G.attr='style="color:grey;"'
}return H
};
var B=function(){C.preview()
};
this.grid=new CQ.Ext.grid.GridPanel({id:"cq-findreplacedialog-grid",height:125,loadMask:true,stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([E,{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:true,width:200,renderer:D},{header:CQ.I18n.getMessage("Path"),dataIndex:"path",sortable:true,width:212,renderer:D}]),sm:E,store:new CQ.Ext.data.SimpleStore({fields:CQ.wcm.FindReplaceDialog.FIELDS}),enableHdMenu:false,listeners:{rowdblclick:function(G,F){try{CQ.wcm.SiteAdmin.openPage(G.getStore().getAt(F).data.path)
}catch(H){}}}});
this.previewMessage=new CQ.Static({style:"text-align:center;line-height:150px;color:#aaa;border:solid #bbb 1px",height:125});
A={id:"find-replace-dialog",title:CQ.I18n.getMessage("Find & Replace"),items:{xtype:"panel",items:[{xtype:"pathfield",name:"s",fieldLabel:CQ.I18n.getMessage("Start in"),listeners:{change:function(){C.resetPreview()
},blur:function(){if(!/\/content\/.*/.test(this.getValue())){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Start path must start with '/content'"));
this.el.focus()
}}}},{xtype:"trigger",name:"f",fieldLabel:CQ.I18n.getMessage("Find"),triggerClass:"x-form-search-trigger",onTriggerClick:B,listeners:{change:function(){C.resetPreview()
}}},{xtype:"textfield",name:"r",fieldLabel:CQ.I18n.getMessage("Replace")},{xtype:"checkbox",name:"cs",height:"auto",boxLabel:CQ.I18n.getMessage("Case sensitive"),listeners:{check:function(){C.resetPreview(true)
}}},{xtype:"checkbox",name:"wwo",boxLabel:CQ.I18n.getMessage("Whole words only"),listeners:{check:function(){C.resetPreview(true)
}}},this.previewMessage,this.grid]},listeners:{beforeshow:function(){this.resetForm();
this.resetPreview(true);
if(this.path){this.getField("s").setValue(this.path)
}},beforesubmit:function(){if((this.previewed||this.preview())&&this.selectedPaths.length>0){if(confirm(CQ.I18n.getMessage("Are you sure you want to replace '{0}' with '{1}' on all the selected page(s)?",[this.getField("f").getValue(),this.getField("r").getValue()]))){var F=this.getField("s").getValue()+CQ.wcm.FindReplaceDialog.SUFFIX_REPLACE;
this.form.baseParams={p:[]};
while(this.selectedPaths.length>0){var G=this.selectedPaths.shift();
this.form.baseParams.p.push(G)
}this.formPanel.form.el.dom.action=F;
return true
}}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("There is nothing to replace."))
}return false
}},okText:CQ.I18n.getMessage("Replace"),buttons:[{text:CQ.I18n.getMessage("Preview"),cls:"cq-btn-preview",handler:B},CQ.Dialog.OK,CQ.Dialog.CANCEL]};
CQ.wcm.FindReplaceDialog.superclass.constructor.call(this,A)
},preview:function(){if(!this.getField("s").getValue()){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Enter where you want to start searching."));
this.getField("s").el.dom.focus();
return false
}if(!this.getField("f").getValue()){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Enter what are you searching for."));
this.getField("f").el.dom.focus();
return false
}var C=this.getField("s").getValue()+CQ.wcm.FindReplaceDialog.SUFFIX_FIND;
C=CQ.HTTP.addParameter(C,"_charset_",this.getField("_charset_").getValue());
C=CQ.HTTP.addParameter(C,"f",this.getField("f").getValue());
C=CQ.HTTP.addParameter(C,"cs",this.getField("cs").getValue());
C=CQ.HTTP.addParameter(C,"wwo",this.getField("wwo").getValue());
C=CQ.HTTP.noCaching(C);
var H=new CQ.Ext.data.JsonReader({root:"matches",fields:CQ.wcm.FindReplaceDialog.FIELDS});
var J={};
try{var A=H.read(CQ.HTTP.get(C));
for(var F=0;
F<A.records.length;
F++){var E=A.records[F].data;
if(!J[E.path]){J[E.path]=[]
}var G=J[E.path];
G[G.length]=[E.title,E.path]
}}catch(I){}var D=[];
for(var B in J){D[D.length]=J[B][0]
}if(D.length>0){this.grid.getStore().loadData(D);
this.grid.getSelectionModel().selectAll();
this.grid.show();
this.previewMessage.hide();
this.previewed=this.getField("f").getValue();
return true
}else{this.resetPreview();
this.previewMessage.updateText(CQ.I18n.getMessage("No occurrences found"));
this.previewMessage.show();
return false
}},loadContent:function(A){this.path=A
},resetForm:function(){this.formPanel.getForm().reset()
},resetPreview:function(A){if(A||(this.previewed&&this.previewed!=this.getField("f").getValue())){this.previewed=null;
this.selectedPaths=[];
this.grid.hide();
this.previewMessage.updateText("");
this.previewMessage.show()
}}});
CQ.wcm.FindReplaceDialog.SUFFIX_FIND=".find.json";
CQ.wcm.FindReplaceDialog.SUFFIX_REPLACE=".replace.html";
CQ.wcm.FindReplaceDialog.FIELDS=[{name:"title"},{name:"path"}];
CQ.Ext.reg("findreplacedialog",CQ.wcm.FindReplaceDialog);
CQ.wcm.CreateVersionDialog=CQ.Ext.extend(CQ.Dialog,{constructor:function(A){var B=this;
if(!A){A={}
}A={xtype:"dialog",title:CQ.I18n.getMessage("Create Version"),formUrl:"/bin/wcmcommand",params:{cmd:"createVersion",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",autoHeight:true,autoWidtht:true,stateful:false,items:[{id:"path",xtype:"hidden",allowBlank:false,name:"path"},{id:"label",fieldLabel:CQ.I18n.getMessage("Label"),xtype:"textfield",allowBlank:true,name:"label",width:300},{id:"comment",fieldLabel:CQ.I18n.getMessage("Comment"),xtype:"textfield",allowBlank:true,name:"comment",width:300}]}]},okText:CQ.I18n.getMessage("Create"),success:function(D,E){var C=CQ.HTTP.buildPostResponseFromHTML(E.response.responseText);
CQ.Notification.notifyFromResponse(C)
}};
A.buttons=CQ.Dialog.OKCANCEL;
A.width=600;
A.height=200;
CQ.wcm.CreateVersionDialog.superclass.constructor.call(this,A)
},loadContent:function(A,B){this.form.findField("path").setValue(A);
this.form.findField("label").setValue("");
this.form.findField("comment").setValue(CQ.I18n.getMessage("Created by ")+CQ.User.getCurrentUser().getUserName())
},initComponent:function(){CQ.wcm.CreateVersionDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("createversiondialog",CQ.wcm.CreateVersionDialog);
CQ.wcm.CreateSiteWizard=CQ.Ext.extend(CQ.Dialog,{blueprintPath:null,sitePath:null,activePage:0,wizPanel:null,actListId:null,dataView:null,progressStore:null,progressTemplate:null,progressPanel:null,firstPanel:null,lastPanel:null,loadMask:null,constructor:function(C){var I=this;
var H=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath","iconPath","ranking","sitePath"]),baseParams:{_charset_:"utf-8",path:"/content",type:"site"},listeners:{load:function(){this.sort("ranking")
}}});
var M=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/CreateSiteWizard/thumb-bp-default.png");
var K=new CQ.Ext.DataView({multiSelect:false,singleSelect:true,emptyText:CQ.I18n.getMessage("No template available"),store:H,overClass:"x-view-over",itemSelector:"div.template-item",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{thumbnailPath}">',"</tpl>",'<tpl if="!thumbnailPath">','<img class="template-thumbnail" src="{this.defThumb}">',"</tpl>",'<div class="template-title">{title}</div>','<div class="template-description">{description}</div>','<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>',{defThumb:M}),prepareData:function(N){N.ranking=N.ranking!=null?N.ranking:900000000;
return N
},listeners:{selectionchange:function(N){var O=N.getSelectedRecords()[0];
if(O&&O.data){I.setBlueprintInfo(O.data)
}}}});
this.dataView=K;
var D=[{idx:0,title:"Select Blueprint"},{idx:1,title:"Finish"}];
this.progressStore=D;
var B=new CQ.Ext.XTemplate('<div class="x-toolbar x-small-editor">','<table cellspacing="0"><tr>','<tpl for=".">','<tpl if="values.idx != 0">','<td><span class="wiz-sep">&rarr;</span></td>',"</tpl>",'<td><span class="wiz-step {[this.isActive(values.idx) ? "wiz-step-active" : ""]}">{#}. {title}</span></td>',"</tpl>","</table>","</div>",{isActive:function(N){return N==I.activePage
}});
this.progressTemplate=B;
var F=new CQ.Ext.Panel({id:"cq-createsitewizard-info",border:false,html:B.apply(D)});
this.progressPanel=F;
var G=new CQ.Ext.Panel({id:"cq-card-first",layout:"form",autoScroll:true,title:CQ.I18n.getMessage("Select Blueprint"),header:false,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,defaultType:"textfield",stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false},items:[{xtype:"hidden",name:"destPath"},{xtype:"hidden",name:"srcPath"},{fieldLabel:CQ.I18n.getMessage("Title"),fieldDescription:CQ.I18n.getMessage("Page title of the new site."),allowBlank:false,name:"./jcr:title"},{fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage("Page name of the new site."),name:"label",vtype:"itemname"},{xtype:"panel",border:false,cls:"cq-template-view",autoScroll:true,width:"100%",autoHeight:false,height:370,layout:"fit",items:K,listeners:{render:{fn:function(){H.load()
}}}}]});
this.firstPanel=G;
var L=new CQ.Ext.Panel({id:"cq-card-last",layout:"form",autoScroll:true,title:CQ.I18n.getMessage("Finish"),header:false,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false},items:[{border:false,cls:"cq-card-last x-form-item",html:"<h1>Setup Complete</h1><p>You completed all steps. <br><br>Click the <em>Create Site</em> button below to create the new site.</p>"}]});
this.lastPanel=L;
var E=function(){I.navHandler.call(I,1)
};
var A=function(){I.navHandler.call(I,-1)
};
var J=new CQ.Ext.Panel({id:"cq-createsite-wizpanel",layout:"card",deferredRender:false,plain:CQ.themes.Dialog.TABPANEL_PLAIN,border:false,stateful:false,activeItem:0,bbar:F,defaults:{border:false},items:[G,L]});
this.wizPanel=J;
this.prevButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Prev"),cls:"cq-btn-prev",handler:A,disabled:true,minWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH});
this.nextButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Next"),cls:"cq-btn-next",handler:E,disabled:true,minWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH});
C={id:"cq-createsitewizard",title:CQ.I18n.getMessage("Create Site"),formUrl:"/bin/wcmcommand",params:{cmd:"createSite",_charset_:"utf-8"},height:560,width:600,items:[J],buttons:[this.prevButton,this.nextButton,CQ.Dialog.CANCEL]};
CQ.wcm.CreateSiteWizard.superclass.constructor.call(this,C)
},loadContent:function(A){this.getField("destPath").setValue(A.dstPath);
this.activePage=0;
this.actListId=null;
this.blueprintPath=null;
this.sitePath=null;
this.wizPanel.items.each(function(B){if(B.id!="cq-card-first"&&B.id!="cq-card-last"){this.remove(B,true)
}},this.wizPanel);
this.updateProgressBar();
this.wizPanel.layout.setActiveItem(0);
this.doLayout();
this.updateButtons()
},navHandler:function(C){var B=this.wizPanel.items.getCount();
var A=this.activePage+C;
if(A==B){this.ok()
}else{if(A>=0&&A<B){this.activePage=A;
this.wizPanel.layout.setActiveItem(A);
this.updateButtons()
}}},setBlueprintInfo:function(A){this.blueprintPath=A.path;
this.sitePath=A.sitePath;
this.getField("srcPath").setValue(A.path);
this.loadPanels()
},loadPanels:function(){var id=this.blueprintPath;
if(id!=this.actListId){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.wizPanel.body,{msg:"Loading..."})
}this.loadMask.show();
if(this.actListId){this.wizPanel.items.each(function(item){if(item.id!="cq-card-first"){this.remove(item,item.id!="cq-card-last")
}},this.wizPanel)
}this.actListId=id;
var url=CQ.HTTP.externalize(id+"/jcr:content/dialog.infinity.json");
var data=CQ.HTTP.eval(url);
if(data){var ct=CQ.utils.Util.formatData(data);
this.processExternalDialog(ct)
}this.wizPanel.add(this.lastPanel);
this.processPath(this.sitePath);
this.updateProgressBar();
this.doLayout();
this.updateButtons();
this.loadMask.hide()
}},updateProgressBar:function(){var B=[];
var A=0;
this.wizPanel.items.each(function(){B.push({title:this.title,idx:A++})
});
this.progressStore=B
},processExternalDialog:function(B){if(B&&B.items){if(B.items instanceof Array){for(var A=0;
A<B.items.length;
A++){this.processExternalItem(B.items[A])
}}else{this.processExternalItem(B.items)
}}},processExternalItem:function(C){if(C.xtype=="tabpanel"){this.processExternalDialog(C)
}else{if(C instanceof Array){for(var B=0;
B<C.length;
B++){this.processExternalItem(C[B])
}}else{var A=CQ.Util.applyDefaults(C,this.configDefaults.panel);
var D=A.title;
if(!D){D="untitled"
}A.header=false;
this.wizPanel.add(A)
}}},updateButtons:function(){var A=this.wizPanel.items.getCount();
if(this.activePage<A&&this.actListId){this.nextButton.enable();
if(this.activePage==A-1){this.nextButton.setText("Create Site")
}else{this.nextButton.setText("Next")
}}else{this.nextButton.disable();
this.nextButton.setText("Next")
}if(this.activePage>0){this.prevButton.enable()
}else{this.prevButton.disable()
}this.progressTemplate.overwrite(this.progressPanel.body,this.progressStore)
}});
CQ.wcm.CreateSiteWizard.setLanguagesCB=function(A){this.setOptions(CQ.wcm.CreateSiteWizard.getLanguagesCB(A))
};
CQ.wcm.CreateSiteWizard.getLanguagesCB=function(path){var flagRoot=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var data=CQ.HTTP.eval(path+".languages.json");
var opts=[];
if(data.rows){for(var i=0;
i<data.rows.length;
i++){var row=data.rows[i];
var img="<img style='position:absolute;left:2px;top:4px;height:12px;' src='"+flagRoot+row.country+".gif'>";
var lbl="<span style='padding-left: 32px'>"+row.language+"</span>";
opts.push({text:img+lbl,value:row.path,checked:i==0})
}}return opts
};
CQ.wcm.CreateSiteWizard.setChaptersCB=function(A){this.setOptions(CQ.wcm.CreateSiteWizard.getChaptersCB(A))
};
CQ.wcm.CreateSiteWizard.getChaptersCB=function(path){var url="/libs/wcm/msm/content/commands/chapters.json?path="+path;
var data=CQ.HTTP.eval(url);
var opts=[];
if(data.rows){for(var i=0;
i<data.rows.length;
i++){var row=data.rows[i];
opts.push({text:row.displayText,value:row.path,checked:true})
}}return opts
};
CQ.Ext.reg("createsitewizard",CQ.wcm.CreateSiteWizard);
CQ.wcm.Page=function(D,A,C){if(!A){A=CQ.User.getCurrentUser()
}this.user=A;
if(D&&D.status){this.info=D.status;
this.loaded=true;
this.path=D.status.path
}else{if(D&&typeof D=="string"){var B=D.indexOf("/jcr:content");
if(B==D.length-12){D=D.substring(0,B)
}this.path=D
}}this.commandUrl=C?C:"/bin/wcmcommand"
};
CQ.wcm.Page.prototype=function(){return{path:null,user:null,info:null,infoUrl:null,commandUrl:null,loaded:false,isReadOnly:function(){var ro=!this.user.hasPermissionOn(CQ.User.PERMISSION_UPDATE,this.path);
return ro||(this.isLocked()&&!this.canUnlock())
},isDesignable:function(){if(!this.loaded){this.load()
}return this.info&&this.info.isDesignable
},hasPermission:function(permission){return this.user.hasPermissionOn(permission,this.path)
},hasPermssion:function(p){return this.hasPermission(p)
},isLocked:function(){if(!this.loaded){this.load()
}return this.info&&this.info.isLocked
},canUnlock:function(){if(this.isLocked()){return CQ.User.ADMIN==this.user.getUserID()||this.getLockOwner()==this.user.getUserID()
}return true
},getLockOwner:function(){if(this.isLocked()){return this.info.lockOwner
}},lock:function(callback,scope){CQ.HTTP.post(this.commandUrl,function(options,success,response){if(success){CQ.Notification.notify(CQ.I18n.getMessage("Lock Page"),CQ.I18n.getMessage("Page successfully locked"))
}else{CQ.Notification.notifyFromResponse(response)
}if(callback&&typeof callback=="function"){if(scope){callback.call(scope,options,success,response)
}else{callback(options,success,response)
}}},{_charset_:"utf-8",path:this.path,cmd:"lockPage"})
},unlock:function(callback,scope){CQ.HTTP.post(this.commandUrl,function(options,success,response){if(success){CQ.Notification.notify(CQ.I18n.getMessage("Unlock Page"),CQ.I18n.getMessage("Page successfully unlocked"))
}else{CQ.Notification.notifyFromResponse(response)
}if(callback&&typeof callback=="function"){if(scope){callback.call(scope,options,success,response)
}else{callback(options,success,response)
}}},{_charset_:"utf-8",path:this.path,cmd:"unlockPage"})
},isInBlueprint:function(){if(!this.loaded){this.load()
}return this.info&&this.info[CQ.wcm.msm.MSM.PARAM_IS_IN_BLUEPRINT]
},isLiveCopySource:function(){if(!this.loaded){this.load()
}return this.info&&this.info[CQ.wcm.msm.MSM.PARAM_IS_SOURCE]
},isLiveCopy:function(){if(!this.loaded){this.load()
}return this.info&&this.info[CQ.wcm.msm.MSM.PARAM_IS_LIVECOPY]
},load:function(){var url=CQ.HTTP.externalize(this.path+CQ.wcm.Page.STATUS_SELECTOR+CQ.HTTP.EXTENSION_JSON);
url=CQ.HTTP.noCaching(url);
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){this.info=CQ.Util.eval(res)
}else{this.info={}
}this.loaded=true
}}
}();
CQ.wcm.Page.STATUS_SELECTOR=".status";
CQ.Page=CQ.utils.Page=CQ.wcm.Page;
CQ.wcm.Page.getCreatePageDialog=function(B){var F=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath","iconPath","ranking"]),baseParams:{_charset_:"utf-8",path:B},listeners:{load:function(){this.sort("ranking")
}}});
var E=new CQ.Ext.DataView({multiSelect:false,singleSelect:true,emptyText:CQ.I18n.getMessage("No template available"),store:F,overClass:"x-view-over",itemSelector:"div.template-item",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{[CQ.shared.HTTP.getXhrHookedURL(CQ.shared.HTTP.externalize(CQ.shared.HTTP.encodePath(values.thumbnailPath)))]}">','<div class="template-title">{title}</div>','<div class="template-description">{description}</div>',"</tpl>","<tpl if=\"thumbnailPath == ''\">",'<div class="template-title template-no-thumbnail">{title}</div>','<div class="template-description template-no-thumbnail">{description}</div>',"</tpl>",'<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>'),prepareData:function(G){G.ranking=G.ranking!=null?G.ranking:900000000;
G.thumbnailPath=G.thumbnailPath?CQ.HTTP.externalize(G.thumbnailPath):"";
G.title=CQ.I18n.getVarMessage(G.title);
G.description=G.description?CQ.I18n.getVarMessage(G.description):"";
return G
}});
var D=new CQ.Ext.form.Hidden({name:"template"});
E.refresh=function(){this.clearSelections(false,true);
this.el.update("");
var H=[];
var G=this.store.getRange();
if(G.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){this.el.update(this.emptyText)
}this.hasSkippedEmptyText=true;
this.all.clear();
return 
}this.tpl.overwrite(this.el,this.collectData(G,0));
this.all.fill(CQ.Ext.query(this.itemSelector,this.el.dom));
this.updateIndexes(0);
this.select(0)
};
var A={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-createdialog"),title:CQ.I18n.getMessage("Create Page"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"createPage",_charset_:"utf-8"},height:520,items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",title:{fieldLabel:CQ.I18n.getMessage("Title"),allowBlank:false,name:"title"},label:{fieldLabel:CQ.I18n.getMessage("Name"),vtype:"itemname",name:"label"},template:{xtype:"panel",border:false,cls:"cq-template-view",autoScroll:true,width:"100%",autoHeight:false,height:350,items:[D,E],listeners:{render:{fn:function(){F.load()
}}}}}},okText:CQ.I18n.getMessage("Create")};
var C=CQ.WCM.getDialog(A);
C.on("beforesubmit",function(){if(E.getSelectedRecords()[0]&&E.getSelectedRecords()[0].data){D.setRawValue(E.getSelectedRecords()[0].data.path)
}});
C.addHidden({parentPath:B});
return C
};
CQ.wcm.Page.getMovePageDialog=function(C,B){var A={id:CQ.Util.createId("cq-heavymovedialog"),path:C,vtype:B?null:"name"};
return new CQ.wcm.HeavyMoveDialog(A)
};
CQ.wcm.Page.getCopyPageDialog=function(E){var A=E.substring(0,E.lastIndexOf("/"));
var D=E.substring(E.lastIndexOf("/")+1);
var C=new CQ.Ext.form.Hidden({name:"shallow",value:false});
var F={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-copydialog"),title:CQ.I18n.getMessage("Copy Page"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"copyPage",_charset_:"utf-8",before:""},height:220,items:{"jcr:primaryType":"cq:Panel",items:[{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Copy"),allowBlank:false,name:"srcPath",readOnly:true,value:E},{fieldLabel:CQ.I18n.getMessage("To"),xtype:"pathfield",name:"destParentPath",value:A,listeners:{blur:function(){while(/(.*)\/$/.test(this.getValue())){this.setValue(this.getValue().replace(/(.*)\/$/,"$1"))
}}}},C,{fieldLabel:CQ.I18n.getMessage("Copy children"),xtype:"checkbox",name:"shallowCbx",checked:true,listeners:{check:function(H,G){C.setValue(!G)
}}},{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Copy name"),allowBlank:false,vtype:"itemname",name:"destName",value:D}]},okText:CQ.I18n.getMessage("Copy")};
var B=CQ.WCM.getDialog(F);
return B
};
CQ.wcm.Design=function(B,A){this.path=B;
this.content=A
};
CQ.wcm.Design.prototype=function(){return{path:null,content:null,getPath:function(){return this.path
},getContent:function(){return this.content
},getStyleProperty:function(B,C){if(this.content==null){return null
}var G="";
var A=C.lastIndexOf("/");
if(A>0){G="/"+C.substring(0,A);
C=C.substring(A+1)
}var F=B.getSearchPaths();
for(var D=0;
D<F.length;
D++){var E=this.getStyleEntry(F[D]+G);
if(E&&E[C]!=null){return E[C]
}}return null
},getStyleEntry:function(D){var A=D.split("/");
var C=this.content;
for(var B=0;
B<A.length&&C;
B++){C=C[A[B]]
}return C
}}
}();
CQ.wcm.Cell=function(A){this.searchExpr=A
};
CQ.wcm.Cell.prototype=function(){return{searchExpr:null,searchPaths:null,names:null,getSearchPaths:function(){if(!this.searchPaths){this.calculateSearchPaths()
}return this.searchPaths
},getNames:function(){if(!this.searchPaths){this.calculateSearchPaths()
}return this.names
},getSearchExpression:function(){return this.searchExpr
},calculateSearchPaths:function(){this.names=[];
this.searchPaths=[];
var G=this.searchExpr.split("/");
var D=[];
var E;
for(E=0;
E<G.length;
E++){if(G[E].length>0){D[D.length]=G[E].split("|")
}}if(D.length>0){var H=0;
var B=D.length;
this.names=D[--B];
var F=[];
while(H<B){var A=D[H++];
if(this.searchPaths.length==0){for(E=0;
E<A.length;
E++){this.searchPaths[this.searchPaths.length]=A[E];
F[F.length]=A[E]
}}else{var C=this.multiply(F,A);
F=[];
for(E=0;
E<C.length;
E++){F[E]=C[E]
}for(E=0;
E<this.searchPaths.length;
E++){C[C.length]=this.searchPaths[E]
}this.searchPaths=C
}}this.searchPaths=this.multiply(this.searchPaths,this.names);
for(E=0;
E<this.names.length;
E++){this.searchPaths[this.searchPaths.length]=this.names[E]
}}},multiply:function(H,G){var D=[];
for(var C=0;
C<H.length;
C++){var F=H[C];
for(var B=0;
B<G.length;
B++){var A=G[B];
var E=F;
if(E.length>0){E+="/"
}E+=A;
D[D.length]=E
}}return D.concat(H)
}}
}();
CQ.wcm.ComponentList=CQ.Ext.extend(CQ.Ext.util.Observable,{path:null,allComponents:null,allowedComponents:{},allowedString:"",allowedByCell:{},constructor:function(B,A){this.path=B;
this.allComponents=A;
this.allowedByCell={};
this.addEvents("updatecomponents")
},update:function(K,H){var A=K.getSearchExpression();
var C=this.allowedString;
if(H){H=CQ.Ext.isArray(H)?H:[H];
var E={};
var F=0;
for(var D=0;
D<H.length;
D++){var B=H[D];
var G=B.substring(0,6);
if(G=="group:"){var J=B.substring(6);
for(B in this.allComponents){if(this.allComponents[B].group==J){E[B]=true;
F++
}}}else{if(G=="/libs/"||G=="/apps/"){B=B.substring(6)
}E[B]=true;
F++
}}this.allowedByCell[A]=E;
if(F>0){this.refresh()
}}else{var I=!!this.allowedByCell[A];
delete this.allowedByCell[A];
if(I){this.refresh()
}}if(C!=this.allowedString){this.fireEvent("updatecomponents",this)
}},refresh:function(){var C={};
var E="";
for(var D in this.allowedByCell){var B=this.allowedByCell[D];
if(B){for(var A in B){C[A]=true;
E+=A+","
}}}this.allowedComponents=C;
this.allowedString=E
},getAllComponents:function(){return this.allComponents
},getComponent:function(A){return this.allComponents[A]
},getAllowedComponents:function(A){var C;
if(A){C=this.allowedByCell[A.getSearchExpression()];
if(!C){return{}
}}else{C=this.allowedComponents
}var D={};
for(var B in C){D[B]=this.allComponents[B]
}return D
},isAllowed:function(B,A){return !!this.getAllowedComponents(A)[B]
}});
CQ.wcm.ComponentList.RECORD=CQ.Ext.data.Record.create([{name:"path"},{name:"title"},{name:"description"},{name:"thumbnail"},{name:"icon"},{name:"virtual"},{name:"config"},{name:"dialog"}]);
CQ.wcm.ComponentList.TEMPLATE=new CQ.Ext.XTemplate('<tpl for=".">','<table cellspacing="0" class="x-btn x-btn-noicon {[CQ.DOM.encodeClass(values.title, "cq-cmpt")]}" title="{description}"><tbody>','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em unselectable="on">','<button class="x-btn-text {[CQ.DOM.encodeClass(values.path)]}" type="button"','<tpl if="icon">',' style="background:transparent url({icon}) 0 3px no-repeat;padding:3px 0pt 2px 18px"',"</tpl>",">{title}</button>",'</em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>","</tpl>");
CQ.wcm.ComponentList.loadPanel=function(D,C,B){var A=B?B.getParent().getCell():null;
D.panel=C;
var E=A?A.getSearchExpression():"__sidekick__";
var G=D.getAllowedComponents(A);
var F=new CQ.Ext.util.MixedCollection();
CQ.wcm.ComponentList.updateStores(F,G,!!A);
F.each(function(J,H,I){C.add(new CQ.Ext.Panel(CQ.Util.formatData({title:J.group,cls:"cq-sidekick-buttons "+CQ.DOM.encodeClass(J.group,"cq-cmpts"),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:CQ.wcm.ComponentList.createDataView(J,B),listeners:{collapse:function(){if(B){this.get(0).clearSelections();
B.selectInsertComponent(null)
}}}})))
},this);
C.doLayout()
};
CQ.wcm.ComponentList.MAX_GROUPS=4;
CQ.wcm.ComponentList.MIN_COMPS=3;
CQ.wcm.ComponentList.updateStores=function(D,E){for(var G in E){var B=E[G];
if(!B){continue
}if(!B.icon){B.icon=CQ.themes.wcm.Sidekick.ICON_COMPONENT
}B.icon=CQ.shared.HTTP.getXhrHookedURL(B.icon);
var F=B.group;
if(F==null||F==""){F="General"
}var H;
if(D.containsKey(F)){H=D.item(F)
}else{H=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},CQ.wcm.ComponentList.RECORD)});
H.group=F;
D.add(F,H)
}H.addSorted(new CQ.Ext.data.Record(B,G))
}if(D.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){var C="Other";
if(D.containsKey(C)){H=D.item(C)
}else{H=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},CQ.wcm.ComponentList.RECORD)});
H.group=C
}D.each(function(I){if(I.group.toUpperCase()=="GENERAL"){return 
}if(I.getCount()<CQ.wcm.ComponentList.MIN_COMPS){I.each(function(J){H.add(J)
});
D.remove(I)
}});
if(D.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){D.sort("ASC",function(J,I){var K=J.getCount();
var L=I.getCount();
if(K>L){return 1
}else{if(K<L){return -1
}else{return 0
}}});
while(D.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){var A=D.first();
A.each(function(I){H.add(I)
});
D.remove(A)
}}D.add(C,H)
}D.sort("ASC",function(J,I){var N=J.group.toUpperCase();
var K=CQ.I18n.getVarMessage(J.group);
var M=I.group.toUpperCase();
var L=CQ.I18n.getVarMessage(I.group);
if(N=="GENERAL"){return -1
}else{if(M=="GENERAL"){return 1
}}if(N=="OTHER"){return 1
}else{if(M=="OTHER"){return -1
}}if(K>L){return 1
}if(K<L){return -1
}return 0
});
return D
};
CQ.wcm.ComponentList.createDataView=function(C,A){var B={};
if(!A){B.render=function(D){var E={containerScroll:false};
if(CQ.utils.WCM.getContentFinder()){D.dragZone=new CQ.wcm.Sidekick.DragZone4ContentFinder(D,E)
}else{D.dragZone=new CQ.wcm.Sidekick.DragZone(D,E)
}D.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT);
D.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
CQ.wcm.Sidekick.componentsWithDragZone.push(D)
}
}else{B.click=function(E){try{A.selectInsertComponent(E.getSelectedRecords()[0])
}catch(D){}}
}return new CQ.Ext.DataView({tpl:CQ.wcm.ComponentList.TEMPLATE,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-btn-over",selectedClass:"x-btn-selected",itemSelector:"table.x-btn",loadingText:CQ.I18n.getMessage("Loading components"),listeners:B,store:C,prepareData:function(D){D.title=CQ.I18n.getVarMessage(D.title);
D.description=D.description?CQ.I18n.getVarMessage(D.description):"";
if(D.virtual){D.virtualResourceType=D.path.substring(D.path.indexOf("/",1)+1)
}return D
}})
};
CQ.wcm.RestoreVersionDialog=CQ.Ext.extend(CQ.Dialog,{revisionsTable:null,gridStore:null,comboStore:null,dataUrl:null,path:null,fields:null,sm:null,constructor:function(B){var D=this;
if(!B){B={}
}this.dataUrl=B.dataUrl||"/bin/wcm/versions.json";
this.fields=[{name:"name"},{name:"title"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"}];
this.gridStore=new CQ.Ext.data.SimpleStore({fields:this.fields});
this.comboStore=new CQ.Ext.data.SimpleStore({fields:this.fields,sortInfo:{field:"created",direction:"DESC"}});
this.sm=new CQ.Ext.grid.CheckboxSelectionModel();
function E(H,G,F){if(F.data.deleted){G.attr='style="color:grey;"'
}return H
}var A=new CQ.Ext.grid.ColumnModel([this.sm,{header:CQ.I18n.getMessage("Name"),dataIndex:"name",hidden:"true"},{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:true,width:100,renderer:E},{header:CQ.I18n.getMessage("Created"),dataIndex:"created",width:200,editor:new CQ.Ext.form.ComboBox({triggerAction:"all",editable:false,store:this.comboStore,displayField:"created",valueField:"created",mode:"local"}),renderer:E},{header:CQ.I18n.getMessage("Name"),dataIndex:"label",sortable:true,width:100,renderer:E},{header:CQ.I18n.getMessage("Id"),dataIndex:"id",hidden:"true"},{header:CQ.I18n.getMessage("Deleted"),dataIndex:"deleted",hidden:"true"}]);
var C={xtype:"editorgrid",id:"restore-version-grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:A,sm:this.sm,store:this.gridStore,enableHdMenu:false,listeners:{beforeedit:function(G){var F=D.revisionsTable[G.record.data.name];
D.comboStore.loadData(F)
}},clicksToEdit:1};
B=CQ.Util.applyDefaults(B,{xtype:"dialog",cls:"cq-restoreversiondialog",title:CQ.I18n.getMessage("Restore Version"),formUrl:B.formUrl||"/bin/wcmcommand",params:{cmd:"restoreVersion",_charset_:"utf-8"},items:{xtype:"panel",layout:"border",width:500,minHeight:500,stateful:false,items:[C]},listeners:{beforesubmit:function(){if(D.sm.hasSelection()){D.findById("restore-version-grid").stopEditing();
var G=CQ.Util.findFormFields(D.formPanel);
var L=G.path;
if(L){G.remove(L)
}L=G.id;
if(L){G.remove(L)
}D.addHidden({path:D.path});
var F=D.sm.getSelections();
for(var I=0;
I<F.length;
I++){var K=F[I];
var J=D.revisionsTable[K.data.name];
for(var H=0;
H<J.length;
H++){if(J[H][2]==K.data.created){D.addHidden({id:J[H][4]})
}}}return true
}return false
}},okText:CQ.I18n.getMessage("Restore")});
B.buttons=CQ.Dialog.OKCANCEL;
CQ.wcm.RestoreVersionDialog.superclass.constructor.call(this,B)
},loadContent:function(K,I){this.path=K;
var C=CQ.HTTP.addParameter(this.dataUrl,"path",K);
if(I){C=CQ.HTTP.addParameter(C,"showChildren",true)
}C=CQ.HTTP.noCaching(C);
var H=new CQ.Ext.data.JsonReader({root:"versions",fields:this.fields});
var E={};
var A=H.read(CQ.HTTP.get(C));
for(var G=0;
G<A.records.length;
G++){var F=A.records[G].data;
var B=F.name;
if(!E[F.name]){E[F.name]=[]
}var J=E[F.name];
J[J.length]=[F.name,F.title,F.created,F.label,F.id,F.deleted]
}this.revisionsTable=E;
var D=[];
for(var B in E){D[D.length]=E[B][0]
}this.gridStore.loadData(D);
this.sm.clearSelections()
},initComponent:function(){CQ.wcm.RestoreVersionDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("restoreversiondialog",CQ.wcm.RestoreVersionDialog);
CQ.wcm.RestoreTreeDialog=CQ.Ext.extend(CQ.Dialog,{dataUrl:null,treeLoaderConfig:null,treePath:null,root:null,constructor:function(A){var E=this;
if(!A){A={}
}this.dataUrl=A.dataUrl||"/bin/wcm/versiontree";
var B=CQ.Util.applyDefaults(A.treeRoot||{},{name:"",text:CQ.I18n.getMessage("Site"),draggable:false,singleClickExpand:true,id:".",iconCls:"page"});
var D=CQ.Util.applyDefaults(A.treeLoader||{},{dataUrl:this.dataUrl,requestMethod:"GET",baseAttrs:{iconCls:"page",singleClickExpand:true},listeners:{beforeload:function(G,I){var H=E.form;
if(H&&H.isValid()){this.baseParams.path=H.findField("path").getValue();
this.baseParams.date=H.findField("date").getValue();
return true
}return false
}}});
var F=new CQ.Ext.tree.TreeLoader(D);
E.root=new CQ.Ext.tree.AsyncTreeNode(B);
var C=new CQ.Ext.tree.TreePanel({anchor:"100%",bodyBorder:CQ.themes.BrowseDialog.TREE_BORDER,bodyStyle:CQ.themes.BrowseDialog.TREE_STYLE,autoScroll:true,containerScroll:true,loader:F,root:E.root,defaults:{draggable:false},height:260,rootVisible:false});
A=CQ.Util.applyDefaults(A,{xtype:"dialog",cls:"cq-restoretreedialog",title:CQ.I18n.getMessage("Restore Tree"),formUrl:"/bin/wcmcommand",params:{cmd:"restoreTree",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"pathfield",id:A.id?A.id+"-path":"",fieldLabel:CQ.I18n.getMessage("Choose a tree"),allowBlank:false,name:"path",readOnly:true,width:300,value:A.treePath||""},{fieldLabel:CQ.I18n.getMessage("Date"),xtype:"datetime",allowBlank:false,name:"date",value:A.date||new Date(),valueAsString:true},{xtype:"button",id:A.id?A.id+"-show":"",text:CQ.I18n.getMessage("Show Revisions"),handler:function(){F.load(E.root)
}}]},C]},listeners:{beforesubmit:function(){return E.root.hasChildNodes()
}},okText:CQ.I18n.getMessage("Restore")});
A.buttons=CQ.Dialog.OKCANCEL;
A.width=600;
A.height=470;
CQ.wcm.RestoreTreeDialog.superclass.constructor.call(this,A)
},loadContent:function(A){this.form.findField("path").setValue(A);
this.form.findField("date").setValue(new Date());
while(this.root.firstChild){this.root.removeChild(this.root.firstChild)
}},initComponent:function(){CQ.wcm.RestoreTreeDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("restoretreedialog",CQ.wcm.RestoreTreeDialog);
CQ.wcm.HeavyMoveDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,vtype:null,constructor:function(C){if(!C){C=new Object()
}this.dataPath=C.dataPath;
if(!this.dataPath){this.dataPath="/bin/wcm/heavymove"
}this.vtype=C.vtype?C.vtype:"itemname";
this.path=C.path;
var G=new CQ.wcm.HeavyMoveDialog.CheckColumn({header:CQ.I18n.getMessage("Adjust"),dataIndex:"adjust",enabledIf:"adjustable",width:40});
var H=new CQ.wcm.HeavyMoveDialog.CheckColumn({header:CQ.I18n.getMessage("Republish"),dataIndex:"publish",enabledIf:"published",width:60});
var K=new CQ.Ext.grid.ColumnModel([G,H,{header:CQ.I18n.getMessage("Title"),dataIndex:"title",width:130},{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path",width:220}]);
K.defaultSortable=true;
var E=this;
this.store=new CQ.Ext.data.JsonStore({url:CQ.shared.HTTP.externalize(CQ.HTTP.addParameter(this.dataPath,"path",this.path)),root:"pages",fields:[{name:"title"},{name:"path"},{name:"published"},{name:"adjustable"},{name:"publish",defaultValue:true},{name:"adjust",defaultValue:true}],listeners:{beforeload:function(){E.loadingRefs=true
},load:function(){E.loadingRefs=false
},loadexception:function(){E.loadingRefs=false;
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("The page you are about to move is referenced by pages you are not allowed to modify"));
E.hide()
}}});
var A=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:K,height:238,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,loadMask:{msg:CQ.I18n.getMessage("Loading references...")}});
G.init(A);
H.init(A);
A.on("headerclick",function(M,L,O){if(L==0||L==1){var P=L==0?"adjust":"publish";
var N;
M.store.each(function(Q){if(typeof N=="undefined"){N=!Q.data[P]
}Q.set(P,N);
Q.dirty=false;
return true
})
}return true
});
var F=this.path.lastIndexOf("/");
var B=this.path.substring(0,F);
var D=this.path.substring(F+1);
var I=C.dstParentPath?C.dstParentPath:B;
var J=C.dstName?C.dstName:D;
C=CQ.Util.applyDefaults(C,{xtype:"dialog",title:CQ.I18n.getMessage("Move"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"movePage",integrity:"true",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",title:"Location",autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Move"),allowBlank:false,name:"srcPath",readOnly:true,value:this.path},{fieldLabel:CQ.I18n.getMessage("to"),xtype:"pathfield",anchor:"100%",name:"destParentPath",value:I,listeners:{blur:function(){while(/(.*)\/$/.test(this.getValue())){this.setValue(this.getValue().replace(/(.*)\/$/,"$1"))
}}}},{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Rename to"),allowBlank:false,vtype:this.vtype,name:"destName",value:J}]},A]},listeners:{show:function(){A.getStore().load()
}},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("An error occured while moving page"))
}});
C.buttons=[{text:CQ.I18n.getMessage("Move"),cls:"cq-btn-move",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Move Page"),msg:CQ.I18n.getMessage("Please wait until the references are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return 
}var M=this;
var L=this.getField("destParentPath").getValue();
if(L==this.path||L.indexOf(this.path+"/")==0){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Move Page"),msg:CQ.I18n.getMessage("Page cannot be moved below itself."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR});
return 
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Move Page"),CQ.I18n.getMessage("Do you really want to move the page to the selected destination?"),function(N){if(N=="yes"){M.ok.call(M)
}})
}},CQ.Dialog.CANCEL];
C.width=600;
C.height=470;
CQ.wcm.HeavyMoveDialog.superclass.constructor.call(this,C);
this.on("beforesubmit",function(){var L=this;
L.store.each(function(M){if(M.data.adjust&&M.data.adjustable){L.addHidden({adjust:M.data.path})
}if(M.data.publish&&M.data.published){L.addHidden({publish:M.data.path})
}});
return true
})
}});
CQ.Ext.reg("heavymovedialog",CQ.wcm.HeavyMoveDialog);
CQ.wcm.HeavyMoveDialog.CheckColumn=function(A){CQ.Ext.apply(this,A);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.HeavyMoveDialog.CheckColumn.prototype={init:function(A){this.grid=A;
this.grid.on("render",function(){var B=this.grid.getView();
B.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(D,C){if(C.className&&C.className.indexOf("x-grid3-cc-"+this.id)!=-1){D.stopEvent();
var B=this.grid.getView().findRowIndex(C);
var A=this.grid.store.getAt(B);
A.set(this.dataIndex,!A.data[this.dataIndex]);
A.dirty=false
}},renderer:function(B,C,A){if(!this.enabledIf||A.data[this.enabledIf]){C.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(B?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return"&nbsp;"
}}};
CQ.wcm.AssetReferenceSearchDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,constructor:function(C){if(!C){C=new Object()
}this.dataPath=C.dataPath;
if(!this.dataPath){this.dataPath="/libs/wcm/core/content/assetreference.json"
}this.path=C.path;
var B=new CQ.wcm.AssetReferenceSearchDialog.CheckColumn({id:"publish",header:CQ.I18n.getMessage("(Re)Publish"),dataIndex:"publish",width:80});
var A=new CQ.Ext.grid.ColumnModel([B,{id:"name",header:CQ.I18n.getMessage("Name"),dataIndex:"name",renderer:function(F,I,H){var G=H.get("path");
return'<span ext:qtip="'+G+'">'+F+"</span>"
}},{id:"status",header:CQ.I18n.getMessage("Status on Publish"),dataIndex:"status",width:120,renderer:function(F,H,G){return F=="outdated"?CQ.I18n.getMessage("Outdated"):CQ.I18n.getMessage("Not available")
}},{header:CQ.I18n.getMessage("Type"),dataIndex:"type",hidden:true,groupRenderer:function(F){switch(F){case"asset":return CQ.I18n.getMessage("Assets");
case"tag":return CQ.I18n.getMessage("Tags");
default:return CQ.I18n.getMessage("Unknown")
}}}]);
A.defaultSortable=true;
var E=this;
this.store=new CQ.Ext.data.GroupingStore({reader:new CQ.Ext.data.JsonReader({root:"assets",fields:[{name:"type"},{name:"name"},{name:"path"},{name:"published"},{name:"outdated"},{name:"status"},{name:"publish",defaultValue:true},{name:"disabled"}]}),url:CQ.HTTP.addParameter(this.dataPath,"path",this.path),groupField:"type",sortInfo:{field:"type",direction:"ASC"},listeners:{beforeload:function(){E.loadingRefs=true
},load:function(){E.loadingRefs=false;
var F=this;
if(this.getTotalCount()==0){E.callback(E.path)
}else{E.show()
}}}});
var D=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:A,flex:1,disableSelection:true,enableHdMenu:false,autoExpandColumn:"name",clicksToEdit:1,loadMask:{msg:CQ.I18n.getMessage("Loading references...")},view:new CQ.Ext.grid.GroupingView({groupTextTpl:"{group}"})});
B.init(D);
C=CQ.Util.applyDefaults(C,{xtype:"dialog",title:CQ.I18n.getMessage("Activate"),formUrl:"/bin/replicate.json",items:{xtype:"panel",layout:"vbox",layoutConfig:{padding:"0 15 0 0"},items:[{xtype:"static",height:30,cls:"x-form-item-description",text:CQ.I18n.getMessage("The following assets and tags need to be published along with the selected page(s):")},D]},listeners:{render:function(){D.getStore().load()
}},callback:function(F){CQ.Log.WARN("No callback defined")
}});
C.buttons=[{text:CQ.I18n.getMessage("Activate"),cls:"cq-btn-move",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Activate"),msg:CQ.I18n.getMessage("Please wait until the references are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return 
}var F=this;
F.store.each(function(G){if(G.data.publish){F.path.push(G.data.path)
}});
F.callback(F.path);
F.hide()
}},CQ.Dialog.CANCEL];
C.width=600;
C.height=370;
CQ.wcm.AssetReferenceSearchDialog.superclass.constructor.call(this,C)
}});
CQ.Ext.reg("assetreferencesearchdialog",CQ.wcm.AssetReferenceSearchDialog);
CQ.wcm.AssetReferenceSearchDialog.CheckColumn=function(A){CQ.Ext.apply(this,A);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.AssetReferenceSearchDialog.CheckColumn.prototype={init:function(A){this.grid=A;
this.grid.on("render",function(){var B=this.grid.getView();
B.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(D,C){if(C.className&&C.className.indexOf("x-grid3-cc-"+this.id)!=-1){D.stopEvent();
var B=this.grid.getView().findRowIndex(C);
var A=this.grid.store.getAt(B);
A.set("publish",!A.data.publish);
A.dirty=false
}},renderer:function(B,C,A){if(!A.data[this.id].disabled){C.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(B?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return""
}}};
CQ.wcm.ReferencesDialog=CQ.Ext.extend(CQ.Dialog,{TXT_REFERENCE:CQ.I18n.getMessage("reference"),TXT_REFERENCES:CQ.I18n.getMessage("references"),store:null,dataPath:null,path:null,constructor:function(B){var D=this;
if(!B){B=new Object()
}this.dataPath=B.dataPath;
if(!this.dataPath){this.dataPath="/bin/wcm/references"
}this.addEvents("pageopen");
this.path=B.path;
var A=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Title"),dataIndex:"title",width:130},{header:CQ.I18n.getMessage("srcPath"),dataIndex:"srcPath",width:130,hidden:true},{header:CQ.I18n.getMessage("srcTitle"),dataIndex:"srcTitle",width:130,hidden:true},{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path",width:220}]);
A.defaultSortable=true;
this.store=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:this.dataPath,method:"GET"}),baseParams:{path:this.path},reader:new CQ.Ext.data.JsonReader({root:"pages",totalProperty:"results",fields:[{name:"title",type:"string"},{name:"path",type:"string"},{name:"srcPath",type:"string"},{name:"srcTitle",type:"string"}]}),sortInfo:{field:"srcPath",direction:"ASC"},groupField:"srcPath",listeners:{load:function(E,G,F){if(G.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("No References"),D.path.length==1?CQ.I18n.getMessage("The selected item is not referenced."):CQ.I18n.getMessage("The selected items are not referenced."),function(){D.close()
})
}}}});
var C=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:A,sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true}),frame:false,view:new CQ.Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data.srcTitle]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+this.TXT_REFERENCES+'" : "'+this.TXT_REFERENCE+'"]})'}),disableSelection:true,enableHdMenu:false,hideHeaders:true,autoExpandColumn:"path",listeners:{rowdblclick:function(F,E,H){var G=F.store.getAt(E);
D.fireEvent("pageopen",D,G.data.path)
}}});
B={xtype:"dialog",title:CQ.I18n.getMessage("References"),formUrl:"/bin//dev/null",items:[C]};
B.buttons=[CQ.Dialog.CANCEL];
B.width=600;
B.height=370;
CQ.wcm.ReferencesDialog.superclass.constructor.call(this,B)
},initComponent:function(){this.store.load();
CQ.wcm.ReferencesDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("referencesdialog",CQ.wcm.ReferencesDialog);
CQ.wcm.LanguageCopyDialog=CQ.Ext.extend(CQ.Dialog,{store:null,path:null,rootPath:null,constructor:function(C){if(!C){C=new Object()
}var H=this;
this.path=C.path;
this.rootPath=C.path;
var B=this.path+".languages.json?deep=true";
var F=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var A=new CQ.Ext.grid.ColumnModel([{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path"}]);
A.defaultSortable=false;
var G=[];
var E={};
this.store=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:B}),reader:new CQ.Ext.data.JsonReader(),listeners:{metachange:function(I,M){H.rootPath=M.rootPath;
var L=[];
G=M.fields;
for(var J=0;
J<M.fields.length;
J++){var K=M.fields[J];
if(K.name=="path"){var N=CQ.I18n.getMessage("Path");
N+="<br>"+M.rootPath+"/*";
L.push({id:"path",header:N,dataIndex:"path",title:" "});
continue
}E[K.name]=new CQ.Ext.data.SimpleStore({fields:["value","text"]});
var N=CQ.I18n.getVarMessage(K.text);
var O='<img style="height:24px" src="'+F+K.country+'.gif" alt="'+N+'" title="'+N+'">';
O+="<br>"+N;
L.push({header:O,title:N,dataIndex:K.name,renderer:CQ.wcm.LanguageCopyDialog.LangRenderer,width:64,editor:new CQ.Ext.form.ComboBox({listWidth:140,triggerAction:"all",editable:false,store:E[K.name],valueField:"value",displayField:"text",mode:"local"})});
L.sort(function(Q,P){if(Q.title<P.title){return -1
}else{if(Q.title==P.title){return 0
}else{return 1
}}})
}A.setConfig(L)
}}});
var D=new CQ.Ext.grid.EditorGridPanel({store:this.store,stateful:false,cm:A,margin:"12",frame:false,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,listeners:{beforeedit:function(L){if(L.value.hasContent){return false
}var J=[["",CQ.I18n.getMessage("(auto)")],["-",CQ.I18n.getMessage("(ignore)")]];
for(var M=0;
M<G.length;
M++){var K=G[M];
if(K.name=="path"||K.name==L.field){continue
}if(L.record.data[K.name].hasContent){var I=CQ.I18n.getVarMessage(K.text);
J.push([K.name,I]);
J.push([K.name+"+",I+"+"])
}}E[L.field].loadData(J)
}}});
C=CQ.Util.applyDefaults(C,{xtype:"dialog",title:CQ.I18n.getMessage("Language Copy"),formUrl:"/bin/wcmcommand",params:{cmd:"copyLanguages",_charset_:"utf-8"},items:D});
C.buttons=[{text:CQ.I18n.getMessage("OK"),handler:function(){D.stopEditing();
if(H.store.getModifiedRecords().length==0){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Language Copy"),msg:CQ.I18n.getMessage("No copy operations specified."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR});
return 
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Language Copy"),CQ.I18n.getMessage("Do you really want to copy the respective pages?"),function(I){if(I=="yes"){H.ok.call(H)
}})
}},CQ.Dialog.CANCEL];
C.width=700;
C.height=500;
CQ.wcm.LanguageCopyDialog.superclass.constructor.call(this,C);
this.on("beforesubmit",function(){var N=this;
N.addHidden({path:N.rootPath});
var J=N.store.getModifiedRecords();
for(var K=0;
K<J.length;
K++){var L=J[K];
for(var O in L.data){if(O=="path"){continue
}var I=L.data[O];
if(I&&(typeof I!="object")){var M={};
M[O+"/"+L.data.path]=I;
N.addHidden(M)
}}}return true
})
},initComponent:function(){this.store.load();
CQ.wcm.LanguageCopyDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("languagecopydialog",CQ.wcm.LanguageCopyDialog);
CQ.wcm.LanguageCopyDialog.LangRenderer=function(B,C,A){if(typeof B=="object"){return B&&B.hasContent?"X":""
}else{return B
}};
CQ.wcm.ContentFinderDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{scroll:false,IDDM_startX:0,IDDM_startY:0,IDDM_dragThreshMet:false,dropTargets:[],dropTargetRegions:[],constructor:function(B,A){B.on("remove",function(){this.destroy()
},this);
B.on("destroy",function(){this.destroy()
},this);
CQ.wcm.ContentFinderDragZone.superclass.constructor.call(this,B,A)
},destroy:function(){clearTimeout(this.IDDM_clickTimeout);
CQ.Ext.EventManager.un(document,"mousemove",this.IDDM_handleMouseMove,this);
CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.wcm.ContentFinderDragZone.superclass.destroy.call(this)
},matchRange:function(C,A,B){if(!C||!A){return false
}if(!B){B=20
}return(A[0]>C[0]-B&&A[0]<C[0]+B&&A[1]>C[1]-B&&A[1]<C[1]+B)
},updateMouseInfo:function(A,C){try{this.mouse.time=new Date().valueOf();
this.mouse.pos=[A,C]
}catch(B){}},onDragEnter:function(C,D){var B=(typeof D=="string")?CQ.Ext.dd.DragDropMgr.getDDById(D):D;
this.cachedTarget=B;
if(this.beforeDragEnter(B,C,D)!==false){if(B.isNotifyTarget){var A=B.notifyEnter(this,C,this.dragData);
this.proxy.setStatus(A)
}else{this.proxy.setStatus(this.dropAllowed)
}if(this.afterDragEnter){this.afterDragEnter(B,C,D)
}}},onDragCancel:function(){},GEN_handleKeyPress:function(A){if(!CQ.WCM.isContentWindowLoading()){if(A.getKey()==A.ESC){CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.un(document,"keypress",this.GEN_handleKeyPress,this);
CQ.Ext.EventManager.un(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
if(this.proxy){this.proxy.repair(this.getRepairXY(A,this.dragData),this.afterRepair,this)
}clearTimeout(this.IDDM_clickTimeout);
this.onDragCancel(A,this.cachedTarget);
this.IDDM_dragCurrent=false;
this.dragging=false;
window.setTimeout(this.CF_cleanUpDD,1)
}}},handleMouseDown:function(E){if(!CQ.WCM.isContentWindowLoading()){if(this.primaryButtonOnly&&E.button!=0&&E.type!="mousedown"){return 
}if(this.isLocked()){return 
}this.CF_cleanUpDD();
var D=new CQ.Ext.lib.Point(CQ.Ext.lib.Event.getPageX(E),CQ.Ext.lib.Event.getPageY(E));
if(this.IDDM_isOverTarget(D,this)&&this.clickValidator(E)){CQ.Ext.EventManager.on(document,"mousemove",this.IDDM_handleMouseMove,this);
CQ.Ext.EventManager.on(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.on(document,"keypress",this.GEN_handleKeyPress,this);
CQ.Ext.EventManager.on(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
this.setStartPosition();
if(this.dragging){return 
}this.IDDM_dragCurrent=true;
var C=this.getDragData(E);
if(C&&this.onBeforeDrag(C,E)!==false){this.dragData=C;
this.proxy.stop()
}this.b4MouseDown(E);
this.onMouseDown(E);
this.IDDM_startX=E.getPageX();
this.IDDM_startY=E.getPageY();
this.IDDM_deltaX=this.IDDM_startX-this.getEl().offsetLeft;
this.IDDM_deltaY=this.IDDM_startY-this.getEl().offsetTop;
this.IDDM_dragThreshMet=false;
var A=E.getPageX();
var F=E.getPageY();
var B=this;
this.IDDM_clickTimeout=setTimeout(function(){B.IDDM_startDrag(A,F)
},this.DDM.clickTimeThresh);
this.IDDM_stopEvent(E)
}}},CF_storeDropTargets:function(C){if(!CQ.WCM.isContentWindowLoading()){if(!C.isVisible()||!C.getDropTargets||!this.isDropAllowed){return 
}if(C.isDropAllowedForObject&&(typeof (C.isDropAllowedForObject)=="function")){if(!C.isDropAllowedForObject(this.dragData)){return 
}}var B=C.getDropTargets();
if(!B){return 
}var A=CQ.WCM.getContentWindow();
try{if(!A.CQ){return 
}}catch(G){return 
}for(var D=0;
D<B.length;
D++){var F=B[D];
if(F.isLocked()||!this.isDropAllowed(F)){continue
}var E=A.CQ.Ext.lib.Region.getRegion(F.getEl());
this.dropTargets.push(F);
this.dropTargetRegions.push(E)
}}},CF_cleanUpDD:function(){CQ.wcm.ContentFinder.unmaskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
this.dragging=false;
this.IDDM_dragCurrent=false
},CF_b4StartDrag:function(A,G){if(!CQ.WCM.isContentWindowLoading()){var F=CQ.WCM.getContentFinder();
if(!F){throw new Error("No finder defined")
}F.contentWindowLeft=CQ.Ext.get("cq-cf-framewrapper").getX();
var C=CQ.wcm.ContentFinder.maskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
var B=CQ.WCM.getContentWindow();
try{if(!B.CQ){return 
}}catch(E){return 
}var D=this;
window.setTimeout(function(){var I=B.CQ.WCM.getDialogs();
for(var S in I){var O=I[S];
if(!O.isVisible()){continue
}var H=O.getActiveTab();
var N=CQ.Util.findFormFields(H);
for(var J in N){var K=N[J];
for(var M=0;
M<K.length;
M++){D.CF_storeDropTargets(K[M],D)
}}D.CF_storeDropTargets(H,D)
}var P=F.getContentWindow().CQ.WCM.getEditables();
for(var S in P){D.CF_storeDropTargets(P[S],D)
}var Q=F.getContentWindow().CQ.WCM.getDropTargetComponents();
var L=Q.length;
for(var R=0;
R<L;
R++){D.CF_storeDropTargets(Q[R],D)
}CQ.Log.debug("CQ.wcm.ContentFinderDragZone#CF_b4StartDrag: drag started, drop targets found",D.dropTargets);
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark(D.dropTargets,true)
},1);
this.mouse={pos:[-1,-1],lastPos:[-1,-1],time:0}
}},CF_handleMouseMove:function(I){if(!CQ.WCM.isContentWindowLoading()){var A=CQ.WCM.getContentFinder();
if(!A){throw new Error("No finder defined")
}var G=CQ.WCM.getContentWindow();
try{if(!G.CQ){return 
}}catch(I){return 
}var C=[];
var B=CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_ID);
if(!B){throw new Error("No frame defined")
}var K=I.getPageX()-B.getRegion()[0]+G.CQ.Ext.dd.DDM.getScrollLeft();
var J=I.getPageY()-B.getRegion()[1]+G.CQ.Ext.dd.DDM.getScrollTop();
var D=this.dropTargetRegions;
for(var E=0;
E<D.length;
E++){if(D[E].contains(new CQ.Ext.lib.Point(K,J))){var F=this.dropTargets[E];
if(F.isLocked()){continue
}if(this.IDDM_dragCurrent.enableMultipleEventsFiring){C.push(F)
}else{if(C.length==0){C.push(F)
}else{C[0]=G.CQ.Ext.dd.DragDropMgr.getTopfrontElement(C[0],F)
}}}}CQ.Log.trace("CQ.wcm.ContentFinderDragZone#CF_handleMouseMove: mouve is moving, resolved drop targets (mouse over)",C);
for(var E=0;
E<C.length;
E++){var H=C[E];
if(H==this.cachedTarget){this.onDragOver(I);
this.updateMouseInfo(K,J);
return 
}else{if(this.cachedTarget){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(this.cachedTarget,true,false);
this.onDragOut(I)
}CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(H,true,true);
this.onDragEnter(I,H);
this.updateMouseInfo(K,J);
return 
}}if(this.cachedTarget){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(this.cachedTarget,true,false);
this.onDragOut(I)
}this.updateMouseInfo(K,J)
}},IDDM_startDrag:function(A,B){clearTimeout(this.IDDM_clickTimeout);
if(this.IDDM_dragCurrent){this.b4StartDrag(A,B);
this.CF_b4StartDrag(A,B);
this.startDrag(A,B)
}this.IDDM_dragThreshMet=true
},IDDM_handleMouseMove:function(C){if(!this.IDDM_dragCurrent||C.type!="mousemove"){return true
}if(CQ.Ext.isIE){document.selection.empty()
}if(CQ.Ext.isIE&&(C.button!==0&&C.button!==1&&C.button!==2)){this.IDDM_stopEvent(C);
return this.IDDM_handleMouseUp(C)
}if(!this.IDDM_dragThreshMet){var B=Math.abs(this.IDDM_startX-C.getPageX());
var A=Math.abs(this.IDDM_startY-C.getPageY());
if(B>this.DDM.clickPixelThresh||A>this.DDM.clickPixelThresh){this.IDDM_startDrag(this.IDDM_startX,this.IDDM_startY)
}}if(this.IDDM_dragThreshMet){this.b4Drag(C);
this.onDrag(C);
this.CF_handleMouseMove(C)
}this.IDDM_stopEvent(C);
return true
},IDDM_handleMouseUp:function(A){if(!CQ.WCM.isContentWindowLoading()){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}if(!this.IDDM_dragCurrent){return 
}CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark(this.dropTargets,false);
clearTimeout(this.IDDM_clickTimeout);
CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.un(document,"keypress",this.GEN_handleKeyPress,this);
CQ.Ext.EventManager.un(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
if(this.IDDM_dragThreshMet){if(this.cachedTarget){this.onDragDrop(A)
}else{this.onInvalidDrop(this.cachedTarget,A)
}}if(this.IDDM_dragCurrent){if(this.IDDM_dragThreshMet){this.b4EndDrag(A);
this.endDrag(A)
}}this.IDDM_dragCurrent=false;
this.dragging=false;
this.IDDM_stopEvent(A);
window.setTimeout(this.CF_cleanUpDD,1)
}},stopPropagation:true,preventDefault:true,IDDM_stopEvent:function(A){if(this.stopPropagation){A.stopPropagation()
}if(this.preventDefault){A.preventDefault()
}},addToGroup:function(A){this.groups[A]=true
},removeFromGroup:function(A){if(this.groups[A]){delete this.groups[A]
}},setHandleElId:function(A){if(typeof A!=="string"){A=CQ.Ext.id(A)
}this.handleElId=A
},unreg:function(){CQ.Ext.EventManager.un(this.id,"mousedown",this.handleMouseDown,this);
this._domRef=null
},isLocked:function(){return this.locked
},clickValidator:function(B){var A=B.getTarget();
return(this.isValidHandleChild(A)&&(this.id==this.handleElId))
},IDDM_isOverTarget:function(E,A){var F=this.IDDM_getLocation();
if(!F){return false
}this.cursorIsOver=F.contains(E);
if(!this.IDDM_dragCurrent||(!A&&!this.constrainX&&!this.constrainY)){return this.cursorIsOver
}this.overlap=null;
var G=this.getTargetCoord(E.x,E.y);
var C=this.getDragEl();
var D=new CQ.Ext.lib.Region(G.y,G.x+C.offsetWidth,G.y+C.offsetHeight,G.x);
var B=D.intersect(F);
if(B){this.overlap=B;
return(A)?true:this.cursorIsOver
}else{return false
}},IDDM_getLocation:function(){var D=this.getEl(),H,C,B,J,I,K,A,G,E;
try{H=CQ.Ext.lib.Dom.getXY(D)
}catch(F){}if(!H){return null
}C=H[0];
B=C+D.offsetWidth;
J=H[1];
I=J+D.offsetHeight;
K=J-this.padding[0];
A=B+this.padding[1];
G=I+this.padding[2];
E=C-this.padding[3];
return new CQ.Ext.lib.Region(K,A,G,E)
}});
CQ.wcm.ContentFinderDragZone.DEBUG=false;
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark=function(B,C,A){for(var D=0;
D<B.length;
D++){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(B[D],C,A)
}};
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark=function(E,C,B){if(CQ.wcm.ContentFinderDragZone.DEBUG&&E&&E.getEl){var A=CQ.WCM.getContentWindow();
var D=A.CQ.Ext.get(E.getEl());
if(C){if(B){D.removeClass("cq-cf-dd-debug-unresolved");
D.addClass("cq-cf-dd-debug-resolved")
}else{D.removeClass("cq-cf-dd-debug-resolved");
D.addClass("cq-cf-dd-debug-unresolved")
}}else{D.removeClass("cq-cf-dd-debug-resolved");
D.removeClass("cq-cf-dd-debug-unresolved")
}}};
CQ.wcm.ContentFinder=CQ.Ext.extend(CQ.Ext.Viewport,{path:null,url:null,contentWindow:null,contentWindowLeft:0,toolbarCt:null,linkElements:[],constructor:function(F){this.debug=F.debug;
var B=this;
if(!document.title){document.title=CQ.wcm.ContentFinder.TITLE
}var I=CQ.Ext.getBody();
I.setStyle("margin","0");
if(CQ.Ext.isIE){I.dom.scroll="no"
}else{I.setStyle("overflow","hidden")
}F=CQ.Util.applyDefaults(F,{sidekick:{xtype:"sidekick"}});
CQ.Ext.EventManager.on(document,"mouseup",function(){CQ.wcm.ContentFinder.unmaskFrame()
});
var G=CQ.HTTP.getAnchor(document.location.href);
if(G&&G!=CQ.wcm.ContentFinder.EXTERNAL_URL){this.url=G
}else{if(F.path){this.url=F.path+".html"
}}var D=document.createElement("iframe");
D.src=this.url?CQ.HTTP.externalize(this.url):CQ.Ext.SSL_SECURE_URL;
D.id=CQ.wcm.ContentFinder.FRAME_ID;
D.name=CQ.wcm.ContentFinder.FRAME_ID;
D.frameBorder="0";
D.border="0";
var C=new CQ.Ext.Element(D);
C.addClass("cq-frame");
var E=new CQ.Ext.BoxComponent({id:CQ.wcm.ContentFinder.FRAME_CT_ID,autoEl:{tag:"div"},style:{width:"100%",height:"100%"}});
E.on("render",function(){C.appendTo(E.getEl())
});
C.on("load",function(){B.contentWindow=frames[CQ.wcm.ContentFinder.FRAME_ID];
try{var O=B.contentWindow.location.href
}catch(R){if(CQ.HTTP.getAnchor(window.location.href)!=CQ.wcm.ContentFinder.EXTERNAL_URL){document.title=CQ.wcm.ContentFinder.TITLE;
B.url=CQ.wcm.ContentFinder.EXTERNAL_URL;
CQ.Ext.History.add(CQ.wcm.ContentFinder.EXTERNAL_URL,true,true)
}return 
}B.contentWindow.onscroll=function(Y){var X=CQ.WCM.getContentFinder();
if(X){X.onContentScroll(arguments)
}};
var U=CQ.HTTP.internalize(B.contentWindow.location.href);
var K=CQ.HTTP.removeParameters(U);
if(K==CQ.Ext.SSL_SECURE_URL){return 
}if(K!=B.url){B.url=K;
CQ.Ext.History.add(U,true,true)
}try{document.title=B.contentWindow.document.title;
var T=document.getElementsByTagName("head")[0];
for(var P=0;
P<B.linkElements.length;
P++){T.removeChild(B.linkElements[P])
}B.linkElements=[];
var V=B.contentWindow.document.getElementsByTagName("link");
for(var N=0;
N<V.length;
N++){var S=V[N];
var W=S.rel?S.rel.toLowerCase():"";
if(W.indexOf("icon")!=-1||W.indexOf("alternate")!=-1){var M=document.createElement("link");
M.rel=S.rel;
if(S.href){M.href=S.href
}if(S.type){M.type=S.type
}if(S.title){M.title=S.title
}T.appendChild(M);
B.linkElements.push(M)
}}}catch(R){}CQ.WCM.onClipboardChange(function(X){if(!B.clipboardLocked){B.clipboardLocked=true;
window.setTimeout(function(){var Z=CQ.WCM.getClipboardRecords();
var Y=B.clipboard.items.first().store;
if(Y.getCount()){Y.removeAll()
}if(Z.length>0){Y.add(Z);
B.clipboard.expand()
}B.clipboardLocked=false
},100)
}});
var Q=CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),CQ.wcm.ContentFinder.SIDEVIEW_PARAM);
if(Q!=null){var K=Q+".html";
K=CQ.HTTP.addParameter(K,"wcmmode","disabled");
B.collapse();
B.openSideBoard(CQ.HTTP.externalize(K),CQ.Ext.getBody().getWidth()/2)
}var L=CQ.WCM.getPagePath();
if(L){B.refreshTabs(L)
}});
var H=F.items!=undefined?F.items:[];
if(F.extensions){if(F.extensions[CQ.wcm.ContentFinder.EXTENSIONS_TABS]){H=H.concat(F.extensions[CQ.wcm.ContentFinder.EXTENSIONS_TABS])
}}this.setupAllTabs(H);
var J=this.getVisibleTabs(this.url);
this.clipboard=new CQ.Ext.Panel({xtype:"panel",region:"south",title:CQ.I18n.getMessage("Clipboard"),id:CQ.wcm.ContentFinder.CLIPBOARD_ID,stateful:true,height:CQ.themes.wcm.ContentFinder.CLIPBOARD_HEIGHT,tools:[{id:"refresh",handler:function(K){CQ.WCM.clearClipboard()
},scope:B}],collapseMode:"mini",collapsible:true,collapsed:true,split:true,animate:true,autoScroll:true,items:[{xtype:"dataview",cls:"cq-cf-clipboard",border:false,layout:"fit",multiSelect:true,overClass:"x-view-over",selectedClass:"x-view-selected",tpl:CQ.wcm.ContentFinder.CLIPBOARD_TEMPLATE,itemSelector:CQ.wcm.ContentFinder.CLIPBOARD_ITEMSELECTOR,store:new CQ.Ext.data.SimpleStore({fields:["path","xtype","action"],data:[]}),prepareData:function(K){K.qtip=K.path;
K.title=CQ.Ext.util.Format.ellipsis(K.title,32);
K.icon=CQ.HTTP.externalize(K.icon);
return K
}}]});
this.toolbarPref=CQ.User.getCurrentUser().getPreference("toolbarDisplay");
if(!this.toolbarPref){this.toolbarPref="ondemand"
}CQ.wcm.ContentFinder.superclass.constructor.call(this,{id:"cq-cf",layout:"border",renderTo:"CQ",stateful:true,stateEvents:["pathselected"],items:[{id:"cq-cf-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-cf-west",stateful:true,xtype:"panel",region:"west",layout:"border",collapseMode:"mini",collapsible:true,hideCollapseTool:true,split:true,animate:true,border:false,width:CQ.themes.wcm.ContentFinder.FINDER_WIDTH,margins:"5 0 0 5",items:[{xtype:"tabpanel",region:"center",id:CQ.wcm.ContentFinder.TABPANEL_ID,stateful:true,activeTab:0,deferredRender:false,enableTabScroll:true,border:false,items:J},this.clipboard]},{xtype:"panel",stateful:false,id:"cq-cf-framewrapper",region:"center",layout:"fit",items:{xtype:"panel",layout:"border",border:false,items:[{id:"cq-cf-toolbar-ct",xtype:"panel",region:"north",cls:"cq-cf-toolbar-ct",autoHeight:true,border:false,header:false,layout:"column",collapsed:this.toolbarPref!="always",collapsible:true,collapseMode:"mini",animCollapse:false,items:[{xtype:"toolbar",items:[{text:CQ.I18n.getMessage("Copy"),handler:function(){CQ.WCM.copy(CQ.WCM.getSelectedItems())
}},{text:CQ.I18n.getMessage("Cut"),handler:function(){CQ.WCM.cut(CQ.WCM.getSelectedItems())
}},{text:CQ.I18n.getMessage("Paste"),handler:function(){var L=CQ.WCM.getSelectedItems();
if(L.length<1){return 
}var M=L[0];
var K=CQ.WCM.paste();
while(K.length>0){var N=K.shift();
if(N.action!=CQ.WCM.ACTION_CUT){M.copyParagraph(N.path,N.resourceType,N.hasAnnotations)
}else{M.moveParagraph(N.path,N.resourceType,N.hasAnnotations)
}}}},{text:CQ.I18n.getMessage("Delete"),handler:function(){CQ.WCM.remove(CQ.WCM.getSelectedItems())
}},"-"]}]},{xtype:"panel",region:"center",border:false,items:E}]}},{xtype:"panel",stateful:false,id:"cq-cf-east",region:"east",layout:"fit",collapseMode:"mini",collapsible:true,hideCollapseTool:true,collapsed:true,split:true,animate:true,width:400,border:false,hidden:true,hideMode:"offsets",listeners:{collapse:function(K){K.items.each(function(){K.remove(this,true)
});
K.hide()
}}}]}],listeners:{beforeshow:function(){if(CQ.WCM.isEditMode()){this.expand(false)
}else{this.collapse(false)
}}}});
CQ.WCM.getTopWindow().CQ_ContentFinder=this;
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var A=document.createElement("iframe");
A.id=CQ.Ext.History.iframeId;
A.src="javascript:false";
A.className="x-hidden";
A.frameBorder="0";
A.border="0";
new CQ.Ext.Element(A).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
CQ.Ext.History.on("change",function(K){if(K==CQ.wcm.ContentFinder.EXTERNAL_URL){return 
}var L=B.url;
if(K!=L){CQ.wcm.ContentFinder.loadContentWindow(K,true)
}});
CQ.Util.observeComponent(this,CQ.VERY_SHORT_INTERVAL)
},getContentWindow:function(){return this.contentWindow?this.contentWindow:frames[CQ.wcm.ContentFinder.FRAME_ID]
},getClipboard:function(){return CQ.WCM.getClipboard(this)
},getToolbarCt:function(){return CQ.Ext.getCmp("cq-cf-toolbar-ct")
},loadToolbar:function(A){if(this.toolbarPref!="never"){var B=this.getToolbarCt();
B.add(A);
B.doLayout();
B.items.get(0).hide();
if(B.collapsed){B.expand()
}}},unloadToolbar:function(){if(this.toolbarPref!="never"){var A=this.getToolbarCt();
while(A.items.getCount()>1){A.remove(A.items.get(A.items.getCount()-1))
}A.doLayout();
if(this.toolbarPref=="always"){A.items.get(0).show()
}else{if(!A.collapsed){A.collapse()
}}}},collapse:function(){CQ.Ext.getCmp("cq-cf-west").collapse()
},expand:function(){CQ.Ext.getCmp("cq-cf-west").expand()
},openSideBoard:function(B,E){var D=document.createElement("iframe");
D.src=B;
D.frameBorder="0";
D.border="0";
var C=new CQ.Ext.Element(D);
C.addClass("cq-frame");
C.setStyle("height","100%");
var A=new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"}});
A.on("render",function(){C.appendTo(A.getEl())
});
var F=CQ.Ext.getCmp("cq-cf-east");
if(E){F.setWidth(E)
}F.add(A);
F.show();
F.expand()
},closeSideBoard:function(){var A=CQ.Ext.getCmp("cq-cf-east");
A.collapse()
},isSideBoardCollapsed:function(){var A=CQ.Ext.getCmp("cq-cf-east");
return A.collapsed
},onContentScroll:function(){var C=CQ.Ext.getCmp("cq-cf-east");
var A=C.items.get(0);
if(A){var B=A.getEl();
if(B){var D=this.getContentWindow().scrollY
}}},observe:function(){var A=this.getEl().getScroll();
if(A.top||A.left){if(CQ.Ext.isIE&&CQ.Ext.isStrict){}else{window.scroll(0,0)
}}},getFrame:function(){return CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_ID)
},getFrameContainer:function(){return CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_CT_ID)
},setupAllTabs:function(A){var C={};
for(var B=0;
B<A.length;
B++){var D=A[B];
D.id=D.id||CQ.Ext.id();
C[D.id]=D
}for(var B=0;
B<A.length;
B++){var D=A[B];
if(D.override&&C[D.override]){C[D.id]=CQ.Util.applyDefaults(C[D.id],C[D.override]);
delete C[D.override]
}}A=[];
for(var E in C){A.push(C[E])
}this.allTabs=A
},getVisibleTabs:function(I){var F=this.allTabs;
var G=[];
if(F){for(var D=0;
D<F.length;
D++){var H=F[D];
var E=false;
if(H.hidden){if(CQ.Ext.isFunction(H.hidden)){E=H.hidden.call(H,H,I)
}else{E=(H.hidden===true)
}}if(!E){if(I&&H.allowedPaths){E=true;
var B=CQ.Ext.isArray(H.allowedPaths)?H.allowedPaths:[H.allowedPaths];
for(var C=0;
C<B.length;
C++){var A=new RegExp(B[C],"i");
if(I.search(A)!=-1){E=false
}}}else{E=false
}}if(!E){G.push(H)
}}}return CQ.Util.sortByRanking(G)
},refreshTabs:function(E){var C=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
if(C){var B=false;
var A=this.getVisibleTabs(E);
if(A.length!=C.items.getCount()){B=true
}else{C.items.each(function(H,F,G){if(H.id!=A[F].id){B=true;
return false
}})
}if(B){C.getEl().mask(CQ.I18n.getMessage("Loading..."));
C.removeAll();
var D=this.getVisibleTabs(E);
if(D.length>0){C.add(this.getVisibleTabs(E));
C.setActiveTab(D[0].id)
}C.getEl().unmask()
}}}});
CQ.Ext.reg("contentfinder",CQ.wcm.ContentFinder);
CQ.wcm.ContentFinder.TABPANEL_ID="cq-cf-tabpanel";
CQ.wcm.ContentFinder.CLIPBOARD_ID="cq-cf-clipboard";
CQ.wcm.ContentFinder.TITLE=CQ.I18n.getMessage("CQ5 Content Finder");
CQ.wcm.ContentFinder.EXTERNAL_URL="_";
CQ.wcm.ContentFinder.loadContentWindow=function(A,B){CQ.shared.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(A),B)
};
CQ.wcm.ContentFinder.maskFrame=function(){if(!CQ.wcm.ContentFinder.frameMask){CQ.wcm.ContentFinder.frameMask=CQ.Ext.get("cq-cf-framewrapper").mask()
}return CQ.wcm.ContentFinder.frameMask
};
CQ.wcm.ContentFinder.unmaskFrame=function(){if(CQ.wcm.ContentFinder.frameMask){CQ.wcm.ContentFinder.frameMask=null;
CQ.Ext.get("cq-cf-framewrapper").unmask()
}};
CQ.wcm.ContentFinder.FRAME_ID="cq-cf-frame";
CQ.wcm.ContentFinder.FRAME_CT_ID="cq-cf-frame-ct";
CQ.wcm.ContentFinder.EXTENSIONS_TABS="tabs";
CQ.wcm.ContentFinder.CLIPBOARD_ITEMSELECTOR=".item-wrap";
CQ.wcm.ContentFinder.CLIPBOARD_TEMPLATE='<tpl for="."><div class="item-wrap"  style="background-image:url({icon})" title="{qtip}"><span>{title}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinder.SIDEVIEW_PARAM="cq_sideView";
CQ.wcm.ContentFinderTab=CQ.Ext.extend(CQ.Ext.Panel,{fields:null,dataView:null,form:null,history:null,initComponent:function(){CQ.wcm.ContentFinderTab.superclass.initComponent.call(this);
try{this.dataView=this.findByType("dataview")[0]
}catch(C){}try{var A=this.findByType("form");
if(A.length==1){var B=A[0];
this.fields=CQ.Util.findFormFields(B)
}}catch(C){}if(this.historyId){this.history=CQ.Ext.getCmp(this.historyId)
}},constructor:function(A){A=CQ.Util.applyDefaults(A,{layout:"border",items:[],listeners:{show:function(){this.loadStore(this.getParams())
}}});
CQ.wcm.ContentFinderTab.superclass.constructor.call(this,A)
},getParams:function(B){var A;
if((this.fields==null)&&B){var E=B.findParentByType("form");
A=CQ.Util.findFormFields(E)
}else{A=this.fields
}var G=new Object();
for(var C in this.fields){var F=this.fields[C];
for(var D=0;
D<F.length;
D++){G[C]=F[D].getValue()
}}return G
},submitQueryBox:function(A){try{var D=this.getParams(A);
var B=this.getQueryValue();
CQ.wcm.ContentFinderTab.disablePathCombo(this);
this.loadStore(D)
}catch(C){CQ.Log.error("ContentFinderTab#submitQueryBox: "+C.message)
}},loadStore:function(B){try{this.loading=true;
this.dataView.store.load({params:B})
}catch(A){CQ.Log.error("ContentFinderTab#loadStore: "+A.message)
}},setQueryValue:function(B){var A="query";
try{this.fields[A][0].setValue(B)
}catch(C){}},getQueryValue:function(B){var A="query";
try{return this.fields[A][0].getValue()
}catch(C){}}});
CQ.Ext.reg("contentfindertab",CQ.wcm.ContentFinderTab);
CQ.wcm.ContentFinderTab.ROOTPATH="/content";
CQ.wcm.ContentFinderTab.DATAVIEW_URL="/bin/wcm/search/gql.json";
CQ.wcm.ContentFinderTab.getQueryBoxConfig=function(A){A=CQ.Util.applyDefaults(A,{xtype:"form",method:"GET",region:"north",height:CQ.themes.wcm.ContentFinderTab.QUERYBOX_HEIGHT,bodyStyle:CQ.themes.wcm.ContentFinderTab.QUERYBOX_BODYSTYLE,layout:"fit",split:true,autoScroll:true,cls:"cq-cft-querybox",baseParams:{_charset_:"utf-8"},defaults:{hideLabel:true,anchor:CQ.themes.wcm.ContentFinderTab.QUERYBOX_ANCHOR,stateful:false,style:CQ.themes.wcm.ContentFinderTab.QUERYBOX_FIELDS_STYLE}});
return A
};
CQ.wcm.ContentFinderTab.getSuggestFieldConfig=function(A){A=CQ.Util.applyDefaults(A,{xtype:"suggestfield",name:"query",style:"margin-top:0;",onTriggerClick:function(B){if(B){this.search()
}},listeners:{search:function(){this.search()
}},search:function(){var B=this.findParentByType("contentfindertab");
if(B.history){B.history.addHistory(B.getParams(B))
}B.submitQueryBox.call(B,this)
}});
return A
};
CQ.wcm.ContentFinderTab.getPathComboConfig=function(A){A=CQ.Util.applyDefaults(A,{xtype:"combo",mode:"local",displayField:"text",editable:false,triggerAction:"all",disabled:true,cls:"cq-cft-pathcombo",listClass:"cq-cft-pathcombo-list",width:131,listWidth:131,store:new CQ.Ext.data.SimpleStore({fields:["value","text"],data:[]}),listeners:{select:function(D,B){var C=CQ.Ext.getCmp(A.tabId);
CQ.wcm.ContentFinderTab.openFolder(C,B.data.value)
}}});
return A
};
CQ.wcm.ContentFinderTab.getBrowseTree=function(config,treeID,resultBoxID){if(!config.treeRoot){config.treeRoot=new Object()
}this.treeRootConfig=CQ.Ext.applyIf(config.treeRoot,{name:"content",text:CQ.I18n.getMessage("Content"),draggable:false,expanded:true});
if(!config.treeLoader){config.treeLoader=new Object()
}this.treeLoaderConfig=CQ.Ext.applyIf(config.treeLoader,{baseParams:{predicate:"siteadmin"},requestMethod:"GET",dataUrl:"/bin/tree/ext.json",baseAttrs:{draggable:false,iconCls:"folder"},listeners:{beforeload:function(loader,node){this.baseParams.path=node.getPath()
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(attr.type=="cq:Page"){attr.iconCls="page"
}else{if(/.*[fF]older/.test(attr.type)){attr.iconCls="folder"
}else{if(attr.cls){attr.iconCls=attr.cls
}}}if(this.applyLoader!==false){attr.loader=this
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.leaf){delete attr.leaf;
attr.children=[];
attr.expanded=true
}var node;
if(attr.leaf){node=new CQ.Ext.tree.TreeNode(attr)
}else{node=new CQ.Ext.tree.AsyncTreeNode(attr)
}return node
},filterFn:function(dataObj){if(CQ.Ext.isArray(dataObj)){for(var i=0;
i<dataObj.length;
){if(dataObj[i]["type"]=="dam:Asset"){dataObj.splice(i,1)
}else{var children=dataObj[i].children;
if(children){var childCnt=children.length;
var noChildVisible=true;
for(var j=0;
j<childCnt;
j++){if(children[j]["type"]!="dam:Asset"){noChildVisible=false;
break
}}if(noChildVisible){dataObj[i].leaf=true
}delete dataObj[i].children
}i++
}}}return dataObj
}});
var tree=new CQ.Ext.tree.TreePanel({id:treeID,lines:true,animate:true,enableDD:false,containerScroll:true,autoScroll:true,split:true,stateful:true,region:"north",height:220,loader:new CQ.tree.FilteredTreeLoader(this.treeLoaderConfig),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootConfig)});
tree.getSelectionModel().addListener("selectionchange",(config.selectionchangeListener!=null?config.selectionchangeListener:function(selModel,node){var store=CQ.Ext.getCmp(resultBoxID).items.get(0).store;
store.proxy.api.read.url=CQ.shared.HTTP.encodePath(node.getPath())+".contentfinder.assets.json";
store.reload()
}));
return tree
};
CQ.wcm.ContentFinderTab.getResultsBoxConfig=function(C,E,F,B,A){E=CQ.Util.applyDefaults(E,{url:"x",method:"GET"});
F=CQ.Util.applyDefaults(F,{autoLoad:false,proxy:new CQ.Ext.data.HttpProxy(E),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits",fields:["name","path","title",CQ.shared.XSS.getXSSPropertyName("title"),"excerpt","mimeType","isFolder","contentType","ddGroups","ddNewParagraph","size","lastModified","ck"],id:"path"}),baseParams:{_charset_:"utf-8"},listeners:{load:function(J,I,K){J.records=I
}}});
var H=new CQ.Ext.data.GroupingStore(F);
C=CQ.Util.applyDefaults(C,{xtype:"panel",region:"center",autoScroll:true,itemsDDGroups:[],itemsDDNewParagraph:null,triggerScrollOffset:80,oneParameterPagination:true,pageSize:10,listeners:{render:function(J){var K=J.items.get(0);
var I=K.store;
K.indicatorEl=J.el.createChild({tag:"div",cls:"cq-cft-load-indicator"});
if(!C.disableContinuousLoading){J.body.on("scroll",function(N,L){if(!I.records){return 
}if(K.loading||K.refreshing){return 
}if(L.scrollTop>0&&(L.scrollTop+L.clientHeight+this.triggerScrollOffset>=L.scrollHeight)&&!K.refreshing){if(!K.moreStore){K.moreStore=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:I.proxy.url,method:I.proxy.conn.method}),reader:I.reader,listeners:{load:function(){var R=I.getCount();
for(var S=0;
S<K.moreStore.getCount();
S++){var Q=K.moreStore.getAt(S);
I.add(Q)
}K.refreshing=false;
K.indicatorEl.hide()
}},dataView:this})
}var P=I.lastOptions.params==undefined?I.baseParams:I.lastOptions.params;
if(!P.query||(P.query.indexOf("limit:")==-1)){K.refreshing=true;
var O={};
for(var M in P){O[M]=P[M]
}if(C.twoParametersPagination){O.limit=I.baseParam?I.baseParam:C.pageSize;
O.start=I.getCount()
}else{O.limit=I.getCount()+".."+(I.getCount()+C.pageSize)
}K.indicatorEl.alignTo(J.el,"bl-bl?",[18,-20]);
K.indicatorEl.show();
K.moreStore.load({params:O})
}}},this)
}}},items:{xtype:"dataview",cls:"cq-cft-dataview",layout:"fit",loadingText:CQ.I18n.getMessage("Loading content..."),multiSelect:true,singleSelect:true,overClass:"x-view-over",emptyText:CQ.I18n.getMessage("No content items to display"),tpl:CQ.wcm.ContentFinderTab.THUMBS_TEMPLATE,itemSelector:CQ.wcm.ContentFinderTab.THUMBS_ITEMSELECTOR,store:H,prepareData:function(I){I.shortTitle=CQ.shared.XSS.getXSSValue(CQ.Ext.util.Format.ellipsis(I.name,15));
I.title=I.title?I.title:"";
I[CQ.shared.XSS.getXSSPropertyName("title")]=I[CQ.shared.XSS.getXSSPropertyName("title")]?I[CQ.shared.XSS.getXSSPropertyName("title")]:"";
I.id=this.id;
I.isFolder=I.isFolder===true?true:false;
I.ddGroups=I.ddGroups?I.ddGroups:CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED;
I.formattedSize=I.size?CQ.Util.formatFileSize(I.size):"";
try{I.lastModified=CQ.wcm.SiteAdmin.formatDate(I.lastModified)
}catch(J){}I.img140Postfix=".thumb.100.140.png";
I.img70Postfix=".thumb.50.70.png";
I.img48Postfix=".thumb.48.48.png";
if(I.path){I.pathEncoded=I.path.replace(/"/g,"&#34").replace(/'/g,"&#27");
I.pathEncodedTitle=I.path.replace(/&/g,"&#38;").replace(/"/g,"&#34")
}return I
},listeners:{click:function(S,P,U,R){if(this.ddGroupsFromConfig){return 
}for(var O in this.dragZone.groups){this.dragZone.removeFromGroup(O)
}this.dragZone.itemsDDNewParagraph={};
var J=this.getSelectedRecords();
var I=J[0];
if(!I){return 
}if(I.data.ddGroups){for(var M=0;
M<I.data.ddGroups.length;
M++){var T=I.data.ddGroups[M];
var Q=true;
for(var L=1;
L<J.length;
L++){var N=J[L];
for(var K=0;
K<N.data.ddGroups.length;
K++){if(T==N.data.ddGroups[K]){Q=true;
break
}Q=false
}if(!Q){break
}}if(Q){this.dragZone.addToGroup(T)
}}}if(I.data.ddNewParagraph){var Q=true;
for(var M=1;
M<J.length;
M++){var N=J[M];
if(I.data.ddNewParagraph.path!=N.data.ddNewParagraph.path||I.data.ddNewParagraph.propertyName!=N.data.ddNewParagraph.propertyName){Q=false;
break
}}if(Q){this.dragZone.itemsDDNewParagraph=I.data.ddNewParagraph;
this.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT)
}}},load:function(){this.loading=false
},render:function(J){if(B==undefined){B=CQ.CF_REFRESH_INTERVAL
}if(B&&B!="0"){CQ.Util.observeComponent(this,B)
}J.loadMask=new CQ.Ext.LoadMask(J.getEl(),{store:this.store});
J.dragZone=new CQ.wcm.ContentFinderTab.DragZone(J,{containerScroll:false});
J.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
if(C.itemsDDGroups&&CQ.Ext.isArray(C.itemsDDGroups)&&C.itemsDDGroups.length>0){this.ddGroupsFromConfig=true;
for(var I=0;
I<C.itemsDDGroups.length;
I++){J.dragZone.addToGroup(C.itemsDDGroups[I])
}}if(C.itemsDDNewParagraph){J.dragZone.itemsDDNewParagraph=C.itemsDDNewParagraph;
J.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT)
}}},observe:function(){if(!this.store.records){return 
}if(this.loading||this.refreshing){return 
}if(!this.tab){this.tab=this.findParentByType("contentfindertab")
}var L=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
if(L.getActiveTab()!=this.tab){return 
}this.refreshing=true;
if(!this.checkStore&&this.store.proxy.api.read.url){this.checkStore=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:this.store.proxy.api.read.url,method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits",fields:["name","path","title",CQ.shared.XSS.getXSSPropertyName("title"),"excerpt","mimeType","isFolder","ddGroups"],id:"path"}),listeners:{load:function(){var O=this.dataView.store;
var M=this.dataView.checkStore;
var P=O.getCount();
for(var Q=0;
Q<P;
Q++){var N=O.getAt(Q);
if(!M.getById(N.id)){O.remove(N);
P--
}}P=M.getCount();
for(var Q=0;
Q<P;
Q++){var N=M.getAt(Q);
if(!O.getById(N.id)){O.insert(Q,N)
}}this.dataView.refreshing=false
}},dataView:this})
}this.checkStore.proxy.api.read.url=this.store.proxy.api.read.url;
var K=this.store.lastOptions.params==undefined?this.store.baseParams:this.store.lastOptions.params;
var I={};
for(var J in K){I[J]=K[J]
}if(!I.query||(I.query.indexOf("limit:")==-1)){if(C.twoParametersPagination){moreParams.limit=this.store.baseParam?this.store.baseParam:C.pageSize;
moreParams.start=0
}else{I.limit=0+".."+this.store.getCount()
}}this.checkStore.load({params:I})
}}});
try{for(var D=0;
D<C.tbar.length;
D++){if(C.tbar[D]==CQ.wcm.ContentFinderTab.REFRESH_BUTTON){C.tbar[D]=CQ.wcm.ContentFinderTab.getRefreshButton(H)
}}}catch(G){}try{for(var D=0;
D<C.bbar.length;
D++){if(C.bbar[D]==CQ.wcm.ContentFinderTab.REFRESH_BUTTON){C.bbar[D]=CQ.wcm.ContentFinderTab.getRefreshButton(H)
}}}catch(G){}return C
};
CQ.wcm.ContentFinderTab.getRefreshButton=function(A){return new CQ.Ext.Button({iconCls:"cq-siteadmin-refresh",handler:function(){A.reload()
},tooltip:CQ.I18n.getMessage("Refresh")})
};
CQ.wcm.ContentFinderTab.resultDblClick=function(E,G,D,B,A){try{if(A!=CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED&&!E.altKey){if(A==CQ.wcm.ContentFinderTab.CONTENT_PAGE){CQ.wcm.ContentFinder.loadContentWindow(D+".html")
}else{CQ.Util.reload(window,CQ.HTTP.externalize(D,true))
}}else{if(B){var F=CQ.Ext.getCmp(G);
var C=F.findParentByType("contentfindertab");
CQ.wcm.ContentFinderTab.openFolder(C,D)
}}}catch(E){}};
CQ.wcm.ContentFinderTab.openFolder=function(A,B){A.setQueryValue("path:"+B);
var C=A.getParams();
C.openFolder="true";
if(A.history){A.history.addHistory(C)
}CQ.wcm.ContentFinderTab.adjustPathCombo(A,B);
A.loadStore(C)
};
CQ.wcm.ContentFinderTab.adjustPathCombo=function(B,F){try{if(!B.pathCombo&&B.pathComboId){B.pathCombo=CQ.Ext.getCmp(B.pathComboId)
}if(B.pathCombo){var D=[];
var C=F;
while(C.lastIndexOf("/")!=0){C=C.substring(0,C.lastIndexOf("/"));
var A=C.substring(C.lastIndexOf("/")+1);
D.push([C,A?A:"/"])
}B.pathCombo.store.loadData(D);
B.pathCombo.setDisabled(false);
B.pathCombo.setValue(F.substring(F.lastIndexOf("/")+1))
}}catch(E){}};
CQ.wcm.ContentFinderTab.disablePathCombo=function(A){if(!A.pathCombo&&A.pathComboId){A.pathCombo=CQ.Ext.getCmp(A.pathComboId)
}if(A.pathCombo){A.pathCombo.setValue("");
A.pathCombo.setDisabled(true)
}};
CQ.wcm.ContentFinderTab.THUMBS_ITEMSELECTOR=".thumb-wrap";
CQ.wcm.ContentFinderTab.THUMBS_TEMPLATE='<tpl for="."><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[CQ.wcm.ContentFinderTab.THUMBS_URL(values)]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "title"))]}</nobr>{[values.title ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></div><span>{shortTitle}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinderTab.THUMBS_URL=function(B,D,A){D=(D?D:100);
A=(A?A:140);
var C=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(B.path)));
C+=".thumb."+D+"."+A+(B.ck?"."+B.ck:"")+".png";
return CQ.shared.HTTP.getXhrHookedURL(C)
};
CQ.wcm.ContentFinderTab.THUMBS_SHADOW_ITEMSELECTOR=".thumb-sh-wrap";
CQ.wcm.ContentFinderTab.THUMBS_SHADOW_TEMPLATE='<tpl for="."><div class="thumb-sh-wrap"><table class="thumb""><tr><td><table><tr><td><img src="{[CQ.wcm.ContentFinderTab.THUMBS_URL(values)]}" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "title"))]}</nobr>{[values.title ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></td></tr></table></td></tr></table><span>{shortTitle}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinderTab.DETAILS_ITEMSELECTOR=".cq-cft-search-item";
CQ.wcm.ContentFinderTab.DETAILS_SHADOW_TEMPLATE='<tpl for="."><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div class="cq-cft-search-thumb"><table><tr><td><img alt="{pathEncoded}" src="{[CQ.wcm.ContentFinderTab.THUMBS_URL(values, 48, 48)]}"></td></tr></table></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "title") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "title") + "</div>" : ""]}<div>{formattedSize}</div><div>{lastModified}</div></div><div class="cq-cft-search-separator"></div></div></tpl>';
CQ.wcm.ContentFinderTab.DETAILS_SHADOW_ITEMSELECTOR=".cq-cft-search-item";
CQ.wcm.ContentFinderTab.DETAILS_TEMPLATE='<tpl for="."><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{pathEncodedTitle}" class="cq-cft-search-thumb" style="background-image:url(\'{[CQ.wcm.ContentFinderTab.THUMBS_URL(values, 48, 48)]}\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "title") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "title") + "</div>" : ""]}<div>{formattedSize}</div><div>{lastModified}</div></div><div class="cq-cft-search-separator"></div></div></tpl>';
CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED="";
CQ.wcm.ContentFinderTab.CONTENT_PAGE="page";
CQ.wcm.ContentFinderTab.REFRESH_BUTTON="refreshButton";
CQ.wcm.ContentFinderTab.DragZone=CQ.Ext.extend(CQ.wcm.ContentFinderDragZone,{constructor:function(A,B){this.view=A;
CQ.wcm.ContentFinderTab.DragZone.superclass.constructor.call(this,A.getEl(),B)
},onInitDrag:function(B,C){CQ.wcm.EditBase.DragZone.superclass.onInitDrag.call(this,B,C);
var A=this;
this.flashDropTargetsCheck=window.setInterval(function(){if(!A){return 
}var D=A.mouse;
var E=new Date().valueOf();
if(D&&A.matchRange(D.pos,D.lastPos)&&(E-D.time)>2000){A.flashDropTargets(CQ.WCM.altKey);
D.time=E
}else{A.normalizeDropTargets()
}D.lastPos=D.pos
},500)
},getDragData:function(H){var I=H.getTarget(this.view.itemSelector);
if(I){var K=this.view;
if(!K.isSelected(I)){K.onClick(H)
}var B=K.getSelectedNodes();
var F=K.getSelectedRecords();
var D={nodes:B,records:F};
if(B.length==1){this.initialxy=CQ.Ext.Element.fly(I.firstChild).getXY();
D.ddel=I.firstChild.cloneNode(true);
D.ddel.className+=" cq-cft-ddproxy";
D.single=true
}else{var A=document.createElement("div");
A.style.width=(CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET*(B.length-1)+CQ.themes.wcm.ContentFinderTab.DDPROXY_WIDTH)+"px";
A.style.height=(CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET*(B.length-1)+CQ.themes.wcm.ContentFinderTab.DDPROXY_HEIGHT)+"px";
for(var E=0,G=B.length;
E<G;
E++){var J=B[E].firstChild.cloneNode(true);
J.className+=" cq-cft-ddproxy";
J.style.position="absolute";
var C=E*CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET;
J.style.left=(CQ.themes.wcm.ContentFinderTab.DDPROXY_PADDING_LEFT+C)+"px";
J.style.top=(CQ.themes.wcm.ContentFinderTab.DDPROXY_PADDING_TOP+C)+"px";
A.appendChild(J)
}D.ddel=A;
D.multi=true
}return D
}return null
},afterRepair:function(){for(var B=0,A=this.dragData.nodes.length;
B<A;
B++){}this.dragging=false
},getRepairXY:function(A){if(!this.dragData.multi){this.initialxy[0]+=3;
this.initialxy[1]+=3;
return this.initialxy
}return false
},onInvalidDrop:function(B,A){CQ.wcm.ContentFinderTab.DragZone.superclass.onInvalidDrop.call(this,B,A);
this.clearAnimations(B)
},clearAnimations:function(B,A){if(B){if(B.hideHighlight){B.hideHighlight()
}if(!A&&B.editComponent&&B.editComponent.hideTarget){B.editComponent.hideTarget()
}}this.normalizeDropTargets();
window.clearInterval(this.flashDropTargetsCheck)
},notifyDropDT:function(B,L,I){var M=false;
if(this.isInplaceEditingComponent(B)){this.clearAnimations(B);
if(this.isInplaceEditingDropAllowed(B)){B.editComponent.notifyInplaceEditingDrop(this);
return true
}}if(this.isDropAllowed(B,(L&&L.altKey))){var H=B.editComponent;
if(L&&!L.altKey){this.clearAnimations(B);
var O=[];
for(var J=0;
J<this.dragData.records.length;
J++){O.push(this.dragData.records[J].data.path)
}var K=B.propertyName;
var N=B.postParams;
for(var C in N){if(C.indexOf("./DRAG_RECORD_")==0){var A=C.substring(14);
for(J=0;
J<this.dragData.records.length;
J++){if(this.dragData.records[J].data[A]!=undefined&&this.dragData.records[J].data[A]!=""){N["./"+A]=this.dragData.records[J].data[A]
}else{N["./"+A]=""
}}}}window.setTimeout(function(){var c=CQ.WCM.getContentWindow();
var Y=null;
var X=null;
var b=null;
if(c.CQ.undo&&c.CQ.undo.util&&c.CQ.undo.util.UndoUtils){X=c.CQ.undo.util.UndoUtils
}if(c.CQ.undo&&c.CQ.undo.UndoManager){b=c.CQ.undo.UndoManager
}if(b!=null&&b.isEnabled()){Y=X.getCurrentData(H)
}H.updateParagraph(K,O,N);
if(b!=null&&b.isEnabled()){var R={};
R[K]=O;
var g=X.resolveMultiValuePlaceholder(R);
var j={};
var Q=g.length;
var a=X.jsonToSlingParameters(Y.data);
for(var U=0;
U<Q;
U++){K=g[U].property;
j[K]=a[K];
if(g[U].resolved){var P=K.lastIndexOf("/");
if(P>0){var Z=K.substring(0,P);
j[Z+"/jcr:lastModified"]="";
j[Z+"/jcr:lastModifiedBy"]="";
R[Z+"/jcr:lastModified"]="";
R[Z+"/jcr:lastModifiedBy"]=""
}}}for(var d in N){if(N.hasOwnProperty(d)){if(a[d]){j[d]=a[d]
}else{j[d]=""
}R[d]=N[d]
}}if(b!=null){var W=b.getHistory();
var V=W.createUndoStep(W.createStepConfig());
var S=new c.CQ.undo.util.FormStub();
var T=H.getResourceType();
V.addUndoAction(new c.CQ.undo.actions.UpdateParagraphAction(W.getIdManager(),H.path,T,j,R,S));
V.commit()
}}},1);
M=true
}if(L&&L.altKey){this.clearAnimations(B,true);
var F=CQ.I18n.getMessage("Inserting paragraph...");
H.maskTarget(F);
var E=CQ.WCM.getComponentConfig(this.itemsDDNewParagraph.path);
if(E){var G={};
if(this.itemsDDNewParagraph.params){for(var C in this.itemsDDNewParagraph.params){G[C]=this.itemsDDNewParagraph.params[C]
}}var D=[];
for(var J=0;
J<this.dragData.records.length;
J++){var C=CQ.utils.Util.copyObject(G);
C[this.itemsDDNewParagraph.propertyName]=this.dragData.records[J].data.path;
D.push(C)
}window.setTimeout(function(){for(var P=0;
P<D.length;
P++){H.createParagraph(E,D[P])
}H.hideTarget()
},1);
M=true
}}}this.clearAnimations(B,true);
return M
},notifyEnterDT:function(B,A){if(this.isDropAllowed(B,(!A||A.altKey))){if(A&&A.altKey){if(B.editComponent){B.editComponent.showTarget()
}B.hideHighlight()
}else{B.showHighlight()
}}return""
},notifyOutDT:function(B,A){if(B.editComponent){B.editComponent.hideTarget(true)
}B.hideHighlight();
return""
},notifyOverDT:function(C,B){var A=this.isDropAllowed(C,(!B||B.altKey));
if(A){if(B&&B.altKey){if(C.editComponent){C.editComponent.showTarget()
}C.hideHighlight()
}else{if(C.editComponent){C.editComponent.hideTarget()
}}}return A?this.dropAllowed:this.dropNotAllowed
},isDropAllowed:function(B,A){if(this.isInplaceEditingComponent(B)){return this.isInplaceEditingDropAllowed(B)
}if(A==undefined){return(this.isNonComponentDropAllowed(B)||this.isComponentDropAllowed(B))
}return(A!==true?this.isNonComponentDropAllowed(B):this.isComponentDropAllowed(B))
},isInplaceEditingComponent:function(C){var A=CQ.WCM.getContentFinder().getContentWindow();
var B=window.CQ_inplaceEditComp||A.CQ_inplaceEditComp;
return(C.editComponent&&(B===C.editComponent))
},isInplaceEditingDropAllowed:function(A){return A.editComponent.isInplaceEditingDropAllowed(this)
},isNonComponentDropAllowed:function(C){if(C&&C.groups){var A={};
A[CQ.wcm.EditBase.DD_GROUP_COMPONENT]=true;
if(CQ.Util.isIntersecting(this.groups,C.groups,A)){var B=this.dragData.records[0].data.mimeType;
if(B&&C.ddAccept&&C.ddAccept.indexOf("*")==-1){return CQ.Util.isAcceptedMimeType(C.ddAccept,B)
}else{return true
}}}return false
},isComponentDropAllowed:function(A){return A&&A.groups&&A.groups[CQ.wcm.EditBase.DD_GROUP_COMPONENT]&&this.itemsDDNewParagraph&&this.itemsDDNewParagraph.path&&A.editComponent&&A.editComponent.isInsertAllowed(this.itemsDDNewParagraph.path)
},flashDropTargets:function(B){if(!this.dropTargetsHighlighted){for(var A=0;
A<this.dropTargets.length;
A++){if(!this.isDropAllowed(this.dropTargets[A],B)){continue
}if(this.dropTargets[A]==this.cachedTarget){continue
}this.dropTargets[A].flash()
}this.dropTargetsHighlighted=true
}},normalizeDropTargets:function(){for(var A=0;
A<this.dropTargets.length;
A++){this.dropTargets[A].normalize()
}this.dropTargetsHighlighted=false
},onDragCancel:function(A,B){this.clearAnimations(B)
}});
CQ.wcm.Sidekick=CQ.Ext.extend(CQ.Dialog,{pathParam:null,createText:null,createDialog:null,templateSelectionId:null,templateList:null,createChildPageText:null,copyPageText:null,movePageText:null,deleteText:null,deleteUrl:null,publishText:null,publishUrl:null,rolloutText:null,rolloutUrl:null,scaffoldingText:null,referencesText:null,lockText:null,lockedByText:null,unlockText:null,lockUrl:null,locked:false,unlockUrl:null,readOnly:false,versionText:null,versionDialog:null,versionSelectionId:null,versionList:null,restoreText:null,restoreDialog:null,auditText:null,auditDialog:null,permsText:null,permsDialog:null,propsText:null,propsDialog:null,startWorkflowText:null,startWorkflowDialog:null,previewText:null,editText:null,designText:null,adminText:null,miscText:null,adminUrl:null,miscUrl:null,liveCopyStatusText:null,gotoText:null,previewReload:false,actns:null,buttons:null,panels:null,getPath:function(){return this.path
},loadContent:function(C,A){if(typeof C=="string"){if(this.path){var B=0;
for(;
B<CQ.wcm.Sidekick.componentsWithDragZone.length;
B++){if(CQ.wcm.Sidekick.componentsWithDragZone[B].dragZone){CQ.wcm.Sidekick.componentsWithDragZone[B].dragZone.destroy();
delete CQ.wcm.Sidekick.componentsWithDragZone[B].dragZone
}}CQ.wcm.Sidekick.componentsWithDragZone=[];
if(this.items.getCount()==0){this.add({xtype:"panel",cls:"cq-sidekick-loading"});
this.doLayout()
}}this.path=C;
this.initButtons(this.path,this.initialConfig);
this.addButtons();
this.loadPanels(C,A);
this.fireEvent("loadcontent",this)
}},addAction:function(B,E){if(B instanceof Array){for(var D=0;
D<B.length;
D++){this.addAction(B[D],E)
}}else{if(!B.xtype){B.xtype="button"
}if(!B.scope){B.scope=this
}if(!B.handler&&B.dialog){B.handler=function(){try{var H=CQ.WCM.getDialog(B.dialog);
H.loadContent(this.getPath());
H.show()
}catch(G){}}
}if(!B.context){B.context=CQ.wcm.Sidekick.PAGE
}if(!this.actns){this.actns=[]
}if(B.context instanceof Array){for(var D=0;
D<B.context.length;
D++){var C=this.panels[B.context[D]].add(B);
this.actns.push(C);
this.buttons[B.name]=C
}}else{var A=this.panels[B.context];
try{if(!A.hasClass("cq-sidekick-buttons")){A.addClass("cq-sidekick-buttons")
}}catch(F){}var C=A.add(B);
this.actns.push(C);
this.buttons[B.name]=C
}}},getCreateConfig:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var allowed=sidekick.initialConfig.createDialog!=undefined&&CQ.User.getCurrentUser().hasPermissionOn("wcm/core/privileges/modifyhierarchy",this.getPath());
return{text:this.createText,disabled:!allowed,handler:function(){if(!(sidekick.createDialog instanceof CQ.Dialog)){try{if(!sidekick.initialConfig.createDialog){CQ.Log.warn("CQ.wcm.Sidekick#getCreateConfig: no create dialog specified");
return 
}sidekick.createDialog=CQ.WCM.getDialog(sidekick.initialConfig.createDialog);
if(sidekick.templateSelectionId&&sidekick.templateList){var templates=sidekick.templateList;
if(typeof sidekick.templateList=="string"){var url=sidekick.templateList;
url=CQ.HTTP.addParameter(url,sidekick.pathParam,this.getPath());
templates=CQ.HTTP.eval(url)
}CQ.Ext.getCmp(sidekick.templateSelectionId).setOptions(templates,true)
}}catch(e){CQ.Log.error("CQ.wcm.Sidekick#getCreateConfig: failed to build create dialog: {0}",e.message);
return 
}}sidekick.createDialog.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getCreateChildPageConfig:function(){var A=CQ.User.getCurrentUser().hasPermissionOn("wcm/core/privileges/modifyhierarchy",this.getPath())&&CQ.User.getCurrentUser().hasPermissionOn("create",this.getPath());
return{text:this.createChildPageText,disabled:!A,handler:function(){var B=CQ.wcm.Sidekick.findSidekick(this);
var D=this.getPath();
var C=CQ.wcm.Page.getCreatePageDialog(D);
C.success=function(F,E){if(E&&E.result&&E.result.Path){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(E.result.Path+CQ.HTTP.EXTENSION_HTML))
}else{CQ.Util.reload(CQ.WCM.getContentWindow())
}};
C.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create page."))
};
C.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getCopyPageConfig:function(){var A=CQ.User.getCurrentUser().hasPermissionOn("wcm/core/privileges/modifyhierarchy",this.getPath())&&CQ.User.getCurrentUser().hasPermissionOn("create",this.getPath());
return{text:this.copyPageText,disabled:!A,handler:function(){var B=CQ.wcm.Sidekick.findSidekick(this);
var D=this.getPath();
var C=CQ.wcm.Page.getCopyPageDialog(D);
C.success=function(G,I){var E=CQ.HTTP.buildPostResponseFromHTML(I.response);
var F=$CQ.trim(E.headers.Message);
var H=CQ.I18n.getMessage('Current page has been copied to <a href="{0}">{1}</a>',[CQ.shared.HTTP.reloadHook(CQ.HTTP.externalize(F+CQ.HTTP.EXTENSION_HTML)),F]);
CQ.Notification.notify(CQ.I18n.getMessage("Page copied"),H)
};
C.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not copy page."))
};
C.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getMovePageConfig:function(){var A=CQ.User.getCurrentUser().hasPermissionOn("wcm/core/privileges/modifyhierarchy",this.getPath())&&CQ.User.getCurrentUser().hasPermissionOn("delete",this.getPath());
return{text:this.movePageText,disabled:!A,handler:function(){var B=CQ.wcm.Sidekick.findSidekick(this);
var E=this.getPath();
var C=E.substring(E.lastIndexOf("/")+1);
var D=CQ.wcm.Page.getMovePageDialog(E,true);
D.success=function(H){var G="";
try{var J=H.findField("destParentPath").getValue();
var F=H.findField("destName").getValue();
G=J+"/"+F
}catch(I){G=E.substring(0,E.lastIndexOf("/"))
}CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(G+CQ.HTTP.EXTENSION_HTML))
};
D.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not move page."))
};
D.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getDeleteConfig:function(){var A=CQ.User.getCurrentUser().hasPermissionOn("wcm/core/privileges/modifyhierarchy",this.getPath())&&CQ.User.getCurrentUser().hasPermissionOn("delete",this.getPath());
return{text:this.deleteText,disabled:!A,handler:function(){var B=CQ.wcm.Sidekick.findSidekick(this);
var D=this.getPath();
var C=D.substring(D.lastIndexOf("/")+1);
CQ.Ext.Msg.confirm(B.deleteText,CQ.I18n.getMessage("Do you really want to delete '{0}'?",C),function(E){if(E=="yes"){B.internalDelete(false)
}},this)
},context:[CQ.wcm.Sidekick.PAGE]}
},internalDelete:function(A){var C=function(F,H,E){var D=E.headers[CQ.utils.HTTP.HEADER_STATUS];
if(D==200){var G=this.path.substring(0,this.path.lastIndexOf("/"));
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(G+CQ.HTTP.EXTENSION_HTML))
}else{if(D==412){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Page"),msg:"This page is referenced. Click 'yes' to proceed deleting the page, click 'no' to review the references or 'cancel' to cancel the operation.",buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(I){if(I=="yes"){this.internalDelete(true)
}else{if(I=="no"){this.showReferences()
}}},scope:this})
}else{CQ.Notification.notifyFromResponse(E)
}}};
var B={path:this.path,_charset_:"utf-8",cmd:"deletePage",force:A};
CQ.shared.HTTP.post("/bin/wcmcommand",C,B,this)
},getPublishConfig:function(){return{text:this.publishText,handler:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
var B={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:[A.getPath()],callback:function(C){CQ.wcm.SiteAdmin.internalActivatePage(C,function(E,F,D){if(F){CQ.Notification.notify(A.publishText,CQ.I18n.getMessage("Page successfully activated"))
}else{CQ.Notification.notifyFromResponse(D)
}})
}};
new CQ.wcm.AssetReferenceSearchDialog(B)
},context:[CQ.wcm.Sidekick.PAGE]}
},getRolloutConfig:function(){var A=CQ.WCM.getPage(this.path);
return{disabled:!A.isLiveCopySource(),text:this.rolloutText,handler:function(){var B=CQ.wcm.Sidekick.findSidekick(this);
var C=this.getPath();
this.rolloutWizard=new CQ.wcm.msm.RolloutWizard({path:C});
this.rolloutWizard.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getReferencesConfig:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
return{text:this.referencesText,handler:function(){A.showReferences()
},context:[CQ.wcm.Sidekick.PAGE]}
},showReferences:function(){var A=new CQ.wcm.ReferencesDialog({path:this.path});
A.on("pageopen",function(C,B){C.close();
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(B+CQ.HTTP.EXTENSION_HTML))
});
A.show()
},getLockConfig:function(){var A=CQ.WCM.getPage(this.path);
var B;
if(A.isLocked()){if(!A.canUnlock()){B=CQ.Util.patchText(this.lockedByText,A.getLockOwner())
}else{B=this.unlockText
}}else{B=this.lockText
}return{text:B,disabled:A.isLocked()&&!A.canUnlock(),handler:function(){if(this.ignoreClicks){return 
}var C=CQ.wcm.Sidekick.findSidekick(this);
var E=CQ.WCM.getPage(C.path);
if(E){var D=this.buttons[CQ.wcm.Sidekick.LOCK];
D.ignoreClicks=true;
if(this.pageLocked||E.isLocked()){E.unlock(function(G,H,F){if(H){C.pageLocked=false;
D.setText(C.lockText)
}D.ignoreClicks=false
})
}else{E.lock(function(G,H,F){if(H){C.pageLocked=true;
D.setText(C.unlockText)
}D.ignoreClicks=false
})
}}},context:CQ.wcm.Sidekick.PAGE}
},getVersionConfig:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
var B=A.initialConfig.versionDialog!=undefined;
return{text:this.versionText,disabled:!B,handler:function(){if(!(A.versionDialog instanceof CQ.Dialog)){try{if(!A.initialConfig.versionDialog){CQ.Log.warn("CQ.wcm.Sidekick#getVersionConfig: no version dialog specified");
return 
}A.versionDialog=CQ.WCM.getDialog(A.initialConfig.versionDialog)
}catch(C){CQ.Log.error("CQ.wcm.Sidekick#getVersionConfig: failed to build version dialog: {0}",C.message);
return 
}}A.versionDialog.loadContent(this.getPath());
A.versionDialog.show()
},context:CQ.wcm.Sidekick.VERSIONING}
},getRestoreConfig:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
var B=A.initialConfig.restoreDialog!=undefined;
return{text:this.restoreText,disabled:!B,handler:function(){if(!(A.restoreDialog instanceof CQ.Dialog)){try{if(!A.initialConfig.restoreDialog){CQ.Log.warn("CQ.wcm.Sidekick#getRestoreConfig: no restore dialog specified");
return 
}A.restoreDialog=CQ.WCM.getDialog(A.initialConfig.restoreDialog)
}catch(C){CQ.Log.error("CQ.wcm.Sidekick#getRestoreConfig: failed to build restore dialog: {0}",C.message);
return 
}}A.restoreDialog.loadContent(this.getPath());
A.restoreDialog.success=function(){window.setTimeout(function(){CQ.Util.reload(CQ.WCM.getContentWindow())
},1000)
};
A.restoreDialog.show()
},context:CQ.wcm.Sidekick.VERSIONING}
},getAuditConfig:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
var B=A.initialConfig.auditDialog!=undefined;
return{text:this.auditText,disabled:!B,handler:function(){if(!(A.auditDialog instanceof CQ.Dialog)){try{if(!A.initialConfig.auditDialog){CQ.Log.warn("CQ.wcm.Sidekick#getAuditConfig: no audit log dialog specified");
return 
}A.auditDialog=CQ.WCM.getDialog(A.initialConfig.auditDialog)
}catch(C){CQ.Log.error("CQ.wcm.Sidekick#getAuditConfig: failed to build audit log dialog: {0}",C.message);
return 
}}A.auditDialog.loadContent(this.getPath());
A.auditDialog.show()
},context:CQ.wcm.Sidekick.INFO}
},getPermsConfig:function(B){var A=CQ.wcm.Sidekick.findSidekick(this);
var C=B.permsDialog!=undefined||A.initialConfig.permsDialog!=undefined;
return{text:this.permsText,disabled:!C,handler:function(){var D=B.permsDialog?B.permsDialog:A.initialConfig.permsDialog;
var E;
try{if(!D){CQ.Log.warn("CQ.wcm.Sidekick#getPermsConfig: no permissions dialog specified");
return 
}E=CQ.WCM.getDialog(D)
}catch(F){CQ.Log.error("CQ.wcm.Sidekick#getPermsConfig: failed to build permissions dialog: {0}",F.message);
return 
}E.loadContent(this.getPath());
E.show()
},context:CQ.wcm.Sidekick.INFO}
},getPropsConfig:function(C){var B=CQ.wcm.Sidekick.findSidekick(this);
var A=C.propsDialog?C.propsDialog:B.initialConfig.propsDialog;
var D=A&&CQ.User.getCurrentUser().hasPermissionOn("read",A)!==false;
return{text:this.propsText,disabled:!D,handler:function(){var F;
try{var E=CQ.utils.WCM.getContentWindow();
if(!A){CQ.Log.warn("CQ.wcm.Sidekick#getPropsConfig: no properties dialog specified");
return 
}var H=E.CQ.WCM.getDialogConfig(A);
if(!H.success){H.success=function(I,J){CQ.Util.reload(CQ.WCM.getContentWindow())
}
}if(!H.failure){H.failure=function(J,K){var I=CQ.HTTP.buildPostResponseFromHTML(K.response);
CQ.Ext.Msg.alert(I.headers[CQ.HTTP.HEADER_MESSAGE])
}
}F=E.CQ.WCM.getDialog(H,A);
F.fieldEditLockMode=true;
F.loadContent(this.getPath()+"/jcr:content");
F.setTitle(CQ.I18n.getMessage("Page Properties of {0}",this.getPath()))
}catch(G){CQ.Log.error("CQ.wcm.Sidekick#getPropsConfig: failed to build properties dialog: {0}",G.message);
return 
}F.show()
},context:CQ.wcm.Sidekick.PAGE}
},getStartWorkflowConfig:function(){var A=CQ.wcm.Sidekick.findSidekick(this);
var B=A.initialConfig.startWorkflowDialog!=undefined;
return{text:this.startWorkflowText,disabled:!B,handler:function(){if(!(A.startWorkflowDialog instanceof CQ.Dialog)){try{if(!A.initialConfig.startWorkflowDialog){CQ.Log.warn("CQ.wcm.Sidekick#getStartWorkflowConfig: no start workflow dialog specified");
return 
}var C={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Start Workflow"),formUrl:"/etc/workflow/instances",params:{_charset_:"utf-8",payloadType:"JCR_PATH"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",model:{xtype:"combo",name:"model",hiddenName:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflows"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows"},[{name:"wid"},{name:"label"}])})},comment:{"jcr:primaryType":"cq:TextArea",fieldLabel:CQ.I18n.getMessage("Comment"),name:"startComment",height:200},title:{xtype:"textfield",name:"workflowTitle",fieldLabel:CQ.I18n.getMessage("Workflow Title")}}},okText:CQ.I18n.getMessage("Start")};
var D=CQ.WCM.getDialog(C);
D.addHidden({payload:this.getPath()});
D.failure=function(){CQ.Ext.Msg.alert("Error","Could not start workflow.")
};
A.startWorkflowDialog=D
}catch(G){CQ.Log.error("CQ.wcm.Sidekick#getStartWorkflowConfig: failed to build start workflow dialog: {0}",G.message);
return 
}}var E=CQ.WCM.getPageInfo(this.getPath());
var F=E.workflow&&E.workflow.isRunning;
if(!F){A.startWorkflowDialog.getField("payload").setValue(this.getPath());
A.startWorkflowDialog.show()
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Information"),CQ.I18n.getMessage("Page is already subject to a workflow!"))
}},context:CQ.wcm.Sidekick.WORKFLOW}
},loadPanels:function(F,C){var B=this;
if(!C){C={}
}C=CQ.Ext.applyIf(C,this.initialConfig);
if(!this.panelsLoaded){this.panels={};
for(var E=0;
E<CQ.wcm.Sidekick.CONTEXTS.length;
E++){if(CQ.wcm.Sidekick.CONTEXTS[E]==CQ.wcm.Sidekick.COMPONENTS){this.panels[CQ.wcm.Sidekick.CONTEXTS[E]]=new CQ.Ext.Panel({border:false,autoScroll:true,layout:"accordion",stateful:false,id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[E]})
}else{if(CQ.wcm.Sidekick.CONTEXTS[E]==CQ.wcm.Sidekick.VERSIONING||CQ.wcm.Sidekick.CONTEXTS[E]==CQ.wcm.Sidekick.WORKFLOW){this.panels[CQ.wcm.Sidekick.CONTEXTS[E]]=new CQ.Ext.Panel({border:false,stateful:false,layout:"fit",id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[E]})
}else{this.panels[CQ.wcm.Sidekick.CONTEXTS[E]]=new CQ.Ext.Panel({autoScroll:true,border:false,stateful:false,id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[E]})
}}}this.items.get(0).getEl().fadeOut({callback:function(G){B.remove(B.items.get(0),true);
B.add({xtype:"tabpanel",border:false,enableTabScroll:true,deferredRender:false,activeTab:0,stateful:true,id:"cq-sk-tabpanel",listeners:{tabchange:function(I,H,J){H.doLayout()
}},items:[{tabTip:CQ.I18n.getMessage("Components"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-components",items:B.panels[CQ.wcm.Sidekick.COMPONENTS],layout:"fit"},{tabTip:CQ.I18n.getMessage("Page"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-page",items:B.panels[CQ.wcm.Sidekick.PAGE],layout:"fit"},{tabTip:CQ.I18n.getMessage("Information"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-info",items:B.panels[CQ.wcm.Sidekick.INFO],layout:"fit"},{tabTip:CQ.I18n.getMessage("Versioning"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-versioning",items:B.panels[CQ.wcm.Sidekick.VERSIONING],layout:"fit"},{tabTip:CQ.I18n.getMessage("Workflow"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-workflow",items:B.panels[CQ.wcm.Sidekick.WORKFLOW],layout:"fit"}]});
B.doLayout();
B.items.get(0).getEl().fadeIn()
}});
this.panelsLoaded=true
}else{for(var D in this.panels){if(this.panels[D].items){while(this.panels[D].items.getCount()>0){this.panels[D].remove(this.panels[D].items.get(0),true)
}}}}this.loadActions(C);
var A=CQ.WCM.getComponentList(this.path);
CQ.wcm.ComponentList.loadPanel(A,B.panels[CQ.wcm.Sidekick.COMPONENTS]);
A.addListener("updatecomponents",function(H){var G=this.panels[CQ.wcm.Sidekick.COMPONENTS];
if(G.items){G.items.each(function(I){this.remove(I,true)
},G)
}CQ.wcm.ComponentList.loadPanel(H,G)
},B);
window.setTimeout(function(){B.loadVersioningTab();
B.loadWorkflowTab()
},1);
this.doLayout()
},loadVersioningTab:function(){var C=[{name:"name"},{name:"title"},{name:"comment"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"}];
var B=new CQ.Ext.data.JsonReader({root:"versions",fields:C});
var H=new CQ.Ext.grid.CheckboxSelectionModel({singleSelect:true});
var G=function(K,J,I){if(I.data.deleted){J.attr='style="color:grey;"'
}var L=I.data.comment;
if(L){L=CQ.Ext.util.Format.htmlEncode(L);
if(CQ.Ext.QuickTips.isEnabled()){J.attr+=' ext:qtip="'+L+'"'
}else{J.attr+=' title="'+L+'"'
}}return K
};
var D=new CQ.Ext.grid.GridPanel({border:false,width:"auto",autoHeight:true,loadMask:true,stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([H,{header:CQ.I18n.getMessage("Label"),dataIndex:"label",sortable:false,width:50,renderer:G},{header:CQ.I18n.getMessage("Created"),dataIndex:"created",sortable:false,width:116,renderer:G},{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:false,hidden:true,width:80,renderer:G},{header:CQ.I18n.getMessage("Name"),dataIndex:"name",hidden:true,sortable:false,width:80,renderer:G}]),sm:H,store:new CQ.Ext.data.SimpleStore({fields:C}),enableHdMenu:true});
var F=this.panels[CQ.wcm.Sidekick.VERSIONING];
var E=CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),"cq_diffTo")!=null;
var A={xtype:"panel",layout:"accordion",defaults:{xtype:"panel",border:false,autoScroll:true},border:false,items:[{title:CQ.I18n.getMessage("Create Version"),collapsed:E,layout:"form",cls:"cq-sidekick-form",items:[{xtype:"textfield",name:"label",id:"cq-sk-cv-label",fieldLabel:CQ.I18n.getMessage("Label"),listeners:{render:function(){this.el.parent().parent().setStyle("display","none")
}}},{xtype:"textarea",name:"comment",id:"cq-sk-cv-comment",growMin:30,fieldLabel:CQ.I18n.getMessage("Comment"),defaultValue:CQ.I18n.getMessage("Created by {0}",CQ.User.getCurrentUser().getUserName())},{xtype:"panel",layout:"column",border:false,defaults:{border:false},items:[{xtype:"panel",items:{xtype:"button",text:CQ.I18n.getMessage("Create Version"),handler:function(){var I=CQ.wcm.Sidekick.findSidekick(this);
var J=CQ.HTTP.externalize("/bin/wcmcommand");
var K={};
K[CQ.Sling.CHARSET]="utf-8";
K[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
K.cmd="createVersion";
K.label=CQ.Ext.getCmp("cq-sk-cv-label").getValue();
K.comment=CQ.Ext.getCmp("cq-sk-cv-comment").getValue();
K[I.pathParam]=I.getPath();
var L=function(M,P,O){if(P){var N=CQ.HTTP.buildPostResponseFromHTML(O.responseText);
if(N.headers[CQ.HTTP.HEADER_STATUS]=="200"){CQ.Notification.notifyFromResponse(N,null,true);
CQ.Ext.getCmp("cq-sk-cv-label").reset();
CQ.Ext.getCmp("cq-sk-cv-comment").reset()
}}};
CQ.HTTP.post(J,L,K)
}}},{xtype:"panel",items:{xtype:"button",text:CQ.I18n.getMessage("More")+" &raquo;",handler:function(){var I=CQ.Ext.getCmp("cq-sk-cv-label").el.parent().parent();
if(I.isVisible()){I.setStyle("display","none");
this.setText(CQ.I18n.getMessage("More")+" &raquo;")
}else{I.setStyle("display","");
this.setText(CQ.I18n.getMessage("Less")+" &laquo;")
}}}}]}]},{title:CQ.I18n.getMessage("Restore Version"),collapsed:!E,layout:"form",cls:"cq-sidekick-form",listeners:{activate:function(){var J=CQ.wcm.Sidekick.findSidekick(this);
var K="/bin/wcm/versions.json";
K=CQ.HTTP.addParameter(K,J.pathParam,J.getPath());
K=CQ.HTTP.noCaching(K);
var M=B.read(CQ.HTTP.get(CQ.shared.HTTP.externalize(K)));
var I={};
for(var L=0;
L<M.records.length;
L++){var O=M.records[L].data;
I[O.id]=[O.name,O.title,O.comment,O.created,O.label,O.id,O.deleted]
}var N=[];
for(var P in I){N[N.length]=I[P]
}D.getStore().loadData(N);
if(E){D.on("render",function(Q){Q.el.mask()
})
}}},items:[{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[{xtype:"panel",items:{xtype:"button",hidden:true,text:CQ.I18n.getMessage("View"),handler:function(){}}},{xtype:"panel",items:{xtype:"button",text:E?"&laquo; "+CQ.I18n.getMessage("Back"):CQ.I18n.getMessage("Diff"),handler:function(){var I=CQ.wcm.Sidekick.findSidekick(this);
if(E){this.setText(CQ.I18n.getMessage("Diff"));
D.el.unmask();
var J=CQ.HTTP.externalize(I.getPath()+".html");
J=CQ.HTTP.noCaching(J);
CQ.Util.reload(CQ.WCM.getContentWindow(),J)
}else{var K=D.getSelectionModel().getSelected();
if(!K){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return 
}var J=CQ.HTTP.externalize(I.getPath()+".html");
J=CQ.HTTP.addParameter(J,"cq_diffTo",K.data.label);
J=CQ.HTTP.addParameter(J,"wcmmode","preview");
J=CQ.HTTP.noCaching(J);
this.setText("&laquo; "+CQ.I18n.getMessage("Back"));
D.el.mask();
CQ.Util.reload(CQ.WCM.getContentWindow(),J)
}}}},{xtype:"panel",items:{xtype:"button",text:CQ.I18n.getMessage("Restore"),handler:function(){var I=CQ.wcm.Sidekick.findSidekick(this);
var J=D.getSelectionModel().getSelected();
if(!J){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return 
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Restore"),CQ.I18n.getMessage("Do you really want to restore the selected version of this page?"),function(L){if(L=="yes"){var K=CQ.HTTP.externalize("/bin/wcmcommand");
var M={};
M[CQ.Sling.CHARSET]="utf-8";
M[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
M.cmd="restoreVersion";
M.id=J.data.id;
M[I.pathParam]=I.getPath();
var N=function(P,S,R){if(S){var Q=CQ.HTTP.buildPostResponseFromHTML(R.responseText);
if(Q.headers[CQ.HTTP.HEADER_STATUS]=="200"){var O=CQ.HTTP.externalize(I.getPath()+".html");
O=CQ.HTTP.noCaching(O);
CQ.Util.reload(CQ.WCM.getContentWindow(),O)
}}};
CQ.HTTP.post(K,N,M)
}},this)
}}}]},{xtype:"panel",border:false,style:"border-top-width:1px",items:D}]},{title:CQ.I18n.getMessage("Timewarp"),layout:"form",cls:"cq-sidekick-form",items:[{xtype:"datetime",id:"cq.sidekick.timewarp.datetime",dateWidth:90,timeWidth:90,value:"now"},{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[{xtype:"button",text:CQ.I18n.getMessage("Go"),id:"cq.sidekick.timewarp.go_button",handler:function(){var I=CQ.wcm.Sidekick.findSidekick(this);
var K=CQ.Ext.getCmp("cq.sidekick.timewarp.datetime").getDateValue();
if(K){CQ.HTTP.setCookie(CQ.WCM.TIMEWARP_COOKIE,K.getTime(),"/");
var J=CQ.HTTP.externalize(I.getPath()+".html");
I.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),J)
}}},{xtype:"button",text:CQ.I18n.getMessage("Show Timeline"),handler:function(){var I=CQ.wcm.Sidekick.findSidekick(this);
var J=new CQ.Dialog(I.getTimelineWindowConfig());
J.show()
}}]}]}]};
F.add(A);
F.doLayout()
},loadWorkflowTab:function(){var AB=this.panels[CQ.wcm.Sidekick.WORKFLOW];
var K=this.path;
var k=[];
var U=CQ.WCM.getPageInfo(this.getPath());
var I={xtype:"panel",title:CQ.I18n.getMessage("Workflow"),layout:"form",cls:"cq-sidekick-form",border:false};
var M=U.workflowPackageInfo;
var v=U.workflowPackageInfo&&U.workflowPackageInfo.workflowPackages?U.workflowPackageInfo.workflowPackages:[];
var X=U.workflowInfo&&U.workflowInfo.isRunning;
var o=M&&M.selectedWorkflowPackages.length>0;
var a=M&&M.runningSelectedWorkflowPackages.length>0;
var r;
if(!o){if(X){r=[{xtype:"label",text:CQ.I18n.getMessage("Unable to add to a package because of a running workflow.")}]
}else{r=[{xtype:"selection",type:"select",name:"workflowPackage",fieldLabel:CQ.I18n.getMessage("Package"),options:CQ.WCM.getWorkflowPackageOptions(v),listeners:{selectionchanged:function(){CQ.Util.toggleComponent(CQ.Ext.getCmp("cq.sidekick.workflow.package.add"),this.getValue()!="")
}}},{xtype:"panel",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"panel",layout:"column",items:[{xtype:"button",id:"cq.sidekick.workflow.package.add",disabled:true,text:CQ.I18n.getMessage("Add to package"),handler:function(){var j=CQ.wcm.Sidekick.findSidekick(this);
var AH=j.getField("workflowPackage").hiddenField;
var AI={"./root":K,"./sling:resourceType":"cq/workflow/components/collection/definition/resource",":nameHint":"resource",_charset_:"utf-8",parentResourceType:"cq/workflow/components/collection/definition/resourcelist"};
var AJ=function(AL,AN,AM){if(AN){var AK=CQ.HTTP.externalize(j.getPath()+CQ.HTTP.EXTENSION_HTML);
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.noCaching(AK))
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("The page could not be added to that workflow package. Please retry."))
}};
var AG=AH.getValue()+"/jcr:content/vlt:definition/filter/";
CQ.HTTP.post(AG,AJ,AI,null,true)
}}]}]}]
}}else{var F=v[a?M.runningSelectedWorkflowPackages[0]:M.selectedWorkflowPackages[0]];
r=[{xtype:"label",text:CQ.I18n.getMessage("This page is part of package:",null,"Label used to show that a page is part of a workflow package")},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:{xtype:"label",text:F.title,style:{"font-weight":"bold"}}},{xtype:"panel",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"panel",layout:"column",items:[{xtype:"button",text:CQ.I18n.getMessage("Show"),handler:function(){CQ.shared.Util.open(CQ.HTTP.externalize(F.path+CQ.HTTP.EXTENSION_HTML))
}},{xtype:"button",text:CQ.I18n.getMessage("Remove"),handler:function(){var j=CQ.wcm.Sidekick.findSidekick(this);
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Remove page from workflow package"),CQ.I18n.getMessage("You are going to remove this page from the workflow package:<br/>{0}<br/><br/>Are you sure?",[F.title]),function(AI){if(AI=="yes"){var AG={":command":"REMOVE_MEMBER",rcPath:F.path,rcMemberPath:K};
var AH=function(AK,AM,AL){if(AM){var AJ=CQ.HTTP.externalize(j.getPath()+CQ.HTTP.EXTENSION_HTML);
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.noCaching(AJ))
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("The page could not be removed from that workflow package. Please retry."))
}};
CQ.HTTP.post("/libs/wcm/bin/resourcecollection",AH,AG,null,true)
}},this)
}}]}]}]
}var T={collapsed:!o,collapsible:true,xtype:"fieldset",title:CQ.I18n.getMessage("Workflow Package"),cls:"cq-sidekick-fieldset cq-sidekick-wfp-fieldset",items:r,listeners:{expand:function(){this.doLayout()
}}};
if(!X){var P=[];
var z=[];
var N=U.workflows.wcm.models;
for(var y=0;
y<N.length;
++y){P.push({value:N[y]["wid"],text:N[y]["label"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(N[y],"label")})
}var G=U.workflows.translation.models;
for(var y=0;
y<G.length;
++y){z.push({value:G[y]["wid"],text:G[y]["label"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(G[y],"label")})
}I.items=[{xtype:"selection",type:"select",name:"startWorkflowModel",triggerAction:"all",fieldLabel:CQ.I18n.getMessage("Workflow"),selectOnFocus:true,cls:"x-form-element",options:P,listeners:{selectionchanged:function(){CQ.Util.toggleComponent(CQ.Ext.getCmp("cq.sidekick.workflow.start"),this.getValue()!="")
}}},{xtype:"fieldset",collapsed:true,collapsible:true,cls:"cq-sidekick-fieldset",title:CQ.I18n.getMessage("Additional information"),items:[{xtype:"textarea",fieldLabel:CQ.I18n.getMessage("Comment"),cls:"x-form-element",name:"startComment",height:38},{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Workflow Title"),cls:"x-form-element",name:"workflowTitle"}]},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:[new CQ.Ext.Button({id:"cq.sidekick.workflow.start",disabled:true,text:CQ.I18n.getMessage("Start Workflow"),handler:function(){var AG=CQ.wcm.Sidekick.findSidekick(this);
var AI=AG.getField("startWorkflowModel").hiddenField;
var j=AG.getField("startComment");
var AJ={_charset_:"utf-8",payloadType:"JCR_PATH",payload:K,model:AI.getValue(),startComment:j.getValue(),workflowTitle:AG.getField("workflowTitle").getValue()};
var AH="/etc/workflow/instances";
var AK=function(AM,AP,AO){if(AP){var AN=CQ.HTTP.buildPostResponseFromHTML(AO.responseText);
if(AN.headers[CQ.HTTP.HEADER_STATUS]=="201"){var AL=CQ.Util.externalize(AG.getPath()+".html");
AL=CQ.HTTP.noCaching(AL);
CQ.Util.reload(CQ.WCM.getContentWindow(),AL)
}}};
CQ.HTTP.post(AH,AK,AJ)
}})]},T]
}else{var A=U.workflowInfo.workitems;
var AE=(U.workflowInfo.title)?U.workflowInfo.title+" ("+U.workflowInfo.model.title+")":U.workflowInfo.model.title;
var Y=A.length>0;
var u=X&&!a&&Y;
if(!u){I.items=[{xtype:"panel",border:false,cls:"cq-sidekick-wf-info-panel",items:[{xtype:"label",text:CQ.I18n.getMessage("This page is subject to workflow:",null,"Label used to show that a page is subject to a workflow")},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:{xtype:"label",text:AE,style:{"font-weight":"bold"}}}]},T]
}else{var B=function(){var j=CQ.Ext.getCmp("cq.sidekick.workflow.workitems");
return j.getValue()
};
var q=function(){var AM=CQ.WCM.getPageInfo(CQ.WCM.getPagePath(),true);
var AL=CQ.Ext.getCmp("cq.sidekick.workflow.workitems");
var AK=AM.workflowInfo.workitems;
if(AK.length>0){var AJ=[];
for(var AI=0;
AI<AK.length;
++AI){AJ.push({text:AK[AI]["title"],value:AK[AI]["id"]})
}AL.setOptions(AJ);
AL.setValue(AK[0]["id"])
}else{var AG=CQ.wcm.Sidekick.findSidekick(this);
var AH=CQ.Util.externalize(AG.getPath()+".html");
AH=CQ.HTTP.noCaching(AH);
CQ.Util.reload(CQ.WCM.getContentWindow(),AH)
}};
var AF=new CQ.Ext.Action({cls:"cq.workflow.sidekick.complete",text:CQ.I18n.getMessage("Complete"),getWorkItemPath:B,reload:q,handler:function(){var j=this.getWorkItemPath();
if(null===j){this.disable()
}else{var AH={xtype:"dialog",title:CQ.I18n.getMessage("Complete Work Item"),formUrl:CQ.shared.HTTP.externalize("/bin/workflow/inbox"),params:{item:j,_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"selection",id:"cq.workflow.sidekick.complete.dialog.combo",type:"select",name:"route",fieldLabel:CQ.I18n.getMessage("Next Step"),selectOnFocus:true,cls:"x-form-element",options:j+".routes.json",optionsRoot:"routes",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a destination ..."),title:CQ.I18n.getMessage("Available Destinations"),allowBlank:false},editable:false},{xtype:"textarea",name:"comment",fieldLabel:CQ.I18n.getMessage("Comment")}]},responseScope:this,success:function(){this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not complete workflow step."))
},buttons:CQ.Dialog.OKCANCEL,listeners:{show:function(AI){var AJ=AI.getField("route");
AJ.setValue(AJ.comboBox.store.getAt(0).data.value)
}}};
CQ.WCM.unregisterDialog("cq.workflow.sidekick.complete.dialog");
var AG=CQ.WCM.getDialog(AH,"cq.workflow.sidekick.complete.dialog");
AG.show()
}},tooltip:{title:CQ.I18n.getMessage("Complete Item"),text:CQ.I18n.getMessage("Completes the selected inbox item and advances workflow to the next step"),autoHide:true}});
var H=new CQ.Ext.Action({cls:"cq.workflow.sidekick.stepBack",text:CQ.I18n.getMessage("Step Back"),getWorkItemPath:B,reload:q,handler:function(){var j=this.getWorkItemPath();
if(null===j){this.disable()
}else{var AG={xtype:"dialog",title:CQ.I18n.getMessage("Step Back"),formUrl:"/bin/workflow/inbox",params:{item:j,_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"selection",id:"cq.workflow.sidekick.back.dialog.combo",type:"select",name:"backroute",fieldLabel:CQ.I18n.getMessage("Previous Step"),selectOnFocus:true,cls:"x-form-element",options:j+".backroutes.json",optionsRoot:"backroutes",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a destination ..."),title:CQ.I18n.getMessage("Available Destinations"),allowBlank:false},editable:false},{xtype:"textarea",name:"comment",fieldLabel:CQ.I18n.getMessage("Comment")}]},responseScope:this,success:function(){this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not assign the work item to the step specified."))
},buttons:CQ.Dialog.OKCANCEL,listeners:{show:function(AI){var AJ=AI.getField("backroute");
AJ.setValue(AJ.comboBox.store.getAt(0).data.value)
}}};
CQ.WCM.unregisterDialog("cq.workflow.sidekick.back.dialog");
var AH=CQ.WCM.getDialog(AG,"cq.workflow.sidekick.back.dialog");
AH.show()
}},tooltip:{title:CQ.I18n.getMessage("Step Back"),text:CQ.I18n.getMessage("Go one step back in the workflow"),autoHide:true}});
var g=new CQ.Ext.Action({cls:"cq.workflow.sidekick.delegate",text:CQ.I18n.getMessage("Delegate"),getWorkItemPath:B,reload:q,handler:function(){var j=this.getWorkItemPath();
if(null===j){this.disable()
}else{var AH={xtype:"dialog",title:"Delegate Work Item",formUrl:"/bin/workflow/inbox",params:{item:j,_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"selection",type:"select",name:"delegatee",hiddenName:"delegatee",fieldLabel:CQ.I18n.getMessage("User"),selectOnFocus:true,cls:"x-form-element",options:j+".delegatees.json",optionsRoot:"delegatees",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a user ..."),title:CQ.I18n.getMessage("Available Users"),allowBlank:false},editable:false},{xtype:"textarea",name:"comment",fieldLabel:CQ.I18n.getMessage("Comment")}]},responseScope:this,success:function(){CQ.Notification.notify(null,CQ.I18n.getMessage("Work item has been delegated."));
this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not delegate work item."))
},buttons:CQ.Dialog.OKCANCEL};
var AG=CQ.WCM.getDialog(AH);
AG.show()
}},tooltip:{title:CQ.I18n.getMessage("Delegate Item"),text:CQ.I18n.getMessage("Delegates the selected inbox item to another user or group"),autoHide:true}});
var L=[];
for(var x=0;
x<A.length;
++x){L.push({text:A[x]["title"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(A[x],"title"),value:A[x]["id"]})
}I.items=[{xtype:"panel",border:false,cls:"cq-sidekick-wf-info-panel",items:{xtype:"label",text:AE,style:{"font-weight":"bold"}}},{xtype:"selection",id:"cq.sidekick.workflow.workitems",type:"select",name:"selectedWorkItem",triggerAction:"all",fieldLabel:CQ.I18n.getMessage("Current Step"),selectOnFocus:true,allowBlank:false,cls:"x-form-element",options:L,value:A[0]["id"],editable:false},new CQ.Ext.Button(AF),new CQ.Ext.Button(H),new CQ.Ext.Button(g),T]
}}k.push(I);
var AD=U.blueprint;
var O=[];
if(AD&&AD["msm:slavePaths"]){var S=AD["msm:slavePaths"];
for(var y=0;
y<S.length;
++y){O.push({text:S[y],value:S[y],checked:true})
}}if(O.length>0){var Q=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Rollout"),layout:"form",cls:"cq-sidekick-form",items:[{xtype:"selection",cls:"x-form-field",name:"target",fieldLabel:CQ.I18n.getMessage("Select Targets"),type:"checkbox",options:O},{xtype:"selection",name:"type",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Rollout Type"),type:"radio",value:"page",options:[{text:CQ.I18n.getMessage("Entire Page"),value:"page"},{text:CQ.I18n.getMessage("Page and child pages"),value:"deep"},{text:CQ.I18n.getMessage("Selected components"),value:"selected"},{text:CQ.I18n.getMessage("Delete and rollout selected"),value:"delete"}]},{xtype:"panel",cls:"cq-sidekick-form",border:false,items:{xtype:"button",text:CQ.I18n.getMessage("Rollout"),handler:function(){var AH=CQ.wcm.Sidekick.findSidekick(this);
var AL=AH.getField("target");
var AG=AH.getField("type").getValue();
var AK=false;
var AN=[];
if(AL.getValue().length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one target!"));
return 
}if(AG=="selected"||AG=="delete"){var AI=CQ.WCM.getContentWindow().CQ.WCM.getSelection();
AI.each(function(){if(this.path&&this.path.charAt(this.path.length-1)!="*"){AN.push(this.path)
}});
if(AN.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one component."));
return 
}}var AJ={_charset_:"utf-8",cmd:"rollout",path:K,target:AL.getValue(),type:AG};
if(AN.length>0){AJ.paras=AN
}var j="/bin/wcmcommand";
var AM=function(AP,AS,AR){if(AS){var AQ=CQ.HTTP.buildPostResponseFromHTML(AR.responseText);
if(AQ.headers[CQ.HTTP.HEADER_STATUS]=="200"){var AO=CQ.I18n.getMessage("Rolled out this page.");
if(AG=="deep"){AO=CQ.I18n.getMessage("Rolled out this page and all child pages.")
}else{if(AG=="selected"){AO=CQ.I18n.getMessage("Rolled out the selected components.")
}else{if(AG=="delete"){AO=CQ.I18n.getMessage("Deleted and rolled out the selected components.")
}}}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),AO,function(){if(AG=="delete"){var AT=CQ.HTTP.externalize(AH.getPath()+".html");
AT=CQ.HTTP.noCaching(AT);
CQ.Util.reload(CQ.WCM.getContentWindow(),AT)
}})
}}};
CQ.HTTP.post(j,AM,AJ)
}}}]});
k.push(Q)
}var b=false;
var n={};
try{n=U.translation;
if(U.workflow&&U.workflow.isRunning){b=true
}else{var d=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var t=U.languages.rows;
var m=[];
if(t){for(var y=0;
y<t.length;
y++){var W=t[y];
if(W.path!=this.path){var J="";
var D="cursor:pointer;";
if(W.exists){D+="color:black;";
J="<a href='"+CQ.HTTP.externalize(W.path)+".html' target='_new' style='"+D+"' title='"+W.language+"'><img style='vertical-align:text-bottom;width:20px;margin-left:5px;' src='"+CQ.shared.HTTP.getXhrHookedURL(d+W.country+".gif")+"'></a>"
}else{D+="color:#888888;";
J="<a href='"+CQ.HTTP.externalize(W.path)+".html' target='_new' style='"+D+"' title='"+W.language+"'><img style='vertical-align:text-bottom;opacity:0.4;filter:alpha(opacity=40);width:20px;margin-left:5px' src='"+CQ.shared.HTTP.getXhrHookedURL(d+W.country+".gif")+"'></a>"
}var Z="<span style='"+D+"'><a href='"+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(W.path)+".html")+"' target='_new' title='"+W.language+"' style='"+D+"'>"+W.language+"</a></span>";
m.push({text:J+" "+Z,value:W.path})
}}}}}catch(AC){}var R;
if(!b){R=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Translation"),layout:"form",cls:"cq-sidekick-form",items:[{xtype:"selection",cls:"x-form-field",name:"langTargets",fieldLabel:CQ.I18n.getMessage("Select Languages"),type:"checkbox",options:m},{xtype:"selection",type:"select",name:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),selectOnFocus:true,allowBlank:false,cls:"x-form-element",options:z},{xtype:"panel",layout:"column",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"panel",items:[{xtype:"button",text:CQ.I18n.getMessage("Translate"),handler:function(){var AG=CQ.wcm.Sidekick.findSidekick(this);
var j=AG.getField("langTargets").getValue();
var AJ=AG.getField("model").hiddenField;
var AI="/libs/wcm/msm/content/commands/translate";
if(AJ.getValue()==""){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a workflow first."));
return 
}if(j.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one target."));
return 
}var AK={_charset_:"utf-8",path:K,target:j,model:AJ.getValue()};
CQ.HTTP.post(AI,null,AK);
var AH=CQ.HTTP.externalize(AG.getPath()+".html");
AH=CQ.HTTP.noCaching(AH);
CQ.Util.reload(CQ.WCM.getContentWindow(),AH)
}}]}]}]})
}else{var w=new CQ.Ext.grid.CheckboxSelectionModel({singleSelect:true});
var E=function(AH,AG,j){if(j.data.deleted){AG.attr='style="color:grey;"'
}var AI=j.data.comment;
if(AI){AI=CQ.Ext.util.Format.htmlEncode(AI);
if(CQ.Ext.QuickTips.isEnabled()){AG.attr+=' ext:qtip="'+AI+'"'
}else{AG.attr+=' title="'+AI+'"'
}}return AH
};
var AA=new CQ.Ext.grid.GridPanel({border:false,width:"auto",autoHeight:true,loadMask:true,stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([w,{header:CQ.I18n.getMessage("Label"),dataIndex:"label",sortable:false,width:50,renderer:E},{header:CQ.I18n.getMessage("Created"),dataIndex:"created",sortable:false,width:116,renderer:E},{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:false,hidden:true,width:80,renderer:E},{header:CQ.I18n.getMessage("Name"),dataIndex:"name",hidden:true,sortable:false,width:80,renderer:E}]),sm:w,store:new CQ.Ext.data.SimpleStore({fields:[{name:"name"},{name:"title"},{name:"comment"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"}]}),enableHdMenu:true});
var V=CQ.I18n.getMessage("Show Side-By-Side");
var c=CQ.I18n.getMessage("Hide");
R=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Translation"),layout:"form",cls:"cq-sidekick-form",listeners:{beforeexpand:function(){var AG=CQ.wcm.Sidekick.findSidekick(this);
var j={};
var AL=n.original.versions;
for(var AH=0;
AH<AL.length;
AH++){var AJ=AL[AH];
j[AJ.id]=[AJ.name,AJ.title,AJ.comment,AJ.created,AJ.label,AJ.id,AJ.deleted]
}var AI=[];
for(var AK in j){AI[AI.length]=j[AK]
}AA.getStore().loadData(AI);
if(CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),"cq_diffTo")!=null){AA.on("render",function(AM){AM.el.mask()
})
}}},items:[{xtype:"panel",layout:"column",border:true,defaults:{border:false,autoScroll:true},items:[{xtype:"panel",items:{xtype:"button",text:CQ.WCM.getContentFinder()&&CQ.WCM.getContentFinder().isSideBoardCollapsed()?V:c,handler:function(){var j=CQ.wcm.Sidekick.findSidekick(this);
if(CQ.WCM.getContentFinder().isSideBoardCollapsed()){var AH=AA.getSelectionModel().getSelected();
if(!AH){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return 
}var AG=CQ.HTTP.externalize(n.original.path+".html");
AG=CQ.HTTP.addParameter(AG,"cq_diffTo",AH.data.label);
AG=CQ.HTTP.addParameter(AG,"wcmmode","disabled");
AG=CQ.HTTP.noCaching(AG);
this.setText(c);
AA.el.mask();
CQ.WCM.getContentFinder().openSideBoard(AG,400)
}else{AA.el.unmask();
this.setText(V);
CQ.WCM.getContentFinder().closeSideBoard()
}}}},{xtype:"panel",border:false,style:"border-top-width: 1px",items:AA}]}]})
}k.push(R);
var C=new CQ.Ext.Panel({layout:"accordion",border:false,defaults:{autoScroll:true,xtype:"panel",border:false},items:k});
AB.add(C);
AB.doLayout()
},getTimelineWindowConfig:function(){return{cls:"cq-timewarpdialog",title:CQ.I18n.getMessage("Timeline"),layout:"fit",y:100,width:800,height:300,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,closable:true,closeAction:"hide",stateful:false,buttons:[{text:CQ.I18n.getMessage("Go"),handler:function(C){var B=(CQ.WCM.isTimewarpMode())?CQ.Ext.getCmp("cq.sidekick.timewarp.datetime_outside"):CQ.Ext.getCmp("cq.sidekick.timewarp.datetime");
if(B){CQ.HTTP.setCookie(window.parent.CQ.WCM.TIMEWARP_COOKIE,B.getValue().getTime(),"/")
}var A=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(CQ.WCM.getSidekick().getPath()+".html"));
CQ.WCM.getSidekick().destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),A);
this.close()
}},CQ.Dialog.CANCEL],items:[{html:'<iframe frameborder="0" width="100%" height="100%" src="'+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/wcm/core/content/tools/timewarp.html")+"?path="+this.getPath())+'"></iframe>'}]}
},loadActions:function(A){CQ.Timing.stamp("Start rendering sidekick");
this.buttons={};
var G=A.actions;
for(var B=0;
B<G.length;
B++){var C=G[B];
var F,E;
if(typeof C=="string"){E=C;
if(C==CQ.wcm.Sidekick.CREATE){F=this.getCreateConfig()
}if(C==CQ.wcm.Sidekick.CREATECHILDPAGE){F=this.getCreateChildPageConfig()
}if(C==CQ.wcm.Sidekick.COPYPAGE){F=this.getCopyPageConfig()
}if(C==CQ.wcm.Sidekick.MOVEPAGE){F=this.getMovePageConfig()
}if(C==CQ.wcm.Sidekick.DELETE){F=this.getDeleteConfig()
}if(C==CQ.wcm.Sidekick.PUBLISH){F=this.getPublishConfig()
}if(C==CQ.wcm.Sidekick.ROLLOUT){F=this.getRolloutConfig()
}if(C==CQ.wcm.Sidekick.REFERENCES){F=this.getReferencesConfig()
}if(C==CQ.wcm.Sidekick.LOCK){F=this.getLockConfig()
}if(C==CQ.wcm.Sidekick.VERSION){F=this.getVersionConfig()
}if(C==CQ.wcm.Sidekick.RESTORE){F=this.getRestoreConfig()
}if(C==CQ.wcm.Sidekick.AUDIT){F=this.getAuditConfig()
}if(C==CQ.wcm.Sidekick.PERMS){F=this.getPermsConfig(A)
}if(C==CQ.wcm.Sidekick.PROPS){F=this.getPropsConfig(A)
}if(C==CQ.wcm.Sidekick.START_WORKFLOW){F=this.getStartWorkflowConfig()
}}else{F=C;
E=C?C.text:""
}if(F){F.name=E;
F.disabled|=A.readOnly;
this.addAction(F,true)
}}for(var D in this.panels){this.panels[D].doLayout()
}CQ.Timing.stamp("Completed rendering sidekick")
},initComponent:function(){CQ.wcm.Sidekick.superclass.initComponent.call(this);
this.on("render",function(){if(CQ.WCM.getContentFinder()){this.header.on("mousedown",function(B){window.setTimeout(function(){CQ.wcm.ContentFinder.maskFrame()
},1)
})
}this.header.on("dblclick",function(){if(!this.collapsed){this.collapse()
}else{this.expand()
}},this);
this.header.on("mousedown",function(){this.suspendObservation=true
},this);
this.header.on("mouseup",function(){this.suspendObservation=false
},this);
this.previewSwitch=this.header.child(".x-tool-toggle");
this.previewSwitch.on("click",function(){var B=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
if(this.collapsed&&(!CQ.WCM.isEditMode()||B)){var D=CQ.WCM.getPage(this.path);
var C=CQ.WCM.isDesignMode();
this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_EDIT);
if(B){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(this.path+".html"))
}else{if(C){CQ.Util.reload(CQ.WCM.getContentWindow())
}else{if(!this.pageLocked&&!D.isReadOnly()){CQ.WCM.getContentWindow().CQ.WCM.show()
}}}this.editButton.toggle(true)
}},this);
var A=this;
window.setTimeout(function(){CQ.Util.observeComponent(A,307)
},103);
CQ.Ext.EventManager.onWindowResize(function(){this.lastCheckedPos=null
},this)
});
this.on("beforeshow",function(){var A=CQ.Ext.state.Manager.get(this.stateId||this.id);
var G=true;
if(A){var E=CQ.Ext.lib.Dom.getViewportWidth();
var F=CQ.Ext.lib.Dom.getViewportHeight();
if(A.winWidth==E&&A.winHeight==F){G=false;
var I=CQ.Ext.getDoc().getScroll();
A.x=A.x-I.left;
A.y=A.y-I.top;
this.pin()
}}if(G){this.pin("tr")
}var B=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
if(CQ.WCM.isEditMode()&&!B){this.expand()
}else{this.collapse()
}if(CQ.WCM.isTimewarpMode()){var D=new Date(parseInt(CQ.HTTP.getCookie(CQ.WCM.TIMEWARP_COOKIE)));
var H=new CQ.Ext.Panel({xtype:"panel",width:this.width,title:CQ.I18n.getMessage("Timewarp"),cls:"cq-sidekick-form-timewarp cq-sidekick-form",renderTo:this.getEl(),items:{xtype:"panel",border:false,cls:"cq-sidekick-timewarp-panel",layout:"form",items:[{xtype:"panel",layout:"column",border:false,items:[{xtype:"panel",border:false,cls:"cq-sidekick-timewarp-datetime",items:{xtype:"datetime",id:"cq.sidekick.timewarp.datetime_outside",dateWidth:85,timeWidth:85,value:D}},{xtype:"button",text:CQ.I18n.getMessage("Go"),id:"cq.sidekick.timewarp.go_button_outside",handler:function(){var J=CQ.WCM.getSidekick();
var L=CQ.Ext.getCmp("cq.sidekick.timewarp.datetime_outside").getDateValue();
if(L){CQ.HTTP.setCookie(CQ.WCM.TIMEWARP_COOKIE,L.getTime(),"/");
var K=CQ.HTTP.externalize(J.getPath()+".html");
J.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),K)
}}}]},{xtype:"panel",layout:"column",border:false,defaults:{border:false},items:[{xtype:"button",text:CQ.I18n.getMessage("Exit Timewarp"),handler:function(){var J=CQ.WCM.getSidekick();
CQ.HTTP.clearCookie(CQ.WCM.TIMEWARP_COOKIE,"/");
var K=CQ.HTTP.externalize(J.getPath()+".html");
J.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),K);
var L=CQ.WCM.getContentFinder();
if(L){L.expand()
}}},{xtype:"button",text:CQ.I18n.getMessage("Show Timeline"),handler:function(){var J=CQ.WCM.getSidekick();
var K=new CQ.Dialog(J.getTimelineWindowConfig());
K.show()
}}]}]}});
var C=CQ.WCM.getContentFinder();
if(C){C.collapse()
}H.show()
}});
this.on("beforestatesave",function(B,C){C.winWidth=CQ.Ext.lib.Dom.getViewportWidth();
C.winHeight=CQ.Ext.lib.Dom.getViewportHeight();
var A=CQ.Ext.getDoc().getScroll();
C.x=C.x-A.left;
C.y=C.y-A.top;
return true
});
this.on("loadcontent",function(B){var A=CQ.WCM.getPage(this.path);
if(A.isLiveCopy()){this.liveCopyStatusButton.show();
this.liveCopyStatusButton.toggle(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS))
}else{this.liveCopyStatusButton.hide()
}if(A.isDesignable()){this.designButton.show()
}else{this.designButton.hide()
}});
this.on("move",function(){this.suspendObservation=false
},this)
},overridePosition:function(){},pin:function(A){this.alignToViewport(A);
if(CQ.WCM.isContentWindow(window)){this.isPinned=true
}},unpin:function(){if(this.isPinned){this.isPinned=false
}},observe:function(){if(!this.suspendObservation){this.checkPosition()
}},checkPosition:function(){var C=this.getBox();
var H={x:C.x,y:C.y};
var B=CQ.Ext.getDoc().getScroll();
var F=false;
if(!this.lastScroll){this.lastScroll={left:0,top:0}
}if(this.lastScroll.top!=B.top||this.lastScroll.left!=B.left){F=true;
if(this.isPinned&&!this.startScroll){this.startScroll=this.lastScroll
}}else{if(this.isPinned&&this.startScroll){H.x+=B.left-this.startScroll.left;
H.y+=B.top-this.startScroll.top;
if(C.x!=H.x||C.y!=H.y){this.setPosition(H.x,H.y);
this.lastCheckedPos=H
}this.startScroll=null;
return 
}}if(F){this.lastScroll=B;
this.lastCheckedPos=null;
return 
}if(this.lastCheckedPos&&this.lastCheckedPos.x==H.x&&this.lastCheckedPos.y==H.y){return 
}var A=B.left;
var G=B.top;
var E=A+CQ.Ext.lib.Dom.getViewportWidth();
var D=G+CQ.Ext.lib.Dom.getViewportHeight()-18;
if(C.x+CQ.themes.Dialog.CORNER_X>E){H.x=E-CQ.themes.Dialog.CORNER_X
}if(C.x+(C.width-CQ.themes.Dialog.CORNER_X)<A){H.x=-C.width+CQ.themes.Dialog.CORNER_X
}if(C.y+CQ.themes.Dialog.CORNER_Y>D){H.y=D-CQ.themes.Dialog.CORNER_Y
}if(C.y<G){H.y=G
}this.lastCheckedPos=H;
if(C.x!=H.x||C.y!=H.y){this.setPosition(H.x,H.y)
}},createGhost:function(){var A=CQ.wcm.Sidekick.superclass.createGhost.apply(this,arguments);
A.first().addClass("cq-sidekick");
return A
},constructor:function(A){CQ.Util.applyDefaults(A,{actions:CQ.wcm.Sidekick.DEFAULT_ACTIONS,pathParam:"path",reloadText:CQ.I18n.getMessage("Reload"),previewText:CQ.I18n.getMessage("Preview"),editText:CQ.I18n.getMessage("Edit"),designText:CQ.I18n.getMessage("Design"),adminText:CQ.I18n.getMessage("Websites"),miscText:CQ.I18n.getMessage("Tools"),adminUrl:"/siteadmin",miscUrl:"/miscadmin",liveCopyStatusText:CQ.I18n.getMessage("Live Copy Status"),createText:CQ.I18n.getMessage("Create Page..."),createDialog:"/libs/wcm/core/content/tools/sidekickcreatepagedialog",templateList:"/bin/wcmcommand?cmd=getTemplates",templateSelectionId:"templateselection",scaffoldingText:CQ.I18n.getMessage("Scaffolding"),deleteText:CQ.I18n.getMessage("Delete Page"),deleteUrl:"/bin/wcmcommand?cmd=deletePage",createChildPageText:CQ.I18n.getMessage("Create Child Page"),copyPageText:CQ.I18n.getMessage("Copy Page"),movePageText:CQ.I18n.getMessage("Move Page"),publishText:CQ.I18n.getMessage("Activate Page"),publishUrl:"/bin/replicate.json",referencesText:CQ.I18n.getMessage("Show References..."),rolloutText:CQ.I18n.getMessage("Rollout Page"),rolloutUrl:"/bin/wcmcommand?cmd=rollout",lockText:CQ.I18n.getMessage("Lock Page"),lockedByText:CQ.I18n.getMessage("Locked by {0}"),unlockText:CQ.I18n.getMessage("Unlock Page"),lockUrl:"/bin/wcmcommand?cmd=lockPage",unlockUrl:"/bin/wcmcommand?cmd=unlockPage",versionText:CQ.I18n.getMessage("Create Version..."),versionDialog:"/libs/wcm/core/content/tools/createversiondialog",versionList:"/bin/wcmcommand?cmd=getRevisions",versionSelectionId:"versionselection",restoreText:CQ.I18n.getMessage("Restore"),restoreDialog:"/libs/wcm/core/content/tools/restoreversiondialog",auditText:CQ.I18n.getMessage("Audit Log..."),auditDialog:"/libs/wcm/core/content/tools/auditlogdialog",permsText:CQ.I18n.getMessage("Permissions..."),permsDialog:"/libs/wcm/core/content/tools/permissiondialog",propsText:CQ.I18n.getMessage("Page Properties..."),propsDialog:"/libs/foundation/components/page/dialog",startWorkflowText:CQ.I18n.getMessage("Start Workflow"),startWorkflowDialog:"/libs/wcm/core/content/tools/startworkflowdialog",helpPath:"en/cq/current/wcm.html",warnIfModified:false});
this.wcmMode=CQ.WCM.getMode();
this.applyConfigDefaults(A,{dialog:{id:"cq-sk",stateful:true,closable:false,collapsible:true,border:false,bodyStyle:CQ.themes.wcm.Sidekick.BODY_STYLE,width:CQ.themes.wcm.Sidekick.WIDTH,height:CQ.themes.wcm.Sidekick.HEIGHT,minWidth:CQ.themes.wcm.Sidekick.MIN_WIDTH,minHeight:CQ.themes.wcm.Sidekick.MIN_HEIGHT,resizable:CQ.themes.wcm.Sidekick.RESIZABLE,resizeHandles:CQ.themes.wcm.Sidekick.RESIZE_HANDLES,headerAsText:false,autoHeight:false,autoWidth:false,cls:"cq-sidekick",tools:[{id:"help",handler:function(){CQ.wcm.HelpBrowser.show(A.helpPath)
}}],bbar:{},items:{border:false,xtype:"panel",cls:"cq-sidekick-loading"}}});
CQ.wcm.Sidekick.superclass.constructor.call(this,A)
},initButtons:function(N,B){this.reloadButton=new CQ.Ext.Button({iconCls:"cq-sidekick-reload",tooltip:{title:B.reloadText,text:CQ.I18n.getMessage("Reload the page"),autoHide:true},handler:function(){CQ.Util.reload(CQ.WCM.getContentWindow())
}});
this.previewButton=new CQ.Ext.Button({iconCls:"cq-sidekick-preview",tooltip:{title:B.previewText,text:CQ.I18n.getMessage("Switch to preview mode"),autoHide:true},pressed:CQ.WCM.isPreviewMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isPreviewMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_PREVIEW);
if(!this.previewReload){CQ.WCM.getContentWindow().CQ.WCM.hide()
}else{CQ.Util.reload(CQ.WCM.getContentWindow())
}this.collapse()
}else{this.previewButton.toggle(true)
}},scope:this});
this.scaffoldingButton=new CQ.Ext.Button({iconCls:"cq-sidekick-scaffolding",tooltip:{title:B.scaffoldingText,text:CQ.I18n.getMessage("Switch to scaffolding mode"),autoHide:true},pressed:CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0,handler:function(){var O=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
if(!O){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(this.path+".scaffolding.html"));
this.collapse()
}},scope:this});
var M={iconCls:"cq-sidekick-edit",tooltip:{title:B.editText,text:CQ.I18n.getMessage("Switch to edit mode"),autoHide:true},pressed:CQ.WCM.isEditMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isEditMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_EDIT);
CQ.WCM.getContentWindow().CQ.WCM.show()
}else{this.editButton.toggle(true)
}},scope:this};
if(N){var K=CQ.WCM.getPageInfo(N);
if(K&&K.emulators){var D=K.emulators;
var F=[];
if(D.groups){for(var L in D.groups){var J=D.groups[L];
F.push({xtype:"titleseparator",title:J.title});
var C=[];
for(var H in J){var I=J[H];
if(null==I||!I.path){continue
}F.push({text:I.text,icon:I.path?CQ.HTTP.externalize(I.path+"/resources/sidekick-icon-"+H+".png"):CQ.HTTP.externalize("/libs/cq/ui/resources/0.gif"),checked:I.isDefault===true||I.isDefault=="true",group:"emulators",value:H,action:I.action,checkHandler:function(Q,P){var O=CQ.WCM.getEmulatorManager();
if(O){if(P){if(this.action=="start"){O.switchEmulator(this.value)
}else{O.stopEmulator()
}}}}})
}}}else{for(var A in D){var G=D[A];
F.push({text:G.text,icon:G.path?G.path+"/resources/sidekick-icon-"+A+".png":"/libs/cq/ui/resources/0.gif",checked:G.isDefault===true||G.isDefault=="true",group:"emulators",value:A,action:G.action,checkHandler:function(Q,P){var O=CQ.WCM.getEmulatorManager();
if(O){if(P){if(this.action=="start"){O.switchEmulator(this.value)
}else{O.stopEmulator()
}}}}})
}}if(F.length>0){M=CQ.Util.applyDefaults({menu:{items:F}},M)
}}}this.editButton=new CQ.Ext.Button(M);
this.designButton=new CQ.Ext.Button({iconCls:"cq-sidekick-design",tooltip:{title:B.designText,text:CQ.I18n.getMessage("Switch to design mode"),autoHide:true},pressed:CQ.WCM.isDesignMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isDesignMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_DESIGN);
CQ.Util.reload(CQ.WCM.getContentWindow());
this.collapse()
}else{this.designButton.toggle(true)
}},scope:this});
var E=N.indexOf("/etc/")==0;
this.adminButton=new CQ.Ext.Button({iconCls:E?"cq-sidekick-miscadmin":"cq-sidekick-siteadmin",tooltip:{title:E?B.miscText:B.adminText,text:E?CQ.I18n.getMessage("Go to Tools"):CQ.I18n.getMessage("Go to Websites"),autoHide:true},handler:function(P,O){if(this.multiWinMode==undefined){var Q=CQ.User.getCurrentUser().getPreference("winMode");
this.multiWinMode=(Q!="single")
}var S=CQ.HTTP.externalize(B.adminUrl);
var R=this.getPath();
if(R.indexOf("/etc/")==0){S=CQ.HTTP.externalize(B.miscUrl)
}R=R.substring(0,R.lastIndexOf("/"));
S=CQ.HTTP.setAnchor(S,R);
if(O.shiftKey||this.multiWinMode){window.open(S)
}else{window.location.href=S
}},scope:this});
this.liveCopyStatusButton=new CQ.Ext.Button({disabled:false,iconCls:"cq-sidekick-layer-livecopy",tooltip:{title:B.liveCopyStatusText,text:CQ.I18n.getMessage("Display Live Copy status"),autoHide:true},handler:function(){if(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS)){CQ.WCM.hideLayer(CQ.utils.WCM.LAYER_LCSTATUS)
}else{CQ.WCM.showLayer(CQ.utils.WCM.LAYER_LCSTATUS)
}this.liveCopyStatusButton.toggle(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS))
},scope:this})
},addButtons:function(){var A=this.getBottomToolbar();
A.removeAll(true);
A.add([this.editButton,this.previewButton,this.designButton,this.scaffoldingButton,this.liveCopyStatusButton,"-",this.adminButton,this.reloadButton])
}});
CQ.wcm.Sidekick.componentsWithDragZone=[];
CQ.wcm.Sidekick.CLASSNAME="cq-sidekick";
CQ.wcm.Sidekick.findSidekick=function(B){var A=null;
if(B instanceof CQ.wcm.Sidekick){A=B
}else{A=B.findParentByType("sidekick")
}return A
};
CQ.wcm.Sidekick.CREATE="CREATE";
CQ.wcm.Sidekick.CREATECHILDPAGE="CREATECHILDPAGE";
CQ.wcm.Sidekick.COPYPAGE="COPYPAGE";
CQ.wcm.Sidekick.MOVEPAGE="MOVEPAGE";
CQ.wcm.Sidekick.DELETE="DELETE";
CQ.wcm.Sidekick.PUBLISH="PUBLISH";
CQ.wcm.Sidekick.ROLLOUT="ROLLOUT";
CQ.wcm.Sidekick.REFERENCES="REFERENCES";
CQ.wcm.Sidekick.LOCK="LOCK";
CQ.wcm.Sidekick.VERSION="VERSION";
CQ.wcm.Sidekick.RESTORE="RESTORE";
CQ.wcm.Sidekick.AUDIT="AUDIT";
CQ.wcm.Sidekick.PERMS="PERMS";
CQ.wcm.Sidekick.PROPS="PROPS";
CQ.wcm.Sidekick.START_WORKFLOW="START_WORKFLOW";
CQ.wcm.Sidekick.DEFAULT_ACTIONS=[CQ.wcm.Sidekick.PROPS,CQ.wcm.Sidekick.CREATECHILDPAGE,CQ.wcm.Sidekick.COPYPAGE,CQ.wcm.Sidekick.MOVEPAGE,CQ.wcm.Sidekick.DELETE,CQ.wcm.Sidekick.PUBLISH,CQ.wcm.Sidekick.LOCK,CQ.wcm.Sidekick.REFERENCES,CQ.wcm.Sidekick.ROLLOUT,CQ.wcm.Sidekick.AUDIT,CQ.wcm.Sidekick.PERMS];
CQ.wcm.Sidekick.PAGE="PAGE";
CQ.wcm.Sidekick.COMPONENTS="COMPONENTS";
CQ.wcm.Sidekick.WORKFLOW="WORKFLOW";
CQ.wcm.Sidekick.VERSIONING="VERSIONING";
CQ.wcm.Sidekick.INFO="INFO";
CQ.wcm.Sidekick.CONTEXTS=[CQ.wcm.Sidekick.PAGE,CQ.wcm.Sidekick.COMPONENTS,CQ.wcm.Sidekick.WORKFLOW,CQ.wcm.Sidekick.VERSIONING,CQ.wcm.Sidekick.INFO];
CQ.Ext.reg("sidekick",CQ.wcm.Sidekick);
CQ.wcm.Sidekick.DragZoneBase={getDragData:function(F){var E=F.getTarget(this.view.itemSelector);
if(E){var B=this.view;
if(!B.isSelected(E)){B.onClick(F)
}var A=B.getSelectedNodes();
var C=B.getSelectedRecords();
var D={nodes:A,records:C,srcObject:E};
if(A.length==1){var G=E;
if(C[0].data&&C[0].data.thumbnail){G=document.createElement("div");
G.innerHTML="<img src='"+C[0].data.thumbnail+"'>"
}D.ddel=G;
D.single=true
}return D
}return false
},afterRepair:function(){for(var B=0,A=this.dragData.nodes.length;
B<A;
B++){}this.dragging=false
},getRepairXY:function(B){if(!this.dragData.multi){var A=CQ.Ext.Element.fly(this.dragData.srcObject).getXY();
A[0]+=3;
A[1]+=3;
return A
}return false
},notifyDropDT:function(E,C,B){if(this.isDropAllowed(E)){E.editComponent.maskTarget(CQ.wcm.EditBase.INSERTING_PARAGRAPH);
var D=E.editComponent;
var A=CQ.Util.copyObject(B.records[0].data);
window.setTimeout(function(){D.createParagraph(A);
E.editComponent.hideTarget()
},1);
return this
}return false
},notifyEnterDT:function(C,B,A){if(this.isDropAllowed(C)){C.editComponent.showTarget()
}return""
},notifyOutDT:function(C,B,A){if(this.isDropAllowed(C)){C.editComponent.hideTarget(true)
}return""
},notifyOverDT:function(C,B,A){if(this.isDropAllowed(C)){return this.dropAllowed
}else{return this.dropNotAllowed
}},isDropAllowed:function(B){var A=this.dragData?this.dragData.records[0].data:null;
return(B&&B.groups&&CQ.Util.isIntersecting(this.groups,B.groups)&&B.editComponent&&A&&B.editComponent.isInsertAllowed(A.virtual?A.virtualResourceType:A.resourceType))
},onDragCancel:function(A,B){if(B&&B.editComponent&&B.editComponent.hideTarget){B.editComponent.hideTarget()
}}};
CQ.wcm.Sidekick.DragZone4ContentFinder=function(A,B){CQ.wcm.Sidekick.DragZone4ContentFinder.superclass.constructor.call(this,A.getEl(),B);
this.view=A
};
CQ.Ext.extend(CQ.wcm.Sidekick.DragZone4ContentFinder,CQ.wcm.ContentFinderDragZone,CQ.wcm.Sidekick.DragZoneBase);
CQ.wcm.Sidekick.DragZone=function(A,B){CQ.wcm.Sidekick.DragZone.superclass.constructor.call(this,A.getEl(),B);
this.view=A
};
CQ.Ext.extend(CQ.wcm.Sidekick.DragZone,CQ.Ext.dd.DragZone,CQ.wcm.Sidekick.DragZoneBase);
CQ.wcm.LinkChecker=CQ.Ext.extend(CQ.wcm.Viewport,{constructor:function(C){var D=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{dataIndex:"valid",header:CQ.I18n.getMessage("Status"),renderer:function(F){var G='<span style="color: {0};">{1}</span>';
if(F){return String.format(G,"green",CQ.I18n.getMessage("Valid"))
}else{return String.format(G,"red",CQ.I18n.getMessage("Invalid"))
}}},{id:"url",dataIndex:"url",header:CQ.I18n.getMessage("URL"),renderer:function(G){var H='<a href="{0}" target="_blank">{1}</a>';
var F=CQ.Ext.util.Format.htmlEncode(G);
var I=CQ.Ext.util.Format.htmlEncode(decodeURI(G));
return String.format(H,F,I)
}},{dataIndex:"lastChecked",header:CQ.I18n.getMessage("Last Checked"),renderer:CQ.wcm.LinkChecker.dateRenderer},{dataIndex:"status",header:CQ.I18n.getMessage("Last Status")},{dataIndex:"lastAvailable",header:CQ.I18n.getMessage("Last Available"),renderer:CQ.wcm.LinkChecker.dateRenderer},{dataIndex:"lastAccessed",header:CQ.I18n.getMessage("Last Accessed"),renderer:CQ.wcm.LinkChecker.dateRenderer}]);
D.defaultSortable=true;
var A=new CQ.Ext.grid.RowSelectionModel({});
A.on("selectionchange",CQ.wcm.LinkChecker.selectionChange);
var E=C.storage||"/var/linkchecker";
var B=new CQ.Ext.data.JsonStore({url:CQ.HTTP.externalize(E,true)+".list.json",autoLoad:true,root:"rows",fields:["url","status",{name:"valid",type:"bool"},{name:"lastAccessed"},{name:"lastChecked"},{name:"lastAvailable"}]});
CQ.wcm.LinkChecker.superclass.constructor.call(this,{id:"cq-linkchecker",items:[{xtype:"grid",id:"cq-linkchecker-grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,colModel:D,selModel:A,autoExpandColumn:"url",store:B,tbar:[{id:"cq-linkchecker-refresh",text:CQ.I18n.getMessage("Refresh"),handler:this.reloadAll},{id:"cq-linkchecker-check",text:CQ.I18n.getMessage("Check"),handler:CQ.wcm.LinkChecker.checkSelected.createCallback(E)}]}]});
CQ.wcm.LinkChecker.selectionChange(A)
},initComponent:function(){CQ.wcm.LinkChecker.superclass.initComponent.call(this)
},reloadAll:function(){CQ.Ext.getCmp("cq-linkchecker-grid").getStore().reload()
}});
CQ.wcm.LinkChecker.dateRenderer=function(D){if(!D){return""
}var B=new Date(D).getElapsed();
var H=Math.floor(B/1000);
var E=Math.floor(B/(60*1000));
var G=Math.floor(B/(60*60*1000));
var I=Math.floor(B/(24*60*60*1000));
var A=Math.floor(B/(7*24*60*60*1000));
var C=Math.floor(B/(30*24*60*60*1000));
var F=Math.floor(B/(365*24*60*60*1000));
if(H<2){return CQ.I18n.getMessage("now")
}else{if(E<2){return CQ.I18n.getMessage("{0} seconds ago",H)
}else{if(G<2){return CQ.I18n.getMessage("{0} minutes ago",E)
}else{if(I<2){return CQ.I18n.getMessage("{0} hours ago",G)
}else{if(A<2){return CQ.I18n.getMessage("{0} days ago",I)
}else{if(C<2){return CQ.I18n.getMessage("{0} weeks ago",A)
}else{if(F<2){return CQ.I18n.getMessage("{0} months ago",C)
}else{return CQ.I18n.getMessage("{0} years ago",F)
}}}}}}}};
CQ.wcm.LinkChecker.selectionChange=function(A){var B=CQ.Ext.getCmp("cq-linkchecker-check");
if(A.hasSelection()){B.enable()
}else{B.disable()
}};
CQ.wcm.LinkChecker.checkSelected=function(D){var B=CQ.HTTP.externalize(D,true);
var C=CQ.Ext.getCmp("cq-linkchecker-grid");
var A=C.getSelectionModel().getSelections();
for(i=0;
i<A.length;
i++){CQ.Ext.Ajax.request({url:B,params:{check:A[i].get("url")},method:"POST",success:CQ.wcm.LinkChecker.checkSuccess.createCallback(A[i].id),failure:CQ.wcm.LinkChecker.checkFailure.createCallback(A[i].get("url"))})
}};
CQ.wcm.LinkChecker.checkSuccess=function(C){var B=CQ.Ext.getCmp("cq-linkchecker-grid");
var A=B.getStore();
B.getSelectionModel().deselectRow(A.indexOfId(C));
A.reload()
};
CQ.wcm.LinkChecker.checkFailure=function(A){CQ.Ext.Msg.alert("Link Check Failed","Error checking link: "+A);
CQ.Ext.getCmp("cq-linkchecker-grid").getStore().reload()
};
CQ.Ext.reg("linkchecker",CQ.wcm.LinkChecker);
CQ.wcm.HelpBrowser={};
CQ.wcm.HelpBrowser.path="en/cq/current/wcm.html";
CQ.wcm.HelpBrowser.createHelpButton=function(A){A=CQ.wcm.HelpBrowser.preparePath(A);
return{text:CQ.I18n.getMessage("Help"),tooltip:{title:CQ.I18n.getMessage("CQ5 User Guide"),text:CQ.I18n.getMessage("Browse the online help"),autoHide:true},handler:function(){CQ.wcm.HelpBrowser.show(A)
}}
};
CQ.wcm.HelpBrowser.preparePath=function(A){A=typeof A=="string"?A:CQ.wcm.HelpBrowser.path;
A=CQ.I18n.getVarMessage(A);
if(A.charAt(0)!="/"){A="/libs/day-docs/content/"+A
}return CQ.HTTP.externalize(A)
};
CQ.wcm.HelpBrowser.show=function(A){A=CQ.wcm.HelpBrowser.preparePath(A);
if(!A.indexOf("/libs/day-docs/content/")&&CQ.HTTP.get(A).status==404){CQ.wcm.HelpBrowser.offerDocs(A);
return 
}CQ.shared.Util.open(A).focus()
};
CQ.wcm.HelpBrowser.offerDocs=function(D){var A=CQ.I18n.getVarMessage("/libs/cq/packaging/content/packageshare.html/packageshare/packages/public.html");
var C=D.split("/libs/day-docs/content/")[1];
C=C.slice(C.indexOf("/"));
var B=CQ.I18n.getVarMessage("http://dev.day.com/content/docs/en")+C;
B=B.replace("/current/","/5-4/");
var F=CQ.I18n.getMessage("Documentation not installed");
var E=CQ.I18n.getMessage("Package Share offers CQ5 documentation in several languages for local installation. Would you like to proceed to Package Share?");
CQ.wcm.HelpBrowser.instance=null;
CQ.Ext.Msg.show({title:F,msg:E,buttons:CQ.Ext.Msg.YESNO,fn:function(G){if(G=="yes"){CQ.shared.Util.open(A).focus()
}else{CQ.shared.Util.open(B).focus()
}},icon:CQ.Ext.MessageBox.QUESTION})
};
CQ.wcm.HelpBrowser.nodocs=function(){CQ.wcm.HelpBrowser.instance=null;
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Documentation not available"),CQ.I18n.getMessage("Unable to load CQ5 documentation."))
};
CQ.wcm.Statistics=CQ.Ext.extend(CQ.form.CompositeField,{processRecord:function(A,B){if(this.fireEvent("beforeloadcontent",this,A,B)!==false){if(B.indexOf("/jcr:content")==B.length-"/jcr:content".length){B=B.substring(0,B.indexOf("/jcr:content"))
}this.path=CQ.HTTP.externalize(B)+"."+this.initialConfig.chartExt;
this.drawChart(CQ.wcm.Statistics.DEFAULT_PERIOD);
this.fireEvent("loadcontent",this,A,B)
}},drawChart:function(B){if(this.screenItem&&this.screenItem.rendered){var A=this.path;
if(!A){A=CQ.HTTP.externalize("/0.gif")
}A+="?Period="+B;
this.screenItem.getEl().set({src:A})
}},constructor:function(A){A=CQ.Util.applyDefaults(A,{chartExt:"views.png",stateful:false,border:false,screen:{xtype:"box",stateful:false,autoWidth:true,autoHeight:true,autoEl:{tag:"img",src:"0.gif"}},select:{type:"select",fieldLabel:CQ.I18n.getMessage("Display period"),allowBlank:false,stateful:false,width:250,optionsConfig:{width:250},value:CQ.wcm.Statistics.DEFAULT_PERIOD,options:[{value:30,text:CQ.I18n.getMessage("last month")},{value:180,text:CQ.I18n.getMessage("last 6 month")},{value:360,text:CQ.I18n.getMessage("last year")}],listeners:{selectionchanged:{fn:this.selectionHandler,scope:this}}}});
CQ.wcm.Statistics.superclass.constructor.call(this,A)
},initComponent:function(){CQ.wcm.Statistics.superclass.initComponent.call(this);
this.screenItem=new CQ.Ext.BoxComponent(this.initialConfig.screen);
this.add(this.screenItem);
this.selection=new CQ.form.Selection(this.initialConfig.select);
this.add(this.selection);
this.drawChart(this.selection.getValue())
},selectionHandler:function(A,B){this.drawChart(B)
}});
CQ.wcm.Statistics.DEFAULT_PERIOD=30;
CQ.Ext.reg("statistics",CQ.wcm.Statistics);
CQ.wcm.BulkEditor=CQ.Ext.extend(CQ.Ext.Panel,{rootPath:null,queryParams:null,contentMode:null,colsValue:null,extraCols:null,initialSearch:false,colsSelection:null,showGridOnly:false,searchPanelCollapsed:false,hideRootPath:false,hideQueryParams:false,hideContentMode:false,hideColsSelection:false,hideExtraCols:false,hideSearchButton:false,hideExportButton:false,hideImportButton:true,hideMoveButtons:true,hideBulkEditButton:true,bulkEditDialogType:null,bulkEditDialogPath:null,rowMovePostMode:null,hideResultNumber:false,hideSaveButton:false,hideInsertButton:true,hideDeleteButton:true,hidePathCol:false,insertedResourceType:null,queryURL:null,importURL:null,exportURL:null,saveURL:null,colsMetadata:null,encodeMapping:null,constructor:function(A){A=(!A?{}:A);
this.csvSeparator=(A["export"]&&A["export"]["separator"]?A["export"]["separator"]:null);
var B={hideBorders:true,border:false,stateful:false,autoHeight:true,colsMetadata:{"jcr:path":{readOnly:true}},bodyStyle:{"background-color":"#DFE8F6"},encodeMapping:{"\\.":"_DOT_"}};
this.gridPlugins=new Array();
CQ.Util.applyDefaults(A,B);
CQ.wcm.BulkEditor.superclass.constructor.call(this,A)
},toBoolean:function(A){return(A===true||A=="true")
},initComponent:function(){CQ.wcm.BulkEditor.superclass.initComponent.call(this);
if(this.showGridOnly){this.hideRootPath=true;
this.hideQueryParams=true;
this.hideContentMode=true;
this.hideColsSelection=true;
this.hideExtraCols=true;
this.hideSearchButton=true;
this.hideImportButton=true;
this.hideResultNumber=true;
this.hideInsertButton=true;
this.hideDeleteButton=true
}this.initialSearch=this.toBoolean(this.initialSearch);
this.hideRootPath=this.toBoolean(this.hideRootPath);
this.hideQueryParams=this.toBoolean(this.hideQueryParams);
this.hideContentMode=this.toBoolean(this.hideContentMode);
this.hideColsSelection=this.toBoolean(this.hideColsSelection);
this.hideExtraCols=this.toBoolean(this.hideExtraCols);
this.hideSearchButton=this.toBoolean(this.hideSearchButton);
this.hideImportButton=this.toBoolean(this.hideImportButton);
this.hideResultNumber=this.toBoolean(this.hideResultNumber);
this.hideSaveButton=this.toBoolean(this.hideSaveButton);
this.hideInsertButton=this.toBoolean(this.hideInsertButton);
this.hideDeleteButton=this.toBoolean(this.hideDeleteButton);
this.hideExportButton=this.toBoolean(this.hideExportButton);
this.hideMoveButtons=this.toBoolean(this.hideMoveButtons);
this.hideBulkEditButton=this.toBoolean(this.hideBulkEditButton);
this.hidePathCol=this.toBoolean(this.hidePathCol);
this.searchPanelCollapsed=this.toBoolean(this.searchPanelCollapsed);
this.addEvents("beforeloadgrid","loadgrid","beforesave","save","beforeinsertrow","insertrow","beforedeleterow","deleterow","beforemovedown","movedown","beforemoveup","moveup","beforeexport","export","beforeimport","import","beforeaddcolumntomodel","addcolumntomodel");
this.initSearchPanel();
this.initGridPanel();
this.clipboardArea=new CQ.Ext.form.TextArea({enableKeyEvents:true,style:"opacity:0",height:1,width:1,size:1});
this.add(this.clipboardArea);
if(this.insertedResourceType){this.add(new CQ.Ext.form.Hidden({name:"insertedResourceType",value:this.insertedResourceType,isFormField:false}))
}},onRender:function(B,A){CQ.wcm.BulkEditor.superclass.onRender.call(this,B,A);
if(this.initialSearch){var C=this.findParentByType("dialog");
if(C){C.on("loadcontent",this.loadGrid,this)
}else{this.gridEditor.getView();
this.gridEditor.on("render",this.loadGrid,this)
}}this.gridEditor.on("render",this.initializeCheckboxSelection,this)
},initSearchPanel:function(){this.searchPanel=new CQ.Ext.Panel(this.getSearchPanelConfig());
this.add(this.searchPanel)
},initGridPanel:function(){this.loadGrid(false);
this.add(this.gridEditor)
},initializeCheckboxSelection:function(){if(this.gridPlugins.length>0){var A=this;
this.selectAllItem=new CQ.Ext.menu.Item({id:"select-all-"+this.gridEditor.id,text:CQ.I18n.getMessage("Select All"),cls:"x-menu-check-item x-menu-item-checked",handler:function(I,H){var G=A.gridEditor.getColumnModel();
var B=A.gridEditor.view.hdCtxIndex;
var E=G.getColumnId(B);
var D=A.gridEditor.store.getCount();
for(var J=0;
J<D;
J++){A.gridEditor.startEditing(J,B);
var C=A.gridEditor.store.getAt(J);
var F=C.data[E];
if(F==="false"||F===false){C.set(E,true);
A.gridEditor.stopEditing();
A.handleEditedRecord(C,E,true,F)
}C=null
}G=null
}});
this.selectNoneItem=new CQ.Ext.menu.Item({id:"select-none-"+this.gridEditor.id,text:CQ.I18n.getMessage("Select None"),cls:"x-menu-check-item",handler:function(I,H){var G=A.gridEditor.getColumnModel();
var B=A.gridEditor.view.hdCtxIndex;
var E=G.getColumnId(B);
var D=A.gridEditor.store.getCount();
for(var J=0;
J<D;
J++){A.gridEditor.startEditing(J,B);
var C=A.gridEditor.store.getAt(J);
var F=C.data[E];
if(F==="true"||F===true){C.set(E,false);
A.gridEditor.stopEditing();
A.handleEditedRecord(C,E,false,F)
}C=null
}G=null
}});
this.gridEditor.view.hmenu.on("beforeshow",function(C,B,G,E){if(!this.selectionAdded){this.add("-",A.selectAllItem,A.selectNoneItem);
this.selectionAdded=true
}var F=A.gridEditor.getColumnModel().getColumnId(A.gridEditor.view.hdCtxIndex);
var D=A.getMetadata(F);
if(D&&(D.checkbox==="true"||D.checkbox===true)){A.selectAllItem.enable();
A.selectNoneItem.enable()
}else{A.selectAllItem.disable();
A.selectNoneItem.disable()
}},this.gridEditor.view.hmenu)
}},getMetadata:function(B){var A=B;
if(B.indexOf(CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/")!=-1){A=B.substring(CQ.wcm.BulkEditor.JCR_CONTENT_NODE.length+1)
}if(this.colsMetadata&&this.colsMetadata[A]){return this.colsMetadata[A]
}return{}
},getColObject:function(I){if(I||!this.currentColObject){var H=this.getColsValue();
var E=this.getExtraCols();
var F=this.getContentMode();
var A={};
if(H){if(typeof H=="string"){H=H.split(",")
}if(E&&typeof E=="string"){E=E.split(",")
}if(H instanceof Array){if(E&&E instanceof Array){H=H.concat(E)
}A.headers=new Array();
A.values=new Array();
for(var B=0;
B<H.length;
B++){var K=H[B];
if(K&&K.length>0){var C=K;
var D=K.indexOf(CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/");
if(F&&D==-1){K=CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/"+K
}else{if(D==0){C=K.substring(12,K.length);
if(!F){K=C
}}}var G=this.getMetadata(K);
if(G&&G.headerText){C=G.headerText
}if(A.values.indexOf(K)==-1){if(this.fireEvent("beforeaddcolumntomodel",this,K,G)!==false){A.headers.push(C);
A.values.push(K);
this.fireEvent("addcolumntomodel",this,K,G)
}}}}for(var B=0;
B<A.values.length;
B++){var G=this.getMetadata(A.values[B]);
var J=B;
if(G){var D=parseInt(G.forcedPosition);
if(!isNaN(D)&&D<A.values.length&&D!=B){J=D
}}A.values=this.moveCell(A.values,B,J);
A.headers=this.moveCell(A.headers,B,J)
}}}this.currentColObject=A
}return this.currentColObject
},moveCell:function(E,A,D){if(E&&D<E.length&&A<E.length&&D!=A){var B=0;
var C=new Array();
while(B<E.length){if(B==D){C.push(E[A]);
C.push(E[B]);
B++
}else{if(B!=A){C.push(E[B])
}B++
}}return C
}return E
},loadGrid:function(A){if(this.fireEvent("beforeloadgrid")!==false){this.modifiedItems={};
this.modifiedItems.count=0;
this.createdItems={};
this.createdItems.count=0;
this.deletedItems={};
this.deletedItems.count=0;
this.initialStoreData=null;
this.movedItems={};
this.movedItems.count=0;
var B=this.getRootPath();
this.buildGrid();
this.checkSaveButtonStatus();
if(A!="false"&&A!==false){if(this.hideRootPath||(B!=null&&B!="")){this.gridEditor.store.load()
}else{CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Missing parameter"),CQ.I18n.getMessage("Could not start search: no root path defined"))
}}this.fireEvent("loadgrid")
}},buildGridEditor:function(A){this.loadGrid(A)
},getColumnModel:function(){var C=this.getColObject(true);
var D=new Array();
if(!this.hidePathCol){D.push(this.getColumnModelConfig(CQ.wcm.BulkEditor.JCR_PATH,"Path",CQ.wcm.BulkEditor.JCR_PATH))
}for(var A=0;
A<C.values.length;
A++){D.push(this.getColumnModelConfig(C.values[A],C.headers[A],this.encodeString(C.values[A])))
}var B=new CQ.Ext.grid.ColumnModel(D);
if(!this.hideMoveButtons){B.defaultSortable=true
}return B
},computeURL:function(A){var E=this.getRootPath();
if(!E){E=this.path
}var B=this.getQueryParams();
var D="path:"+E+(B?" "+B:"");
A=CQ.HTTP.addParameter(A,"query",D);
A=CQ.HTTP.addParameter(A,"tidy","true");
var C=this.getColObject();
if(C.values&&C.values.length>0){A=CQ.HTTP.addParameter(A,"cols",""+C.values)
}return A
},getStoreURL:function(){return this.computeURL(this.queryURL)
},getExportURL:function(){var A=this.computeURL(this.exportURL);
A=CQ.HTTP.addParameter(A,"separator",this.csvSeparator);
return A
},getStore:function(){var E=this.getColObject();
var D=new Array();
D.push({name:CQ.wcm.BulkEditor.JCR_PATH});
for(var C=0;
C<E.values.length;
C++){D.push({name:this.encodeString(E.values[C])})
}var A=this;
var B={proxy:new CQ.Ext.data.HttpProxy({url:this.getStoreURL(),method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits"},D),sortInfo:{field:CQ.wcm.BulkEditor.JCR_PATH,direction:"ASC"},listeners:{datachanged:function(){A.updateResultNumberLabel()
},add:function(){A.updateResultNumberLabel()
},remove:function(){A.updateResultNumberLabel()
}}};
if(this.initialConfig&&this.initialConfig.store){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.store),B)
}if(!this.hideMoveButtons){delete B.sortInfo
}return new CQ.Ext.data.Store(B)
},updateResultNumberLabel:function(){if(this.resultNumberLabel&&this.gridEditor){var B=0;
if(this.gridEditor.store){B=this.gridEditor.store.getCount();
B=B?B:0
}var A=B?CQ.I18n.getMessage("{0} result(s)",B):CQ.I18n.getMessage("No result");
this.resultNumberLabel.text=A;
this.resultNumberLabel.el.dom.innerHTML=A
}},buildGrid:function(){if(!this.gridEditor){this.gridEditor=new CQ.Ext.grid.EditorGridPanel(this.getGridConfig());
this.gridEditor.bulkeditor=this;
this.gridEditor.on("afteredit",this.editionHandler,this)
}else{this.gridEditor.stopEditing();
this.gridEditor.reconfigure(this.getStore(),this.getColumnModel())
}return this.gridEditor
},editionHandler:function(A){this.handleEditedRecord(A.record,A.field,A.value,A.originalValue)
},handleEditedRecord:function(B,E,D,A){if(B.data[CQ.wcm.BulkEditor.JCR_PATH]){var C=B.data[CQ.wcm.BulkEditor.JCR_PATH];
if(this.modifiedItems[C]){if(this.modifiedItems[C][E]){if(this.modifiedItems[C][E].originalValue==D){delete this.modifiedItems[C][E];
this.modifiedItems.count--;
if(CQ.Util.isEmptyObject(this.modifiedItems[C])){delete this.modifiedItems[C]
}}else{this.modifiedItems[C][E].newValue=D
}}else{this.modifiedItems[C][E]={};
this.modifiedItems[C][E].originalValue=A;
this.modifiedItems[C][E].newValue=D
}}else{this.modifiedItems[C]={};
this.modifiedItems[C][E]={};
this.modifiedItems[C][E].originalValue=A;
this.modifiedItems[C][E].newValue=D;
this.modifiedItems.count++
}}this.checkSaveButtonStatus()
},checkSaveButtonStatus:function(){if(this.saveButton){if(this.modifiedItems.count>0||this.deletedItems.count>0||this.createdItems.count>0||this.movedItems.count>0){this.saveButton.enable()
}else{this.saveButton.disable()
}}},getRootPathConfig:function(){var A={value:this.rootPath,selectOnFocus:true,name:"./rootPath",fieldLabel:CQ.I18n.getMessage("Root Path"),predicate:"nosystem",fieldDescription:CQ.I18n.getMessage("Select root path for edition")};
if(this.initialConfig&&this.initialConfig.rootPathInput){A=CQ.Util.applyDefaults(this.initialConfig.rootPathInput,A)
}return A
},getQueryParamsConfig:function(){var A={fieldLabel:CQ.I18n.getMessage("Query Parameters"),name:"./queryParams",value:this.queryParams,fieldDescription:CQ.I18n.getMessage("Enter GQL query parameters")};
if(this.initialConfig&&this.initialConfig.queryParamsInput){A=CQ.Util.applyDefaults(this.initialConfig.queryParamsInput,A)
}return A
},getContentModeConfig:function(){var A={fieldLabel:CQ.I18n.getMessage("Content Mode"),name:"./contentMode",checked:this.contentMode,boxLabel:"&nbsp;",fieldDescription:CQ.I18n.getMessage("Read all properties in jcr:content sub node")};
if(this.initialConfig&&this.initialConfig.contentModeInput){A=CQ.Util.applyDefaults(this.initialConfig.contentModeInput,A)
}return A
},getColsSelectionOptions:function(){var G=this.colsSelection;
var B=this.colsValue;
var C=new Array();
if(G){if(typeof G=="string"){G=G.split(",")
}if(G instanceof Array){for(var D=0;
D<G.length;
D++){var A=G[D];
if(A&&A.length>0){var E=A;
var F=this.getMetadata(A);
if(F&&F.headerText){E=F.headerText
}if(C.indexOf(A)==-1){C.push({boxLabel:E,name:A,value:A,checked:(B?B.indexOf(A)!=-1:false)})
}}}}}return C
},getColsSelectionConfig:function(){var C=this.getColsSelectionOptions();
var A=(C&&C.length>4?3:(C&&C.length>1?2:1));
var B={id:"cq-bulkeditor-colsselection",columns:A,vertical:true,fieldLabel:CQ.I18n.getMessage("Properties / Columns"),name:"./colsSelection",fieldDescription:CQ.I18n.getMessage("Select a list of properties to edit"),items:C};
if(this.initialConfig&&this.initialConfig.colsSelectionInput){B=CQ.Util.applyDefaults(this.initialConfig.colsSelectionInput,B)
}return B
},getExtraColsConfig:function(){var A={fieldLabel:CQ.I18n.getMessage("Custom Properties / Columns"),name:"./extraCols",value:this.extraCols,fieldDescription:CQ.I18n.getMessage("Enter extra properties, separated by comma")};
if(this.initialConfig&&this.initialConfig.extraColsInput){A=CQ.Util.applyDefaults(this.initialConfig.extraColsInput,A)
}return A
},exportToFile:function(){if(this.fireEvent("beforeexport")!==false){var A=function(){var B=this.getExportURL();
CQ.shared.Util.open(B)
};
if(this.modifiedItems.count>0){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Export search result"),CQ.I18n.getMessage("Save your modifications or they will not be exported. Do you still want to export?"),A,this)
}else{A.call(this)
}this.fireEvent("export")
}},importFile:function(){if(this.fireEvent("beforeimport")!==false){var A=this.findParentByType("form");
if(A==null){A=this.findParentByType("bulkeditorform")
}if(A!=null){var B=A.getForm();
if(B.isValid()){B.el.dom.enctype="multipart/form-data";
B.fileUpload=true;
var C=new CQ.form.SlingSubmitAction(B,{method:"POST",url:this.importURL,success:function(D,E){D.el.dom.enctype="";
delete D.fileUpload;
this.clearImportInput();
var F=(E.result&&E.result.Message?E.result.Message:CQ.I18n.getMessage("No message"));
CQ.Notification.notify(CQ.I18n.getMessage("Data imported"),F);
this.loadGrid()
},failure:function(D,E){D.el.dom.enctype="";
delete D.fileUpload;
this.clearImportInput();
var F=(E.result&&E.result.Message?E.result.Message:CQ.I18n.getMessage("Unknown error"));
CQ.Notification.notify(CQ.I18n.getMessage("Import failed"),F);
this.loadGrid()
},scope:this});
B.doAction(C)
}else{this.clearImportInput();
CQ.Notification.notify(CQ.I18n.getMessage("Validation failed"),CQ.I18n.getMessage("Please select first a root path"))
}}else{this.clearImportInput();
CQ.Notification.notify(CQ.I18n.getMessage("Client page error"),CQ.I18n.getMessage("No valid form found"))
}this.fireEvent("export")
}else{this.clearImportInput()
}},openBulkEditDialog:function(){var N=[];
if(this.gridEditor){var O=this.gridEditor.getSelectionModel();
var I=this.gridEditor.getColumnModel();
var G=this.gridEditor.getStore();
if(O&&I&&G){var A=O.getSortedSelections();
if(A&&A.length>0){var K=[];
for(var M=0;
M<A.length;
M++){var J=A[M][0];
if(K.indexOf(J)==-1){var B=I.getColumnId(0);
var C=G.getAt(J);
if(C){var L=C.get(B);
N.push(L)
}K.push(J)
}}}else{var H=G.getCount();
for(var M=0;
M<H;
M++){var B=I.getColumnId(0);
var C=G.getAt(M);
if(C){var L=C.get(B);
N.push(L)
}}}}}if(N.length>0){var R=this.bulkEditDialogPath||null;
if(!R){var E=this.bulkEditDialogType||"default";
var Q=this.getQueryParams();
if(!this.bulkEditDialogType&&Q&&Q.indexOf("type:")!=-1){Q+=" ";
var F=new RegExp("type:([a-z]*)\\s.*$","ig");
E=Q.replace(F,"$1");
E=E.toLowerCase()
}R="/libs/wcm/core/components/bulkeditor/bulkeditdialogs/"+E+"/dialog"
}var D=this;
var P=CQ.WCM.getDialog({url:R,success:function(){D.loadGrid()
}});
P.postToURLs=N;
P.show();
P.loadContent(R+"_default_content")
}},getSearchButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Search"),handler:function(){A.loadGrid()
}};
if(this.initialConfig&&this.initialConfig.searchButton){B=CQ.Util.applyDefaults(this.initialConfig.searchButton,B)
}return B
},getSaveButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Save"),disabled:true,handler:function(){A.saveGridModifications()
}};
if(this.initialConfig&&this.initialConfig.saveButton){B=CQ.Util.applyDefaults(this.initialConfig.saveButton,B)
}return B
},getExportButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Export"),handler:function(){A.exportToFile()
}};
if(this.initialConfig&&this.initialConfig.exportButton){B=CQ.Util.applyDefaults(this.initialConfig.exportButton,B)
}return B
},getBulkEditButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Bulk edit"),handler:function(){A.openBulkEditDialog()
}};
if(this.initialConfig&&this.initialConfig.bulkEditButton){B=CQ.Util.applyDefaults(this.initialConfig.bulkEditButton,B)
}return B
},getImportButtonConfig:function(){var A=this;
var B={buttonText:CQ.I18n.getMessage("Import"),buttonOnly:true,hideLabel:true,fieldWidth:"1",name:"document",listeners:{fileselected:function(){A.importFile()
}}};
if(this.initialConfig&&this.initialConfig.importButton){B=CQ.Util.applyDefaults(this.initialConfig.importButton,B)
}return B
},clearImportInput:function(){if(this.importButton){this.importButton.fileInput.dom.value="";
this.importButton.setValue("")
}},getSearchPanelConfig:function(){var D=new Array();
if(!this.hideRootPath){this.rootPathInput=new CQ.form.PathField(this.getRootPathConfig());
D.push(this.rootPathInput)
}else{this.rootPathInput=new CQ.Ext.form.Hidden(this.getRootPathConfig());
this.add(this.rootPathInput)
}if(!this.hideQueryParams){this.queryParamsInput=new CQ.Ext.form.TextField(this.getQueryParamsConfig());
D.push(this.queryParamsInput)
}if(!this.hideContentMode){this.contentModeInput=new CQ.Ext.form.Checkbox(this.getContentModeConfig());
D.push(this.contentModeInput)
}if(!this.hideSearchButton||!this.hideImportButton){var C=new Array();
if(!this.hideSearchButton){this.searchButton=new CQ.Ext.Button(this.getSearchButtonConfig());
C.push(this.searchButton)
}if(!this.hideImportButton){this.importButton=new CQ.form.FileUploadField(this.getImportButtonConfig());
C.push(this.importButton)
}var A={buttonAlign:"left",border:false,buttons:C};
D.push(A)
}var E=new Array();
if(!this.hideColsSelection){this.colsSelectionInput=new CQ.Ext.form.CheckboxGroup(this.getColsSelectionConfig());
E.push(this.colsSelectionInput)
}if(!this.hideExtraCols){this.extraColsInput=new CQ.Ext.form.TextField(this.getExtraColsConfig());
E.push(this.extraColsInput)
}this.leftSetId=CQ.Ext.id();
this.rightSetId=CQ.Ext.id();
var B={collapsible:true,collapsed:this.searchPanelCollapsed,title:CQ.I18n.getMessage("Search Filters"),hidden:this.showGridOnly,autoEl:"div",autoScroll:true,height:270,anchor:"100%",listeners:{expand:function(){this.doLayout()
}},bodyStyle:{"background-color":"#DFE8F6"},defaults:{labelWidth:150},border:true,items:[{layout:"column",border:false,defaults:{columnWidth:".5",border:false,bodyStyle:{"background-color":"#DFE8F6"}},bodyStyle:{"background-color":"#DFE8F6"},items:[{bodyStyle:{"background-color":"#DFE8F6"},items:{xtype:"fieldset",id:this.leftSetId,autoHeight:true,border:false,bodyStyle:{"background-color":"#DFE8F6",padding:"5px"},defaults:{anchor:"97%",bodyStyle:{"background-color":"#DFE8F6"}},items:D}},{items:{xtype:"fieldset",id:this.rightSetId,autoHeight:true,border:false,bodyStyle:{"background-color":"#DFE8F6",padding:"5px"},defaults:{anchor:"97%",bodyStyle:{"background-color":"#DFE8F6"}},items:E}}]}]};
if(this.initialConfig&&this.initialConfig.searchPanel){if(this.initialConfig.searchPanel.defaults&&this.initialConfig.searchPanel.defaults.xtype){delete this.initialConfig.searchPanel.defaults.xtype
}B=CQ.Util.applyDefaults(this.initialConfig.searchPanel,B)
}return B
},getSearchPanelLeftFieldSet:function(){return CQ.Ext.getCmp(this.leftSetId)
},getSearchPanelRightFieldSet:function(){return CQ.Ext.getCmp(this.rightSetId)
},recordToString:function(D){var C="";
if(D&&this.gridEditor){var B=this.gridEditor.getColumnModel();
if(B){var A=B.getColumnCount();
if(A>0){C+=D.get(B.getColumnId(0));
for(var E=1;
E<A;
E++){C+="\t"+D.get(B.getColumnId(E))
}}}}return C
},cellToString:function(B){if(B&&B.length==2&&this.gridEditor){var A=this.gridEditor.getColumnModel();
var D=this.gridEditor.getStore();
if(A&&D){var F=B[0];
var E=B[1];
if(F<0||F>=D.getCount()){return 
}if(E<0||E>=A.getColumnCount()){return 
}var C=D.getAt(F);
if(C){return C.get(A.getColumnId(E))
}}}},copySelectionToClipboard:function(){var C="";
if(this.gridEditor){var E=this.gridEditor.getSelectionModel();
if(E){var B=E.getSelections();
var A=B.length;
if(A>0){C+=this.cellToString(B[0]);
for(var D=1;
D<A;
D++){if(B[D][0]!=B[D-1][0]){C+="\n"
}else{C+="\t"
}C+=this.cellToString(B[D])
}}}}this.clipboardArea.setValue(C);
this.clipboardArea.el.dom.select()
},pasteClipboardIntoSelection:function(){var F=this.clipboardArea.getValue();
if(F&&this.gridEditor){var R=this.gridEditor.getSelectionModel();
var I=this.gridEditor.getColumnModel();
var H=this.gridEditor.getStore();
if(R&&I&&H){var A=R.getSortedSelections();
if(A&&A.length>0){var Q=F.lastIndexOf("\n");
if(Q==F.length-1){F=F.substring(0,F.length-1)
}var D=F.split("\n");
var M=0;
for(var P=0;
P<D.length&&M<A.length;
P++){var N=A[P];
var E=D[P].split("\t");
if(D.length==E.length==1){var K=E[0];
for(var O=0;
O<A.length;
O++){var J=A[O][0];
var L=A[O][1];
var C=I.getColumnId(L);
var G=H.getAt(J);
if(G){var S=G.get(C);
G.set(C,K);
this.handleEditedRecord(G,C,K,S)
}}return 
}else{var B=(M>0?A[M-1][0]:-1);
var T=A[M][0];
if(B!=T){for(var O=0;
O<E.length&&M<A.length;
O++,M++){var J=A[M][0];
if(J==T){var L=A[M][1];
var C=I.getColumnId(L);
var G=H.getAt(J);
if(G){var S=G.get(C);
G.set(C,E[O]);
this.handleEditedRecord(G,C,E[O],S)
}}else{CQ.Notification.notify(CQ.I18n.getMessage("Paste error"),CQ.I18n.getMessage("Invalid pasted grid: format is different from grid selection"));
return 
}}}else{CQ.Notification.notify(CQ.I18n.getMessage("Paste error"),CQ.I18n.getMessage("Invalid pasted grid: format is different from grid selection"));
return 
}}}}}}},getToolBarButtons:function(){var A=new Array();
if(!this.hideResultNumber){this.resultNumberLabel=new CQ.Ext.form.Label(this.getResultNumberLabelConfig());
A.push(" ");
A.push(this.resultNumberLabel);
A.push(" ");
A.push("-")
}if(!this.hideSaveButton){this.saveButton=new CQ.Ext.Button(this.getSaveButtonConfig());
A.push(this.saveButton)
}if(!this.hideInsertButton){A.push(this.getInsertButtonConfig())
}if(!this.hideDeleteButton){A.push(this.getDeleteButtonConfig())
}if(!this.hideExportButton){this.exportButton=new CQ.Ext.Button(this.getExportButtonConfig());
A.push(this.exportButton)
}if(!this.hideBulkEditButton){this.bulkEditButton=new CQ.Ext.Button(this.getBulkEditButtonConfig());
A.push(this.bulkEditButton)
}if(!this.hideMoveButtons){A.push(this.getMoveDownButtonConfig());
A.push(this.getMoveUpButtonConfig())
}return A
},getGridConfig:function(){var B=this.getStore();
var A=this;
var E=this.getToolBarButtons();
var D=new CQ.wcm.CustomCellSelectionModel();
var C={store:B,cm:this.getColumnModel(),sm:D,clicksToEdit:2,height:370,stateful:false,border:true,plugins:this.gridPlugins,tbar:E,view:new CQ.Ext.grid.GridView({forceFit:true}),listeners:{keydown:function(F){if(F.ctrlKey&&F.getCharCode()==67){A.copySelectionToClipboard()
}else{if(F.ctrlKey&&F.getCharCode()==86){A.clipboardArea.el.dom.select();
window.setTimeout(function(){A.pasteClipboardIntoSelection()
},100)
}else{if(F.ctrlKey&&F.getCharCode()==65){if(A.gridEditor){var G=A.gridEditor.getSelectionModel();
if(G){G.selectAll();
F.stopEvent()
}}}}}}}};
if(this.initialConfig&&this.initialConfig.grid){C=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.grid),C)
}return C
},getResultNumberLabelConfig:function(){var A=this;
var B={text:"No result",textBase:"{0} result(s)",noValueText:"No result"};
if(this.initialConfig&&this.initialConfig.resultNumberLabel){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.resultNumberLabel),B)
}return B
},getInsertButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Insert row"),handler:function(){A.addRow()
}};
if(this.initialConfig&&this.initialConfig.insertButton){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.insertButton),B)
}return B
},getMoveUpButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Move up"),handler:function(){A.moveUpSelection()
}};
if(this.initialConfig&&this.initialConfig.moveUpButton){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.moveUpButton),B)
}return B
},getMoveDownButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Move down"),handler:function(){A.moveDownSelection()
}};
if(this.initialConfig&&this.initialConfig.moveDownButton){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.moveDownButton),B)
}return B
},getDeleteButtonConfig:function(){var A=this;
var B={text:CQ.I18n.getMessage("Delete row(s)"),handler:function(){A.deleteSelectedRow()
}};
if(this.initialConfig&&this.initialConfig.Button){B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.deleteButton),B)
}return B
},addRow:function(){if(this.gridEditor){if(this.fireEvent("beforeinsertrow")!==false){var G=this.gridEditor.getSelectionModel();
G.clearSelections();
var E=this.getColObject();
var F=this.getRootPath()+"/"+new Date().getTime();
var A={};
A[CQ.wcm.BulkEditor.JCR_PATH]=F;
var D=new Array();
D.push({name:CQ.wcm.BulkEditor.JCR_PATH});
for(var C=0;
C<E.values.length;
C++){D.push({name:E.values[C],type:"string"});
A[E.values[C]]=""
}var B=CQ.Ext.data.Record.create(D);
this.gridEditor.stopEditing();
this.gridEditor.store.insert(0,new B(A));
this.gridEditor.startEditing(0,0);
this.createdItems[F]={};
this.createdItems.count++;
this.checkSaveButtonStatus();
this.fireEvent("insertrow")
}}},deleteSelectedRow:function(){if(this.gridEditor){if(this.fireEvent("beforedeleterow")!==false){var F=this.gridEditor.getSelectionModel();
var B=F.getSelections();
if(B){for(var A=B.length-1;
A>-1;
A--){var E=B[A][0];
var D=this.gridEditor.store.getAt(E);
if(D){var C=D.data[CQ.wcm.BulkEditor.JCR_PATH];
this.gridEditor.store.remove(D);
if(this.createdItems[C]!=undefined){delete this.createdItems[C];
this.createdItems.count--
}else{this.deletedItems[C]={};
this.deletedItems.count++
}if(this.modifiedItems[C]!=undefined){delete this.modifiedItems[C];
this.modifiedItems.count--
}this.checkSaveButtonStatus()
}}F.clearSelections()
}this.fireEvent("deleterow")
}}},moveDownSelection:function(){if(this.fireEvent("beforemovedown")!==false){var D=this.gridEditor.getSelectionModel();
var C=D.getSortedSelections();
if(C){this.prepareRowMove();
var N=this.gridEditor.store.getCount();
var G=[];
var M=-1;
var A=N;
var L=N;
for(var F=C.length-1;
F>-1;
F--){var I=C[F][0];
var K=C[F][1];
if(I!=A){var H=this.gridEditor.store.getAt(I);
var J=I+1;
if(J>N-1){J=N-1;
M=N-1
}else{if(J==M){M--;
J--
}else{var E=null;
if(I+1<N){E=this.gridEditor.store.getAt(I+1)
}this.gridEditor.store.remove(H);
this.gridEditor.store.insert(J,H);
var B=null;
if(J+1<N){B=this.gridEditor.store.getAt(J+1)
}this.handleRowMove(H,E,B)
}}L=J;
G.push([J,K])
}else{G.push([L,K])
}A=I
}for(var F=0;
F<G.length;
F++){D.selectCell(G[F],true)
}}this.fireEvent("movedown")
}},moveUpSelection:function(){if(this.fireEvent("beforemoveup")!==false){var C=this.gridEditor.getSelectionModel();
var B=C.getSortedSelections();
if(B){this.prepareRowMove();
var N=this.gridEditor.store.getCount();
var G=[];
var I=-1;
var M=-1;
var D=-1;
for(var F=0;
F<B.length;
F++){var J=B[F][0];
var L=B[F][1];
if(J!=M){var H=this.gridEditor.store.getAt(J);
var K=J-1;
if(K<0){K=0;
I=0
}else{if(K==I){I++;
K++
}else{var E=null;
if(J+1<N){E=this.gridEditor.store.getAt(J+1)
}this.gridEditor.store.remove(H);
this.gridEditor.store.insert(K,H);
var A=null;
if(K+1<N){A=this.gridEditor.store.getAt(K+1)
}this.handleRowMove(H,E,A)
}}D=K;
G.push([K,L])
}else{G.push([D,L])
}M=J
}for(var F=0;
F<G.length;
F++){C.selectCell(G[F],true)
}}this.fireEvent("movedown")
}},prepareRowMove:function(){if(!this.initialStoreData){var A=this.gridEditor.store.getCount();
this.initialStoreData=new CQ.Ext.util.MixedCollection(false);
this.initialStoreData.addAll([].concat(this.gridEditor.store.getRange(0,A)))
}},handleRowMove:function(I,E,A){var M=I.data[CQ.wcm.BulkEditor.JCR_PATH];
var D=null;
if(E){D=E.data[CQ.wcm.BulkEditor.JCR_PATH]
}var F=null;
if(A){F=A.data[CQ.wcm.BulkEditor.JCR_PATH]
}var G=this.gridEditor.store.indexOf(I);
var H=this.initialStoreData.indexOf(I);
if(G==H&&this.movedItems[M]){delete this.movedItems[M];
this.movedItems.count--
}else{if(!this.movedItems[M]){this.movedItems[M]={};
var K=null;
if(H+1<this.initialStoreData.length){var C=this.initialStoreData.itemAt(H+1);
K=C.data[CQ.wcm.BulkEditor.JCR_PATH]
}this.movedItems[M].initialNextPath=K;
this.movedItems[M].initialIndex=H;
this.movedItems[M].newNextPath=F;
this.movedItems[M].record=I;
this.movedItems[M].newIndex=G;
this.movedItems.count++
}else{if(this.movedItems[M].initialNextPath==F&&(!F||!this.movedItems[F])){delete this.movedItems[M];
this.movedItems.count--
}else{this.movedItems[M].newNextPath=F;
this.movedItems[M].newIndex=G
}}}for(var B in this.movedItems){if(B!="count"){var L=this.gridEditor.store.indexOf(this.movedItems[B].record);
var J=this.initialStoreData.indexOf(this.movedItems[B].record);
if(L==J){delete this.movedItems[B];
this.movedItems.count--
}else{if(B!=M){if(this.movedItems[B].newNextPath==M){this.movedItems[B].newNextPath=D
}if(this.movedItems[B].newNextPath==F){this.movedItems[B].newNextPath=M
}if(this.movedItems[B].newIndex!=L){this.movedItems[B].newIndex=L
}}}}}this.checkSaveButtonStatus()
},getColumnModelConfig:function(A,F,J){var I=this.getMetadata(A);
var G=I.checkbox===true||I.checkbox==="true";
var K=I.readOnly===true||I.readOnly==="true";
var B={id:A,header:F,dataIndex:J};
B=CQ.Util.applyDefaults(I,B);
if(this.initialConfig&&this.initialConfig.colModel){var L=this.initialConfig.colModel.width;
if(L!=undefined&&typeof L=="string"&&!isNaN(L)){this.initialConfig.colModel.width=parseInt(L)
}B=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.colModel),B)
}if(!B.width){if(this.rendered&&this.getSize()){var L=this.getSize().width;
var E=this.getColsValue();
if(E){var H=65;
if(this.colsSelectionInput&&this.colsSelectionInput.rendered){H=20
}var D=E.length+1;
B.width=parseInt((parseInt(L)-H)/D)
}}else{B.width="200"
}}if(G){B.readOnly=K;
var C=new CQ.wcm.BulkEditor.CheckColumn(B);
this.gridPlugins.push(C);
return C
}else{var M={xtype:"textfield",readOnly:K};
if(I.editor){M=CQ.Util.applyDefaults(I.editor,M)
}B.editor=CQ.Util.build(M);
return B
}},getRootPath:function(){if(this.rootPathInput){return this.rootPathInput.getValue()
}return this.rootPath
},getQueryParams:function(){if(this.queryParamsInput){return this.queryParamsInput.getValue()
}return this.queryParams
},getContentMode:function(){if(this.contentModeInput&&this.contentModeInput.rendered){return this.contentModeInput.getValue()
}return this.contentMode
},encodeString:function(B){for(var A in this.encodeMapping){B=B.replace(new RegExp("("+A+")","ig"),this.encodeMapping[A])
}return B
},decodeString:function(B){for(var A in this.encodeMapping){B=B.replace(new RegExp("("+this.encodeMapping[A]+")","ig"),A.replace(/\\/ig,""))
}return B
},getColsValue:function(){if(this.colsSelectionInput&&this.colsSelectionInput.rendered){var A=new Array();
if(this.colsSelectionInput&&this.colsSelectionInput.items){this.colsSelectionInput.items.each(function(D){if(D.getValue()){A.push(D.getName())
}},this)
}this.colsValue=A
}if(this.colsValue){return this.colsValue
}else{if(this.colsMetadata){var B=new Array();
for(var C in this.colsMetadata){if(C!="xtype"&&C!=CQ.wcm.BulkEditor.JCR_PRIMARYTYPE&&C!=CQ.wcm.BulkEditor.JCR_PATH){B.push(C)
}}return B
}}return null
},getExtraCols:function(){if(this.extraColsInput){return this.extraColsInput.getValue()
}return this.extraCols
},saveGridModifications:function(){if(this.fireEvent("beforesave")!==false){var H=false;
var D={};
var E=false;
if(!this.saveURL){this.saveURL="/"
}if(this.deletedItems&&this.deletedItems.count>0){delete this.deletedItems.count;
for(var L in this.deletedItems){if(this.modifiedItems[L]){delete this.modifiedItems[L]
}if(this.movedItems[L]){delete this.movedItems[L]
}D[L+CQ.Sling.DELETE_SUFFIX]="";
E=true
}}if(this.modifiedItems&&this.modifiedItems.count>0){delete this.modifiedItems.count;
for(var L in this.modifiedItems){for(var J in this.modifiedItems[L]){var I=this.modifiedItems[L][J].newValue;
if(I!==undefined){if(!I instanceof Array){I=[I]
}D[L+"/"+this.decodeString(J)]=I;
E=true
}}if(this.createdItems[L]&&this.insertedResourceType){D[L+"/"+CQ.wcm.BulkEditor.JCR_RESOURCETYPE]=this.insertedResourceType
}}}if(this.movedItems&&this.movedItems.count>0){delete this.movedItems.count;
var G=false;
for(var L in this.movedItems){if(this.saveURL=="/"){var B=[];
var K="last";
if(this.movedItems[L].newNextPath){var A=this.movedItems[L].newNextPath;
K="before "+A.substring(A.lastIndexOf("/")+1,A.length)
}B[CQ.Sling.ORDER]=K;
var C=CQ.HTTP.post(L,null,B);
if(!CQ.HTTP.isOk(C)){G=true
}}else{var F="newindex";
if(this.rowMovePostMode){F=this.rowMovePostMode
}switch(F){case"slingorder":D[L+"@Order"]=(this.movedItems[L].newNextPath?"before "+this.movedItems[L].newNextPath:"last");
break;
default:D[L+"@Order"]=this.movedItems[L].newIndex
}E=true
}}if(G){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Saving error"),CQ.I18n.getMessage("Some re-ordering could not be saved."))
}}if(E){D[CQ.Sling.CHARSET]="utf-8";
var C=CQ.HTTP.post(this.saveURL,null,D);
if(!CQ.HTTP.isOk(C)){H=true
}}if(H){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Saving error"),CQ.I18n.getMessage("Some modifications or deletions could not be saved."))
}this.fireEvent("save");
this.loadGrid()
}}});
CQ.wcm.BulkEditor.JCR_PATH="jcr:path";
CQ.wcm.BulkEditor.JCR_CONTENT_NODE="jcr:content";
CQ.wcm.BulkEditor.JCR_PRIMARYTYPE="jcr:primaryType";
CQ.wcm.BulkEditor.JCR_RESOURCETYPE="sling:resourceType";
CQ.Ext.reg("bulkeditor",CQ.wcm.BulkEditor);
CQ.wcm.BulkEditor.CheckColumn=function(A){CQ.Ext.apply(this,A);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.BulkEditor.CheckColumn.prototype={init:function(A){this.grid=A;
this.grid.on("render",function(){var B=this.grid.getView();
B.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(C,B){if(this.readOnly!==true&&this.readOnly!=="true"){if(B.className&&B.className.indexOf("x-grid3-cc-"+this.id)!=-1){C.stopEvent();
var D=this.grid.getView().findRowIndex(B);
var A=this.grid.store.getAt(D);
A.set(this.dataIndex,!A.data[this.dataIndex]);
this.grid.bulkeditor.handleEditedRecord(A,this.dataIndex,A.data[this.dataIndex],!A.data[this.dataIndex])
}}},renderer:function(B,C,A){B=A.data[this.dataIndex]==="true"||A.data[this.dataIndex]===true;
A.data[this.dataIndex]=B;
C.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(B?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}};
CQ.wcm.FeedImporter=function(A){this.constructor.call(this,A)
};
CQ.wcm.FeedImporter=CQ.Ext.extend(CQ.Ext.Viewport,{viewConfig:{forceFit:true},constructor:function(E){var C=this;
var D=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/etc/importers/polling/list.json"}),autoLoad:true,reader:new CQ.Ext.data.JsonReader({root:"rows",totalProperty:"results",id:"path",fields:["path","scheme","source","target","interval"]})});
D.setDefaultSort("path","ASC");
var F=function(I){var H=(I.indexOf("/")==0)?I+".html":I;
H=CQ.Util.externalize(H);
var J='<a target="_blank" href="{0}" style="cursor:pointer">{1}</a>';
return CQ.Util.patchText(J,[H,I])
};
var A=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{header:CQ.I18n.getMessage("Scheme"),dataIndex:"scheme",width:60},{header:CQ.I18n.getMessage("URL"),renderer:F,dataIndex:"source",width:400},{header:CQ.I18n.getMessage("Imported to Path"),dataIndex:"target",renderer:F,width:400},{header:CQ.I18n.getMessage("Import Interval in Seconds"),dataIndex:"interval",width:120},{header:CQ.I18n.getMessage("Path of Importer Configuration"),dataIndex:"path",width:200}]);
A.defaultSortable=true;
var G=new CQ.Ext.Action({cls:"cq.wcm.FeedImporter.remove",text:CQ.I18n.getMessage("Remove"),handler:function(){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Configuration?"),msg:CQ.I18n.getMessage("Would you really like to delete the importer configuration?"),buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(J){if(J=="yes"){var H=CQ.Ext.getCmp("cq-feedimporter-grid").getSelectionModel().getSelected();
var I={};
I[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
I[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
I[CQ.Sling.CHARSET]="utf-8";
CQ.HTTP.post(H.id,function(L,M,K){if(M){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload()
}},I,this)
}}})
},tooltip:{title:CQ.I18n.getMessage("Remove configuration entry"),text:CQ.I18n.getMessage("Removes the selected importer configuration"),autoHide:true}});
G.setDisabled(true);
this.newDialog=CQ.WCM.getDialog({"jcr:primaryType":"cq:Dialog",xtype:"dialog",title:"New Importer Configuration",params:{_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"hidden",name:"source"},{xtype:"selection",type:"select",name:"feedType",fieldLabel:CQ.I18n.getMessage("Type"),defaultValue:"atom",options:[{text:"RSS",value:"rss"},{text:"Atom",value:"atom"},{text:"Calendar",value:"ics"},{text:"IMAP",value:"imap"},{text:"IMAP (over SSL)",value:"imaps"},{text:"POP3",value:"pop3"},{text:"POP3 (over SSL)",value:"pop3s"}],listeners:{selectionchanged:{fn:this.syncSource,scope:this}}},{xtype:"textfield",name:"feedUrl",fieldLabel:CQ.I18n.getMessage("URL"),listeners:{change:{fn:this.syncSource,scope:this}}},{xtype:"pathfield",selectOnFocus:true,name:"target",fieldLabel:CQ.I18n.getMessage("Import to Path"),predicate:"nosystem",showTitlesInTree:false},{xtype:"numberfield",name:"interval",fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldLabel:CQ.I18n.getMessage("Update Interval in Seconds")},{xtype:"hidden",name:"jcr:mixinTypes",value:"cq:PollConfig"},{xtype:"hidden",name:"hidden",value:"true"}]},responseScope:this,success:function(){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create feed configuration!"))
},buttons:CQ.Dialog.OKCANCEL});
this.newDialog.form.url="/etc/importers/polling/*";
var B=new CQ.Ext.Toolbar({id:"cq-feedimporter-toolbar",items:[{xtype:"button",text:CQ.I18n.getMessage("Refresh"),tooltip:CQ.I18n.getMessage("Updates the list of feed importer configurations"),handler:function(){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload()
}},{xtype:"tbseparator"},{xtype:"button",text:CQ.I18n.getMessage("Add"),handler:function(){C.newDialog.show()
}},G]});
CQ.wcm.FeedImporter.superclass.constructor.call(this,{id:"cq-feedimporter-wrapper",renderTo:"CQ",layout:"fit",items:[{xtype:"panel",layout:"border",tbar:B,items:[{xtype:"grid",id:"cq-feedimporter-grid",region:"center",margins:"5 5 5 5",pageSize:25,loadMask:true,stripeRows:true,cm:A,store:D,sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true,listeners:{selectionchange:function(H){G.setDisabled(!H.hasSelection())
}}})}]}]})
},syncSource:function(){var B=this.newDialog;
var C=B.getField("feedType");
var A=B.getField("feedUrl");
var D=B.getField("source");
D.setValue(C.getValue()+":"+A.getValue())
},initComponent:function(){CQ.wcm.FeedImporter.superclass.initComponent.call(this)
}});
CQ.Ext.reg("feedimporter",CQ.wcm.FeedImporter);
CQ.wcm.FormActionSelectionRedirectHelper=CQ.Ext.extend(CQ.Ext.util.Observable,{redirectField:null,dialog:null,constructor:function(A){if(A){this.dialog=A;
A.FormActionSelectionRedirectHelper=this;
A.on("loadcontent",this.loadContentHandler)
}},setRedirectField:function(){if(!this.redirectField){var A=this.dialog.find("componentId","redirectField");
if(A&&A[0]){this.redirectField=A[0]
}}return this.redirectField
},loadContentHandler:function(D,B,C,E){var A=D.FormActionSelectionRedirectHelper;
if(E&&A.setRedirectField()){A.redirectField.setValue(B[0].get(A.redirectField.name))
}},updateRedirectField:function(E,C){var A=C["cq:redirectFieldName"];
var D="./"+(A?A:"redirect");
var B=E.FormActionSelectionRedirectHelper;
if(B&&B.setRedirectField()){var F=B.redirectField.getEl();
if(F.dom.name){B.redirectField.name=D;
F.dom.name=D
}else{throw ("Unable to set redirect field name to "+D+", no 'name' attribute in dom")
}}else{throw ("Unable to access redirectField")
}}});
CQ.wcm.FormActionSelection=CQ.Ext.extend(CQ.form.Selection,{tabId:null,tabId:null,loadedData:null,redirectHelper:null,constructor:function(A){var B={options:"/bin/wcm/foundation/forms/actions.json",type:"select",tabId:"cq5_form_action_config_panel",workflowId:"cq5_form_action_workflow_id"};
CQ.Util.applyDefaults(A,B);
CQ.wcm.FormActionSelection.superclass.constructor.call(this,A);
this.tabId=A.tabId;
this.workflowId=A.workflowId;
this.addListener(CQ.form.Selection.EVENT_SELECTION_CHANGED,function(C,D){this.notifyChange(D,false)
});
this.redirectHelper=new CQ.wcm.FormActionSelectionRedirectHelper(this.findParentByType("dialog"))
},initComponent:function(){CQ.wcm.FormActionSelection.superclass.initComponent.call(this)
},notifyChange:function(value,loadWidgets){var dialog=this.findParentByType("dialog");
var configTab=dialog.find("componentId",this.tabId)[0];
if(configTab!=null){var form=configTab.findParentByType("form").getForm();
configTab.items.each(function(item,index,length){form.remove(item);
configTab.remove(item)
},this);
var workaroundRemoveLabels=CQ.Ext.DomQuery.select("div[class*='x-form-item']",configTab.getEl().dom);
for(var x=0;
x<workaroundRemoveLabels.length;
x++){workaroundRemoveLabels[x].parentNode.removeChild(workaroundRemoveLabels[x])
}configTab.doLayout();
var url="/bin/wcm/foundation/forms/actiondialog.json";
url=CQ.utils.HTTP.addParameter(url,"id",value);
response=CQ.utils.HTTP.get(url);
var noItems=true;
var needWorkflow=false;
if(CQ.HTTP.isOk(response)){var items=CQ.utils.Util.formatData(CQ.Util.eval(response));
this.redirectHelper.updateRedirectField(dialog,items);
for(var i in items){if(!items[i]||(typeof items[i]=="string")||(typeof items[i]=="boolean")){continue
}var wi=configTab.add(items[i]);
form.add(wi);
noItems=false;
configTab.doLayout();
wi.processRecord(this.loadedData)
}configTab.doLayout();
needWorkflow=items&&items.usesWorkflow
}if(noItems){configTab.add({xtype:"static",italic:true,small:true,style:"color:gray;",text:CQ.I18n.getMessage("No additional configuration options available")});
configTab.doLayout()
}var workflowWidget=this.findParentByType("dialog").find("componentId",this.workflowId)[0];
if(workflowWidget){workflowWidget.setDisabled(!needWorkflow)
}}},processRecord:function(A,B){this.loadedData=A;
CQ.wcm.FormActionSelection.superclass.processRecord.call(this,A,B)
},setValue:function(A){if(typeof A=="undefined"||A===null){A="foundation/components/form/actions/store"
}CQ.wcm.FormActionSelection.superclass.setValue.call(this,A);
this.notifyChange(A,true)
}});
CQ.Ext.reg("formactionselection",CQ.wcm.FormActionSelection);
CQ.wcm.FormReportButton=CQ.Ext.extend(CQ.form.CompositeField,{constructor:function(B){var C=this;
var D="/bin/wcm/foundation/forms/report.html";
if(B&&B.baseUrl){D=B.baseUrl
}var A;
if(B&&B.url){A=B.url
}B=CQ.Util.applyDefaults(B,{border:false,items:[{xtype:"panel",border:false,bodyStyle:"padding:4px",items:[{xtype:"button",text:"View Data..",tooltip:"View data entered through this form",handler:function(){var G=C.findParentByType("dialog");
var F;
if(A){F=CQ.HTTP.externalize(A)
}else{F=CQ.HTTP.externalize(D);
F+="?path="+G.form.url
}var E=CQ.shared.Util.open(F,null,"FormReport");
E.focus()
}}]}]});
var C=this;
CQ.wcm.FormReportButton.superclass.constructor.call(this,B)
},initComponent:function(){CQ.wcm.FormReportButton.superclass.initComponent.call(this)
}});
CQ.Ext.reg("formreportbutton",CQ.wcm.FormReportButton);
CQ.wcm.BulkEditorForm=CQ.Ext.extend(CQ.Ext.form.FormPanel,{constructor:function(A){A=(!A?{}:A);
A.xtype="bulkeditor";
var C=A.renderTo;
delete A.renderTo;
var B={renderTo:C,items:[A],hideBorders:true,border:false,stateful:false,layout:"fit"};
CQ.wcm.BulkEditorForm.superclass.constructor.call(this,B)
}});
CQ.Ext.reg("bulkeditorform",CQ.wcm.BulkEditorForm);
CQ.wcm.CustomCellSelectionModel=function(A){CQ.Ext.apply(this,A);
this.selections=[];
this.last=false;
this.lastActive=false;
this.addEvents("selectionchange","beforecellselect","cellselect","celldeselect");
CQ.wcm.CustomCellSelectionModel.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.wcm.CustomCellSelectionModel,CQ.Ext.grid.AbstractSelectionModel,{singleSelect:false,initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("cellmousedown",this.handleMouseDown,this)
}else{this.grid.on("cellclick",function(B,E,C,D){if(D.button===0&&!D.shiftKey&&!D.ctrlKey){this.selectCell([E,C],false);
B.view.focusCell(E,C)
}},this)
}this.rowNav=new CQ.Ext.KeyNav(this.grid.getGridEl(),{up:function(D){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[0]==0){return 
}else{var E,B;
E=this.lastActive[0]-1;
B=this.lastActive[1];
if(!D.shiftKey){this.selectCell([E,B])
}else{var C=this.last;
this.selectRange(this.last,[E,B]);
this.last=C
}this.grid.getView().focusCell(E,B);
this.lastActive=[E,B]
}}},down:function(D){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[0]==this.grid.getStore().getCount()-1){return 
}else{var E,B;
E=this.lastActive[0]+1;
B=this.lastActive[1];
if(!D.shiftKey){this.selectCell([E,B])
}else{var C=this.last;
this.selectRange(this.last,[E,B]);
this.last=C
}this.grid.getView().focusCell(E,B);
this.lastActive=[E,B]
}}},left:function(D){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[1]==0){return 
}else{var E,B;
E=this.lastActive[0];
B=this.lastActive[1]-1;
if(!D.shiftKey){this.selectCell([E,B])
}else{var C=this.last;
this.selectRange(this.last,[E,B]);
this.last=C
}this.grid.getView().focusCell(E,B);
this.lastActive=[E,B]
}}},right:function(D){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[1]==this.grid.getColumnModel().getColumnCount()-1){return 
}else{var E,B;
E=this.lastActive[0];
B=this.lastActive[1]+1;
if(!D.shiftKey){this.selectCell([E,B])
}else{var C=this.last;
this.selectRange(this.last,[E,B]);
this.last=C
}this.grid.getView().focusCell(E,B);
this.lastActive=[E,B]
}}},scope:this});
var A=this.grid.view;
A.on("refresh",this.onRefresh,this);
A.on("rowremoved",this.onRemove,this)
},onRefresh:function(){this.clearSelections()
},onRemove:function(A,B,C){this.deselectRange([B,0],[B,this.grid.getColumnModel().getColumnCount()])
},getCount:function(){return this.selections.length
},selectRight:function(B){if(this.hasNext()){var C,A=this.last[1];
if(A==this.grid.getColumnModel().getColumnCount()-1){C=this.last[0]+1;
A=0
}else{C=this.last[0];
A+=1
}this.selectCell([C,A],B);
this.grid.getView().focusCell(this.last[0],this.last[1]);
return true
}return false
},selectDown:function(D){var B,C=this.grid.getColumnModel().getColumnCount();
for(var A=0;
A<C;
A++){B=this.selectRight(D);
if(!B){break
}}return B
},selectUp:function(D){var B,C=this.grid.getColumnModel().getColumnCount();
for(var A=0;
A<C;
A++){B=this.selectLeft(D);
if(!B){break
}}return B
},selectLeft:function(B){if(this.hasPrevious()){var C,A=this.last[1];
if(A==0){C=this.last[0]-1;
A=this.grid.getColumnModel().getColumnCount()-1
}else{C=this.last[0];
A-=1
}this.selectCell([C,A],B);
this.grid.getView().focusCell(this.last[0],this.last[1]);
return true
}return false
},hasNext:function(){return this.last!==false&&((this.last[0]+1)<this.grid.store.getCount()||(this.last[1]+1)<this.grid.getColumnModel().getColumnCount())
},hasPrevious:function(){return this.last!==false&&(this.last[0]!=0||this.last[1]!=0)
},getSelections:function(){return[].concat(this.selections)
},getSortedSelections:function(){return[].concat(this.selections).sort()
},getSelectedCell:function(){return this.selections.length>0?[].concat(this.selections[0]):null
},each:function(E,D){var C=this.getSelections();
for(var B=0,A=C.length;
B<A;
B++){if(E.call(D||this,C[B],B)===false){return false
}}return true
},clearSelections:function(){if(this.locked){return 
}for(var A=this.selections.length-1;
A>=0;
A--){this.deselectCell(this.selections[A])
}this.selections=[];
this.last=false
},selectAll:function(){if(this.locked){return 
}this.selections=[];
var D,B;
var A=this.grid.getStore().getCount();
var C=this.grid.getColumnModel().getColumnCount();
for(D=0;
D<A;
D++){for(B=0;
B<C;
B++){this.selectCell([D,B],true)
}}},hasSelection:function(){return this.selections.length>0
},isSelected:function(A){var C=this.selections;
for(var B=0;
B<C.length;
B++){if(C[B][0]==A[0]&&C[B][1]==A[1]){return true
}}return false
},handleMouseDown:function(E,G,C,F){if(F.button!==0||this.isLocked()){return 
}var A=this.grid.getView();
if(F.shiftKey&&this.last!==false){var D=this.last;
this.selectRange(D,[G,C],F.ctrlKey);
this.last=D;
A.focusCell(G,C)
}else{var B=this.isSelected([G,C]);
if(F.ctrlKey&&B){this.deselectCell([G,C])
}else{if(!B||this.getCount()>1){if(B){this.clearSelections()
}this.selectCell([G,C],F.ctrlKey||F.shiftKey);
A.focusCell(G,C)
}}}},selectCells:function(B,D){if(!D){this.clearSelections()
}for(var C=0,A=B.length;
C<A;
C++){this.selectCell(B[C],true)
}},selectRange:function(F,B,J){if(this.locked){return 
}if(!J){this.clearSelections()
}var I,C,G;
var H=F[0];
var A=F[1];
var D=B[0];
var E=B[1];
if(D<H){I=D;
D=H;
H=I
}if(E<A){C=E;
E=A;
A=C
}for(I=H;
I<=D;
I++){for(C=A;
C<=E;
C++){this.selectCell([I,C],true)
}}},deselectRange:function(G,B,E){if(this.locked){return 
}var J,C,H;
var I=G[0];
var A=G[1];
var D=B[0];
var F=B[1];
if(D<I){J=D;
D=I;
I=J
}if(F<A){C=F;
F=A;
A=C
}for(J=I;
J<=D;
J++){for(C=A;
C<=F;
C++){this.deselectCell([J,C],E)
}}},selectCell:function(C,E,A){if(this.locked){return 
}if(this.isSelected(C)){return 
}var F=C[0];
var B=C[1];
if(F<0||F>=this.grid.store.getCount()){return 
}if(B<0||B>=this.grid.getColumnModel().getColumnCount()){return 
}if(this.fireEvent("beforecellselect",this,C,E)!==false){if(!E||this.singleSelect){this.clearSelections()
}this.selections.push(C);
this.last=this.lastActive=C;
if(!A){try{this.grid.getView().onCellSelect(F,B)
}catch(D){}}this.fireEvent("cellselect",this,C);
this.fireEvent("selectionchange",this,[].concat(this.selections))
}},deselectCell:function(B,A){if(this.locked){return 
}if(this.last[0]==B[0]&&this.last[1]==B[1]){this.last=false
}if(this.lastActive[0]==B[0]&&this.lastActive[1]==B[1]){this.lastActive=false
}var D=this.selections;
for(var C=0;
C<D.length;
C++){if(D[C][0]==B[0]&&D[C][1]==B[1]){this.selections.remove(D[C]);
if(!A){try{this.grid.getView().onCellDeselect(B[0],B[1])
}catch(E){}}this.fireEvent("celldeselect",this,B);
this.fireEvent("selectionchange",[].concat(this.selections));
return 
}}},acceptsNav:function(C,B,A){return !A.isHidden(B)&&A.isCellEditable(B,C)
},onEditorKey:function(F,E){var C=E.getKey(),G,D=this.grid,B=D.activeEditor;
var A=E.shiftKey;
if(C==E.TAB){E.stopEvent();
B.completeEdit();
if(A){G=D.walkCells(B.row,B.col-1,-1,this.acceptsNav,this)
}else{G=D.walkCells(B.row,B.col+1,1,this.acceptsNav,this)
}}else{if(C==E.ENTER){E.stopEvent();
B.completeEdit();
if(this.moveEditorOnEnter!==false){if(A){G=D.walkCells(B.row-1,B.col,-1,this.acceptsNav,this)
}else{G=D.walkCells(B.row+1,B.col,1,this.acceptsNav,this)
}}}else{if(C==E.ESC){B.cancelEdit()
}}}if(G){D.startEditing(G[0],G[1])
}}});
CQ.wcm.ComponentExtractor=CQ.Ext.extend(CQ.Ext.Viewport,{frame:null,highlightWidth:8,highlightColor:"#cce0f5",highlightSelectColor:"#f5bd43",topOffset:0,filter:null,selectionInfo:null,tree:null,components:null,selectBtn:null,selectedElement:null,dropRegion:null,dropTarget:null,displayComponents:[],componentList:null,highlightBorder:null,loadedPath:null,constructor:function(B){window.onbeforeunload=function(){window.onbeforeunload=null;
return CQ.I18n.getMessage("Do you really want to leave the page? This could be an automatic redirect from the imported page, so please click cancel if you don't want this.")
};
for(var C=0;
C<B.displayComponents.length;
C++){this.displayComponents.push(new RegExp(B.displayComponents[C]))
}this.loadedPath=CQ.HTTP.getAnchor(document.location.href);
var A=document.createElement("iframe");
A.id="frame_cq-ce";
A.name="frame_cq-ce";
A.frameBorder="0";
A.border="0";
this.frame=new CQ.Ext.Element(A);
this.frame.addClass("cq-frame");
this.frame.setStyle("width","100%");
this.frame.setStyle("height","100%");
this.frame.on("load",this.onFrameLoad,this);
CQ.Ext.dd.Registry.register(this.frame.dom);
var D=this;
this.selectionInfo=new CQ.Ext.Toolbar.TextItem({text:CQ.I18n.getMessage("Nothing selected.")});
this.filter=new CQ.Ext.form.TriggerField({triggerClass:"x-form-clear-trigger",emptyText:CQ.I18n.getMessage("Enter selector to filter elements"),width:240,onTriggerClick:function(){this.reset()
}});
this.tree=new CQ.Ext.tree.TreePanel({title:CQ.I18n.getMessage("Document Tree"),width:320,region:"east",margins:"5 5 0 0",cmargins:"5 5 0 5",split:true,collapsible:true,collapsed:true,animate:true,border:true,autoScroll:true,containerScroll:true,root:new CQ.Ext.tree.TreeNode({name:"doc",text:CQ.I18n.getMessage("Document"),expanded:true})});
this.components=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Components"),border:true,autoScroll:true,containerScroll:true,layout:"accordion",width:220,region:"west",margins:"5 0 0 5",cmargins:"5 5 0 5",split:true,collapsible:true,animate:true,tbar:[{iconCls:"cq-siteadmin-refresh",handler:D.loadComponents,scope:D}]});
this.mappings=new CQ.Ext.grid.EditorGridPanel({title:CQ.I18n.getMessage("Mappings"),border:true,autoScroll:true,containerScroll:true,height:220,region:"south",margins:"0 5 5 5",cmargins:"5 5 5 5",split:true,collapsible:true,collapsed:false,animate:true,viewConfig:new CQ.Ext.grid.GridView({forceFit:true}),store:new CQ.Ext.data.Store({}),cm:new CQ.Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:CQ.I18n.getMessage("Element"),dataIndex:"element",renderer:function(E){return D.getElementHint(E)
}},{header:CQ.I18n.getMessage("Component"),dataIndex:"component"},{header:CQ.I18n.getMessage("Path"),editor:new CQ.Ext.form.TextField({allowBlank:false}),dataIndex:"path"},{header:CQ.I18n.getMessage("Insert ID"),dataIndex:"insertID",hidden:true}]}),sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true,listeners:{selectionchange:function(F){var E=F.getSelected();
if(E){var G=E.get("element");
D.updateHighlight(D.highlightBorder,{"background-color":D.highlightSelectColor});
D.showHighlight(G,D.highlightBorder);
D.updateSelectionInfo(G);
D.updateTreeSelection(G);
D.setSelectedElement(G,true)
}}}}),tbar:[{text:"Generate",handler:function(){var G="";
var H="";
var E=true;
var F=D.mappings.getStore();
F.each(function(I){var K=I.get("component");
var L=I.get("path");
var J=I.get("insertID");
if((L==null)||(L=="")){E=false;
return false
}else{H+=G+J+"="+K+","+L;
G=":"
}},this);
if(!E){CQ.Ext.Msg.show({title:"Missing Paths",msg:CQ.I18n.getMessage("Please provide paths for all component mappings."),width:400,buttons:CQ.Ext.MessageBox.OK,icon:CQ.Ext.MessageBox.ERROR})
}else{CQ.Ext.Msg.wait("Please wait page component is generated.","Generating page",{interval:120,increment:60,text:"Generating page..."});
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/wcm/bin/siteimporter/generate"),params:{resource:D.loadedPath,mappings:H,_charset_:"utf-8"},success:function(I,J){F.commitChanges();
CQ.Ext.Msg.hide()
},failure:function(I,J){CQ.Ext.Msg.hide();
CQ.Ext.Msg.show({title:"Error",msg:I.responseText,width:400,buttons:CQ.Ext.MessageBox.OK,icon:CQ.Ext.MessageBox.ERROR})
}})
}}},"-",{text:"Remove",handler:function(){var H=D.mappings.getSelectionModel();
var G=H.getSelections();
var E=D.mappings.getStore();
for(var F=0;
F<G.length;
F++){E.remove(G[F])
}}},{text:"Remove All",handler:function(){var E=D.mappings.getStore();
E.removeAll()
}}]});
this.selectBtn=new CQ.Ext.Button({text:"Select",enableToggle:true,toggleHandler:function(F,G){var E=D.frame.dom.contentDocument.body;
if(G){D.hideFrame(D.highlightBorder);
D.updateHighlight(D.highlightBorder,{"background-color":D.highlightColor});
D.registerMouseover([E])
}else{D.unregisterMouseover([E])
}}});
this.extractBtn=new CQ.Ext.Button({text:"Extract...",handler:this.extractComponent,scope:this,disabled:true});
CQ.wcm.ComponentExtractor.superclass.constructor.call(this,{id:"cq-ce",layout:"border",renderTo:CQ.Util.getRoot(),items:[{id:"cq-ce-wrapper",xtype:"panel",region:"center",layout:"border",items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north"},this.tree,this.components,this.mappings,{xtype:"panel",id:"cq-ce-framewrapper",region:"center",margins:"5 0 0 0",items:new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"},listeners:{render:function(E){D.frame.appendTo(E.getEl())
}}}),tbar:[this.selectBtn,this.extractBtn],bbar:[this.selectionInfo,"->",this.filter],listeners:{render:function(E){if(D.loadedPath){D.loadResource(D.loadedPath)
}},resize:function(E,I,G,F,H){if(D.selectedElement){D.showHighlight(D.selectedElement,D.highlightBorder)
}}}}]}]})
},initComponent:function(){CQ.wcm.ComponentExtractor.superclass.initComponent.call(this);
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var A=document.createElement("iframe");
A.id=CQ.Ext.History.iframeId;
A.src=CQ.Ext.SSL_SECURE_URL;
A.className="x-hidden";
A.frameBorder="0";
A.border="0";
new CQ.Ext.Element(A).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
var B=this;
CQ.Ext.History.on("change",function(C){B.loadResource(C)
})
},onFrameLoad:function(){var B=this;
CQ.WCM.getTopWindow().CQ_ContentFinder={getContentWindow:function(){return B.frame.dom.contentWindow
}};
var A=CQ.Ext.get(this.frame.dom.contentDocument.documentElement).select("base",false);
if(A){A.remove()
}this.loadComponents();
this.highlightBorder=this.createHighlightBorder(this.highlightColor);
this.loadMappings();
this.loadTree([CQ.Ext.get(this.frame.dom.contentDocument.body)]);
this.setSelectedElement(null);
(function(){window.onbeforeunload=null
}).defer(2000)
},loadComponents:function(){var extractor=this;
if(this.componentList){this.componentList=null;
this.components.items.each(function(item){this.components.remove(item)
},this)
}var path="";
var url=CQ.HTTP.externalize("/libs/wcm/core/content/components.json");
url=CQ.HTTP.noCaching(url);
var res=CQ.HTTP.get(url);
var info=null;
if(CQ.HTTP.isOk(res)){info=CQ.Util.eval(res)
}else{info={}
}this.componentList=new CQ.wcm.ComponentList(path,info);
var all=this.componentList.getAllComponents();
for(var c in all){var comp=all[c];
var add=false;
if(!comp.virtual){for(var i=0;
i<extractor.displayComponents.length;
i++){if(extractor.displayComponents[i].test(comp.resourceType)){add=true;
break
}}}if(!add){delete all[c]
}}var compStores=new CQ.Ext.util.MixedCollection();
CQ.wcm.ComponentList.updateStores(compStores,all);
compStores.each(function(compStore,index,total){var panel=this.components.add(new CQ.Ext.Panel(CQ.Util.formatData({id:"cq-componenlist-"+compStore.group,title:compStore.group,cls:"cq-sidekick-buttons "+CQ.DOM.encodeClass(compStore.group,"cq-cmpts"),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:extractor.createDataView(compStore)})))
},this);
this.components.doLayout()
},createHighlightBorder:function(C){var A=this.frame.dom.contentDocument.body;
var F=document.createElement("div");
var E=new CQ.Ext.Element(F);
E.appendTo(A);
E.hide();
E.applyStyles({"background-color":C,position:"absolute",height:this.highlightWidth+"px"});
var G=document.createElement("div");
bBottom=new CQ.Ext.Element(G);
bBottom.appendTo(A);
bBottom.hide();
bBottom.applyStyles({"background-color":C,position:"absolute",height:this.highlightWidth+"px"});
var B=document.createElement("div");
bLeft=new CQ.Ext.Element(B);
bLeft.appendTo(A);
bLeft.hide();
bLeft.applyStyles({"background-color":C,position:"absolute",width:this.highlightWidth+"px"});
var D=document.createElement("div");
bRight=new CQ.Ext.Element(D);
bRight.appendTo(A);
bRight.hide();
bRight.applyStyles({"background-color":C,position:"absolute",width:this.highlightWidth+"px"});
return{top:E,bottom:bBottom,left:bLeft,right:bRight}
},createDataView:function(A){return new CQ.Ext.DataView({tpl:CQ.wcm.ComponentList.TEMPLATE,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-btn-over",selectedClass:"x-btn-selected",itemSelector:"table.x-btn",loadingText:CQ.I18n.getMessage("Loading components"),listeners:{render:function(B){B.dragZone=new CQ.wcm.ComponentExtractor.DragZone(B,{containerScroll:false});
B.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT);
B.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}},store:A,prepareData:function(B){B.title=CQ.I18n.getVarMessage(B.title);
B.description=CQ.I18n.getVarMessage(B.description);
return B
}})
},loadMappings:function(){var mappingsPath=this.loadedPath.substr(0,this.loadedPath.lastIndexOf("/"))+"/mappings.infinity.json";
var doc=this.frame.dom.contentDocument;
var extractor=this;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(mappingsPath),success:function(response,options){var store=extractor.mappings.getStore();
var mappings=CQ.Util.eval(response);
for(var m in mappings){var mapping=mappings[m];
if(mapping.component){var el=CQ.Ext.query("*[@componentInsertId='"+m+"']",doc.body);
if(el.length>0){el=CQ.Ext.get(el[0]);
var rID=extractor.getElementHint(el);
var record=new CQ.wcm.ComponentExtractor.ReplacementRecord({element:el,component:mapping.component,path:mapping.path,insertID:m},rID);
store.add([record])
}}}},failure:function(response,options){}})
},loadTree:function(B){var A=this.tree.getRootNode();
CQ.Ext.each(A.childNodes,function(E,C,D){E.remove()
});
this.loadTreeNodes(B,A);
A.expand(false)
},loadTreeNodes:function(H,F){for(var D=0;
D<H.length;
D++){var E=H[D];
var C=this.getElementHint(E);
var G=F.appendChild(new CQ.Ext.tree.TreeNode({name:C,text:C,leaf:E.dom.childNodes.length==0,singleClickExpand:true}));
G.on("click",function(J,I){this.updateHighlight(this.highlightBorder,{"background-color":this.highlightSelectColor});
this.showHighlight(J.relatedElement,this.highlightBorder);
this.updateSelectionInfo(J.relatedElement);
this.setSelectedElement(J.relatedElement)
},this);
G.relatedElement=E;
E.relatedTreeNode=G;
for(var B=0;
B<E.dom.childNodes.length;
B++){var A=CQ.Ext.get(E.dom.childNodes[B]);
if(A){this.loadTreeNodes([A],G)
}}}},registerMouseover:function(C){for(var A=0;
A<C.length;
A++){var B=CQ.Ext.get(C[A]);
B.on("mouseover",this.handleMouseover,this);
B.on("mouseout",this.handleMouseout,this)
}},unregisterMouseover:function(C){for(var A=0;
A<C.length;
A++){var B=CQ.Ext.get(C[A]);
B.un("mouseover",this.handleMouseover,this);
B.un("mouseout",this.handleMouseout,this)
}},handleMouseover:function(D,B,A){var C=CQ.Ext.get(B);
C.on("click",this.handleClick,this);
if(this.isFiltered(C)){this.showHighlight(C,this.highlightBorder);
this.updateSelectionInfo(C);
this.updateTreeSelection(C)
}},handleMouseout:function(D,B,A){var C=CQ.Ext.get(B);
C.un("click",this.handleClick,this);
this.hideFrame(this.highlightBorder);
this.updateSelectionInfo()
},isFiltered:function(B){var A=this.filter.getValue();
if(A&&(A!="")){return B.is(A)
}return true
},updateTreeSelection:function(A){if(A.relatedTreeNode){A.relatedTreeNode.ensureVisible();
A.relatedTreeNode.select()
}},updateSelectionInfo:function(A){var C;
if(A){var B=this.getElementHint(A);
C=CQ.I18n.getMessage("Selected Element")+": "+B
}else{C=CQ.I18n.getMessage("Nothing selected.")
}CQ.Ext.get(this.selectionInfo.el).update(C)
},updateHighlight:function(B,A){B.top.applyStyles(A);
B.bottom.applyStyles(A);
B.left.applyStyles(A);
B.right.applyStyles(A)
},showHighlight:function(B,F){var D=B.getBox();
var C=this.frame.dom.contentWindow;
var A=C.scrollY+this.topOffset;
var E=C.scrollX;
F.top.applyStyles({left:(D.x-this.highlightWidth+E)+"px",top:(D.y-this.highlightWidth+A)+"px",width:(D.width+(this.highlightWidth*2))+"px"});
F.top.show();
F.bottom.applyStyles({left:(D.x-this.highlightWidth+E)+"px",top:(D.y+D.height+A)+"px",width:(D.width+(this.highlightWidth*2))+"px"});
F.bottom.show();
F.left.applyStyles({left:(D.x-this.highlightWidth+E)+"px",top:(D.y-this.highlightWidth+A)+"px",height:(D.height+(this.highlightWidth*2))+"px"});
F.left.show();
F.right.applyStyles({left:(D.x+D.width+E)+"px",top:(D.y-this.highlightWidth+A)+"px",height:(D.height+(this.highlightWidth*2))+"px"});
F.right.show()
},getElementHint:function(B){var C=B.dom.nodeName;
if(B.dom.id&&(B.dom.id!="")){C+="#"+B.dom.id
}var A=B.dom.getAttribute("class");
if(A&&(A!="")){C+="."+A.replace(/ /g,".")
}return C
},hideFrame:function(A){A.top.hide();
A.bottom.hide();
A.left.hide();
A.right.hide()
},handleClick:function(D,C,B){D.stopEvent();
var A=this.frame.dom.contentDocument.body;
this.unregisterMouseover([A]);
this.setSelectedElement(CQ.Ext.get(C));
this.updateHighlight(this.highlightBorder,{"background-color":this.highlightSelectColor})
},setSelectedElement:function(E,A){if(this.dropTarget){this.dropTarget.destroy();
this.dropTarget=null
}this.dropRegion=null;
this.selectedElement=E;
if(this.selectedElement!=null){this.extractBtn.setDisabled(false);
this.dropRegion=CQ.Ext.lib.Region.getRegion(E.dom);
this.dropTarget=new CQ.wcm.EditBase.DropTarget(this.selectedElement,{ddGroup:CQ.wcm.EditBase.DD_GROUP_COMPONENT});
if(!A){var D=this.mappings.getStore();
var C=this.mappings.getSelectionModel();
var F=this.getElementHint(this.selectedElement);
var B=D.getById(F);
if(B){C.selectRecords([B])
}else{C.clearSelections()
}}}else{this.extractBtn.setDisabled(true)
}this.selectBtn.toggle(false)
},loadResource:function(A){if(A){this.frame.dom.src=CQ.HTTP.externalize(A+"?wcmmode=disabled")
}else{this.frame.dom.contentWindow.location.reload();
this.setSelectedElement(null)
}},extractComponent:function(){var B=this;
if(this.selectedElement){var A=CQ.WCM.getDialog({"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-extract-component"),title:CQ.I18n.getMessage("Extract Component"),formUrl:CQ.HTTP.externalize("/libs/wcm/bin/siteimporter/extract"),params:{_charset_:"utf-8",resource:this.loadedPath,insertID:this.selectedElement.dom.getAttribute("componentInsertId")},height:400,modal:true,okText:CQ.I18n.getMessage("Create"),success:function(){B.loadComponents()
},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",path:{xtype:"pathfield",fieldLabel:CQ.I18n.getMessage("Path"),allowBlank:false,name:"path",predicate:"nosystem",rootPath:"/",showTitlesInTree:false,value:"/apps"},label:{fieldLabel:CQ.I18n.getMessage("Label"),allowBlank:false,name:"label"},overwrite:{fieldLabel:CQ.I18n.getMessage("Overwrite"),fieldDescription:CQ.I18n.getMessage("Force overwrite of existing component"),xtype:"selection",type:"checkbox",name:"overwrite"},title:{fieldLabel:CQ.I18n.getMessage("Title"),allowBlank:false,name:"title"},description:{xtype:"textarea",fieldLabel:CQ.I18n.getMessage("Description"),name:"description"},group:{fieldLabel:CQ.I18n.getMessage("Group"),name:"group"},supertype:{fieldLabel:CQ.I18n.getMessage("Supertype"),value:"foundation/components/parbase",name:"supertype"},allowedParents:{fieldLabel:CQ.I18n.getMessage("Allowed Parents"),name:"allowedParents",value:"*/parsys"}}}});
A.show()
}}});
CQ.Ext.reg("componentextractor",CQ.wcm.ComponentExtractor);
CQ.wcm.ComponentExtractor.ReplacementRecord=CQ.Ext.data.Record.create([{name:"element"},{name:"component"},{name:"path"},{name:"insertID"}]);
CQ.wcm.ComponentExtractor.maskFrame=function(){if(!CQ.wcm.ComponentExtractor.frameMask){CQ.wcm.ComponentExtractor.frameMask=CQ.Ext.get("cq-ce-framewrapper").mask()
}return CQ.wcm.ComponentExtractor.frameMask
};
CQ.wcm.ComponentExtractor.unmaskFrame=function(){if(CQ.wcm.ComponentExtractor.frameMask){CQ.wcm.ComponentExtractor.frameMask=null;
CQ.Ext.get("cq-ce-framewrapper").unmask()
}};
CQ.wcm.ComponentExtractor.DragZone=CQ.Ext.extend(CQ.wcm.Sidekick.DragZone4ContentFinder,{notifyDropDT:function(G,F,E){var D=CQ.Ext.getCmp("cq-ce");
var B=D.mappings.getStore();
var C=D.getElementHint(D.selectedElement);
var A=B.getById(C);
if(A){A.set("component",E.records[0].get("resourceType"));
A.commit()
}else{A=new CQ.wcm.ComponentExtractor.ReplacementRecord({element:D.selectedElement,component:E.records[0].get("resourceType"),path:"",insertID:D.selectedElement.dom.getAttribute("componentInsertId")},C);
B.add([A])
}return true
},notifyOverDT:function(C,B,A){return this.dropAllowed
},CF_cleanUpDD:function(){CQ.wcm.ComponentExtractor.unmaskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
this.dragging=false;
this.IDDM_dragCurrent=false
},CF_b4StartDrag:function(A,G){if(!CQ.WCM.isContentWindowLoading()){var E=CQ.WCM.getContentFinder();
if(!E){throw new Error("No finder defined")
}var F=CQ.Ext.getCmp("cq-ce-framewrapper");
E.contentWindowLeft=F.getEl().getX();
E.contentWindowTop=F.getEl().getY()+F.getTopToolbar().getEl().getHeight();
CQ.wcm.ComponentExtractor.maskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
var B=CQ.WCM.getContentWindow();
try{if(!B.CQ){return 
}}catch(D){return 
}var C=this;
window.setTimeout(function(){var H=CQ.Ext.getCmp("cq-ce");
var I=CQ.Ext.getCmp("cq-ce").selectedElement;
if(I){C.dropTargets.push(H.dropTarget);
C.dropTargetRegions.push(H.dropRegion)
}},1);
this.mouse={pos:[-1,-1],lastPos:[-1,-1],time:0}
}},CF_handleMouseMove:function(I){if(!CQ.WCM.isContentWindowLoading()){var B=CQ.WCM.getContentFinder();
if(!B){throw new Error("No finder defined")
}var D=CQ.Ext.dd.DDM.getScrollLeft();
var C=CQ.Ext.dd.DDM.getScrollTop();
var K=I.getPageX()-B.contentWindowLeft+D;
var J=I.getPageY()-B.contentWindowTop+C;
var E=this.dropTargetRegions;
for(var G=0;
G<E.length;
G++){var A=E[G];
var F=new CQ.Ext.lib.Region(A.top,A.right,A.bottom,A.left);
F.adjust(C,D,C,D);
if(F.contains(new CQ.Ext.lib.Point(K,J))){var H=this.dropTargets[G];
if(H==this.cachedTarget){this.onDragOver(I);
this.updateMouseInfo(K,J);
return 
}else{if(this.cachedTarget){this.onDragOut(I)
}this.onDragEnter(I,H);
this.updateMouseInfo(K,J);
return 
}}}if(this.cachedTarget){this.onDragOut(I)
}this.updateMouseInfo(K,J)
}}});
CQ.wcm.Annotation=CQ.Ext.extend(CQ.Ext.Window,{minimized:false,colorTimeout:0,toggleTimeout:0,resizeTimeout:0,ddTimeout:0,referencePoint:null,isSaved:false,post:function(params){if(!params){params={}
}var path=this.path;
if(this.isUnsaved){params=CQ.Util.merge(params,this.getOffsetParams());
params=CQ.Util.merge(params,{"./jcr:lastModified":"","./jcr:lastModifiedBy":""})
}else{path+=CQ.HTTP.EXTENSION_HTML
}if(params[CQ.Sling.OPERATION]==CQ.Sling.OPERATION_DELETE){this.editComponent.removeAnnotation(this.id)
}var pResp=CQ.HTTP.post(path,null,params);
if(CQ.HTTP.isOk(pResp)){if(this.isUnsaved){this.path=pResp.headers[CQ.HTTP.HEADER_PATH];
this.isUnsaved=false
}if(params["./jcr:lastModified"]!=undefined){var gResp=CQ.HTTP.eval(this.path+CQ.HTTP.EXTENSION_JSON);
this.modInfo.updateHtml(this.buildModInfo(gResp["jcr:lastModifiedBy"],gResp["jcr:lastModified"]))
}}},getOffsetParams:function(){var A=this.editComponent.getInlinePlaceholder().getXY();
var B=this.hidden?this.mini.getPosition():this.getPosition();
this.offsetX=Math.round(B[0]-A[0]);
this.offsetY=Math.round(B[1]-A[1]);
return{"./x":this.offsetX,"./y":this.offsetY,"./x@TypeHint":"Long","./y@TypeHint":"Long"}
},align:function(){if(!this.hidden&&this.rendered){this.alignTo(this.editComponent.element,"tl",[this.offsetX,this.offsetY]);
for(var B in this.sketches){this.sketches[B].align()
}}if(!this.mini.hidden&&this.mini.rendered){var A=this.offsetX;
this.mini.alignTo(this.editComponent.element,"tl",[A,this.offsetY])
}},show:function(A){if(this.minimized){if(!this.mini.hidden){return 
}this.mini.show()
}else{if(!this.hidden){return 
}CQ.wcm.Annotation.superclass.show.call(this);
if(A){this.field.focus(false,200)
}for(var B in this.sketches){this.sketches[B].show()
}}this.align()
},hide:function(){if(this.minimized){if(this.mini.hidden){return 
}this.mini.hide()
}else{if(this.hidden){return 
}CQ.wcm.Annotation.superclass.hide.call(this)
}for(var A in this.sketches){this.sketches[A].hide()
}},destroy:function(){this.mini.destroy();
for(var A in this.sketches){this.sketches[A].destroy()
}CQ.wcm.Annotation.superclass.destroy.call(this)
},minimize:function(){this.toggle(true)
},toggle:function(B){if(this.minimized=B){this.mini.show();
CQ.wcm.Annotation.superclass.hide.call(this);
this.align();
for(var A in this.sketches){this.sketches[A].hide()
}}else{CQ.wcm.Annotation.superclass.show.call(this);
this.mini.hide();
this.align();
this.field.focus(false,200);
for(var A in this.sketches){this.sketches[A].show()
}}window.clearTimeout(this.toggleTimeout);
this.toggleTimeout=window.setTimeout(this.post.createDelegate(this,[{"./minimized":this.minimized,"./minimized@TypeHint":"Boolean"}]),this.saveDelay)
},rotateColor:function(){this.removeClass("cq-annotation-"+this.color);
this.mini.removeClass("cq-annotation-mini-"+this.color);
var B=this.colors.indexOf(this.color);
this.color=this.colors[B+1==this.colors.length?0:B+1];
this.addClass("cq-annotation-"+this.color);
this.mini.addClass("cq-annotation-mini-"+this.color);
for(var A in this.sketches){this.sketches[A].clearCanvas();
this.sketches[A].drawData()
}window.clearTimeout(this.colorTimeout);
this.colorTimeout=window.setTimeout(this.post.createDelegate(this,[{"./color":this.color}]),this.saveDelay)
},addSketch:function(){if(this.isUnsaved){this.post()
}new CQ.wcm.Annotation.Sketch({annotation:this,path:this.path+"/sketches/",id:CQ.Util.createId()}).show()
},removeSketch:function(A){this.sketches[A].destroy();
delete this.sketches[A]
},initTools:function(){if(!CQ.Ext.isIE&&this.sketchable){this.addTool({id:"sketch",handler:this.addSketch.createDelegate(this)})
}if(this.colors.length>1){this.addTool({id:"color",handler:this.rotateColor.createDelegate(this)})
}if(this.minimizable){this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])})
}if(this.closable){this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})
}},ghost:function(A){return CQ.wcm.Annotation.superclass.ghost.call(this,"cq-annotation cq-annotation-"+this.color)
},alignTo:function(B,A,C){return CQ.wcm.Annotation.alignTo(this,B,A,C)
},buildModInfo:function(A,C){var D="";
var G="";
try{var F=new Date(C);
var B=new Date();
if(CQ.Date.isToday(F,B)){D=CQ.Date.TODAY
}else{if(CQ.Date.isYesterday(F,B)){D=CQ.Date.YESTERDAY
}else{if(CQ.Date.isThisWeek(F,B)){D=CQ.Date.THIS_WEEK
}else{if(CQ.Date.isLastWeek(F,B)){D=CQ.Date.LAST_WEEK
}else{if(CQ.Date.isThisMonth(F,B)){D=CQ.Date.THIS_MONTH
}else{if(CQ.Date.isThisYear(F,B)){D=F.format("F d")
}else{D=F.format("d-M-Y")
}}}}}}D=" ("+D+")";
G=' title="'+CQ.wcm.SiteAdmin.formatDate(F)+'"'
}catch(E){}return"<span"+G+">"+A+D+"</span>"
},constructor:function(C){var A=this;
this.field=new CQ.Ext.form.TextArea({name:"./annotation",xtype:"textarea",value:C.text?C.text:"",flex:1,listeners:{change:function(){A.post({"./text":this.getValue(),"./jcr:lastModified":"","./jcr:lastModifiedBy":"",_charset_:"utf-8"})
}}});
var B=C.lastModifiedBy?C.lastModifiedBy:CQ.User.getCurrentUser().getUserID();
this.modInfo=new CQ.Static({html:this.buildModInfo(B,C.lastModified)});
CQ.Util.applyDefaults(C,{cls:"cq-annotation",height:CQ.themes.wcm.Annotation.HEIGHT,width:CQ.themes.wcm.Annotation.WIDTH,minWidth:CQ.themes.wcm.Annotation.MINWIDTH,minHeight:CQ.themes.wcm.Annotation.MINHEIGHT,minimizable:true,minimized:false,sketchable:CQ.themes.wcm.Annotation.SKETCHABLE,shadow:"frame",resizeHandles:"se",color:CQ.themes.wcm.Annotation.COLOR,colors:CQ.themes.wcm.Annotation.COLORS,saveDelay:CQ.themes.wcm.Annotation.SAVE_DELAY,exitSketchDelay:CQ.themes.wcm.Annotation.EXIT_SKETCH_DELAY,layout:{type:"vbox",align:"stretch"},listeners:{resize:function(E,D,F){if(D==this.width&&F==this.height){return 
}window.clearTimeout(A.resizeTimeout);
A.resizeTimeout=window.setTimeout(A.post.createDelegate(A,[{"./w":Math.round(D),"./h":Math.round(F),"./w@TypeHint":"Long","./h@TypeHint":"Long"}]),this.saveDelay)
},beforeclose:function(){if(this.isUnsaved){this.editComponent.removeAnnotation(this.id);
return false
}var D=CQ.I18n.getMessage("Do you really want to delete the selected annotation and the associated sketches?");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Annotation"),D,function(F){if(F=="yes"){var E={};
E[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
this.post(E)
}},this);
return false
},render:function(){this.setActive()
}},items:[this.field,this.modInfo]});
CQ.wcm.Annotation.superclass.constructor.call(this,C)
},initComponent:function(){CQ.wcm.Annotation.superclass.initComponent.call(this);
this.isUnsaved=this.path.charAt(this.path.length-1)=="/";
this.mini=new CQ.wcm.Annotation.Mini({annotation:this});
this.addClass("cq-annotation-"+this.color);
this.mini.addClass("cq-annotation-mini-"+this.color);
var A=this;
this.on("render",function(){A.el.disableShadow=function(){};
A.el.enableShadow()
});
var D={};
if(!CQ.Ext.isIE){for(var C in this.sketches){if(C=="jcr:primaryType"){continue
}var E=CQ.Util.createId();
var B={name:C,id:E,path:this.path+"/sketches/"+C,annotation:this,data:this.sketches[C].data,offsetX:this.sketches[C].x,offsetY:this.sketches[C].y,width:this.sketches[C].w,height:this.sketches[C].h,hidden:this.minimized};
D[E]=new CQ.wcm.Annotation.Sketch(B)
}}this.sketches=D
},initDraggable:function(){this.dd=new CQ.wcm.Annotation.DD(this)
}});
CQ.Ext.reg("annotation",CQ.wcm.Annotation);
CQ.wcm.Annotation.alignTo=function(B,C,A,D){var E=B.el.getAlignToXY(C,A,D);
if(E[1]<0){E[1]=3
}B.setPosition(E[0],E[1]);
return this
};
CQ.wcm.Annotation.selectedSketch=null;
CQ.wcm.Annotation.removeSelectedSketch=function(){if(CQ.wcm.Annotation.selectedSketch){if(CQ.wcm.Annotation.selectedSketch.isDragging){return 
}window.clearTimeout(CQ.wcm.Annotation.selectedSketch.ddTimeout);
var A={};
A[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
CQ.wcm.Annotation.selectedSketch.post(A)
}};
CQ.wcm.Annotation.Mini=CQ.Ext.extend(CQ.Ext.Window,{post:function(){var A=this.win.getOffsetParams();
this.annotation.post(A);
window.clearTimeout(this.annotation.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[A]),this.win.saveDelay)
},minimize:function(){this.annotation.toggle(false)
},ghost:function(A){return CQ.wcm.Annotation.superclass.ghost.call(this,"cq-annotation-mini cq-annotation-mini-"+this.annotation.color)
},alignTo:function(B,A,C){return CQ.wcm.Annotation.alignTo(this,B,A,C)
},constructor:function(A){CQ.Util.applyDefaults(A,{cls:"cq-annotation-mini",closable:false,shadow:false,resizable:false,minimizable:true});
CQ.wcm.Annotation.Mini.superclass.constructor.call(this,A)
},initDraggable:function(){this.dd=new CQ.wcm.Annotation.Mini.DD(this)
}});
CQ.wcm.Annotation.Sketch=CQ.Ext.extend(CQ.Ext.Window,{exitTimeout:0,ddTimeout:0,minWidth:16,constructor:function(B){var A=B.width?B.width+2:CQ.Ext.lib.Dom.getViewWidth()-20;
var C=B.height?B.height+2:CQ.Ext.lib.Dom.getViewHeight();
this.minY=C;
this.maxY=0;
this.minX=A;
this.maxX=0;
B=CQ.Util.applyDefaults(B,{renderTo:CQ.Util.ROOT_ID,cls:"cq-annotation-sketch",resizable:false,shadow:false,width:A,height:C,x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop,lineWidth:CQ.themes.wcm.Annotation.LINE_WIDTH,items:[new CQ.Static({html:'<canvas width="'+A+'" height="'+C+'"></canvas>'}),this.tlAngle=new CQ.Static({cls:"cq-annotation-angle-tl",text:""}),this.trAngle=new CQ.Static({cls:"cq-annotation-angle-tr",text:""}),this.blAngle=new CQ.Static({cls:"cq-annotation-angle-bl",text:""}),this.brAngle=new CQ.Static({cls:"cq-annotation-angle-br",text:""})],listeners:{afterrender:this.initCanvas}});
CQ.wcm.Annotation.Sketch.superclass.constructor.call(this,B)
},initActivation:function(){this.on("activate",function(){this.addClass("cq-annotation-active");
CQ.wcm.Annotation.selectedSketch=this
});
this.on("deactivate",function(){this.removeClass("cq-annotation-active");
CQ.wcm.Annotation.selectedSketch=null
})
},initCanvas:function(){this.canvas=this.body.dom.getElementsByTagName("canvas")[0];
this.context=this.canvas.getContext("2d");
if(this.data){this.drawData();
this.initActivation();
this.canvas.setAttribute("class","cq-cursor-move")
}else{this.coords=[];
this.canvas.setAttribute("class","cq-cursor-crosshair");
this.mousedownHandler=this.start.createDelegate(this);
this.mousemoveHandler=this.draw.createDelegate(this);
this.mouseupHandler=this.stop.createDelegate(this);
this.doubleclickHandler=this.stopDoubleclick.createDelegate(this);
this.canvas.addEventListener("mousedown",this.mousedownHandler,true);
this.canvas.addEventListener("mousemove",this.mousemoveHandler,true);
this.canvas.addEventListener("mouseup",this.mouseupHandler,true);
this.canvas.addEventListener("dblclick",this.doubleclickHandler,true)
}},align:function(){if(this.rendered){this.alignTo(this.annotation.editComponent.element,"tl",[this.offsetX,this.offsetY])
}},show:function(){if(this.hidden){CQ.wcm.Annotation.superclass.show.call(this)
}},post:function(D){if(!D){D={}
}var A=this.path.charAt(this.path.length-1)=="/";
var C=this.path;
if(!A){C+=CQ.HTTP.EXTENSION_HTML
}if(D[CQ.Sling.OPERATION]==CQ.Sling.OPERATION_DELETE){this.annotation.removeSketch(this.id)
}else{D=CQ.Util.merge(D,this.getOffsetParams())
}var B=CQ.HTTP.post(C,null,D);
if(CQ.HTTP.isOk(B)){if(A){this.path=B.headers[CQ.HTTP.HEADER_PATH];
this.annotation.sketches[this.id]=this
}}},getOffsetParams:function(){var A=this.annotation.editComponent.getInlinePlaceholder().getXY();
var B=this.getPosition();
this.offsetX=Math.round(B[0]-A[0]);
this.offsetY=Math.round(B[1]-A[1]);
return{"./x":this.offsetX,"./y":this.offsetY,"./x@TypeHint":"Long","./y@TypeHint":"Long"}
},getMouseXY:function(B){var A;
if(B.layerX!=undefined){A=[B.layerX,B.layerY]
}else{if(B.offsetX!=undefined){A=[B.offsetX,B.offsetY]
}}if(A[0]<this.minX){this.minX=A[0]
}if(A[0]>this.maxX){this.maxX=A[0]
}if(A[1]<this.minY){this.minY=A[1]
}if(A[1]>this.maxY){this.maxY=A[1]
}this.coords.push(A[0]+document.documentElement.scrollLeft,A[1]+document.documentElement.scrollTop);
return A
},start:function(C,B,A){A=A||this.context;
window.clearTimeout(this.exitTimeout);
if(C){C.stopPropagation()
}if(this.doDraw){return 
}if(!B){B=this.getMouseXY(C)
}this.doDraw=true;
A.strokeStyle=CQ.themes.wcm.Annotation.STROKE_STYLES[this.annotation.color];
A.lineWidth=this.lineWidth;
this.formerXY=B
},stopDoubleclick:function(B){var A=this.getMouseXY(B);
this.stop(null,A)
},stop:function(C,B){if(!B){B=this.getMouseXY(C)
}this.context.beginPath();
this.context.moveTo(this.formerXY[0],this.formerXY[1]);
this.context.lineTo(B[0],B[1]);
this.context.stroke();
this.context.closePath();
if(C){C.stopPropagation();
if(C.altKey){this.formerXY=B;
return 
}}this.doDraw=false;
this.canvas.setAttribute("class","");
this.canvas.removeEventListener("mousedown",this.mousedownHandler,true);
this.canvas.removeEventListener("mousemove",this.mousemoveHandler,true);
this.canvas.removeEventListener("mouseup",this.mouseupHandler,true);
this.canvas.removeEventListener("dblclick",this.doubleclickHandler,true);
this.crop();
this.initActivation();
this.setActive();
this.canvas.setAttribute("class","cq-cursor-move");
var A=new CQ.wcm.Annotation.Sketch({annotation:this.annotation,path:this.annotation.path+"/sketches/",id:CQ.Util.createId()});
A.show();
A.exitTimeout=window.setTimeout(A.destroy.createDelegate(A),this.annotation.exitSketchDelay);
this.post({"./data":this.coords.join(","),"./w":this.canvas.getAttribute("width"),"./h":this.canvas.getAttribute("height"),"./w@TypeHint":"Long","./h@TypeHint":"Long"})
},draw:function(C,B,A){A=A||this.context;
if(C){C.stopPropagation();
if(C.altKey){return 
}}if(this.doDraw||B){if(!B){B=this.getMouseXY(C)
}A.beginPath();
A.moveTo(this.formerXY[0],this.formerXY[1]);
A.lineTo(B[0],B[1]);
A.stroke();
A.closePath();
this.formerXY=B
}},drawData:function(C,B){if(!C){C=this.data.split(",")
}this.start(null,[C[0],C[1]],B);
for(var A=2;
A<C.length;
A=A+2){this.draw(null,[C[A],C[A+1]],B)
}this.doDraw=false
},clearCanvas:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)
},crop:function(){var D=Math.ceil(this.context.lineWidth/2);
var A=this.maxX-this.minX+2*D;
var C=this.maxY-this.minY+2*D;
if(A<this.minWidth){A=this.minWidth
}if(C<this.minWidth){C=this.minWidth
}this.clearCanvas();
this.canvas.setAttribute("width",A);
this.canvas.setAttribute("height",C);
this.setPosition(this.minX-D+document.documentElement.scrollLeft,this.minY-D+document.documentElement.scrollTop);
this.setWidth(A);
this.setHeight(C);
var E=this.getPosition();
for(var B=0;
B<this.coords.length;
B=B+2){this.coords[B]=this.coords[B]-E[0];
this.coords[B+1]=this.coords[B+1]-E[1]
}this.drawData(this.coords);
this.data=this.coords.join(",")
},onEsc:function(A,B){B.stopEvent();
if(this.coords.length==0){window.clearTimeout(this.exitTimeout);
this.destroy()
}},initDraggable:function(){this.dd=new CQ.wcm.Annotation.Sketch.DD(this)
},createGhost:function(){var C=document.createElement("div");
C.className="x-panel-ghost cq-annotation-sketch";
var A=this.canvas.cloneNode(true);
var B=A.getContext("2d");
this.drawData(null,B);
C.appendChild(A);
C.appendChild(this.tlAngle.el.dom.cloneNode(true));
C.appendChild(this.trAngle.el.dom.cloneNode(true));
C.appendChild(this.blAngle.el.dom.cloneNode(true));
C.appendChild(this.brAngle.el.dom.cloneNode(true));
C.style.width=this.el.dom.offsetWidth+"px";
C.style.height=this.bwrap.getHeight()+"px";
this.container.dom.appendChild(C);
return new CQ.Ext.Element(C)
}});
CQ.wcm.Annotation.DD=function(A){CQ.wcm.Annotation.DD.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.wcm.Annotation.DD,CQ.Ext.Window.DD,{endDrag:function(A){this.win.unghost();
var B=this.win.getOffsetParams();
window.clearTimeout(this.win.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[B]),this.win.saveDelay)
}});
CQ.wcm.Annotation.Mini.DD=function(A){CQ.wcm.Annotation.Mini.DD.superclass.constructor.call(this,A)
};
CQ.Ext.extend(CQ.wcm.Annotation.Mini.DD,CQ.Ext.Window.DD,{endDrag:function(A){this.win.unghost();
var B=this.win.annotation.getOffsetParams();
window.clearTimeout(this.win.annotation.ddTimeout);
this.win.annotation.ddTimeout=window.setTimeout(this.win.annotation.post.createDelegate(this.win.annotation,[B]),this.win.annotation.saveDelay)
}});
CQ.wcm.Annotation.Sketch.DD=function(A){this.win=A;
CQ.Ext.Window.DD.superclass.constructor.call(this,A.el.id,"WindowDD-"+A.id);
this.setHandleElId(A.body.id);
this.scroll=false
};
CQ.Ext.extend(CQ.wcm.Annotation.Sketch.DD,CQ.Ext.Window.DD,{startDrag:function(A){this.win.isDragging=true;
CQ.wcm.Annotation.Sketch.DD.superclass.startDrag.call(this,A)
},endDrag:function(A){this.win.unghost();
this.win.isDragging=false;
var B=this.win.getOffsetParams();
window.clearTimeout(this.win.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[B]),this.win.annotation.saveDelay)
}});
CQ.wcm.Scene7PublishDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,basePath:null,constructor:function(D){if(!D){D=new Object()
}this.dataPath=D.dataPath;
if(!this.dataPath){this.dataPath="/libs/dam/scene7/publishdialog/servlet"
}this.path=D.path;
this.basePath=D.basePath;
var B=new CQ.wcm.Scene7PublishDialog.CheckColumn({header:CQ.I18n.getMessage("Include Subfolders"),dataIndex:"subfolders",enabledIf:"isfolder",width:100});
var A=new CQ.Ext.grid.ColumnModel([B,{header:CQ.I18n.getMessage("Count"),dataIndex:"fileCount",width:60},{header:CQ.I18n.getMessage("Size"),dataIndex:"fileSize",renderer:function(K,H,G,L,J,I){return CQ.Ext.util.Format.fileSize(K)
}},{id:"path",header:CQ.I18n.getMessage("Assets"),dataIndex:CQ.shared.XSS.getXSSValue("path"),renderer:function(K,H,G,L,J,I){if(K.lastIndexOf("/")==K.length-1){return K
}else{return K.substring(K.lastIndexOf("/")+1)
}},width:220}]);
A.defaultSortable=true;
var F=this;
var C=CQ.HTTP.addParameter(this.dataPath,"path",this.path);
C=CQ.HTTP.addParameter(C,"_charset_","utf-8");
C=CQ.shared.HTTP.externalize(C);
this.store=new CQ.Ext.data.JsonStore({url:C,root:"paths",fields:[{name:"deepFileSize"},{name:"shallowFileSize"},{name:"fileSize"},{name:"deepFileCount"},{name:"shallowFileCount"},{name:"fileCount"},{name:"deepPublishStatus",defaultValue:"notAvailable"},{name:"shallowPublishStatus",defaultValue:"notAvailable"},{name:"publishStatus",defaultValue:"notAvailable"},{name:"path"},{name:"subfolders",defaultValue:true},{name:"isfolder"}],listeners:{beforeload:function(){F.loadingRefs=true
},load:function(){F.loadingRefs=false
},loadexception:function(J,H,G){F.loadingRefs=false;
try{var I=CQ.Ext.decode(G.responseText);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getVarMessage(I.message))
}catch(K){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Unexpected error while loading scene7 publish dialog"))
}F.hide()
}}});
var E=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:A,height:238,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,loadMask:{msg:CQ.I18n.getMessage("Loading assets to Publish...")}});
B.init(E);
E.on("headerclick",function(H,G,J){if(G==0){var K="subfolders";
var I;
H.store.each(function(L){if(typeof I=="undefined"){I=!L.data[K]
}L.set(K,I);
L.dirty=false;
return true
})
}return true
});
D=CQ.Util.applyDefaults(D,{xtype:"dialog",title:CQ.I18n.getMessage("Publish to Scene7"),formUrl:CQ.shared.HTTP.externalize("/libs/dam/scene7/publishdialog/servlet"),params:{cmd:"setPublishSubfolderControl",integrity:"true",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",title:"Location",autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Path"),allowBlank:false,name:"srcPath",readOnly:true,value:this.basePath}]},E]},listeners:{show:function(){E.getStore().load()
}},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("An error occured while publishing assets"))
}});
D.buttons=[{text:CQ.I18n.getMessage("Publish"),cls:"cq-btn-publish",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Publish To Scene7"),msg:CQ.I18n.getMessage("Please wait until the publish statistics are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return 
}var G=this;
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Publish To Scene7"),CQ.I18n.getMessage("Do you really want to publish assets to Scene7?"),function(H){if(H=="yes"){G.ok.call(G)
}})
}},CQ.Dialog.CANCEL];
D.width=600;
D.height=470;
CQ.wcm.Scene7PublishDialog.superclass.constructor.call(this,D);
this.on("beforesubmit",function(){var G=this;
G.store.each(function(H){if(H.data.subfolders&&H.data.isfolder){G.addHidden({subfolders:H.data.path})
}});
return true
})
}});
CQ.Ext.reg("s7publishdialog",CQ.wcm.Scene7PublishDialog);
CQ.wcm.Scene7PublishDialog.CheckColumn=function(A){CQ.Ext.apply(this,A);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.Scene7PublishDialog.CheckColumn.prototype={init:function(A){this.grid=A;
this.grid.on("render",function(){var B=this.grid.getView();
B.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(D,C){if(C.className&&C.className.indexOf("x-grid3-cc-"+this.id)!=-1){D.stopEvent();
var B=this.grid.getView().findRowIndex(C);
var A=this.grid.store.getAt(B);
A.set(this.dataIndex,!A.data[this.dataIndex]);
if(A.data.fileCount!=A.data.deepFileCount){A.set("fileCount",A.data.deepFileCount);
A.set("fileSize",A.data.deepFileSize);
A.set("publishStatus",A.data.deepPublishStatus)
}else{A.set("fileCount",A.data.shallowFileCount);
A.set("fileSize",A.data.shallowFileSize);
A.set("publishStatus",A.data.shallowPublishStatus)
}A.dirty=false
}},renderer:function(B,C,A){if(!this.enabledIf||A.data[this.enabledIf]){C.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(B?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return"&nbsp;"
}}};
CQ.wcm.msm.MSM=function(){var CFG_ROLLOUT_MGR="com.day.cq.wcm.msm.api.RolloutManager";
var CFG_ROLLOUT_EXCLUDE_PROPS="rolloutmgr.excludedprops.default";
var CFG_ROLLOUT_EXCLUDE_PARA_PROPS="rolloutmgr.excludedparagraphprops.default";
var serverConfig=null;
var init=function(){var url=CQ.HTTP.externalize("/libs/wcm/msm/content/info.json",false);
var serverResponse=CQ.utils.HTTP.get(url,null,this);
if(CQ.utils.HTTP.isOk(serverResponse)){var data=CQ.Util.eval(serverResponse);
serverConfig=data.config
}};
return{PARAM_SOURCEPATH:"msm:sourcePath",PARAM_TARGETPATH:"msm:targetPath",PARAM_SYNCPATH:"msm:syncPath",PARAM_LIVECOPY_PATH:"msm:liveCopyPath",PARAM_LIVECOPY_BPPATH:"msm:liveCopyBpPath",PARAM_IS_DEEP:"msm:isDeep",PARAM_STATUS:"msm:status",PARAM_TRIGGER:"msm:trigger",PARAM_COMPUTATION_TIME:"msm:computationTime",PARAM_ACTION_CONFIG:"msm:actionConfig",PARAM_IS_CANCELLED:"msm:isCancelled",PARAM_IS_CANCELLED_FOR_CHILDREN:"msm:isCancelledForChildren",PARAM_IS_CANCELLED_ON:"msm:isCancelledOn",PARAM_IS_EDITABLE:"msm:isEditable",PARAM_IS_PAGE:"msm:isPage",PARAM_IS_TARGET_EXISTING:"msm:isTargetExisting",PARAM_IS_TARGET_DELETED:"msm:isTargetDeleted",PARAM_IS_TARGET_MODIFIED:"msm:isTargetModified",PARAM_IS_TARGET_CANCELLED_CHILD:"msm:isTargetCancelledChild",PARAM_IS_TARGET_CANCELLED_PROPERTY:"msm:isTargetCancelledProperty",PARAM_IS_TARGET_MANUALLY_CREATED:"msm:isTargetManuallyCreated",PARAM_IS_TARGET_FROM_DIFFERENT_TREE:"msm:isTargetFromDifferentTree",PARAM_IS_TARGET_SKIPPED:"msm:isTargetSkipped",PARAM_IS_SOURCE_EXISTING:"msm:isSourceExisting",PARAM_IS_SOURCE_DELETED:"msm:isSourceDeleted",PARAM_IS_SOURCE_MODIFIED:"msm:isSourceModified",PARAM_LIVE_RELATIONSHIP:"msm:liveRelationship",PARAM_TARGETS:"msm:targets",PARAM_IS_LIVECOPY:"msm:isLiveCopy",PARAM_IS_IN_BLUEPRINT:"msm:isInBlueprint",PARAM_IS_SOURCE:"msm:isSource",PARAM_IS_INHERITED_CONFIG:"msm:isInheritedConfig",PARAM_IS_ROOT_CONFIG:"msm:isRootConfig",PARAM_PROPERTY_NAME:"msm:propertyName",PARAM_CANCELED_PROPERTIES:"msm:cancelledProperties",PARAM_PROPERTY_INHERITANCE_CANCELED:"cq:propertyInheritanceCancelled",MIXIN_LIVE_RELATIONSHIP:"cq:LiveRelationship",MIXIN_LIVE_SYNC:"cq:LiveSync",MIXIN_LIVE_SYNC_CANCELLED:"cq:LiveSyncCancelled",PARAM_SKIPPED_PAGES:"skippedPage",getSyncTriggerConfig:function(){return new CQ.Ext.form.ComboBox({stateful:false,fieldLabel:CQ.I18n.getMessage("Sync Trigger"),allowBlank:false,defaultValue:"never",value:"never",name:"trigger",cls:"cq-msm-synctrigger",hiddenName:"msm:trigger",displayField:"label",valueField:"id",typeAhead:true,mode:"local",triggerAction:"all",store:new CQ.Ext.data.SimpleStore({fields:["id","label"],data:[["never",CQ.I18n.getMessage("Never")],["rollout",CQ.I18n.getMessage("On Rollout")],["modification",CQ.I18n.getMessage("On Modification")],["publish",CQ.I18n.getMessage("On Activation")],["deactivate",CQ.I18n.getMessage("On Deactivation")]]})})
},getRelationStatus:function(lr){var ret="";
if(lr&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-skipped",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_MODIFIED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-modified-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-modified",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MODIFIED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-modified-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-modified",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-synchronized-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]),CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-synchronized",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]),CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}}else{if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-deleted",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-deleted"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED])){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-new",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-deleted",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-deleted"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-skipped",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-never-created",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-cancelled",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-cancelled"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}return""
},getSyncActionsConfig:function(checkInheritance){var actions=new Array();
for(var i=0;
i<CQ.wcm.msm.MSM.ACTIONS.length;
i++){var config=CQ.Util.applyDefaults({},CQ.wcm.msm.MSM.ACTIONS[i]);
if(checkInheritance){config=CQ.Util.applyDefaults(config,{listeners:{loadcontent:function(path,rec){if(rec.data[this.actionName]&&rec.data[this.actionName]["inherited"]){this.disable()
}else{this.enable()
}}}})
}actions.push(config)
}return new CQ.Ext.form.FieldSet({title:CQ.I18n.getMessage("Sync Actions"),autoHeight:true,stateful:false,defaults:{anchor:"95%"},items:actions})
},getRolloutInfo:function(lr,rolloutPath){var info={text:"",shortText:"",css:""};
if(lr&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS]){if(rolloutPath&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH].indexOf(rolloutPath)!=0){info.text=CQ.I18n.getMessage("Target page inherits from a different Blueprint. Rollout page {0} to update target page.",CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]));
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}else{if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){info.text=CQ.I18n.getMessage("Target page contains paragraphs or properties for which Live Copy has been canceled. These paragraphs or properties will not be updated, any others will be replaced.");
info.shortText=CQ.I18n.getMessage("Partial update");
info.css="msm-rollout-plan-info-partial-update"
}else{info.text=CQ.I18n.getMessage("Target page will be fully updated.");
info.shortText=CQ.I18n.getMessage("Full update");
info.css="msm-rollout-plan-info-update"
}}else{if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){info.text=CQ.I18n.getMessage("Target page will be deleted from Live Copy");
info.shortText=CQ.I18n.getMessage("Delete");
info.css="msm-rollout-plan-info-delete"
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED])){info.text=CQ.I18n.getMessage("Page has been created into Live Copy. No rollout action.");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]){if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]){info.text=CQ.I18n.getMessage("Target page does not exist and will be created in Live Copy.");
info.shortText=CQ.I18n.getMessage("Create");
info.css="msm-rollout-plan-info-create"
}else{info.text=CQ.I18n.getMessage("Target page has been manually deleted. To restore it, use the version manager");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}}}}}}else{info.text=CQ.I18n.getMessage("Live Copy has been cancelled for target page. No rollout action");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}}if(lr[CQ.wcm.msm.MSM.PARAM_TRIGGER]=="never"){info.shortText=CQ.I18n.getMessage("Rollout never triggered")
}}return info
},toHTML:function(lr){var html="<div>";
if(lr){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){html+="cancelled"
}else{html+="sync"
}}return html+"</div>"
},isExcludedProperty:function(name){if(!serverConfig){init()
}var excludes=serverConfig[CFG_ROLLOUT_MGR][CFG_ROLLOUT_EXCLUDE_PROPS];
for(var i=0;
i<excludes.length;
i++){if(name.match(excludes[i])){return true
}}excludes=serverConfig[CFG_ROLLOUT_MGR][CFG_ROLLOUT_EXCLUDE_PARA_PROPS];
for(var i=0;
i<excludes.length;
i++){if(name.match(excludes[i])){return true
}}return false
}}
}();
CQ.wcm.msm.MSM.UpdateContentAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Update Content"),name:"msm:actionUpdate/status",actionName:"msm:actionUpdate",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Enables content update"),defaultValue:false};
CQ.wcm.msm.MSM.NotifyAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Enable Notification"),name:"msm:actionNotify/target",actionName:"msm:actionNotify",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Enables notification"),defaultValue:false};
CQ.wcm.msm.MSM.WorkflowAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Start Workflow"),name:"actionWorkflow",cls:"cq-msm-action-workflow",hiddenName:"msm:actionWorkflow/target",actionName:"msm:actionWorkflow",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",emptyText:"",minChars:0,editable:true,lazyInit:false,displayField:"label",valueField:"wid",fieldDescription:CQ.I18n.getMessage("Select a workflow to be started on synchronization"),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-workflow-list">','<div class="cq-msm-list-entry cq-msm-workflow-list-entry">{[values.label==""? values.wid: values.label]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-workflow-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({root:"workflows",totalProperty:"results",id:"wid",fields:["wid","label"]})}),defaultValue:""};
CQ.wcm.msm.MSM.MandatoryAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Read only for"),name:"actionMandatory",cls:"cq-msm-action-mandatory",hiddenName:"msm:actionMandatory/target",actionName:"msm:actionMandatory",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will have read-only access on the copies."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-list">','<div class="cq-msm-list-entry cq-msm-mandatory-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.SourceVersionAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Create Blueprint version"),name:"msm:actionSourceVersion/status",actionName:"msm:actionSourceVersion",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Creates a version of the Blueprint page"),defaultValue:false};
CQ.wcm.msm.MSM.TargetVersionAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Create Live Copy version"),name:"msm:actionTargetVersion/status",actionName:"msm:actionTargetVersion",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Creates a version of the Live Copy page"),defaultValue:false};
CQ.wcm.msm.MSM.MandatoryStructureAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Mandatory Structure for"),name:"actionMandatoryStructure",hiddenName:"msm:actionMandatoryStructure/target",actionName:"msm:actionMandatoryStructure",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will not be able to modify the Live Copy structure."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-structure-list">','<div class="cq-msm-list-entry cq-msm-mandatory-structure-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-structure-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.MandatoryContentAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Mandatory Content for"),name:"actionMandatoryStructure",hiddenName:"msm:actionMandatoryContent/target",actionName:"msm:actionMandatoryContent",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will not be able to modify the Live Copy content."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-structure-list">','<div class="cq-msm-list-entry cq-msm-mandatory-structure-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-structure-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.filterPagePath=function(A){if(!A){return""
}if(A.lastIndexOf("/jcr:content")==A.length-12){return A.substring(0,A.length-12)
}return A
};
CQ.wcm.msm.MSM.ACTIONS=[CQ.wcm.msm.MSM.UpdateContentAction,CQ.wcm.msm.MSM.NotifyAction,CQ.wcm.msm.MSM.WorkflowAction,CQ.wcm.msm.MSM.MandatoryAction];
CQ.wcm.msm.MSM.Texts={};
CQ.wcm.msm.MSM.Texts.LR={};
CQ.wcm.msm.MSM.Texts.LR.States={"msm-status-synchronized":{text:CQ.I18n.getMessage("Live Copy page is up-to-date with its Blueprint page."),textWithParams:CQ.I18n.getMessage("Live Copy page {1} is up-to-date with its Blueprint page {0}."),iconClass:"msm-status-synchronized"},"msm-status-synchronized-cancelled-par":{text:CQ.I18n.getMessage("Live Copy page is up-to-date with its Blueprint page and it contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {1} is up-to-date with its Blueprint page {0} and it contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-synchronized-cancelled-par"},"msm-status-src-modified":{text:CQ.I18n.getMessage("Blueprint page has been modified since last rollout."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been modified since last rollout."),iconClass:"msm-status-src-modified"},"msm-status-src-modified-cancelled-par":{text:CQ.I18n.getMessage("Blueprint page has been modified since last rollout. Live Copy page contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been modified since last rollout. Live Copy page {1} contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-src-modified-cancelled-par"},"msm-status-target-modified":{text:CQ.I18n.getMessage("Live Copy page has been modified."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been modified."),iconClass:"msm-status-target-modified"},"msm-status-target-modified-cancelled-par":{text:CQ.I18n.getMessage("Live Copy page has been modified since last rollout and it contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been modified since last rollout and it contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-target-modified-cancelled-par"},"msm-status-new":{text:CQ.I18n.getMessage("Page has been locally created inside Live Copy."),textWithParams:CQ.I18n.getMessage("Page {0} has been locally created inside Live Copy."),iconClass:"msm-status-new"},"msm-status-target-deleted":{text:CQ.I18n.getMessage("Live Copy page has been deleted."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been deleted."),iconClass:"msm-status-target-deleted"},"msm-status-never-created":{text:CQ.I18n.getMessage("Live Copy page does not exist (it has never been created and deleted). It will be created during next rollout process."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} does not exist (it has never been created and deleted). It will be created during next rollout process."),iconClass:"msm-status-never-created"},"msm-status-cancelled":{text:CQ.I18n.getMessage("Live Copy page inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} inheritance has been cancelled."),iconClass:"msm-status-cancelled"},"msm-status-src-deleted":{text:CQ.I18n.getMessage("Blueprint page has been deleted."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been deleted."),iconClass:"msm-status-src-deleted"},"msm-status-skipped":{text:CQ.I18n.getMessage("Live Copy page does not exist and is skipped from rollout process."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} does not exist and is skipped from rollout process."),iconClass:"msm-status-skipped"}};
CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams=function(B,A){return CQ.Util.patchText(CQ.wcm.msm.MSM.Texts.LR.States[B]["textWithParams"],A)
};
CQ.wcm.msm.MSM.Texts.LR.Statuses={"msm:isCancelled":CQ.I18n.getMessage("Cancelled inheritance"),"msm:isCancelledForChildren":CQ.I18n.getMessage("Cancelled inheritance for children"),"msm:isEditable":CQ.I18n.getMessage("Editable"),"msm:isPage":CQ.I18n.getMessage("Page relation"),"msm:isSourceExisting":CQ.I18n.getMessage("Blueprint page existing"),"msm:isSourceModified":CQ.I18n.getMessage("Blueprint page modified"),"msm:isSourceDeleted":CQ.I18n.getMessage("Blueprint page deleted"),"msm:isTargetExisting":CQ.I18n.getMessage("Live Copy page existing"),"msm:isTargetModified":CQ.I18n.getMessage("Live Copy page modified"),"msm:isTargetDeleted":CQ.I18n.getMessage("Live Copy page deleted"),"msm:isTargetManuallyCreated":CQ.I18n.getMessage("Live Copy page locally created"),"msm:isTargetCancelledChild":CQ.I18n.getMessage("Live Copy page has children for which inheritance has been cancelled"),"msm:isTargetCancelledProperty":CQ.I18n.getMessage("Live Copy page has properties or children with properties for which inheritance has been cancelled"),"msm:isTargetFromDifferentTree":CQ.I18n.getMessage("Live Copy page is a Live Copy from different Blueprint"),"msm:isTargetSkipped":CQ.I18n.getMessage("Live Copy page skipped")};
CQ.wcm.msm.MSM.Commands={};
CQ.wcm.msm.MSM.Commands.rollout=function(F,E,A,C,D,B){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:D,params:{_charset_:"utf-8",cmd:"rollout",path:CQ.wcm.msm.MSM.filterPagePath(F),"msm:targetPath":CQ.wcm.msm.MSM.filterPagePath(E),type:A?"deep":"page",reset:C},scope:B})
};
CQ.wcm.msm.MSM.Commands.rolloutLiveCopy=function(E,D,A,C,B){CQ.wcm.msm.MSM.Commands.rollout(E,D,A,false,C,B)
};
CQ.wcm.msm.MSM.Commands.resetLiveCopy=function(E,D,A,C,B){CQ.wcm.msm.MSM.Commands.rollout(E,D,A,true,C,B)
};
CQ.wcm.msm.MSM.Commands.recreateLiveCopy=function(D,C,B,A){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:function(){CQ.wcm.msm.MSM.Commands.rollout(D,C,true,true,B,A)
},params:{path:C,_charset_:"utf-8",cmd:"deletePage",force:true}})
};
CQ.wcm.msm.MSM.Commands.detachLiveCopy=function(C,B,A){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(C+".msm.conf"),method:"POST",callback:B,params:{_charset_:"utf-8",removeLCMarkers:true},scope:A})
};
CQ.wcm.msm.MSM.Commands.attachLiveCopy=function(E,D,A,C,B){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(D+".msm.conf"),method:"POST",callback:C,params:{_charset_:"utf-8",cmd:"attach",srcPath:E,deep:A},scope:B})
};
CQ.wcm.msm.MSM.Commands.flushServerCaches=function(B,A){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/wcm/msm/content/commands/servercaches.conf"),method:"POST",callback:B,params:{_charset_:"utf-8",cmd:"flush"},scope:A})
};
CQ.wcm.msm.MSM.Commands.addSkippedPage=function(E,A,D,B){var C={cmd:"append"};
C[CQ.wcm.msm.MSM.PARAM_SKIPPED_PAGES]=A;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(E+".skippedpages.json"),method:"POST",callback:D,params:C,scope:B})
};
CQ.wcm.msm.MSM.Commands.removeSkippedPage=function(E,A,D,B){var C={cmd:"remove"};
C[CQ.wcm.msm.MSM.PARAM_SKIPPED_PAGES]=A;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(E+".skippedpages.json"),method:"POST",callback:D,params:C,scope:B})
};
CQ.wcm.msm.MSM.Commands.skipLiveCopy=function(E,D,B){var C=E.substring(0,E.lastIndexOf("/"));
var A=E.substring(E.lastIndexOf("/")+1);
CQ.wcm.msm.MSM.Commands.addSkippedPage(C,A,D,B)
};
CQ.wcm.msm.MSM.Commands.unskipLiveCopy=function(E,D,B){var C=E.substring(0,E.lastIndexOf("/"));
var A=E.substring(E.lastIndexOf("/")+1);
CQ.wcm.msm.MSM.Commands.removeSkippedPage(C,A,D,B)
};
CQ.wcm.msm.MSM.Commands.getCreateLiveCopyDialogConfig=function(B){var A=new CQ.form.Selection({name:"missingPage",fieldLabel:CQ.I18n.getMessage("Missing pages"),options:[],type:"checkbox",fieldDescription:CQ.I18n.getMessage("Missing pages are optional pages which were not selected during Live Copy creation, deleted pages or newly created pages on Blueprint.")});
var C=new CQ.Ext.data.JsonStore({proxy:new CQ.Ext.data.HttpProxy({url:CQ.HTTP.externalize(B+".missingpages.json")}),fields:["path","name","title"]});
C.load({callback:function(D,F,I){if(D&&D.length){var F=[];
for(var G=0;
G<D.length;
G++){var E=D[G].get("name");
var H=D[G].get("title");
F.push({value:E,text:H})
}A.setOptions(F)
}else{A.findParentByType("dialogfieldset").hide();
A.findParentByType("dialogfieldset").nextSibling().setTitle(CQ.I18n.getMessage("Choose Live Copy source"));
A.findParentByType("dialogfieldset").nextSibling().expand()
}}});
return createDialog={xtype:"dialog",id:CQ.Util.createId("cq-livecopydialog"),title:CQ.I18n.getMessage("Create Live Copy"),formUrl:"/bin/wcmcommand",params:{cmd:"createLiveCopy",_charset_:"utf-8"},height:500,items:{xtype:"tabpanel",items:[{xtype:"panel",title:CQ.I18n.getMessage("Source selection"),items:[{collapsed:false,collapsible:true,xtype:"dialogfieldset",title:CQ.I18n.getMessage("Select missing pages..."),items:[A,{fieldLabel:CQ.I18n.getMessage("Exclude sub pages"),xtype:"selection",type:"checkbox",value:false,name:"excludeSubPages",fieldDescription:CQ.I18n.getMessage("If checked, sub pages of selected page above will not be copyied and it will be possible to select them individually as new Live Copy.")}]},{collapsed:true,collapsible:true,xtype:"dialogfieldset",title:CQ.I18n.getMessage("... or choose Live Copy source"),items:[{name:"destPath",value:B,xtype:"hidden"},{fieldLabel:CQ.I18n.getMessage("Title"),name:"title",xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Name"),name:"label",vtype:"itemname",xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Live Copy From"),name:"srcPath",xtype:"pathfield"},{fieldLabel:CQ.I18n.getMessage("Exclude sub pages"),xtype:"selection",type:"checkbox",value:false,name:"shallow",fieldDescription:CQ.I18n.getMessage("If checked, sub pages of selected page above will not be copyied and it will be possible to select them individually as new Live Copy.")}]}]},{xtype:"panel",title:CQ.I18n.getMessage("Sync config"),items:[CQ.Util.formatData({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")})]}]},buttons:CQ.Dialog.OKCANCEL,okText:CQ.I18n.getMessage("Create")}
};
CQ.wcm.msm.MSM.Commands.createLiveCopy=function(H,B,F,A,E,D,G,C){A=A||H.substring(H.lastIndexOf("/")+1);
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:G,params:{_charset_:"utf-8",cmd:"createLiveCopy",srcPath:CQ.wcm.msm.MSM.filterPagePath(H),destPath:B,label:A,shallow:E||false,before:F,"cq:rolloutConfigs":D},scope:C})
};
CQ.wcm.msm.LiveCopyProperties=CQ.Ext.extend(CQ.CustomContentPanel,{RESET_NAME:"resetConfig",constructor:function(A){A=(!A?{}:A);
this.actionConfigTextField=new CQ.Static({fieldLabel:CQ.I18n.getMessage("Rollout Config"),bottommargin:true,html:""});
this.isInheritedConfigField=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_IS_INHERITED_CONFIG});
this.isRootConfigField=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_IS_ROOT_CONFIG});
this.isResetConfigField=new CQ.Ext.form.Hidden({name:this.RESET_NAME,value:false});
this.isCancelled=new CQ.form.Selection({fieldLabel:CQ.I18n.getMessage("Live Copy suspended"),name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED,type:"checkbox",listeners:{selectionchanged:{fn:this.setActivityState,scope:this}}});
this.isCanceledPath=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_ON,value:""});
this.isCanceledText=new CQ.Ext.form.DisplayField({name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_ON,hidden:true});
this.rolloutConfigs=CQ.Util.build({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")});
var C={stateful:false,title:CQ.I18n.getMessage("Live Copy"),extensionGet:".msm.json",extensionPost:".msm.conf",items:[{fieldLabel:CQ.I18n.getMessage("Live Copy from"),name:CQ.wcm.msm.MSM.PARAM_SOURCEPATH,readOnly:true,xtype:"textfield"},this.isCancelled,{hidden:true,fieldLabel:"&nbsp;",fieldDescription:CQ.I18n.getMessage("suspend for children pages"),name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN,type:"checkbox",xtype:"selection"},this.isCanceledText,this.actionConfigTextField,this.rolloutConfigs,this.isCanceledPath,this.isInheritedConfigField,this.isRootConfigField,this.isResetConfigField]};
CQ.Util.applyDefaults(A,C);
var B={trackLabels:true,type:"form"};
if(A.layout=="form"){A.layout=B
}else{if(A.layout&&A.layout.type=="form"){CQ.Util.merge(A.layout,{layout:B})
}}CQ.wcm.msm.LiveCopyProperties.superclass.constructor.call(this,A)
},initComponent:function(){CQ.wcm.msm.LiveCopyProperties.superclass.initComponent.call(this);
var A=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(C){var B=CQ.WCM.getPage(this.path);
if(!B.isLiveCopy()){A.disable()
}},this.parentDialog)
}},this);
this.on("loadcontent",this.setActivityState,this)
},computeUrlGET:function(A){this.path=A.lastIndexOf("/jcr:content")==A.length-12?A.substring(0,A.lastIndexOf("/jcr:content")):A;
if(this.pathGet||this.urlGET){this.urlGet=this.pathGet||this.urlGET
}else{this.urlGet=this.path
}if(this.extensionGet||this.urlExtensionGET){this.urlGet+=this.extensionGet||this.urlExtensionGET
}},resetConfig:function(){this.isResetConfigField.setValue(true);
var B=this.path;
if(!this.path){var A=this.findParentByType("dialog");
if(A){B=A.path
}}if(B){this.computeUrlPOST(B);
this.submitPanel(this.urlPOST)
}this.loadContent()
},setActivityState:function(){var B=this.find("name",CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN);
if(B.length){B=B[0]
}else{B=""
}var E=this.isCancelled&&"true"==this.isCancelled.getValue();
if(E){if(this.rolloutConfigs){this.rolloutConfigs.hide()
}this.actionConfigTextField.hide();
var C;
if(this.isCanceledPath){C=this.isCanceledPath.getValue()
}if(C&&C!=this.path){this.isCancelled.disable();
this.isCanceledText.setValue(CQ.I18n.getMessage('The Live Copy has been suspended on a parent Page.<br>No action will be performed on a Roll Out<br>You can enable the LiveCopy on the parent Page: [<a target="_blank" href="{0}.html">{1}</a>]',[C,C]));
if(B){B.hide()
}}else{this.isCanceledText.setValue(CQ.I18n.getMessage("The Live Copy has been suspended <br>No action will be performed on a Roll Out"));
if(B){B.show()
}}this.isCanceledText.show()
}else{if(B){B.hide()
}this.isCanceledText.hide();
var A=("true"==this.isInheritedConfigField.getValue());
var D=("true"==this.isRootConfigField.getValue());
var F="";
if(A){F+=CQ.I18n.getMessage("The sync configuration is inherited from a parent page. Changes made below will cancel the inheritance and store the configuration on the current page.")
}else{if(D){F+=CQ.I18n.getMessage("The sync configuration is stored on the current page, which is the root page of the Live Copy. Child pages of the current page inherit this configuration, unless they have configurations of their own.")
}else{var G=" var cmp = CQ.Ext.getCmp('"+this.id+"');";
G+=" cmp.resetConfig();";
F+=CQ.I18n.getMessage("The sync configuration is stored on the current page. You can {0} reset the configuration {1} in order to inherit the configuration from a parent page.",['<a href="#" onClick="'+G+'">',"</a>"])
}}F+="<p></p>";
F+=CQ.I18n.getMessage("Note: Disabled actions are inherited from the blueprint and cannot be modified.");
this.actionConfigTextField.updateHtml(F);
if(this.rolloutConfigs){this.rolloutConfigs.show()
}this.actionConfigTextField.show();
if(this.rolloutConfigs.label){this.rolloutConfigs.label.hide()
}}}});
CQ.Ext.reg("livecopyproperties",CQ.wcm.msm.LiveCopyProperties);
CQ.wcm.msm.RolloutWizard=CQ.Ext.extend(CQ.Dialog,{hideComponents:false,constructor:function(D){var C=new Array();
C.push({text:CQ.I18n.getMessage("Rollout entire page"),value:"page"});
C.push({text:CQ.I18n.getMessage("Rollout page and all sub pages"),value:"deep"});
if(!D.hideComponents){C.push({text:CQ.I18n.getMessage("Rollout selected components"),value:"selected"});
C.push({text:CQ.I18n.getMessage("Delete + rollout selected components"),value:"delete"})
}this.rolloutType=new CQ.form.Selection({name:"type",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Rollout Scope"),type:"radio",value:"page",options:C});
this.backgroundExec=new CQ.Ext.form.Checkbox({name:"background",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Background rollout"),fieldDescription:CQ.I18n.getMessage("If checked, rollout is executed as a background task"),value:false});
var B=this;
var A={title:CQ.I18n.getMessage("Rollout: {0}",D.path),height:350,items:{xtype:"panel",layout:"form",items:[this.rolloutType,this.backgroundExec]},buttons:[{text:CQ.I18n.getMessage("Next"),disabled:false,handler:function(){var G=B.rolloutType.getValue();
var F=B.backgroundExec.getValue();
var E=[];
if(G=="selected"||G=="delete"){var H=CQ.WCM.getContentWindow().CQ.WCM.getSelection();
H.each(function(){if(this.path&&this.path.charAt(this.path.length-1)!="*"){E.push(this.path)
}});
if(E.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one component."));
return 
}}var J={path:B.path,params:{type:G,paras:E}};
if(F){J.params["sling:bg"]=true
}var I=new CQ.wcm.msm.RolloutPlan(J);
I.show();
B.hide()
}},CQ.Dialog.CANCEL]};
D=CQ.Util.applyDefaults(D,A);
CQ.wcm.msm.RolloutWizard.superclass.constructor.call(this,D)
},initComponent:function(){CQ.wcm.msm.RolloutWizard.superclass.initComponent.call(this)
}});
CQ.Ext.reg("rolloutwizard",CQ.wcm.msm.RolloutWizard);
CQ.wcm.msm.RolloutPlan=CQ.Ext.extend(CQ.Dialog,{auditLogDialog:null,constructor:function(F){var D=CQ.I18n.getMessage("Current page will be rolled out to the following target pages. Check targets which should be updated and press the rollout button.");
if(F.params){if(F.params.type=="deep"){D=CQ.I18n.getMessage("Current page and all its child page will be rolled out to the following target pages. Check targets which should be updated and press the rollout button.")
}else{if(F.params.type=="selected"){D=CQ.I18n.getMessage("Selected components will be rolled out into the following target pages. Check targets which should be updated and press the rollout button.")
}else{if(F.params.type=="delete"){D=CQ.I18n.getMessage("Selected components will be deleted and rolled out into the following target pages. Check targets which should be updated and press the rollout button.")
}else{F.params.type="page"
}}}}else{F.params={type:"page"}
}this.rolloutType=new CQ.Static({text:D,bottommargin:true});
var G=new CQ.wcm.msm.RolloutPlan.CheckColumn({rolloutPath:F.path,name:"isTarget",header:"",dataIndex:"isTarget",width:20});
this.columnModel=new CQ.Ext.grid.ColumnModel([G,{id:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,header:CQ.I18n.getMessage("Live Copy Path"),dataIndex:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,width:220,renderer:function(K,J,I){var H=K;
if(K.lastIndexOf("/content")==0){H=K.substring(8)
}if(I.get(CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP)[CQ.wcm.msm.MSM.PARAM_SYNCPATH]){H+="<span style='color:#d6d6d6'>"+I.get(CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP)[CQ.wcm.msm.MSM.PARAM_SYNCPATH]+"</span>"
}return'<div title="Target Path: '+I.get(CQ.wcm.msm.MSM.PARAM_TARGETPATH)+'">'+H+"</div>"
}},{header:CQ.I18n.getMessage("Action"),dataIndex:"action",width:120,renderer:function(J,I,H){return"<div class='"+J.css+"' title='"+J.text+"' alt='"+J.text+"'>"+J.shortText+"</div>"
}},{header:"Status",dataIndex:"executionStatus",width:80,renderer:function(K,J,H){var I="";
var L="";
switch(K){case"ok":I="msm-rollout-plan-rolledout";
L=CQ.I18n.getMessage("Rollout successful");
break;
case"bg":I="msm-rollout-plan-rolloutbackground";
L=CQ.I18n.getMessage("Rollout started in background");
break;
case"rolling":I="msm-rollout-plan-rollingout";
L=CQ.I18n.getMessage("Executing rollout");
break;
case"error":I="msm-rollout-plan-rollouterror";
L=CQ.I18n.getMessage("Error during rollout");
break;
case"norollout":I="msm-rollout-plan-norollout";
L=CQ.I18n.getMessage("No rollout executed");
break;
default:I="";
L=CQ.I18n.getMessage("Press Rollout button to execute rollout process")
}return"<div class='"+I+"' title='"+L+"' alt='"+L+"'>&#160;</div>"
}}]);
this.columnModel.defaultSortable=true;
var E=CQ.HTTP.externalize(F.path)+".blueprint.json";
E=CQ.HTTP.addParameter(E,"returnRelationships","true");
E=CQ.HTTP.addParameter(E,"advancedStatus","true");
var B=new CQ.Ext.data.JsonStore({url:E,root:CQ.wcm.msm.MSM.PARAM_TARGETS,fields:[{name:"isTarget"},{name:"action"},{name:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,convert:function(H,I){return I[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH]
}},{name:CQ.wcm.msm.MSM.PARAM_TARGETPATH},{name:CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP}],sortInfo:{field:CQ.wcm.msm.MSM.PARAM_TARGETPATH,direction:"ASC"},listeners:{load:function(K,J,L){for(var M=0;
M<J.length;
M++){var H=J[M];
H.beginEdit();
var I=H.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
var O=CQ.wcm.msm.MSM.getRolloutInfo(I,F.path);
H.set("action",O);
var N=true;
if(I[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]){N=false
}H.set("isTarget",N);
H.commit()
}}}});
this.lcPathFilter=new CQ.Ext.form.TwinTriggerField({style:{marginLeft:"5px"},width:206,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,enableKeyEvents:true,onTrigger1Click:function(){this.reset();
C.applyFilter(this,0)
},onTrigger2Click:function(){C.applyFilter(this,0)
},listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Live Copies path filter"),text:CQ.I18n.getMessage("Filter the Live Copy to display in the grid (by path substring)"),autoHide:true})
},specialkey:function(H,I){if(I.getKey()==I.ENTER){C.applyFilter(H,0)
}},keyup:function(H){C.applyFilter(H,3)
}},hideTrigger:false});
this.targetGrid=new CQ.Ext.grid.EditorGridPanel({tbar:{imtes:[]},store:B,cm:this.columnModel,width:600,height:200,autoExpandColumn:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,frame:false,loadMask:{store:B,removeMask:true},listeners:{render:function(I){var H=I.getStore();
H.load.defer(20,H);
I.getTopToolbar().add(new CQ.Ext.form.Checkbox({checked:true,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Select / unselect all"),autoHide:true})
},check:{fn:function(K,J){this.each(function(L){L.set("isTarget",J)
});
this.commitChanges()
},scope:H}}}));
I.getTopToolbar().add(C.lcPathFilter)
}}});
G.init(this.targetGrid);
var C=this;
var A={title:CQ.I18n.getMessage("Rollout: {0}",F.path),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"rollout",_charset_:"utf-8",path:F.path},height:350,items:{xtype:"panel",layout:"form",items:[this.rolloutType,this.targetGrid]},buttons:[{text:CQ.I18n.getMessage("Audit log"),disabled:false,handler:function(I,H){if(C.auditLogDialog==null){C.auditLogDialog=CQ.WCM.getDialog("/libs/wcm/msm/content/auditlogdialog")
}C.auditLogDialog.loadContent("/bin/msm/audit.json");
C.auditLogDialog.show()
}},{text:CQ.I18n.getMessage("Rollout"),disabled:false,handler:function(P,S){P.disable();
var Q=C.params.type;
var H=C.formPanel.form.url;
var R=C.targetGrid.store;
var J=R.getRange();
for(var N=0;
N<J.length;
N++){var M=J[N];
var I=M.data.isTarget;
var L=M.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH];
var O=M.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
if(I&&O[CQ.wcm.msm.MSM.PARAM_TRIGGER]!="never"&&!O[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){var K=C.params;
K[CQ.wcm.msm.MSM.PARAM_TARGETPATH]=L;
M.beginEdit();
M.set("executionStatus","rolling");
M.endEdit();
var T=function(W,U,X,Y){var V=this.record;
V.beginEdit();
if(CQ.utils.HTTP.isOk(Y)){V.set("executionStatus","ok")
}else{if(!Y.headers.Status&&CQ.utils.HTTP.isOkStatus(X.status)){V.set("executionStatus","bg")
}else{V.set("executionStatus","error");
CQ.Notification.notify(CQ.I18n.getMessage("Rollout failed: {0}",V.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH],"{0} is a placeholder for additional error text"),X.status+" "+X.statusText)
}}V.commit();
if(R.findBy(function(Z){return Z.dirty
})<0){P.enable();
P.setText(CQ.I18n.getMessage("Close"));
P.setHandler(function(){C.close();
if(Q=="delete"){var Z=CQ.HTTP.externalize(C.path+".html");
Z=CQ.HTTP.noCaching(Z);
CQ.Util.reload(CQ.WCM.getContentWindow(),Z)
}})
}};
CQ.utils.HTTP.post(H,T,K,{record:M},true)
}else{M.beginEdit();
M.set("executionStatus","norollout");
M.commit()
}}}},CQ.Dialog.CANCEL]};
F=CQ.Util.applyDefaults(F,A);
CQ.wcm.msm.RolloutPlan.superclass.constructor.call(this,F)
},isBackgroundJobResponse:function(A){return !(CQ.HTTP.isOkStatus(A))
},initComponent:function(){CQ.wcm.msm.RolloutPlan.superclass.initComponent.call(this)
},applyFilter:function(C,A){var D=C.getValue();
var B=this.targetGrid.getStore();
if(!D){B.clearFilter();
C.getTrigger(0).hide()
}else{C.getTrigger(0).show();
if(D.length>A){B.filter(CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,"/"+D,true)
}}}});
CQ.Ext.reg("rolloutplan",CQ.wcm.msm.RolloutPlan);
CQ.wcm.msm.RolloutPlan.CheckColumn=function(A){CQ.Ext.apply(this,A);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.msm.RolloutPlan.CheckColumn.prototype={init:function(A){this.grid=A;
this.grid.on("render",function(){var B=this.grid.getView();
B.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(D,C){if(C.className&&C.className.indexOf("x-grid3-cc-"+this.id)!=-1){D.stopEvent();
var B=this.grid.getView().findRowIndex(C);
var A=this.grid.store.getAt(B);
A.set(this.dataIndex,!A.data[this.dataIndex]);
A.commit()
}},renderer:function(D,C,A){if(D===""){var B=A.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
if(B[CQ.wcm.msm.MSM.PARAM_SOURCEPATH].indexOf(this.rolloutPath)!=0){return""
}if(B[CQ.wcm.msm.MSM.PARAM_TRIGGER]!="never"&&!B[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(B[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||(B[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!B[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&B[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED])){return""
}if(!D){return this.getCheckbox(false,C)
}else{return this.getCheckbox(true,C)
}}else{return""
}}else{return this.getCheckbox(D,C)
}},getCheckbox:function(B,A){A.css+=" x-grid3-check-col-td";
return"<div class='x-grid3-check-col"+(B?"-on":"")+" x-grid3-cc-"+this.id+"'>&#160;</div>"
}};
CQ.wcm.msm.BlueprintConfig=CQ.Ext.extend(CQ.CustomContentPanel,{hideTargets:false,constructor:function(B){B=(!B?{}:B);
var A=new Array();
if(!B.hideTargets){this.targets=new CQ.form.MultiField({fieldLabel:CQ.I18n.getMessage("Current Live Copies"),cls:"cq-currentlivecopies",name:"msm:targets",readOnly:"true",fieldConfig:{width:300}});
A.push(this.targets)
}A.push({xtype:"static",bottommargin:true,text:CQ.I18n.getMessage("Rollout configs can be configured on a blueprint: all Live Copies of this blueprint will inherit these configs.")});
A.push(CQ.Util.formatData({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")}));
var C={stateful:false,extensionGet:".blueprint.json",extensionPost:".blueprint.conf",title:CQ.I18n.getMessage("Blueprint"),items:A};
CQ.Util.applyDefaults(B,C);
CQ.wcm.msm.BlueprintConfig.superclass.constructor.call(this,B)
},initComponent:function(){CQ.wcm.msm.BlueprintConfig.superclass.initComponent.call(this);
var A=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(C){var B=CQ.WCM.getPage(this.path);
if(!B.isInBlueprint()){A.disable()
}},this.parentDialog)
}},this)
}});
CQ.Ext.reg("blueprintconfig",CQ.wcm.msm.BlueprintConfig);
CQ.wcm.msm.BlueprintStatus=CQ.Ext.extend(CQ.Ext.Panel,{url:null,rootPath:null,contextMenus:[],constructor:function(C){C=(!C?{}:C);
C=CQ.Util.applyDefaults(C,{url:"/libs/wcm/msm/content/commands/blueprintstatus.json",rootPath:"",defaultLCFilter:""});
this.url=C.url;
this.rootPath=C.rootPath;
this.lcMaxColumns=CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS;
this.headerStore=this.getHeaderStore(this.url,this.rootPath,C.defaultLCFilter);
this.treeContainer=new CQ.Ext.Panel({region:"west",split:true,collapsible:true,collapseMode:"mini",animate:true,hideCollapseTool:true,border:false,width:320});
var B=[CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-cancelled"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-deleted"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]];
this.gridContainer=new CQ.Ext.Panel({region:"center",layout:"fit",border:false,margins:"0 5 0 5"});
var A=new CQ.Ext.Template(['<div class="cq-blueprintstatus-legend-item">','<div class="cq-blueprintstatus-legend-item-icon {iconClass}"></div>','<div class="cq-blueprintstatus-legend-item-text">{text}</div>',"</div>"]);
var E=[];
for(var D=0;
D<B.length;
D++){E.push({xtype:"box",tpl:A,data:B[D]})
}this.legendContainer=new CQ.Ext.Panel({region:"east",layout:"table",layoutConfig:{columns:1},collapsible:true,collapsed:true,collapseMode:"mini",hideCollapseTool:true,split:true,border:false,width:320,title:CQ.I18n.getMessage("Legend"),items:E});
var F={layout:"border",height:600,width:1180,tree:{lines:true,border:false,borderWidth:CQ.Ext.isBorderBox?0:2,cls:"x-column-tree",stateful:false,rootVisible:false,autoScroll:true},grid:{border:false},items:[this.treeContainer,this.gridContainer,this.legendContainer]};
CQ.Util.applyDefaults(C,F);
CQ.wcm.msm.BlueprintStatus.superclass.constructor.call(this,C)
},getBPContextMenu:function(){if(!this.BPContextMenu){this.BPContextMenu=new CQ.Ext.menu.Menu({items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.BPMenu});
this.contextMenus.push(this.BPContextMenu)
}return this.BPContextMenu
},getLCHeaderContextMenu:function(){if(!this.LCHeaderContextMenu){this.LCHeaderContextMenu=new CQ.Ext.menu.Menu({items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCHeaderMenu});
this.contextMenus.push(this.LCHeaderContextMenu)
}return this.LCHeaderContextMenu
},getLCPageContextMenu:function(){if(!this.LCPageContextMenu){this.LCPageContextMenu=new CQ.Ext.menu.Menu({listeners:{beforeshow:function(A){A.items.each(function(C){if(C.disableHandler){for(var B=0;
B<A.data.length;
B++){if(C.disableHandler.call(C,A.data[B])){C.setDisabled(true);
return 
}}C.setDisabled(false)
}})
}},items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCPageMenu});
this.contextMenus.push(this.LCPageContextMenu)
}return this.LCPageContextMenu
},hideContextMenu:function(){for(var A=0;
A<this.contextMenus.length;
A++){this.contextMenus[A].data=null;
this.contextMenus[A].widget=null;
this.contextMenus[A].hide()
}},showContextMenu:function(C,G){this.hideContextMenu();
var B=1;
var F=2;
var E=4;
var A=0;
for(var D=0;
D<G.length;
D++){if(G[D]["lr"]){A|=B
}else{if(G[D]["lcPath"]){A|=F
}else{A|=E
}}}var H=null;
if(A==B){H=this.getLCPageContextMenu()
}else{if(A==F){H=this.getLCHeaderContextMenu()
}else{if(A==E){H=this.getBPContextMenu()
}}}if(H){H.data=G;
H.widget=this;
H.showAt(C)
}},getHeaderStore:function(A,B,C){A=CQ.HTTP.addParameter(A,"headers",true);
A=CQ.HTTP.addParameter(A,"rootPath",B);
A=CQ.HTTP.addParameter(A,"filter",C||"");
return new CQ.Ext.data.JsonStore({proxy:new CQ.Ext.data.HttpProxy({url:A}),fields:["path","name"]})
},getTree:function(){var B=new Array();
B.push(CQ.Util.applyDefaults({dataIndex:"page",width:300,renderer:function(C,E,F){var D='<div class="cq-msm-bpcell">';
D+=F.text;
D+="</div>";
return D
},listeners:{contextmenu:function(F,D,C){var E={};
E.srcPath=C.node["attributes"]["path"];
this.showContextMenu(F.getXY(),[E]);
F.stopEvent()
},scope:this}},this.initialConfig.treecolumn));
var A=this;
this.bpPathChooser=new CQ.form.PathField({name:"blueprintSource",width:280,value:this.rootPath,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Blueprint path"),text:CQ.I18n.getMessage("Choose the Blueprint root path of the tree"),autoHide:true})
},specialkey:function(D,E){if(E.getKey()==E.ENTER){var C=A.bpPathChooser.getValue();
if(C&&C!=A.rootPath){A.reconfigure(C)
}}}}});
this.tree=new CQ.wcm.msm.BlueprintStatus.Tree(CQ.Util.applyDefaults({columns:B,url:this.url,rootFilter:this.rootFilter,rootPath:this.rootPath,listeners:{click:function(C){A.grid.reload(C.attributes.path)
}},tbar:[this.bpPathChooser,{iconCls:"cq-siteadmin-refresh",handler:function(){var C=this.bpPathChooser.getValue();
if(C&&C!=this.rootPath){this.reconfigure(C)
}else{this.tree.reload()
}},tooltip:{title:CQ.I18n.getMessage("Refresh tree"),text:CQ.I18n.getMessage("Refreshs the parent of the selected page"),autoHide:true},scope:A}]},this.initialConfig.tree));
return this.tree
},getGrid:function(B,J){B=B||"";
if(!J){J=CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS
}var G=[CQ.Util.applyDefaults({header:"Page",dataIndex:"text",width:150})];
var I=["path","text"];
var N=0;
var E=this.headerStore.getRange();
if(E&&E.length>0){N=E.length;
for(var H=0;
H<E.length;
H++){var M=E[H].get("path");
I.push(M);
G.push(CQ.Util.applyDefaults({header:CQ.I18n.getMessage("{0}",E[H].get("name")),dataIndex:M,id:M,tooltip:M,width:25,hidden:H>=J,renderer:function(O){if(O){var Q=CQ.wcm.msm.MSM.getRolloutInfo(O,M);
var P='<div class="cq-msm-lccell">';
P+=CQ.wcm.msm.MSM.getRelationStatus(O);
P+="</div>";
return P
}}},this.initialConfig.treecolumn))
}}var K=[];
var C=(B&&B!="");
var F=this;
this.lcPathFilter=new CQ.Ext.form.TriggerField({name:"lcFilter",width:280,value:B,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Live Copies path filter"),text:CQ.I18n.getMessage("Filter the Live Copy to display in the grid (by path substring)"),autoHide:true})
},specialkey:function(O,P){if(P.getKey()==P.ENTER){F.checkGridReload()
}}},triggerClass:"x-form-clear-trigger",hideTrigger:!C,mimicBlur:function(O){if(this.wrap&&!this.wrap.contains(O.target)&&this.validateBlur(O)){this.triggerBlur()
}},onTriggerClick:function(){this.setValue("");
this.trigger.hide();
F.checkGridReload()
}});
K.push(this.lcPathFilter);
this.displayColumn=new CQ.Ext.form.Label({text:CQ.I18n.getMessage("Display only the first"),style:{"padding-left":"5px","padding-right":"5px"}});
this.lcMaxColumns=N<J?N:J;
this.lcMaxColumnsFilter=new CQ.Ext.form.TextField({name:"lcMaxColumnsFilter",width:20,value:this.lcMaxColumns,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl().parent(),title:CQ.I18n.getMessage("Live Copies default display number"),text:CQ.I18n.getMessage("Display only the x first Live Copies in the grid (you can still add extra Live Copies with the column header menu)"),autoHide:true})
},specialkey:function(O,P){if(P.getKey()==P.ENTER){F.checkGridReload()
}}}});
this.totalColumn=new CQ.Ext.form.Label({text:CQ.I18n.getMessage("out of {0}",N),style:{"padding-left":"5px","padding-right":"5px"}});
if(N>CQ.wcm.msm.BlueprintStatus.DISPLAY_COLUMNS_NUMBER_FITLER){K.push(this.displayColumn);
K.push(this.lcMaxColumnsFilter);
K.push(this.totalColumn)
}K.push({iconCls:"cq-siteadmin-refresh",handler:function(){this.checkGridReload()
},tooltip:{title:CQ.I18n.getMessage("Refresh grid"),text:CQ.I18n.getMessage("Refreshs the relationship statuses of the grid based on the filters"),autoHide:true},scope:this});
K.push("->");
var L=this.legendContainer;
this.legendButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Legend"),enableToggle:true,pressed:!L.collapsed,expandHandler:function(){this.toggle(true)
},collapseHandler:function(){this.toggle(false)
},listeners:{toggle:function(O,P){if(P){L.expand(true)
}else{L.collapse(true)
}}},tooltip:{title:CQ.I18n.getMessage("Legend"),text:CQ.I18n.getMessage("Expands the legend panel"),autoHide:true}});
L.on("collapse",this.legendButton.collapseHandler,this.legendButton);
L.on("expand",this.legendButton.expandHandler,this.legendButton);
this.gridContainer.on("remove",function(){L.un("collapse",this.legendButton.collapseHandler,this.legendButton);
L.un("expand",this.legendButton.expandHandler,this.legendButton)
},this);
K.push(this.legendButton);
var M="";
var D=this.tree.getSelectionModel().getSelectedNode();
if(D&&D.attributes){M=D.attributes.path
}var A=new CQ.wcm.CustomCellSelectionModel();
this.grid=new CQ.Ext.grid.GridPanel(CQ.Util.applyDefaults({id:"cq-blueprintstatus-grid",height:350,cm:new CQ.Ext.grid.ColumnModel(G),sm:A,viewConfig:new CQ.Ext.grid.GridView({}),hasFilter:C,store:new CQ.Ext.data.Store({autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:this.url,method:"GET"}),reader:new CQ.Ext.data.JsonReader({id:"path",fields:I}),baseParams:{rootPath:this.rootPath,filter:B,path:M}}),reload:function(P,O){this.getEl().mask("Loading...");
if(P){if(!this.store.baseParams){this.store.baseParams={}
}this.store.baseParams.path=P
}if(O){if(!this.store.baseParams){this.store.baseParams={}
}this.store.baseParams.filter=O
}this.store.reload({callback:function(){this.getEl().unmask()
},scope:this})
},listeners:{cellcontextmenu:function(P,Z,g,W){var R=P.getSelectionModel();
if(!R.isSelected([Z,g])){R.clearSelections();
R.selectCell([Z,g])
}var a;
var S=F.tree.getSelectionModel().getSelectedNode();
if(S){a=S.attributes
}var Q=R.getSelections();
var U=[];
for(var T=0;
T<Q.length;
T++){var O=Q[T][0];
var Y=Q[T][1];
var V=P.store.getAt(O);
var X={};
if(Y>0){var b=P.getColumnModel().getColumnId(Y);
X.lr=V.data[b];
X.srcPath=X.lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH];
X.targetPath=X.lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH];
if(a){X.parentLr=a[b]
}}else{X.srcPath=V.data["path"]
}U.push(X)
}F.showContextMenu(W.getXY(),U);
W.stopEvent()
},headercontextmenu:function(P,O,R){var S=P.getColumnModel().getColumnId(O);
if(S==O){R.stopEvent();
return 
}var Q={};
Q.lcPath=S;
F.showContextMenu(R.getXY(),Q);
R.stopEvent()
}},columnFilter:B,tbar:K},this.initialConfig.grid));
this.grid.on("viewready",function(){var O=this.grid.getView();
CQ.Ext.fly(O.innerHd).un("click",O.handleHdDown,O);
CQ.Ext.fly(O.innerHd).on("click",function(U,S){if(CQ.Ext.fly(S).hasClass("x-grid3-hd-btn")){U.stopEvent();
var T=this.findHeaderCell(S);
CQ.Ext.fly(T).addClass("x-grid3-hd-menu-open");
var R=this.getCellIndex(T);
this.hdCtxIndex=R;
var Q=this.hmenu.items,P=this.cm;
Q.get("asc").setDisabled(!P.isSortable(R));
Q.get("desc").setDisabled(!P.isSortable(R));
this.hmenu.on("hide",function(){CQ.Ext.fly(T).removeClass("x-grid3-hd-menu-open")
},this,{single:true});
if(R>0){this.hmenu.show(CQ.Ext.fly(S).parent().parent(),"tr")
}else{this.hmenu.show(S,"tl-bl?")
}}},O)
},this);
return this.grid
},checkGridReload:function(){var B=this.lcPathFilter.getValue();
var A=this.lcMaxColumnsFilter.getValue();
if(B!=this.grid.columnFilter){this.grid.columnFilter=B;
this.redrawGrid.defer(10,this,[B])
}else{if(A!=this.lcMaxColumns){this.redrawGrid.defer(10,this,[B,A])
}else{this.grid.reload(null,B)
}}},build:function(){this.treeContainer.add(this.getTree());
this.gridContainer.add(this.getGrid(this.initialConfig.defaultLCFilter));
this.doLayout()
},redrawGrid:function(B,A){B=B||this.grid.columnFilter;
this.gridContainer.getEl().mask();
this.gridContainer.remove(this.grid);
this.headerStore=this.getHeaderStore(this.url,this.rootPath,B);
this.headerStore.load({callback:function(){this.gridContainer.add(this.getGrid(B,A));
this.gridContainer.doLayout();
this.gridContainer.getEl().unmask()
},scope:this})
},reconfigure:function(A){this.rootPath=A;
this.tree.reconfigure(this.rootPath);
this.redrawGrid()
},initComponent:function(){CQ.wcm.msm.BlueprintStatus.superclass.initComponent.call(this);
this.on("render",function(){this.headerStore.load({callback:this.build,scope:this})
},this)
}});
CQ.Ext.reg("blueprintstatus",CQ.wcm.msm.BlueprintStatus);
CQ.wcm.msm.BlueprintStatus.Tree=CQ.Ext.extend(CQ.Ext.tree.TreePanel,{columns:null,constructor:function(A){A=(!A?{}:A);
var B={columns:A.columns,loader:this.buildLoader(A.url,A.rootPath),root:this.buildRootNode(A.rootPath)};
CQ.Util.applyDefaults(A,B);
CQ.wcm.msm.BlueprintStatus.Tree.superclass.constructor.call(this,A)
},buildRootNode:function(A){return new CQ.Ext.tree.AsyncTreeNode({expanded:true,name:A})
},buildLoader:function(A,B){return new CQ.Ext.tree.TreeLoader({dataUrl:A,baseParams:{isRoot:true,isTree:true,rootPath:B},requestMethod:"GET",baseAttrs:{singleClickExpand:true,iconCls:"cq-msm-page",uiProvider:CQ.wcm.msm.BlueprintStatus.ColumnNodeUI},listeners:{beforeload:function(C,D){if(!this.baseParams.isRoot){this.baseParams.path=D.attributes.path
}else{this.baseParams.path=this.baseParams.rootPath
}},load:function(){if(this.baseParams.isRoot){this.baseParams.isRoot=false
}}}})
},initComponent:function(){CQ.wcm.msm.BlueprintStatus.Tree.superclass.initComponent.call(this)
},reconfigure:function(A){this.loader.baseParams.rootPath=A;
this.loader.baseParams.path=A;
this.loader.baseParams.isRoot=true;
this.setRootNode(this.buildRootNode(A))
},setRootNode:function(B){CQ.Ext.destroy(this.root);
if(!B.render){B=this.loader.createNode(B)
}this.root=B;
B.ownerTree=this;
B.isRoot=true;
if(!B.childNodes){B.childNodes=[]
}this.registerNode(B);
if(!this.rootVisible){var A=B.attributes.uiProvider;
B.ui=A?new A(B):new CQ.Ext.tree.RootTreeNodeUI(B)
}if(this.innerCt){this.innerCt.update("");
this.root.render();
if(!this.rootVisible){this.root.renderChildren()
}}return B
},reload:function(){var C=this.getEl().parent();
C.mask("Loading...");
try{var D=this.getSelectionModel().getSelectedNode();
if(D){D=D.parentNode
}var A=this.getRootNode();
if(!D||D==A){if(A.firstChild){D=A.firstChild
}else{D=A
}}D.reload(function(){C.unmask()
},this)
}catch(B){C.unmask()
}}});
CQ.wcm.msm.BlueprintStatus.ColumnNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{focus:CQ.Ext.emptyFn,renderElements:function(D,G,J,M){this.indentMarkup=D.parentNode?D.parentNode.ui.getChildIndent():"";
var N=D.getOwnerTree();
var L=N.columns;
var K=N.borderWidth;
var P=L[0];
var B=['<li class="x-tree-node"><div ext:tree-node-id="',D.id,'" class="x-tree-node-el x-tree-node-leaf ',G.cls,'">','<div class="x-tree-col" style="width:',P.width-K,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',G.icon||this.emptyIcon,'" class="x-tree-node-icon',(G.icon?" x-tree-node-inline-icon":""),(G.iconCls?" "+G.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',G.href?G.href:"#",'" tabIndex="1" ',G.hrefTarget?' target="'+G.hrefTarget+'"':"",">",'<span unselectable="on">',(P.renderer?P.renderer(G[P.dataIndex],D,G):D.text?D.text:G[P.dataIndex]),"</span></a>","</div>"];
for(var F=1,I=L.length;
F<I;
F++){P=L[F];
B.push('<div class="x-tree-col ',(P.cls?P.cls:""),'" style="width:',P.width-K,'px;">','<div class="x-tree-col-text">',(P.renderer?P.renderer(G[P.dataIndex],D,G):G[P.dataIndex]),"</div>","</div>")
}B.push('<div class="x-clear"></div></div>','<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");
if(M!==true&&D.nextSibling&&D.nextSibling.ui.getEl()){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",D.nextSibling.ui.getEl(),B.join(""))
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",J,B.join(""))
}this.elNode=this.wrap.childNodes[0];
if(L[0]["listeners"]){var A=CQ.Ext.get(this.elNode);
var O=L[0]["listeners"]["scope"]||A;
for(var E in L[0]["listeners"]){if(E!="scope"){A.on(E,L[0]["listeners"][E],O,{column:L[0],data:G[L[0].dataIndex],node:D,tree:N,location:"node"})
}}}this.ctNode=this.wrap.childNodes[1];
var H=this.elNode.firstChild.childNodes;
this.indentNode=H[0];
this.ecNode=H[1];
this.iconNode=H[2];
this.anchor=H[3];
this.textNode=H[3].firstChild;
var Q=this.elNode.firstChild.nextSibling;
for(var F=1,I=L.length;
Q&&F<I;
F++){var C=CQ.Ext.get(Q);
if(L[F]["listeners"]){var O=L[F]["listeners"]["scope"]||C;
for(var E in L[F]["listeners"]){if(E!="scope"){C.on(E,L[F]["listeners"][E],O,{column:L[F],data:G[L[F].dataIndex],node:D,tree:N,location:"node"})
}}}Q=Q.nextSibling
}}});
CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS=22;
CQ.wcm.msm.BlueprintStatus.DISPLAY_COLUMNS_NUMBER_FITLER=9;
CQ.wcm.msm.BlueprintStatus.Commands={};
CQ.wcm.msm.BlueprintStatus.Commands.Menus={};
CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCHeaderMenu=[{text:CQ.I18n.getMessage("Live Copy drill down"),handler:CQ.Ext.emptyFn}];
CQ.wcm.msm.BlueprintStatus.Commands.Menus.BPMenu=[{text:CQ.I18n.getMessage("Open page"),handler:function(B){var C=B.parentMenu.data;
for(var A=0;
A<C.length;
A++){var D=CQ.wcm.msm.MSM.filterPagePath(C[A]["srcPath"]);
if(D){CQ.wcm.SiteAdmin.openPage(D,"page",true)
}}}},{text:CQ.I18n.getMessage("Edit blueprint config"),handler:function(B){var C=B.parentMenu.data;
for(var A=0;
A<C.length;
A++){var D=C[A]["srcPath"];
if(D){CQ.wcm.msm.BlueprintStatus.Commands.openBlueprintDialog(D)
}}}},{text:CQ.I18n.getMessage("Rollout"),handler:function(B){var C=B.parentMenu.data;
for(var A=0;
A<C.length;
A++){var D=CQ.wcm.msm.MSM.filterPagePath(C[A]["srcPath"]);
if(D){CQ.wcm.SiteAdmin.openRolloutDialog(D)
}}},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},"-",{text:CQ.I18n.getMessage("View server caches"),handler:function(){CQ.wcm.msm.BlueprintStatus.Commands.openCachesDialog()
}}];
CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCPageMenu=[{text:CQ.I18n.getMessage("Open page"),handler:function(B){var C=B.parentMenu.data;
for(var A=0;
A<C.length;
A++){CQ.wcm.SiteAdmin.openPage(CQ.wcm.msm.MSM.filterPagePath(C[A]["targetPath"]),"page",true)
}},disableHandler:function(A){return !A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
}},{text:CQ.I18n.getMessage("View relationship details"),handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipsDialogs(CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data),A.parentMenu.widget)
}},{text:CQ.I18n.getMessage("View side-by-side with Blueprint"),handler:function(C){var D=C.parentMenu.data;
for(var B=0;
B<D.length;
B++){var A=CQ.wcm.msm.MSM.filterPagePath(D[B]["targetPath"]);
A=CQ.HTTP.addParameter(A,CQ.wcm.ContentFinder.SIDEVIEW_PARAM,CQ.wcm.msm.MSM.filterPagePath(D[B]["srcPath"]));
CQ.wcm.SiteAdmin.openPage(A,"page",true)
}},disableHandler:function(A){return !A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
}},{text:CQ.I18n.getMessage("Rollout"),handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.rolloutLiveCopy(A.parentMenu.widget.grid,A.parentMenu.data,A.parentMenu.widget.tree)
},disableHandler:function(A){return CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(A)||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},"-",{text:CQ.I18n.getMessage("Re-create"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.recreateLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data))
},disableHandler:function(A){return A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||!A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},{text:CQ.I18n.getMessage("Restore"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.restoreLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data))
},disableHandler:function(A){return !A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},{text:CQ.I18n.getMessage("Attach"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.attachLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data))
},disableHandler:function(A){return !(A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING])
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"]["iconClass"]},{text:CQ.I18n.getMessage("Detach"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.detachLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data))
},disableHandler:function(A){return !(!A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING])||A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"]["iconClass"]},{text:CQ.I18n.getMessage("Skip"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.skipLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data),true)
},disableHandler:function(A){return CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(A)||!(!A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&!A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED])
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"]["iconClass"]},{text:CQ.I18n.getMessage("Unskip"),disabled:true,handler:function(A){CQ.wcm.msm.BlueprintStatus.Commands.unskipLiveCopy(A.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(A.parentMenu.data),false)
},disableHandler:function(A){return !A.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]||CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(A)
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]["iconClass"]}];
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipDialog=function(E,H){if(E){var A=CQ.wcm.msm.MSM.filterPagePath(E[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]);
var C=CQ.wcm.msm.MSM.filterPagePath(E[CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
var G="/libs/wcm/msm/content/commands/liverelationshipstatus.json";
G=CQ.HTTP.addParameter(G,"srcPath",A);
G=CQ.HTTP.addParameter(G,"targetPath",C);
var D="/libs/wcm/msm/content/commands/livecopyinheritance.json";
D=CQ.HTTP.addParameter(D,"targetPath",C);
var J=[{collapsed:false,collapsible:true,title:CQ.I18n.getMessage("Blueprint and Live Copy pages"),xtype:"dialogfieldset",labelWidth:200,defaults:{readOnly:true},items:[{name:"srcPath",fieldLabel:CQ.I18n.getMessage("Blueprint path"),xtype:"textfield"},{name:"srcLastModified",fieldLabel:CQ.I18n.getMessage("Blueprint last modified"),xtype:"datetime"},{name:"srcLastModifiedBy",fieldLabel:CQ.I18n.getMessage("Blueprint last modified by"),xtype:"textfield"},{name:"targetPath",fieldLabel:CQ.I18n.getMessage("Live Copy path"),xtype:"textfield"},{name:"targetLastModified",fieldLabel:CQ.I18n.getMessage("Live Copy last modified"),xtype:"datetime"},{name:"targetLastModifiedBy",fieldLabel:CQ.I18n.getMessage("Live Copy last modified by"),xtype:"textfield"},{name:"lastRolledout",fieldLabel:CQ.I18n.getMessage("Last rolled out"),xtype:"datetime"},{name:"lastRolledoutBy",fieldLabel:CQ.I18n.getMessage("Last rolled out by"),xtype:"textfield"}]}];
if(E[CQ.wcm.msm.MSM.PARAM_STATUS]){var B=[];
for(var I in CQ.wcm.msm.MSM.Texts.LR.Statuses){B.push({name:"lr/"+CQ.wcm.msm.MSM.PARAM_STATUS+"/"+I,fieldLabel:CQ.wcm.msm.MSM.Texts.LR.Statuses[I],type:"checkbox",xtype:"selection",optionsConfig:{readOnly:true}})
}J.push({collapsed:true,collapsible:true,title:CQ.I18n.getMessage("Computed statuses"),xtype:"dialogfieldset",labelWidth:400,defaults:{readOnly:true},items:B})
}var F=new CQ.Dialog({width:600,height:500,warnIfModified:false,success:H,items:{xtype:"tabpanel",items:[{xtype:"customcontentpanel",stateful:false,executePost:false,pathGet:CQ.HTTP.externalize(G),title:CQ.I18n.getMessage("Relationship status"),defaults:{readOnly:true},submitPanel:function(){if(!this.disabled){var K=CQ.Util.findFormFields(this.formPanel);
for(var L in K){for(var M=0;
M<K[L].length;
M++){K[L][M].setDisabled(true)
}}}return true
},items:J},{title:CQ.I18n.getMessage("Livecopy"),xtype:"livecopyproperties"},{xtype:"customcontentpanel",stateful:false,executePost:false,pathGet:CQ.HTTP.externalize(D),title:CQ.I18n.getMessage("Live Copies inheritance"),defaults:{readOnly:true},submitPanel:function(){if(!this.disabled){var K=CQ.Util.findFormFields(this.formPanel);
for(var L in K){for(var M=0;
M<K[L].length;
M++){K[L][M].setValue()
}}}return true
},items:[{xtype:"textfield",name:"targetPath",fieldLabel:CQ.I18n.getMessage("Live Copy page")},{xtype:"multifield",name:"inheritance",fieldLabel:CQ.I18n.getMessage("Inherited from source page(s)"),fieldDescription:CQ.I18n.getMessage("Live Copy page inherits from the above page(s). Each of these pages is a Live Copy of following one."),defaults:{listeners:{afterlayout:function(K,L){if(L&&L.table){CQ.Ext.DomHelper.applyStyles(L.table,"width:100%")
}}}}}]}]},buttons:CQ.Dialog.OKCANCEL});
F.loadContent(C);
F.show()
}};
CQ.wcm.msm.BlueprintStatus.Commands.queues={};
CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox=function(A,I,E,D,C,G,H,B,K,J){if(!CQ.wcm.msm.BlueprintStatus.Commands.queues[E]){CQ.wcm.msm.BlueprintStatus.Commands.queues[E]=[]
}CQ.wcm.msm.BlueprintStatus.Commands.queues[E]=CQ.wcm.msm.BlueprintStatus.Commands.queues[E].concat(I);
var F=function(L){var M=CQ.wcm.msm.BlueprintStatus.Commands.queues[E].pop();
var P=CQ.wcm.msm.MSM.filterPagePath(M[CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
var O=CQ.wcm.msm.MSM.filterPagePath(M[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]);
A.getEl().mask(CQ.Util.patchText(K,[P]));
var N=function(S,U,T){var R=CQ.HTTP.buildPostResponseFromHTML(T.responseText);
var Q=R.headers[CQ.utils.HTTP.HEADER_STATUS];
if(Q!=200){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),R.headers[CQ.HTTP.HEADER_MESSAGE]);
A.getEl().unmask();
A.reload()
}else{if(CQ.wcm.msm.BlueprintStatus.Commands.queues[E].length>0){F.call(this,L)
}else{A.getEl().unmask();
A.reload();
if(J){var V=J.getSelectionModel().getSelectedNode();
if(!V){V=J
}V.reload()
}}}};
if(C==1){D.call(this,P,N)
}else{if(C==2){D.call(this,O,P,N)
}else{if(C==3){D.call(this,O,P,L,N)
}}}};
return CQ.Ext.Msg.show({title:H,msg:B,buttons:G,icon:CQ.Ext.MessageBox.QUESTION,fn:function(L){if(G.cancel){if(L=="cancel"){CQ.wcm.msm.BlueprintStatus.Commands.queues[E]=[];
return 
}F.call(this,(L=="no"));
return 
}if(G.no){if(L=="no"){CQ.wcm.msm.BlueprintStatus.Commands.queues[E]=[];
return 
}F.call(this)
}},scope:this})
};
CQ.wcm.msm.BlueprintStatus.Commands.rolloutLiveCopy=function(B,C,A){var F=CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(C);
F=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(F);
if(!F){return 
}var D;
if(F.length==1){var E=CQ.wcm.msm.MSM.filterPagePath(F[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
D=CQ.I18n.getMessage("Do you want to rollout page {0} only or page and its sub pages?",[E])
}else{D=CQ.I18n.getMessage("Do you want to rollout selected pages only or pages and their sub pages?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(B,F,"rollout",CQ.wcm.msm.MSM.Commands.rolloutLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Rollout Live Copy"),D,CQ.I18n.getMessage("Rolling out {0}",null,"{0} is a placeholder for a content path"),A)
};
CQ.wcm.msm.BlueprintStatus.Commands.recreateLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Are you sure you want to re-create page {0} and its sub pages? Re-creation process will delete the page and run a fresh rollout. Warning: all local modifications on Live Copy pages will be lost.",[C])
}else{B=CQ.I18n.getMessage("Are you sure you want to re-create selected pages and their sub pages? Re-creation process will delete the selected page sand run a fresh rollout. Warning: all local modifications on Live Copy pages will be lost.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"recreate",CQ.wcm.msm.MSM.Commands.recreateLiveCopy,2,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Recreate Live Copy"),B,CQ.I18n.getMessage("Recreating {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.restoreLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Do you want to restore page {0} only or page and its sub pages?",[C])
}else{B=CQ.I18n.getMessage("Do you want to restore selected pages only or pages and their sub pages?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"restore",CQ.wcm.msm.MSM.Commands.resetLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Restore Live Copy"),B,CQ.I18n.getMessage("Restoring {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.attachLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Do you want to attach page {0} only or page and its sub pages to their corresponding Blueprint pages ? Attachment process will NOT delete or modify any existing content. A rollout is needed afterward.",[C])
}else{B=CQ.I18n.getMessage("Do you want to attach selected pages only or page and their sub pages to their corresponding Blueprint pages ? Attachment process will NOT delete or modify any existing content. A rollout is needed afterward.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"attach",CQ.wcm.msm.MSM.Commands.attachLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Attach Live Copy"),B,CQ.I18n.getMessage("Attaching {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.detachLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Are you sure you want to detach page {0} and its sub pages from their Blueprint pages and create a standalone copy?",[C])
}else{B=CQ.I18n.getMessage("Are you sure you want to detach selected pages and their sub pages from their Blueprint pages and create standalone copies?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"detach",CQ.wcm.msm.MSM.Commands.detachLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Detach Live Copy"),B,CQ.I18n.getMessage("Detaching {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.skipLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Are you sure you want to skip page {0} and its sub pages? Pages will be excluded from the rollout process.",[C])
}else{B=CQ.I18n.getMessage("Are you sure you want to skip selected pages and their sub pages? Pages will be excluded from the rollout process.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"skip",CQ.wcm.msm.MSM.Commands.skipLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Skip Live Copy"),B,CQ.I18n.getMessage("Skipping {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.unskipLiveCopy=function(A,D){D=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(D);
if(!D){return 
}var B;
if(D.length==1){var C=CQ.wcm.msm.MSM.filterPagePath(D[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
B=CQ.I18n.getMessage("Are you sure you want to re-integrate page {0} and its sub pages to the rollout process?",[C])
}else{B=CQ.I18n.getMessage("Are you sure you want to re-integrate selected pages and its sub pages to the rollout process?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(A,D,"unskip",CQ.wcm.msm.MSM.Commands.unskipLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Unskip Live Copy"),B,CQ.I18n.getMessage("Unskipping {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.openBlueprintDialog=function(B){var A=new CQ.Dialog({height:480,warnIfModified:false,items:{xtype:"tabpanel",items:[{hideTargets:true,title:"Blueprint",xtype:"blueprintconfig"}]},buttons:CQ.Dialog.OKCANCEL});
if(B.lastIndexOf("/jcr:content")<B.length-11){B+="/jcr:content"
}A.loadContent(B);
A.show()
};
CQ.wcm.msm.BlueprintStatus.Commands.openCachesDialog=function(){var A=null;
var B=function(){A.body.mask("Loading...");
A.loadContent(CQ.HTTP.externalize("/libs/wcm/msm/content/commands/servercaches"))
};
A=new CQ.Dialog({title:CQ.I18n.getMessage("Server caches"),warnIfModified:false,items:{xtype:"panel",items:[{collapsed:true,collapsible:true,title:CQ.I18n.getMessage("Blueprint cache"),xtype:"dialogfieldset",items:[{name:"blueprintCacheSize",xtype:"hidden",listeners:{loadcontent:function(){var C=this.getValue();
var D=CQ.I18n.getMessage("Blueprint cache (size {0})",[C||0]);
this.findParentByType("dialogfieldset").setTitle(D)
}}},{name:"blueprintCache",readOnly:true,xtype:"multifield",hideLabel:true,defaults:{listeners:{afterlayout:function(C,D){if(D&&D.table){CQ.Ext.DomHelper.applyStyles(D.table,"width:100%")
}}}}}]},{collapsed:true,collapsible:true,title:CQ.I18n.getMessage("Live Copies cache"),xtype:"dialogfieldset",items:[{name:"livecopiesCacheSize",xtype:"hidden",listeners:{loadcontent:function(){var C=this.getValue();
var D=CQ.I18n.getMessage("Live Copies cache (size {0})",[C||0]);
this.findParentByType("dialogfieldset").setTitle(D)
}}},{name:"livecopiesCache",readOnly:true,xtype:"multifield",hideLabel:true,defaults:{listeners:{afterlayout:function(C,D){if(D&&D.table){CQ.Ext.DomHelper.applyStyles(D.table,"width:100%")
}}}}}]}]},buttons:[{text:CQ.I18n.getMessage("Flush caches"),handler:function(){CQ.wcm.msm.MSM.Commands.flushServerCaches();
B.call(this)
}},{text:CQ.I18n.getMessage("Close"),handler:function(){A.hide()
}}]});
A.show();
A.on("loadcontent",function(){A.body.unmask()
});
B.call(this)
};
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipsDialogs=function(E,C){if(!E||E.length==0){return 
}if(!CQ.Ext.isArray(E)){E=[E]
}for(var D=0;
D<E.length;
D++){var B=E[D];
var A=function(){C.checkGridReload()
};
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipDialog(B,A)
}};
CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs=function(C){var A=[];
for(var B=0;
B<C.length;
B++){if(C[B]["lr"]){A.push(C[B]["lr"])
}}return A
};
CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned=function(A){return A.parentLr&&!A.parentLr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
};
CQ.wcm.msm.BlueprintStatus.Commands.assertArray=function(A){if(A&&A.length>0){if(!CQ.Ext.isArray(A)){A=[A]
}return A
}return null
};
CQ.wcm.msm.TriggerSelection=CQ.Ext.extend(CQ.Ext.form.ComboBox,{constructor:function(A){A=(!A?{}:A);
A=CQ.Util.applyDefaults(A,{stateful:false,fieldLabel:CQ.I18n.getMessage("Sync Trigger"),allowBlank:false,defaultValue:"rollout",value:"rollout",name:"trigger",cls:"cq-msm-synctrigger",hiddenName:"msm:trigger",displayField:"label",valueField:"id",typeAhead:true,mode:"local",triggerAction:"all",store:new CQ.Ext.data.SimpleStore({fields:["id","label"],data:[["rollout",CQ.I18n.getMessage("On Rollout")],["modification",CQ.I18n.getMessage("On Modification")],["publish",CQ.I18n.getMessage("On Activation")],["deactivate",CQ.I18n.getMessage("On Deactivation")]]})});
CQ.wcm.msm.TriggerSelection.superclass.constructor.call(this,A)
}});
CQ.Ext.reg("triggerselection",CQ.wcm.msm.TriggerSelection);
CQ.wcm.msm.AuditLogDialog=CQ.Ext.extend(CQ.Dialog,{store:null,constructor:function(C){this.debug=C.debug;
var A=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Date"),dataIndex:"time",width:"150"},{header:CQ.I18n.getMessage("Target"),dataIndex:"target",width:"200"},{header:CQ.I18n.getMessage("Action"),dataIndex:"operation"},{header:CQ.I18n.getMessage("Exception"),dataIndex:"exceptionMessage"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"}]);
var F=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var E={autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/msm/audit.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"entries",fields:["path","time","target","exceptionMessage","user","operation"]})};
this.store=new CQ.Ext.data.GroupingStore(E);
var D={xtype:"grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:A,sm:F,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),store:this.store};
var B=new CQ.Ext.Panel({layout:"border",width:500,minHeight:500,statefull:false,items:[D]});
dialog=this;
C.items=[B];
C.buttons=[{tooltip:CQ.I18n.getMessage("Refresh"),tooltipType:"title",iconCls:"cq-siteadmin-refresh",handler:function(){dialog.store.reload()
}},{text:CQ.I18n.getMessage("OK"),handler:function(){dialog.hide()
}}];
CQ.wcm.AuditLogDialog.superclass.constructor.call(this,C)
},loadContent:function(A){this.setTitle(CQ.I18n.getMessage("MSM audit log"));
this.store.baseParams.path=A;
this.store.reload()
},initComponent:function(){CQ.wcm.AuditLogDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("MSMauditlogdialog",CQ.wcm.msm.AuditLogDialog);
CQ.ipe.InplaceEditing=function(){var A={};
return{register:function(B,C){A[B]=C
},create:function(B,C){return new A[B](C)
}}
}();
CQ.ipe.InplaceEditor=CQ.Ext.extend(CQ.Ext.emptyFn,{resizeListeners:null,repositionListeners:null,config:null,constructor:function(A){if(A){CQ.Ext.apply(this,A)
}this.resizeListeners=[];
this.repositionListeners=[]
},init:function(){},getDataProperty:function(){},start:function(C,B,A){},finish:function(A){},cancel:function(A){},addResizeListener:function(A){this.resizeListeners.push(A)
},removeResizeListener:function(B){var C=this.resizeListeners.length;
for(var A=C-1;
A>=0;
A--){if(this.resizeListeners[A]==B){this.resizeListeners.splice(A,1)
}}},removeAllResizeListeners:function(){this.resizeListeners.length=0
},addRepositionListener:function(A){this.repositionListeners.push(A)
},removeRepositionListener:function(B){var C=this.repositionListeners.length;
for(var A=C-1;
A>=0;
A--){if(this.repositionListeners[A]==B){this.repositionListeners.splice(A,1)
}}},removeAllRepositionListeners:function(){this.repositionListeners.length=0
},fireResizeEvent:function(B,D){var C=this.resizeListeners.length;
for(var A=C-1;
A>=0;
A--){this.resizeListeners[A](B,D)
}},fireRepositionEvent:function(C,B){var D=this.repositionListeners.length;
for(var A=D-1;
A>=0;
A--){this.repositionListeners[A](C,B)
}},execConfigFunction:function(B,A,E){var D=(B.scope?B.scope:this);
var C=B[A];
if(C){C.apply(D,E)
}},loadEditorConfig:function(C,B){var A=C.configPath+CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON;
A=CQ.HTTP.externalize(CQ.HTTP.noCaching(A));
CQ.Ext.Ajax.request({method:"GET",url:CQ.shared.HTTP.getXhrHookedURL(A),success:function(D){this.onConfigSuccess(D,B)
},failure:function(D){if(D.status==404){this.config=null;
CQ.Log.trace("CQ.ipe.InplaceEditor#loadEditorConfig: No editor configuration found, using defaults.");
this.execConfigFunction(B,"onSuccess",[this,D])
}else{this.execConfigFunction(B,"onFailure",[this,D])
}},scope:this})
},onConfigSuccess:function(A,B){var C=true;
try{if(A&&(A.status==200)){this.config=CQ.Ext.util.JSON.decode(A.responseText);
this.overrideConfig();
C=false
}}catch(D){this.config=null
}if(!C){this.execConfigFunction(B,"onSuccess",[this,A])
}else{this.execConfigFunction(B,"onFailure",[this,A])
}},transferConfigOption:function(A){if(this.config&&(this.config[A]!=null)){this[A]=this.config[A]
}},overrideConfig:function(){},isDropAllowed:function(A){return false
},notifyDrop:function(A){}});
CQ.ipe.TextEditor=CQ.Ext.extend(CQ.ipe.InplaceEditor,{textPropertyName:null,boxCheckInterval:0,editElementQuery:null,savedSpellcheckAttrib:null,savedOutlineStyle:null,isBoxChangeCheckActive:false,editComponent:null,textContainer:null,currentSize:null,currentPosition:null,boxChangeHandler:null,isEmptyContent:false,editorKernel:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{textPropertyName:"./text",boxCheckInterval:500});
CQ.ipe.TextEditor.superclass.constructor.call(this,A)
},checkBoxChanged:function(D){if(this.isBoxChangeCheckActive){var C=CQ.Ext.get(this.textContainer);
var G=C.getXY();
var I=G[0];
var H=G[1];
if((I!=this.currentPosition.x)||(H!=this.currentPosition.y)){var E=this.currentPosition;
var F={x:I,y:H};
this.currentPosition=F;
this.fireRepositionEvent(F,E)
}var K=C.getSize();
var B=K.width;
var J=K.height;
if((B!=this.currentSize.width)||(J!=this.currentSize.height)){var A=this.currentSize;
this.currentSize=K;
this.fireResizeEvent(K,A)
}if(!D){window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
}}},isEmptyText:function(){var B=CQ.Ext.DomQuery.selectNode("span:first",this.textContainer);
if(!B){return false
}var A=CQ.Ext.get(B);
return A.hasClass(CQ.themes.TextEditor.EMPTY_COMPONENT_CLASS)
},prepareForNewText:function(){CQ.form.rte.Common.removeAllChildren(this.textContainer);
var A=null;
if(this.editorKernel){A=this.editorKernel.getEditContext();
if(!A.isInitialized()){A=null
}}if(A==null){A=new CQ.form.rte.EditContext(null,window,document,this.textContainer)
}},getTextDiv:function(C){var B=this.editElementQuery||"div:first";
if(B=="."){return C.dom
}var A=CQ.Ext.DomQuery.selectNode(B,C.dom);
if(!A){A=C.dom
}return A
},resetInplaceEditing:function(){this.deactivateEditorKernel();
CQ.Ext.EventManager.un(document.body,"keyup",this.handleKeyUp,this);
CQ.WCM.unloadToolbar();
this.textContainer.blur();
this.textContainer.contentEditable="inherit";
document.body.spellcheck=this.savedSpellcheckAttrib;
if(CQ.Ext.isGecko&&this.savedOutlineStyle){this.textContainer.style.outlineStyle=this.savedOutlineStyle
}this.isBoxChangeCheckActive=false
},updateState:function(){this.editorKernel.updateToolbar()
},onDialogShow:function(){var A=this.editorKernel.getEditContext();
this.savedSelection=this.editorKernel.createQualifiedRangeBookmark(A);
this.editorKernel.disableEventHandling();
window.CQ_inplaceEditDialog=true
},onDialogHide:function(){(function(){window.CQ_inplaceEditDialog=false;
this.editorKernel.reenableEventHandling();
var A=this.editorKernel.getEditContext();
this.editorKernel.selectQualifiedRangeBookmark(A,this.savedSelection)
}).defer(1,this)
},handleKeyUp:function(A){if(!window.CQ_inplaceEditDialog){if(A.getCharCode()==27){this.editComponent.cancelInplaceEditing()
}else{this.checkBoxChanged(true)
}}},initializeEditorKernel:function(){this.editorKernel.addUIListener("updatestate",this.updateState,this);
this.editorKernel.addUIListener("dialogshow",this.onDialogShow,this);
this.editorKernel.addUIListener("dialoghide",this.onDialogHide,this);
this.editorKernel.initializeEditContext(window,document,this.textContainer);
this.editorKernel.initializeEventHandling();
var B=this.editorKernel.getEditContext();
var A=null;
if(this.isEmptyContent){CQ.form.rte.Common.removeAllChildren(B.root);
A=B.createElement("p");
B.root.appendChild(A);
if(CQ.Ext.isGecko){A.appendChild(B.createElement("br"))
}else{if(CQ.Ext.isIE){CQ.form.rte.DomProcessor.fixEmptyEditingBlockIE(B,A)
}}}this.editorKernel.setUnprocessedHtml(this.textContainer.innerHTML);
if(CQ.Ext.isGecko){this.editorKernel.deferFocus(function(){CQ.form.rte.Selection.resetSelection(B,"start");
this.editorKernel.fireUIEvent("updatestate")
}.createDelegate(this))
}else{if(CQ.Ext.isIE){(function(){if(A!=null){CQ.form.rte.Selection.selectNode(B,A,true)
}else{CQ.form.rte.Selection.resetSelection(B,"start")
}}).defer(1)
}}this.editorKernel.execCmd("initializeundo")
},deactivateEditorKernel:function(){if(this.editorKernel!=null){this.editorKernel.removeUIListener("updatestate");
this.editorKernel.removeUIListener("dialogshow");
this.editorKernel.removeUIListener("dialoghide");
this.editorKernel.suspendEventHandling();
this.editorKernel.destroyToolbar()
}},getProperty:function(){return this.textPropertyName
},start:function(E,C,B){if(this.editorKernel==null){this.editorKernel=new CQ.form.rte.DivKernel(this.config)
}this.editorKernel.createToolbar();
this.editComponent=E;
this.textContainer=this.getTextDiv(C);
this.textContainer.innerHTML=B||"";
var A=CQ.Ext.get(this.textContainer);
this.currentSize=A.getSize();
var D=A.getXY();
this.currentPosition={x:D[0],y:D[1]};
this.isEmptyContent=this.isEmptyText();
if(this.isEmptyContent){this.prepareForNewText()
}this.savedSpellcheckAttrib=document.body.spellcheck;
document.body.spellcheck=false;
CQ.Ext.EventManager.on(document.body,"keyup",this.handleKeyUp,this);
this.textContainer.contentEditable="true";
if(CQ.Ext.isGecko){this.savedOutlineStyle=this.textContainer.style.outlineStyle;
this.textContainer.style.outlineStyle="none"
}this.initializeEditorKernel();
this.isBoxChangeCheckActive=true;
this.boxChangeHandler=(function(){this.checkBoxChanged(false)
}).createDelegate(this);
window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
},finish:function(){var A=this.editorKernel.getProcessedHtml();
this.resetInplaceEditing();
this.editComponent.updateParagraph(this.textPropertyName,A,{"./textIsRich":true})
},cancel:function(){this.resetInplaceEditing();
this.editComponent.refreshSelf()
},isDroppingAllowed:true,isDropAllowed:function(C){var F=C.dragData;
var D=CQ.form.rte.Selection;
var B=CQ.form.rte.Common;
if(F.records&&F.single&&this.isDroppingAllowed){var A=F.records[0];
var G=A.get("mimeType");
var E=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(E&&D.isSelection(E)){return true
}if(!E||!D.isSelection(E)){if(B.strStartsWith(G,"image/")){return true
}}}return false
},notifyDrop:function(H){var E=H.dragData;
var B=CQ.form.rte.Selection;
var C=CQ.form.rte.Common;
if(E.records&&E.single){var F=E.records[0];
var J=CQ.HTTP.encodePath(F.get("path"));
var A=F.get("mimeType");
var D=(A=="");
var I=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(I&&B.isSelection(I)){if(D){J=J+CQ.HTTP.EXTENSION_HTML
}this.editorKernel.relayCmd("modifylink",{url:J})
}else{if(C.strStartsWith(A,"image/")){var G={path:J};
this.editorKernel.relayCmd("insertimg",G)
}}}},overrideConfig:function(){this.transferConfigOption("editElementQuery");
this.transferConfigOption("textPropertyName");
this.transferConfigOption("boxCheckInterval")
}});
CQ.ipe.InplaceEditing.register("text",CQ.ipe.TextEditor);
CQ.ipe.PlainTextEditor=CQ.Ext.extend(CQ.ipe.InplaceEditor,{textPropertyName:null,editElementQuery:null,boxCheckInterval:0,enterKeyMode:null,savedSpellcheckAttrib:null,savedOutlineStyle:null,isBoxChangeCheckActive:false,editComponent:null,textContainer:null,currentSize:null,currentPosition:null,boxChangeHandler:null,isEmptyContent:false,editorKernel:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{textPropertyName:"./text",boxCheckInterval:500,enterKeyMode:"ignore"});
CQ.ipe.TextEditor.superclass.constructor.call(this,A)
},checkBoxChanged:function(D){if(this.isBoxChangeCheckActive||D){var C=CQ.Ext.get(this.textContainer);
var G=C.getXY();
var I=G[0];
var H=G[1];
if((this.currentPosition==null)||((I!=this.currentPosition.x)||(H!=this.currentPosition.y))){var E=this.currentPosition;
var F={x:I,y:H};
this.currentPosition=F;
this.fireRepositionEvent(F,E)
}var K=C.getSize();
var B=K.width;
var J=K.height;
if((this.currentSize==null)||((B!=this.currentSize.width)||(J!=this.currentSize.height))){var A=this.currentSize;
this.currentSize=K;
this.fireResizeEvent(K,A)
}if(!D){window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
}}},isEmptyText:function(){return false
},prepareForNewText:function(){},prepareEditing:function(A){return null
},prepareUpdate:function(){var C=this.textContainer.childNodes;
for(var B=C.length-1;
B>=0;
B--){var A=C[B];
if(A.nodeType==1){A.parentNode.removeChild(A)
}}},getHtmlContent:function(){return this.textContainer.innerHTML
},getTextDiv:function(C){var A=this.prepareEditing(C);
if(!A){var B=this.editElementQuery||"div:first";
if(B=="."){return C.dom
}A=CQ.Ext.DomQuery.selectNode(B,C.dom)
}if(!A){A=C.dom
}return A
},resetInplaceEditing:function(){CQ.Ext.EventManager.un(document.body,"keyup",this.handleKeyUp,this);
CQ.Ext.EventManager.un(document.body,"keydown",this.handleKeyDown,this);
this.textContainer.blur();
this.textContainer.contentEditable="inherit";
document.body.spellcheck=this.savedSpellcheckAttrib;
if(CQ.Ext.isGecko&&this.savedOutlineStyle){this.textContainer.style.outlineStyle=this.savedOutlineStyle
}this.isBoxChangeCheckActive=false
},handleKeyUp:function(D){if(!window.CQ_inplaceEditDialog){if(D.getCharCode()==27){this.editComponent.cancelInplaceEditing()
}else{var E=this.textContainer.childNodes;
var B=CQ.form.rte.Common;
var A;
if(E.length==0){A=document.createElement("br");
this.textContainer.appendChild(A)
}else{if(E.length==1){var C=E[0];
if(B.isTag(C,B.BLOCK_TAGS)){if(C.childNodes.length==0){A=document.createElement("br");
C.appendChild(A)
}}}}this.checkBoxChanged(true)
}}},handleKeyDown:function(A){if(!window.CQ_inplaceEditDialog){if(A.getCharCode()==A.ENTER){A.stopEvent();
if(this.enterKeyMode=="save"){this.editComponent.finishInplaceEditing.defer(1,this.editComponent)
}}}},getProperty:function(){return this.textPropertyName
},start:function(C,B,A){this.editComponent=C;
this.textContainer=this.getTextDiv(B);
if(CQ.Ext.isGecko){this.textContainer.textContent=A||""
}else{this.textContainer.innerText=A||""
}this.currentSize=null;
this.currentPosition=null;
this.isEmptyContent=this.isEmptyText();
if(this.isEmptyContent){this.prepareForNewText()
}this.savedSpellcheckAttrib=document.body.spellcheck;
document.body.spellcheck=false;
CQ.Ext.EventManager.on(document.body,"keyup",this.handleKeyUp,this);
CQ.Ext.EventManager.on(document.body,"keydown",this.handleKeyDown,this);
this.textContainer.contentEditable="true";
if(CQ.Ext.isGecko){this.savedOutlineStyle=this.textContainer.style.outlineStyle;
this.textContainer.style.outlineStyle="none";
this.textContainer.focus.defer(1,this.textContainer)
}this.isBoxChangeCheckActive=true;
this.boxChangeHandler=(function(){this.checkBoxChanged(false)
}).createDelegate(this);
this.checkBoxChanged(true);
window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
},finish:function(){this.resetInplaceEditing();
this.prepareUpdate();
var A=this.getHtmlContent();
A=CQ.Ext.util.Format.htmlDecode(A);
this.editComponent.updateParagraph(this.textPropertyName,A)
},cancel:function(){this.resetInplaceEditing();
this.editComponent.refreshSelf()
},overrideConfig:function(){this.transferConfigOption("textPropertyName");
this.transferConfigOption("boxCheckInterval");
this.transferConfigOption("enterKeyMode");
this.transferConfigOption("editElementQuery")
}});
CQ.ipe.InplaceEditing.register("plaintext",CQ.ipe.PlainTextEditor);
CQ.ipe.TitleEditor=CQ.Ext.extend(CQ.ipe.PlainTextEditor,{titleTag:null,imageReplacingTag:null,imageReplacingStyle:null,imageTitleAttribute:null,titleContainer:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{textPropertyName:"./jcr:title",titleTag:"h1",imageReplacingTag:"h3",imageReplacingStyle:"margin-top: 0;",imageTitleAttribute:"alt",enterKeyMode:"save"});
CQ.ipe.TitleEditor.superclass.constructor.call(this,A)
},prepareEditing:function(H){var I=CQ.form.rte.DomProcessor;
var D=CQ.form.rte.Common;
var C=new CQ.form.rte.EditContext(null,window,document,null);
this.titleContainer=CQ.Ext.DomQuery.selectNode(this.titleTag+":first",H.dom);
if(this.titleContainer){I.insertAsParent(C,this.titleContainer,"div");
return this.titleContainer
}var E=CQ.Ext.DomQuery.selectNode("img:first",H.dom);
if(E){var G=E.getAttribute(this.imageTitleAttribute);
if(G){var F=H.dom;
D.removeAllChildren(F);
var B=document.createElement("div");
F.appendChild(B);
var A=(this.imageReplacingStyle!=null?{style:this.imageReplacingStyle}:null);
this.titleContainer=I.createNode(C,this.imageReplacingTag,A);
document.createElement(this.imageReplacingTag);
B.appendChild(this.titleContainer);
var J=document.createTextNode(G);
this.titleContainer.appendChild(J);
return this.titleContainer
}}throw new Error("No title container found (must be a '"+this.titleTag+"' tag).")
},prepareUpdate:function(){var C=this.titleContainer.childNodes;
for(var B=C.length-1;
B>=0;
B--){var A=C[B];
if(A.nodeType==1){A.parentNode.removeChild(A)
}}},getHtmlContent:function(){return this.titleContainer.innerHTML
},overrideConfig:function(){CQ.ipe.TitleEditor.superclass.overrideConfig.call(this);
this.transferConfigOption("titleTag");
this.transferConfigOption("imageReplacingTag");
this.transferConfigOption("imageReplacingStyle");
this.transferConfigOption("imageTitleAttribute")
}});
CQ.ipe.InplaceEditing.register("title",CQ.ipe.TitleEditor);
CQ.tree.SlingTreeLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{path:"/",titleProperty:"jcr:title",qtipProperty:"jcr:description",nameExcludes:["rep:policy"],typeExcludes:[],typeIncludes:[],filterFn:null,directFn:null,constructor:function(A){A.url=A.path;
CQ.tree.SlingTreeLoader.superclass.constructor.call(this,A)
},requestData:function(C,D,B){if(this.fireEvent("beforeload",this,C,D)!==false){var A=C.getPath()+".1.json";
this.transId=CQ.Ext.Ajax.request({method:"GET",url:A,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:D,node:C,scope:B}})
}else{this.runCallback(D,B||C,[])
}},processResponse:function(A,D,G,C){var B=A.responseText;
try{var E=A.responseData||CQ.Ext.decode(B);
D.beginUpdate();
CQ.Ext.iterate(E,function(H,I){if(CQ.Ext.isObject(I)){I=this.filter(H,I);
if(I){var J=this.createNode(this.readAttributes(H,I));
if(J){D.appendChild(J)
}}}},this);
D.endUpdate();
this.runCallback(G,C||D,[D])
}catch(F){this.handleFailure(A)
}},filter:function(B,E){if(this.nameExcludes.indexOf(B)>=0){return null
}var C=E["jcr:primaryType"];
var A=E["sling:resourceType"];
if(this.typeExcludes.indexOf(C)>=0||this.typeExcludes.indexOf(A)>=0){return null
}if(this.typeIncludes&&this.typeIncludes.length>0){var D=false;
if(!C||this.typeIncludes.indexOf(C)>=0){D=true
}if(!A||this.typeIncludes.indexOf(A)>=0){D=true
}if(!D){return null
}}if(typeof this.filterFn==="function"){E=this.filterFn(B,E)
}return E
},readAttributes:function(A,B){return{name:A,text:this.getTitle(A,B),qtip:this.getQtip(A,B),leaf:false}
},getTitle:function(A,B){return B[this.titleProperty]||A
},getQtip:function(A,B){return B[this.qtipProperty]
}});
CQ.tree.FilteredTreeLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{filterFn:null,processResponse:function(response,node,callback){var json=response.responseText;
try{var o=eval("("+json+")");
if(this.filterFn){o=this.filterFn(o)
}node.beginUpdate();
for(var i=0,len=o.length;
i<len;
i++){var n=o[i];
if(n.children){delete n.children
}n=this.createNode(n);
if(n){node.appendChild(n)
}}node.endUpdate();
if(typeof callback=="function"){callback(this,node)
}}catch(e){this.handleFailure(response)
}}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridSorter=CQ.Ext.extend(CQ.Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(A,B){if(!CQ.Ext.isObject(B)){B={property:A.columns[0].dataIndex||"text",folderSort:true}
}CQ.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);
this.tree=A;
A.on("headerclick",this.onHeaderClick,this);
A.ddAppendOnly=true;
var C=this;
this.defaultSortFn=function(K,J){var I=C.dir&&C.dir.toLowerCase()=="desc",D=C.property||"text",F=C.sortType,M=C.caseSensitive===true,E=C.leafAttr||"leaf",N=K.attributes,L=J.attributes;
if(C.folderSort){if(N[E]&&!L[E]){return 1
}if(!N[E]&&L[E]){return -1
}}var H=N[D],G=L[D],O=F?F(H):(M?H:H.toUpperCase());
v2=F?F(G):(M?G:G.toUpperCase());
if(O<v2){return I?+1:-1
}else{if(O>v2){return I?-1:+1
}else{return 0
}}};
A.on("afterrender",this.onAfterTreeRender,this,{single:true});
A.on("headermenuclick",this.onHeaderMenuClick,this)
},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"})
}this.updateSortIcon(0,"asc")
},onHeaderMenuClick:function(C,B,A){if(B==="asc"||B==="desc"){this.onHeaderClick(C,null,A);
return false
}},onHeaderClick:function(D,B,A){if(D&&!this.tree.headersDisabled){var C=this;
C.property=D.dataIndex;
C.dir=D.dir=(D.dir==="desc"?"asc":"desc");
C.sortType=D.sortType;
C.caseSensitive===CQ.Ext.isBoolean(D.caseSensitive)?D.caseSensitive:this.caseSensitive;
C.sortFn=D.sortFn||this.defaultSortFn;
this.tree.root.cascade(function(E){if(!E.isLeaf()){C.updateSort(C.tree,E)
}});
this.updateSortIcon(A,D.dir)
}},updateSortIcon:function(B,A){var D=this.sortClasses,C=this.tree.innerHd.select("td").removeClass(D);
C.item(B).addClass(D[A=="desc"?1:0])
}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.ColumnResizer=CQ.Ext.extend(CQ.Ext.util.Observable,{minWidth:14,constructor:function(A){CQ.Ext.apply(this,A);
CQ.tree.ColumnResizer.superclass.constructor.call(this)
},init:function(A){this.tree=A;
A.on("render",this.initEvents,this)
},initEvents:function(A){A.mon(A.innerHd,"mousemove",this.handleHdMove,this);
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(A.innerHd);
A.on("beforedestroy",this.tracker.destroy,this.tracker)
},handleHdMove:function(E,I){var F=5,H=E.getPageX(),D=E.getTarget(".x-treegrid-hd",3,true);
if(D){var B=D.getRegion(),J=D.dom.style,C=D.dom.parentNode;
if(H-B.left<=F&&D.dom!==C.firstChild){var A=D.dom.previousSibling;
while(A&&CQ.Ext.fly(A).hasClass("x-treegrid-hd-hidden")){A=A.previousSibling
}if(A){this.activeHd=CQ.Ext.get(A);
J.cursor=CQ.Ext.isWebKit?"e-resize":"col-resize"
}}else{if(B.right-H<=F){var G=D.dom;
while(G&&CQ.Ext.fly(G).hasClass("x-treegrid-hd-hidden")){G=G.previousSibling
}if(G){this.activeHd=CQ.Ext.get(G);
J.cursor=CQ.Ext.isWebKit?"w-resize":"col-resize"
}}else{delete this.activeHd;
J.cursor=""
}}}},onBeforeStart:function(A){this.dragHd=this.activeHd;
return !!this.dragHd
},onStart:function(B){this.dragHeadersDisabled=this.tree.headersDisabled;
this.tree.headersDisabled=true;
this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"});
this.proxy.setHeight(this.tree.body.getHeight());
var A=this.tracker.getXY()[0];
this.hdX=this.dragHd.getX();
this.hdIndex=this.tree.findHeaderIndex(this.dragHd);
this.proxy.setX(this.hdX);
this.proxy.setWidth(A-this.hdX);
this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left
},onDrag:function(B){var A=this.tracker.getXY()[0];
this.proxy.setWidth((A-this.hdX).constrain(this.minWidth,this.maxWidth))
},onEnd:function(D){var B=this.proxy.getWidth(),A=this.tree,C=this.dragHeadersDisabled;
this.proxy.remove();
delete this.dragHd;
A.columns[this.hdIndex].width=B;
A.updateColumnWidths();
setTimeout(function(){A.headersDisabled=C
},100)
}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(B,I,F,J){var K=B.getOwnerTree(),H=K.columns,G=H[0],C,A,E;
this.indentMarkup=B.parentNode?B.parentNode.ui.getChildIndent():"";
A=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',B.id,'" class="x-tree-node-el x-tree-node-leaf ',I.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',I.icon||this.emptyIcon,'" class="x-tree-node-icon',(I.icon?" x-tree-node-inline-icon":""),(I.iconCls?" "+I.iconCls:""),'" unselectable="on" />','<a hidefocus="on" class="x-tree-node-anchor" href="',I.href?I.href:"#",'" tabIndex="1" ',I.hrefTarget?' target="'+I.hrefTarget+'"':"",">",'<span unselectable="on">',(G.tpl?G.tpl.apply(I):I[G.dataIndex]||G.text),"</span></a>","</td>"];
for(C=1,E=H.length;
C<E;
C++){G=H[C];
A.push('<td class="x-treegrid-col ',(G.cls?G.cls:""),'">','<div unselectable="on" class="x-treegrid-text"',(G.align?' style="text-align: '+G.align+';"':""),">",(G.tpl?G.tpl.apply(I):I[G.dataIndex]),"</div>","</td>")
}A.push('</tr><tr class="x-tree-node-ct"><td colspan="',H.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',K.innerCt.getWidth(),'px;"><colgroup>');
for(C=0,E=H.length;
C<E;
C++){A.push('<col style="width: ',(H[C].hidden?0:H[C].width),'px;" />')
}A.push("</colgroup></table></td></tr></tbody>");
if(J!==true&&B.nextSibling&&B.nextSibling.ui.getEl()){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",B.nextSibling.ui.getEl(),A.join(""))
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",F,A.join(""))
}this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;
var D=this.elNode.firstChild.childNodes;
this.indentNode=D[0];
this.ecNode=D[1];
this.iconNode=D[2];
this.anchor=D[3];
this.textNode=D[3].firstChild
},animExpand:function(A){this.ctNode.style.display="";
CQ.tree.TreeGridNodeUI.superclass.animExpand.call(this,A)
}});
CQ.tree.TreeGridRootNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;
this.node.expanded=true
}if(CQ.Ext.isWebKit){var A=this.ctNode;
A.style.tableLayout=null;
(function(){A.style.tableLayout="fixed"
}).defer(1)
}},destroy:function(){if(this.elNode){CQ.Ext.dd.Registry.unregister(this.elNode.id)
}delete this.node
},collapse:CQ.Ext.emptyFn,expand:CQ.Ext.emptyFn});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{createNode:function(A){if(!A.uiProvider){A.uiProvider=CQ.tree.TreeGridNodeUI
}return CQ.Ext.tree.TreeLoader.prototype.createNode.call(this,A)
}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){CQ.Ext.override(CQ.Ext.list.Column,{init:function(){var B=CQ.Ext.data.Types,A=this.sortType;
if(this.type){if(CQ.Ext.isString(this.type)){this.type=CQ.Ext.data.Types[this.type.toUpperCase()]||B.AUTO
}}else{this.type=B.AUTO
}if(CQ.Ext.isString(A)){this.sortType=CQ.Ext.data.SortTypes[A]
}else{if(CQ.Ext.isEmpty(A)){this.sortType=this.type.sortType
}}}});
CQ.tree.Column=CQ.Ext.extend(CQ.Ext.list.Column,{});
CQ.tree.NumberColumn=CQ.Ext.extend(CQ.Ext.list.NumberColumn,{});
CQ.tree.DateColumn=CQ.Ext.extend(CQ.Ext.list.DateColumn,{});
CQ.tree.BooleanColumn=CQ.Ext.extend(CQ.Ext.list.BooleanColumn,{});
CQ.Ext.reg("tgcolumn",CQ.tree.Column);
CQ.Ext.reg("tgnumbercolumn",CQ.tree.NumberColumn);
CQ.Ext.reg("tgdatecolumn",CQ.tree.DateColumn);
CQ.Ext.reg("tgbooleancolumn",CQ.tree.BooleanColumn)
})();
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGrid=CQ.Ext.extend(CQ.Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:CQ.Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:true,enableSort:true,reserveScrollOffset:true,enableHdMenu:true,columnsText:"Columns",initComponent:function(){if(!this.root){this.root=new CQ.Ext.tree.AsyncTreeNode({text:"Root"})
}var A=this.loader;
if(!A){A=new CQ.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store})
}else{if(CQ.Ext.isObject(A)&&!A.load){A=new CQ.tree.TreeGridLoader(A)
}}this.loader=A;
CQ.tree.TreeGrid.superclass.initComponent.call(this);
this.initColumns();
if(this.enableSort){this.treeGridSorter=new CQ.tree.TreeGridSorter(this,this.enableSort)
}if(this.columnResize){this.colResizer=new CQ.tree.ColumnResizer(this.columnResize);
this.colResizer.init(this)
}var B=this.columns;
if(!this.internalTpl){this.internalTpl=new CQ.Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table style="table-layout: fixed;" cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',CQ.Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>")
}if(!this.colgroupTpl){this.colgroupTpl=new CQ.Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>')
}},initColumns:function(){var D=this.columns,A=D.length,C=[],B,E;
for(B=0;
B<A;
B++){E=D[B];
if(!E.isColumn){E.xtype=E.xtype?(/^tg/.test(E.xtype)?E.xtype:"tg"+E.xtype):"tgcolumn";
E=CQ.Ext.create(E)
}E.init(this);
C.push(E);
if(this.enableSort!==false&&E.sortable!==false){E.sortable=true;
this.enableSort=true
}}this.columns=C
},onRender:function(){CQ.Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);
this.el.addClass("x-treegrid");
this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")});
this.internalTpl.overwrite(this.outerCt,{columns:this.columns});
this.mainHd=CQ.Ext.get(this.outerCt.dom.firstChild);
this.innerHd=CQ.Ext.get(this.mainHd.dom.firstChild);
this.innerBody=CQ.Ext.get(this.outerCt.dom.lastChild);
this.innerCt=CQ.Ext.get(this.innerBody.dom.firstChild);
this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});
if(this.hideHeaders){this.el.child(".x-grid3-header").setDisplayed("none")
}else{if(this.enableHdMenu!==false){this.hmenu=new CQ.Ext.menu.Menu({id:this.id+"-hctx"});
if(this.enableColumnHide!==false){this.colMenu=new CQ.Ext.menu.Menu({id:this.id+"-hcols-menu"});
this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add({itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})
}this.hmenu.on("itemclick",this.handleHdMenuClick,this)
}}},setRootNode:function(A){A.attributes.uiProvider=CQ.tree.TreeGridRootNodeUI;
A=CQ.tree.TreeGrid.superclass.setRootNode.call(this,A);
if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns})
}return A
},clearInnerCt:function(){if(CQ.Ext.isIE){var A=this.innerCt.dom;
while(A.firstChild){A.removeChild(A.firstChild)
}}else{CQ.tree.TreeGrid.superclass.clearInnerCt.call(this)
}},initEvents:function(){CQ.tree.TreeGrid.superclass.initEvents.apply(this,arguments);
this.mon(this.innerBody,"scroll",this.syncScroll,this);
this.mon(this.innerHd,"click",this.handleHdDown,this);
this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})
},onResize:function(B,C){CQ.tree.TreeGrid.superclass.onResize.apply(this,arguments);
var E=this.innerBody.dom;
var F=this.innerHd.dom;
if(!E){return 
}if(CQ.Ext.isNumber(C)){E.style.height=this.body.getHeight(true)-F.offsetHeight+"px"
}if(CQ.Ext.isNumber(B)){var A=CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth());
if(this.reserveScrollOffset||((E.offsetWidth-E.clientWidth)>10)){this.setScrollOffset(A)
}else{var D=this;
setTimeout(function(){D.setScrollOffset(E.offsetWidth-E.clientWidth>10?A:0)
},10)
}}},updateColumnWidths:function(){var G=this.columns,I=G.length,A=this.outerCt.query("colgroup"),H=A.length,F,D,C,B;
for(C=0;
C<I;
C++){F=G[C];
for(B=0;
B<H;
B++){D=A[B];
D.childNodes[C].style.width=(F.hidden?0:F.width)+"px"
}}for(C=0,A=this.innerHd.query("td"),len=A.length;
C<len;
C++){F=CQ.Ext.fly(A[C]);
if(G[C]&&G[C].hidden){F.addClass("x-treegrid-hd-hidden")
}else{F.removeClass("x-treegrid-hd-hidden")
}}var E=this.getTotalColumnWidth();
CQ.Ext.fly(this.innerHd.dom.firstChild).setWidth(E+(this.scrollOffset||0));
this.outerCt.select("table").setWidth(E);
this.syncHeaderScroll()
},getVisibleColumns:function(){var C=[],D=this.columns,A=D.length,B;
for(B=0;
B<A;
B++){if(!D[B].hidden){C.push(D[B])
}}return C
},getTotalColumnWidth:function(){var D=0;
for(var B=0,C=this.getVisibleColumns(),A=C.length;
B<A;
B++){D+=C[B].width
}return D
},setScrollOffset:function(A){this.scrollOffset=A;
this.updateColumnWidths()
},handleHdDown:function(G,D){var F=G.getTarget(".x-treegrid-hd");
if(F&&CQ.Ext.fly(D).hasClass("x-grid3-hd-btn")){var B=this.hmenu.items,E=this.columns,A=this.findHeaderIndex(F),H=E[A],C=H.sortable;
G.stopEvent();
CQ.Ext.fly(F).addClass("x-grid3-hd-menu-open");
this.hdCtxIndex=A;
this.fireEvent("headerbuttonclick",B,H,F,A);
this.hmenu.on("hide",function(){CQ.Ext.fly(F).removeClass("x-grid3-hd-menu-open")
},this,{single:true});
this.hmenu.show(D,"tl-bl?")
}else{if(F){var A=this.findHeaderIndex(F);
this.fireEvent("headerclick",this.columns[A],F,A)
}}},handleHdOver:function(D,A){var C=D.getTarget(".x-treegrid-hd");
if(C&&!this.headersDisabled){index=this.findHeaderIndex(C);
this.activeHdRef=A;
this.activeHdIndex=index;
var B=CQ.Ext.get(C);
this.activeHdRegion=B.getRegion();
B.addClass("x-grid3-hd-over");
this.activeHdBtn=B.child(".x-grid3-hd-btn");
if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(C.firstChild.offsetHeight-1)+"px"
}}},handleHdOut:function(C,A){var B=C.getTarget(".x-treegrid-hd");
if(B&&(!CQ.Ext.isIE||!C.within(B,true))){this.activeHdRef=null;
CQ.Ext.fly(B).removeClass("x-grid3-hd-over");
B.style.cursor=""
}},findHeaderIndex:function(C){C=C.dom||C;
var B=C.parentNode.childNodes;
for(var A=0,D;
D=B[A];
A++){if(D==C){return A
}}return -1
},beforeColMenuShow:function(){var C=this.columns,B=C.length,A,D;
this.colMenu.removeAll();
for(A=1;
A<B;
A++){D=C[A];
if(D.hideable!==false){this.colMenu.add(new CQ.Ext.menu.CheckItem({itemId:"col-"+A,text:D.header,checked:!D.hidden,hideOnClick:false,disabled:D.hideable===false}))
}}},handleHdMenuClick:function(B){var A=this.hdCtxIndex,C=B.getItemId();
if(this.fireEvent("headermenuclick",this.columns[A],C,A)!==false){A=C.substr(4);
if(A>0&&this.columns[A]){this.setColumnVisible(A,!B.checked)
}}return true
},setColumnVisible:function(A,B){this.columns[A].hidden=!B;
this.updateColumnWidths()
},scrollToTop:function(){this.innerBody.dom.scrollTop=0;
this.innerBody.dom.scrollLeft=0
},syncScroll:function(){this.syncHeaderScroll();
var A=this.innerBody.dom;
this.fireEvent("bodyscroll",A.scrollLeft,A.scrollTop)
},syncHeaderScroll:function(){var A=this.innerBody.dom;
this.innerHd.dom.scrollLeft=A.scrollLeft;
this.innerHd.dom.scrollLeft=A.scrollLeft
},registerNode:function(A){CQ.tree.TreeGrid.superclass.registerNode.call(this,A);
if(!A.uiProvider&&!A.isRoot&&!A.ui.isTreeGridNodeUI){A.ui=new CQ.tree.TreeGridNodeUI(A)
}}});
CQ.Ext.reg("treegrid",CQ.tree.TreeGrid);
if(CQ.Ext.version=="3.0"){CQ.Ext.override(CQ.Ext.grid.GridView,{ensureVisible:function(Q,E,D){var O=this.resolveCell(Q,E,D);
if(!O||!O.row){return 
}var I=O.row,F=O.cell,L=this.scroller.dom,P=0,C=I,M=this.el.dom;
var C=I,M=this.el.dom;
while(C&&C!=M){P+=C.offsetTop;
C=C.offsetParent
}P-=this.mainHd.dom.offsetHeight;
var N=P+I.offsetHeight;
var A=L.clientHeight;
var M=parseInt(L.scrollTop,10);
var K=M+A;
if(P<M){L.scrollTop=P
}else{if(N>K){L.scrollTop=N-A
}}if(D!==false){var J=parseInt(F.offsetLeft,10);
var H=J+F.offsetWidth;
var G=parseInt(L.scrollLeft,10);
var B=G+L.clientWidth;
if(J<G){L.scrollLeft=J
}else{if(H>B){L.scrollLeft=H-L.clientWidth
}}}return this.getResolvedXY(O)
}})
}CQ.Ext.namespace("CQ.Ext.ux.maximgb.tg");
CQ.Ext.ux.maximgb.tg.AbstractTreeStore=CQ.Ext.extend(CQ.Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(A){CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,A);
if(!this.paramNames.active_node){this.paramNames.active_node="anode"
}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")
},remove:function(A){if(A===this.active_node){this.setActiveNode(null)
}this.removeNodeDescendants(A);
CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,A)
},removeNodeDescendants:function(D){var C,A,B=this.getNodeChildren(D);
for(C=0,A=B.length;
C<A;
C++){this.remove(B[C])
}},load:function(A){if(A){if(A.params){if(A.params[this.paramNames.active_node]===undefined){A.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}}else{A.params={};
A.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}}else{A={params:{}};
A.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}if(A.params[this.paramNames.active_node]!==null){A.add=true
}return CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,A)
},loadRecords:function(C,O,J){if(!C||J===false){if(J!==false){this.fireEvent("load",this,[],O)
}if(O.callback){O.callback.call(O.scope||this,[],O,false)
}return 
}var A=C.records,N=C.totalRecords||A.length,K=this.getPageOffsetFromOptions(O),M=this.getLoadedNodeIdFromOptions(O),I,D,G,B,F,H,E,L=this;
if(!O||O.add!==true){if(this.pruneModifiedRecords){this.modified=[]
}for(var D=0,G=A.length;
D<G;
D++){A[D].join(this)
}if(this.snapshot){this.data=this.snapshot;
delete this.snapshot
}this.data.clear();
this.data.addAll(A);
this.page_offset=K;
this.totalLength=N;
this.applySort();
this.fireEvent("datachanged",this)
}else{if(M){I=this.getById(M)
}if(I){this.setNodeLoaded(I,true);
this.setNodeChildrenOffset(I,K);
this.setNodeChildrenTotalCount(I,Math.max(N,A.length));
this.removeNodeDescendants(I)
}this.suspendEvents();
E={};
for(D=0,G=A.length;
D<G;
D++){F=A[D];
H=this.indexOfId(F.id);
if(H==-1){E[F.id]=false;
this.add(F)
}else{E[F.id]=true;
B=this.getAt(H);
B.reject();
B.data=F.data;
A[D]=B
}}this.applySort();
this.resumeEvents();
A.sort(function(S,Q){var T=L.data.indexOf(S),R=L.data.indexOf(Q),P;
if(T>R){P=1
}else{P=-1
}return P
});
for(D=0,G=A.length;
D<G;
D++){F=A[D];
if(E[F.id]==true){this.fireEvent("update",this,F,CQ.Ext.data.Record.COMMIT)
}else{this.fireEvent("add",this,[F],this.data.indexOf(F))
}}}this.fireEvent("load",this,A,O);
if(O.callback){O.callback.call(O.scope||this,A,O,true)
}},sort:function(B,A){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;
if(this.lastOptions.params){this.lastOptions.params[this.paramNames.active_node]=null
}}}return CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,B,A)
},applySort:function(){if(this.sortInfo&&!this.remoteSort){var A=this.sortInfo,B=A.field;
this.sortData(B,A.direction)
}else{this.applyTreeSort()
}},sortData:function(C,D){D=D||"ASC";
var A=this.fields.get(C).sortType;
var B=function(F,E){var H=A(F.data[C]),G=A(E.data[C]);
return H>G?1:(H<G?-1:0)
};
this.data.sort(D,B);
if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(D,B)
}this.applyTreeSort()
},applyTreeSort:function(){var E,A,D,F,C=[],B=this.getRootNodes();
for(E=0,A=B.length;
E<A;
E++){F=B[E];
C.push(F);
this.collectNodeChildrenTreeSorted(C,F)
}if(C.length>0){this.data.clear();
this.data.addAll(C)
}if(this.snapshot&&this.snapshot!==this.data){D=this.data;
this.data=this.snapshot;
this.snapshot=null;
this.applyTreeSort();
this.snapshot=this.data;
this.data=D
}},collectNodeChildrenTreeSorted:function(B,E){var D,A,F,C=this.getNodeChildren(E);
for(D=0,A=C.length;
D<A;
D++){F=C[D];
B.push(F);
this.collectNodeChildrenTreeSorted(B,F)
}},getActiveNode:function(){return this.active_node
},setActiveNode:function(A){if(this.active_node!==A){if(A){if(this.data.indexOf(A)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,A)!==false){this.active_node=A;
this.fireEvent("activenodechange",this,this.active_node,A)
}}else{throw"Given record is not from the store."
}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,A)!==false){this.active_node=A;
this.fireEvent("activenodechange",this,this.active_node,A)
}}}},isExpandedNode:function(A){return A.ux_maximgb_tg_expanded===true
},setNodeExpanded:function(B,A){B.ux_maximgb_tg_expanded=A
},isVisibleNode:function(E){var C,B,D=this.getNodeAncestors(E),A=true;
for(C=0,B=D.length;
C<B;
C++){A=A&&this.isExpandedNode(D[C]);
if(!A){break
}}return A
},isLeafNode:function(A){return A.get(this.leaf_field_name)==true
},isLoadedNode:function(B){var A;
if(B.ux_maximgb_tg_loaded!==undefined){A=B.ux_maximgb_tg_loaded
}else{if(this.isLeafNode(B)||this.hasChildNodes(B)){A=true
}else{A=false
}}return A
},setNodeLoaded:function(B,A){B.ux_maximgb_tg_loaded=A
},getNodeChildrenOffset:function(A){return A.ux_maximgb_tg_offset||0
},setNodeChildrenOffset:function(B,A){B.ux_maximgb_tg_offset=A
},getNodeChildrenTotalCount:function(A){return A.ux_maximgb_tg_total||0
},setNodeChildrenTotalCount:function(B,A){B.ux_maximgb_tg_total=A
},collapseNode:function(A){if(this.isExpandedNode(A)&&this.fireEvent("beforecollapsenode",this,A)!==false){this.setNodeExpanded(A,false);
this.fireEvent("collapsenode",this,A)
}},expandNode:function(A){var B;
if(!this.isExpandedNode(A)&&this.fireEvent("beforeexpandnode",this,A)!==false){if(this.isLoadedNode(A)){this.setNodeExpanded(A,true);
this.fireEvent("expandnode",this,A)
}else{B={};
B[this.paramNames.active_node]=A.id;
this.load({add:true,params:B,callback:this.expandNodeCallback,scope:this})
}}},expandNodeCallback:function(B,A,D){var C=this.getById(A.params[this.paramNames.active_node]);
if(D&&C){this.setNodeExpanded(C,true);
this.fireEvent("expandnode",this,C)
}else{this.fireEvent("expandnodefailed",this,A.params[this.paramNames.active_node],C)
}},expandAll:function(){var D,C,A,B=this.data.getRange();
this.suspendEvents();
for(C=0,A=B.length;
C<A;
C++){D=B[C];
if(!this.isExpandedNode(D)){this.expandNode(D)
}}this.resumeEvents();
this.fireEvent("datachanged",this)
},collapseAll:function(){var D,C,A,B=this.data.getRange();
this.suspendEvents();
for(C=0,A=B.length;
C<A;
C++){D=B[C];
if(this.isExpandedNode(D)){this.collapseNode(D)
}}this.resumeEvents();
this.fireEvent("datachanged",this)
},getLoadedNodeIdFromOptions:function(B){var A=null;
if(B&&B.params&&B.params[this.paramNames.active_node]){A=B.params[this.paramNames.active_node]
}return A
},getPageOffsetFromOptions:function(B){var A=0;
if(B&&B.params&&B.params[this.paramNames.start]){A=parseInt(B.params[this.paramNames.start],10);
if(isNaN(A)){A=0
}}return A
},hasNextSiblingNode:function(A){return this.getNodeNextSibling(A)!==null
},hasPrevSiblingNode:function(A){return this.getNodePrevSibling(A)!==null
},hasChildNodes:function(A){return this.getNodeChildrenCount(A)>0
},getNodeAncestors:function(C){var B=[],A;
A=this.getNodeParent(C);
while(A){B.push(A);
A=this.getNodeParent(A)
}return B
},getNodeChildrenCount:function(A){return this.getNodeChildren(A).length
},getNodeNextSibling:function(D){var E,C,B,A=null;
C=this.getNodeParent(D);
if(C){E=this.getNodeChildren(C)
}else{E=this.getRootNodes()
}B=E.indexOf(D);
if(B<E.length-1){A=E[B+1]
}return A
},getNodePrevSibling:function(D){var E,C,B,A=null;
C=this.getNodeParent(D);
if(C){E=this.getNodeChildren(C)
}else{E=this.getRootNodes()
}B=E.indexOf(D);
if(B>0){A=E[B-1]
}return A
},getRootNodes:function(){throw"Abstract method call"
},getNodeDepth:function(A){throw"Abstract method call"
},getNodeParent:function(A){throw"Abstract method call"
},getNodeChildren:function(A){throw"Abstract method call"
},addToNode:function(A,B){throw"Abstract method call"
},removeFromNode:function(A,B){throw"Abstract method call"
},getPageOffset:function(){return this.page_offset
},getActiveNodePageOffset:function(){var A;
if(this.active_node){A=this.getNodeChildrenOffset(this.active_node)
}else{A=this.getPageOffset()
}return A
},getActiveNodeCount:function(){var A;
if(this.active_node){A=this.getNodeChildrenCount(this.active_node)
}else{A=this.getRootNodes().length
}return A
},getActiveNodeTotalCount:function(){var A;
if(this.active_node){A=this.getNodeChildrenTotalCount(this.active_node)
}else{A=this.getTotalCount()
}return A
}});
CQ.Ext.ux.maximgb.tg.AdjacencyListStore=CQ.Ext.extend(CQ.Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var E,B,A=[],D=this.data.getRange();
for(E=0,B=D.length;
E<B;
E++){var C=D[E];
var F=C.get(this.parent_id_field_name);
if(F==null||this.getById(F)==null){A.push(D[E])
}}return A
},getNodeDepth:function(A){return this.getNodeAncestors(A).length
},getNodeParent:function(A){return this.getById(A.get(this.parent_id_field_name))
},getNodeChildren:function(E){var D,B,A=[],C=this.data.getRange();
for(D=0,B=C.length;
D<B;
D++){if(C[D].get(this.parent_id_field_name)==E.id){A.push(C[D])
}}return A
},addToNode:function(A,B){B.set(this.parent_id_field_name,A.id);
this.addSorted(B)
},removeFromNode:function(A,B){this.remove(B)
}});
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.AdjacencyListStore",CQ.Ext.ux.maximgb.tg.AdjacencyListStore);
CQ.Ext.ux.maximgb.tg.NestedSetStore=CQ.Ext.extend(CQ.Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var D,B,A=[],C=this.data.getRange();
for(D=0,B=C.length;
D<B;
D++){if(C[D].get(this.level_field_name)==this.root_node_level){A.push(C[D])
}}return A
},getNodeDepth:function(A){return A.get(this.level_field_name)-this.root_node_level
},getNodeParent:function(A){var L=null,G,F=this.data.getRange(),H,I,K,E,J,D,C,B;
K=A.get(this.left_field_name);
J=A.get(this.right_field_name);
C=A.get(this.level_field_name);
for(H=0,I=F.length;
H<I;
H++){G=F[H];
E=G.get(this.left_field_name);
D=G.get(this.right_field_name);
B=G.get(this.level_field_name);
if(B==C-1&&E<K&&D>J){L=G;
break
}}return L
},getNodeChildren:function(A){var I,E,H,D,B,C,F,G,J=[];
F=this.data.getRange();
I=A.get(this.left_field_name);
H=A.get(this.right_field_name);
B=A.get(this.level_field_name);
for(i=0,len=F.length;
i<len;
i++){G=F[i];
E=G.get(this.left_field_name);
D=G.get(this.right_field_name);
C=G.get(this.level_field_name);
if(C==B+1&&E>I&&D<H){J.push(G)
}}return J
}});
CQ.Ext.ux.maximgb.tg.GridView=CQ.Ext.extend(CQ.Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var A=this.templates||{};
if(!A.row){A.row=new CQ.Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody>","</table>","</div>")
}if(!A.mastercell){A.mastercell=new CQ.Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</div>","</td>")
}if(!A.treeui){A.treeui=new CQ.Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>")
}if(!A.elbow_line){A.elbow_line=new CQ.Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>')
}this.templates=A;
CQ.Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)
},doRender:function(F,H,N,A,M,R){var B=this.templates,E=B.cell,G=B.row,I=M-1;
var C="width:"+this.getTotalWidth()+";";
var U=[],O,V,P={},J={tstyle:C},L;
for(var Q=0,T=H.length;
Q<T;
Q++){L=H[Q];
O=[];
var K=(Q+A);
var D=this.renderRow(L,K,M,N,this.cm.getTotalWidth());
if(D===false){for(var S=0;
S<M;
S++){V=F[S];
P.id=V.id;
P.css=S==0?"x-grid3-cell-first ":(S==I?"x-grid3-cell-last ":"");
P.attr=P.cellAttr="";
P.value=V.renderer.call(V.scope,L.data[V.name],P,L,K,S,N);
P.style=V.style;
if(CQ.Ext.isEmpty(P.value)){P.value="&#160;"
}if(this.markDirty&&L.dirty&&typeof L.modified[V.name]!=="undefined"){P.css+=" x-grid3-dirty-cell"
}if(V.id==this.grid.master_column_id){P.treeui=this.renderCellTreeUI(L,N);
E=B.mastercell
}else{E=B.cell
}O[O.length]=E.apply(P)
}}else{O.push(D)
}var W=[];
if(R&&((K+1)%2==0)){W[0]="x-grid3-row-alt"
}if(L.dirty){W[1]=" x-grid3-dirty-row"
}J.cols=M;
if(this.getRowClass){W[2]=this.getRowClass(L,K,J,N)
}J.alt=W.join(" ");
J.cells=O.join("");
if(!N.isVisibleNode(L)){J.display_style="display: none;"
}else{J.display_style=""
}J.level=N.getNodeDepth(L);
U[U.length]=G.apply(J)
}return U.join("")
},renderCellTreeUI:function(A,B){var C=this.templates.treeui,H=this.templates.elbow_line,E={},G,D,F=level=B.getNodeDepth(A);
E.wrap_width=(F+1)*16;
if(level>0){E.elbow_line="";
G=A;
left=0;
while(level--){D=B.getNodeParent(G);
if(D){if(B.hasNextSiblingNode(D)){E.elbow_line=H.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+E.elbow_line
}else{E.elbow_line=H.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+E.elbow_line
}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",G.id,") parent."].join("")
}G=D
}}if(B.isLeafNode(A)){if(B.hasNextSiblingNode(A)){E.cls="ux-maximgb-tg-elbow"
}else{E.cls="ux-maximgb-tg-elbow-end"
}}else{E.cls="ux-maximgb-tg-elbow-active ";
if(B.isExpandedNode(A)){if(B.hasNextSiblingNode(A)){E.cls+=this.expanded_icon_class
}else{E.cls+=this.last_expanded_icon_class
}}else{if(B.hasNextSiblingNode(A)){E.cls+=this.collapsed_icon_class
}else{E.cls+=this.last_collapsed_icon_class
}}}E.left=1+F*16;
return C.apply(E)
},renderRow:function(A,B,E,D,C){return false
},afterRender:function(){CQ.Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);
this.updateAllColumnWidths()
},updateAllColumnWidths:function(){var D=this.getTotalWidth(),I=this.cm.getColumnCount(),F=[],E,B;
for(B=0;
B<I;
B++){F[B]=this.getColumnWidth(B)
}this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=D;
this.mainBody.dom.style.width=D;
for(B=0;
B<I;
B++){var C=this.getHeaderCell(B);
C.style.width=F[B]
}var H=this.getRows(),J,G;
for(B=0,E=H.length;
B<E;
B++){J=H[B];
J.style.width=D;
if(J.firstChild){J.firstChild.style.width=D;
G=J.firstChild.rows[0];
for(var A=0;
A<I&&A<G.childNodes.length;
A++){if(!CQ.Ext.fly(G.childNodes[A]).hasClass(this.skip_width_update_class)){G.childNodes[A].style.width=F[A]
}}}}this.onAllColumnWidthsUpdated(F,D)
},updateColumnWidth:function(B,A){var H=this.getColumnWidth(B);
var E=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=E;
this.mainBody.dom.style.width=E;
var D=this.getHeaderCell(B);
D.style.width=H;
var G=this.getRows(),I;
for(var C=0,F=G.length;
C<F;
C++){I=G[C];
I.style.width=E;
if(I.firstChild){I.firstChild.style.width=E;
if(B<I.firstChild.rows[0].childNodes.length){if(!CQ.Ext.fly(I.firstChild.rows[0].childNodes[B]).hasClass(this.skip_width_update_class)){I.firstChild.rows[0].childNodes[B].style.width=H
}}}}this.onColumnWidthUpdated(B,H,E)
},updateColumnHidden:function(A,E){var D=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=D;
this.mainBody.dom.style.width=D;
var G=E?"none":"";
var C=this.getHeaderCell(A);
C.style.display=G;
var H=this.getRows(),J,I;
for(var B=0,F=H.length;
B<F;
B++){J=H[B];
J.style.width=D;
if(J.firstChild){J.firstChild.style.width=D;
if(A<J.firstChild.rows[0].childNodes.length){if(!CQ.Ext.fly(J.firstChild.rows[0].childNodes[A]).hasClass(this.skip_width_update_class)){J.firstChild.rows[0].childNodes[A].style.display=G
}}}}this.onColumnHiddenUpdated(A,E,D);
delete this.lastViewWidth;
this.layout()
},processRows:function(A,D){var B=0;
if(this.ds.getCount()<1){return 
}D=!this.grid.stripeRows;
A=A||0;
var C=this.getRows();
var B=0;
CQ.Ext.each(C,function(F,E){F.rowIndex=E;
F.className=F.className.replace(this.rowClsRe," ");
if(F.style.display!="none"){if(!D&&((B+1)%2===0)){F.className+=" x-grid3-row-alt"
}B++
}},this);
CQ.Ext.fly(C[0]).addClass(this.firstRowCls);
CQ.Ext.fly(C[C.length-1]).addClass(this.lastRowCls)
},ensureVisible:function(E,B,D){var C,A=this.ds.getAt(E);
if(!this.ds.isVisibleNode(A)){C=this.ds.getNodeAncestors(A);
while(C.length>0){A=C.shift();
if(!this.ds.isExpandedNode(A)){this.ds.expandNode(A)
}}}return CQ.Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,E,B,D)
},expandRow:function(D,F){var B=this.ds,C,G,J,H,A,E,I;
if(typeof D=="number"){E=D;
D=B.getAt(E)
}else{E=B.indexOf(D)
}F=F||false;
J=this.getRow(E);
H=CQ.Ext.fly(J).child(".ux-maximgb-tg-elbow-active");
if(H){if(B.hasNextSiblingNode(D)){H.removeClass(this.collapsed_icon_class);
H.removeClass(this.last_collapsed_icon_class);
H.addClass(this.expanded_icon_class)
}else{H.removeClass(this.collapsed_icon_class);
H.removeClass(this.last_collapsed_icon_class);
H.addClass(this.last_expanded_icon_class)
}}if(B.isVisibleNode(D)){A=B.getNodeChildren(D);
for(C=0,G=A.length;
C<G;
C++){I=B.indexOf(A[C]);
J=this.getRow(I);
J.style.display="block";
if(B.isExpandedNode(A[C])){this.expandRow(I,true)
}}}if(!F){this.processRows(0)
}},collapseRow:function(D,E){var B=this.ds,C,G,A,I,F,H;
if(typeof D=="number"){F=D;
D=B.getAt(F)
}else{F=B.indexOf(D)
}E=E||false;
I=this.getRow(F);
pmel=CQ.Ext.fly(I).child(".ux-maximgb-tg-elbow-active");
if(pmel){if(B.hasNextSiblingNode(D)){pmel.removeClass(this.expanded_icon_class);
pmel.removeClass(this.last_expanded_icon_class);
pmel.addClass(this.collapsed_icon_class)
}else{pmel.removeClass(this.expanded_icon_class);
pmel.removeClass(this.last_expanded_icon_class);
pmel.addClass(this.last_collapsed_icon_class)
}}A=B.getNodeChildren(D);
for(C=0,G=A.length;
C<G;
C++){H=B.indexOf(A[C]);
I=this.getRow(H);
if(I.style.display!="none"){I.style.display="none";
this.collapseRow(H,true)
}}if(!E){this.processRows(0)
}},initData:function(B,A){CQ.Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,B,A);
if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);
this.ds.un("collapsenode",this.onStoreCollapseNode,this)
}if(B){B.on("expandnode",this.onStoreExpandNode,this);
B.on("collapsenode",this.onStoreCollapseNode,this)
}},onLoad:function(B,A,C){var D;
if(C&&C.params&&(C.params[B.paramNames.active_node]===null||B.indexOfId(C.params[B.paramNames.active_node])==-1)){CQ.Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,B,A,C)
}},onAdd:function(C,A,B){CQ.Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,C,A,B);
if(this.mainWrap){this.processRows(0)
}},onRemove:function(D,A,B,C){CQ.Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,D,A,B,C);
if(C!==true){if(this.mainWrap){this.processRows(0)
}}},onUpdate:function(B,A){CQ.Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,B,A);
if(this.mainWrap){this.processRows(0)
}},onStoreExpandNode:function(A,B){this.expandRow(B)
},onStoreCollapseNode:function(A,B){this.collapseRow(B)
}});
CQ.Ext.ux.maximgb.tg.GridPanel=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();
CQ.Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);
this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);
this.initComponentPostOverride()
},initComponentPreOverride:CQ.Ext.emptyFn,initComponentPostOverride:CQ.Ext.emptyFn,onRender:function(B,A){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,B,A);
this.el.addClass(this.tg_cls)
},getView:function(){if(!this.view){this.view=new CQ.Ext.ux.maximgb.tg.GridView(this.viewConfig)
}return this.view
},onClick:function(C){var D=C.getTarget(),F=this.getView(),I=F.findRowIndex(D),G=this.getStore(),A=this.getSelectionModel(),B,E,H=true;
if(I!==false){if(CQ.Ext.fly(D).hasClass("ux-maximgb-tg-elbow-active")){B=G.getAt(I);
if(G.isExpandedNode(B)){G.collapseNode(B)
}else{G.expandNode(B)
}H=false
}}if(H){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,C)
}},onMouseDown:function(B){var A=B.getTarget();
if(!CQ.Ext.fly(A).hasClass("ux-maximgb-tg-elbow-active")){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,B)
}},onTreeGridSelectionChange:function(E,D){var A,C,B=this.getStore();
if(E.getSelected){A=E.getSelected();
B.setActiveNode(A)
}else{if(E.getSelectedCell&&D){A=D.record;
B.setActiveNode(A)
}}if(A){if(!B.isVisibleNode(A)){C=B.getNodeAncestors(A);
while(C.length>0){B.expandNode(C.pop())
}}}}});
CQ.Ext.ux.maximgb.tg.EditorGridPanel=CQ.Ext.extend(CQ.Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();
CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);
this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);
this.initComponentPostOverride()
},initComponentPreOverride:CQ.Ext.emptyFn,initComponentPostOverride:CQ.Ext.emptyFn,onRender:function(B,A){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,B,A);
this.el.addClass("ux-maximgb-tg-panel")
},getView:function(){if(!this.view){this.view=new CQ.Ext.ux.maximgb.tg.GridView(this.viewConfig)
}return this.view
},onClick:function(C){var D=C.getTarget(),F=this.getView(),I=F.findRowIndex(D),G=this.getStore(),A=this.getSelectionModel(),B,E,H=true;
if(I!==false){if(CQ.Ext.fly(D).hasClass("ux-maximgb-tg-elbow-active")){B=G.getAt(I);
if(G.isExpandedNode(B)){G.collapseNode(B)
}else{G.expandNode(B)
}H=false
}}if(H){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,C)
}},onMouseDown:function(B){var A=B.getTarget();
if(!CQ.Ext.fly(A).hasClass("ux-maximgb-tg-elbow-active")){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,B)
}},onTreeGridSelectionChange:function(E,D){var A,C,B=this.getStore();
if(E.getSelected){A=E.getSelected();
B.setActiveNode(A)
}else{if(E.getSelectedCell&&D){A=D.record;
B.setActiveNode(A)
}}if(A){if(!B.isVisibleNode(A)){C=B.getNodeAncestors(A);
while(C.length>0){B.expandNode(C.pop())
}}}}});
CQ.Ext.ux.maximgb.tg.PagingToolbar=CQ.Ext.extend(CQ.Ext.PagingToolbar,{onRender:function(B,A){CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,B,A);
this.updateUI()
},getPageData:function(){var A=0,B=0;
if(this.store){B=this.store.getActiveNodePageOffset();
A=this.store.getActiveNodeTotalCount()
}return{total:A,activePage:Math.ceil((B+this.pageSize)/this.pageSize),pages:A<this.pageSize?1:Math.ceil(A/this.pageSize)}
},updateInfo:function(){var B=0,D=0,A=0,C;
if(this.displayItem){if(this.store){D=this.store.getActiveNodePageOffset();
B=this.store.getActiveNodeCount();
A=this.store.getActiveNodeTotalCount()
}C=B==0?this.emptyMsg:String.format(this.displayMsg,D+1,D+B,A);
this.displayItem.setText(C)
}},updateUI:function(){var C=this.getPageData(),A=C.activePage,B=C.pages;
this.afterTextItem.setText(String.format(this.afterPageText,C.pages));
this.inputItem.setValue(A);
this.first.setDisabled(A==1);
this.prev.setDisabled(A==1);
this.next.setDisabled(A==B);
this.last.setDisabled(A==B);
this.refresh.enable();
this.updateInfo()
},bindStore:function(A,B){if(!B&&this.store){this.store.un("activenodechange",this.onStoreActiveNodeChange,this)
}if(A){A.on("activenodechange",this.onStoreActiveNodeChange,this)
}CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,A,B)
},beforeLoad:function(A,B){var C=this.getParams();
CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,A,B);
if(B&&B.params){if(B.params[C.start]===undefined){B.params[C.start]=0
}if(B.params[C.limit]===undefined){B.params[C.limit]=this.pageSize
}}},moveFirst:function(){this.doLoad(0)
},movePrevious:function(){var A=this.store,B=A?A.getActiveNodePageOffset():0;
this.doLoad(Math.max(0,B-this.pageSize))
},moveNext:function(){var A=this.store,B=A?A.getActiveNodePageOffset():0;
this.doLoad(B+this.pageSize)
},moveLast:function(){var B=this.store,D=B?B.getActiveNodePageOffset():0,C=B?B.getActiveNodeTotalCount():0,A=C%this.pageSize;
this.doLoad(A?(C-A):C-this.pageSize)
},onStoreActiveNodeChange:function(B,C,A){if(this.rendered){this.updateUI()
}}});
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.GridPanel",CQ.Ext.ux.maximgb.tg.GridPanel);
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.EditorGridPanel",CQ.Ext.ux.maximgb.tg.EditorGridPanel);
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.PagingToolbar",CQ.Ext.ux.maximgb.tg.PagingToolbar);
CQ.menu.TitleSeparator=CQ.Ext.extend(CQ.Ext.menu.Separator,{title:null,constructor:function(A){A=A||{};
CQ.Util.applyDefaults(A,{title:"&#160;"});
CQ.menu.TitleSeparator.superclass.constructor.call(this,A)
},onRender:function(A){var B=document.createElement("span");
B.className=this.itemCls+" cq-menu-title-sep";
B.innerHTML=this.title;
this.el=B;
A.addClass("x-menu-sep-li");
A.addClass("cq-menu-title-sep-li");
CQ.Ext.menu.Separator.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("titleseparator",CQ.menu.TitleSeparator);
var SWFUpload=function(A){this.initSWFUpload(A)
};
SWFUpload.prototype.initSWFUpload=function(B){try{this.customSettings={};
this.settings=B;
this.eventQueue=[];
this.movieName="SWFUpload_"+SWFUpload.movieCount++;
this.movieElement=null;
SWFUpload.instances[this.movieName]=this;
this.initSettings();
this.loadFlash();
this.displayDebugInfo()
}catch(A){delete SWFUpload.instances[this.movieName];
throw A
}};
SWFUpload.instances={};
SWFUpload.movieCount=0;
SWFUpload.version="2.2.0 Alpha";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};
SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};
SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(B,A){this.settings[B]=(this.settings[B]==undefined)?A:this.settings[B]
};
this.ensureDefault("upload_url","");
this.ensureDefault("file_post_name","Filedata");
this.ensureDefault("post_params",{});
this.ensureDefault("use_query_string",false);
this.ensureDefault("requeue_on_error",false);
this.ensureDefault("file_types","*.*");
this.ensureDefault("file_types_description","All Files");
this.ensureDefault("file_size_limit",0);
this.ensureDefault("file_upload_limit",0);
this.ensureDefault("file_queue_limit",0);
this.ensureDefault("flash_url","swfupload.swf");
this.ensureDefault("prevent_swf_caching",true);
this.ensureDefault("button_image_url","");
this.ensureDefault("button_width",1);
this.ensureDefault("button_height",1);
this.ensureDefault("button_text","");
this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);
this.ensureDefault("button_text_left_padding",0);
this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);
this.ensureDefault("button_disabled",false);
this.ensureDefault("button_placeholder_id",null);
this.ensureDefault("debug",false);
this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;
this.ensureDefault("swfupload_loaded_handler",null);
this.ensureDefault("file_dialog_start_handler",null);
this.ensureDefault("file_queued_handler",null);
this.ensureDefault("file_queue_error_handler",null);
this.ensureDefault("file_dialog_complete_handler",null);
this.ensureDefault("upload_start_handler",null);
this.ensureDefault("upload_progress_handler",null);
this.ensureDefault("upload_error_handler",null);
this.ensureDefault("upload_success_handler",null);
this.ensureDefault("upload_complete_handler",null);
this.ensureDefault("debug_handler",this.debugMessage);
this.ensureDefault("custom_settings",{});
this.customSettings=this.settings.custom_settings;
if(this.settings.prevent_swf_caching){this.settings.flash_url=CQ.shared.HTTP.getXhrHookedURL(this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999))
}delete this.ensureDefault
};
SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()
}else{this.appendFlash()
}};
SWFUpload.prototype.appendFlash=function(){var B,A;
if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"
}B=document.getElementsByTagName("body")[0];
if(B==undefined){throw"Could not find the 'body' element."
}A=document.createElement("div");
A.style.width="1px";
A.style.height="1px";
A.style.overflow="hidden";
B.appendChild(A);
A.innerHTML=this.getFlashHTML()
};
SWFUpload.prototype.replaceWithFlash=function(){var A,B;
if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"
}A=document.getElementById(this.settings.button_placeholder_id);
if(A==undefined){throw"Could not find the placeholder element."
}B=document.createElement("div");
B.innerHTML=this.getFlashHTML();
A.parentNode.replaceChild(B.firstChild,A)
};
SWFUpload.prototype.getFlashHTML=function(){var A=this.settings.button_image_url===""?true:false;
return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',A?"transparent":"window",'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="sameDomain" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")
};
SWFUpload.prototype.getFlashVars=function(){var A=this.buildParamString();
return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;params=",encodeURIComponent(A),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled)].join("")
};
SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)
}if(this.movieElement===null){throw"Could not find Flash element"
}return this.movieElement
};
SWFUpload.prototype.buildParamString=function(){var C=this.settings.post_params;
var B=[];
if(typeof (C)==="object"){for(var A in C){if(C.hasOwnProperty(A)){B.push(encodeURIComponent(A.toString())+"="+encodeURIComponent(C[A].toString()))
}}}return B.join("&amp;")
};
SWFUpload.prototype.destroy=function(){try{this.stopUpload();
var B=null;
try{B=this.getMovieElement()
}catch(C){}if(B!=undefined&&B.parentNode!=undefined&&typeof B.parentNode.removeChild==="function"){var A=B.parentNode;
if(A!=undefined){A.removeChild(B);
if(A.parentNode!=undefined&&typeof A.parentNode.removeChild==="function"){A.parentNode.removeChild(A)
}}}SWFUpload.instances[this.movieName]=null;
delete SWFUpload.instances[this.movieName];
delete this.movieElement;
delete this.settings;
delete this.customSettings;
delete this.eventQueue;
delete this.movieName;
if(window[this.movieName]){delete window[this.movieName]
}return true
}catch(D){return false
}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))
};
SWFUpload.prototype.addSetting=function(B,C,A){if(C==undefined){return(this.settings[B]=A)
}else{return(this.settings[B]=C)
}};
SWFUpload.prototype.getSetting=function(A){if(this.settings[A]!=undefined){return this.settings[A]
}return""
};
SWFUpload.prototype.callFlash=function(C,D){D=D||[];
var A=this.getMovieElement();
var B;
if(typeof A[C]==="function"){if(D.length===0){B=A[C]()
}else{if(D.length===1){B=A[C](D[0])
}else{if(D.length===2){B=A[C](D[0],D[1])
}else{if(D.length===3){B=A[C](D[0],D[1],D[2])
}else{throw"Too many arguments"
}}}}if(B!=undefined&&typeof B.post==="object"){B=this.unescapeFilePostParams(B)
}return B
}else{throw"Invalid function name: "+C
}};
SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")
};
SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")
};
SWFUpload.prototype.startUpload=function(A){this.callFlash("StartUpload",[A])
};
SWFUpload.prototype.cancelUpload=function(A){this.callFlash("CancelUpload",[A])
};
SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")
};
SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")
};
SWFUpload.prototype.setStats=function(A){this.callFlash("SetStats",[A])
};
SWFUpload.prototype.getFile=function(A){if(typeof (A)==="number"){return this.callFlash("GetFileByIndex",[A])
}else{return this.callFlash("GetFile",[A])
}};
SWFUpload.prototype.addFileParam=function(A,B,C){return this.callFlash("AddFileParam",[A,B,C])
};
SWFUpload.prototype.removeFileParam=function(A,B){this.callFlash("RemoveFileParam",[A,B])
};
SWFUpload.prototype.setUploadURL=function(A){this.settings.upload_url=CQ.shared.HTTP.getXhrHookedURL(A.toString());
this.callFlash("SetUploadURL",[A])
};
SWFUpload.prototype.setPostParams=function(A){this.settings.post_params=A;
this.callFlash("SetPostParams",[A])
};
SWFUpload.prototype.addPostParam=function(A,B){this.settings.post_params[A]=B;
this.callFlash("SetPostParams",[this.settings.post_params])
};
SWFUpload.prototype.removePostParam=function(A){delete this.settings.post_params[A];
this.callFlash("SetPostParams",[this.settings.post_params])
};
SWFUpload.prototype.setFileTypes=function(A,B){this.settings.file_types=A;
this.settings.file_types_description=B;
this.callFlash("SetFileTypes",[A,B])
};
SWFUpload.prototype.setFileSizeLimit=function(A){this.settings.file_size_limit=A;
this.callFlash("SetFileSizeLimit",[A])
};
SWFUpload.prototype.setFileUploadLimit=function(A){this.settings.file_upload_limit=A;
this.callFlash("SetFileUploadLimit",[A])
};
SWFUpload.prototype.setFileQueueLimit=function(A){this.settings.file_queue_limit=A;
this.callFlash("SetFileQueueLimit",[A])
};
SWFUpload.prototype.setFilePostName=function(A){this.settings.file_post_name=A;
this.callFlash("SetFilePostName",[A])
};
SWFUpload.prototype.setUseQueryString=function(A){this.settings.use_query_string=A;
this.callFlash("SetUseQueryString",[A])
};
SWFUpload.prototype.setRequeueOnError=function(A){this.settings.requeue_on_error=A;
this.callFlash("SetRequeueOnError",[A])
};
SWFUpload.prototype.setDebugEnabled=function(A){this.settings.debug_enabled=A;
this.callFlash("SetDebugEnabled",[A])
};
SWFUpload.prototype.setButtonImageURL=function(A){if(A==undefined){A=""
}this.settings.button_image_url=A;
this.callFlash("SetButtonImageURL",[A])
};
SWFUpload.prototype.setButtonDimensions=function(C,A){this.settings.button_width=C;
this.settings.button_height=A;
var B=this.getMovieElement();
if(B!=undefined){B.style.width=C+"px";
B.style.height=A+"px"
}this.callFlash("SetButtonDimensions",[C,A])
};
SWFUpload.prototype.setButtonText=function(A){this.settings.button_text=A;
this.callFlash("SetButtonText",[A])
};
SWFUpload.prototype.setButtonTextPadding=function(B,A){this.settings.button_text_top_padding=A;
this.settings.button_text_left_padding=B;
this.callFlash("SetButtonTextPadding",[B,A])
};
SWFUpload.prototype.setButtonTextStyle=function(A){this.settings.button_text_style=A;
this.callFlash("SetButtonTextStyle",[A])
};
SWFUpload.prototype.setButtonDisabled=function(A){this.settings.button_disabled=A;
this.callFlash("SetButtonDisabled",[A])
};
SWFUpload.prototype.setButtonAction=function(A){this.settings.button_action=A;
this.callFlash("SetButtonAction",[A])
};
SWFUpload.prototype.queueEvent=function(B,C){if(C==undefined){C=[]
}else{if(!(C instanceof Array)){C=[C]
}}var A=this;
if(typeof this.settings[B]==="function"){this.eventQueue.push(function(){this.settings[B].apply(this,C)
});
setTimeout(function(){A.executeNextEvent()
},0)
}else{if(this.settings[B]!==null){throw"Event handler "+B+" is unknown or is not a function"
}}};
SWFUpload.prototype.executeNextEvent=function(){var A=this.eventQueue?this.eventQueue.shift():null;
if(typeof (A)==="function"){A.apply(this)
}};
SWFUpload.prototype.unescapeFilePostParams=function(C){var E=/[$]([0-9a-f]{4})/i;
var F={};
var D;
if(C!=undefined){for(var A in C.post){if(C.post.hasOwnProperty(A)){D=A;
var B;
while((B=E.exec(D))!==null){D=D.replace(B[0],String.fromCharCode(parseInt("0x"+B[1],16)))
}F[D]=C.post[A]
}}C.post=F
}return C
};
SWFUpload.prototype.flashReady=function(){var A=this.getMovieElement();
if(typeof A.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."
}if(window[this.movieName]==undefined){window[this.movieName]=A
}this.queueEvent("swfupload_loaded_handler")
};
SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")
};
SWFUpload.prototype.fileQueued=function(A){A=this.unescapeFilePostParams(A);
this.queueEvent("file_queued_handler",A)
};
SWFUpload.prototype.fileQueueError=function(A,C,B){A=this.unescapeFilePostParams(A);
this.queueEvent("file_queue_error_handler",[A,C,B])
};
SWFUpload.prototype.fileDialogComplete=function(A,B){this.queueEvent("file_dialog_complete_handler",[A,B])
};
SWFUpload.prototype.uploadStart=function(A){A=this.unescapeFilePostParams(A);
this.queueEvent("return_upload_start_handler",A)
};
SWFUpload.prototype.returnUploadStart=function(A){var B;
if(typeof this.settings.upload_start_handler==="function"){A=this.unescapeFilePostParams(A);
B=this.settings.upload_start_handler.call(this,A)
}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"
}}if(B===undefined){B=true
}B=!!B;
this.callFlash("ReturnUploadStart",[B])
};
SWFUpload.prototype.uploadProgress=function(A,C,B){A=this.unescapeFilePostParams(A);
this.queueEvent("upload_progress_handler",[A,C,B])
};
SWFUpload.prototype.uploadError=function(A,C,B){A=this.unescapeFilePostParams(A);
this.queueEvent("upload_error_handler",[A,C,B])
};
SWFUpload.prototype.uploadSuccess=function(B,A){B=this.unescapeFilePostParams(B);
this.queueEvent("upload_success_handler",[B,A])
};
SWFUpload.prototype.uploadComplete=function(A){A=this.unescapeFilePostParams(A);
this.queueEvent("upload_complete_handler",A)
};
SWFUpload.prototype.debug=function(A){this.queueEvent("debug_handler",A)
};
SWFUpload.prototype.debugMessage=function(C){if(this.settings.debug){var A,D=[];
if(typeof C==="object"&&typeof C.name==="string"&&typeof C.message==="string"){for(var B in C){if(C.hasOwnProperty(B)){D.push(B+": "+C[B])
}}A=D.join("\n")||"";
D=A.split("\n");
A="EXCEPTION: "+D.join("\nEXCEPTION: ");
SWFUpload.Console.writeLine(A)
}else{SWFUpload.Console.writeLine(C)
}}};
SWFUpload.Console={};
SWFUpload.Console.writeLine=function(D){var B,A;
try{B=document.getElementById("SWFUpload_Console");
if(!B){A=document.createElement("form");
document.getElementsByTagName("body")[0].appendChild(A);
B=document.createElement("textarea");
B.id="SWFUpload_Console";
B.style.fontFamily="monospace";
B.setAttribute("wrap","off");
B.wrap="off";
B.style.overflow="auto";
B.style.width="700px";
B.style.height="350px";
B.style.margin="5px";
A.appendChild(B)
}B.value+=D+"\n";
B.scrollTop=B.scrollHeight-B.clientHeight
}catch(C){alert("Exception: "+C.name+" Message: "+C.message)
}};
if(!document.createElement("canvas").getContext){(function(){var y=Math;
var J=y.round;
var I=y.sin;
var R=y.cos;
var X=y.abs;
var g=y.sqrt;
var D=10;
var F=D/2;
function AC(Z){return String(Z).replace(/&/g,"&amp;").replace(/"/g,"&quot;")
}function q(j){if(!j.namespaces.g_vml_){j.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")
}if(!j.namespaces.g_o_){j.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")
}if(!j.styleSheets.ex_canvas_){var Z=j.createStyleSheet();
Z.owningElement.id="ex_canvas_";
Z.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"
}}q(document);
var E={init:function(m){var AE=m||document;
if(/MSIE/.test(navigator.userAgent)&&!window.opera){var Z=this;
var j=function(){Z.init_(AE)
};
AE.attachEvent("onreadystatechange",j);
var AD=document.parentWindow;
var AF=function(){AE.detachEvent("onreadystatechange",j);
AD.detachEvent("onunload",AF)
};
AD.attachEvent("onunload",AF)
}},init_:function(m){var j=m.getElementsByTagName("canvas");
for(var Z=0;
Z<j.length;
Z++){this.initElement(j[Z])
}},fixElement_:function(m){var AE=m.outerHTML;
var AD=m.ownerDocument.createElement(AE);
if(AE.slice(-2)!="/>"){var Z="/"+m.tagName;
var j;
while((j=m.nextSibling)&&j.tagName!=Z){j.removeNode()
}if(j){j.removeNode()
}}m.parentNode.replaceChild(AD,m);
return AD
},initElement:function(j){j=this.fixElement_(j);
j.getContext=function(){if(this.context_){return this.context_
}return this.context_=new T(this)
};
q(j.ownerDocument);
j.innerHTML="";
j.attachEvent("onpropertychange",Q);
j.attachEvent("onresize",v);
var Z=j.attributes;
if(Z.width&&Z.width.specified){j.style.width=Z.width.nodeValue+"px"
}else{j.width=j.clientWidth
}if(Z.height&&Z.height.specified){j.style.height=Z.height.nodeValue+"px"
}else{j.height=j.clientHeight
}return j
}};
function Q(j){var Z=j.srcElement;
switch(j.propertyName){case"width":Z.getContext().clearRect();
Z.style.width=Z.attributes.width.nodeValue+"px";
Z.firstChild.style.width=Z.clientWidth+"px";
break;
case"height":Z.getContext().clearRect();
Z.style.height=Z.attributes.height.nodeValue+"px";
Z.firstChild.style.height=Z.clientHeight+"px";
break
}}function v(j){var Z=j.srcElement;
if(Z.firstChild){Z.firstChild.style.width=Z.clientWidth+"px";
Z.firstChild.style.height=Z.clientHeight+"px"
}}E.init();
var H=[];
for(var AB=0;
AB<16;
AB++){for(var AA=0;
AA<16;
AA++){H[AB*16+AA]=AB.toString(16)+AA.toString(16)
}}function S(){return[[1,0,0],[0,1,0],[0,0,1]]
}function a(AD,m){var j=S();
for(var Z=0;
Z<3;
Z++){for(var AG=0;
AG<3;
AG++){var AE=0;
for(var AF=0;
AF<3;
AF++){AE+=AD[Z][AF]*m[AF][AG]
}j[Z][AG]=AE
}}return j
}function O(j,Z){Z.fillStyle=j.fillStyle;
Z.lineCap=j.lineCap;
Z.lineJoin=j.lineJoin;
Z.lineWidth=j.lineWidth;
Z.miterLimit=j.miterLimit;
Z.shadowBlur=j.shadowBlur;
Z.shadowColor=j.shadowColor;
Z.shadowOffsetX=j.shadowOffsetX;
Z.shadowOffsetY=j.shadowOffsetY;
Z.strokeStyle=j.strokeStyle;
Z.font=j.font;
Z.textAlign=j.textAlign;
Z.textBaseline=j.textBaseline;
Z.arcScaleX_=j.arcScaleX_;
Z.arcScaleY_=j.arcScaleY_;
Z.lineScale_=j.lineScale_;
Z.rotation_=j.rotation_
}var B={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",grey:"#808080",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",oldlace:"#FDF5E6",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",whitesmoke:"#F5F5F5",yellowgreen:"#9ACD32"};
function d(j){var AD=j.indexOf("(",3);
var Z=j.indexOf(")",AD+1);
var m=j.substring(AD+1,Z).split(",");
if(m.length==4&&j.substr(3,1)=="a"){alpha=Number(m[3])
}else{m[3]=1
}return m
}function C(Z){return parseFloat(Z)/100
}function M(j,m,Z){return Math.min(Z,Math.max(m,j))
}function Y(AF){var m,j,Z;
h=parseFloat(AF[0])/360%360;
if(h<0){h++
}s=M(C(AF[1]),0,1);
l=M(C(AF[2]),0,1);
if(s==0){m=j=Z=l
}else{var AD=l<0.5?l*(1+s):l+s-l*s;
var AE=2*l-AD;
m=A(AE,AD,h+1/3);
j=A(AE,AD,h);
Z=A(AE,AD,h-1/3)
}return"#"+H[Math.floor(m*255)]+H[Math.floor(j*255)]+H[Math.floor(Z*255)]
}function A(j,Z,m){if(m<0){m++
}if(m>1){m--
}if(6*m<1){return j(Z-j)*6*m
}else{if(2*m<1){return Z
}else{if(3*m<2){return j+(Z-j)*(2/3-m)*6
}else{return j
}}}}function V(Z){var AE,AD=1;
Z=String(Z);
if(Z.charAt(0)=="#"){AE=Z
}else{if(/^rgb/.test(Z)){var m=d(Z);
var AE="#",AF;
for(var j=0;
j<3;
j++){if(m[j].indexOf("%")!=-1){AF=Math.floor(C(m[j])*255)
}else{AF=Number(m[j])
}AE+=H[M(AF,0,255)]
}AD=m[3]
}else{if(/^hsl/.test(Z)){var m=d(Z);
AE=Y(m);
AD=m[3]
}else{AE=B[Z]||Z
}}}return{color:AE,alpha:AD}
}var K={style:"normal",variant:"normal",weight:"normal",size:10,family:"sans-serif"};
var c={};
function U(Z){if(c[Z]){return c[Z]
}var AD=document.createElement("div");
var m=AD.style;
try{m.font=Z
}catch(j){}return c[Z]={style:m.fontStyle||K.style,variant:m.fontVariant||K.variant,weight:m.fontWeight||K.weight,size:m.fontSize||K.size,family:m.fontFamily||K.family}
}function N(m,j){var Z={};
for(var AF in m){Z[AF]=m[AF]
}var AE=parseFloat(j.currentStyle.fontSize),AD=parseFloat(m.size);
if(typeof m.size=="number"){Z.size=m.size
}else{if(m.size.indexOf("px")!=-1){Z.size=AD
}else{if(m.size.indexOf("em")!=-1){Z.size=AE*AD
}else{if(m.size.indexOf("%")!=-1){Z.size=(AE/100)*AD
}else{if(m.size.indexOf("pt")!=-1){Z.size=AE*(4/3)*AD
}else{Z.size=AE
}}}}}Z.size*=0.981;
return Z
}function z(Z){return Z.style+" "+Z.variant+" "+Z.weight+" "+Z.size+"px "+Z.family
}function r(Z){switch(Z){case"butt":return"flat";
case"round":return"round";
case"square":default:return"square"
}}function T(j){this.m_=S();
this.mStack_=[];
this.aStack_=[];
this.currentPath_=[];
this.strokeStyle="#000";
this.fillStyle="#000";
this.lineWidth=1;
this.lineJoin="miter";
this.lineCap="butt";
this.miterLimit=D*1;
this.globalAlpha=1;
this.font="10px sans-serif";
this.textAlign="left";
this.textBaseline="alphabetic";
this.canvas=j;
var Z=j.ownerDocument.createElement("div");
Z.style.width=j.clientWidth+"px";
Z.style.height=j.clientHeight+"px";
Z.style.overflow="hidden";
Z.style.position="absolute";
j.appendChild(Z);
this.element_=Z;
this.arcScaleX_=1;
this.arcScaleY_=1;
this.lineScale_=1;
this.rotation_=0
}var L=T.prototype;
L.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null
}this.element_.innerHTML=""
};
L.beginPath=function(){this.currentPath_=[]
};
L.moveTo=function(j,Z){var m=this.getCoords_(j,Z);
this.currentPath_.push({type:"moveTo",x:m.x,y:m.y});
this.currentX_=m.x;
this.currentY_=m.y
};
L.lineTo=function(j,Z){var m=this.getCoords_(j,Z);
this.currentPath_.push({type:"lineTo",x:m.x,y:m.y});
this.currentX_=m.x;
this.currentY_=m.y
};
L.bezierCurveTo=function(m,j,AI,AH,AG,AE){var Z=this.getCoords_(AG,AE);
var AF=this.getCoords_(m,j);
var AD=this.getCoords_(AI,AH);
b(this,AF,AD,Z)
};
function b(Z,AD,m,j){Z.currentPath_.push({type:"bezierCurveTo",cp1x:AD.x,cp1y:AD.y,cp2x:m.x,cp2y:m.y,x:j.x,y:j.y});
Z.currentX_=j.x;
Z.currentY_=j.y
}L.quadraticCurveTo=function(AG,m,j,Z){var AF=this.getCoords_(AG,m);
var AE=this.getCoords_(j,Z);
var AH={x:this.currentX_+2/3*(AF.x-this.currentX_),y:this.currentY_+2/3*(AF.y-this.currentY_)};
var AD={x:AH.x+(AE.x-this.currentX_)/3,y:AH.y+(AE.y-this.currentY_)/3};
b(this,AH,AD,AE)
};
L.arc=function(AJ,AH,AI,AE,j,m){AI*=D;
var AN=m?"at":"wa";
var AK=AJ+R(AE)*AI-F;
var AM=AH+I(AE)*AI-F;
var Z=AJ+R(j)*AI-F;
var AL=AH+I(j)*AI-F;
if(AK==Z&&!m){AK+=0.125
}var AD=this.getCoords_(AJ,AH);
var AG=this.getCoords_(AK,AM);
var AF=this.getCoords_(Z,AL);
this.currentPath_.push({type:AN,x:AD.x,y:AD.y,radius:AI,xStart:AG.x,yStart:AG.y,xEnd:AF.x,yEnd:AF.y})
};
L.rect=function(m,j,Z,AD){this.moveTo(m,j);
this.lineTo(m+Z,j);
this.lineTo(m+Z,j+AD);
this.lineTo(m,j+AD);
this.closePath()
};
L.strokeRect=function(m,j,Z,AD){var AE=this.currentPath_;
this.beginPath();
this.moveTo(m,j);
this.lineTo(m+Z,j);
this.lineTo(m+Z,j+AD);
this.lineTo(m,j+AD);
this.closePath();
this.stroke();
this.currentPath_=AE
};
L.fillRect=function(m,j,Z,AD){var AE=this.currentPath_;
this.beginPath();
this.moveTo(m,j);
this.lineTo(m+Z,j);
this.lineTo(m+Z,j+AD);
this.lineTo(m,j+AD);
this.closePath();
this.fill();
this.currentPath_=AE
};
L.createLinearGradient=function(j,AD,Z,m){var AE=new u("gradient");
AE.x0_=j;
AE.y0_=AD;
AE.x1_=Z;
AE.y1_=m;
return AE
};
L.createRadialGradient=function(AD,AF,m,j,AE,Z){var AG=new u("gradientradial");
AG.x0_=AD;
AG.y0_=AF;
AG.r0_=m;
AG.x1_=j;
AG.y1_=AE;
AG.r1_=Z;
return AG
};
L.drawImage=function(AS){var AJ,AH,AL,AZ,AQ,AO,AU,Ad;
var Z=AS.runtimeStyle.width;
if(Z){var AK=AS.runtimeStyle.width;
var AR=AS.runtimeStyle.height;
AS.runtimeStyle.width="auto";
AS.runtimeStyle.height="auto"
}var AI=AS.width;
var AX=AS.height;
if(Z){AS.runtimeStyle.width=AK;
AS.runtimeStyle.height=AR
}if(arguments.length==3){AJ=arguments[1];
AH=arguments[2];
AQ=AO=0;
AU=AL=AI;
Ad=AZ=AX
}else{if(arguments.length==5){AJ=arguments[1];
AH=arguments[2];
AL=arguments[3];
AZ=arguments[4];
AQ=AO=0;
AU=AI;
Ad=AX
}else{if(arguments.length==9){AQ=arguments[1];
AO=arguments[2];
AU=arguments[3];
Ad=arguments[4];
AJ=arguments[5];
AH=arguments[6];
AL=arguments[7];
AZ=arguments[8]
}else{throw Error("Invalid number of arguments")
}}}var Aa=this.getCoords_(AJ,AH);
var AE=AU/2;
var AD=Ad/2;
var AY=[];
var j=10;
var AG=10;
var Ac=scaleY=1;
AY.push(' <div style="position:absolute;');
if(this.m_[0][0]!=1||this.m_[0][1]||this.m_[1][1]!=1||this.m_[1][0]){var AF=[];
var Ab=R(this.rotation_);
var AM=I(this.rotation_);
var AN=[[Ab,-AM,0],[AM,Ab,0],[0,0,1]];
var m=a(AN,this.m_);
Ac=m[0][0];
scaleY=m[1][1];
AF.push("M11=",Ab,",","M12=",-AM,",","M21=",AM,",","M22=",Ab,",","Dx=",Aa.x/D,",","Dy=",Aa.y/D);
var AW=Aa;
var AV=this.getCoords_(AJ+AL,AH);
var AT=this.getCoords_(AJ,AH+AZ);
var AP=this.getCoords_(AJ+AL,AH+AZ);
AW.x=y.max(AW.x,AV.x,AT.x,AP.x);
AW.y=y.max(AW.y,AV.y,AT.y,AP.y);
AY.push("padding:0 ",J(AW.x/D),"px ",J(AW.y/D),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",AF.join(""),", sizingmethod='clip');")
}else{AY.push("top:",J(Aa.y/D),"px;left:",J(Aa.x/D),"px;")
}AY.push(' ">');
if(AQ||AO){AY.push('<div style="overflow: hidden; width:',Math.ceil((AL+AQ*AL/AU)*Ac),"px;"," height:",Math.ceil((AZ+AO*AZ/Ad)*scaleY),"px;"," filter:progid:DxImageTransform.Microsoft.Matrix(Dx=",-AQ*AL/AU*Ac,",Dy=",-AO*AZ/Ad*scaleY,');">')
}AY.push('<div style="width:',Math.round(Ac*AI*AL/AU),"px;"," height:",Math.round(scaleY*AX*AZ/Ad),"px;"," filter:");
if(this.globalAlpha<1){AY.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+(this.globalAlpha*100)+")")
}AY.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",AS.src,',sizingMethod=scale)">');
if(AQ||AO){AY.push("</div>")
}AY.push("</div></div>");
this.element_.insertAdjacentHTML("beforeEnd",AY.join(""))
};
L.stroke=function(AI){var AG=[];
var m=false;
var j=10;
var AJ=10;
AG.push("<g_vml_:shape",' filled="',!!AI,'"',' style="position:absolute;width:',j,"px;height:",AJ,'px;"',' coordorigin="0,0"',' coordsize="',D*j,",",D*AJ,'"',' stroked="',!AI,'"',' path="');
var AK=false;
var AD={x:null,y:null};
var AH={x:null,y:null};
for(var AE=0;
AE<this.currentPath_.length;
AE++){var Z=this.currentPath_[AE];
var AF;
switch(Z.type){case"moveTo":AF=Z;
AG.push(" m ",J(Z.x),",",J(Z.y));
break;
case"lineTo":AG.push(" l ",J(Z.x),",",J(Z.y));
break;
case"close":AG.push(" x ");
Z=null;
break;
case"bezierCurveTo":AG.push(" c ",J(Z.cp1x),",",J(Z.cp1y),",",J(Z.cp2x),",",J(Z.cp2y),",",J(Z.x),",",J(Z.y));
break;
case"at":case"wa":AG.push(" ",Z.type," ",J(Z.x-this.arcScaleX_*Z.radius),",",J(Z.y-this.arcScaleY_*Z.radius)," ",J(Z.x+this.arcScaleX_*Z.radius),",",J(Z.y+this.arcScaleY_*Z.radius)," ",J(Z.xStart),",",J(Z.yStart)," ",J(Z.xEnd),",",J(Z.yEnd));
break
}if(Z){if(AD.x==null||Z.x<AD.x){AD.x=Z.x
}if(AH.x==null||Z.x>AH.x){AH.x=Z.x
}if(AD.y==null||Z.y<AD.y){AD.y=Z.y
}if(AH.y==null||Z.y>AH.y){AH.y=Z.y
}}}AG.push(' ">');
if(!AI){P(this,AG)
}else{W(this,AG,AD,AH)
}AG.push("</g_vml_:shape>");
this.element_.insertAdjacentHTML("beforeEnd",AG.join(""))
};
function P(m,AF){var j=V(m.strokeStyle);
var AD=j.color;
var AE=j.alpha*m.globalAlpha;
var Z=m.lineScale_*m.lineWidth;
if(Z<1){AE*=Z
}AF.push("<g_vml_:stroke",' opacity="',AE,'"',' joinstyle="',m.lineJoin,'"',' miterlimit="',m.miterLimit,'"',' endcap="',r(m.lineCap),'"',' weight="',Z,'px"',' color="',AD,'" />')
}function W(AO,AG,Ah,AP){var AH=AO.fillStyle;
var AY=AO.arcScaleX_;
var AX=AO.arcScaleY_;
var Z=AP.x-Ah.x;
var m=AP.y-Ah.y;
if(AH instanceof u){var AL=0;
var Ac={x:0,y:0};
var AU=0;
var AK=1;
if(AH.type_=="gradient"){var AJ=AH.x0_/AY;
var j=AH.y0_/AX;
var AI=AH.x1_/AY;
var Aj=AH.y1_/AX;
var Ag=AO.getCoords_(AJ,j);
var Af=AO.getCoords_(AI,Aj);
var AE=Af.x-Ag.x;
var AD=Af.y-Ag.y;
AL=Math.atan2(AE,AD)*180/Math.PI;
if(AL<0){AL+=360
}if(AL<0.000001){AL=0
}}else{var Ag=AO.getCoords_(AH.x0_,AH.y0_);
Ac={x:(Ag.x-Ah.x)/Z,y:(Ag.y-Ah.y)/m};
Z/=AY*D;
m/=AX*D;
var Aa=y.max(Z,m);
AU=2*AH.r0_/Aa;
AK=2*AH.r1_/Aa-AU
}var AS=AH.colors_;
AS.sort(function(Al,Ak){return Al.offset-Ak.offset
});
var AN=AS.length;
var AR=AS[0].color;
var AQ=AS[AN-1].color;
var AW=AS[0].alpha*AO.globalAlpha;
var AV=AS[AN-1].alpha*AO.globalAlpha;
var Ab=[];
for(var Ae=0;
Ae<AN;
Ae++){var AM=AS[Ae];
Ab.push(AM.offset*AK+AU+" "+AM.color)
}AG.push('<g_vml_:fill type="',AH.type_,'"',' method="none" focus="100%"',' color="',AR,'"',' color2="',AQ,'"',' colors="',Ab.join(","),'"',' opacity="',AV,'"',' g_o_:opacity2="',AW,'"',' angle="',AL,'"',' focusposition="',Ac.x,",",Ac.y,'" />')
}else{if(AH instanceof t){if(Z&&m){var AF=-Ah.x;
var AZ=-Ah.y;
AG.push("<g_vml_:fill",' position="',AF/Z*AY*AY,",",AZ/m*AX*AX,'"',' type="tile"',' src="',AH.src_,'" />')
}}else{var Ai=V(AO.fillStyle);
var AT=Ai.color;
var Ad=Ai.alpha*AO.globalAlpha;
AG.push('<g_vml_:fill color="',AT,'" opacity="',Ad,'" />')
}}}L.fill=function(){this.stroke(true)
};
L.closePath=function(){this.currentPath_.push({type:"close"})
};
L.getCoords_=function(AD,j){var Z=this.m_;
return{x:D*(AD*Z[0][0]+j*Z[1][0]+Z[2][0])-F,y:D*(AD*Z[0][1]+j*Z[1][1]+Z[2][1])-F}
};
L.save=function(){var Z={};
O(this,Z);
this.aStack_.push(Z);
this.mStack_.push(this.m_);
this.m_=a(S(),this.m_)
};
L.restore=function(){if(this.aStack_.length){O(this.aStack_.pop(),this);
this.m_=this.mStack_.pop()
}};
function G(Z){return isFinite(Z[0][0])&&isFinite(Z[0][1])&&isFinite(Z[1][0])&&isFinite(Z[1][1])&&isFinite(Z[2][0])&&isFinite(Z[2][1])
}function x(j,Z,AD){if(!G(Z)){return 
}j.m_=Z;
if(AD){var AE=Z[0][0]*Z[1][1]-Z[0][1]*Z[1][0];
j.lineScale_=g(X(AE))
}}L.translate=function(m,j){var Z=[[1,0,0],[0,1,0],[m,j,1]];
x(this,a(Z,this.m_),false)
};
L.rotate=function(j){var AD=R(j);
var m=I(j);
this.rotation_+=j;
var Z=[[AD,m,0],[-m,AD,0],[0,0,1]];
x(this,a(Z,this.m_),false)
};
L.scale=function(m,j){this.arcScaleX_*=m;
this.arcScaleY_*=j;
var Z=[[m,0,0],[0,j,0],[0,0,1]];
x(this,a(Z,this.m_),true)
};
L.transform=function(AE,AD,AG,AF,j,Z){var m=[[AE,AD,0],[AG,AF,0],[j,Z,1]];
x(this,a(m,this.m_),true)
};
L.setTransform=function(AF,AE,AH,AG,AD,j){var Z=[[AF,AE,0],[AH,AG,0],[AD,j,1]];
x(this,Z,true)
};
L.drawText_=function(AL,AJ,AI,AO,AH){var AN=this.m_,AR=1000,j=0,AQ=AR,AG={x:0,y:0},AF=[];
var Z=N(U(this.font),this.element_);
var AD=z(Z);
var AS=this.element_.currentStyle;
var AE=this.textAlign.toLowerCase();
switch(AE){case"left":case"center":case"right":break;
case"end":AE=AS.direction=="ltr"?"right":"left";
break;
case"start":AE=AS.direction=="rtl"?"right":"left";
break;
default:AE="left"
}switch(this.textBaseline){case"hanging":case"top":AG.y=Z.size/1.75;
break;
case"middle":break;
default:case null:case"alphabetic":case"ideographic":case"bottom":AG.y=-Z.size/2.25;
break
}switch(AE){case"right":j=AR;
AQ=0.05;
break;
case"center":j=AQ=AR/2;
break
}var AP=this.getCoords_(AJ+AG.x,AI+AG.y);
AF.push('<g_vml_:line from="',-j,' 0" to="',AQ,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!AH,'" stroked="',!!AH,'" style="position:absolute;width:1px;height:1px;">');
if(AH){P(this,AF)
}else{W(this,AF,{x:-j,y:0},{x:AQ,y:Z.size})
}var AM=AN[0][0].toFixed(3)+","+AN[1][0].toFixed(3)+","+AN[0][1].toFixed(3)+","+AN[1][1].toFixed(3)+",0,0";
var AK=J(AP.x/D)+","+J(AP.y/D);
AF.push('<g_vml_:skew on="t" matrix="',AM,'" ',' offset="',AK,'" origin="',j,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',AC(AL),'" style="v-text-align:',AE,";font:",AC(AD),'" /></g_vml_:line>');
this.element_.insertAdjacentHTML("beforeEnd",AF.join(""))
};
L.fillText=function(m,Z,AD,j){this.drawText_(m,Z,AD,j,false)
};
L.strokeText=function(m,Z,AD,j){this.drawText_(m,Z,AD,j,true)
};
L.measureText=function(AE){if(!this.textMeasureEl_){var j='<span style="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;"></span>';
this.element_.insertAdjacentHTML("beforeEnd",j);
this.textMeasureEl_=this.element_.lastChild
}var m=this.element_.ownerDocument;
this.textMeasureEl_.innerHTML="";
var AD=N(U(this.font),this.element_),Z=z(AD);
this.textMeasureEl_.style.font=Z;
this.textMeasureEl_.appendChild(m.createTextNode(AE));
return{width:this.textMeasureEl_.offsetWidth}
};
L.clip=function(){};
L.arcTo=function(){};
L.createPattern=function(j,Z){return new t(j,Z)
};
function u(Z){this.type_=Z;
this.x0_=0;
this.y0_=0;
this.r0_=0;
this.x1_=0;
this.y1_=0;
this.r1_=0;
this.colors_=[]
}u.prototype.addColorStop=function(j,Z){Z=V(Z);
this.colors_.push({offset:j,color:Z.color,alpha:Z.alpha})
};
function t(j,Z){o(j);
switch(Z){case"repeat":case null:case"":this.repetition_="repeat";
break;
case"repeat-x":case"repeat-y":case"no-repeat":this.repetition_=Z;
break;
default:k("SYNTAX_ERR")
}this.src_=j.src;
this.width_=j.width;
this.height_=j.height
}function k(Z){throw new n(Z)
}function o(Z){if(!Z||Z.nodeType!=1||Z.tagName!="IMG"){k("TYPE_MISMATCH_ERR")
}if(Z.readyState!="complete"){k("INVALID_STATE_ERR")
}}function n(Z){this.code=this[Z];
this.message=Z+": DOM Exception "+this.code
}var w=n.prototype=new Error;
w.INDEX_SIZE_ERR=1;
w.DOMSTRING_SIZE_ERR=2;
w.HIERARCHY_REQUEST_ERR=3;
w.WRONG_DOCUMENT_ERR=4;
w.INVALID_CHARACTER_ERR=5;
w.NO_DATA_ALLOWED_ERR=6;
w.NO_MODIFICATION_ALLOWED_ERR=7;
w.NOT_FOUND_ERR=8;
w.NOT_SUPPORTED_ERR=9;
w.INUSE_ATTRIBUTE_ERR=10;
w.INVALID_STATE_ERR=11;
w.SYNTAX_ERR=12;
w.INVALID_MODIFICATION_ERR=13;
w.NAMESPACE_ERR=14;
w.INVALID_ACCESS_ERR=15;
w.VALIDATION_ERR=16;
w.TYPE_MISMATCH_ERR=17;
G_vmlCanvasManager=E;
CanvasRenderingContext2D=T;
CanvasGradient=u;
CanvasPattern=t;
DOMException=n
})()
}CQ.endorsed.swfobject=CQ_swfobject;
CQ.wcm.WorkflowModelCombo=CQ.Ext.extend(CQ.form.ClearableComboBox,{constructor:function(B){B=(!B?{}:B);
this.store=new CQ.Ext.data.Store({autoLoad:{},proxy:new CQ.Ext.data.HttpProxy({url:CQ.shared.HTTP.externalize("/libs/cq/workflow/content/console/workflows.json"),method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows",id:"wid",fields:["wid","label",CQ.shared.XSS.getXSSPropertyName("label"),"description","thumbnail","isCqPage"]}),listeners:{load:function(D){D.add(new D.recordType({wid:"",label:CQ.I18n.getMessage("Create new workflow model..."),description:"",thumbnail:""},CQ.Ext.id()))
}}});
var A=this;
this.initialValue=null;
this.store.on("load",function(){if(A.initialValue){A.setValue(A.initialValue)
}A.fireEvent("load",this)
});
var C=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/WorkflowModelCombo/workflow-model.png");
B=CQ.Util.applyDefaults(B,{name:"workflowModel",hiddenName:"./workflowModel",fieldLabel:"Workflow Model",displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflow Models"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,lazyInit:false,store:this.store,tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="workflow-model-item x-combo-list-item">','<tpl if="thumbnail">','<img class="workflow-model-thumbnail" src="{[CQ.shared.HTTP.getXhrHookedURL(values.thumbnail + ".thumb.48.48.png")]}">','<div class="workflow-model-title">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description">{description}</div>',"</tpl>","<tpl if=\"wid == ''\">",'<div class="workflow-model-title workflow-model-no-thumbnail">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description workflow-model-no-thumbnail">{description}</div>',"</tpl>","<tpl if=\"thumbnail == '' && wid != ''\">",'<img class="workflow-model-thumbnail" src="'+CQ.shared.HTTP.getXhrHookedURL(C+".thumb.48.48.png")+'">','<div class="workflow-model-title">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description">{description}</div>',"</tpl>",'<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>')});
CQ.wcm.WorkflowModelCombo.superclass.constructor.call(this,B)
},initComponent:function(){CQ.wcm.WorkflowModelCombo.superclass.initComponent.call(this);
this.on("select",function(C,A,B){if(A.get("wid")==""){this.createNewWorkflow()
}},this)
},setValue:function(A){this.initialValue=A;
CQ.wcm.WorkflowModelCombo.superclass.setValue.call(this,A)
},reload:function(A){this.store.reload(A)
},getSelectedRecord:function(){var A={};
var B=this.getValue();
A=this.store.getById(B);
return A
},createNewWorkflow:function(){var B=this;
var A={xtype:"dialog",modal:true,height:150,title:CQ.I18n.getMessage("New Workflow"),params:{_charset_:"utf-8",cmd:"createPage",template:"/libs/cq/workflow/templates/model",parentPath:"/etc/workflow/models/"},items:{xtype:"panel",items:[{xtype:"textfield",name:"title",fieldLabel:CQ.I18n.getMessage("Title")}]},responseScope:B,success:function(D,E){CQ.Ext.Ajax.request({url:E.result.Location+"/jcr:content.generate.json",method:"POST",success:function(F,G){var I=CQ.Ext.util.JSON.decode(F.responseText);
if((typeof I.modelPath)=="string"){B.reload();
B.setValue(I.modelPath);
var H=CQ.HTTP.internalize(E.result.Location);
CQ.wcm.SiteAdmin.openPage(H,"page",true)
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Did not get path of new workflow model in response"))
}},failure:function(F,G){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not generate workflow model."))
}})
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create workflow model."))
},buttons:[CQ.Dialog.OK,{text:CQ.I18n.getMessage("Cancel"),cls:"cq-btn-cancel",handler:function(D){B.clearValue();
this.hide()
}}]};
var C=CQ.WCM.getDialog(A);
C.form.url="/bin/wcmcommand";
C.show()
}});
CQ.Ext.reg("cq.workflow.model.combo",CQ.wcm.WorkflowModelCombo);
CQ.wcm.WorkflowModelThumbnail=CQ.Ext.extend(CQ.Ext.BoxComponent,{disabled:false,constructor:function(A){CQ.Util.applyDefaults(A,{source:"",alternativeText:"Click thumbnail to edit workflow model",width:200,height:200});
CQ.wcm.WorkflowModelThumbnail.superclass.constructor.call(this,A)
},initComponent:function(){CQ.wcm.WorkflowModelThumbnail.superclass.initComponent.call(this);
this.addEvents("click")
},onRender:function(B,A){if(!this.el){this.el=B.createChild({tag:"img",alt:this.alternativeText,src:this.source,style:"cursor:pointer;"},A);
this.el.on("click",function(){if(!this.disabled){this.fireEvent("click",this)
}},this)
}CQ.wcm.WorkflowModelThumbnail.superclass.onRender.call(this,B,A)
},setSource:function(A){this.source=A;
if(this.el){if(A!=""){A=CQ.shared.HTTP.getXhrHookedURL(A)
}this.el.dom.src=CQ.shared.HTTP.getXhrHookedURL(A)
}},setDisabled:function(A){this.disabled=A;
if(this.disabled){this.el.setStyle("cursor","default")
}else{this.el.setStyle("cursor","pointer")
}}});
CQ.wcm.WorkflowModelSelector=CQ.Ext.extend(CQ.form.CompositeField,{hideThumbnail:false,constructor:function(D){D=(!D?{}:D);
var A=this;
if(!D.hideThumbnail){this.thumbnailImage=new CQ.wcm.WorkflowModelThumbnail({listeners:{click:this.editCurrentWorkflow,scope:this}})
}D=CQ.Util.applyDefaults(D,{allowBlank:false,border:false,name:"workflowModel"});
this.workflowModelCombo=new CQ.wcm.WorkflowModelCombo({xtype:"cq.workflow.model.combo",name:D.name,hiddenName:A.getHiddenName(D.name),title:"",allowBlank:D.allowBlank,listeners:{select:function(){A.updateThumbnail()
},clear:function(){A.updateThumbnail()
},load:function(){A.updateThumbnail()
}}});
var C="cq-wcm-workflow-model-selector-compact";
var B=[this.workflowModelCombo,{xtype:"spacer",height:10}];
if(this.thumbnailImage){C="cq-wcm-workflow-model-selector";
B.push({xtype:"panel",layout:"hbox",layoutConfig:{pack:"center"},border:false,items:[this.thumbnailImage]})
}D=CQ.Util.applyDefaults(D,{cls:C,layout:"vbox",layoutConfig:{align:"stretch"},border:false,items:B});
CQ.wcm.WorkflowModelSelector.superclass.constructor.call(this,D)
},initComponent:function(){CQ.wcm.WorkflowModelSelector.superclass.initComponent.call(this)
},setValue:function(A){this.workflowModelCombo.setValue(A);
this.updateThumbnail()
},getValue:function(){return this.workflowModelCombo.getValue()
},getRawValue:function(){return this.workflowModelCombo.getRawValue()
},updateThumbnail:function(){if(!this.hideThumbnail){var D=this.thumbnailImage.height;
var C=this.thumbnailImage.width;
var B=this.workflowModelCombo.getSelectedRecord();
if(!B){this.thumbnailImage.setDisabled(true);
this.thumbnailImage.setSource("data:image/gif;base64,R0lGODlhAQABAJH/AP///wAAAMDAwAAAACH5BAEAAAIALAAAAAABAAEAAAICVAEAOw==")
}else{var A=(B&&(typeof B.data.thumbnail=="string"))?B.data.thumbnail:"";
var E=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/WorkflowModelCombo/workflow-model.png");
if(A.length>0){E=A+".thumb.200.200.png"
}this.thumbnailImage.setDisabled(false);
this.thumbnailImage.setSource(E)
}}},editCurrentWorkflow:function(){var A=this.getValue();
if(A&&A!=""){A=A.replace(/\/jcr.content\/model$/,"");
CQ.wcm.SiteAdmin.openPage(A,"page",true)
}},getHiddenName:function(A){if(!A){return 
}var B=A;
var C=new RegExp("^./","i");
if(!C.test(B)){B="./"+B
}return B
}});
CQ.Ext.reg("cq.workflow.model.selector",CQ.wcm.WorkflowModelSelector);